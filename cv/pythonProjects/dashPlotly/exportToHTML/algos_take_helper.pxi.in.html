<html>
<head>
<title>algos_take_helper.pxi.in</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #a9b7c6;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
algos_take_helper.pxi.in</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;</span>
<span class="s0">Template for each `dtype` helper function for take</span>

<span class="s0">WARNING: DO NOT edit .pxi FILE directly, .pxi is generated from .pxi.in</span>
<span class="s0">&quot;&quot;&quot;</span>

<span class="s0"># ----------------------------------------------------------------------</span>
<span class="s0"># take_1d, take_2d</span>
<span class="s0"># ----------------------------------------------------------------------</span>


<span class="s0">{{py:</span>

<span class="s0"># c_type_in, c_type_out</span>
<span class="s0">dtypes = [</span>
    <span class="s0">('uint8_t', 'uint8_t'),</span>
    <span class="s0">('uint8_t', 'object'),</span>
    <span class="s0">('int8_t', 'int8_t'),</span>
    <span class="s0">('int8_t', 'int32_t'),</span>
    <span class="s0">('int8_t', 'int64_t'),</span>
    <span class="s0">('int8_t', 'float64_t'),</span>
    <span class="s0">('int16_t', 'int16_t'),</span>
    <span class="s0">('int16_t', 'int32_t'),</span>
    <span class="s0">('int16_t', 'int64_t'),</span>
    <span class="s0">('int16_t', 'float64_t'),</span>
    <span class="s0">('int32_t', 'int32_t'),</span>
    <span class="s0">('int32_t', 'int64_t'),</span>
    <span class="s0">('int32_t', 'float64_t'),</span>
    <span class="s0">('int64_t', 'int64_t'),</span>
    <span class="s0">('int64_t', 'float64_t'),</span>
    <span class="s0">('float32_t', 'float32_t'),</span>
    <span class="s0">('float32_t', 'float64_t'),</span>
    <span class="s0">('float64_t', 'float64_t'),</span>
    <span class="s0">('object', 'object'),</span>
<span class="s0">]</span>


<span class="s0">def get_dispatch(dtypes):</span>

    <span class="s0">for (c_type_in, c_type_out) in dtypes:</span>

        <span class="s0">def get_name(dtype_name):</span>
            <span class="s0">if dtype_name == &quot;object&quot;:</span>
                <span class="s0">return &quot;object&quot;</span>
            <span class="s0">if dtype_name == &quot;uint8_t&quot;:</span>
                <span class="s0">return &quot;bool&quot;</span>
            <span class="s0">return dtype_name[:-2]</span>

        <span class="s0">name = get_name(c_type_in)</span>
        <span class="s0">dest = get_name(c_type_out)</span>

        <span class="s0">args = dict(name=name, dest=dest, c_type_in=c_type_in,</span>
                    <span class="s0">c_type_out=c_type_out)</span>

        <span class="s0">yield (name, dest, c_type_in, c_type_out)</span>

<span class="s0">}}</span>


<span class="s0">{{for name, dest, c_type_in, c_type_out in get_dispatch(dtypes)}}</span>


<span class="s0">@cython.wraparound(False)</span>
<span class="s0">@cython.boundscheck(False)</span>
<span class="s0">{{if c_type_in != &quot;object&quot;}}</span>
<span class="s0">def take_1d_{{name}}_{{dest}}(const {{c_type_in}}[:] values,</span>
<span class="s0">{{else}}</span>
<span class="s0">def take_1d_{{name}}_{{dest}}(ndarray[{{c_type_in}}, ndim=1] values,</span>
<span class="s0">{{endif}}</span>
                              <span class="s0">const intp_t[:] indexer,</span>
                              <span class="s0">{{c_type_out}}[:] out,</span>
                              <span class="s0">fill_value=np.nan):</span>

    <span class="s0">cdef:</span>
        <span class="s0">Py_ssize_t i, n, idx</span>
        <span class="s0">{{c_type_out}} fv</span>

    <span class="s0">n = indexer.shape[0]</span>

    <span class="s0">fv = fill_value</span>

    <span class="s0">{{if c_type_out != &quot;object&quot;}}</span>
    <span class="s0">with nogil:</span>
    <span class="s0">{{else}}</span>
    <span class="s0">if True:</span>
    <span class="s0">{{endif}}</span>
        <span class="s0">for i in range(n):</span>
            <span class="s0">idx = indexer[i]</span>
            <span class="s0">if idx == -1:</span>
                <span class="s0">out[i] = fv</span>
            <span class="s0">else:</span>
                <span class="s0">{{if c_type_in == &quot;uint8_t&quot; and c_type_out == &quot;object&quot;}}</span>
                <span class="s0">out[i] = True if values[idx] &gt; 0 else False</span>
                <span class="s0">{{else}}</span>
                <span class="s0">out[i] = values[idx]</span>
                <span class="s0">{{endif}}</span>


<span class="s0">@cython.wraparound(False)</span>
<span class="s0">@cython.boundscheck(False)</span>
<span class="s0">{{if c_type_in != &quot;object&quot;}}</span>
<span class="s0">def take_2d_axis0_{{name}}_{{dest}}(const {{c_type_in}}[:, :] values,</span>
<span class="s0">{{else}}</span>
<span class="s0">def take_2d_axis0_{{name}}_{{dest}}(ndarray[{{c_type_in}}, ndim=2] values,</span>
<span class="s0">{{endif}}</span>
                                    <span class="s0">ndarray[intp_t, ndim=1] indexer,</span>
                                    <span class="s0">{{c_type_out}}[:, :] out,</span>
                                    <span class="s0">fill_value=np.nan):</span>
    <span class="s0">cdef:</span>
        <span class="s0">Py_ssize_t i, j, k, n, idx</span>
        <span class="s0">{{c_type_out}} fv</span>
        <span class="s0">{{if c_type_in == c_type_out != &quot;object&quot;}}</span>
        <span class="s0">const {{c_type_out}} *v</span>
        <span class="s0">{{c_type_out}} *o</span>
        <span class="s0">{{endif}}</span>

    <span class="s0">n = len(indexer)</span>
    <span class="s0">k = values.shape[1]</span>

    <span class="s0">fv = fill_value</span>

    <span class="s0">{{if c_type_in == c_type_out != &quot;object&quot;}}</span>
    <span class="s0"># GH#3130</span>
    <span class="s0">if (values.strides[1] == out.strides[1] and</span>
        <span class="s0">values.strides[1] == sizeof({{c_type_out}}) and</span>
        <span class="s0">sizeof({{c_type_out}}) * n &gt;= 256):</span>

        <span class="s0">for i in range(n):</span>
            <span class="s0">idx = indexer[i]</span>
            <span class="s0">if idx == -1:</span>
                <span class="s0">for j in range(k):</span>
                    <span class="s0">out[i, j] = fv</span>
            <span class="s0">else:</span>
                <span class="s0">v = &amp;values[idx, 0]</span>
                <span class="s0">o = &amp;out[i, 0]</span>
                <span class="s0">memmove(o, v, &lt;size_t&gt;(sizeof({{c_type_out}}) * k))</span>
        <span class="s0">return</span>
    <span class="s0">{{endif}}</span>

    <span class="s0">for i in range(n):</span>
        <span class="s0">idx = indexer[i]</span>
        <span class="s0">if idx == -1:</span>
            <span class="s0">for j in range(k):</span>
                <span class="s0">out[i, j] = fv</span>
        <span class="s0">else:</span>
            <span class="s0">for j in range(k):</span>
                <span class="s0">{{if c_type_in == &quot;uint8_t&quot; and c_type_out == &quot;object&quot;}}</span>
                <span class="s0">out[i, j] = True if values[idx, j] &gt; 0 else False</span>
                <span class="s0">{{else}}</span>
                <span class="s0">out[i, j] = values[idx, j]</span>
                <span class="s0">{{endif}}</span>


<span class="s0">@cython.wraparound(False)</span>
<span class="s0">@cython.boundscheck(False)</span>
<span class="s0">{{if c_type_in != &quot;object&quot;}}</span>
<span class="s0">def take_2d_axis1_{{name}}_{{dest}}(const {{c_type_in}}[:, :] values,</span>
<span class="s0">{{else}}</span>
<span class="s0">def take_2d_axis1_{{name}}_{{dest}}(ndarray[{{c_type_in}}, ndim=2] values,</span>
<span class="s0">{{endif}}</span>
                                    <span class="s0">ndarray[intp_t, ndim=1] indexer,</span>
                                    <span class="s0">{{c_type_out}}[:, :] out,</span>
                                    <span class="s0">fill_value=np.nan):</span>

    <span class="s0">cdef:</span>
        <span class="s0">Py_ssize_t i, j, k, n, idx</span>
        <span class="s0">{{c_type_out}} fv</span>

    <span class="s0">n = len(values)</span>
    <span class="s0">k = len(indexer)</span>

    <span class="s0">if n == 0 or k == 0:</span>
        <span class="s0">return</span>

    <span class="s0">fv = fill_value</span>

    <span class="s0">for i in range(n):</span>
        <span class="s0">for j in range(k):</span>
            <span class="s0">idx = indexer[j]</span>
            <span class="s0">if idx == -1:</span>
                <span class="s0">out[i, j] = fv</span>
            <span class="s0">else:</span>
                <span class="s0">{{if c_type_in == &quot;uint8_t&quot; and c_type_out == &quot;object&quot;}}</span>
                <span class="s0">out[i, j] = True if values[i, idx] &gt; 0 else False</span>
                <span class="s0">{{else}}</span>
                <span class="s0">out[i, j] = values[i, idx]</span>
                <span class="s0">{{endif}}</span>


<span class="s0">@cython.wraparound(False)</span>
<span class="s0">@cython.boundscheck(False)</span>
<span class="s0">def take_2d_multi_{{name}}_{{dest}}(ndarray[{{c_type_in}}, ndim=2] values,</span>
                                    <span class="s0">indexer,</span>
                                    <span class="s0">ndarray[{{c_type_out}}, ndim=2] out,</span>
                                    <span class="s0">fill_value=np.nan):</span>
    <span class="s0">cdef:</span>
        <span class="s0">Py_ssize_t i, j, k, n, idx</span>
        <span class="s0">ndarray[intp_t, ndim=1] idx0 = indexer[0]</span>
        <span class="s0">ndarray[intp_t, ndim=1] idx1 = indexer[1]</span>
        <span class="s0">{{c_type_out}} fv</span>

    <span class="s0">n = len(idx0)</span>
    <span class="s0">k = len(idx1)</span>

    <span class="s0">fv = fill_value</span>
    <span class="s0">for i in range(n):</span>
        <span class="s0">idx = idx0[i]</span>
        <span class="s0">if idx == -1:</span>
            <span class="s0">for j in range(k):</span>
                <span class="s0">out[i, j] = fv</span>
        <span class="s0">else:</span>
            <span class="s0">for j in range(k):</span>
                <span class="s0">if idx1[j] == -1:</span>
                    <span class="s0">out[i, j] = fv</span>
                <span class="s0">else:</span>
                    <span class="s0">{{if c_type_in == &quot;uint8_t&quot; and c_type_out == &quot;object&quot;}}</span>
                    <span class="s0">out[i, j] = True if values[idx, idx1[j]] &gt; 0 else False</span>
                    <span class="s0">{{else}}</span>
                    <span class="s0">out[i, j] = values[idx, idx1[j]]</span>
                    <span class="s0">{{endif}}</span>

<span class="s0">{{endfor}}</span>
</pre>
</body>
</html>