<html>
<head>
<title>test_index_tricks.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #808080;}
.s4 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_index_tricks.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy.testing </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">assert_</span><span class="s0">, </span><span class="s1">assert_equal</span><span class="s0">, </span><span class="s1">assert_array_equal</span><span class="s0">, </span><span class="s1">assert_almost_equal</span><span class="s0">,</span>
    <span class="s1">assert_array_almost_equal</span><span class="s0">, </span><span class="s1">assert_raises</span><span class="s0">, </span><span class="s1">assert_raises_regex</span><span class="s0">,</span>
    <span class="s1">)</span>
<span class="s0">from </span><span class="s1">numpy.lib.index_tricks </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">mgrid</span><span class="s0">, </span><span class="s1">ogrid</span><span class="s0">, </span><span class="s1">ndenumerate</span><span class="s0">, </span><span class="s1">fill_diagonal</span><span class="s0">, </span><span class="s1">diag_indices</span><span class="s0">, </span><span class="s1">diag_indices_from</span><span class="s0">,</span>
    <span class="s1">index_exp</span><span class="s0">, </span><span class="s1">ndindex</span><span class="s0">, </span><span class="s1">r_</span><span class="s0">, </span><span class="s1">s_</span><span class="s0">, </span><span class="s1">ix_</span>
    <span class="s1">)</span>


<span class="s0">class </span><span class="s1">TestRavelUnravelIndex:</span>
    <span class="s0">def </span><span class="s1">test_basic(self):</span>
        <span class="s1">assert_equal(np.unravel_index(</span><span class="s2">2</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span><span class="s0">, </span><span class="s1">(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s3"># test that new shape argument works properly</span>
        <span class="s1">assert_equal(np.unravel_index(indices=</span><span class="s2">2</span><span class="s0">,</span>
                                      <span class="s1">shape=(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span><span class="s0">,</span>
                                      <span class="s1">(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

        <span class="s3"># test that an invalid second keyword argument</span>
        <span class="s3"># is properly handled, including the old name `dims`.</span>
        <span class="s0">with </span><span class="s1">assert_raises(TypeError):</span>
            <span class="s1">np.unravel_index(indices=</span><span class="s2">2</span><span class="s0">, </span><span class="s1">hape=(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>

        <span class="s0">with </span><span class="s1">assert_raises(TypeError):</span>
            <span class="s1">np.unravel_index(</span><span class="s2">2</span><span class="s0">, </span><span class="s1">hape=(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>

        <span class="s0">with </span><span class="s1">assert_raises(TypeError):</span>
            <span class="s1">np.unravel_index(</span><span class="s2">254</span><span class="s0">, </span><span class="s1">ims=(</span><span class="s2">17</span><span class="s0">, </span><span class="s2">94</span><span class="s1">))</span>

        <span class="s0">with </span><span class="s1">assert_raises(TypeError):</span>
            <span class="s1">np.unravel_index(</span><span class="s2">254</span><span class="s0">, </span><span class="s1">dims=(</span><span class="s2">17</span><span class="s0">, </span><span class="s2">94</span><span class="s1">))</span>

        <span class="s1">assert_equal(np.ravel_multi_index((</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.unravel_index(</span><span class="s2">254</span><span class="s0">, </span><span class="s1">(</span><span class="s2">17</span><span class="s0">, </span><span class="s2">94</span><span class="s1">))</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">66</span><span class="s1">))</span>
        <span class="s1">assert_equal(np.ravel_multi_index((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">66</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">17</span><span class="s0">, </span><span class="s2">94</span><span class="s1">))</span><span class="s0">, </span><span class="s2">254</span><span class="s1">)</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">np.unravel_index</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>
        <span class="s1">assert_raises(TypeError</span><span class="s0">, </span><span class="s1">np.unravel_index</span><span class="s0">, </span><span class="s2">0.5</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">np.unravel_index</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">np.ravel_multi_index</span><span class="s0">, </span><span class="s1">(-</span><span class="s2">3</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">np.ravel_multi_index</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">np.ravel_multi_index</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">-</span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">np.ravel_multi_index</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>
        <span class="s1">assert_raises(TypeError</span><span class="s0">, </span><span class="s1">np.ravel_multi_index</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0.1</span><span class="s0">, </span><span class="s2">0.</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>

        <span class="s1">assert_equal(np.unravel_index((</span><span class="s2">2</span><span class="s1">*</span><span class="s2">3 </span><span class="s1">+ </span><span class="s2">1</span><span class="s1">)*</span><span class="s2">6 </span><span class="s1">+ </span><span class="s2">4</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s1">])</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">np.ravel_multi_index([</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s1">*</span><span class="s2">3 </span><span class="s1">+ </span><span class="s2">1</span><span class="s1">)*</span><span class="s2">6 </span><span class="s1">+ </span><span class="s2">4</span><span class="s1">)</span>

        <span class="s1">arr = np.array([[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]])</span>
        <span class="s1">assert_equal(np.ravel_multi_index(arr</span><span class="s0">, </span><span class="s1">(</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span><span class="s0">, </span><span class="s1">[</span><span class="s2">22</span><span class="s0">, </span><span class="s2">41</span><span class="s0">, </span><span class="s2">37</span><span class="s1">])</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">np.ravel_multi_index(arr</span><span class="s0">, </span><span class="s1">(</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">order=</span><span class="s4">'F'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s2">31</span><span class="s0">, </span><span class="s2">41</span><span class="s0">, </span><span class="s2">13</span><span class="s1">])</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">np.ravel_multi_index(arr</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">mode=</span><span class="s4">'clip'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s2">22</span><span class="s0">, </span><span class="s2">23</span><span class="s0">, </span><span class="s2">19</span><span class="s1">])</span>
        <span class="s1">assert_equal(np.ravel_multi_index(arr</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">mode=(</span><span class="s4">'clip'</span><span class="s0">, </span><span class="s4">'wrap'</span><span class="s1">))</span><span class="s0">,</span>
                     <span class="s1">[</span><span class="s2">12</span><span class="s0">, </span><span class="s2">13</span><span class="s0">, </span><span class="s2">13</span><span class="s1">])</span>
        <span class="s1">assert_equal(np.ravel_multi_index((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">9</span><span class="s1">))</span><span class="s0">, </span><span class="s2">1621</span><span class="s1">)</span>

        <span class="s1">assert_equal(np.unravel_index(np.array([</span><span class="s2">22</span><span class="s0">, </span><span class="s2">41</span><span class="s0">, </span><span class="s2">37</span><span class="s1">])</span><span class="s0">, </span><span class="s1">(</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span><span class="s0">,</span>
                     <span class="s1">[[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]])</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">np.unravel_index(np.array([</span><span class="s2">31</span><span class="s0">, </span><span class="s2">41</span><span class="s0">, </span><span class="s2">13</span><span class="s1">])</span><span class="s0">, </span><span class="s1">(</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">order=</span><span class="s4">'F'</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">[[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]])</span>
        <span class="s1">assert_equal(np.unravel_index(</span><span class="s2">1621</span><span class="s0">, </span><span class="s1">(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">9</span><span class="s1">))</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_empty_indices(self):</span>
        <span class="s1">msg1 = </span><span class="s4">'indices must be integral: the provided empty sequence was'</span>
        <span class="s1">msg2 = </span><span class="s4">'only int indices permitted'</span>
        <span class="s1">assert_raises_regex(TypeError</span><span class="s0">, </span><span class="s1">msg1</span><span class="s0">, </span><span class="s1">np.unravel_index</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s1">))</span>
        <span class="s1">assert_raises_regex(TypeError</span><span class="s0">, </span><span class="s1">msg1</span><span class="s0">, </span><span class="s1">np.unravel_index</span><span class="s0">, </span><span class="s1">()</span><span class="s0">, </span><span class="s1">(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s1">))</span>
        <span class="s1">assert_raises_regex(TypeError</span><span class="s0">, </span><span class="s1">msg2</span><span class="s0">, </span><span class="s1">np.unravel_index</span><span class="s0">, </span><span class="s1">np.array([])</span><span class="s0">,</span>
                            <span class="s1">(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s1">))</span>
        <span class="s1">assert_equal(np.unravel_index(np.array([]</span><span class="s0">,</span><span class="s1">dtype=int)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s1">))</span><span class="s0">,</span>
                     <span class="s1">[[]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">[]])</span>
        <span class="s1">assert_raises_regex(TypeError</span><span class="s0">, </span><span class="s1">msg1</span><span class="s0">, </span><span class="s1">np.ravel_multi_index</span><span class="s0">, </span><span class="s1">([]</span><span class="s0">, </span><span class="s1">[])</span><span class="s0">,</span>
                            <span class="s1">(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>
        <span class="s1">assert_raises_regex(TypeError</span><span class="s0">, </span><span class="s1">msg1</span><span class="s0">, </span><span class="s1">np.ravel_multi_index</span><span class="s0">, </span><span class="s1">([]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'abc'</span><span class="s1">])</span><span class="s0">,</span>
                            <span class="s1">(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>
        <span class="s1">assert_raises_regex(TypeError</span><span class="s0">, </span><span class="s1">msg2</span><span class="s0">, </span><span class="s1">np.ravel_multi_index</span><span class="s0">,</span>
                    <span class="s1">(np.array([])</span><span class="s0">, </span><span class="s1">np.array([]))</span><span class="s0">, </span><span class="s1">(</span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>
        <span class="s1">assert_equal(np.ravel_multi_index(</span>
                <span class="s1">(np.array([]</span><span class="s0">, </span><span class="s1">dtype=int)</span><span class="s0">, </span><span class="s1">np.array([]</span><span class="s0">, </span><span class="s1">dtype=int))</span><span class="s0">, </span><span class="s1">(</span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span><span class="s0">, </span><span class="s1">[])</span>
        <span class="s1">assert_equal(np.ravel_multi_index(np.array([[]</span><span class="s0">, </span><span class="s1">[]]</span><span class="s0">, </span><span class="s1">dtype=int)</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span><span class="s0">, </span><span class="s1">[])</span>

    <span class="s0">def </span><span class="s1">test_big_indices(self):</span>
        <span class="s3"># ravel_multi_index for big indices (issue #7546)</span>
        <span class="s0">if </span><span class="s1">np.intp == np.int64:</span>
            <span class="s1">arr = ([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">29</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">117</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">19</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                   <span class="s1">[</span><span class="s2">2379</span><span class="s0">, </span><span class="s2">1284</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>
            <span class="s1">assert_equal(</span>
                <span class="s1">np.ravel_multi_index(arr</span><span class="s0">, </span><span class="s1">(</span><span class="s2">41</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">120</span><span class="s0">, </span><span class="s2">36</span><span class="s0">, </span><span class="s2">2706</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s2">5627771580</span><span class="s0">, </span><span class="s2">117259570957</span><span class="s1">])</span>

        <span class="s3"># test unravel_index for big indices (issue #9538)</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">np.unravel_index</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s1">**</span><span class="s2">32</span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">**</span><span class="s2">31</span><span class="s1">+</span><span class="s2">1</span><span class="s1">))</span>

        <span class="s3"># test overflow checking for too big array (issue #7546)</span>
        <span class="s1">dummy_arr = ([</span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span><span class="s1">[</span><span class="s2">0</span><span class="s1">])</span>
        <span class="s1">half_max = np.iinfo(np.intp).max // </span><span class="s2">2</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">np.ravel_multi_index(dummy_arr</span><span class="s0">, </span><span class="s1">(half_max</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s1">])</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">,</span>
            <span class="s1">np.ravel_multi_index</span><span class="s0">, </span><span class="s1">dummy_arr</span><span class="s0">, </span><span class="s1">(half_max+</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">np.ravel_multi_index(dummy_arr</span><span class="s0">, </span><span class="s1">(half_max</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">order=</span><span class="s4">'F'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s1">])</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">,</span>
            <span class="s1">np.ravel_multi_index</span><span class="s0">, </span><span class="s1">dummy_arr</span><span class="s0">, </span><span class="s1">(half_max+</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">order=</span><span class="s4">'F'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_dtypes(self):</span>
        <span class="s3"># Test with different data types</span>
        <span class="s0">for </span><span class="s1">dtype </span><span class="s0">in </span><span class="s1">[np.int16</span><span class="s0">, </span><span class="s1">np.uint16</span><span class="s0">, </span><span class="s1">np.int32</span><span class="s0">,</span>
                      <span class="s1">np.uint32</span><span class="s0">, </span><span class="s1">np.int64</span><span class="s0">, </span><span class="s1">np.uint64]:</span>
            <span class="s1">coords = np.array(</span>
                <span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
            <span class="s1">shape = (</span><span class="s2">5</span><span class="s0">, </span><span class="s2">8</span><span class="s1">)</span>
            <span class="s1">uncoords = </span><span class="s2">8</span><span class="s1">*coords[</span><span class="s2">0</span><span class="s1">]+coords[</span><span class="s2">1</span><span class="s1">]</span>
            <span class="s1">assert_equal(np.ravel_multi_index(coords</span><span class="s0">, </span><span class="s1">shape)</span><span class="s0">, </span><span class="s1">uncoords)</span>
            <span class="s1">assert_equal(coords</span><span class="s0">, </span><span class="s1">np.unravel_index(uncoords</span><span class="s0">, </span><span class="s1">shape))</span>
            <span class="s1">uncoords = coords[</span><span class="s2">0</span><span class="s1">]+</span><span class="s2">5</span><span class="s1">*coords[</span><span class="s2">1</span><span class="s1">]</span>
            <span class="s1">assert_equal(</span>
                <span class="s1">np.ravel_multi_index(coords</span><span class="s0">, </span><span class="s1">shape</span><span class="s0">, </span><span class="s1">order=</span><span class="s4">'F'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">uncoords)</span>
            <span class="s1">assert_equal(coords</span><span class="s0">, </span><span class="s1">np.unravel_index(uncoords</span><span class="s0">, </span><span class="s1">shape</span><span class="s0">, </span><span class="s1">order=</span><span class="s4">'F'</span><span class="s1">))</span>

            <span class="s1">coords = np.array(</span>
                <span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">9</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]]</span><span class="s0">,</span>
                <span class="s1">dtype=dtype)</span>
            <span class="s1">shape = (</span><span class="s2">5</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)</span>
            <span class="s1">uncoords = </span><span class="s2">10</span><span class="s1">*(</span><span class="s2">8</span><span class="s1">*coords[</span><span class="s2">0</span><span class="s1">]+coords[</span><span class="s2">1</span><span class="s1">])+coords[</span><span class="s2">2</span><span class="s1">]</span>
            <span class="s1">assert_equal(np.ravel_multi_index(coords</span><span class="s0">, </span><span class="s1">shape)</span><span class="s0">, </span><span class="s1">uncoords)</span>
            <span class="s1">assert_equal(coords</span><span class="s0">, </span><span class="s1">np.unravel_index(uncoords</span><span class="s0">, </span><span class="s1">shape))</span>
            <span class="s1">uncoords = coords[</span><span class="s2">0</span><span class="s1">]+</span><span class="s2">5</span><span class="s1">*(coords[</span><span class="s2">1</span><span class="s1">]+</span><span class="s2">8</span><span class="s1">*coords[</span><span class="s2">2</span><span class="s1">])</span>
            <span class="s1">assert_equal(</span>
                <span class="s1">np.ravel_multi_index(coords</span><span class="s0">, </span><span class="s1">shape</span><span class="s0">, </span><span class="s1">order=</span><span class="s4">'F'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">uncoords)</span>
            <span class="s1">assert_equal(coords</span><span class="s0">, </span><span class="s1">np.unravel_index(uncoords</span><span class="s0">, </span><span class="s1">shape</span><span class="s0">, </span><span class="s1">order=</span><span class="s4">'F'</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_clipmodes(self):</span>
        <span class="s3"># Test clipmodes</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">np.ravel_multi_index([</span><span class="s2">5</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">12</span><span class="s1">)</span><span class="s0">, </span><span class="s1">mode=</span><span class="s4">'wrap'</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">np.ravel_multi_index([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">12</span><span class="s1">)))</span>
        <span class="s1">assert_equal(np.ravel_multi_index([</span><span class="s2">5</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">12</span><span class="s1">)</span><span class="s0">,</span>
                                          <span class="s1">mode=(</span>
                                              <span class="s4">'wrap'</span><span class="s0">, </span><span class="s4">'raise'</span><span class="s0">, </span><span class="s4">'clip'</span><span class="s0">, </span><span class="s4">'raise'</span><span class="s1">))</span><span class="s0">,</span>
                     <span class="s1">np.ravel_multi_index([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">12</span><span class="s1">)))</span>
        <span class="s1">assert_raises(</span>
            <span class="s1">ValueError</span><span class="s0">, </span><span class="s1">np.ravel_multi_index</span><span class="s0">, </span><span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">12</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_writeability(self):</span>
        <span class="s3"># See gh-7269</span>
        <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.unravel_index([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s1">))</span>
        <span class="s1">assert_(x.flags.writeable)</span>
        <span class="s1">assert_(y.flags.writeable)</span>

    <span class="s0">def </span><span class="s1">test_0d(self):</span>
        <span class="s3"># gh-580</span>
        <span class="s1">x = np.unravel_index(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">())</span>
        <span class="s1">assert_equal(x</span><span class="s0">, </span><span class="s1">())</span>

        <span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s4">&quot;0d array&quot;</span><span class="s0">, </span><span class="s1">np.unravel_index</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">())</span>
        <span class="s1">assert_raises_regex(</span>
            <span class="s1">ValueError</span><span class="s0">, </span><span class="s4">&quot;out of bounds&quot;</span><span class="s0">, </span><span class="s1">np.unravel_index</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">())</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;mode&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s4">&quot;clip&quot;</span><span class="s0">, </span><span class="s4">&quot;wrap&quot;</span><span class="s0">, </span><span class="s4">&quot;raise&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_empty_array_ravel(self</span><span class="s0">, </span><span class="s1">mode):</span>
        <span class="s1">res = np.ravel_multi_index(</span>
                    <span class="s1">np.zeros((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=np.intp)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">mode=mode)</span>
        <span class="s0">assert</span><span class="s1">(res.shape == (</span><span class="s2">0</span><span class="s0">,</span><span class="s1">))</span>

        <span class="s0">with </span><span class="s1">assert_raises(ValueError):</span>
            <span class="s1">np.ravel_multi_index(</span>
                    <span class="s1">np.zeros((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=np.intp)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">mode=mode)</span>

    <span class="s0">def </span><span class="s1">test_empty_array_unravel(self):</span>
        <span class="s1">res = np.unravel_index(np.zeros(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">dtype=np.intp)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>
        <span class="s3"># res is a tuple of three empty arrays</span>
        <span class="s0">assert</span><span class="s1">(len(res) == </span><span class="s2">3</span><span class="s1">)</span>
        <span class="s0">assert</span><span class="s1">(all(a.shape == (</span><span class="s2">0</span><span class="s0">,</span><span class="s1">) </span><span class="s0">for </span><span class="s1">a </span><span class="s0">in </span><span class="s1">res))</span>

        <span class="s0">with </span><span class="s1">assert_raises(ValueError):</span>
            <span class="s1">np.unravel_index([</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>

<span class="s0">class </span><span class="s1">TestGrid:</span>
    <span class="s0">def </span><span class="s1">test_basic(self):</span>
        <span class="s1">a = mgrid[-</span><span class="s2">1</span><span class="s1">:</span><span class="s2">1</span><span class="s1">:</span><span class="s2">10j</span><span class="s1">]</span>
        <span class="s1">b = mgrid[-</span><span class="s2">1</span><span class="s1">:</span><span class="s2">1</span><span class="s1">:</span><span class="s2">0.1</span><span class="s1">]</span>
        <span class="s1">assert_(a.shape == (</span><span class="s2">10</span><span class="s0">,</span><span class="s1">))</span>
        <span class="s1">assert_(b.shape == (</span><span class="s2">20</span><span class="s0">,</span><span class="s1">))</span>
        <span class="s1">assert_(a[</span><span class="s2">0</span><span class="s1">] == -</span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(a[-</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">assert_(b[</span><span class="s2">0</span><span class="s1">] == -</span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(b[</span><span class="s2">1</span><span class="s1">]-b[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">0.1</span><span class="s0">, </span><span class="s2">11</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(b[-</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">b[</span><span class="s2">0</span><span class="s1">]+</span><span class="s2">19</span><span class="s1">*</span><span class="s2">0.1</span><span class="s0">, </span><span class="s2">11</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(a[</span><span class="s2">1</span><span class="s1">]-a[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">2.0</span><span class="s1">/</span><span class="s2">9.0</span><span class="s0">, </span><span class="s2">11</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_linspace_equivalence(self):</span>
        <span class="s1">y</span><span class="s0">, </span><span class="s1">st = np.linspace(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s1">retstep=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(st</span><span class="s0">, </span><span class="s2">8</span><span class="s1">/</span><span class="s2">49.0</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(y</span><span class="s0">, </span><span class="s1">mgrid[</span><span class="s2">2</span><span class="s1">:</span><span class="s2">10</span><span class="s1">:</span><span class="s2">50j</span><span class="s1">]</span><span class="s0">, </span><span class="s2">13</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_nd(self):</span>
        <span class="s1">c = mgrid[-</span><span class="s2">1</span><span class="s1">:</span><span class="s2">1</span><span class="s1">:</span><span class="s2">10j</span><span class="s0">, </span><span class="s1">-</span><span class="s2">2</span><span class="s1">:</span><span class="s2">2</span><span class="s1">:</span><span class="s2">10j</span><span class="s1">]</span>
        <span class="s1">d = mgrid[-</span><span class="s2">1</span><span class="s1">:</span><span class="s2">1</span><span class="s1">:</span><span class="s2">0.1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">2</span><span class="s1">:</span><span class="s2">2</span><span class="s1">:</span><span class="s2">0.2</span><span class="s1">]</span>
        <span class="s1">assert_(c.shape == (</span><span class="s2">2</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">10</span><span class="s1">))</span>
        <span class="s1">assert_(d.shape == (</span><span class="s2">2</span><span class="s0">, </span><span class="s2">20</span><span class="s0">, </span><span class="s2">20</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(c[</span><span class="s2">0</span><span class="s1">][</span><span class="s2">0</span><span class="s0">, </span><span class="s1">:]</span><span class="s0">, </span><span class="s1">-np.ones(</span><span class="s2">10</span><span class="s0">, </span><span class="s4">'d'</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(c[</span><span class="s2">1</span><span class="s1">][:</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">-</span><span class="s2">2</span><span class="s1">*np.ones(</span><span class="s2">10</span><span class="s0">, </span><span class="s4">'d'</span><span class="s1">))</span>
        <span class="s1">assert_array_almost_equal(c[</span><span class="s2">0</span><span class="s1">][-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">:]</span><span class="s0">, </span><span class="s1">np.ones(</span><span class="s2">10</span><span class="s0">, </span><span class="s4">'d'</span><span class="s1">)</span><span class="s0">, </span><span class="s2">11</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(c[</span><span class="s2">1</span><span class="s1">][:</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s2">2</span><span class="s1">*np.ones(</span><span class="s2">10</span><span class="s0">, </span><span class="s4">'d'</span><span class="s1">)</span><span class="s0">, </span><span class="s2">11</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(d[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">:] - d[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">:]</span><span class="s0">,</span>
                                  <span class="s2">0.1</span><span class="s1">*np.ones(</span><span class="s2">20</span><span class="s0">, </span><span class="s4">'d'</span><span class="s1">)</span><span class="s0">, </span><span class="s2">11</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(d[</span><span class="s2">1</span><span class="s0">, </span><span class="s1">:</span><span class="s0">, </span><span class="s2">1</span><span class="s1">] - d[</span><span class="s2">1</span><span class="s0">, </span><span class="s1">:</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                  <span class="s2">0.2</span><span class="s1">*np.ones(</span><span class="s2">20</span><span class="s0">, </span><span class="s4">'d'</span><span class="s1">)</span><span class="s0">, </span><span class="s2">11</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_sparse(self):</span>
        <span class="s1">grid_full   = mgrid[-</span><span class="s2">1</span><span class="s1">:</span><span class="s2">1</span><span class="s1">:</span><span class="s2">10j</span><span class="s0">, </span><span class="s1">-</span><span class="s2">2</span><span class="s1">:</span><span class="s2">2</span><span class="s1">:</span><span class="s2">10j</span><span class="s1">]</span>
        <span class="s1">grid_sparse = ogrid[-</span><span class="s2">1</span><span class="s1">:</span><span class="s2">1</span><span class="s1">:</span><span class="s2">10j</span><span class="s0">, </span><span class="s1">-</span><span class="s2">2</span><span class="s1">:</span><span class="s2">2</span><span class="s1">:</span><span class="s2">10j</span><span class="s1">]</span>

        <span class="s3"># sparse grids can be made dense by broadcasting</span>
        <span class="s1">grid_broadcast = np.broadcast_arrays(*grid_sparse)</span>
        <span class="s0">for </span><span class="s1">f</span><span class="s0">, </span><span class="s1">b </span><span class="s0">in </span><span class="s1">zip(grid_full</span><span class="s0">, </span><span class="s1">grid_broadcast):</span>
            <span class="s1">assert_equal(f</span><span class="s0">, </span><span class="s1">b)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;start, stop, step, expected&quot;</span><span class="s0">, </span><span class="s1">[</span>
        <span class="s1">(</span><span class="s0">None, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">10j</span><span class="s0">, </span><span class="s1">(</span><span class="s2">200</span><span class="s0">, </span><span class="s2">10</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(-</span><span class="s2">10</span><span class="s0">, </span><span class="s2">20</span><span class="s0">, None, </span><span class="s1">(</span><span class="s2">1800</span><span class="s0">, </span><span class="s2">30</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_mgrid_size_none_handling(self</span><span class="s0">, </span><span class="s1">start</span><span class="s0">, </span><span class="s1">stop</span><span class="s0">, </span><span class="s1">step</span><span class="s0">, </span><span class="s1">expected):</span>
        <span class="s3"># regression test None value handling for</span>
        <span class="s3"># start and step values used by mgrid;</span>
        <span class="s3"># internally, this aims to cover previously</span>
        <span class="s3"># unexplored code paths in nd_grid()</span>
        <span class="s1">grid = mgrid[start:stop:step</span><span class="s0">, </span><span class="s1">start:stop:step]</span>
        <span class="s3"># need a smaller grid to explore one of the</span>
        <span class="s3"># untested code paths</span>
        <span class="s1">grid_small = mgrid[start:stop:step]</span>
        <span class="s1">assert_equal(grid.size</span><span class="s0">, </span><span class="s1">expected[</span><span class="s2">0</span><span class="s1">])</span>
        <span class="s1">assert_equal(grid_small.size</span><span class="s0">, </span><span class="s1">expected[</span><span class="s2">1</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_accepts_npfloating(self):</span>
        <span class="s3"># regression test for #16466</span>
        <span class="s1">grid64 = mgrid[</span><span class="s2">0.1</span><span class="s1">:</span><span class="s2">0.33</span><span class="s1">:</span><span class="s2">0.1</span><span class="s0">, </span><span class="s1">]</span>
        <span class="s1">grid32 = mgrid[np.float32(</span><span class="s2">0.1</span><span class="s1">):np.float32(</span><span class="s2">0.33</span><span class="s1">):np.float32(</span><span class="s2">0.1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">]</span>
        <span class="s1">assert_(grid32.dtype == np.float64)</span>
        <span class="s1">assert_array_almost_equal(grid64</span><span class="s0">, </span><span class="s1">grid32)</span>

        <span class="s3"># different code path for single slice</span>
        <span class="s1">grid64 = mgrid[</span><span class="s2">0.1</span><span class="s1">:</span><span class="s2">0.33</span><span class="s1">:</span><span class="s2">0.1</span><span class="s1">]</span>
        <span class="s1">grid32 = mgrid[np.float32(</span><span class="s2">0.1</span><span class="s1">):np.float32(</span><span class="s2">0.33</span><span class="s1">):np.float32(</span><span class="s2">0.1</span><span class="s1">)]</span>
        <span class="s1">assert_(grid32.dtype == np.float64)</span>
        <span class="s1">assert_array_almost_equal(grid64</span><span class="s0">, </span><span class="s1">grid32)</span>

    <span class="s0">def </span><span class="s1">test_accepts_npcomplexfloating(self):</span>
        <span class="s3"># Related to #16466</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">mgrid[</span><span class="s2">0.1</span><span class="s1">:</span><span class="s2">0.3</span><span class="s1">:</span><span class="s2">3j</span><span class="s0">, </span><span class="s1">]</span><span class="s0">, </span><span class="s1">mgrid[</span><span class="s2">0.1</span><span class="s1">:</span><span class="s2">0.3</span><span class="s1">:np.complex64(</span><span class="s2">3j</span><span class="s1">)</span><span class="s0">, </span><span class="s1">]</span>
        <span class="s1">)</span>

        <span class="s3"># different code path for single slice</span>
        <span class="s1">assert_array_almost_equal(</span>
            <span class="s1">mgrid[</span><span class="s2">0.1</span><span class="s1">:</span><span class="s2">0.3</span><span class="s1">:</span><span class="s2">3j</span><span class="s1">]</span><span class="s0">, </span><span class="s1">mgrid[</span><span class="s2">0.1</span><span class="s1">:</span><span class="s2">0.3</span><span class="s1">:np.complex64(</span><span class="s2">3j</span><span class="s1">)]</span>
        <span class="s1">)</span>

<span class="s0">class </span><span class="s1">TestConcatenator:</span>
    <span class="s0">def </span><span class="s1">test_1d(self):</span>
        <span class="s1">assert_array_equal(r_[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]))</span>
        <span class="s1">b = np.ones(</span><span class="s2">5</span><span class="s1">)</span>
        <span class="s1">c = r_[b</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">b]</span>
        <span class="s1">assert_array_equal(c</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_mixed_type(self):</span>
        <span class="s1">g = r_[</span><span class="s2">10.1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">:</span><span class="s2">10</span><span class="s1">]</span>
        <span class="s1">assert_(g.dtype == </span><span class="s4">'f8'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_more_mixed_type(self):</span>
        <span class="s1">g = r_[-</span><span class="s2">10.1</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s2">1</span><span class="s1">])</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">])</span><span class="s0">, </span><span class="s2">10.0</span><span class="s1">]</span>
        <span class="s1">assert_(g.dtype == </span><span class="s4">'f8'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_complex_step(self):</span>
        <span class="s3"># Regression test for #12262</span>
        <span class="s1">g = r_[</span><span class="s2">0</span><span class="s1">:</span><span class="s2">36</span><span class="s1">:</span><span class="s2">100j</span><span class="s1">]</span>
        <span class="s1">assert_(g.shape == (</span><span class="s2">100</span><span class="s0">,</span><span class="s1">))</span>

        <span class="s3"># Related to #16466</span>
        <span class="s1">g = r_[</span><span class="s2">0</span><span class="s1">:</span><span class="s2">36</span><span class="s1">:np.complex64(</span><span class="s2">100j</span><span class="s1">)]</span>
        <span class="s1">assert_(g.shape == (</span><span class="s2">100</span><span class="s0">,</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_2d(self):</span>
        <span class="s1">b = np.random.rand(</span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span>
        <span class="s1">c = np.random.rand(</span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span>
        <span class="s1">d = r_[</span><span class="s4">'1'</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">c]  </span><span class="s3"># append columns</span>
        <span class="s1">assert_(d.shape == (</span><span class="s2">5</span><span class="s0">, </span><span class="s2">10</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(d[:</span><span class="s0">, </span><span class="s1">:</span><span class="s2">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">b)</span>
        <span class="s1">assert_array_equal(d[:</span><span class="s0">, </span><span class="s2">5</span><span class="s1">:]</span><span class="s0">, </span><span class="s1">c)</span>
        <span class="s1">d = r_[b</span><span class="s0">, </span><span class="s1">c]</span>
        <span class="s1">assert_(d.shape == (</span><span class="s2">10</span><span class="s0">, </span><span class="s2">5</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(d[:</span><span class="s2">5</span><span class="s0">, </span><span class="s1">:]</span><span class="s0">, </span><span class="s1">b)</span>
        <span class="s1">assert_array_equal(d[</span><span class="s2">5</span><span class="s1">:</span><span class="s0">, </span><span class="s1">:]</span><span class="s0">, </span><span class="s1">c)</span>

    <span class="s0">def </span><span class="s1">test_0d(self):</span>
        <span class="s1">assert_equal(r_[</span><span class="s2">0</span><span class="s0">, </span><span class="s1">np.array(</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">assert_equal(r_[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">np.array(</span><span class="s2">3</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span>
        <span class="s1">assert_equal(r_[np.array(</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span>


<span class="s0">class </span><span class="s1">TestNdenumerate:</span>
    <span class="s0">def </span><span class="s1">test_basic(self):</span>
        <span class="s1">a = np.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]])</span>
        <span class="s1">assert_equal(list(ndenumerate(a))</span><span class="s0">,</span>
                     <span class="s1">[((</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">((</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">((</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">((</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)])</span>


<span class="s0">class </span><span class="s1">TestIndexExpression:</span>
    <span class="s0">def </span><span class="s1">test_regression_1(self):</span>
        <span class="s3"># ticket #1196</span>
        <span class="s1">a = np.arange(</span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">assert_equal(a[:-</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">a[s_[:-</span><span class="s2">1</span><span class="s1">]])</span>
        <span class="s1">assert_equal(a[:-</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">a[index_exp[:-</span><span class="s2">1</span><span class="s1">]])</span>

    <span class="s0">def </span><span class="s1">test_simple_1(self):</span>
        <span class="s1">a = np.random.rand(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s1">)</span>

        <span class="s1">assert_equal(a[:</span><span class="s0">, </span><span class="s1">:</span><span class="s2">3</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">a[index_exp[:</span><span class="s0">, </span><span class="s1">:</span><span class="s2">3</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]]])</span>
        <span class="s1">assert_equal(a[:</span><span class="s0">, </span><span class="s1">:</span><span class="s2">3</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">a[s_[:</span><span class="s0">, </span><span class="s1">:</span><span class="s2">3</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]]])</span>


<span class="s0">class </span><span class="s1">TestIx_:</span>
    <span class="s0">def </span><span class="s1">test_regression_1(self):</span>
        <span class="s3"># Test empty untyped inputs create outputs of indexing type, gh-5804</span>
        <span class="s1">a</span><span class="s0">, </span><span class="s1">= np.ix_(range(</span><span class="s2">0</span><span class="s1">))</span>
        <span class="s1">assert_equal(a.dtype</span><span class="s0">, </span><span class="s1">np.intp)</span>

        <span class="s1">a</span><span class="s0">, </span><span class="s1">= np.ix_([])</span>
        <span class="s1">assert_equal(a.dtype</span><span class="s0">, </span><span class="s1">np.intp)</span>

        <span class="s3"># but if the type is specified, don't change it</span>
        <span class="s1">a</span><span class="s0">, </span><span class="s1">= np.ix_(np.array([]</span><span class="s0">, </span><span class="s1">dtype=np.float32))</span>
        <span class="s1">assert_equal(a.dtype</span><span class="s0">, </span><span class="s1">np.float32)</span>

    <span class="s0">def </span><span class="s1">test_shape_and_dtype(self):</span>
        <span class="s1">sizes = (</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
        <span class="s3"># Test both lists and arrays</span>
        <span class="s0">for </span><span class="s1">func </span><span class="s0">in </span><span class="s1">(range</span><span class="s0">, </span><span class="s1">np.arange):</span>
            <span class="s1">arrays = np.ix_(*[func(sz) </span><span class="s0">for </span><span class="s1">sz </span><span class="s0">in </span><span class="s1">sizes])</span>
            <span class="s0">for </span><span class="s1">k</span><span class="s0">, </span><span class="s1">(a</span><span class="s0">, </span><span class="s1">sz) </span><span class="s0">in </span><span class="s1">enumerate(zip(arrays</span><span class="s0">, </span><span class="s1">sizes)):</span>
                <span class="s1">assert_equal(a.shape[k]</span><span class="s0">, </span><span class="s1">sz)</span>
                <span class="s1">assert_(all(sh == </span><span class="s2">1 </span><span class="s0">for </span><span class="s1">j</span><span class="s0">, </span><span class="s1">sh </span><span class="s0">in </span><span class="s1">enumerate(a.shape) </span><span class="s0">if </span><span class="s1">j != k))</span>
                <span class="s1">assert_(np.issubdtype(a.dtype</span><span class="s0">, </span><span class="s1">np.integer))</span>

    <span class="s0">def </span><span class="s1">test_bool(self):</span>
        <span class="s1">bool_a = [</span><span class="s0">True, False, True, True</span><span class="s1">]</span>
        <span class="s1">int_a</span><span class="s0">, </span><span class="s1">= np.nonzero(bool_a)</span>
        <span class="s1">assert_equal(np.ix_(bool_a)[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">int_a)</span>

    <span class="s0">def </span><span class="s1">test_1d_only(self):</span>
        <span class="s1">idx2d = [[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]]</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">np.ix_</span><span class="s0">, </span><span class="s1">idx2d)</span>

    <span class="s0">def </span><span class="s1">test_repeated_input(self):</span>
        <span class="s1">length_of_vector = </span><span class="s2">5</span>
        <span class="s1">x = np.arange(length_of_vector)</span>
        <span class="s1">out = ix_(x</span><span class="s0">, </span><span class="s1">x)</span>
        <span class="s1">assert_equal(out[</span><span class="s2">0</span><span class="s1">].shape</span><span class="s0">, </span><span class="s1">(length_of_vector</span><span class="s0">, </span><span class="s2">1</span><span class="s1">))</span>
        <span class="s1">assert_equal(out[</span><span class="s2">1</span><span class="s1">].shape</span><span class="s0">, </span><span class="s1">(</span><span class="s2">1</span><span class="s0">, </span><span class="s1">length_of_vector))</span>
        <span class="s3"># check that input shape is not modified</span>
        <span class="s1">assert_equal(x.shape</span><span class="s0">, </span><span class="s1">(length_of_vector</span><span class="s0">,</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_c_():</span>
    <span class="s1">a = np.c_[np.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]])</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">np.array([[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]])]</span>
    <span class="s1">assert_equal(a</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]])</span>


<span class="s0">class </span><span class="s1">TestFillDiagonal:</span>
    <span class="s0">def </span><span class="s1">test_basic(self):</span>
        <span class="s1">a = np.zeros((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">int)</span>
        <span class="s1">fill_diagonal(a</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(</span>
            <span class="s1">a</span><span class="s0">, </span><span class="s1">np.array([[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]])</span>
            <span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_tall_matrix(self):</span>
        <span class="s1">a = np.zeros((</span><span class="s2">10</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">int)</span>
        <span class="s1">fill_diagonal(a</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(</span>
            <span class="s1">a</span><span class="s0">, </span><span class="s1">np.array([[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]])</span>
            <span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_tall_matrix_wrap(self):</span>
        <span class="s1">a = np.zeros((</span><span class="s2">10</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">int)</span>
        <span class="s1">fill_diagonal(a</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, True</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(</span>
            <span class="s1">a</span><span class="s0">, </span><span class="s1">np.array([[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]])</span>
            <span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_wide_matrix(self):</span>
        <span class="s1">a = np.zeros((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">int)</span>
        <span class="s1">fill_diagonal(a</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(</span>
            <span class="s1">a</span><span class="s0">, </span><span class="s1">np.array([[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]])</span>
            <span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_operate_4d_array(self):</span>
        <span class="s1">a = np.zeros((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">int)</span>
        <span class="s1">fill_diagonal(a</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span>
        <span class="s1">i = np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">assert_equal(np.where(a != </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(i</span><span class="s0">, </span><span class="s1">i</span><span class="s0">, </span><span class="s1">i</span><span class="s0">, </span><span class="s1">i))</span>

    <span class="s0">def </span><span class="s1">test_low_dim_handling(self):</span>
        <span class="s3"># raise error with low dimensionality</span>
        <span class="s1">a = np.zeros(</span><span class="s2">3</span><span class="s0">, </span><span class="s1">int)</span>
        <span class="s0">with </span><span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s4">&quot;at least 2-d&quot;</span><span class="s1">):</span>
            <span class="s1">fill_diagonal(a</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_hetero_shape_handling(self):</span>
        <span class="s3"># raise error with high dimensionality and</span>
        <span class="s3"># shape mismatch</span>
        <span class="s1">a = np.zeros((</span><span class="s2">3</span><span class="s0">,</span><span class="s2">3</span><span class="s0">,</span><span class="s2">7</span><span class="s0">,</span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">int)</span>
        <span class="s0">with </span><span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s4">&quot;equal length&quot;</span><span class="s1">):</span>
            <span class="s1">fill_diagonal(a</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_diag_indices():</span>
    <span class="s1">di = diag_indices(</span><span class="s2">4</span><span class="s1">)</span>
    <span class="s1">a = np.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">[</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">[</span><span class="s2">13</span><span class="s0">, </span><span class="s2">14</span><span class="s0">, </span><span class="s2">15</span><span class="s0">, </span><span class="s2">16</span><span class="s1">]])</span>
    <span class="s1">a[di] = </span><span class="s2">100</span>
    <span class="s1">assert_array_equal(</span>
        <span class="s1">a</span><span class="s0">, </span><span class="s1">np.array([[</span><span class="s2">100</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                     <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">100</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                     <span class="s1">[</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">100</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]</span><span class="s0">,</span>
                     <span class="s1">[</span><span class="s2">13</span><span class="s0">, </span><span class="s2">14</span><span class="s0">, </span><span class="s2">15</span><span class="s0">, </span><span class="s2">100</span><span class="s1">]])</span>
        <span class="s1">)</span>

    <span class="s3"># Now, we create indices to manipulate a 3-d array:</span>
    <span class="s1">d3 = diag_indices(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span>

    <span class="s3"># And use it to set the diagonal of a zeros array to 1:</span>
    <span class="s1">a = np.zeros((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">int)</span>
    <span class="s1">a[d3] = </span><span class="s2">1</span>
    <span class="s1">assert_array_equal(</span>
        <span class="s1">a</span><span class="s0">, </span><span class="s1">np.array([[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                      <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]</span><span class="s0">,</span>
                     <span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                      <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]])</span>
        <span class="s1">)</span>


<span class="s0">class </span><span class="s1">TestDiagIndicesFrom:</span>

    <span class="s0">def </span><span class="s1">test_diag_indices_from(self):</span>
        <span class="s1">x = np.random.random((</span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">))</span>
        <span class="s1">r</span><span class="s0">, </span><span class="s1">c = diag_indices_from(x)</span>
        <span class="s1">assert_array_equal(r</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s2">4</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(c</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s2">4</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_error_small_input(self):</span>
        <span class="s1">x = np.ones(</span><span class="s2">7</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s4">&quot;at least 2-d&quot;</span><span class="s1">):</span>
            <span class="s1">diag_indices_from(x)</span>

    <span class="s0">def </span><span class="s1">test_error_shape_mismatch(self):</span>
        <span class="s1">x = np.zeros((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">int)</span>
        <span class="s0">with </span><span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s4">&quot;equal length&quot;</span><span class="s1">):</span>
            <span class="s1">diag_indices_from(x)</span>


<span class="s0">def </span><span class="s1">test_ndindex():</span>
    <span class="s1">x = list(ndindex(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>
    <span class="s1">expected = [ix </span><span class="s0">for </span><span class="s1">ix</span><span class="s0">, </span><span class="s1">e </span><span class="s0">in </span><span class="s1">ndenumerate(np.zeros((</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)))]</span>
    <span class="s1">assert_array_equal(x</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">x = list(ndindex((</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)))</span>
    <span class="s1">assert_array_equal(x</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s3"># Test use of scalars and tuples</span>
    <span class="s1">x = list(ndindex((</span><span class="s2">3</span><span class="s0">,</span><span class="s1">)))</span>
    <span class="s1">assert_array_equal(x</span><span class="s0">, </span><span class="s1">list(ndindex(</span><span class="s2">3</span><span class="s1">)))</span>

    <span class="s3"># Make sure size argument is optional</span>
    <span class="s1">x = list(ndindex())</span>
    <span class="s1">assert_equal(x</span><span class="s0">, </span><span class="s1">[()])</span>

    <span class="s1">x = list(ndindex(()))</span>
    <span class="s1">assert_equal(x</span><span class="s0">, </span><span class="s1">[()])</span>

    <span class="s3"># Make sure 0-sized ndindex works correctly</span>
    <span class="s1">x = list(ndindex(*[</span><span class="s2">0</span><span class="s1">]))</span>
    <span class="s1">assert_equal(x</span><span class="s0">, </span><span class="s1">[])</span>
</pre>
</body>
</html>