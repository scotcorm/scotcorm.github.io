<html>
<head>
<title>test_to_latex.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_to_latex.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">textwrap </span><span class="s0">import </span><span class="s1">dedent</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">DataFrame</span><span class="s0">,</span>
    <span class="s1">MultiIndex</span><span class="s0">,</span>
    <span class="s1">option_context</span><span class="s0">,</span>
<span class="s1">)</span>

<span class="s1">pytest.importorskip(</span><span class="s2">&quot;jinja2&quot;</span><span class="s1">)</span>
<span class="s0">from </span><span class="s1">pandas.io.formats.style </span><span class="s0">import </span><span class="s1">Styler</span>
<span class="s0">from </span><span class="s1">pandas.io.formats.style_render </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">_parse_latex_cell_styles</span><span class="s0">,</span>
    <span class="s1">_parse_latex_css_conversion</span><span class="s0">,</span>
    <span class="s1">_parse_latex_header_span</span><span class="s0">,</span>
    <span class="s1">_parse_latex_table_styles</span><span class="s0">,</span>
    <span class="s1">_parse_latex_table_wrapping</span><span class="s0">,</span>
<span class="s1">)</span>


<span class="s1">@pytest.fixture</span>
<span class="s0">def </span><span class="s1">df():</span>
    <span class="s0">return </span><span class="s1">DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: [-</span><span class="s3">0.61</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.22</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s1">: [</span><span class="s2">&quot;ab&quot;</span><span class="s0">, </span><span class="s2">&quot;cd&quot;</span><span class="s1">]})</span>


<span class="s1">@pytest.fixture</span>
<span class="s0">def </span><span class="s1">df_ext():</span>
    <span class="s0">return </span><span class="s1">DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: [-</span><span class="s3">0.61</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.22</span><span class="s0">, </span><span class="s1">-</span><span class="s3">2.22</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s1">: [</span><span class="s2">&quot;ab&quot;</span><span class="s0">, </span><span class="s2">&quot;cd&quot;</span><span class="s0">, </span><span class="s2">&quot;de&quot;</span><span class="s1">]}</span>
    <span class="s1">)</span>


<span class="s1">@pytest.fixture</span>
<span class="s0">def </span><span class="s1">styler(df):</span>
    <span class="s0">return </span><span class="s1">Styler(df</span><span class="s0">, </span><span class="s1">uuid_len=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">precision=</span><span class="s3">2</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_minimal_latex_tabular(styler):</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s2">begin{tabular}{lrrl} 
         &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s2">0 &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s2">1 &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">styler.to_latex() == expected</span>


<span class="s0">def </span><span class="s1">test_tabular_hrules(styler):</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s2">begin{tabular}{lrrl} 
        </span><span class="s0">\\</span><span class="s2">toprule 
         &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">midrule 
        0 &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s2">1 &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">bottomrule 
        </span><span class="s0">\\</span><span class="s2">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">styler.to_latex(hrules=</span><span class="s0">True</span><span class="s1">) == expected</span>


<span class="s0">def </span><span class="s1">test_tabular_custom_hrules(styler):</span>
    <span class="s1">styler.set_table_styles(</span>
        <span class="s1">[</span>
            <span class="s1">{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;toprule&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: </span><span class="s2">&quot;:hline&quot;</span><span class="s1">}</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;bottomrule&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: </span><span class="s2">&quot;:otherline&quot;</span><span class="s1">}</span><span class="s0">,</span>
        <span class="s1">]</span>
    <span class="s1">)  </span><span class="s4"># no midrule</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s2">begin{tabular}{lrrl} 
        </span><span class="s0">\\</span><span class="s2">hline 
         &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s2">0 &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s2">1 &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">otherline 
        </span><span class="s0">\\</span><span class="s2">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">styler.to_latex() == expected</span>


<span class="s0">def </span><span class="s1">test_column_format(styler):</span>
    <span class="s4"># default setting is already tested in `test_latex_minimal_tabular`</span>
    <span class="s1">styler.set_table_styles([{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;column_format&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: </span><span class="s2">&quot;:cccc&quot;</span><span class="s1">}])</span>

    <span class="s0">assert </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">begin{tabular}{rrrr}&quot; </span><span class="s0">in </span><span class="s1">styler.to_latex(column_format=</span><span class="s2">&quot;rrrr&quot;</span><span class="s1">)</span>
    <span class="s1">styler.set_table_styles([{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;column_format&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: </span><span class="s2">&quot;:r|r|cc&quot;</span><span class="s1">}])</span>
    <span class="s0">assert </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">begin{tabular}{r|r|cc}&quot; </span><span class="s0">in </span><span class="s1">styler.to_latex()</span>


<span class="s0">def </span><span class="s1">test_siunitx_cols(styler):</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s2">begin{tabular}{lSSl} 
        {} &amp; {A} &amp; {B} &amp; {C} </span><span class="s0">\\\\</span>
        <span class="s2">0 &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s2">1 &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">styler.to_latex(siunitx=</span><span class="s0">True</span><span class="s1">) == expected</span>


<span class="s0">def </span><span class="s1">test_position(styler):</span>
    <span class="s0">assert </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">begin{table}[h!]&quot; </span><span class="s0">in </span><span class="s1">styler.to_latex(position=</span><span class="s2">&quot;h!&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">end{table}&quot; </span><span class="s0">in </span><span class="s1">styler.to_latex(position=</span><span class="s2">&quot;h!&quot;</span><span class="s1">)</span>
    <span class="s1">styler.set_table_styles([{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;position&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: </span><span class="s2">&quot;:b!&quot;</span><span class="s1">}])</span>
    <span class="s0">assert </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">begin{table}[b!]&quot; </span><span class="s0">in </span><span class="s1">styler.to_latex()</span>
    <span class="s0">assert </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">end{table}&quot; </span><span class="s0">in </span><span class="s1">styler.to_latex()</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;env&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s2">&quot;longtable&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_label(styler</span><span class="s0">, </span><span class="s1">env):</span>
    <span class="s0">assert </span><span class="s2">&quot;</span><span class="s0">\n\\</span><span class="s2">label{text}&quot; </span><span class="s0">in </span><span class="s1">styler.to_latex(label=</span><span class="s2">&quot;text&quot;</span><span class="s0">, </span><span class="s1">environment=env)</span>
    <span class="s1">styler.set_table_styles([{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;label&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: </span><span class="s2">&quot;:{more §text}&quot;</span><span class="s1">}])</span>
    <span class="s0">assert </span><span class="s2">&quot;</span><span class="s0">\n\\</span><span class="s2">label{more :text}&quot; </span><span class="s0">in </span><span class="s1">styler.to_latex(environment=env)</span>


<span class="s0">def </span><span class="s1">test_position_float_raises(styler):</span>
    <span class="s1">msg = </span><span class="s2">&quot;`position_float` should be one of 'raggedright', 'raggedleft', 'centering',&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">styler.to_latex(position_float=</span><span class="s2">&quot;bad_string&quot;</span><span class="s1">)</span>

    <span class="s1">msg = </span><span class="s2">&quot;`position_float` cannot be used in 'longtable' `environment`&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">styler.to_latex(position_float=</span><span class="s2">&quot;centering&quot;</span><span class="s0">, </span><span class="s1">environment=</span><span class="s2">&quot;longtable&quot;</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;label&quot;</span><span class="s0">, </span><span class="s1">[(</span><span class="s0">None, </span><span class="s2">&quot;&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;text&quot;</span><span class="s0">, </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">label{text}&quot;</span><span class="s1">)])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;position&quot;</span><span class="s0">, </span><span class="s1">[(</span><span class="s0">None, </span><span class="s2">&quot;&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;h!&quot;</span><span class="s0">, </span><span class="s2">&quot;{table}[h!]&quot;</span><span class="s1">)])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;caption&quot;</span><span class="s0">, </span><span class="s1">[(</span><span class="s0">None, </span><span class="s2">&quot;&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;text&quot;</span><span class="s0">, </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">caption{text}&quot;</span><span class="s1">)])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;column_format&quot;</span><span class="s0">, </span><span class="s1">[(</span><span class="s0">None, </span><span class="s2">&quot;&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;rcrl&quot;</span><span class="s0">, </span><span class="s2">&quot;{tabular}{rcrl}&quot;</span><span class="s1">)])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;position_float&quot;</span><span class="s0">, </span><span class="s1">[(</span><span class="s0">None, </span><span class="s2">&quot;&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;centering&quot;</span><span class="s0">, </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">centering&quot;</span><span class="s1">)])</span>
<span class="s0">def </span><span class="s1">test_kwargs_combinations(</span>
    <span class="s1">styler</span><span class="s0">, </span><span class="s1">label</span><span class="s0">, </span><span class="s1">position</span><span class="s0">, </span><span class="s1">caption</span><span class="s0">, </span><span class="s1">column_format</span><span class="s0">, </span><span class="s1">position_float</span>
<span class="s1">):</span>
    <span class="s1">result = styler.to_latex(</span>
        <span class="s1">label=label[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">position=position[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">caption=caption[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">column_format=column_format[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">position_float=position_float[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">label[</span><span class="s3">1</span><span class="s1">] </span><span class="s0">in </span><span class="s1">result</span>
    <span class="s0">assert </span><span class="s1">position[</span><span class="s3">1</span><span class="s1">] </span><span class="s0">in </span><span class="s1">result</span>
    <span class="s0">assert </span><span class="s1">caption[</span><span class="s3">1</span><span class="s1">] </span><span class="s0">in </span><span class="s1">result</span>
    <span class="s0">assert </span><span class="s1">column_format[</span><span class="s3">1</span><span class="s1">] </span><span class="s0">in </span><span class="s1">result</span>
    <span class="s0">assert </span><span class="s1">position_float[</span><span class="s3">1</span><span class="s1">] </span><span class="s0">in </span><span class="s1">result</span>


<span class="s0">def </span><span class="s1">test_custom_table_styles(styler):</span>
    <span class="s1">styler.set_table_styles(</span>
        <span class="s1">[</span>
            <span class="s1">{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;mycommand&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: </span><span class="s2">&quot;:{myoptions}&quot;</span><span class="s1">}</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;mycommand2&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: </span><span class="s2">&quot;:{myoptions2}&quot;</span><span class="s1">}</span><span class="s0">,</span>
        <span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s2">begin{table} 
        </span><span class="s0">\\</span><span class="s2">mycommand{myoptions} 
        </span><span class="s0">\\</span><span class="s2">mycommand2{myoptions2} 
        &quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">styler.to_latex()</span>


<span class="s0">def </span><span class="s1">test_cell_styling(styler):</span>
    <span class="s1">styler.highlight_max(props=</span><span class="s2">&quot;itshape:;Huge:--wrap;&quot;</span><span class="s1">)</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s2">begin{tabular}{lrrl} 
         &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s2">0 &amp; 0 &amp; </span><span class="s0">\\</span><span class="s2">itshape {</span><span class="s0">\\</span><span class="s2">Huge -0.61} &amp; ab </span><span class="s0">\\\\</span>
        <span class="s2">1 &amp; </span><span class="s0">\\</span><span class="s2">itshape {</span><span class="s0">\\</span><span class="s2">Huge 1} &amp; -1.22 &amp; </span><span class="s0">\\</span><span class="s2">itshape {</span><span class="s0">\\</span><span class="s2">Huge cd} </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">expected == styler.to_latex()</span>


<span class="s0">def </span><span class="s1">test_multiindex_columns(df):</span>
    <span class="s1">cidx = MultiIndex.from_tuples([(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">)])</span>
    <span class="s1">df.columns = cidx</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s2">begin{tabular}{lrrl} 
         &amp; </span><span class="s0">\\</span><span class="s2">multicolumn{2}{r}{A} &amp; B </span><span class="s0">\\\\</span>
         <span class="s2">&amp; a &amp; b &amp; c </span><span class="s0">\\\\</span>
        <span class="s2">0 &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s2">1 &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s1">s = df.style.format(precision=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">expected == s.to_latex()</span>

    <span class="s4"># non-sparse</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s2">begin{tabular}{lrrl} 
         &amp; A &amp; A &amp; B </span><span class="s0">\\\\</span>
         <span class="s2">&amp; a &amp; b &amp; c </span><span class="s0">\\\\</span>
        <span class="s2">0 &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s2">1 &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s1">s = df.style.format(precision=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">expected == s.to_latex(sparse_columns=</span><span class="s0">False</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_multiindex_row(df_ext):</span>
    <span class="s1">ridx = MultiIndex.from_tuples([(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">)])</span>
    <span class="s1">df_ext.index = ridx</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s2">begin{tabular}{llrrl} 
         &amp;  &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">multirow[c]{2}{*}{A} &amp; a &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
         <span class="s2">&amp; b &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s2">B &amp; c &amp; 2 &amp; -2.22 &amp; de </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s1">styler = df_ext.style.format(precision=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">result = styler.to_latex()</span>
    <span class="s0">assert </span><span class="s1">expected == result</span>

    <span class="s4"># non-sparse</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s2">begin{tabular}{llrrl} 
         &amp;  &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s2">A &amp; a &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s2">A &amp; b &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s2">B &amp; c &amp; 2 &amp; -2.22 &amp; de </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s1">result = styler.to_latex(sparse_index=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">expected == result</span>


<span class="s0">def </span><span class="s1">test_multirow_naive(df_ext):</span>
    <span class="s1">ridx = MultiIndex.from_tuples([(</span><span class="s2">&quot;X&quot;</span><span class="s0">, </span><span class="s2">&quot;x&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;X&quot;</span><span class="s0">, </span><span class="s2">&quot;y&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;Y&quot;</span><span class="s0">, </span><span class="s2">&quot;z&quot;</span><span class="s1">)])</span>
    <span class="s1">df_ext.index = ridx</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s2">begin{tabular}{llrrl} 
         &amp;  &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s2">X &amp; x &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
         <span class="s2">&amp; y &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s2">Y &amp; z &amp; 2 &amp; -2.22 &amp; de </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s1">styler = df_ext.style.format(precision=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">result = styler.to_latex(multirow_align=</span><span class="s2">&quot;naive&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">expected == result</span>


<span class="s0">def </span><span class="s1">test_multiindex_row_and_col(df_ext):</span>
    <span class="s1">cidx = MultiIndex.from_tuples([(</span><span class="s2">&quot;Z&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;Z&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;Y&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">)])</span>
    <span class="s1">ridx = MultiIndex.from_tuples([(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">)])</span>
    <span class="s1">df_ext.index</span><span class="s0">, </span><span class="s1">df_ext.columns = ridx</span><span class="s0">, </span><span class="s1">cidx</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s2">begin{tabular}{llrrl} 
         &amp;  &amp; </span><span class="s0">\\</span><span class="s2">multicolumn{2}{l}{Z} &amp; Y </span><span class="s0">\\\\</span>
         <span class="s2">&amp;  &amp; a &amp; b &amp; c </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">multirow[b]{2}{*}{A} &amp; a &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
         <span class="s2">&amp; b &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s2">B &amp; c &amp; 2 &amp; -2.22 &amp; de </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s1">styler = df_ext.style.format(precision=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">result = styler.to_latex(multirow_align=</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s1">multicol_align=</span><span class="s2">&quot;l&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s4"># non-sparse</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s2">begin{tabular}{llrrl} 
         &amp;  &amp; Z &amp; Z &amp; Y </span><span class="s0">\\\\</span>
         <span class="s2">&amp;  &amp; a &amp; b &amp; c </span><span class="s0">\\\\</span>
        <span class="s2">A &amp; a &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s2">A &amp; b &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s2">B &amp; c &amp; 2 &amp; -2.22 &amp; de </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s1">result = styler.to_latex(sparse_index=</span><span class="s0">False, </span><span class="s1">sparse_columns=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">result == expected</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;multicol_align, siunitx, header&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s2">&quot;naive-l&quot;</span><span class="s0">, False, </span><span class="s2">&quot; &amp; A &amp; &amp;&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;naive-r&quot;</span><span class="s0">, False, </span><span class="s2">&quot; &amp; &amp; &amp; A&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;naive-l&quot;</span><span class="s0">, True, </span><span class="s2">&quot;{} &amp; {A} &amp; {} &amp; {}&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;naive-r&quot;</span><span class="s0">, True, </span><span class="s2">&quot;{} &amp; {} &amp; {} &amp; {A}&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_multicol_naive(df</span><span class="s0">, </span><span class="s1">multicol_align</span><span class="s0">, </span><span class="s1">siunitx</span><span class="s0">, </span><span class="s1">header):</span>
    <span class="s1">ridx = MultiIndex.from_tuples([(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">)])</span>
    <span class="s1">df.columns = ridx</span>
    <span class="s1">level1 = </span><span class="s2">&quot; &amp; a &amp; b &amp; c&quot; </span><span class="s0">if not </span><span class="s1">siunitx </span><span class="s0">else </span><span class="s2">&quot;{} &amp; {a} &amp; {b} &amp; {c}&quot;</span>
    <span class="s1">col_format = </span><span class="s2">&quot;lrrl&quot; </span><span class="s0">if not </span><span class="s1">siunitx </span><span class="s0">else </span><span class="s2">&quot;lSSl&quot;</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">f&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s2">begin</span><span class="s0">{{</span><span class="s2">tabular</span><span class="s0">}}{{{</span><span class="s1">col_format</span><span class="s0">}}}</span>
        <span class="s0">{</span><span class="s1">header</span><span class="s0">} \\\\</span>
        <span class="s0">{</span><span class="s1">level1</span><span class="s0">} \\\\</span>
        <span class="s2">0 &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s2">1 &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">end</span><span class="s0">{{</span><span class="s2">tabular</span><span class="s0">}}</span>
        <span class="s2">&quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s1">styler = df.style.format(precision=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">result = styler.to_latex(multicol_align=multicol_align</span><span class="s0">, </span><span class="s1">siunitx=siunitx)</span>
    <span class="s0">assert </span><span class="s1">expected == result</span>


<span class="s0">def </span><span class="s1">test_multi_options(df_ext):</span>
    <span class="s1">cidx = MultiIndex.from_tuples([(</span><span class="s2">&quot;Z&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;Z&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;Y&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">)])</span>
    <span class="s1">ridx = MultiIndex.from_tuples([(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">)])</span>
    <span class="s1">df_ext.index</span><span class="s0">, </span><span class="s1">df_ext.columns = ridx</span><span class="s0">, </span><span class="s1">cidx</span>
    <span class="s1">styler = df_ext.style.format(precision=</span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">expected = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
     </span><span class="s2">&amp;  &amp; </span><span class="s0">\\</span><span class="s2">multicolumn{2}{r}{Z} &amp; Y </span><span class="s0">\\\\</span>
     <span class="s2">&amp;  &amp; a &amp; b &amp; c </span><span class="s0">\\\\</span>
    <span class="s0">\\</span><span class="s2">multirow[c]{2}{*}{A} &amp; a &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
    <span class="s2">&quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s1">result = styler.to_latex()</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">result</span>

    <span class="s0">with </span><span class="s1">option_context(</span><span class="s2">&quot;styler.latex.multicol_align&quot;</span><span class="s0">, </span><span class="s2">&quot;l&quot;</span><span class="s1">):</span>
        <span class="s0">assert </span><span class="s2">&quot; &amp;  &amp; </span><span class="s0">\\</span><span class="s2">multicolumn{2}{l}{Z} &amp; Y </span><span class="s0">\\\\</span><span class="s2">&quot; </span><span class="s0">in </span><span class="s1">styler.to_latex()</span>

    <span class="s0">with </span><span class="s1">option_context(</span><span class="s2">&quot;styler.latex.multirow_align&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">):</span>
        <span class="s0">assert </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">multirow[b]{2}{*}{A} &amp; a &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span><span class="s2">&quot; </span><span class="s0">in </span><span class="s1">styler.to_latex()</span>


<span class="s0">def </span><span class="s1">test_multiindex_columns_hidden():</span>
    <span class="s1">df = DataFrame([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]])</span>
    <span class="s1">df.columns = MultiIndex.from_tuples([(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)])</span>
    <span class="s1">s = df.style</span>
    <span class="s0">assert </span><span class="s2">&quot;{tabular}{lrrrr}&quot; </span><span class="s0">in </span><span class="s1">s.to_latex()</span>
    <span class="s1">s.set_table_styles([])  </span><span class="s4"># reset the position command</span>
    <span class="s1">s.hide([(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s2">&quot;columns&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s2">&quot;{tabular}{lrrr}&quot; </span><span class="s0">in </span><span class="s1">s.to_latex()</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;option, value&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s2">&quot;styler.sparse.index&quot;</span><span class="s0">, True</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;styler.sparse.index&quot;</span><span class="s0">, False</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;styler.sparse.columns&quot;</span><span class="s0">, True</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;styler.sparse.columns&quot;</span><span class="s0">, False</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_sparse_options(df_ext</span><span class="s0">, </span><span class="s1">option</span><span class="s0">, </span><span class="s1">value):</span>
    <span class="s1">cidx = MultiIndex.from_tuples([(</span><span class="s2">&quot;Z&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;Z&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;Y&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">)])</span>
    <span class="s1">ridx = MultiIndex.from_tuples([(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">)])</span>
    <span class="s1">df_ext.index</span><span class="s0">, </span><span class="s1">df_ext.columns = ridx</span><span class="s0">, </span><span class="s1">cidx</span>
    <span class="s1">styler = df_ext.style</span>

    <span class="s1">latex1 = styler.to_latex()</span>
    <span class="s0">with </span><span class="s1">option_context(option</span><span class="s0">, </span><span class="s1">value):</span>
        <span class="s1">latex2 = styler.to_latex()</span>
    <span class="s0">assert </span><span class="s1">(latex1 == latex2) </span><span class="s0">is </span><span class="s1">value</span>


<span class="s0">def </span><span class="s1">test_hidden_index(styler):</span>
    <span class="s1">styler.hide(axis=</span><span class="s2">&quot;index&quot;</span><span class="s1">)</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s2">begin{tabular}{rrl} 
        A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s2">0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s2">1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">styler.to_latex() == expected</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;environment&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;table&quot;</span><span class="s0">, </span><span class="s2">&quot;figure*&quot;</span><span class="s0">, None</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_comprehensive(df_ext</span><span class="s0">, </span><span class="s1">environment):</span>
    <span class="s4"># test as many low level features simultaneously as possible</span>
    <span class="s1">cidx = MultiIndex.from_tuples([(</span><span class="s2">&quot;Z&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;Z&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;Y&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">)])</span>
    <span class="s1">ridx = MultiIndex.from_tuples([(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">)])</span>
    <span class="s1">df_ext.index</span><span class="s0">, </span><span class="s1">df_ext.columns = ridx</span><span class="s0">, </span><span class="s1">cidx</span>
    <span class="s1">stlr = df_ext.style</span>
    <span class="s1">stlr.set_caption(</span><span class="s2">&quot;mycap&quot;</span><span class="s1">)</span>
    <span class="s1">stlr.set_table_styles(</span>
        <span class="s1">[</span>
            <span class="s1">{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;label&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: </span><span class="s2">&quot;:{fig§item}&quot;</span><span class="s1">}</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;position&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: </span><span class="s2">&quot;:h!&quot;</span><span class="s1">}</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;position_float&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: </span><span class="s2">&quot;:centering&quot;</span><span class="s1">}</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;column_format&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: </span><span class="s2">&quot;:rlrlr&quot;</span><span class="s1">}</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;toprule&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: </span><span class="s2">&quot;:toprule&quot;</span><span class="s1">}</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;midrule&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: </span><span class="s2">&quot;:midrule&quot;</span><span class="s1">}</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;bottomrule&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: </span><span class="s2">&quot;:bottomrule&quot;</span><span class="s1">}</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;rowcolors&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: </span><span class="s2">&quot;:{3}{pink}{}&quot;</span><span class="s1">}</span><span class="s0">,  </span><span class="s4"># custom command</span>
        <span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">stlr.highlight_max(axis=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">props=</span><span class="s2">&quot;textbf:--rwrap;cellcolor:[rgb]{1,1,0.6}--rwrap&quot;</span><span class="s1">)</span>
    <span class="s1">stlr.highlight_max(axis=</span><span class="s0">None, </span><span class="s1">props=</span><span class="s2">&quot;Huge:--wrap;&quot;</span><span class="s0">, </span><span class="s1">subset=[(</span><span class="s2">&quot;Z&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;Z&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">)])</span>

    <span class="s1">expected = (</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
\\</span><span class="s2">begin{table}[h!] 
</span><span class="s0">\\</span><span class="s2">centering 
</span><span class="s0">\\</span><span class="s2">caption{mycap} 
</span><span class="s0">\\</span><span class="s2">label{fig:item} 
</span><span class="s0">\\</span><span class="s2">rowcolors{3}{pink}{} 
</span><span class="s0">\\</span><span class="s2">begin{tabular}{rlrlr} 
</span><span class="s0">\\</span><span class="s2">toprule 
 &amp;  &amp; </span><span class="s0">\\</span><span class="s2">multicolumn{2}{r}{Z} &amp; Y </span><span class="s0">\\\\</span>
 <span class="s2">&amp;  &amp; a &amp; b &amp; c </span><span class="s0">\\\\</span>
<span class="s0">\\</span><span class="s2">midrule 
</span><span class="s0">\\</span><span class="s2">multirow[c]{2}{*}{A} &amp; a &amp; 0 &amp; </span><span class="s0">\\</span><span class="s2">textbf{</span><span class="s0">\\</span><span class="s2">cellcolor[rgb]{1,1,0.6}{-0.61}} &amp; ab </span><span class="s0">\\\\</span>
 <span class="s2">&amp; b &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
<span class="s2">B &amp; c &amp; </span><span class="s0">\\</span><span class="s2">textbf{</span><span class="s0">\\</span><span class="s2">cellcolor[rgb]{1,1,0.6}{{</span><span class="s0">\\</span><span class="s2">Huge 2}}} &amp; -2.22 &amp; &quot;&quot;&quot;</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
\\</span><span class="s2">textbf{</span><span class="s0">\\</span><span class="s2">cellcolor[rgb]{1,1,0.6}{de}} </span><span class="s0">\\\\</span>
<span class="s0">\\</span><span class="s2">bottomrule 
</span><span class="s0">\\</span><span class="s2">end{tabular} 
</span><span class="s0">\\</span><span class="s2">end{table} 
&quot;&quot;&quot;</span>
    <span class="s1">).replace(</span><span class="s2">&quot;table&quot;</span><span class="s0">, </span><span class="s1">environment </span><span class="s0">if </span><span class="s1">environment </span><span class="s0">else </span><span class="s2">&quot;table&quot;</span><span class="s1">)</span>
    <span class="s1">result = stlr.format(precision=</span><span class="s3">2</span><span class="s1">).to_latex(environment=environment)</span>
    <span class="s0">assert </span><span class="s1">result == expected</span>


<span class="s0">def </span><span class="s1">test_environment_option(styler):</span>
    <span class="s0">with </span><span class="s1">option_context(</span><span class="s2">&quot;styler.latex.environment&quot;</span><span class="s0">, </span><span class="s2">&quot;bar-env&quot;</span><span class="s1">):</span>
        <span class="s0">assert </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">begin{bar-env}&quot; </span><span class="s0">in </span><span class="s1">styler.to_latex()</span>
        <span class="s0">assert </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">begin{foo-env}&quot; </span><span class="s0">in </span><span class="s1">styler.to_latex(environment=</span><span class="s2">&quot;foo-env&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_parse_latex_table_styles(styler):</span>
    <span class="s1">styler.set_table_styles(</span>
        <span class="s1">[</span>
            <span class="s1">{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;foo&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: [(</span><span class="s2">&quot;attr&quot;</span><span class="s0">, </span><span class="s2">&quot;value&quot;</span><span class="s1">)]}</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;bar&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: [(</span><span class="s2">&quot;attr&quot;</span><span class="s0">, </span><span class="s2">&quot;overwritten&quot;</span><span class="s1">)]}</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;bar&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: [(</span><span class="s2">&quot;attr&quot;</span><span class="s0">, </span><span class="s2">&quot;baz&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;attr2&quot;</span><span class="s0">, </span><span class="s2">&quot;ignored&quot;</span><span class="s1">)]}</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;label&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: [(</span><span class="s2">&quot;&quot;</span><span class="s0">, </span><span class="s2">&quot;{fig§item}&quot;</span><span class="s1">)]}</span><span class="s0">,</span>
        <span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_table_styles(styler.table_styles</span><span class="s0">, </span><span class="s2">&quot;bar&quot;</span><span class="s1">) == </span><span class="s2">&quot;baz&quot;</span>

    <span class="s4"># test '§' replaced by ':' [for CSS compatibility]</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_table_styles(styler.table_styles</span><span class="s0">, </span><span class="s2">&quot;label&quot;</span><span class="s1">) == </span><span class="s2">&quot;{fig:item}&quot;</span>


<span class="s0">def </span><span class="s1">test_parse_latex_cell_styles_basic():  </span><span class="s4"># test nesting</span>
    <span class="s1">cell_style = [(</span><span class="s2">&quot;itshape&quot;</span><span class="s0">, </span><span class="s2">&quot;--rwrap&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;cellcolor&quot;</span><span class="s0">, </span><span class="s2">&quot;[rgb]{0,1,1}--rwrap&quot;</span><span class="s1">)]</span>
    <span class="s1">expected = </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">itshape{</span><span class="s0">\\</span><span class="s2">cellcolor[rgb]{0,1,1}{text}}&quot;</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_cell_styles(cell_style</span><span class="s0">, </span><span class="s2">&quot;text&quot;</span><span class="s1">) == expected</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;wrap_arg, expected&quot;</span><span class="s0">,</span>
    <span class="s1">[  </span><span class="s4"># test wrapping</span>
        <span class="s1">(</span><span class="s2">&quot;&quot;</span><span class="s0">, </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">&lt;command&gt;&lt;options&gt; &lt;display_value&gt;&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;--wrap&quot;</span><span class="s0">, </span><span class="s2">&quot;{</span><span class="s0">\\</span><span class="s2">&lt;command&gt;&lt;options&gt; &lt;display_value&gt;}&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;--nowrap&quot;</span><span class="s0">, </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">&lt;command&gt;&lt;options&gt; &lt;display_value&gt;&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;--lwrap&quot;</span><span class="s0">, </span><span class="s2">&quot;{</span><span class="s0">\\</span><span class="s2">&lt;command&gt;&lt;options&gt;} &lt;display_value&gt;&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;--dwrap&quot;</span><span class="s0">, </span><span class="s2">&quot;{</span><span class="s0">\\</span><span class="s2">&lt;command&gt;&lt;options&gt;}{&lt;display_value&gt;}&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;--rwrap&quot;</span><span class="s0">, </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">&lt;command&gt;&lt;options&gt;{&lt;display_value&gt;}&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_parse_latex_cell_styles_braces(wrap_arg</span><span class="s0">, </span><span class="s1">expected):</span>
    <span class="s1">cell_style = [(</span><span class="s2">&quot;&lt;command&gt;&quot;</span><span class="s0">, </span><span class="s2">f&quot;&lt;options&gt;</span><span class="s0">{</span><span class="s1">wrap_arg</span><span class="s0">}</span><span class="s2">&quot;</span><span class="s1">)]</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_cell_styles(cell_style</span><span class="s0">, </span><span class="s2">&quot;&lt;display_value&gt;&quot;</span><span class="s1">) == expected</span>


<span class="s0">def </span><span class="s1">test_parse_latex_header_span():</span>
    <span class="s1">cell = {</span><span class="s2">&quot;attributes&quot;</span><span class="s1">: </span><span class="s2">'colspan=&quot;3&quot;'</span><span class="s0">, </span><span class="s2">&quot;display_value&quot;</span><span class="s1">: </span><span class="s2">&quot;text&quot;</span><span class="s0">, </span><span class="s2">&quot;cellstyle&quot;</span><span class="s1">: []}</span>
    <span class="s1">expected = </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">multicolumn{3}{Y}{text}&quot;</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_header_span(cell</span><span class="s0">, </span><span class="s2">&quot;X&quot;</span><span class="s0">, </span><span class="s2">&quot;Y&quot;</span><span class="s1">) == expected</span>

    <span class="s1">cell = {</span><span class="s2">&quot;attributes&quot;</span><span class="s1">: </span><span class="s2">'rowspan=&quot;5&quot;'</span><span class="s0">, </span><span class="s2">&quot;display_value&quot;</span><span class="s1">: </span><span class="s2">&quot;text&quot;</span><span class="s0">, </span><span class="s2">&quot;cellstyle&quot;</span><span class="s1">: []}</span>
    <span class="s1">expected = </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">multirow[X]{5}{*}{text}&quot;</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_header_span(cell</span><span class="s0">, </span><span class="s2">&quot;X&quot;</span><span class="s0">, </span><span class="s2">&quot;Y&quot;</span><span class="s1">) == expected</span>

    <span class="s1">cell = {</span><span class="s2">&quot;display_value&quot;</span><span class="s1">: </span><span class="s2">&quot;text&quot;</span><span class="s0">, </span><span class="s2">&quot;cellstyle&quot;</span><span class="s1">: []}</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_header_span(cell</span><span class="s0">, </span><span class="s2">&quot;X&quot;</span><span class="s0">, </span><span class="s2">&quot;Y&quot;</span><span class="s1">) == </span><span class="s2">&quot;text&quot;</span>

    <span class="s1">cell = {</span><span class="s2">&quot;display_value&quot;</span><span class="s1">: </span><span class="s2">&quot;text&quot;</span><span class="s0">, </span><span class="s2">&quot;cellstyle&quot;</span><span class="s1">: [(</span><span class="s2">&quot;bfseries&quot;</span><span class="s0">, </span><span class="s2">&quot;--rwrap&quot;</span><span class="s1">)]}</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_header_span(cell</span><span class="s0">, </span><span class="s2">&quot;X&quot;</span><span class="s0">, </span><span class="s2">&quot;Y&quot;</span><span class="s1">) == </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">bfseries{text}&quot;</span>


<span class="s0">def </span><span class="s1">test_parse_latex_table_wrapping(styler):</span>
    <span class="s1">styler.set_table_styles(</span>
        <span class="s1">[</span>
            <span class="s1">{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;toprule&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: </span><span class="s2">&quot;:value&quot;</span><span class="s1">}</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;bottomrule&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: </span><span class="s2">&quot;:value&quot;</span><span class="s1">}</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;midrule&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: </span><span class="s2">&quot;:value&quot;</span><span class="s1">}</span><span class="s0">,</span>
            <span class="s1">{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;column_format&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: </span><span class="s2">&quot;:value&quot;</span><span class="s1">}</span><span class="s0">,</span>
        <span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_table_wrapping(styler.table_styles</span><span class="s0">, </span><span class="s1">styler.caption) </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_table_wrapping(styler.table_styles</span><span class="s0">, </span><span class="s2">&quot;some caption&quot;</span><span class="s1">) </span><span class="s0">is True</span>
    <span class="s1">styler.set_table_styles(</span>
        <span class="s1">[</span>
            <span class="s1">{</span><span class="s2">&quot;selector&quot;</span><span class="s1">: </span><span class="s2">&quot;not-ignored&quot;</span><span class="s0">, </span><span class="s2">&quot;props&quot;</span><span class="s1">: </span><span class="s2">&quot;:value&quot;</span><span class="s1">}</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
        <span class="s1">overwrite=</span><span class="s0">False,</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">_parse_latex_table_wrapping(styler.table_styles</span><span class="s0">, None</span><span class="s1">) </span><span class="s0">is True</span>


<span class="s0">def </span><span class="s1">test_short_caption(styler):</span>
    <span class="s1">result = styler.to_latex(caption=(</span><span class="s2">&quot;full cap&quot;</span><span class="s0">, </span><span class="s2">&quot;short cap&quot;</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">caption[short cap]{full cap}&quot; </span><span class="s0">in </span><span class="s1">result</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;css, expected&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">([(</span><span class="s2">&quot;color&quot;</span><span class="s0">, </span><span class="s2">&quot;red&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">&quot;color&quot;</span><span class="s0">, </span><span class="s2">&quot;{red}&quot;</span><span class="s1">)])</span><span class="s0">,  </span><span class="s4"># test color and input format types</span>
        <span class="s1">(</span>
            <span class="s1">[(</span><span class="s2">&quot;color&quot;</span><span class="s0">, </span><span class="s2">&quot;rgb(128, 128, 128 )&quot;</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">[(</span><span class="s2">&quot;color&quot;</span><span class="s0">, </span><span class="s2">&quot;[rgb]{0.502, 0.502, 0.502}&quot;</span><span class="s1">)]</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">[(</span><span class="s2">&quot;color&quot;</span><span class="s0">, </span><span class="s2">&quot;rgb(128, 50%, 25% )&quot;</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">[(</span><span class="s2">&quot;color&quot;</span><span class="s0">, </span><span class="s2">&quot;[rgb]{0.502, 0.500, 0.250}&quot;</span><span class="s1">)]</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">[(</span><span class="s2">&quot;color&quot;</span><span class="s0">, </span><span class="s2">&quot;rgba(128,128,128,1)&quot;</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">[(</span><span class="s2">&quot;color&quot;</span><span class="s0">, </span><span class="s2">&quot;[rgb]{0.502, 0.502, 0.502}&quot;</span><span class="s1">)]</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([(</span><span class="s2">&quot;color&quot;</span><span class="s0">, </span><span class="s2">&quot;#FF00FF&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">&quot;color&quot;</span><span class="s0">, </span><span class="s2">&quot;[HTML]{FF00FF}&quot;</span><span class="s1">)])</span><span class="s0">,</span>
        <span class="s1">([(</span><span class="s2">&quot;color&quot;</span><span class="s0">, </span><span class="s2">&quot;#F0F&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">&quot;color&quot;</span><span class="s0">, </span><span class="s2">&quot;[HTML]{FF00FF}&quot;</span><span class="s1">)])</span><span class="s0">,</span>
        <span class="s1">([(</span><span class="s2">&quot;font-weight&quot;</span><span class="s0">, </span><span class="s2">&quot;bold&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">&quot;bfseries&quot;</span><span class="s0">, </span><span class="s2">&quot;&quot;</span><span class="s1">)])</span><span class="s0">,  </span><span class="s4"># test font-weight and types</span>
        <span class="s1">([(</span><span class="s2">&quot;font-weight&quot;</span><span class="s0">, </span><span class="s2">&quot;bolder&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">&quot;bfseries&quot;</span><span class="s0">, </span><span class="s2">&quot;&quot;</span><span class="s1">)])</span><span class="s0">,</span>
        <span class="s1">([(</span><span class="s2">&quot;font-weight&quot;</span><span class="s0">, </span><span class="s2">&quot;normal&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[])</span><span class="s0">,</span>
        <span class="s1">([(</span><span class="s2">&quot;background-color&quot;</span><span class="s0">, </span><span class="s2">&quot;red&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">&quot;cellcolor&quot;</span><span class="s0">, </span><span class="s2">&quot;{red}--lwrap&quot;</span><span class="s1">)])</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">[(</span><span class="s2">&quot;background-color&quot;</span><span class="s0">, </span><span class="s2">&quot;#FF00FF&quot;</span><span class="s1">)]</span><span class="s0">,  </span><span class="s4"># test background-color command and wrap</span>
            <span class="s1">[(</span><span class="s2">&quot;cellcolor&quot;</span><span class="s0">, </span><span class="s2">&quot;[HTML]{FF00FF}--lwrap&quot;</span><span class="s1">)]</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([(</span><span class="s2">&quot;font-style&quot;</span><span class="s0">, </span><span class="s2">&quot;italic&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">&quot;itshape&quot;</span><span class="s0">, </span><span class="s2">&quot;&quot;</span><span class="s1">)])</span><span class="s0">,  </span><span class="s4"># test font-style and types</span>
        <span class="s1">([(</span><span class="s2">&quot;font-style&quot;</span><span class="s0">, </span><span class="s2">&quot;oblique&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">&quot;slshape&quot;</span><span class="s0">, </span><span class="s2">&quot;&quot;</span><span class="s1">)])</span><span class="s0">,</span>
        <span class="s1">([(</span><span class="s2">&quot;font-style&quot;</span><span class="s0">, </span><span class="s2">&quot;normal&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[])</span><span class="s0">,</span>
        <span class="s1">([(</span><span class="s2">&quot;color&quot;</span><span class="s0">, </span><span class="s2">&quot;red /*--dwrap*/&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">&quot;color&quot;</span><span class="s0">, </span><span class="s2">&quot;{red}--dwrap&quot;</span><span class="s1">)])</span><span class="s0">,  </span><span class="s4"># css comments</span>
        <span class="s1">([(</span><span class="s2">&quot;background-color&quot;</span><span class="s0">, </span><span class="s2">&quot;red /* --dwrap */&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">&quot;cellcolor&quot;</span><span class="s0">, </span><span class="s2">&quot;{red}--dwrap&quot;</span><span class="s1">)])</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_parse_latex_css_conversion(css</span><span class="s0">, </span><span class="s1">expected):</span>
    <span class="s1">result = _parse_latex_css_conversion(css)</span>
    <span class="s0">assert </span><span class="s1">result == expected</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;env, inner_env&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s0">None, </span><span class="s2">&quot;tabular&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;table&quot;</span><span class="s0">, </span><span class="s2">&quot;tabular&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;longtable&quot;</span><span class="s0">, </span><span class="s2">&quot;longtable&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;convert, exp&quot;</span><span class="s0">, </span><span class="s1">[(</span><span class="s0">True, </span><span class="s2">&quot;bfseries&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s0">False, </span><span class="s2">&quot;font-weightbold&quot;</span><span class="s1">)]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_parse_latex_css_convert_minimal(styler</span><span class="s0">, </span><span class="s1">env</span><span class="s0">, </span><span class="s1">inner_env</span><span class="s0">, </span><span class="s1">convert</span><span class="s0">, </span><span class="s1">exp):</span>
    <span class="s4"># parameters ensure longtable template is also tested</span>
    <span class="s1">styler.highlight_max(props=</span><span class="s2">&quot;font-weight:bold;&quot;</span><span class="s1">)</span>
    <span class="s1">result = styler.to_latex(convert_css=convert</span><span class="s0">, </span><span class="s1">environment=env)</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">f&quot;&quot;&quot;</span><span class="s0">\ 
        </span><span class="s2">0 &amp; 0 &amp; </span><span class="s0">\\{</span><span class="s1">exp</span><span class="s0">} </span><span class="s2">-0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s2">1 &amp; </span><span class="s0">\\{</span><span class="s1">exp</span><span class="s0">} </span><span class="s2">1 &amp; -1.22 &amp; </span><span class="s0">\\{</span><span class="s1">exp</span><span class="s0">} </span><span class="s2">cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">end</span><span class="s0">{{{</span><span class="s1">inner_env</span><span class="s0">}}}</span>
    <span class="s2">&quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">result</span>


<span class="s0">def </span><span class="s1">test_parse_latex_css_conversion_option():</span>
    <span class="s1">css = [(</span><span class="s2">&quot;command&quot;</span><span class="s0">, </span><span class="s2">&quot;option--latex--wrap&quot;</span><span class="s1">)]</span>
    <span class="s1">expected = [(</span><span class="s2">&quot;command&quot;</span><span class="s0">, </span><span class="s2">&quot;option--wrap&quot;</span><span class="s1">)]</span>
    <span class="s1">result = _parse_latex_css_conversion(css)</span>
    <span class="s0">assert </span><span class="s1">result == expected</span>


<span class="s0">def </span><span class="s1">test_styler_object_after_render(styler):</span>
    <span class="s4"># GH 42320</span>
    <span class="s1">pre_render = styler._copy(deepcopy=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">styler.to_latex(</span>
        <span class="s1">column_format=</span><span class="s2">&quot;rllr&quot;</span><span class="s0">,</span>
        <span class="s1">position=</span><span class="s2">&quot;h&quot;</span><span class="s0">,</span>
        <span class="s1">position_float=</span><span class="s2">&quot;centering&quot;</span><span class="s0">,</span>
        <span class="s1">hrules=</span><span class="s0">True,</span>
        <span class="s1">label=</span><span class="s2">&quot;my lab&quot;</span><span class="s0">,</span>
        <span class="s1">caption=</span><span class="s2">&quot;my cap&quot;</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">pre_render.table_styles == styler.table_styles</span>
    <span class="s0">assert </span><span class="s1">pre_render.caption == styler.caption</span>


<span class="s0">def </span><span class="s1">test_longtable_comprehensive(styler):</span>
    <span class="s1">result = styler.to_latex(</span>
        <span class="s1">environment=</span><span class="s2">&quot;longtable&quot;</span><span class="s0">, </span><span class="s1">hrules=</span><span class="s0">True, </span><span class="s1">label=</span><span class="s2">&quot;fig:A&quot;</span><span class="s0">, </span><span class="s1">caption=(</span><span class="s2">&quot;full&quot;</span><span class="s0">, </span><span class="s2">&quot;short&quot;</span><span class="s1">)</span>
    <span class="s1">)</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s2">begin{longtable}{lrrl} 
        </span><span class="s0">\\</span><span class="s2">caption[short]{full} </span><span class="s0">\\</span><span class="s2">label{fig:A} </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">toprule 
         &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">midrule 
        </span><span class="s0">\\</span><span class="s2">endfirsthead 
        </span><span class="s0">\\</span><span class="s2">caption[]{full} </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">toprule 
         &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">midrule 
        </span><span class="s0">\\</span><span class="s2">endhead 
        </span><span class="s0">\\</span><span class="s2">midrule 
        </span><span class="s0">\\</span><span class="s2">multicolumn{4}{r}{Continued on next page} </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">midrule 
        </span><span class="s0">\\</span><span class="s2">endfoot 
        </span><span class="s0">\\</span><span class="s2">bottomrule 
        </span><span class="s0">\\</span><span class="s2">endlastfoot 
        0 &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s2">1 &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">end{longtable} 
    &quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">result == expected</span>


<span class="s0">def </span><span class="s1">test_longtable_minimal(styler):</span>
    <span class="s1">result = styler.to_latex(environment=</span><span class="s2">&quot;longtable&quot;</span><span class="s1">)</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s2">begin{longtable}{lrrl} 
         &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">endfirsthead 
         &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">endhead 
        </span><span class="s0">\\</span><span class="s2">multicolumn{4}{r}{Continued on next page} </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">endfoot 
        </span><span class="s0">\\</span><span class="s2">endlastfoot 
        0 &amp; 0 &amp; -0.61 &amp; ab </span><span class="s0">\\\\</span>
        <span class="s2">1 &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">end{longtable} 
    &quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">result == expected</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;sparse, exp, siunitx&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s0">True, </span><span class="s2">&quot;{} &amp; </span><span class="s0">\\</span><span class="s2">multicolumn{2}{r}{A} &amp; {B}&quot;</span><span class="s0">, True</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s0">False, </span><span class="s2">&quot;{} &amp; {A} &amp; {A} &amp; {B}&quot;</span><span class="s0">, True</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s0">True, </span><span class="s2">&quot; &amp; </span><span class="s0">\\</span><span class="s2">multicolumn{2}{r}{A} &amp; B&quot;</span><span class="s0">, False</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s0">False, </span><span class="s2">&quot; &amp; A &amp; A &amp; B&quot;</span><span class="s0">, False</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_longtable_multiindex_columns(df</span><span class="s0">, </span><span class="s1">sparse</span><span class="s0">, </span><span class="s1">exp</span><span class="s0">, </span><span class="s1">siunitx):</span>
    <span class="s1">cidx = MultiIndex.from_tuples([(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">)])</span>
    <span class="s1">df.columns = cidx</span>
    <span class="s1">with_si = </span><span class="s2">&quot;{} &amp; {a} &amp; {b} &amp; {c} </span><span class="s0">\\\\</span><span class="s2">&quot;</span>
    <span class="s1">without_si = </span><span class="s2">&quot; &amp; a &amp; b &amp; c </span><span class="s0">\\\\</span><span class="s2">&quot;</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">f&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s2">begin</span><span class="s0">{{</span><span class="s2">longtable</span><span class="s0">}}{{</span><span class="s2">l</span><span class="s0">{</span><span class="s2">&quot;SS&quot; </span><span class="s0">if </span><span class="s1">siunitx </span><span class="s0">else </span><span class="s2">&quot;rr&quot;</span><span class="s0">}</span><span class="s2">l</span><span class="s0">}}</span>
        <span class="s0">{</span><span class="s1">exp</span><span class="s0">} \\\\</span>
        <span class="s0">{</span><span class="s1">with_si </span><span class="s0">if </span><span class="s1">siunitx </span><span class="s0">else </span><span class="s1">without_si</span><span class="s0">}</span>
        <span class="s0">\\</span><span class="s2">endfirsthead</span>
        <span class="s0">{</span><span class="s1">exp</span><span class="s0">} \\\\</span>
        <span class="s0">{</span><span class="s1">with_si </span><span class="s0">if </span><span class="s1">siunitx </span><span class="s0">else </span><span class="s1">without_si</span><span class="s0">}</span>
        <span class="s0">\\</span><span class="s2">endhead</span>
        <span class="s2">&quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s1">result = df.style.to_latex(</span>
        <span class="s1">environment=</span><span class="s2">&quot;longtable&quot;</span><span class="s0">, </span><span class="s1">sparse_columns=sparse</span><span class="s0">, </span><span class="s1">siunitx=siunitx</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">result</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;caption, cap_exp&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s2">&quot;full&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;{full}&quot;</span><span class="s0">, </span><span class="s2">&quot;&quot;</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">((</span><span class="s2">&quot;full&quot;</span><span class="s0">, </span><span class="s2">&quot;short&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;{full}&quot;</span><span class="s0">, </span><span class="s2">&quot;[short]&quot;</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;label, lab_exp&quot;</span><span class="s0">, </span><span class="s1">[(</span><span class="s0">None, </span><span class="s2">&quot;&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;tab:A&quot;</span><span class="s0">, </span><span class="s2">&quot; </span><span class="s0">\\</span><span class="s2">label{tab:A}&quot;</span><span class="s1">)])</span>
<span class="s0">def </span><span class="s1">test_longtable_caption_label(styler</span><span class="s0">, </span><span class="s1">caption</span><span class="s0">, </span><span class="s1">cap_exp</span><span class="s0">, </span><span class="s1">label</span><span class="s0">, </span><span class="s1">lab_exp):</span>
    <span class="s1">cap_exp1 = </span><span class="s2">f&quot;</span><span class="s0">\\</span><span class="s2">caption</span><span class="s0">{</span><span class="s1">cap_exp[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">}{</span><span class="s1">cap_exp[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">}</span><span class="s2">&quot;</span>
    <span class="s1">cap_exp2 = </span><span class="s2">f&quot;</span><span class="s0">\\</span><span class="s2">caption[]</span><span class="s0">{</span><span class="s1">cap_exp[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">}</span><span class="s2">&quot;</span>

    <span class="s1">expected = dedent(</span>
        <span class="s2">f&quot;&quot;&quot;</span><span class="s0">\ 
        {</span><span class="s1">cap_exp1</span><span class="s0">}{</span><span class="s1">lab_exp</span><span class="s0">} \\\\</span>
         <span class="s2">&amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">endfirsthead</span>
        <span class="s0">{</span><span class="s1">cap_exp2</span><span class="s0">} \\\\</span>
        <span class="s2">&quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">styler.to_latex(</span>
        <span class="s1">environment=</span><span class="s2">&quot;longtable&quot;</span><span class="s0">, </span><span class="s1">caption=caption</span><span class="s0">, </span><span class="s1">label=label</span>
    <span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;index&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;columns, siunitx&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s0">True, True</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s0">True, False</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s0">False, False</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_apply_map_header_render_mi(df_ext</span><span class="s0">, </span><span class="s1">index</span><span class="s0">, </span><span class="s1">columns</span><span class="s0">, </span><span class="s1">siunitx):</span>
    <span class="s1">cidx = MultiIndex.from_tuples([(</span><span class="s2">&quot;Z&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;Z&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;Y&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">)])</span>
    <span class="s1">ridx = MultiIndex.from_tuples([(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">)])</span>
    <span class="s1">df_ext.index</span><span class="s0">, </span><span class="s1">df_ext.columns = ridx</span><span class="s0">, </span><span class="s1">cidx</span>
    <span class="s1">styler = df_ext.style</span>

    <span class="s1">func = </span><span class="s0">lambda </span><span class="s1">v: </span><span class="s2">&quot;bfseries: --rwrap&quot; </span><span class="s0">if </span><span class="s2">&quot;A&quot; </span><span class="s0">in </span><span class="s1">v </span><span class="s0">or </span><span class="s2">&quot;Z&quot; </span><span class="s0">in </span><span class="s1">v </span><span class="s0">or </span><span class="s2">&quot;c&quot; </span><span class="s0">in </span><span class="s1">v </span><span class="s0">else None</span>

    <span class="s0">if </span><span class="s1">index:</span>
        <span class="s1">styler.applymap_index(func</span><span class="s0">, </span><span class="s1">axis=</span><span class="s2">&quot;index&quot;</span><span class="s1">)</span>
    <span class="s0">if </span><span class="s1">columns:</span>
        <span class="s1">styler.applymap_index(func</span><span class="s0">, </span><span class="s1">axis=</span><span class="s2">&quot;columns&quot;</span><span class="s1">)</span>

    <span class="s1">result = styler.to_latex(siunitx=siunitx)</span>

    <span class="s1">expected_index = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
    \\</span><span class="s2">multirow[c]{2}{*}{</span><span class="s0">\\</span><span class="s2">bfseries{A}} &amp; a &amp; 0 &amp; -0.610000 &amp; ab </span><span class="s0">\\\\</span>
    <span class="s0">\\</span><span class="s2">bfseries{} &amp; b &amp; 1 &amp; -1.220000 &amp; cd </span><span class="s0">\\\\</span>
    <span class="s2">B &amp; </span><span class="s0">\\</span><span class="s2">bfseries{c} &amp; 2 &amp; -2.220000 &amp; de </span><span class="s0">\\\\</span>
    <span class="s2">&quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">(expected_index </span><span class="s0">in </span><span class="s1">result) </span><span class="s0">is </span><span class="s1">index</span>

    <span class="s1">exp_cols_si = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
    </span><span class="s2">{} &amp; {} &amp; </span><span class="s0">\\</span><span class="s2">multicolumn{2}{r}{</span><span class="s0">\\</span><span class="s2">bfseries{Z}} &amp; {Y} </span><span class="s0">\\\\</span>
    <span class="s2">{} &amp; {} &amp; {a} &amp; {b} &amp; {</span><span class="s0">\\</span><span class="s2">bfseries{c}} </span><span class="s0">\\\\</span>
    <span class="s2">&quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s1">exp_cols_no_si = </span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
 </span><span class="s2">&amp;  &amp; </span><span class="s0">\\</span><span class="s2">multicolumn{2}{r}{</span><span class="s0">\\</span><span class="s2">bfseries{Z}} &amp; Y </span><span class="s0">\\\\</span>
 <span class="s2">&amp;  &amp; a &amp; b &amp; </span><span class="s0">\\</span><span class="s2">bfseries{c} </span><span class="s0">\\\\</span>
<span class="s2">&quot;&quot;&quot;</span>
    <span class="s0">assert </span><span class="s1">((exp_cols_si </span><span class="s0">if </span><span class="s1">siunitx </span><span class="s0">else </span><span class="s1">exp_cols_no_si) </span><span class="s0">in </span><span class="s1">result) </span><span class="s0">is </span><span class="s1">columns</span>


<span class="s0">def </span><span class="s1">test_repr_option(styler):</span>
    <span class="s0">assert </span><span class="s2">&quot;&lt;style&quot; </span><span class="s0">in </span><span class="s1">styler._repr_html_()[:</span><span class="s3">6</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">styler._repr_latex_() </span><span class="s0">is None</span>
    <span class="s0">with </span><span class="s1">option_context(</span><span class="s2">&quot;styler.render.repr&quot;</span><span class="s0">, </span><span class="s2">&quot;latex&quot;</span><span class="s1">):</span>
        <span class="s0">assert </span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">begin{tabular}&quot; </span><span class="s0">in </span><span class="s1">styler._repr_latex_()[:</span><span class="s3">15</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">styler._repr_html_() </span><span class="s0">is None</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;option&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;hrules&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_bool_options(styler</span><span class="s0">, </span><span class="s1">option):</span>
    <span class="s0">with </span><span class="s1">option_context(</span><span class="s2">f&quot;styler.latex.</span><span class="s0">{</span><span class="s1">option</span><span class="s0">}</span><span class="s2">&quot;</span><span class="s0">, False</span><span class="s1">):</span>
        <span class="s1">latex_false = styler.to_latex()</span>
    <span class="s0">with </span><span class="s1">option_context(</span><span class="s2">f&quot;styler.latex.</span><span class="s0">{</span><span class="s1">option</span><span class="s0">}</span><span class="s2">&quot;</span><span class="s0">, True</span><span class="s1">):</span>
        <span class="s1">latex_true = styler.to_latex()</span>
    <span class="s0">assert </span><span class="s1">latex_false != latex_true  </span><span class="s4"># options are reactive under to_latex(*no_args)</span>


<span class="s0">def </span><span class="s1">test_siunitx_basic_headers(styler):</span>
    <span class="s0">assert </span><span class="s2">&quot;{} &amp; {A} &amp; {B} &amp; {C} </span><span class="s0">\\\\</span><span class="s2">&quot; </span><span class="s0">in </span><span class="s1">styler.to_latex(siunitx=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s2">&quot; &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span><span class="s2">&quot; </span><span class="s0">in </span><span class="s1">styler.to_latex()  </span><span class="s4"># default siunitx=False</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;axis&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;index&quot;</span><span class="s0">, </span><span class="s2">&quot;columns&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_css_convert_apply_index(styler</span><span class="s0">, </span><span class="s1">axis):</span>
    <span class="s1">styler.applymap_index(</span><span class="s0">lambda </span><span class="s1">x: </span><span class="s2">&quot;font-weight: bold;&quot;</span><span class="s0">, </span><span class="s1">axis=axis)</span>
    <span class="s0">for </span><span class="s1">label </span><span class="s0">in </span><span class="s1">getattr(styler</span><span class="s0">, </span><span class="s1">axis):</span>
        <span class="s0">assert </span><span class="s2">f&quot;</span><span class="s0">\\</span><span class="s2">bfseries </span><span class="s0">{</span><span class="s1">label</span><span class="s0">}</span><span class="s2">&quot; </span><span class="s0">in </span><span class="s1">styler.to_latex(convert_css=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_hide_index_latex(styler):</span>
    <span class="s4"># GH 43637</span>
    <span class="s1">styler.hide([</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">result = styler.to_latex()</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
    \\</span><span class="s2">begin{tabular}{lrrl} 
     &amp; A &amp; B &amp; C </span><span class="s0">\\\\</span>
    <span class="s2">1 &amp; 1 &amp; -1.22 &amp; cd </span><span class="s0">\\\\</span>
    <span class="s0">\\</span><span class="s2">end{tabular} 
    &quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">expected == result</span>


<span class="s0">def </span><span class="s1">test_latex_hiding_index_columns_multiindex_alignment():</span>
    <span class="s4"># gh 43644</span>
    <span class="s1">midx = MultiIndex.from_product(</span>
        <span class="s1">[[</span><span class="s2">&quot;i0&quot;</span><span class="s0">, </span><span class="s2">&quot;j0&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;i1&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;i2&quot;</span><span class="s0">, </span><span class="s2">&quot;j2&quot;</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">names=[</span><span class="s2">&quot;i-0&quot;</span><span class="s0">, </span><span class="s2">&quot;i-1&quot;</span><span class="s0">, </span><span class="s2">&quot;i-2&quot;</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">cidx = MultiIndex.from_product(</span>
        <span class="s1">[[</span><span class="s2">&quot;c0&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;c1&quot;</span><span class="s0">, </span><span class="s2">&quot;d1&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;c2&quot;</span><span class="s0">, </span><span class="s2">&quot;d2&quot;</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">names=[</span><span class="s2">&quot;c-0&quot;</span><span class="s0">, </span><span class="s2">&quot;c-1&quot;</span><span class="s0">, </span><span class="s2">&quot;c-2&quot;</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">df = DataFrame(np.arange(</span><span class="s3">16</span><span class="s1">).reshape(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=midx</span><span class="s0">, </span><span class="s1">columns=cidx)</span>
    <span class="s1">styler = Styler(df</span><span class="s0">, </span><span class="s1">uuid_len=</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">styler.hide(level=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">).hide(level=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">styler.hide([(</span><span class="s2">&quot;i0&quot;</span><span class="s0">, </span><span class="s2">&quot;i1&quot;</span><span class="s0">, </span><span class="s2">&quot;i2&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">styler.hide([(</span><span class="s2">&quot;c0&quot;</span><span class="s0">, </span><span class="s2">&quot;c1&quot;</span><span class="s0">, </span><span class="s2">&quot;c2&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">styler.applymap(</span><span class="s0">lambda </span><span class="s1">x: </span><span class="s2">&quot;color:{red};&quot; </span><span class="s0">if </span><span class="s1">x == </span><span class="s3">5 </span><span class="s0">else </span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
    <span class="s1">styler.applymap_index(</span><span class="s0">lambda </span><span class="s1">x: </span><span class="s2">&quot;color:{blue};&quot; </span><span class="s0">if </span><span class="s2">&quot;j&quot; </span><span class="s0">in </span><span class="s1">x </span><span class="s0">else </span><span class="s2">&quot;&quot;</span><span class="s1">)</span>
    <span class="s1">result = styler.to_latex()</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s2">begin{tabular}{llrrr} 
         &amp; c-1 &amp; c1 &amp; </span><span class="s0">\\</span><span class="s2">multicolumn{2}{r}{d1} </span><span class="s0">\\\\</span>
         <span class="s2">&amp; c-2 &amp; d2 &amp; c2 &amp; d2 </span><span class="s0">\\\\</span>
        <span class="s2">i-0 &amp; i-2 &amp;  &amp;  &amp;  </span><span class="s0">\\\\</span>
        <span class="s2">i0 &amp; </span><span class="s0">\\</span><span class="s2">color{blue} j2 &amp; </span><span class="s0">\\</span><span class="s2">color{red} 5 &amp; 6 &amp; 7 </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">multirow[c]{2}{*}{</span><span class="s0">\\</span><span class="s2">color{blue} j0} &amp; i2 &amp; 9 &amp; 10 &amp; 11 </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">color{blue}  &amp; </span><span class="s0">\\</span><span class="s2">color{blue} j2 &amp; 13 &amp; 14 &amp; 15 </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">result == expected</span>


<span class="s0">def </span><span class="s1">test_rendered_links():</span>
    <span class="s4"># note the majority of testing is done in test_html.py: test_rendered_links</span>
    <span class="s4"># these test only the alternative latex format is functional</span>
    <span class="s1">df = DataFrame([</span><span class="s2">&quot;text www.domain.com text&quot;</span><span class="s1">])</span>
    <span class="s1">result = df.style.format(hyperlinks=</span><span class="s2">&quot;latex&quot;</span><span class="s1">).to_latex()</span>
    <span class="s0">assert </span><span class="s2">r&quot;text \href{www.domain.com}{www.domain.com} text&quot; </span><span class="s0">in </span><span class="s1">result</span>


<span class="s0">def </span><span class="s1">test_apply_index_hidden_levels():</span>
    <span class="s4"># gh 45156</span>
    <span class="s1">styler = DataFrame(</span>
        <span class="s1">[[</span><span class="s3">1</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">index=MultiIndex.from_tuples([(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">names=[</span><span class="s2">&quot;l0&quot;</span><span class="s0">, </span><span class="s2">&quot;l1&quot;</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">columns=MultiIndex.from_tuples([(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">names=[</span><span class="s2">&quot;c0&quot;</span><span class="s0">, </span><span class="s2">&quot;c1&quot;</span><span class="s1">])</span><span class="s0">,</span>
    <span class="s1">).style</span>
    <span class="s1">styler.hide(level=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">styler.applymap_index(</span><span class="s0">lambda </span><span class="s1">v: </span><span class="s2">&quot;color: red;&quot;</span><span class="s0">, </span><span class="s1">level=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">result = styler.to_latex(convert_css=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">expected = dedent(</span>
        <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        \\</span><span class="s2">begin{tabular}{lr} 
        c0 &amp; </span><span class="s0">\\</span><span class="s2">color{red} 0 </span><span class="s0">\\\\</span>
        <span class="s2">c1 &amp; 1 </span><span class="s0">\\\\</span>
        <span class="s2">l0 &amp;  </span><span class="s0">\\\\</span>
        <span class="s2">0 &amp; 1 </span><span class="s0">\\\\</span>
        <span class="s0">\\</span><span class="s2">end{tabular} 
        &quot;&quot;&quot;</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">result == expected</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;clines&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;bad&quot;</span><span class="s0">, </span><span class="s2">&quot;index&quot;</span><span class="s0">, </span><span class="s2">&quot;skip-last&quot;</span><span class="s0">, </span><span class="s2">&quot;all&quot;</span><span class="s0">, </span><span class="s2">&quot;data&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_clines_validation(clines</span><span class="s0">, </span><span class="s1">styler):</span>
    <span class="s1">msg = </span><span class="s2">f&quot;`clines` value of </span><span class="s0">{</span><span class="s1">clines</span><span class="s0">} </span><span class="s2">is invalid.&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">styler.to_latex(clines=clines)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;clines, exp&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s2">&quot;all;index&quot;</span><span class="s0">, </span><span class="s2">&quot;</span><span class="s0">\n\\</span><span class="s2">cline{1-1}&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;all;data&quot;</span><span class="s0">, </span><span class="s2">&quot;</span><span class="s0">\n\\</span><span class="s2">cline{1-2}&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;skip-last;index&quot;</span><span class="s0">, </span><span class="s2">&quot;&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;skip-last;data&quot;</span><span class="s0">, </span><span class="s2">&quot;&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s0">None, </span><span class="s2">&quot;&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;env&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;table&quot;</span><span class="s0">, </span><span class="s2">&quot;longtable&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_clines_index(clines</span><span class="s0">, </span><span class="s1">exp</span><span class="s0">, </span><span class="s1">env):</span>
    <span class="s1">df = DataFrame([[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">4</span><span class="s1">]])</span>
    <span class="s1">result = df.style.to_latex(clines=clines</span><span class="s0">, </span><span class="s1">environment=env)</span>
    <span class="s1">expected = </span><span class="s2">f&quot;&quot;&quot;</span><span class="s0">\ 
</span><span class="s2">0 &amp; 1 </span><span class="s0">\\\\{</span><span class="s1">exp</span><span class="s0">}</span>
<span class="s2">1 &amp; 2 </span><span class="s0">\\\\{</span><span class="s1">exp</span><span class="s0">}</span>
<span class="s2">2 &amp; 3 </span><span class="s0">\\\\{</span><span class="s1">exp</span><span class="s0">}</span>
<span class="s2">3 &amp; 4 </span><span class="s0">\\\\{</span><span class="s1">exp</span><span class="s0">}</span>
<span class="s2">&quot;&quot;&quot;</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">result</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;clines, expected&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span>
            <span class="s0">None,</span>
            <span class="s1">dedent(</span>
                <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
            \\</span><span class="s2">multirow[c]{2}{*}{A} &amp; X &amp; 1 </span><span class="s0">\\\\</span>
             <span class="s2">&amp; Y &amp; 2 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s2">multirow[c]{2}{*}{B} &amp; X &amp; 3 </span><span class="s0">\\\\</span>
             <span class="s2">&amp; Y &amp; 4 </span><span class="s0">\\\\</span>
            <span class="s2">&quot;&quot;&quot;</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s2">&quot;skip-last;index&quot;</span><span class="s0">,</span>
            <span class="s1">dedent(</span>
                <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
            \\</span><span class="s2">multirow[c]{2}{*}{A} &amp; X &amp; 1 </span><span class="s0">\\\\</span>
             <span class="s2">&amp; Y &amp; 2 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s2">cline{1-2} 
            </span><span class="s0">\\</span><span class="s2">multirow[c]{2}{*}{B} &amp; X &amp; 3 </span><span class="s0">\\\\</span>
             <span class="s2">&amp; Y &amp; 4 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s2">cline{1-2} 
            &quot;&quot;&quot;</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s2">&quot;skip-last;data&quot;</span><span class="s0">,</span>
            <span class="s1">dedent(</span>
                <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
            \\</span><span class="s2">multirow[c]{2}{*}{A} &amp; X &amp; 1 </span><span class="s0">\\\\</span>
             <span class="s2">&amp; Y &amp; 2 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s2">cline{1-3} 
            </span><span class="s0">\\</span><span class="s2">multirow[c]{2}{*}{B} &amp; X &amp; 3 </span><span class="s0">\\\\</span>
             <span class="s2">&amp; Y &amp; 4 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s2">cline{1-3} 
            &quot;&quot;&quot;</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s2">&quot;all;index&quot;</span><span class="s0">,</span>
            <span class="s1">dedent(</span>
                <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
            \\</span><span class="s2">multirow[c]{2}{*}{A} &amp; X &amp; 1 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s2">cline{2-2} 
             &amp; Y &amp; 2 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s2">cline{1-2} </span><span class="s0">\\</span><span class="s2">cline{2-2} 
            </span><span class="s0">\\</span><span class="s2">multirow[c]{2}{*}{B} &amp; X &amp; 3 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s2">cline{2-2} 
             &amp; Y &amp; 4 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s2">cline{1-2} </span><span class="s0">\\</span><span class="s2">cline{2-2} 
            &quot;&quot;&quot;</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s2">&quot;all;data&quot;</span><span class="s0">,</span>
            <span class="s1">dedent(</span>
                <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
            \\</span><span class="s2">multirow[c]{2}{*}{A} &amp; X &amp; 1 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s2">cline{2-3} 
             &amp; Y &amp; 2 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s2">cline{1-3} </span><span class="s0">\\</span><span class="s2">cline{2-3} 
            </span><span class="s0">\\</span><span class="s2">multirow[c]{2}{*}{B} &amp; X &amp; 3 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s2">cline{2-3} 
             &amp; Y &amp; 4 </span><span class="s0">\\\\</span>
            <span class="s0">\\</span><span class="s2">cline{1-3} </span><span class="s0">\\</span><span class="s2">cline{2-3} 
            &quot;&quot;&quot;</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;env&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;table&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_clines_multiindex(clines</span><span class="s0">, </span><span class="s1">expected</span><span class="s0">, </span><span class="s1">env):</span>
    <span class="s4"># also tests simultaneously with hidden rows and a hidden multiindex level</span>
    <span class="s1">midx = MultiIndex.from_product([[</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;-&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;X&quot;</span><span class="s0">, </span><span class="s2">&quot;Y&quot;</span><span class="s1">]])</span>
    <span class="s1">df = DataFrame([[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">99</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">99</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">4</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">index=midx)</span>
    <span class="s1">styler = df.style</span>
    <span class="s1">styler.hide([(</span><span class="s2">&quot;-&quot;</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s2">&quot;X&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;-&quot;</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s2">&quot;Y&quot;</span><span class="s1">)])</span>
    <span class="s1">styler.hide(level=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">result = styler.to_latex(clines=clines</span><span class="s0">, </span><span class="s1">environment=env)</span>
    <span class="s0">assert </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">result</span>
</pre>
</body>
</html>