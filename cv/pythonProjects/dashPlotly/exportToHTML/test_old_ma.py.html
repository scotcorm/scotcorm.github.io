<html>
<head>
<title>test_old_ma.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_old_ma.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">functools </span><span class="s0">import </span><span class="s1">reduce</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">numpy.core.umath </span><span class="s0">as </span><span class="s1">umath</span>
<span class="s0">import </span><span class="s1">numpy.core.fromnumeric </span><span class="s0">as </span><span class="s1">fromnumeric</span>
<span class="s0">from </span><span class="s1">numpy.testing </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">assert_</span><span class="s0">, </span><span class="s1">assert_raises</span><span class="s0">, </span><span class="s1">assert_equal</span><span class="s0">,</span>
    <span class="s1">)</span>
<span class="s0">from </span><span class="s1">numpy.ma </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">MaskType</span><span class="s0">, </span><span class="s1">MaskedArray</span><span class="s0">, </span><span class="s1">absolute</span><span class="s0">, </span><span class="s1">add</span><span class="s0">, </span><span class="s1">all</span><span class="s0">, </span><span class="s1">allclose</span><span class="s0">, </span><span class="s1">allequal</span><span class="s0">, </span><span class="s1">alltrue</span><span class="s0">,</span>
    <span class="s1">arange</span><span class="s0">, </span><span class="s1">arccos</span><span class="s0">, </span><span class="s1">arcsin</span><span class="s0">, </span><span class="s1">arctan</span><span class="s0">, </span><span class="s1">arctan2</span><span class="s0">, </span><span class="s1">array</span><span class="s0">, </span><span class="s1">average</span><span class="s0">, </span><span class="s1">choose</span><span class="s0">,</span>
    <span class="s1">concatenate</span><span class="s0">, </span><span class="s1">conjugate</span><span class="s0">, </span><span class="s1">cos</span><span class="s0">, </span><span class="s1">cosh</span><span class="s0">, </span><span class="s1">count</span><span class="s0">, </span><span class="s1">divide</span><span class="s0">, </span><span class="s1">equal</span><span class="s0">, </span><span class="s1">exp</span><span class="s0">, </span><span class="s1">filled</span><span class="s0">,</span>
    <span class="s1">getmask</span><span class="s0">, </span><span class="s1">greater</span><span class="s0">, </span><span class="s1">greater_equal</span><span class="s0">, </span><span class="s1">inner</span><span class="s0">, </span><span class="s1">isMaskedArray</span><span class="s0">, </span><span class="s1">less</span><span class="s0">,</span>
    <span class="s1">less_equal</span><span class="s0">, </span><span class="s1">log</span><span class="s0">, </span><span class="s1">log10</span><span class="s0">, </span><span class="s1">make_mask</span><span class="s0">, </span><span class="s1">masked</span><span class="s0">, </span><span class="s1">masked_array</span><span class="s0">, </span><span class="s1">masked_equal</span><span class="s0">,</span>
    <span class="s1">masked_greater</span><span class="s0">, </span><span class="s1">masked_greater_equal</span><span class="s0">, </span><span class="s1">masked_inside</span><span class="s0">, </span><span class="s1">masked_less</span><span class="s0">,</span>
    <span class="s1">masked_less_equal</span><span class="s0">, </span><span class="s1">masked_not_equal</span><span class="s0">, </span><span class="s1">masked_outside</span><span class="s0">,</span>
    <span class="s1">masked_print_option</span><span class="s0">, </span><span class="s1">masked_values</span><span class="s0">, </span><span class="s1">masked_where</span><span class="s0">, </span><span class="s1">maximum</span><span class="s0">, </span><span class="s1">minimum</span><span class="s0">,</span>
    <span class="s1">multiply</span><span class="s0">, </span><span class="s1">nomask</span><span class="s0">, </span><span class="s1">nonzero</span><span class="s0">, </span><span class="s1">not_equal</span><span class="s0">, </span><span class="s1">ones</span><span class="s0">, </span><span class="s1">outer</span><span class="s0">, </span><span class="s1">product</span><span class="s0">, </span><span class="s1">put</span><span class="s0">, </span><span class="s1">ravel</span><span class="s0">,</span>
    <span class="s1">repeat</span><span class="s0">, </span><span class="s1">resize</span><span class="s0">, </span><span class="s1">shape</span><span class="s0">, </span><span class="s1">sin</span><span class="s0">, </span><span class="s1">sinh</span><span class="s0">, </span><span class="s1">sometrue</span><span class="s0">, </span><span class="s1">sort</span><span class="s0">, </span><span class="s1">sqrt</span><span class="s0">, </span><span class="s1">subtract</span><span class="s0">, </span><span class="s1">sum</span><span class="s0">,</span>
    <span class="s1">take</span><span class="s0">, </span><span class="s1">tan</span><span class="s0">, </span><span class="s1">tanh</span><span class="s0">, </span><span class="s1">transpose</span><span class="s0">, </span><span class="s1">where</span><span class="s0">, </span><span class="s1">zeros</span><span class="s0">,</span>
    <span class="s1">)</span>
<span class="s0">from </span><span class="s1">numpy.compat </span><span class="s0">import </span><span class="s1">pickle</span>

<span class="s1">pi = np.pi</span>


<span class="s0">def </span><span class="s1">eq(v</span><span class="s0">, </span><span class="s1">w</span><span class="s0">, </span><span class="s1">msg=</span><span class="s2">''</span><span class="s1">):</span>
    <span class="s1">result = allclose(v</span><span class="s0">, </span><span class="s1">w)</span>
    <span class="s0">if not </span><span class="s1">result:</span>
        <span class="s1">print(</span><span class="s2">f'Not eq:</span><span class="s0">{</span><span class="s1">msg</span><span class="s0">}\n{</span><span class="s1">v</span><span class="s0">}\n</span><span class="s2">----</span><span class="s0">{</span><span class="s1">w</span><span class="s0">}</span><span class="s2">'</span><span class="s1">)</span>
    <span class="s0">return </span><span class="s1">result</span>


<span class="s0">class </span><span class="s1">TestMa:</span>

    <span class="s0">def </span><span class="s1">setup(self):</span>
        <span class="s1">x = np.array([</span><span class="s3">1.</span><span class="s0">, </span><span class="s3">1.</span><span class="s0">, </span><span class="s3">1.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">2.</span><span class="s0">, </span><span class="s1">pi/</span><span class="s3">2.0</span><span class="s0">, </span><span class="s3">4.</span><span class="s0">, </span><span class="s3">5.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">10.</span><span class="s0">, </span><span class="s3">10.</span><span class="s0">, </span><span class="s3">1.</span><span class="s0">, </span><span class="s3">2.</span><span class="s0">, </span><span class="s3">3.</span><span class="s1">])</span>
        <span class="s1">y = np.array([</span><span class="s3">5.</span><span class="s0">, </span><span class="s3">0.</span><span class="s0">, </span><span class="s3">3.</span><span class="s0">, </span><span class="s3">2.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">4.</span><span class="s0">, </span><span class="s3">0.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">10.</span><span class="s0">, </span><span class="s3">10.</span><span class="s0">, </span><span class="s3">1.</span><span class="s0">, </span><span class="s3">0.</span><span class="s0">, </span><span class="s3">3.</span><span class="s1">])</span>
        <span class="s1">a10 = </span><span class="s3">10.</span>
        <span class="s1">m1 = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span>
        <span class="s1">m2 = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>
        <span class="s1">xm = array(x</span><span class="s0">, </span><span class="s1">mask=m1)</span>
        <span class="s1">ym = array(y</span><span class="s0">, </span><span class="s1">mask=m2)</span>
        <span class="s1">z = np.array([-</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">0.</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.8</span><span class="s1">])</span>
        <span class="s1">zm = array(z</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">xf = np.where(m1</span><span class="s0">, </span><span class="s3">1e+20</span><span class="s0">, </span><span class="s1">x)</span>
        <span class="s1">s = x.shape</span>
        <span class="s1">xm.set_fill_value(</span><span class="s3">1e+20</span><span class="s1">)</span>
        <span class="s1">self.d = (x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">a10</span><span class="s0">, </span><span class="s1">m1</span><span class="s0">, </span><span class="s1">m2</span><span class="s0">, </span><span class="s1">xm</span><span class="s0">, </span><span class="s1">ym</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">zm</span><span class="s0">, </span><span class="s1">xf</span><span class="s0">, </span><span class="s1">s)</span>

    <span class="s0">def </span><span class="s1">test_testBasic1d(self):</span>
        <span class="s4"># Test of basic array creation and properties in 1 dimension.</span>
        <span class="s1">(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">a10</span><span class="s0">, </span><span class="s1">m1</span><span class="s0">, </span><span class="s1">m2</span><span class="s0">, </span><span class="s1">xm</span><span class="s0">, </span><span class="s1">ym</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">zm</span><span class="s0">, </span><span class="s1">xf</span><span class="s0">, </span><span class="s1">s) = self.d</span>
        <span class="s1">assert_(</span><span class="s0">not </span><span class="s1">isMaskedArray(x))</span>
        <span class="s1">assert_(isMaskedArray(xm))</span>
        <span class="s1">assert_equal(shape(xm)</span><span class="s0">, </span><span class="s1">s)</span>
        <span class="s1">assert_equal(xm.shape</span><span class="s0">, </span><span class="s1">s)</span>
        <span class="s1">assert_equal(xm.dtype</span><span class="s0">, </span><span class="s1">x.dtype)</span>
        <span class="s1">assert_equal(xm.size</span><span class="s0">, </span><span class="s1">reduce(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y:x * y</span><span class="s0">, </span><span class="s1">s))</span>
        <span class="s1">assert_equal(count(xm)</span><span class="s0">, </span><span class="s1">len(m1) - reduce(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y:x + y</span><span class="s0">, </span><span class="s1">m1))</span>
        <span class="s1">assert_(eq(xm</span><span class="s0">, </span><span class="s1">xf))</span>
        <span class="s1">assert_(eq(filled(xm</span><span class="s0">, </span><span class="s3">1.e20</span><span class="s1">)</span><span class="s0">, </span><span class="s1">xf))</span>
        <span class="s1">assert_(eq(x</span><span class="s0">, </span><span class="s1">xm))</span>

    <span class="s0">def </span><span class="s1">test_testBasic2d(self):</span>
        <span class="s4"># Test of basic array creation and properties in 2 dimensions.</span>
        <span class="s0">for </span><span class="s1">s </span><span class="s0">in </span><span class="s1">[(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">6</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)]:</span>
            <span class="s1">(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">a10</span><span class="s0">, </span><span class="s1">m1</span><span class="s0">, </span><span class="s1">m2</span><span class="s0">, </span><span class="s1">xm</span><span class="s0">, </span><span class="s1">ym</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">zm</span><span class="s0">, </span><span class="s1">xf</span><span class="s0">, </span><span class="s1">s) = self.d</span>
            <span class="s1">x.shape = s</span>
            <span class="s1">y.shape = s</span>
            <span class="s1">xm.shape = s</span>
            <span class="s1">ym.shape = s</span>
            <span class="s1">xf.shape = s</span>

            <span class="s1">assert_(</span><span class="s0">not </span><span class="s1">isMaskedArray(x))</span>
            <span class="s1">assert_(isMaskedArray(xm))</span>
            <span class="s1">assert_equal(shape(xm)</span><span class="s0">, </span><span class="s1">s)</span>
            <span class="s1">assert_equal(xm.shape</span><span class="s0">, </span><span class="s1">s)</span>
            <span class="s1">assert_equal(xm.size</span><span class="s0">, </span><span class="s1">reduce(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y:x * y</span><span class="s0">, </span><span class="s1">s))</span>
            <span class="s1">assert_equal(count(xm)</span><span class="s0">,</span>
                             <span class="s1">len(m1) - reduce(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y:x + y</span><span class="s0">, </span><span class="s1">m1))</span>
            <span class="s1">assert_(eq(xm</span><span class="s0">, </span><span class="s1">xf))</span>
            <span class="s1">assert_(eq(filled(xm</span><span class="s0">, </span><span class="s3">1.e20</span><span class="s1">)</span><span class="s0">, </span><span class="s1">xf))</span>
            <span class="s1">assert_(eq(x</span><span class="s0">, </span><span class="s1">xm))</span>
            <span class="s1">self.setup()</span>

    <span class="s0">def </span><span class="s1">test_testArithmetic(self):</span>
        <span class="s4"># Test of basic arithmetic.</span>
        <span class="s1">(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">a10</span><span class="s0">, </span><span class="s1">m1</span><span class="s0">, </span><span class="s1">m2</span><span class="s0">, </span><span class="s1">xm</span><span class="s0">, </span><span class="s1">ym</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">zm</span><span class="s0">, </span><span class="s1">xf</span><span class="s0">, </span><span class="s1">s) = self.d</span>
        <span class="s1">a2d = array([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]])</span>
        <span class="s1">a2dm = masked_array(a2d</span><span class="s0">, </span><span class="s1">[[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]])</span>
        <span class="s1">assert_(eq(a2d * a2d</span><span class="s0">, </span><span class="s1">a2d * a2dm))</span>
        <span class="s1">assert_(eq(a2d + a2d</span><span class="s0">, </span><span class="s1">a2d + a2dm))</span>
        <span class="s1">assert_(eq(a2d - a2d</span><span class="s0">, </span><span class="s1">a2d - a2dm))</span>
        <span class="s0">for </span><span class="s1">s </span><span class="s0">in </span><span class="s1">[(</span><span class="s3">12</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">6</span><span class="s1">)]:</span>
            <span class="s1">x = x.reshape(s)</span>
            <span class="s1">y = y.reshape(s)</span>
            <span class="s1">xm = xm.reshape(s)</span>
            <span class="s1">ym = ym.reshape(s)</span>
            <span class="s1">xf = xf.reshape(s)</span>
            <span class="s1">assert_(eq(-x</span><span class="s0">, </span><span class="s1">-xm))</span>
            <span class="s1">assert_(eq(x + y</span><span class="s0">, </span><span class="s1">xm + ym))</span>
            <span class="s1">assert_(eq(x - y</span><span class="s0">, </span><span class="s1">xm - ym))</span>
            <span class="s1">assert_(eq(x * y</span><span class="s0">, </span><span class="s1">xm * ym))</span>
            <span class="s0">with </span><span class="s1">np.errstate(divide=</span><span class="s2">'ignore'</span><span class="s0">, </span><span class="s1">invalid=</span><span class="s2">'ignore'</span><span class="s1">):</span>
                <span class="s1">assert_(eq(x / y</span><span class="s0">, </span><span class="s1">xm / ym))</span>
            <span class="s1">assert_(eq(a10 + y</span><span class="s0">, </span><span class="s1">a10 + ym))</span>
            <span class="s1">assert_(eq(a10 - y</span><span class="s0">, </span><span class="s1">a10 - ym))</span>
            <span class="s1">assert_(eq(a10 * y</span><span class="s0">, </span><span class="s1">a10 * ym))</span>
            <span class="s0">with </span><span class="s1">np.errstate(divide=</span><span class="s2">'ignore'</span><span class="s0">, </span><span class="s1">invalid=</span><span class="s2">'ignore'</span><span class="s1">):</span>
                <span class="s1">assert_(eq(a10 / y</span><span class="s0">, </span><span class="s1">a10 / ym))</span>
            <span class="s1">assert_(eq(x + a10</span><span class="s0">, </span><span class="s1">xm + a10))</span>
            <span class="s1">assert_(eq(x - a10</span><span class="s0">, </span><span class="s1">xm - a10))</span>
            <span class="s1">assert_(eq(x * a10</span><span class="s0">, </span><span class="s1">xm * a10))</span>
            <span class="s1">assert_(eq(x / a10</span><span class="s0">, </span><span class="s1">xm / a10))</span>
            <span class="s1">assert_(eq(x ** </span><span class="s3">2</span><span class="s0">, </span><span class="s1">xm ** </span><span class="s3">2</span><span class="s1">))</span>
            <span class="s1">assert_(eq(abs(x) ** </span><span class="s3">2.5</span><span class="s0">, </span><span class="s1">abs(xm) ** </span><span class="s3">2.5</span><span class="s1">))</span>
            <span class="s1">assert_(eq(x ** y</span><span class="s0">, </span><span class="s1">xm ** ym))</span>
            <span class="s1">assert_(eq(np.add(x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">add(xm</span><span class="s0">, </span><span class="s1">ym)))</span>
            <span class="s1">assert_(eq(np.subtract(x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">subtract(xm</span><span class="s0">, </span><span class="s1">ym)))</span>
            <span class="s1">assert_(eq(np.multiply(x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">multiply(xm</span><span class="s0">, </span><span class="s1">ym)))</span>
            <span class="s0">with </span><span class="s1">np.errstate(divide=</span><span class="s2">'ignore'</span><span class="s0">, </span><span class="s1">invalid=</span><span class="s2">'ignore'</span><span class="s1">):</span>
                <span class="s1">assert_(eq(np.divide(x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">divide(xm</span><span class="s0">, </span><span class="s1">ym)))</span>

    <span class="s0">def </span><span class="s1">test_testMixedArithmetic(self):</span>
        <span class="s1">na = np.array([</span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">ma = array([</span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">assert_(isinstance(na + ma</span><span class="s0">, </span><span class="s1">MaskedArray))</span>
        <span class="s1">assert_(isinstance(ma + na</span><span class="s0">, </span><span class="s1">MaskedArray))</span>

    <span class="s0">def </span><span class="s1">test_testUfuncs1(self):</span>
        <span class="s4"># Test various functions such as sin, cos.</span>
        <span class="s1">(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">a10</span><span class="s0">, </span><span class="s1">m1</span><span class="s0">, </span><span class="s1">m2</span><span class="s0">, </span><span class="s1">xm</span><span class="s0">, </span><span class="s1">ym</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">zm</span><span class="s0">, </span><span class="s1">xf</span><span class="s0">, </span><span class="s1">s) = self.d</span>
        <span class="s1">assert_(eq(np.cos(x)</span><span class="s0">, </span><span class="s1">cos(xm)))</span>
        <span class="s1">assert_(eq(np.cosh(x)</span><span class="s0">, </span><span class="s1">cosh(xm)))</span>
        <span class="s1">assert_(eq(np.sin(x)</span><span class="s0">, </span><span class="s1">sin(xm)))</span>
        <span class="s1">assert_(eq(np.sinh(x)</span><span class="s0">, </span><span class="s1">sinh(xm)))</span>
        <span class="s1">assert_(eq(np.tan(x)</span><span class="s0">, </span><span class="s1">tan(xm)))</span>
        <span class="s1">assert_(eq(np.tanh(x)</span><span class="s0">, </span><span class="s1">tanh(xm)))</span>
        <span class="s0">with </span><span class="s1">np.errstate(divide=</span><span class="s2">'ignore'</span><span class="s0">, </span><span class="s1">invalid=</span><span class="s2">'ignore'</span><span class="s1">):</span>
            <span class="s1">assert_(eq(np.sqrt(abs(x))</span><span class="s0">, </span><span class="s1">sqrt(xm)))</span>
            <span class="s1">assert_(eq(np.log(abs(x))</span><span class="s0">, </span><span class="s1">log(xm)))</span>
            <span class="s1">assert_(eq(np.log10(abs(x))</span><span class="s0">, </span><span class="s1">log10(xm)))</span>
        <span class="s1">assert_(eq(np.exp(x)</span><span class="s0">, </span><span class="s1">exp(xm)))</span>
        <span class="s1">assert_(eq(np.arcsin(z)</span><span class="s0">, </span><span class="s1">arcsin(zm)))</span>
        <span class="s1">assert_(eq(np.arccos(z)</span><span class="s0">, </span><span class="s1">arccos(zm)))</span>
        <span class="s1">assert_(eq(np.arctan(z)</span><span class="s0">, </span><span class="s1">arctan(zm)))</span>
        <span class="s1">assert_(eq(np.arctan2(x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">arctan2(xm</span><span class="s0">, </span><span class="s1">ym)))</span>
        <span class="s1">assert_(eq(np.absolute(x)</span><span class="s0">, </span><span class="s1">absolute(xm)))</span>
        <span class="s1">assert_(eq(np.equal(x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">equal(xm</span><span class="s0">, </span><span class="s1">ym)))</span>
        <span class="s1">assert_(eq(np.not_equal(x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">not_equal(xm</span><span class="s0">, </span><span class="s1">ym)))</span>
        <span class="s1">assert_(eq(np.less(x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">less(xm</span><span class="s0">, </span><span class="s1">ym)))</span>
        <span class="s1">assert_(eq(np.greater(x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">greater(xm</span><span class="s0">, </span><span class="s1">ym)))</span>
        <span class="s1">assert_(eq(np.less_equal(x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">less_equal(xm</span><span class="s0">, </span><span class="s1">ym)))</span>
        <span class="s1">assert_(eq(np.greater_equal(x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">greater_equal(xm</span><span class="s0">, </span><span class="s1">ym)))</span>
        <span class="s1">assert_(eq(np.conjugate(x)</span><span class="s0">, </span><span class="s1">conjugate(xm)))</span>
        <span class="s1">assert_(eq(np.concatenate((x</span><span class="s0">, </span><span class="s1">y))</span><span class="s0">, </span><span class="s1">concatenate((xm</span><span class="s0">, </span><span class="s1">ym))))</span>
        <span class="s1">assert_(eq(np.concatenate((x</span><span class="s0">, </span><span class="s1">y))</span><span class="s0">, </span><span class="s1">concatenate((x</span><span class="s0">, </span><span class="s1">y))))</span>
        <span class="s1">assert_(eq(np.concatenate((x</span><span class="s0">, </span><span class="s1">y))</span><span class="s0">, </span><span class="s1">concatenate((xm</span><span class="s0">, </span><span class="s1">y))))</span>
        <span class="s1">assert_(eq(np.concatenate((x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">x))</span><span class="s0">, </span><span class="s1">concatenate((x</span><span class="s0">, </span><span class="s1">ym</span><span class="s0">, </span><span class="s1">x))))</span>

    <span class="s0">def </span><span class="s1">test_xtestCount(self):</span>
        <span class="s4"># Test count</span>
        <span class="s1">ott = array([</span><span class="s3">0.</span><span class="s0">, </span><span class="s3">1.</span><span class="s0">, </span><span class="s3">2.</span><span class="s0">, </span><span class="s3">3.</span><span class="s1">]</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">assert_(count(ott).dtype.type </span><span class="s0">is </span><span class="s1">np.intp)</span>
        <span class="s1">assert_equal(</span><span class="s3">3</span><span class="s0">, </span><span class="s1">count(ott))</span>
        <span class="s1">assert_equal(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">count(</span><span class="s3">1</span><span class="s1">))</span>
        <span class="s1">assert_(eq(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">array(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s3">1</span><span class="s1">])))</span>
        <span class="s1">ott = ott.reshape((</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">))</span>
        <span class="s1">assert_(count(ott).dtype.type </span><span class="s0">is </span><span class="s1">np.intp)</span>
        <span class="s1">assert_(isinstance(count(ott</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.ndarray))</span>
        <span class="s1">assert_(count(ott).dtype.type </span><span class="s0">is </span><span class="s1">np.intp)</span>
        <span class="s1">assert_(eq(</span><span class="s3">3</span><span class="s0">, </span><span class="s1">count(ott)))</span>
        <span class="s1">assert_(getmask(count(ott</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)) </span><span class="s0">is </span><span class="s1">nomask)</span>
        <span class="s1">assert_(eq([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">count(ott</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)))</span>

    <span class="s0">def </span><span class="s1">test_testMinMax(self):</span>
        <span class="s4"># Test minimum and maximum.</span>
        <span class="s1">(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">a10</span><span class="s0">, </span><span class="s1">m1</span><span class="s0">, </span><span class="s1">m2</span><span class="s0">, </span><span class="s1">xm</span><span class="s0">, </span><span class="s1">ym</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">zm</span><span class="s0">, </span><span class="s1">xf</span><span class="s0">, </span><span class="s1">s) = self.d</span>
        <span class="s1">xr = np.ravel(x)  </span><span class="s4"># max doesn't work if shaped</span>
        <span class="s1">xmr = ravel(xm)</span>

        <span class="s4"># true because of careful selection of data</span>
        <span class="s1">assert_(eq(max(xr)</span><span class="s0">, </span><span class="s1">maximum.reduce(xmr)))</span>
        <span class="s1">assert_(eq(min(xr)</span><span class="s0">, </span><span class="s1">minimum.reduce(xmr)))</span>

    <span class="s0">def </span><span class="s1">test_testAddSumProd(self):</span>
        <span class="s4"># Test add, sum, product.</span>
        <span class="s1">(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">a10</span><span class="s0">, </span><span class="s1">m1</span><span class="s0">, </span><span class="s1">m2</span><span class="s0">, </span><span class="s1">xm</span><span class="s0">, </span><span class="s1">ym</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">zm</span><span class="s0">, </span><span class="s1">xf</span><span class="s0">, </span><span class="s1">s) = self.d</span>
        <span class="s1">assert_(eq(np.add.reduce(x)</span><span class="s0">, </span><span class="s1">add.reduce(x)))</span>
        <span class="s1">assert_(eq(np.add.accumulate(x)</span><span class="s0">, </span><span class="s1">add.accumulate(x)))</span>
        <span class="s1">assert_(eq(</span><span class="s3">4</span><span class="s0">, </span><span class="s1">sum(array(</span><span class="s3">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)))</span>
        <span class="s1">assert_(eq(</span><span class="s3">4</span><span class="s0">, </span><span class="s1">sum(array(</span><span class="s3">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)))</span>
        <span class="s1">assert_(eq(np.sum(x</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">sum(x</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)))</span>
        <span class="s1">assert_(eq(np.sum(filled(xm</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">sum(xm</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)))</span>
        <span class="s1">assert_(eq(np.sum(x</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">sum(x</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)))</span>
        <span class="s1">assert_(eq(np.product(x</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">product(x</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)))</span>
        <span class="s1">assert_(eq(np.product(x</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">product(x</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)))</span>
        <span class="s1">assert_(eq(np.product(filled(xm</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
                           <span class="s1">product(xm</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)))</span>
        <span class="s0">if </span><span class="s1">len(s) &gt; </span><span class="s3">1</span><span class="s1">:</span>
            <span class="s1">assert_(eq(np.concatenate((x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
                               <span class="s1">concatenate((xm</span><span class="s0">, </span><span class="s1">ym)</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)))</span>
            <span class="s1">assert_(eq(np.add.reduce(x</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">add.reduce(x</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)))</span>
            <span class="s1">assert_(eq(np.sum(x</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">sum(x</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)))</span>
            <span class="s1">assert_(eq(np.product(x</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">product(x</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)))</span>

    <span class="s0">def </span><span class="s1">test_testCI(self):</span>
        <span class="s4"># Test of conversions and indexing</span>
        <span class="s1">x1 = np.array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">x2 = array(x1</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">x3 = array(x1</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">x4 = array(x1)</span>
        <span class="s4"># test conversion to strings</span>
        <span class="s1">str(x2)  </span><span class="s4"># raises?</span>
        <span class="s1">repr(x2)  </span><span class="s4"># raises?</span>
        <span class="s1">assert_(eq(np.sort(x1)</span><span class="s0">, </span><span class="s1">sort(x2</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s3">0</span><span class="s1">)))</span>
        <span class="s4"># tests of indexing</span>
        <span class="s1">assert_(type(x2[</span><span class="s3">1</span><span class="s1">]) </span><span class="s0">is </span><span class="s1">type(x1[</span><span class="s3">1</span><span class="s1">]))</span>
        <span class="s1">assert_(x1[</span><span class="s3">1</span><span class="s1">] == x2[</span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">assert_(x2[</span><span class="s3">0</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(eq(x1[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x2[</span><span class="s3">2</span><span class="s1">]))</span>
        <span class="s1">assert_(eq(x1[</span><span class="s3">2</span><span class="s1">:</span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x2[</span><span class="s3">2</span><span class="s1">:</span><span class="s3">5</span><span class="s1">]))</span>
        <span class="s1">assert_(eq(x1[:]</span><span class="s0">, </span><span class="s1">x2[:]))</span>
        <span class="s1">assert_(eq(x1[</span><span class="s3">1</span><span class="s1">:]</span><span class="s0">, </span><span class="s1">x3[</span><span class="s3">1</span><span class="s1">:]))</span>
        <span class="s1">x1[</span><span class="s3">2</span><span class="s1">] = </span><span class="s3">9</span>
        <span class="s1">x2[</span><span class="s3">2</span><span class="s1">] = </span><span class="s3">9</span>
        <span class="s1">assert_(eq(x1</span><span class="s0">, </span><span class="s1">x2))</span>
        <span class="s1">x1[</span><span class="s3">1</span><span class="s1">:</span><span class="s3">3</span><span class="s1">] = </span><span class="s3">99</span>
        <span class="s1">x2[</span><span class="s3">1</span><span class="s1">:</span><span class="s3">3</span><span class="s1">] = </span><span class="s3">99</span>
        <span class="s1">assert_(eq(x1</span><span class="s0">, </span><span class="s1">x2))</span>
        <span class="s1">x2[</span><span class="s3">1</span><span class="s1">] = masked</span>
        <span class="s1">assert_(eq(x1</span><span class="s0">, </span><span class="s1">x2))</span>
        <span class="s1">x2[</span><span class="s3">1</span><span class="s1">:</span><span class="s3">3</span><span class="s1">] = masked</span>
        <span class="s1">assert_(eq(x1</span><span class="s0">, </span><span class="s1">x2))</span>
        <span class="s1">x2[:] = x1</span>
        <span class="s1">x2[</span><span class="s3">1</span><span class="s1">] = masked</span>
        <span class="s1">assert_(allequal(getmask(x2)</span><span class="s0">, </span><span class="s1">array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])))</span>
        <span class="s1">x3[:] = masked_array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">assert_(allequal(getmask(x3)</span><span class="s0">, </span><span class="s1">array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])))</span>
        <span class="s1">x4[:] = masked_array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">assert_(allequal(getmask(x4)</span><span class="s0">, </span><span class="s1">array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])))</span>
        <span class="s1">assert_(allequal(x4</span><span class="s0">, </span><span class="s1">array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">])))</span>
        <span class="s1">x1 = np.arange(</span><span class="s3">5</span><span class="s1">) * </span><span class="s3">1.0</span>
        <span class="s1">x2 = masked_values(x1</span><span class="s0">, </span><span class="s3">3.0</span><span class="s1">)</span>
        <span class="s1">assert_(eq(x1</span><span class="s0">, </span><span class="s1">x2))</span>
        <span class="s1">assert_(allequal(array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">MaskType)</span><span class="s0">, </span><span class="s1">x2.mask))</span>
        <span class="s1">assert_(eq(</span><span class="s3">3.0</span><span class="s0">, </span><span class="s1">x2.fill_value))</span>
        <span class="s1">x1 = array([</span><span class="s3">1</span><span class="s0">, </span><span class="s2">'hello'</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">object)</span>
        <span class="s1">x2 = np.array([</span><span class="s3">1</span><span class="s0">, </span><span class="s2">'hello'</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">object)</span>
        <span class="s1">s1 = x1[</span><span class="s3">1</span><span class="s1">]</span>
        <span class="s1">s2 = x2[</span><span class="s3">1</span><span class="s1">]</span>
        <span class="s1">assert_equal(type(s2)</span><span class="s0">, </span><span class="s1">str)</span>
        <span class="s1">assert_equal(type(s1)</span><span class="s0">, </span><span class="s1">str)</span>
        <span class="s1">assert_equal(s1</span><span class="s0">, </span><span class="s1">s2)</span>
        <span class="s1">assert_(x1[</span><span class="s3">1</span><span class="s1">:</span><span class="s3">1</span><span class="s1">].shape == (</span><span class="s3">0</span><span class="s0">,</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_testCopySize(self):</span>
        <span class="s4"># Tests of some subtle points of copying and sizing.</span>
        <span class="s1">n = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span>
        <span class="s1">m = make_mask(n)</span>
        <span class="s1">m2 = make_mask(m)</span>
        <span class="s1">assert_(m </span><span class="s0">is </span><span class="s1">m2)</span>
        <span class="s1">m3 = make_mask(m</span><span class="s0">, </span><span class="s1">copy=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_(m </span><span class="s0">is not </span><span class="s1">m3)</span>

        <span class="s1">x1 = np.arange(</span><span class="s3">5</span><span class="s1">)</span>
        <span class="s1">y1 = array(x1</span><span class="s0">, </span><span class="s1">mask=m)</span>
        <span class="s1">assert_(y1._data </span><span class="s0">is not </span><span class="s1">x1)</span>
        <span class="s1">assert_(allequal(x1</span><span class="s0">, </span><span class="s1">y1._data))</span>
        <span class="s1">assert_(y1._mask </span><span class="s0">is </span><span class="s1">m)</span>

        <span class="s1">y1a = array(y1</span><span class="s0">, </span><span class="s1">copy=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s4"># For copy=False, one might expect that the array would just</span>
        <span class="s4"># passed on, i.e., that it would be &quot;is&quot; instead of &quot;==&quot;.</span>
        <span class="s4"># See gh-4043 for discussion.</span>
        <span class="s1">assert_(y1a._mask.__array_interface__ ==</span>
                <span class="s1">y1._mask.__array_interface__)</span>

        <span class="s1">y2 = array(x1</span><span class="s0">, </span><span class="s1">mask=m3</span><span class="s0">, </span><span class="s1">copy=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">assert_(y2._mask </span><span class="s0">is </span><span class="s1">m3)</span>
        <span class="s1">assert_(y2[</span><span class="s3">2</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">y2[</span><span class="s3">2</span><span class="s1">] = </span><span class="s3">9</span>
        <span class="s1">assert_(y2[</span><span class="s3">2</span><span class="s1">] </span><span class="s0">is not </span><span class="s1">masked)</span>
        <span class="s1">assert_(y2._mask </span><span class="s0">is </span><span class="s1">m3)</span>
        <span class="s1">assert_(allequal(y2.mask</span><span class="s0">, </span><span class="s3">0</span><span class="s1">))</span>

        <span class="s1">y2a = array(x1</span><span class="s0">, </span><span class="s1">mask=m</span><span class="s0">, </span><span class="s1">copy=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_(y2a._mask </span><span class="s0">is not </span><span class="s1">m)</span>
        <span class="s1">assert_(y2a[</span><span class="s3">2</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">y2a[</span><span class="s3">2</span><span class="s1">] = </span><span class="s3">9</span>
        <span class="s1">assert_(y2a[</span><span class="s3">2</span><span class="s1">] </span><span class="s0">is not </span><span class="s1">masked)</span>
        <span class="s1">assert_(y2a._mask </span><span class="s0">is not </span><span class="s1">m)</span>
        <span class="s1">assert_(allequal(y2a.mask</span><span class="s0">, </span><span class="s3">0</span><span class="s1">))</span>

        <span class="s1">y3 = array(x1 * </span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">mask=m)</span>
        <span class="s1">assert_(filled(y3).dtype </span><span class="s0">is </span><span class="s1">(x1 * </span><span class="s3">1.0</span><span class="s1">).dtype)</span>

        <span class="s1">x4 = arange(</span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">x4[</span><span class="s3">2</span><span class="s1">] = masked</span>
        <span class="s1">y4 = resize(x4</span><span class="s0">, </span><span class="s1">(</span><span class="s3">8</span><span class="s0">,</span><span class="s1">))</span>
        <span class="s1">assert_(eq(concatenate([x4</span><span class="s0">, </span><span class="s1">x4])</span><span class="s0">, </span><span class="s1">y4))</span>
        <span class="s1">assert_(eq(getmask(y4)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]))</span>
        <span class="s1">y5 = repeat(x4</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">assert_(eq(y5</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]))</span>
        <span class="s1">y6 = repeat(x4</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">assert_(eq(y5</span><span class="s0">, </span><span class="s1">y6))</span>

    <span class="s0">def </span><span class="s1">test_testPut(self):</span>
        <span class="s4"># Test of put</span>
        <span class="s1">d = arange(</span><span class="s3">5</span><span class="s1">)</span>
        <span class="s1">n = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>
        <span class="s1">m = make_mask(n)</span>
        <span class="s1">m2 = m.copy()</span>
        <span class="s1">x = array(d</span><span class="s0">, </span><span class="s1">mask=m)</span>
        <span class="s1">assert_(x[</span><span class="s3">3</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(x[</span><span class="s3">4</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">x[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]] = [</span><span class="s3">10</span><span class="s0">, </span><span class="s3">40</span><span class="s1">]</span>
        <span class="s1">assert_(x._mask </span><span class="s0">is </span><span class="s1">m)</span>
        <span class="s1">assert_(x[</span><span class="s3">3</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(x[</span><span class="s3">4</span><span class="s1">] </span><span class="s0">is not </span><span class="s1">masked)</span>
        <span class="s1">assert_(eq(x</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">40</span><span class="s1">]))</span>

        <span class="s1">x = array(d</span><span class="s0">, </span><span class="s1">mask=m2</span><span class="s0">, </span><span class="s1">copy=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">x.put([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s3">200</span><span class="s1">])</span>
        <span class="s1">assert_(x._mask </span><span class="s0">is not </span><span class="s1">m2)</span>
        <span class="s1">assert_(x[</span><span class="s3">3</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(x[</span><span class="s3">4</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(eq(x</span><span class="s0">, </span><span class="s1">[-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s3">200</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]))</span>

    <span class="s0">def </span><span class="s1">test_testPut2(self):</span>
        <span class="s4"># Test of put</span>
        <span class="s1">d = arange(</span><span class="s3">5</span><span class="s1">)</span>
        <span class="s1">x = array(d</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">z = array([</span><span class="s3">10</span><span class="s0">, </span><span class="s3">40</span><span class="s1">]</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">assert_(x[</span><span class="s3">2</span><span class="s1">] </span><span class="s0">is not </span><span class="s1">masked)</span>
        <span class="s1">assert_(x[</span><span class="s3">3</span><span class="s1">] </span><span class="s0">is not </span><span class="s1">masked)</span>
        <span class="s1">x[</span><span class="s3">2</span><span class="s1">:</span><span class="s3">4</span><span class="s1">] = z</span>
        <span class="s1">assert_(x[</span><span class="s3">2</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(x[</span><span class="s3">3</span><span class="s1">] </span><span class="s0">is not </span><span class="s1">masked)</span>
        <span class="s1">assert_(eq(x</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">40</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]))</span>

        <span class="s1">d = arange(</span><span class="s3">5</span><span class="s1">)</span>
        <span class="s1">x = array(d</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">y = x[</span><span class="s3">2</span><span class="s1">:</span><span class="s3">4</span><span class="s1">]</span>
        <span class="s1">z = array([</span><span class="s3">10</span><span class="s0">, </span><span class="s3">40</span><span class="s1">]</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">assert_(x[</span><span class="s3">2</span><span class="s1">] </span><span class="s0">is not </span><span class="s1">masked)</span>
        <span class="s1">assert_(x[</span><span class="s3">3</span><span class="s1">] </span><span class="s0">is not </span><span class="s1">masked)</span>
        <span class="s1">y[:] = z</span>
        <span class="s1">assert_(y[</span><span class="s3">0</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(y[</span><span class="s3">1</span><span class="s1">] </span><span class="s0">is not </span><span class="s1">masked)</span>
        <span class="s1">assert_(eq(y</span><span class="s0">, </span><span class="s1">[</span><span class="s3">10</span><span class="s0">, </span><span class="s3">40</span><span class="s1">]))</span>
        <span class="s1">assert_(x[</span><span class="s3">2</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(x[</span><span class="s3">3</span><span class="s1">] </span><span class="s0">is not </span><span class="s1">masked)</span>
        <span class="s1">assert_(eq(x</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">40</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]))</span>

    <span class="s0">def </span><span class="s1">test_testMaPut(self):</span>
        <span class="s1">(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">a10</span><span class="s0">, </span><span class="s1">m1</span><span class="s0">, </span><span class="s1">m2</span><span class="s0">, </span><span class="s1">xm</span><span class="s0">, </span><span class="s1">ym</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">zm</span><span class="s0">, </span><span class="s1">xf</span><span class="s0">, </span><span class="s1">s) = self.d</span>
        <span class="s1">m = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>
        <span class="s1">i = np.nonzero(m)[</span><span class="s3">0</span><span class="s1">]</span>
        <span class="s1">put(ym</span><span class="s0">, </span><span class="s1">i</span><span class="s0">, </span><span class="s1">zm)</span>
        <span class="s1">assert_(all(take(ym</span><span class="s0">, </span><span class="s1">i</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">) == zm))</span>

    <span class="s0">def </span><span class="s1">test_testOddFeatures(self):</span>
        <span class="s4"># Test of other odd features</span>
        <span class="s1">x = arange(</span><span class="s3">20</span><span class="s1">)</span>
        <span class="s1">x = x.reshape(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span>
        <span class="s1">x.flat[</span><span class="s3">5</span><span class="s1">] = </span><span class="s3">12</span>
        <span class="s1">assert_(x[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">] == </span><span class="s3">12</span><span class="s1">)</span>
        <span class="s1">z = x + </span><span class="s3">10j </span><span class="s1">* x</span>
        <span class="s1">assert_(eq(z.real</span><span class="s0">, </span><span class="s1">x))</span>
        <span class="s1">assert_(eq(z.imag</span><span class="s0">, </span><span class="s3">10 </span><span class="s1">* x))</span>
        <span class="s1">assert_(eq((z * conjugate(z)).real</span><span class="s0">, </span><span class="s3">101 </span><span class="s1">* x * x))</span>
        <span class="s1">z.imag[...] = </span><span class="s3">0.0</span>

        <span class="s1">x = arange(</span><span class="s3">10</span><span class="s1">)</span>
        <span class="s1">x[</span><span class="s3">3</span><span class="s1">] = masked</span>
        <span class="s1">assert_(str(x[</span><span class="s3">3</span><span class="s1">]) == str(masked))</span>
        <span class="s1">c = x &gt;= </span><span class="s3">8</span>
        <span class="s1">assert_(count(where(c</span><span class="s0">, </span><span class="s1">masked</span><span class="s0">, </span><span class="s1">masked)) == </span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">assert_(shape(where(c</span><span class="s0">, </span><span class="s1">masked</span><span class="s0">, </span><span class="s1">masked)) == c.shape)</span>
        <span class="s1">z = where(c</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">masked)</span>
        <span class="s1">assert_(z.dtype </span><span class="s0">is </span><span class="s1">x.dtype)</span>
        <span class="s1">assert_(z[</span><span class="s3">3</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(z[</span><span class="s3">4</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(z[</span><span class="s3">7</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(z[</span><span class="s3">8</span><span class="s1">] </span><span class="s0">is not </span><span class="s1">masked)</span>
        <span class="s1">assert_(z[</span><span class="s3">9</span><span class="s1">] </span><span class="s0">is not </span><span class="s1">masked)</span>
        <span class="s1">assert_(eq(x</span><span class="s0">, </span><span class="s1">z))</span>
        <span class="s1">z = where(c</span><span class="s0">, </span><span class="s1">masked</span><span class="s0">, </span><span class="s1">x)</span>
        <span class="s1">assert_(z.dtype </span><span class="s0">is </span><span class="s1">x.dtype)</span>
        <span class="s1">assert_(z[</span><span class="s3">3</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(z[</span><span class="s3">4</span><span class="s1">] </span><span class="s0">is not </span><span class="s1">masked)</span>
        <span class="s1">assert_(z[</span><span class="s3">7</span><span class="s1">] </span><span class="s0">is not </span><span class="s1">masked)</span>
        <span class="s1">assert_(z[</span><span class="s3">8</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(z[</span><span class="s3">9</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">z = masked_where(c</span><span class="s0">, </span><span class="s1">x)</span>
        <span class="s1">assert_(z.dtype </span><span class="s0">is </span><span class="s1">x.dtype)</span>
        <span class="s1">assert_(z[</span><span class="s3">3</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(z[</span><span class="s3">4</span><span class="s1">] </span><span class="s0">is not </span><span class="s1">masked)</span>
        <span class="s1">assert_(z[</span><span class="s3">7</span><span class="s1">] </span><span class="s0">is not </span><span class="s1">masked)</span>
        <span class="s1">assert_(z[</span><span class="s3">8</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(z[</span><span class="s3">9</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(eq(x</span><span class="s0">, </span><span class="s1">z))</span>
        <span class="s1">x = array([</span><span class="s3">1.</span><span class="s0">, </span><span class="s3">2.</span><span class="s0">, </span><span class="s3">3.</span><span class="s0">, </span><span class="s3">4.</span><span class="s0">, </span><span class="s3">5.</span><span class="s1">])</span>
        <span class="s1">c = array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">x[</span><span class="s3">2</span><span class="s1">] = masked</span>
        <span class="s1">z = where(c</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">-x)</span>
        <span class="s1">assert_(eq(z</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.</span><span class="s0">, </span><span class="s3">2.</span><span class="s0">, </span><span class="s3">0.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">4.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">5</span><span class="s1">]))</span>
        <span class="s1">c[</span><span class="s3">0</span><span class="s1">] = masked</span>
        <span class="s1">z = where(c</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">-x)</span>
        <span class="s1">assert_(eq(z</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.</span><span class="s0">, </span><span class="s3">2.</span><span class="s0">, </span><span class="s3">0.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">4.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">5</span><span class="s1">]))</span>
        <span class="s1">assert_(z[</span><span class="s3">0</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(z[</span><span class="s3">1</span><span class="s1">] </span><span class="s0">is not </span><span class="s1">masked)</span>
        <span class="s1">assert_(z[</span><span class="s3">2</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(eq(masked_where(greater(x</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">x)</span><span class="s0">, </span><span class="s1">masked_greater(x</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)))</span>
        <span class="s1">assert_(eq(masked_where(greater_equal(x</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">x)</span><span class="s0">,</span>
                   <span class="s1">masked_greater_equal(x</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)))</span>
        <span class="s1">assert_(eq(masked_where(less(x</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">x)</span><span class="s0">, </span><span class="s1">masked_less(x</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)))</span>
        <span class="s1">assert_(eq(masked_where(less_equal(x</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">x)</span><span class="s0">, </span><span class="s1">masked_less_equal(x</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)))</span>
        <span class="s1">assert_(eq(masked_where(not_equal(x</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">x)</span><span class="s0">, </span><span class="s1">masked_not_equal(x</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)))</span>
        <span class="s1">assert_(eq(masked_where(equal(x</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">x)</span><span class="s0">, </span><span class="s1">masked_equal(x</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)))</span>
        <span class="s1">assert_(eq(masked_where(not_equal(x</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">x)</span><span class="s0">, </span><span class="s1">masked_not_equal(x</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)))</span>
        <span class="s1">assert_(eq(masked_inside(list(range(</span><span class="s3">5</span><span class="s1">))</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">199</span><span class="s0">, </span><span class="s3">199</span><span class="s0">, </span><span class="s3">199</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]))</span>
        <span class="s1">assert_(eq(masked_outside(list(range(</span><span class="s3">5</span><span class="s1">))</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">199</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">199</span><span class="s1">]))</span>
        <span class="s1">assert_(eq(masked_inside(array(list(range(</span><span class="s3">5</span><span class="s1">))</span><span class="s0">,</span>
                                       <span class="s1">mask=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">).mask</span><span class="s0">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]))</span>
        <span class="s1">assert_(eq(masked_outside(array(list(range(</span><span class="s3">5</span><span class="s1">))</span><span class="s0">,</span>
                                        <span class="s1">mask=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">).mask</span><span class="s0">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]))</span>
        <span class="s1">assert_(eq(masked_equal(array(list(range(</span><span class="s3">5</span><span class="s1">))</span><span class="s0">,</span>
                                      <span class="s1">mask=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span><span class="s0">, </span><span class="s3">2</span><span class="s1">).mask</span><span class="s0">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]))</span>
        <span class="s1">assert_(eq(masked_not_equal(array([</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">,</span>
                                          <span class="s1">mask=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span><span class="s0">, </span><span class="s3">2</span><span class="s1">).mask</span><span class="s0">,</span>
                   <span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]))</span>
        <span class="s1">assert_(eq(masked_where([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">])</span><span class="s0">,</span>
                   <span class="s1">[</span><span class="s3">99</span><span class="s0">, </span><span class="s3">99</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]))</span>
        <span class="s1">atest = ones((</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=np.float32)</span>
        <span class="s1">btest = zeros(atest.shape</span><span class="s0">, </span><span class="s1">MaskType)</span>
        <span class="s1">ctest = masked_where(btest</span><span class="s0">, </span><span class="s1">atest)</span>
        <span class="s1">assert_(eq(atest</span><span class="s0">, </span><span class="s1">ctest))</span>
        <span class="s1">z = choose(c</span><span class="s0">, </span><span class="s1">(-x</span><span class="s0">, </span><span class="s1">x))</span>
        <span class="s1">assert_(eq(z</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.</span><span class="s0">, </span><span class="s3">2.</span><span class="s0">, </span><span class="s3">0.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">4.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">5</span><span class="s1">]))</span>
        <span class="s1">assert_(z[</span><span class="s3">0</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(z[</span><span class="s3">1</span><span class="s1">] </span><span class="s0">is not </span><span class="s1">masked)</span>
        <span class="s1">assert_(z[</span><span class="s3">2</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">x = arange(</span><span class="s3">6</span><span class="s1">)</span>
        <span class="s1">x[</span><span class="s3">5</span><span class="s1">] = masked</span>
        <span class="s1">y = arange(</span><span class="s3">6</span><span class="s1">) * </span><span class="s3">10</span>
        <span class="s1">y[</span><span class="s3">2</span><span class="s1">] = masked</span>
        <span class="s1">c = array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">cm = c.filled(</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">z = where(c</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y)</span>
        <span class="s1">zm = where(cm</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y)</span>
        <span class="s1">assert_(eq(z</span><span class="s0">, </span><span class="s1">zm))</span>
        <span class="s1">assert_(getmask(zm) </span><span class="s0">is </span><span class="s1">nomask)</span>
        <span class="s1">assert_(eq(zm</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">30</span><span class="s0">, </span><span class="s3">40</span><span class="s0">, </span><span class="s3">50</span><span class="s1">]))</span>
        <span class="s1">z = where(c</span><span class="s0">, </span><span class="s1">masked</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_(eq(z</span><span class="s0">, </span><span class="s1">[</span><span class="s3">99</span><span class="s0">, </span><span class="s3">99</span><span class="s0">, </span><span class="s3">99</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]))</span>
        <span class="s1">z = where(c</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">masked)</span>
        <span class="s1">assert_(eq(z</span><span class="s0">, </span><span class="s1">[</span><span class="s3">99</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">99</span><span class="s0">, </span><span class="s3">99</span><span class="s0">, </span><span class="s3">99</span><span class="s1">]))</span>

    <span class="s0">def </span><span class="s1">test_testMinMax2(self):</span>
        <span class="s4"># Test of minimum, maximum.</span>
        <span class="s1">assert_(eq(minimum([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">4</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">9</span><span class="s1">])</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]))</span>
        <span class="s1">assert_(eq(maximum([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">4</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">9</span><span class="s1">])</span><span class="s0">, </span><span class="s1">[</span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">9</span><span class="s1">]))</span>
        <span class="s1">x = arange(</span><span class="s3">5</span><span class="s1">)</span>
        <span class="s1">y = arange(</span><span class="s3">5</span><span class="s1">) - </span><span class="s3">2</span>
        <span class="s1">x[</span><span class="s3">3</span><span class="s1">] = masked</span>
        <span class="s1">y[</span><span class="s3">0</span><span class="s1">] = masked</span>
        <span class="s1">assert_(eq(minimum(x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">where(less(x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y)))</span>
        <span class="s1">assert_(eq(maximum(x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">where(greater(x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y)))</span>
        <span class="s1">assert_(minimum.reduce(x) == </span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">assert_(maximum.reduce(x) == </span><span class="s3">4</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_testTakeTransposeInnerOuter(self):</span>
        <span class="s4"># Test of take, transpose, inner, outer products</span>
        <span class="s1">x = arange(</span><span class="s3">24</span><span class="s1">)</span>
        <span class="s1">y = np.arange(</span><span class="s3">24</span><span class="s1">)</span>
        <span class="s1">x[</span><span class="s3">5</span><span class="s1">:</span><span class="s3">6</span><span class="s1">] = masked</span>
        <span class="s1">x = x.reshape(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">y = y.reshape(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">assert_(eq(np.transpose(y</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span><span class="s0">, </span><span class="s1">transpose(x</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))))</span>
        <span class="s1">assert_(eq(np.take(y</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">take(x</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)))</span>
        <span class="s1">assert_(eq(np.inner(filled(x</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">filled(y</span><span class="s0">, </span><span class="s3">0</span><span class="s1">))</span><span class="s0">,</span>
                   <span class="s1">inner(x</span><span class="s0">, </span><span class="s1">y)))</span>
        <span class="s1">assert_(eq(np.outer(filled(x</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">filled(y</span><span class="s0">, </span><span class="s3">0</span><span class="s1">))</span><span class="s0">,</span>
                   <span class="s1">outer(x</span><span class="s0">, </span><span class="s1">y)))</span>
        <span class="s1">y = array([</span><span class="s2">'abc'</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s2">'def'</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">object)</span>
        <span class="s1">y[</span><span class="s3">2</span><span class="s1">] = masked</span>
        <span class="s1">t = take(y</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">])</span>
        <span class="s1">assert_(t[</span><span class="s3">0</span><span class="s1">] == </span><span class="s2">'abc'</span><span class="s1">)</span>
        <span class="s1">assert_(t[</span><span class="s3">1</span><span class="s1">] == </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_(t[</span><span class="s3">2</span><span class="s1">] == </span><span class="s3">3</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_testInplace(self):</span>
        <span class="s4"># Test of inplace operations and rich comparisons</span>
        <span class="s1">y = arange(</span><span class="s3">10</span><span class="s1">)</span>

        <span class="s1">x = arange(</span><span class="s3">10</span><span class="s1">)</span>
        <span class="s1">xm = arange(</span><span class="s3">10</span><span class="s1">)</span>
        <span class="s1">xm[</span><span class="s3">2</span><span class="s1">] = masked</span>
        <span class="s1">x += </span><span class="s3">1</span>
        <span class="s1">assert_(eq(x</span><span class="s0">, </span><span class="s1">y + </span><span class="s3">1</span><span class="s1">))</span>
        <span class="s1">xm += </span><span class="s3">1</span>
        <span class="s1">assert_(eq(x</span><span class="s0">, </span><span class="s1">y + </span><span class="s3">1</span><span class="s1">))</span>

        <span class="s1">x = arange(</span><span class="s3">10</span><span class="s1">)</span>
        <span class="s1">xm = arange(</span><span class="s3">10</span><span class="s1">)</span>
        <span class="s1">xm[</span><span class="s3">2</span><span class="s1">] = masked</span>
        <span class="s1">x -= </span><span class="s3">1</span>
        <span class="s1">assert_(eq(x</span><span class="s0">, </span><span class="s1">y - </span><span class="s3">1</span><span class="s1">))</span>
        <span class="s1">xm -= </span><span class="s3">1</span>
        <span class="s1">assert_(eq(xm</span><span class="s0">, </span><span class="s1">y - </span><span class="s3">1</span><span class="s1">))</span>

        <span class="s1">x = arange(</span><span class="s3">10</span><span class="s1">) * </span><span class="s3">1.0</span>
        <span class="s1">xm = arange(</span><span class="s3">10</span><span class="s1">) * </span><span class="s3">1.0</span>
        <span class="s1">xm[</span><span class="s3">2</span><span class="s1">] = masked</span>
        <span class="s1">x *= </span><span class="s3">2.0</span>
        <span class="s1">assert_(eq(x</span><span class="s0">, </span><span class="s1">y * </span><span class="s3">2</span><span class="s1">))</span>
        <span class="s1">xm *= </span><span class="s3">2.0</span>
        <span class="s1">assert_(eq(xm</span><span class="s0">, </span><span class="s1">y * </span><span class="s3">2</span><span class="s1">))</span>

        <span class="s1">x = arange(</span><span class="s3">10</span><span class="s1">) * </span><span class="s3">2</span>
        <span class="s1">xm = arange(</span><span class="s3">10</span><span class="s1">)</span>
        <span class="s1">xm[</span><span class="s3">2</span><span class="s1">] = masked</span>
        <span class="s1">x //= </span><span class="s3">2</span>
        <span class="s1">assert_(eq(x</span><span class="s0">, </span><span class="s1">y))</span>
        <span class="s1">xm //= </span><span class="s3">2</span>
        <span class="s1">assert_(eq(x</span><span class="s0">, </span><span class="s1">y))</span>

        <span class="s1">x = arange(</span><span class="s3">10</span><span class="s1">) * </span><span class="s3">1.0</span>
        <span class="s1">xm = arange(</span><span class="s3">10</span><span class="s1">) * </span><span class="s3">1.0</span>
        <span class="s1">xm[</span><span class="s3">2</span><span class="s1">] = masked</span>
        <span class="s1">x /= </span><span class="s3">2.0</span>
        <span class="s1">assert_(eq(x</span><span class="s0">, </span><span class="s1">y / </span><span class="s3">2.0</span><span class="s1">))</span>
        <span class="s1">xm /= arange(</span><span class="s3">10</span><span class="s1">)</span>
        <span class="s1">assert_(eq(xm</span><span class="s0">, </span><span class="s1">ones((</span><span class="s3">10</span><span class="s0">,</span><span class="s1">))))</span>

        <span class="s1">x = arange(</span><span class="s3">10</span><span class="s1">).astype(np.float32)</span>
        <span class="s1">xm = arange(</span><span class="s3">10</span><span class="s1">)</span>
        <span class="s1">xm[</span><span class="s3">2</span><span class="s1">] = masked</span>
        <span class="s1">x += </span><span class="s3">1.</span>
        <span class="s1">assert_(eq(x</span><span class="s0">, </span><span class="s1">y + </span><span class="s3">1.</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_testPickle(self):</span>
        <span class="s4"># Test of pickling</span>
        <span class="s1">x = arange(</span><span class="s3">12</span><span class="s1">)</span>
        <span class="s1">x[</span><span class="s3">4</span><span class="s1">:</span><span class="s3">10</span><span class="s1">:</span><span class="s3">2</span><span class="s1">] = masked</span>
        <span class="s1">x = x.reshape(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">proto </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">2</span><span class="s0">, </span><span class="s1">pickle.HIGHEST_PROTOCOL + </span><span class="s3">1</span><span class="s1">):</span>
            <span class="s1">s = pickle.dumps(x</span><span class="s0">, </span><span class="s1">protocol=proto)</span>
            <span class="s1">y = pickle.loads(s)</span>
            <span class="s1">assert_(eq(x</span><span class="s0">, </span><span class="s1">y))</span>

    <span class="s0">def </span><span class="s1">test_testMasked(self):</span>
        <span class="s4"># Test of masked element</span>
        <span class="s1">xx = arange(</span><span class="s3">6</span><span class="s1">)</span>
        <span class="s1">xx[</span><span class="s3">1</span><span class="s1">] = masked</span>
        <span class="s1">assert_(str(masked) == </span><span class="s2">'--'</span><span class="s1">)</span>
        <span class="s1">assert_(xx[</span><span class="s3">1</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_equal(filled(xx[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_testAverage1(self):</span>
        <span class="s4"># Test of average.</span>
        <span class="s1">ott = array([</span><span class="s3">0.</span><span class="s0">, </span><span class="s3">1.</span><span class="s0">, </span><span class="s3">2.</span><span class="s0">, </span><span class="s3">3.</span><span class="s1">]</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">assert_(eq(</span><span class="s3">2.0</span><span class="s0">, </span><span class="s1">average(ott</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)))</span>
        <span class="s1">assert_(eq(</span><span class="s3">2.0</span><span class="s0">, </span><span class="s1">average(ott</span><span class="s0">, </span><span class="s1">weights=[</span><span class="s3">1.</span><span class="s0">, </span><span class="s3">1.</span><span class="s0">, </span><span class="s3">2.</span><span class="s0">, </span><span class="s3">1.</span><span class="s1">])))</span>
        <span class="s1">result</span><span class="s0">, </span><span class="s1">wts = average(ott</span><span class="s0">, </span><span class="s1">weights=[</span><span class="s3">1.</span><span class="s0">, </span><span class="s3">1.</span><span class="s0">, </span><span class="s3">2.</span><span class="s0">, </span><span class="s3">1.</span><span class="s1">]</span><span class="s0">, </span><span class="s1">returned=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_(eq(</span><span class="s3">2.0</span><span class="s0">, </span><span class="s1">result))</span>
        <span class="s1">assert_(wts == </span><span class="s3">4.0</span><span class="s1">)</span>
        <span class="s1">ott[:] = masked</span>
        <span class="s1">assert_(average(ott</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">) </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">ott = array([</span><span class="s3">0.</span><span class="s0">, </span><span class="s3">1.</span><span class="s0">, </span><span class="s3">2.</span><span class="s0">, </span><span class="s3">3.</span><span class="s1">]</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">ott = ott.reshape(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">ott[:</span><span class="s0">, </span><span class="s3">1</span><span class="s1">] = masked</span>
        <span class="s1">assert_(eq(average(ott</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s1">]))</span>
        <span class="s1">assert_(average(ott</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(eq([</span><span class="s3">2.</span><span class="s0">, </span><span class="s3">0.</span><span class="s1">]</span><span class="s0">, </span><span class="s1">average(ott</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)))</span>
        <span class="s1">result</span><span class="s0">, </span><span class="s1">wts = average(ott</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">returned=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_(eq(wts</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.</span><span class="s0">, </span><span class="s3">0.</span><span class="s1">]))</span>

    <span class="s0">def </span><span class="s1">test_testAverage2(self):</span>
        <span class="s4"># More tests of average.</span>
        <span class="s1">w1 = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span>
        <span class="s1">w2 = [[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]]</span>
        <span class="s1">x = arange(</span><span class="s3">6</span><span class="s1">)</span>
        <span class="s1">assert_(allclose(average(x</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s3">2.5</span><span class="s1">))</span>
        <span class="s1">assert_(allclose(average(x</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">weights=w1)</span><span class="s0">, </span><span class="s3">2.5</span><span class="s1">))</span>
        <span class="s1">y = array([arange(</span><span class="s3">6</span><span class="s1">)</span><span class="s0">, </span><span class="s3">2.0 </span><span class="s1">* arange(</span><span class="s3">6</span><span class="s1">)])</span>
        <span class="s1">assert_(allclose(average(y</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
                                 <span class="s1">np.add.reduce(np.arange(</span><span class="s3">6</span><span class="s1">)) * </span><span class="s3">3. </span><span class="s1">/ </span><span class="s3">12.</span><span class="s1">))</span>
        <span class="s1">assert_(allclose(average(y</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">6</span><span class="s1">) * </span><span class="s3">3. </span><span class="s1">/ </span><span class="s3">2.</span><span class="s1">))</span>
        <span class="s1">assert_(allclose(average(y</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
                                 <span class="s1">[average(x</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">average(x</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)*</span><span class="s3">2.0</span><span class="s1">]))</span>
        <span class="s1">assert_(allclose(average(y</span><span class="s0">, None, </span><span class="s1">weights=w2)</span><span class="s0">, </span><span class="s3">20. </span><span class="s1">/ </span><span class="s3">6.</span><span class="s1">))</span>
        <span class="s1">assert_(allclose(average(y</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">weights=w2)</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s3">0.</span><span class="s0">, </span><span class="s3">1.</span><span class="s0">, </span><span class="s3">2.</span><span class="s0">, </span><span class="s3">3.</span><span class="s0">, </span><span class="s3">4.</span><span class="s0">, </span><span class="s3">10.</span><span class="s1">]))</span>
        <span class="s1">assert_(allclose(average(y</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
                                 <span class="s1">[average(x</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">average(x</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)*</span><span class="s3">2.0</span><span class="s1">]))</span>
        <span class="s1">m1 = zeros(</span><span class="s3">6</span><span class="s1">)</span>
        <span class="s1">m2 = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span>
        <span class="s1">m3 = [[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]]</span>
        <span class="s1">m4 = ones(</span><span class="s3">6</span><span class="s1">)</span>
        <span class="s1">m5 = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>
        <span class="s1">assert_(allclose(average(masked_array(x</span><span class="s0">, </span><span class="s1">m1)</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s3">2.5</span><span class="s1">))</span>
        <span class="s1">assert_(allclose(average(masked_array(x</span><span class="s0">, </span><span class="s1">m2)</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s3">2.5</span><span class="s1">))</span>
        <span class="s1">assert_(average(masked_array(x</span><span class="s0">, </span><span class="s1">m4)</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">) </span><span class="s0">is </span><span class="s1">masked)</span>
        <span class="s1">assert_equal(average(masked_array(x</span><span class="s0">, </span><span class="s1">m5)</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s3">0.0</span><span class="s1">)</span>
        <span class="s1">assert_equal(count(average(masked_array(x</span><span class="s0">, </span><span class="s1">m4)</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">))</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">z = masked_array(y</span><span class="s0">, </span><span class="s1">m3)</span>
        <span class="s1">assert_(allclose(average(z</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">, </span><span class="s3">20. </span><span class="s1">/ </span><span class="s3">6.</span><span class="s1">))</span>
        <span class="s1">assert_(allclose(average(z</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s3">0.</span><span class="s0">, </span><span class="s3">1.</span><span class="s0">, </span><span class="s3">99.</span><span class="s0">, </span><span class="s3">99.</span><span class="s0">, </span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">7.5</span><span class="s1">]))</span>
        <span class="s1">assert_(allclose(average(z</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2.5</span><span class="s0">, </span><span class="s3">5.0</span><span class="s1">]))</span>
        <span class="s1">assert_(allclose(average(z</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">weights=w2)</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s3">0.</span><span class="s0">, </span><span class="s3">1.</span><span class="s0">, </span><span class="s3">99.</span><span class="s0">, </span><span class="s3">99.</span><span class="s0">, </span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">10.0</span><span class="s1">]))</span>

        <span class="s1">a = arange(</span><span class="s3">6</span><span class="s1">)</span>
        <span class="s1">b = arange(</span><span class="s3">6</span><span class="s1">) * </span><span class="s3">3</span>
        <span class="s1">r1</span><span class="s0">, </span><span class="s1">w1 = average([[a</span><span class="s0">, </span><span class="s1">b]</span><span class="s0">, </span><span class="s1">[b</span><span class="s0">, </span><span class="s1">a]]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">returned=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(shape(r1)</span><span class="s0">, </span><span class="s1">shape(w1))</span>
        <span class="s1">assert_equal(r1.shape</span><span class="s0">, </span><span class="s1">w1.shape)</span>
        <span class="s1">r2</span><span class="s0">, </span><span class="s1">w2 = average(ones((</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">))</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">weights=[</span><span class="s3">3</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">returned=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(shape(w2)</span><span class="s0">, </span><span class="s1">shape(r2))</span>
        <span class="s1">r2</span><span class="s0">, </span><span class="s1">w2 = average(ones((</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">))</span><span class="s0">, </span><span class="s1">returned=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(shape(w2)</span><span class="s0">, </span><span class="s1">shape(r2))</span>
        <span class="s1">r2</span><span class="s0">, </span><span class="s1">w2 = average(ones((</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">))</span><span class="s0">, </span><span class="s1">weights=ones((</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">))</span><span class="s0">, </span><span class="s1">returned=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_(shape(w2) == shape(r2))</span>
        <span class="s1">a2d = array([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">float)</span>
        <span class="s1">a2dm = masked_array(a2d</span><span class="s0">, </span><span class="s1">[[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]])</span>
        <span class="s1">a2da = average(a2d</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">assert_(eq(a2da</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">3.0</span><span class="s1">]))</span>
        <span class="s1">a2dma = average(a2dm</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">assert_(eq(a2dma</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">3.0</span><span class="s1">]))</span>
        <span class="s1">a2dma = average(a2dm</span><span class="s0">, </span><span class="s1">axis=</span><span class="s0">None</span><span class="s1">)</span>
        <span class="s1">assert_(eq(a2dma</span><span class="s0">, </span><span class="s3">7. </span><span class="s1">/ </span><span class="s3">3.</span><span class="s1">))</span>
        <span class="s1">a2dma = average(a2dm</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_(eq(a2dma</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.5</span><span class="s0">, </span><span class="s3">4.0</span><span class="s1">]))</span>

    <span class="s0">def </span><span class="s1">test_testToPython(self):</span>
        <span class="s1">assert_equal(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">int(array(</span><span class="s3">1</span><span class="s1">)))</span>
        <span class="s1">assert_equal(</span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">float(array(</span><span class="s3">1</span><span class="s1">)))</span>
        <span class="s1">assert_equal(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">int(array([[[</span><span class="s3">1</span><span class="s1">]]])))</span>
        <span class="s1">assert_equal(</span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">float(array([[</span><span class="s3">1</span><span class="s1">]])))</span>
        <span class="s1">assert_raises(TypeError</span><span class="s0">, </span><span class="s1">float</span><span class="s0">, </span><span class="s1">array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]))</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">bool</span><span class="s0">, </span><span class="s1">array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]))</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">bool</span><span class="s0">, </span><span class="s1">array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]))</span>

    <span class="s0">def </span><span class="s1">test_testScalarArithmetic(self):</span>
        <span class="s1">xm = array(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">mask=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s4">#TODO FIXME: Find out what the following raises a warning in r8247</span>
        <span class="s0">with </span><span class="s1">np.errstate(divide=</span><span class="s2">'ignore'</span><span class="s1">):</span>
            <span class="s1">assert_((</span><span class="s3">1 </span><span class="s1">/ array(</span><span class="s3">0</span><span class="s1">)).mask)</span>
        <span class="s1">assert_((</span><span class="s3">1 </span><span class="s1">+ xm).mask)</span>
        <span class="s1">assert_((-xm).mask)</span>
        <span class="s1">assert_((-xm).mask)</span>
        <span class="s1">assert_(maximum(xm</span><span class="s0">, </span><span class="s1">xm).mask)</span>
        <span class="s1">assert_(minimum(xm</span><span class="s0">, </span><span class="s1">xm).mask)</span>
        <span class="s1">assert_(xm.filled().dtype </span><span class="s0">is </span><span class="s1">xm._data.dtype)</span>
        <span class="s1">x = array(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">mask=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">assert_(x.filled() == x._data)</span>
        <span class="s1">assert_equal(str(xm)</span><span class="s0">, </span><span class="s1">str(masked_print_option))</span>

    <span class="s0">def </span><span class="s1">test_testArrayMethods(self):</span>
        <span class="s1">a = array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>
        <span class="s1">assert_(eq(a.any()</span><span class="s0">, </span><span class="s1">a._data.any()))</span>
        <span class="s1">assert_(eq(a.all()</span><span class="s0">, </span><span class="s1">a._data.all()))</span>
        <span class="s1">assert_(eq(a.argmax()</span><span class="s0">, </span><span class="s1">a._data.argmax()))</span>
        <span class="s1">assert_(eq(a.argmin()</span><span class="s0">, </span><span class="s1">a._data.argmin()))</span>
        <span class="s1">assert_(eq(a.choose(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span><span class="s0">,</span>
                           <span class="s1">a._data.choose(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)))</span>
        <span class="s1">assert_(eq(a.compress([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span><span class="s0">, </span><span class="s1">a._data.compress([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])))</span>
        <span class="s1">assert_(eq(a.conj()</span><span class="s0">, </span><span class="s1">a._data.conj()))</span>
        <span class="s1">assert_(eq(a.conjugate()</span><span class="s0">, </span><span class="s1">a._data.conjugate()))</span>
        <span class="s1">m = array([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]])</span>
        <span class="s1">assert_(eq(m.diagonal()</span><span class="s0">, </span><span class="s1">m._data.diagonal()))</span>
        <span class="s1">assert_(eq(a.sum()</span><span class="s0">, </span><span class="s1">a._data.sum()))</span>
        <span class="s1">assert_(eq(a.take([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span><span class="s0">, </span><span class="s1">a._data.take([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])))</span>
        <span class="s1">assert_(eq(m.transpose()</span><span class="s0">, </span><span class="s1">m._data.transpose()))</span>

    <span class="s0">def </span><span class="s1">test_testArrayAttributes(self):</span>
        <span class="s1">a = array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>
        <span class="s1">assert_equal(a.ndim</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_testAPI(self):</span>
        <span class="s1">assert_(</span><span class="s0">not </span><span class="s1">[m </span><span class="s0">for </span><span class="s1">m </span><span class="s0">in </span><span class="s1">dir(np.ndarray)</span>
                     <span class="s0">if </span><span class="s1">m </span><span class="s0">not in </span><span class="s1">dir(MaskedArray) </span><span class="s0">and</span>
                     <span class="s0">not </span><span class="s1">m.startswith(</span><span class="s2">'_'</span><span class="s1">)])</span>

    <span class="s0">def </span><span class="s1">test_testSingleElementSubscript(self):</span>
        <span class="s1">a = array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>
        <span class="s1">b = array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(a[</span><span class="s3">0</span><span class="s1">].shape</span><span class="s0">, </span><span class="s1">())</span>
        <span class="s1">assert_equal(b[</span><span class="s3">0</span><span class="s1">].shape</span><span class="s0">, </span><span class="s1">())</span>
        <span class="s1">assert_equal(b[</span><span class="s3">1</span><span class="s1">].shape</span><span class="s0">, </span><span class="s1">())</span>

    <span class="s0">def </span><span class="s1">test_assignment_by_condition(self):</span>
        <span class="s4"># Test for gh-18951</span>
        <span class="s1">a = array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">c = a &gt;= </span><span class="s3">3</span>
        <span class="s1">a[c] = </span><span class="s3">5</span>
        <span class="s1">assert_(a[</span><span class="s3">2</span><span class="s1">] </span><span class="s0">is </span><span class="s1">masked)</span>

    <span class="s0">def </span><span class="s1">test_assignment_by_condition_2(self):</span>
        <span class="s4"># gh-19721</span>
        <span class="s1">a = masked_array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s0">False, False</span><span class="s1">])</span>
        <span class="s1">b = masked_array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s0">True, True</span><span class="s1">])</span>
        <span class="s1">mask = a &lt; </span><span class="s3">1</span>
        <span class="s1">b[mask] = a[mask]</span>
        <span class="s1">expected_mask = [</span><span class="s0">False, True</span><span class="s1">]</span>
        <span class="s1">assert_equal(b.mask</span><span class="s0">, </span><span class="s1">expected_mask)</span>


<span class="s0">class </span><span class="s1">TestUfuncs:</span>
    <span class="s0">def </span><span class="s1">setup(self):</span>
        <span class="s1">self.d = (array([</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">pi / </span><span class="s3">2</span><span class="s1">] * </span><span class="s3">2</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">] + [</span><span class="s3">0</span><span class="s1">] * </span><span class="s3">6</span><span class="s1">)</span><span class="s0">,</span>
                  <span class="s1">array([</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">pi / </span><span class="s3">2</span><span class="s1">] * </span><span class="s3">2</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">] + [</span><span class="s3">0</span><span class="s1">] * </span><span class="s3">6</span><span class="s1">)</span><span class="s0">,</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_testUfuncRegression(self):</span>
        <span class="s1">f_invalid_ignore = [</span>
            <span class="s2">'sqrt'</span><span class="s0">, </span><span class="s2">'arctanh'</span><span class="s0">, </span><span class="s2">'arcsin'</span><span class="s0">, </span><span class="s2">'arccos'</span><span class="s0">,</span>
            <span class="s2">'arccosh'</span><span class="s0">, </span><span class="s2">'arctanh'</span><span class="s0">, </span><span class="s2">'log'</span><span class="s0">, </span><span class="s2">'log10'</span><span class="s0">, </span><span class="s2">'divide'</span><span class="s0">,</span>
            <span class="s2">'true_divide'</span><span class="s0">, </span><span class="s2">'floor_divide'</span><span class="s0">, </span><span class="s2">'remainder'</span><span class="s0">, </span><span class="s2">'fmod'</span><span class="s1">]</span>
        <span class="s0">for </span><span class="s1">f </span><span class="s0">in </span><span class="s1">[</span><span class="s2">'sqrt'</span><span class="s0">, </span><span class="s2">'log'</span><span class="s0">, </span><span class="s2">'log10'</span><span class="s0">, </span><span class="s2">'exp'</span><span class="s0">, </span><span class="s2">'conjugate'</span><span class="s0">,</span>
                  <span class="s2">'sin'</span><span class="s0">, </span><span class="s2">'cos'</span><span class="s0">, </span><span class="s2">'tan'</span><span class="s0">,</span>
                  <span class="s2">'arcsin'</span><span class="s0">, </span><span class="s2">'arccos'</span><span class="s0">, </span><span class="s2">'arctan'</span><span class="s0">,</span>
                  <span class="s2">'sinh'</span><span class="s0">, </span><span class="s2">'cosh'</span><span class="s0">, </span><span class="s2">'tanh'</span><span class="s0">,</span>
                  <span class="s2">'arcsinh'</span><span class="s0">,</span>
                  <span class="s2">'arccosh'</span><span class="s0">,</span>
                  <span class="s2">'arctanh'</span><span class="s0">,</span>
                  <span class="s2">'absolute'</span><span class="s0">, </span><span class="s2">'fabs'</span><span class="s0">, </span><span class="s2">'negative'</span><span class="s0">,</span>
                  <span class="s2">'floor'</span><span class="s0">, </span><span class="s2">'ceil'</span><span class="s0">,</span>
                  <span class="s2">'logical_not'</span><span class="s0">,</span>
                  <span class="s2">'add'</span><span class="s0">, </span><span class="s2">'subtract'</span><span class="s0">, </span><span class="s2">'multiply'</span><span class="s0">,</span>
                  <span class="s2">'divide'</span><span class="s0">, </span><span class="s2">'true_divide'</span><span class="s0">, </span><span class="s2">'floor_divide'</span><span class="s0">,</span>
                  <span class="s2">'remainder'</span><span class="s0">, </span><span class="s2">'fmod'</span><span class="s0">, </span><span class="s2">'hypot'</span><span class="s0">, </span><span class="s2">'arctan2'</span><span class="s0">,</span>
                  <span class="s2">'equal'</span><span class="s0">, </span><span class="s2">'not_equal'</span><span class="s0">, </span><span class="s2">'less_equal'</span><span class="s0">, </span><span class="s2">'greater_equal'</span><span class="s0">,</span>
                  <span class="s2">'less'</span><span class="s0">, </span><span class="s2">'greater'</span><span class="s0">,</span>
                  <span class="s2">'logical_and'</span><span class="s0">, </span><span class="s2">'logical_or'</span><span class="s0">, </span><span class="s2">'logical_xor'</span><span class="s1">]:</span>
            <span class="s0">try</span><span class="s1">:</span>
                <span class="s1">uf = getattr(umath</span><span class="s0">, </span><span class="s1">f)</span>
            <span class="s0">except </span><span class="s1">AttributeError:</span>
                <span class="s1">uf = getattr(fromnumeric</span><span class="s0">, </span><span class="s1">f)</span>
            <span class="s1">mf = getattr(np.ma</span><span class="s0">, </span><span class="s1">f)</span>
            <span class="s1">args = self.d[:uf.nin]</span>
            <span class="s0">with </span><span class="s1">np.errstate():</span>
                <span class="s0">if </span><span class="s1">f </span><span class="s0">in </span><span class="s1">f_invalid_ignore:</span>
                    <span class="s1">np.seterr(invalid=</span><span class="s2">'ignore'</span><span class="s1">)</span>
                <span class="s0">if </span><span class="s1">f </span><span class="s0">in </span><span class="s1">[</span><span class="s2">'arctanh'</span><span class="s0">, </span><span class="s2">'log'</span><span class="s0">, </span><span class="s2">'log10'</span><span class="s1">]:</span>
                    <span class="s1">np.seterr(divide=</span><span class="s2">'ignore'</span><span class="s1">)</span>
                <span class="s1">ur = uf(*args)</span>
                <span class="s1">mr = mf(*args)</span>
            <span class="s1">assert_(eq(ur.filled(</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">mr.filled(</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">f))</span>
            <span class="s1">assert_(eqmask(ur.mask</span><span class="s0">, </span><span class="s1">mr.mask))</span>

    <span class="s0">def </span><span class="s1">test_reduce(self):</span>
        <span class="s1">a = self.d[</span><span class="s3">0</span><span class="s1">]</span>
        <span class="s1">assert_(</span><span class="s0">not </span><span class="s1">alltrue(a</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_(sometrue(a</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">assert_equal(sum(a[:</span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">assert_equal(product(a</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_minmax(self):</span>
        <span class="s1">a = arange(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">13</span><span class="s1">).reshape(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">amask = masked_where(a &lt; </span><span class="s3">5</span><span class="s0">, </span><span class="s1">a)</span>
        <span class="s1">assert_equal(amask.max()</span><span class="s0">, </span><span class="s1">a.max())</span>
        <span class="s1">assert_equal(amask.min()</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span>
        <span class="s1">assert_((amask.max(</span><span class="s3">0</span><span class="s1">) == a.max(</span><span class="s3">0</span><span class="s1">)).all())</span>
        <span class="s1">assert_((amask.min(</span><span class="s3">0</span><span class="s1">) == [</span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]).all())</span>
        <span class="s1">assert_(amask.max(</span><span class="s3">1</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">].mask)</span>
        <span class="s1">assert_(amask.min(</span><span class="s3">1</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">].mask)</span>

    <span class="s0">def </span><span class="s1">test_nonzero(self):</span>
        <span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s2">&quot;?bhilqpBHILQPfdgFDGO&quot;</span><span class="s1">:</span>
            <span class="s1">x = array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
            <span class="s1">assert_(eq(nonzero(x)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]))</span>


<span class="s0">class </span><span class="s1">TestArrayMethods:</span>

    <span class="s0">def </span><span class="s1">setup(self):</span>
        <span class="s1">x = np.array([</span><span class="s3">8.375</span><span class="s0">, </span><span class="s3">7.545</span><span class="s0">, </span><span class="s3">8.828</span><span class="s0">, </span><span class="s3">8.5</span><span class="s0">, </span><span class="s3">1.757</span><span class="s0">, </span><span class="s3">5.928</span><span class="s0">,</span>
                      <span class="s3">8.43</span><span class="s0">, </span><span class="s3">7.78</span><span class="s0">, </span><span class="s3">9.865</span><span class="s0">, </span><span class="s3">5.878</span><span class="s0">, </span><span class="s3">8.979</span><span class="s0">, </span><span class="s3">4.732</span><span class="s0">,</span>
                      <span class="s3">3.012</span><span class="s0">, </span><span class="s3">6.022</span><span class="s0">, </span><span class="s3">5.095</span><span class="s0">, </span><span class="s3">3.116</span><span class="s0">, </span><span class="s3">5.238</span><span class="s0">, </span><span class="s3">3.957</span><span class="s0">,</span>
                      <span class="s3">6.04</span><span class="s0">, </span><span class="s3">9.63</span><span class="s0">, </span><span class="s3">7.712</span><span class="s0">, </span><span class="s3">3.382</span><span class="s0">, </span><span class="s3">4.489</span><span class="s0">, </span><span class="s3">6.479</span><span class="s0">,</span>
                      <span class="s3">7.189</span><span class="s0">, </span><span class="s3">9.645</span><span class="s0">, </span><span class="s3">5.395</span><span class="s0">, </span><span class="s3">4.961</span><span class="s0">, </span><span class="s3">9.894</span><span class="s0">, </span><span class="s3">2.893</span><span class="s0">,</span>
                      <span class="s3">7.357</span><span class="s0">, </span><span class="s3">9.828</span><span class="s0">, </span><span class="s3">6.272</span><span class="s0">, </span><span class="s3">3.758</span><span class="s0">, </span><span class="s3">6.693</span><span class="s0">, </span><span class="s3">0.993</span><span class="s1">])</span>
        <span class="s1">X = x.reshape(</span><span class="s3">6</span><span class="s0">, </span><span class="s3">6</span><span class="s1">)</span>
        <span class="s1">XX = x.reshape(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>

        <span class="s1">m = np.array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">,</span>
                      <span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">,</span>
                      <span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">,</span>
                      <span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">,</span>
                      <span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">,</span>
                      <span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">mx = array(data=x</span><span class="s0">, </span><span class="s1">mask=m)</span>
        <span class="s1">mX = array(data=X</span><span class="s0">, </span><span class="s1">mask=m.reshape(X.shape))</span>
        <span class="s1">mXX = array(data=XX</span><span class="s0">, </span><span class="s1">mask=m.reshape(XX.shape))</span>

        <span class="s1">self.d = (x</span><span class="s0">, </span><span class="s1">X</span><span class="s0">, </span><span class="s1">XX</span><span class="s0">, </span><span class="s1">m</span><span class="s0">, </span><span class="s1">mx</span><span class="s0">, </span><span class="s1">mX</span><span class="s0">, </span><span class="s1">mXX)</span>

    <span class="s0">def </span><span class="s1">test_trace(self):</span>
        <span class="s1">(x</span><span class="s0">, </span><span class="s1">X</span><span class="s0">, </span><span class="s1">XX</span><span class="s0">, </span><span class="s1">m</span><span class="s0">, </span><span class="s1">mx</span><span class="s0">, </span><span class="s1">mX</span><span class="s0">, </span><span class="s1">mXX</span><span class="s0">,</span><span class="s1">) = self.d</span>
        <span class="s1">mXdiag = mX.diagonal()</span>
        <span class="s1">assert_equal(mX.trace()</span><span class="s0">, </span><span class="s1">mX.diagonal().compressed().sum())</span>
        <span class="s1">assert_(eq(mX.trace()</span><span class="s0">,</span>
                           <span class="s1">X.trace() - sum(mXdiag.mask * X.diagonal()</span><span class="s0">,</span>
                                           <span class="s1">axis=</span><span class="s3">0</span><span class="s1">)))</span>

    <span class="s0">def </span><span class="s1">test_clip(self):</span>
        <span class="s1">(x</span><span class="s0">, </span><span class="s1">X</span><span class="s0">, </span><span class="s1">XX</span><span class="s0">, </span><span class="s1">m</span><span class="s0">, </span><span class="s1">mx</span><span class="s0">, </span><span class="s1">mX</span><span class="s0">, </span><span class="s1">mXX</span><span class="s0">,</span><span class="s1">) = self.d</span>
        <span class="s1">clipped = mx.clip(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">8</span><span class="s1">)</span>
        <span class="s1">assert_(eq(clipped.mask</span><span class="s0">, </span><span class="s1">mx.mask))</span>
        <span class="s1">assert_(eq(clipped._data</span><span class="s0">, </span><span class="s1">x.clip(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">8</span><span class="s1">)))</span>
        <span class="s1">assert_(eq(clipped._data</span><span class="s0">, </span><span class="s1">mx._data.clip(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">8</span><span class="s1">)))</span>

    <span class="s0">def </span><span class="s1">test_ptp(self):</span>
        <span class="s1">(x</span><span class="s0">, </span><span class="s1">X</span><span class="s0">, </span><span class="s1">XX</span><span class="s0">, </span><span class="s1">m</span><span class="s0">, </span><span class="s1">mx</span><span class="s0">, </span><span class="s1">mX</span><span class="s0">, </span><span class="s1">mXX</span><span class="s0">,</span><span class="s1">) = self.d</span>
        <span class="s1">(n</span><span class="s0">, </span><span class="s1">m) = X.shape</span>
        <span class="s1">assert_equal(mx.ptp()</span><span class="s0">, </span><span class="s1">mx.compressed().ptp())</span>
        <span class="s1">rows = np.zeros(n</span><span class="s0">, </span><span class="s1">np.float_)</span>
        <span class="s1">cols = np.zeros(m</span><span class="s0">, </span><span class="s1">np.float_)</span>
        <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range(m):</span>
            <span class="s1">cols[k] = mX[:</span><span class="s0">, </span><span class="s1">k].compressed().ptp()</span>
        <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range(n):</span>
            <span class="s1">rows[k] = mX[k].compressed().ptp()</span>
        <span class="s1">assert_(eq(mX.ptp(</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">cols))</span>
        <span class="s1">assert_(eq(mX.ptp(</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">rows))</span>

    <span class="s0">def </span><span class="s1">test_swapaxes(self):</span>
        <span class="s1">(x</span><span class="s0">, </span><span class="s1">X</span><span class="s0">, </span><span class="s1">XX</span><span class="s0">, </span><span class="s1">m</span><span class="s0">, </span><span class="s1">mx</span><span class="s0">, </span><span class="s1">mX</span><span class="s0">, </span><span class="s1">mXX</span><span class="s0">,</span><span class="s1">) = self.d</span>
        <span class="s1">mXswapped = mX.swapaxes(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_(eq(mXswapped[-</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">mX[:</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">]))</span>
        <span class="s1">mXXswapped = mXX.swapaxes(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">assert_equal(mXXswapped.shape</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_cumprod(self):</span>
        <span class="s1">(x</span><span class="s0">, </span><span class="s1">X</span><span class="s0">, </span><span class="s1">XX</span><span class="s0">, </span><span class="s1">m</span><span class="s0">, </span><span class="s1">mx</span><span class="s0">, </span><span class="s1">mX</span><span class="s0">, </span><span class="s1">mXX</span><span class="s0">,</span><span class="s1">) = self.d</span>
        <span class="s1">mXcp = mX.cumprod(</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">assert_(eq(mXcp._data</span><span class="s0">, </span><span class="s1">mX.filled(</span><span class="s3">1</span><span class="s1">).cumprod(</span><span class="s3">0</span><span class="s1">)))</span>
        <span class="s1">mXcp = mX.cumprod(</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_(eq(mXcp._data</span><span class="s0">, </span><span class="s1">mX.filled(</span><span class="s3">1</span><span class="s1">).cumprod(</span><span class="s3">1</span><span class="s1">)))</span>

    <span class="s0">def </span><span class="s1">test_cumsum(self):</span>
        <span class="s1">(x</span><span class="s0">, </span><span class="s1">X</span><span class="s0">, </span><span class="s1">XX</span><span class="s0">, </span><span class="s1">m</span><span class="s0">, </span><span class="s1">mx</span><span class="s0">, </span><span class="s1">mX</span><span class="s0">, </span><span class="s1">mXX</span><span class="s0">,</span><span class="s1">) = self.d</span>
        <span class="s1">mXcp = mX.cumsum(</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">assert_(eq(mXcp._data</span><span class="s0">, </span><span class="s1">mX.filled(</span><span class="s3">0</span><span class="s1">).cumsum(</span><span class="s3">0</span><span class="s1">)))</span>
        <span class="s1">mXcp = mX.cumsum(</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">assert_(eq(mXcp._data</span><span class="s0">, </span><span class="s1">mX.filled(</span><span class="s3">0</span><span class="s1">).cumsum(</span><span class="s3">1</span><span class="s1">)))</span>

    <span class="s0">def </span><span class="s1">test_varstd(self):</span>
        <span class="s1">(x</span><span class="s0">, </span><span class="s1">X</span><span class="s0">, </span><span class="s1">XX</span><span class="s0">, </span><span class="s1">m</span><span class="s0">, </span><span class="s1">mx</span><span class="s0">, </span><span class="s1">mX</span><span class="s0">, </span><span class="s1">mXX</span><span class="s0">,</span><span class="s1">) = self.d</span>
        <span class="s1">assert_(eq(mX.var(axis=</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">mX.compressed().var()))</span>
        <span class="s1">assert_(eq(mX.std(axis=</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">mX.compressed().std()))</span>
        <span class="s1">assert_(eq(mXX.var(axis=</span><span class="s3">3</span><span class="s1">).shape</span><span class="s0">, </span><span class="s1">XX.var(axis=</span><span class="s3">3</span><span class="s1">).shape))</span>
        <span class="s1">assert_(eq(mX.var().shape</span><span class="s0">, </span><span class="s1">X.var().shape))</span>
        <span class="s1">(mXvar0</span><span class="s0">, </span><span class="s1">mXvar1) = (mX.var(axis=</span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">mX.var(axis=</span><span class="s3">1</span><span class="s1">))</span>
        <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">6</span><span class="s1">):</span>
            <span class="s1">assert_(eq(mXvar1[k]</span><span class="s0">, </span><span class="s1">mX[k].compressed().var()))</span>
            <span class="s1">assert_(eq(mXvar0[k]</span><span class="s0">, </span><span class="s1">mX[:</span><span class="s0">, </span><span class="s1">k].compressed().var()))</span>
            <span class="s1">assert_(eq(np.sqrt(mXvar0[k])</span><span class="s0">,</span>
                               <span class="s1">mX[:</span><span class="s0">, </span><span class="s1">k].compressed().std()))</span>


<span class="s0">def </span><span class="s1">eqmask(m1</span><span class="s0">, </span><span class="s1">m2):</span>
    <span class="s0">if </span><span class="s1">m1 </span><span class="s0">is </span><span class="s1">nomask:</span>
        <span class="s0">return </span><span class="s1">m2 </span><span class="s0">is </span><span class="s1">nomask</span>
    <span class="s0">if </span><span class="s1">m2 </span><span class="s0">is </span><span class="s1">nomask:</span>
        <span class="s0">return </span><span class="s1">m1 </span><span class="s0">is </span><span class="s1">nomask</span>
    <span class="s0">return </span><span class="s1">(m1 == m2).all()</span>
</pre>
</body>
</html>