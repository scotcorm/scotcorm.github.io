<html>
<head>
<title>test_period.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_period.py</font>
</center></td></tr></table>
<pre><span class="s0"># Arithmetic tests for DataFrame/Series/Index/Array classes that should</span>
<span class="s0"># behave identically.</span>
<span class="s0"># Specifically for Period dtype</span>
<span class="s2">import </span><span class="s1">operator</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">import </span><span class="s1">pytest</span>

<span class="s2">from </span><span class="s1">pandas._libs.tslibs </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">IncompatibleFrequency</span><span class="s2">,</span>
    <span class="s1">Period</span><span class="s2">,</span>
    <span class="s1">Timestamp</span><span class="s2">,</span>
    <span class="s1">to_offset</span><span class="s2">,</span>
<span class="s1">)</span>
<span class="s2">from </span><span class="s1">pandas.errors </span><span class="s2">import </span><span class="s1">PerformanceWarning</span>

<span class="s2">import </span><span class="s1">pandas </span><span class="s2">as </span><span class="s1">pd</span>
<span class="s2">from </span><span class="s1">pandas </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">PeriodIndex</span><span class="s2">,</span>
    <span class="s1">Series</span><span class="s2">,</span>
    <span class="s1">Timedelta</span><span class="s2">,</span>
    <span class="s1">TimedeltaIndex</span><span class="s2">,</span>
    <span class="s1">period_range</span><span class="s2">,</span>
<span class="s1">)</span>
<span class="s2">import </span><span class="s1">pandas._testing </span><span class="s2">as </span><span class="s1">tm</span>
<span class="s2">from </span><span class="s1">pandas.core </span><span class="s2">import </span><span class="s1">ops</span>
<span class="s2">from </span><span class="s1">pandas.core.arrays </span><span class="s2">import </span><span class="s1">TimedeltaArray</span>
<span class="s2">from </span><span class="s1">pandas.tests.arithmetic.common </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">assert_invalid_addsub_type</span><span class="s2">,</span>
    <span class="s1">assert_invalid_comparison</span><span class="s2">,</span>
    <span class="s1">get_upcast_box</span><span class="s2">,</span>
<span class="s1">)</span>

<span class="s0"># ------------------------------------------------------------------</span>
<span class="s0"># Comparisons</span>


<span class="s2">class </span><span class="s1">TestPeriodArrayLikeComparisons:</span>
    <span class="s0"># Comparison tests for PeriodDtype vectors fully parametrized over</span>
    <span class="s0">#  DataFrame/Series/PeriodIndex/PeriodArray.  Ideally all comparison</span>
    <span class="s0">#  tests will eventually end up here.</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;other&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;2017&quot;</span><span class="s2">, </span><span class="s1">Period(</span><span class="s3">&quot;2017&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s1">)])</span>
    <span class="s2">def </span><span class="s1">test_eq_scalar(self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">, </span><span class="s1">box_with_array):</span>

        <span class="s1">idx = PeriodIndex([</span><span class="s3">&quot;2017&quot;</span><span class="s2">, </span><span class="s3">&quot;2017&quot;</span><span class="s2">, </span><span class="s3">&quot;2018&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s1">idx = tm.box_expected(idx</span><span class="s2">, </span><span class="s1">box_with_array)</span>
        <span class="s1">xbox = get_upcast_box(idx</span><span class="s2">, </span><span class="s1">other</span><span class="s2">, True</span><span class="s1">)</span>

        <span class="s1">expected = np.array([</span><span class="s2">True, True, False</span><span class="s1">])</span>
        <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">xbox)</span>

        <span class="s1">result = idx == other</span>

        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_compare_zerodim(self</span><span class="s2">, </span><span class="s1">box_with_array):</span>
        <span class="s0"># GH#26689 make sure we unbox zero-dimensional arrays</span>

        <span class="s1">pi = period_range(</span><span class="s3">&quot;2000&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s1">)</span>
        <span class="s1">other = np.array(pi.to_numpy()[</span><span class="s4">0</span><span class="s1">])</span>

        <span class="s1">pi = tm.box_expected(pi</span><span class="s2">, </span><span class="s1">box_with_array)</span>
        <span class="s1">xbox = get_upcast_box(pi</span><span class="s2">, </span><span class="s1">other</span><span class="s2">, True</span><span class="s1">)</span>

        <span class="s1">result = pi &lt;= other</span>
        <span class="s1">expected = np.array([</span><span class="s2">True, False, False, False</span><span class="s1">])</span>
        <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">xbox)</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;scalar&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s3">&quot;foo&quot;</span><span class="s2">,</span>
            <span class="s1">Timestamp(</span><span class="s3">&quot;2021-01-01&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">Timedelta(days=</span><span class="s4">4</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s4">9</span><span class="s2">,</span>
            <span class="s4">9.5</span><span class="s2">,</span>
            <span class="s4">2000</span><span class="s2">,  </span><span class="s0"># specifically don't consider 2000 to match Period(&quot;2000&quot;, &quot;D&quot;)</span>
            <span class="s2">False,</span>
            <span class="s2">None,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_compare_invalid_scalar(self</span><span class="s2">, </span><span class="s1">box_with_array</span><span class="s2">, </span><span class="s1">scalar):</span>
        <span class="s0"># GH#28980</span>
        <span class="s0"># comparison with scalar that cannot be interpreted as a Period</span>
        <span class="s1">pi = period_range(</span><span class="s3">&quot;2000&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s1">)</span>
        <span class="s1">parr = tm.box_expected(pi</span><span class="s2">, </span><span class="s1">box_with_array)</span>
        <span class="s1">assert_invalid_comparison(parr</span><span class="s2">, </span><span class="s1">scalar</span><span class="s2">, </span><span class="s1">box_with_array)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;other&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">pd.date_range(</span><span class="s3">&quot;2000&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s1">).array</span><span class="s2">,</span>
            <span class="s1">pd.timedelta_range(</span><span class="s3">&quot;1D&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s1">).array</span><span class="s2">,</span>
            <span class="s1">np.arange(</span><span class="s4">4</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">np.arange(</span><span class="s4">4</span><span class="s1">).astype(np.float64)</span><span class="s2">,</span>
            <span class="s1">list(range(</span><span class="s4">4</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s0"># match Period semantics by not treating integers as Periods</span>
            <span class="s1">[</span><span class="s4">2000</span><span class="s2">, </span><span class="s4">2001</span><span class="s2">, </span><span class="s4">2002</span><span class="s2">, </span><span class="s4">2003</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">np.arange(</span><span class="s4">2000</span><span class="s2">, </span><span class="s4">2004</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">np.arange(</span><span class="s4">2000</span><span class="s2">, </span><span class="s4">2004</span><span class="s1">).astype(object)</span><span class="s2">,</span>
            <span class="s1">pd.Index([</span><span class="s4">2000</span><span class="s2">, </span><span class="s4">2001</span><span class="s2">, </span><span class="s4">2002</span><span class="s2">, </span><span class="s4">2003</span><span class="s1">])</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_compare_invalid_listlike(self</span><span class="s2">, </span><span class="s1">box_with_array</span><span class="s2">, </span><span class="s1">other):</span>
        <span class="s1">pi = period_range(</span><span class="s3">&quot;2000&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s1">)</span>
        <span class="s1">parr = tm.box_expected(pi</span><span class="s2">, </span><span class="s1">box_with_array)</span>
        <span class="s1">assert_invalid_comparison(parr</span><span class="s2">, </span><span class="s1">other</span><span class="s2">, </span><span class="s1">box_with_array)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;other_box&quot;</span><span class="s2">, </span><span class="s1">[list</span><span class="s2">, </span><span class="s1">np.array</span><span class="s2">, lambda </span><span class="s1">x: x.astype(object)])</span>
    <span class="s2">def </span><span class="s1">test_compare_object_dtype(self</span><span class="s2">, </span><span class="s1">box_with_array</span><span class="s2">, </span><span class="s1">other_box):</span>
        <span class="s1">pi = period_range(</span><span class="s3">&quot;2000&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">parr = tm.box_expected(pi</span><span class="s2">, </span><span class="s1">box_with_array)</span>

        <span class="s1">other = other_box(pi)</span>
        <span class="s1">xbox = get_upcast_box(parr</span><span class="s2">, </span><span class="s1">other</span><span class="s2">, True</span><span class="s1">)</span>

        <span class="s1">expected = np.array([</span><span class="s2">True, True, True, True, True</span><span class="s1">])</span>
        <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">xbox)</span>

        <span class="s1">result = parr == other</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">result = parr &lt;= other</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">result = parr &gt;= other</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">result = parr != other</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">~expected)</span>
        <span class="s1">result = parr &lt; other</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">~expected)</span>
        <span class="s1">result = parr &gt; other</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">~expected)</span>

        <span class="s1">other = other_box(pi[::-</span><span class="s4">1</span><span class="s1">])</span>

        <span class="s1">expected = np.array([</span><span class="s2">False, False, True, False, False</span><span class="s1">])</span>
        <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">xbox)</span>
        <span class="s1">result = parr == other</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">expected = np.array([</span><span class="s2">True, True, True, False, False</span><span class="s1">])</span>
        <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">xbox)</span>
        <span class="s1">result = parr &lt;= other</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">expected = np.array([</span><span class="s2">False, False, True, True, True</span><span class="s1">])</span>
        <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">xbox)</span>
        <span class="s1">result = parr &gt;= other</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">expected = np.array([</span><span class="s2">True, True, False, True, True</span><span class="s1">])</span>
        <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">xbox)</span>
        <span class="s1">result = parr != other</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">expected = np.array([</span><span class="s2">True, True, False, False, False</span><span class="s1">])</span>
        <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">xbox)</span>
        <span class="s1">result = parr &lt; other</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">expected = np.array([</span><span class="s2">False, False, False, True, True</span><span class="s1">])</span>
        <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">xbox)</span>
        <span class="s1">result = parr &gt; other</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s2">class </span><span class="s1">TestPeriodIndexComparisons:</span>
    <span class="s0"># TODO: parameterize over boxes</span>

    <span class="s2">def </span><span class="s1">test_pi_cmp_period(self):</span>
        <span class="s1">idx = period_range(</span><span class="s3">&quot;2007-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">20</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span>
        <span class="s1">per = idx[</span><span class="s4">10</span><span class="s1">]</span>

        <span class="s1">result = idx &lt; per</span>
        <span class="s1">exp = idx.values &lt; idx.values[</span><span class="s4">10</span><span class="s1">]</span>
        <span class="s1">tm.assert_numpy_array_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s0"># Tests Period.__richcmp__ against ndarray[object, ndim=2]</span>
        <span class="s1">result = idx.values.reshape(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">2</span><span class="s1">) &lt; per</span>
        <span class="s1">tm.assert_numpy_array_equal(result</span><span class="s2">, </span><span class="s1">exp.reshape(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">2</span><span class="s1">))</span>

        <span class="s0"># Tests Period.__richcmp__ against ndarray[object, ndim=0]</span>
        <span class="s1">result = idx &lt; np.array(per)</span>
        <span class="s1">tm.assert_numpy_array_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>

    <span class="s0"># TODO: moved from test_datetime64; de-duplicate with version below</span>
    <span class="s2">def </span><span class="s1">test_parr_cmp_period_scalar2(self</span><span class="s2">, </span><span class="s1">box_with_array):</span>
        <span class="s1">pi = period_range(</span><span class="s3">&quot;2000-01-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">10</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s1">)</span>

        <span class="s1">val = pi[</span><span class="s4">3</span><span class="s1">]</span>
        <span class="s1">expected = [x &gt; val </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">pi]</span>

        <span class="s1">ser = tm.box_expected(pi</span><span class="s2">, </span><span class="s1">box_with_array)</span>
        <span class="s1">xbox = get_upcast_box(ser</span><span class="s2">, </span><span class="s1">val</span><span class="s2">, True</span><span class="s1">)</span>

        <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">xbox)</span>
        <span class="s1">result = ser &gt; val</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">val = pi[</span><span class="s4">5</span><span class="s1">]</span>
        <span class="s1">result = ser &gt; val</span>
        <span class="s1">expected = [x &gt; val </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">pi]</span>
        <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">xbox)</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;freq&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s3">&quot;2M&quot;</span><span class="s2">, </span><span class="s3">&quot;3M&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_parr_cmp_period_scalar(self</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">box_with_array):</span>
        <span class="s0"># GH#13200</span>
        <span class="s1">base = PeriodIndex([</span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-02&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-03&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=freq)</span>
        <span class="s1">base = tm.box_expected(base</span><span class="s2">, </span><span class="s1">box_with_array)</span>
        <span class="s1">per = Period(</span><span class="s3">&quot;2011-02&quot;</span><span class="s2">, </span><span class="s1">freq=freq)</span>
        <span class="s1">xbox = get_upcast_box(base</span><span class="s2">, </span><span class="s1">per</span><span class="s2">, True</span><span class="s1">)</span>

        <span class="s1">exp = np.array([</span><span class="s2">False, True, False, False</span><span class="s1">])</span>
        <span class="s1">exp = tm.box_expected(exp</span><span class="s2">, </span><span class="s1">xbox)</span>
        <span class="s1">tm.assert_equal(base == per</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s1">tm.assert_equal(per == base</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">exp = np.array([</span><span class="s2">True, False, True, True</span><span class="s1">])</span>
        <span class="s1">exp = tm.box_expected(exp</span><span class="s2">, </span><span class="s1">xbox)</span>
        <span class="s1">tm.assert_equal(base != per</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s1">tm.assert_equal(per != base</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">exp = np.array([</span><span class="s2">False, False, True, True</span><span class="s1">])</span>
        <span class="s1">exp = tm.box_expected(exp</span><span class="s2">, </span><span class="s1">xbox)</span>
        <span class="s1">tm.assert_equal(base &gt; per</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s1">tm.assert_equal(per &lt; base</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">exp = np.array([</span><span class="s2">True, False, False, False</span><span class="s1">])</span>
        <span class="s1">exp = tm.box_expected(exp</span><span class="s2">, </span><span class="s1">xbox)</span>
        <span class="s1">tm.assert_equal(base &lt; per</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s1">tm.assert_equal(per &gt; base</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">exp = np.array([</span><span class="s2">False, True, True, True</span><span class="s1">])</span>
        <span class="s1">exp = tm.box_expected(exp</span><span class="s2">, </span><span class="s1">xbox)</span>
        <span class="s1">tm.assert_equal(base &gt;= per</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s1">tm.assert_equal(per &lt;= base</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">exp = np.array([</span><span class="s2">True, True, False, False</span><span class="s1">])</span>
        <span class="s1">exp = tm.box_expected(exp</span><span class="s2">, </span><span class="s1">xbox)</span>
        <span class="s1">tm.assert_equal(base &lt;= per</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s1">tm.assert_equal(per &gt;= base</span><span class="s2">, </span><span class="s1">exp)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;freq&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s3">&quot;2M&quot;</span><span class="s2">, </span><span class="s3">&quot;3M&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_parr_cmp_pi(self</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">box_with_array):</span>
        <span class="s0"># GH#13200</span>
        <span class="s1">base = PeriodIndex([</span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-02&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-03&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=freq)</span>
        <span class="s1">base = tm.box_expected(base</span><span class="s2">, </span><span class="s1">box_with_array)</span>

        <span class="s0"># TODO: could also box idx?</span>
        <span class="s1">idx = PeriodIndex([</span><span class="s3">&quot;2011-02&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-03&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-05&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=freq)</span>

        <span class="s1">xbox = get_upcast_box(base</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, True</span><span class="s1">)</span>

        <span class="s1">exp = np.array([</span><span class="s2">False, False, True, False</span><span class="s1">])</span>
        <span class="s1">exp = tm.box_expected(exp</span><span class="s2">, </span><span class="s1">xbox)</span>
        <span class="s1">tm.assert_equal(base == idx</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">exp = np.array([</span><span class="s2">True, True, False, True</span><span class="s1">])</span>
        <span class="s1">exp = tm.box_expected(exp</span><span class="s2">, </span><span class="s1">xbox)</span>
        <span class="s1">tm.assert_equal(base != idx</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">exp = np.array([</span><span class="s2">False, True, False, False</span><span class="s1">])</span>
        <span class="s1">exp = tm.box_expected(exp</span><span class="s2">, </span><span class="s1">xbox)</span>
        <span class="s1">tm.assert_equal(base &gt; idx</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">exp = np.array([</span><span class="s2">True, False, False, True</span><span class="s1">])</span>
        <span class="s1">exp = tm.box_expected(exp</span><span class="s2">, </span><span class="s1">xbox)</span>
        <span class="s1">tm.assert_equal(base &lt; idx</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">exp = np.array([</span><span class="s2">False, True, True, False</span><span class="s1">])</span>
        <span class="s1">exp = tm.box_expected(exp</span><span class="s2">, </span><span class="s1">xbox)</span>
        <span class="s1">tm.assert_equal(base &gt;= idx</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">exp = np.array([</span><span class="s2">True, False, True, True</span><span class="s1">])</span>
        <span class="s1">exp = tm.box_expected(exp</span><span class="s2">, </span><span class="s1">xbox)</span>
        <span class="s1">tm.assert_equal(base &lt;= idx</span><span class="s2">, </span><span class="s1">exp)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;freq&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s3">&quot;2M&quot;</span><span class="s2">, </span><span class="s3">&quot;3M&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_parr_cmp_pi_mismatched_freq(self</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">box_with_array):</span>
        <span class="s0"># GH#13200</span>
        <span class="s0"># different base freq</span>
        <span class="s1">base = PeriodIndex([</span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-02&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-03&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=freq)</span>
        <span class="s1">base = tm.box_expected(base</span><span class="s2">, </span><span class="s1">box_with_array)</span>

        <span class="s1">msg = </span><span class="s3">rf&quot;Invalid comparison between dtype=period\[</span><span class="s2">{</span><span class="s1">freq</span><span class="s2">}</span><span class="s3">\] and Period&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">base &lt;= Period(</span><span class="s3">&quot;2011&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;A&quot;</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">Period(</span><span class="s3">&quot;2011&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;A&quot;</span><span class="s1">) &gt;= base</span>

        <span class="s0"># TODO: Could parametrize over boxes for idx?</span>
        <span class="s1">idx = PeriodIndex([</span><span class="s3">&quot;2011&quot;</span><span class="s2">, </span><span class="s3">&quot;2012&quot;</span><span class="s2">, </span><span class="s3">&quot;2013&quot;</span><span class="s2">, </span><span class="s3">&quot;2014&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;A&quot;</span><span class="s1">)</span>
        <span class="s1">rev_msg = </span><span class="s3">r&quot;Invalid comparison between dtype=period\[A-DEC\] and PeriodArray&quot;</span>
        <span class="s1">idx_msg = rev_msg </span><span class="s2">if </span><span class="s1">box_with_array </span><span class="s2">in </span><span class="s1">[tm.to_array</span><span class="s2">, </span><span class="s1">pd.array] </span><span class="s2">else </span><span class="s1">msg</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=idx_msg):</span>
            <span class="s1">base &lt;= idx</span>

        <span class="s0"># Different frequency</span>
        <span class="s1">msg = </span><span class="s3">rf&quot;Invalid comparison between dtype=period\[</span><span class="s2">{</span><span class="s1">freq</span><span class="s2">}</span><span class="s3">\] and Period&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">base &lt;= Period(</span><span class="s3">&quot;2011&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;4M&quot;</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">Period(</span><span class="s3">&quot;2011&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;4M&quot;</span><span class="s1">) &gt;= base</span>

        <span class="s1">idx = PeriodIndex([</span><span class="s3">&quot;2011&quot;</span><span class="s2">, </span><span class="s3">&quot;2012&quot;</span><span class="s2">, </span><span class="s3">&quot;2013&quot;</span><span class="s2">, </span><span class="s3">&quot;2014&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;4M&quot;</span><span class="s1">)</span>
        <span class="s1">rev_msg = </span><span class="s3">r&quot;Invalid comparison between dtype=period\[4M\] and PeriodArray&quot;</span>
        <span class="s1">idx_msg = rev_msg </span><span class="s2">if </span><span class="s1">box_with_array </span><span class="s2">in </span><span class="s1">[tm.to_array</span><span class="s2">, </span><span class="s1">pd.array] </span><span class="s2">else </span><span class="s1">msg</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=idx_msg):</span>
            <span class="s1">base &lt;= idx</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;freq&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s3">&quot;2M&quot;</span><span class="s2">, </span><span class="s3">&quot;3M&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_pi_cmp_nat(self</span><span class="s2">, </span><span class="s1">freq):</span>
        <span class="s1">idx1 = PeriodIndex([</span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-02&quot;</span><span class="s2">, </span><span class="s3">&quot;NaT&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-05&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=freq)</span>
        <span class="s1">per = idx1[</span><span class="s4">1</span><span class="s1">]</span>

        <span class="s1">result = idx1 &gt; per</span>
        <span class="s1">exp = np.array([</span><span class="s2">False, False, False, True</span><span class="s1">])</span>
        <span class="s1">tm.assert_numpy_array_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s1">result = per &lt; idx1</span>
        <span class="s1">tm.assert_numpy_array_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">result = idx1 == pd.NaT</span>
        <span class="s1">exp = np.array([</span><span class="s2">False, False, False, False</span><span class="s1">])</span>
        <span class="s1">tm.assert_numpy_array_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s1">result = pd.NaT == idx1</span>
        <span class="s1">tm.assert_numpy_array_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">result = idx1 != pd.NaT</span>
        <span class="s1">exp = np.array([</span><span class="s2">True, True, True, True</span><span class="s1">])</span>
        <span class="s1">tm.assert_numpy_array_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s1">result = pd.NaT != idx1</span>
        <span class="s1">tm.assert_numpy_array_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">idx2 = PeriodIndex([</span><span class="s3">&quot;2011-02&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04&quot;</span><span class="s2">, </span><span class="s3">&quot;NaT&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=freq)</span>
        <span class="s1">result = idx1 &lt; idx2</span>
        <span class="s1">exp = np.array([</span><span class="s2">True, False, False, False</span><span class="s1">])</span>
        <span class="s1">tm.assert_numpy_array_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">result = idx1 == idx2</span>
        <span class="s1">exp = np.array([</span><span class="s2">False, False, False, False</span><span class="s1">])</span>
        <span class="s1">tm.assert_numpy_array_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">result = idx1 != idx2</span>
        <span class="s1">exp = np.array([</span><span class="s2">True, True, True, True</span><span class="s1">])</span>
        <span class="s1">tm.assert_numpy_array_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">result = idx1 == idx1</span>
        <span class="s1">exp = np.array([</span><span class="s2">True, True, False, True</span><span class="s1">])</span>
        <span class="s1">tm.assert_numpy_array_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">result = idx1 != idx1</span>
        <span class="s1">exp = np.array([</span><span class="s2">False, False, True, False</span><span class="s1">])</span>
        <span class="s1">tm.assert_numpy_array_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;freq&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s3">&quot;2M&quot;</span><span class="s2">, </span><span class="s3">&quot;3M&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_pi_cmp_nat_mismatched_freq_raises(self</span><span class="s2">, </span><span class="s1">freq):</span>
        <span class="s1">idx1 = PeriodIndex([</span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-02&quot;</span><span class="s2">, </span><span class="s3">&quot;NaT&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-05&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=freq)</span>

        <span class="s1">diff = PeriodIndex([</span><span class="s3">&quot;2011-02&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04&quot;</span><span class="s2">, </span><span class="s3">&quot;NaT&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;4M&quot;</span><span class="s1">)</span>
        <span class="s1">msg = </span><span class="s3">rf&quot;Invalid comparison between dtype=period\[</span><span class="s2">{</span><span class="s1">freq</span><span class="s2">}</span><span class="s3">\] and PeriodArray&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">idx1 &gt; diff</span>

        <span class="s1">result = idx1 == diff</span>
        <span class="s1">expected = np.array([</span><span class="s2">False, False, False, False</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=bool)</span>
        <span class="s1">tm.assert_numpy_array_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s0"># TODO: De-duplicate with test_pi_cmp_nat</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;dtype&quot;</span><span class="s2">, </span><span class="s1">[object</span><span class="s2">, None</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_comp_nat(self</span><span class="s2">, </span><span class="s1">dtype):</span>
        <span class="s1">left = PeriodIndex([Period(</span><span class="s3">&quot;2011-01-01&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">pd.NaT</span><span class="s2">, </span><span class="s1">Period(</span><span class="s3">&quot;2011-01-03&quot;</span><span class="s1">)])</span>
        <span class="s1">right = PeriodIndex([pd.NaT</span><span class="s2">, </span><span class="s1">pd.NaT</span><span class="s2">, </span><span class="s1">Period(</span><span class="s3">&quot;2011-01-03&quot;</span><span class="s1">)])</span>

        <span class="s2">if </span><span class="s1">dtype </span><span class="s2">is not None</span><span class="s1">:</span>
            <span class="s1">left = left.astype(dtype)</span>
            <span class="s1">right = right.astype(dtype)</span>

        <span class="s1">result = left == right</span>
        <span class="s1">expected = np.array([</span><span class="s2">False, False, True</span><span class="s1">])</span>
        <span class="s1">tm.assert_numpy_array_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">result = left != right</span>
        <span class="s1">expected = np.array([</span><span class="s2">True, True, False</span><span class="s1">])</span>
        <span class="s1">tm.assert_numpy_array_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">expected = np.array([</span><span class="s2">False, False, False</span><span class="s1">])</span>
        <span class="s1">tm.assert_numpy_array_equal(left == pd.NaT</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">tm.assert_numpy_array_equal(pd.NaT == right</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">expected = np.array([</span><span class="s2">True, True, True</span><span class="s1">])</span>
        <span class="s1">tm.assert_numpy_array_equal(left != pd.NaT</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">tm.assert_numpy_array_equal(pd.NaT != left</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">expected = np.array([</span><span class="s2">False, False, False</span><span class="s1">])</span>
        <span class="s1">tm.assert_numpy_array_equal(left &lt; pd.NaT</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">tm.assert_numpy_array_equal(pd.NaT &gt; left</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s2">class </span><span class="s1">TestPeriodSeriesComparisons:</span>
    <span class="s2">def </span><span class="s1">test_cmp_series_period_series_mixed_freq(self):</span>
        <span class="s0"># GH#13200</span>
        <span class="s1">base = Series(</span>
            <span class="s1">[</span>
                <span class="s1">Period(</span><span class="s3">&quot;2011&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;A&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">Period(</span><span class="s3">&quot;2011-02&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">Period(</span><span class="s3">&quot;2013&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;A&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">Period(</span><span class="s3">&quot;2011-04&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>

        <span class="s1">ser = Series(</span>
            <span class="s1">[</span>
                <span class="s1">Period(</span><span class="s3">&quot;2012&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;A&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">Period(</span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">Period(</span><span class="s3">&quot;2013&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;A&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">Period(</span><span class="s3">&quot;2011-05&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>

        <span class="s1">exp = Series([</span><span class="s2">False, False, True, False</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(base == ser</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">exp = Series([</span><span class="s2">True, True, False, True</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(base != ser</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">exp = Series([</span><span class="s2">False, True, False, False</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(base &gt; ser</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">exp = Series([</span><span class="s2">True, False, False, True</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(base &lt; ser</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">exp = Series([</span><span class="s2">False, True, True, False</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(base &gt;= ser</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">exp = Series([</span><span class="s2">True, False, True, True</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(base &lt;= ser</span><span class="s2">, </span><span class="s1">exp)</span>


<span class="s2">class </span><span class="s1">TestPeriodIndexSeriesComparisonConsistency:</span>
    <span class="s5">&quot;&quot;&quot;Test PeriodIndex and Period Series Ops consistency&quot;&quot;&quot;</span>

    <span class="s0"># TODO: needs parametrization+de-duplication</span>

    <span class="s2">def </span><span class="s1">_check(self</span><span class="s2">, </span><span class="s1">values</span><span class="s2">, </span><span class="s1">func</span><span class="s2">, </span><span class="s1">expected):</span>
        <span class="s0"># Test PeriodIndex and Period Series Ops consistency</span>

        <span class="s1">idx = PeriodIndex(values)</span>
        <span class="s1">result = func(idx)</span>

        <span class="s0"># check that we don't pass an unwanted type to tm.assert_equal</span>
        <span class="s2">assert </span><span class="s1">isinstance(expected</span><span class="s2">, </span><span class="s1">(pd.Index</span><span class="s2">, </span><span class="s1">np.ndarray))</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">s = Series(values)</span>
        <span class="s1">result = func(s)</span>

        <span class="s1">exp = Series(expected</span><span class="s2">, </span><span class="s1">name=values.name)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>

    <span class="s2">def </span><span class="s1">test_pi_comp_period(self):</span>
        <span class="s1">idx = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-02&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-03&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span>
        <span class="s1">)</span>
        <span class="s1">per = idx[</span><span class="s4">2</span><span class="s1">]</span>

        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: x == per</span>
        <span class="s1">exp = np.array([</span><span class="s2">False, False, True, False</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.bool_)</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: per == x</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: x != per</span>
        <span class="s1">exp = np.array([</span><span class="s2">True, True, False, True</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.bool_)</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: per != x</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: per &gt;= x</span>
        <span class="s1">exp = np.array([</span><span class="s2">True, True, True, False</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.bool_)</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: x &gt; per</span>
        <span class="s1">exp = np.array([</span><span class="s2">False, False, False, True</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.bool_)</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: per &gt;= x</span>
        <span class="s1">exp = np.array([</span><span class="s2">True, True, True, False</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.bool_)</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>

    <span class="s2">def </span><span class="s1">test_pi_comp_period_nat(self):</span>
        <span class="s1">idx = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s3">&quot;NaT&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-03&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span>
        <span class="s1">)</span>
        <span class="s1">per = idx[</span><span class="s4">2</span><span class="s1">]</span>

        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: x == per</span>
        <span class="s1">exp = np.array([</span><span class="s2">False, False, True, False</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.bool_)</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: per == x</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: x == pd.NaT</span>
        <span class="s1">exp = np.array([</span><span class="s2">False, False, False, False</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.bool_)</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: pd.NaT == x</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: x != per</span>
        <span class="s1">exp = np.array([</span><span class="s2">True, True, False, True</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.bool_)</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: per != x</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: x != pd.NaT</span>
        <span class="s1">exp = np.array([</span><span class="s2">True, True, True, True</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.bool_)</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: pd.NaT != x</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: per &gt;= x</span>
        <span class="s1">exp = np.array([</span><span class="s2">True, False, True, False</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.bool_)</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: x &lt; per</span>
        <span class="s1">exp = np.array([</span><span class="s2">True, False, False, False</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.bool_)</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: x &gt; pd.NaT</span>
        <span class="s1">exp = np.array([</span><span class="s2">False, False, False, False</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.bool_)</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: pd.NaT &gt;= x</span>
        <span class="s1">exp = np.array([</span><span class="s2">False, False, False, False</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.bool_)</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>


<span class="s0"># ------------------------------------------------------------------</span>
<span class="s0"># Arithmetic</span>


<span class="s2">class </span><span class="s1">TestPeriodFrameArithmetic:</span>
    <span class="s2">def </span><span class="s1">test_ops_frame_period(self):</span>
        <span class="s0"># GH#13043</span>
        <span class="s1">df = pd.DataFrame(</span>
            <span class="s1">{</span>
                <span class="s3">&quot;A&quot;</span><span class="s1">: [Period(</span><span class="s3">&quot;2015-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">Period(</span><span class="s3">&quot;2015-02&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)]</span><span class="s2">,</span>
                <span class="s3">&quot;B&quot;</span><span class="s1">: [Period(</span><span class="s3">&quot;2014-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">Period(</span><span class="s3">&quot;2014-02&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)]</span><span class="s2">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">df[</span><span class="s3">&quot;A&quot;</span><span class="s1">].dtype == </span><span class="s3">&quot;Period[M]&quot;</span>
        <span class="s2">assert </span><span class="s1">df[</span><span class="s3">&quot;B&quot;</span><span class="s1">].dtype == </span><span class="s3">&quot;Period[M]&quot;</span>

        <span class="s1">p = Period(</span><span class="s3">&quot;2015-03&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span>
        <span class="s1">off = p.freq</span>
        <span class="s0"># dtype will be object because of original dtype</span>
        <span class="s1">exp = pd.DataFrame(</span>
            <span class="s1">{</span>
                <span class="s3">&quot;A&quot;</span><span class="s1">: np.array([</span><span class="s4">2 </span><span class="s1">* off</span><span class="s2">, </span><span class="s4">1 </span><span class="s1">* off]</span><span class="s2">, </span><span class="s1">dtype=object)</span><span class="s2">,</span>
                <span class="s3">&quot;B&quot;</span><span class="s1">: np.array([</span><span class="s4">14 </span><span class="s1">* off</span><span class="s2">, </span><span class="s4">13 </span><span class="s1">* off]</span><span class="s2">, </span><span class="s1">dtype=object)</span><span class="s2">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(p - df</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s1">tm.assert_frame_equal(df - p</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1 </span><span class="s1">* exp)</span>

        <span class="s1">df2 = pd.DataFrame(</span>
            <span class="s1">{</span>
                <span class="s3">&quot;A&quot;</span><span class="s1">: [Period(</span><span class="s3">&quot;2015-05&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">Period(</span><span class="s3">&quot;2015-06&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)]</span><span class="s2">,</span>
                <span class="s3">&quot;B&quot;</span><span class="s1">: [Period(</span><span class="s3">&quot;2015-05&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">Period(</span><span class="s3">&quot;2015-06&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)]</span><span class="s2">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">df2[</span><span class="s3">&quot;A&quot;</span><span class="s1">].dtype == </span><span class="s3">&quot;Period[M]&quot;</span>
        <span class="s2">assert </span><span class="s1">df2[</span><span class="s3">&quot;B&quot;</span><span class="s1">].dtype == </span><span class="s3">&quot;Period[M]&quot;</span>

        <span class="s1">exp = pd.DataFrame(</span>
            <span class="s1">{</span>
                <span class="s3">&quot;A&quot;</span><span class="s1">: np.array([</span><span class="s4">4 </span><span class="s1">* off</span><span class="s2">, </span><span class="s4">4 </span><span class="s1">* off]</span><span class="s2">, </span><span class="s1">dtype=object)</span><span class="s2">,</span>
                <span class="s3">&quot;B&quot;</span><span class="s1">: np.array([</span><span class="s4">16 </span><span class="s1">* off</span><span class="s2">, </span><span class="s4">16 </span><span class="s1">* off]</span><span class="s2">, </span><span class="s1">dtype=object)</span><span class="s2">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(df2 - df</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s1">tm.assert_frame_equal(df - df2</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1 </span><span class="s1">* exp)</span>


<span class="s2">class </span><span class="s1">TestPeriodIndexArithmetic:</span>
    <span class="s0"># ---------------------------------------------------------------</span>
    <span class="s0"># __add__/__sub__ with PeriodIndex</span>
    <span class="s0"># PeriodIndex + other is defined for integers and timedelta-like others</span>
    <span class="s0"># PeriodIndex - other is defined for integers, timedelta-like others,</span>
    <span class="s0">#   and PeriodIndex (with matching freq)</span>

    <span class="s2">def </span><span class="s1">test_parr_add_iadd_parr_raises(self</span><span class="s2">, </span><span class="s1">box_with_array):</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">other = period_range(</span><span class="s3">&quot;1/6/2000&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s0"># TODO: parametrize over boxes for other?</span>

        <span class="s1">rng = tm.box_expected(rng</span><span class="s2">, </span><span class="s1">box_with_array)</span>
        <span class="s0"># An earlier implementation of PeriodIndex addition performed</span>
        <span class="s0"># a set operation (union).  This has since been changed to</span>
        <span class="s0"># raise a TypeError. See GH#14164 and GH#13077 for historical</span>
        <span class="s0"># reference.</span>
        <span class="s1">msg = </span><span class="s3">r&quot;unsupported operand type\(s\) for \+: .* and .*&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">rng + other</span>

        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">rng += other</span>

    <span class="s2">def </span><span class="s1">test_pi_sub_isub_pi(self):</span>
        <span class="s0"># GH#20049</span>
        <span class="s0"># For historical reference see GH#14164, GH#13077.</span>
        <span class="s0"># PeriodIndex subtraction originally performed set difference,</span>
        <span class="s0"># then changed to raise TypeError before being implemented in GH#20049</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">other = period_range(</span><span class="s3">&quot;1/6/2000&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s1">)</span>

        <span class="s1">off = rng.freq</span>
        <span class="s1">expected = pd.Index([-</span><span class="s4">5 </span><span class="s1">* off] * </span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">result = rng - other</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">rng -= other</span>
        <span class="s1">tm.assert_index_equal(rng</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_pi_sub_pi_with_nat(self):</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">other = rng[</span><span class="s4">1</span><span class="s1">:].insert(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">pd.NaT)</span>
        <span class="s2">assert </span><span class="s1">other[</span><span class="s4">1</span><span class="s1">:].equals(rng[</span><span class="s4">1</span><span class="s1">:])</span>

        <span class="s1">result = rng - other</span>
        <span class="s1">off = rng.freq</span>
        <span class="s1">expected = pd.Index([pd.NaT</span><span class="s2">, </span><span class="s4">0 </span><span class="s1">* off</span><span class="s2">, </span><span class="s4">0 </span><span class="s1">* off</span><span class="s2">, </span><span class="s4">0 </span><span class="s1">* off</span><span class="s2">, </span><span class="s4">0 </span><span class="s1">* off])</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_parr_sub_pi_mismatched_freq(self</span><span class="s2">, </span><span class="s1">box_with_array</span><span class="s2">, </span><span class="s1">box_with_array2):</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">other = period_range(</span><span class="s3">&quot;1/6/2000&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;H&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s1">)</span>

        <span class="s1">rng = tm.box_expected(rng</span><span class="s2">, </span><span class="s1">box_with_array)</span>
        <span class="s1">other = tm.box_expected(other</span><span class="s2">, </span><span class="s1">box_with_array2)</span>
        <span class="s1">msg = </span><span class="s3">r&quot;Input has different freq=[HD] from PeriodArray\(freq=[DH]\)&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">rng - other</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;n&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_sub_n_gt_1_ticks(self</span><span class="s2">, </span><span class="s1">tick_classes</span><span class="s2">, </span><span class="s1">n):</span>
        <span class="s0"># GH 23878</span>
        <span class="s1">p1_d = </span><span class="s3">&quot;19910905&quot;</span>
        <span class="s1">p2_d = </span><span class="s3">&quot;19920406&quot;</span>
        <span class="s1">p1 = PeriodIndex([p1_d]</span><span class="s2">, </span><span class="s1">freq=tick_classes(n))</span>
        <span class="s1">p2 = PeriodIndex([p2_d]</span><span class="s2">, </span><span class="s1">freq=tick_classes(n))</span>

        <span class="s1">expected = PeriodIndex([p2_d]</span><span class="s2">, </span><span class="s1">freq=p2.freq.base) - PeriodIndex(</span>
            <span class="s1">[p1_d]</span><span class="s2">, </span><span class="s1">freq=p1.freq.base</span>
        <span class="s1">)</span>

        <span class="s1">tm.assert_index_equal((p2 - p1)</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;n&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;offset, kwd_name&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">(pd.offsets.YearEnd</span><span class="s2">, </span><span class="s3">&quot;month&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">(pd.offsets.QuarterEnd</span><span class="s2">, </span><span class="s3">&quot;startingMonth&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">(pd.offsets.MonthEnd</span><span class="s2">, None</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">(pd.offsets.Week</span><span class="s2">, </span><span class="s3">&quot;weekday&quot;</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_sub_n_gt_1_offsets(self</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">, </span><span class="s1">kwd_name</span><span class="s2">, </span><span class="s1">n):</span>
        <span class="s0"># GH 23878</span>
        <span class="s1">kwds = {kwd_name: </span><span class="s4">3</span><span class="s1">} </span><span class="s2">if </span><span class="s1">kwd_name </span><span class="s2">is not None else </span><span class="s1">{}</span>
        <span class="s1">p1_d = </span><span class="s3">&quot;19910905&quot;</span>
        <span class="s1">p2_d = </span><span class="s3">&quot;19920406&quot;</span>
        <span class="s1">freq = offset(n</span><span class="s2">, </span><span class="s1">normalize=</span><span class="s2">False, </span><span class="s1">**kwds)</span>
        <span class="s1">p1 = PeriodIndex([p1_d]</span><span class="s2">, </span><span class="s1">freq=freq)</span>
        <span class="s1">p2 = PeriodIndex([p2_d]</span><span class="s2">, </span><span class="s1">freq=freq)</span>

        <span class="s1">result = p2 - p1</span>
        <span class="s1">expected = PeriodIndex([p2_d]</span><span class="s2">, </span><span class="s1">freq=freq.base) - PeriodIndex(</span>
            <span class="s1">[p1_d]</span><span class="s2">, </span><span class="s1">freq=freq.base</span>
        <span class="s1">)</span>

        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s0"># -------------------------------------------------------------</span>
    <span class="s0"># Invalid Operations</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;other&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s0"># datetime scalars</span>
            <span class="s1">Timestamp(</span><span class="s3">&quot;2016-01-01&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">Timestamp(</span><span class="s3">&quot;2016-01-01&quot;</span><span class="s1">).to_pydatetime()</span><span class="s2">,</span>
            <span class="s1">Timestamp(</span><span class="s3">&quot;2016-01-01&quot;</span><span class="s1">).to_datetime64()</span><span class="s2">,</span>
            <span class="s0"># datetime-like arrays</span>
            <span class="s1">pd.date_range(</span><span class="s3">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;H&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">pd.date_range(</span><span class="s3">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">tz=</span><span class="s3">&quot;Europe/Brussels&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">pd.date_range(</span><span class="s3">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;S&quot;</span><span class="s1">)._data</span><span class="s2">,</span>
            <span class="s1">pd.date_range(</span><span class="s3">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">tz=</span><span class="s3">&quot;Asia/Tokyo&quot;</span><span class="s1">)._data</span><span class="s2">,</span>
            <span class="s0"># Miscellaneous invalid types</span>
            <span class="s4">3.14</span><span class="s2">,</span>
            <span class="s1">np.array([</span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">3.0</span><span class="s2">, </span><span class="s4">4.0</span><span class="s1">])</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_parr_add_sub_invalid(self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">, </span><span class="s1">box_with_array):</span>
        <span class="s0"># GH#23215</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">rng = tm.box_expected(rng</span><span class="s2">, </span><span class="s1">box_with_array)</span>

        <span class="s1">msg = </span><span class="s3">&quot;|&quot;</span><span class="s1">.join(</span>
            <span class="s1">[</span>
                <span class="s3">r&quot;(:?cannot add PeriodArray and .*)&quot;</span><span class="s2">,</span>
                <span class="s3">r&quot;(:?cannot subtract .* from (:?a\s)?.*)&quot;</span><span class="s2">,</span>
                <span class="s3">r&quot;(:?unsupported operand type\(s\) for \+: .* and .*)&quot;</span><span class="s2">,</span>
                <span class="s3">r&quot;unsupported operand type\(s\) for [+-]: .* and .*&quot;</span><span class="s2">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">assert_invalid_addsub_type(rng</span><span class="s2">, </span><span class="s1">other</span><span class="s2">, </span><span class="s1">msg)</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">rng + other</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">other + rng</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">rng - other</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">other - rng</span>

    <span class="s0"># -----------------------------------------------------------------</span>
    <span class="s0"># __add__/__sub__ with ndarray[datetime64] and ndarray[timedelta64]</span>

    <span class="s2">def </span><span class="s1">test_pi_add_sub_td64_array_non_tick_raises(self):</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;Q&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">tdi = TimedeltaIndex([</span><span class="s3">&quot;-1 Day&quot;</span><span class="s2">, </span><span class="s3">&quot;-1 Day&quot;</span><span class="s2">, </span><span class="s3">&quot;-1 Day&quot;</span><span class="s1">])</span>
        <span class="s1">tdarr = tdi.values</span>

        <span class="s1">msg = </span><span class="s3">r&quot;Cannot add or subtract timedelta64\[ns\] dtype from period\[Q-DEC\]&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">rng + tdarr</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">tdarr + rng</span>

        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">rng - tdarr</span>
        <span class="s1">msg = </span><span class="s3">r&quot;cannot subtract period\[Q-DEC\]-dtype from TimedeltaArray&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">tdarr - rng</span>

    <span class="s2">def </span><span class="s1">test_pi_add_sub_td64_array_tick(self):</span>
        <span class="s0"># PeriodIndex + Timedelta-like is allowed only with</span>
        <span class="s0">#   tick-like frequencies</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;90D&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">tdi = TimedeltaIndex([</span><span class="s3">&quot;-1 Day&quot;</span><span class="s2">, </span><span class="s3">&quot;-1 Day&quot;</span><span class="s2">, </span><span class="s3">&quot;-1 Day&quot;</span><span class="s1">])</span>
        <span class="s1">tdarr = tdi.values</span>

        <span class="s1">expected = period_range(</span><span class="s3">&quot;12/31/1999&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;90D&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">result = rng + tdi</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">result = rng + tdarr</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">result = tdi + rng</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">result = tdarr + rng</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">expected = period_range(</span><span class="s3">&quot;1/2/2000&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;90D&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">3</span><span class="s1">)</span>

        <span class="s1">result = rng - tdi</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">result = rng - tdarr</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">msg = </span><span class="s3">r&quot;cannot subtract .* from .*&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">tdarr - rng</span>

        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">tdi - rng</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;pi_freq&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;W&quot;</span><span class="s2">, </span><span class="s3">&quot;Q&quot;</span><span class="s2">, </span><span class="s3">&quot;H&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;tdi_freq&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s2">None, </span><span class="s3">&quot;H&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_parr_sub_td64array(self</span><span class="s2">, </span><span class="s1">box_with_array</span><span class="s2">, </span><span class="s1">tdi_freq</span><span class="s2">, </span><span class="s1">pi_freq):</span>
        <span class="s1">box = box_with_array</span>
        <span class="s1">xbox = box </span><span class="s2">if </span><span class="s1">box </span><span class="s2">not in </span><span class="s1">[pd.array</span><span class="s2">, </span><span class="s1">tm.to_array] </span><span class="s2">else </span><span class="s1">pd.Index</span>

        <span class="s1">tdi = TimedeltaIndex([</span><span class="s3">&quot;1 hours&quot;</span><span class="s2">, </span><span class="s3">&quot;2 hours&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=tdi_freq)</span>
        <span class="s1">dti = Timestamp(</span><span class="s3">&quot;2018-03-07 17:16:40&quot;</span><span class="s1">) + tdi</span>
        <span class="s1">pi = dti.to_period(pi_freq)</span>

        <span class="s0"># TODO: parametrize over box for pi?</span>
        <span class="s1">td64obj = tm.box_expected(tdi</span><span class="s2">, </span><span class="s1">box)</span>

        <span class="s2">if </span><span class="s1">pi_freq == </span><span class="s3">&quot;H&quot;</span><span class="s1">:</span>
            <span class="s1">result = pi - td64obj</span>
            <span class="s1">expected = (pi.to_timestamp(</span><span class="s3">&quot;S&quot;</span><span class="s1">) - tdi).to_period(pi_freq)</span>
            <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">xbox)</span>
            <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

            <span class="s0"># Subtract from scalar</span>
            <span class="s1">result = pi[</span><span class="s4">0</span><span class="s1">] - td64obj</span>
            <span class="s1">expected = (pi[</span><span class="s4">0</span><span class="s1">].to_timestamp(</span><span class="s3">&quot;S&quot;</span><span class="s1">) - tdi).to_period(pi_freq)</span>
            <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">box)</span>
            <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s2">elif </span><span class="s1">pi_freq == </span><span class="s3">&quot;D&quot;</span><span class="s1">:</span>
            <span class="s0"># Tick, but non-compatible</span>
            <span class="s1">msg = </span><span class="s3">&quot;Input has different freq=None from PeriodArray&quot;</span>
            <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
                <span class="s1">pi - td64obj</span>
            <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
                <span class="s1">pi[</span><span class="s4">0</span><span class="s1">] - td64obj</span>

        <span class="s2">else</span><span class="s1">:</span>
            <span class="s0"># With non-Tick freq, we could not add timedelta64 array regardless</span>
            <span class="s0">#  of what its resolution is</span>
            <span class="s1">msg = </span><span class="s3">&quot;Cannot add or subtract timedelta64&quot;</span>
            <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
                <span class="s1">pi - td64obj</span>
            <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
                <span class="s1">pi[</span><span class="s4">0</span><span class="s1">] - td64obj</span>

    <span class="s0"># -----------------------------------------------------------------</span>
    <span class="s0"># operations with array/Index of DateOffset objects</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;box&quot;</span><span class="s2">, </span><span class="s1">[np.array</span><span class="s2">, </span><span class="s1">pd.Index])</span>
    <span class="s2">def </span><span class="s1">test_pi_add_offset_array(self</span><span class="s2">, </span><span class="s1">box):</span>
        <span class="s0"># GH#18849</span>
        <span class="s1">pi = PeriodIndex([Period(</span><span class="s3">&quot;2015Q1&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">Period(</span><span class="s3">&quot;2016Q2&quot;</span><span class="s1">)])</span>
        <span class="s1">offs = box(</span>
            <span class="s1">[</span>
                <span class="s1">pd.offsets.QuarterEnd(n=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">startingMonth=</span><span class="s4">12</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">pd.offsets.QuarterEnd(n=-</span><span class="s4">2</span><span class="s2">, </span><span class="s1">startingMonth=</span><span class="s4">12</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">expected = PeriodIndex([Period(</span><span class="s3">&quot;2015Q2&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">Period(</span><span class="s3">&quot;2015Q4&quot;</span><span class="s1">)])</span>

        <span class="s2">with </span><span class="s1">tm.assert_produces_warning(PerformanceWarning):</span>
            <span class="s1">res = pi + offs</span>
        <span class="s1">tm.assert_index_equal(res</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s2">with </span><span class="s1">tm.assert_produces_warning(PerformanceWarning):</span>
            <span class="s1">res2 = offs + pi</span>
        <span class="s1">tm.assert_index_equal(res2</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">unanchored = np.array([pd.offsets.Hour(n=</span><span class="s4">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">pd.offsets.Minute(n=-</span><span class="s4">2</span><span class="s1">)])</span>
        <span class="s0"># addition/subtraction ops with incompatible offsets should issue</span>
        <span class="s0"># a PerformanceWarning and _then_ raise a TypeError.</span>
        <span class="s1">msg = </span><span class="s3">r&quot;Input cannot be converted to Period\(freq=Q-DEC\)&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s2">with </span><span class="s1">tm.assert_produces_warning(PerformanceWarning):</span>
                <span class="s1">pi + unanchored</span>
        <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s2">with </span><span class="s1">tm.assert_produces_warning(PerformanceWarning):</span>
                <span class="s1">unanchored + pi</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;box&quot;</span><span class="s2">, </span><span class="s1">[np.array</span><span class="s2">, </span><span class="s1">pd.Index])</span>
    <span class="s2">def </span><span class="s1">test_pi_sub_offset_array(self</span><span class="s2">, </span><span class="s1">box):</span>
        <span class="s0"># GH#18824</span>
        <span class="s1">pi = PeriodIndex([Period(</span><span class="s3">&quot;2015Q1&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">Period(</span><span class="s3">&quot;2016Q2&quot;</span><span class="s1">)])</span>
        <span class="s1">other = box(</span>
            <span class="s1">[</span>
                <span class="s1">pd.offsets.QuarterEnd(n=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">startingMonth=</span><span class="s4">12</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">pd.offsets.QuarterEnd(n=-</span><span class="s4">2</span><span class="s2">, </span><span class="s1">startingMonth=</span><span class="s4">12</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>

        <span class="s1">expected = PeriodIndex([pi[n] - other[n] </span><span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">range(len(pi))])</span>

        <span class="s2">with </span><span class="s1">tm.assert_produces_warning(PerformanceWarning):</span>
            <span class="s1">res = pi - other</span>
        <span class="s1">tm.assert_index_equal(res</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">anchored = box([pd.offsets.MonthEnd()</span><span class="s2">, </span><span class="s1">pd.offsets.Day(n=</span><span class="s4">2</span><span class="s1">)])</span>

        <span class="s0"># addition/subtraction ops with anchored offsets should issue</span>
        <span class="s0"># a PerformanceWarning and _then_ raise a TypeError.</span>
        <span class="s1">msg = </span><span class="s3">r&quot;Input has different freq=-1M from Period\(freq=Q-DEC\)&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s2">with </span><span class="s1">tm.assert_produces_warning(PerformanceWarning):</span>
                <span class="s1">pi - anchored</span>
        <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s2">with </span><span class="s1">tm.assert_produces_warning(PerformanceWarning):</span>
                <span class="s1">anchored - pi</span>

    <span class="s2">def </span><span class="s1">test_pi_add_iadd_int(self</span><span class="s2">, </span><span class="s1">one):</span>
        <span class="s0"># Variants of `one` for #19012</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;2000-01-01 09:00&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;H&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">result = rng + one</span>
        <span class="s1">expected = period_range(</span><span class="s3">&quot;2000-01-01 10:00&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;H&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">rng += one</span>
        <span class="s1">tm.assert_index_equal(rng</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_pi_sub_isub_int(self</span><span class="s2">, </span><span class="s1">one):</span>
        <span class="s5">&quot;&quot;&quot; 
        PeriodIndex.__sub__ and __isub__ with several representations of 
        the integer 1, e.g. int, np.int64, np.uint8, ... 
        &quot;&quot;&quot;</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;2000-01-01 09:00&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;H&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">result = rng - one</span>
        <span class="s1">expected = period_range(</span><span class="s3">&quot;2000-01-01 08:00&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;H&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">rng -= one</span>
        <span class="s1">tm.assert_index_equal(rng</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;five&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">5</span><span class="s2">, </span><span class="s1">np.array(</span><span class="s4">5</span><span class="s2">, </span><span class="s1">dtype=np.int64)])</span>
    <span class="s2">def </span><span class="s1">test_pi_sub_intlike(self</span><span class="s2">, </span><span class="s1">five):</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;2007-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">50</span><span class="s1">)</span>

        <span class="s1">result = rng - five</span>
        <span class="s1">exp = rng + (-five)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>

    <span class="s2">def </span><span class="s1">test_pi_sub_isub_offset(self):</span>
        <span class="s0"># offset</span>
        <span class="s0"># DateOffset</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;2014&quot;</span><span class="s2">, </span><span class="s3">&quot;2024&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;A&quot;</span><span class="s1">)</span>
        <span class="s1">result = rng - pd.offsets.YearEnd(</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">expected = period_range(</span><span class="s3">&quot;2009&quot;</span><span class="s2">, </span><span class="s3">&quot;2019&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;A&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">rng -= pd.offsets.YearEnd(</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(rng</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">rng = period_range(</span><span class="s3">&quot;2014-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2016-12&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span>
        <span class="s1">result = rng - pd.offsets.MonthEnd(</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">expected = period_range(</span><span class="s3">&quot;2013-08&quot;</span><span class="s2">, </span><span class="s3">&quot;2016-07&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">rng -= pd.offsets.MonthEnd(</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(rng</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;transpose&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s2">True, False</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_pi_add_offset_n_gt1(self</span><span class="s2">, </span><span class="s1">box_with_array</span><span class="s2">, </span><span class="s1">transpose):</span>
        <span class="s0"># GH#23215</span>
        <span class="s0"># add offset to PeriodIndex with freq.n &gt; 1</span>

        <span class="s1">per = Period(</span><span class="s3">&quot;2016-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;2M&quot;</span><span class="s1">)</span>
        <span class="s1">pi = PeriodIndex([per])</span>

        <span class="s1">expected = PeriodIndex([</span><span class="s3">&quot;2016-03&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;2M&quot;</span><span class="s1">)</span>

        <span class="s1">pi = tm.box_expected(pi</span><span class="s2">, </span><span class="s1">box_with_array</span><span class="s2">, </span><span class="s1">transpose=transpose)</span>
        <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">box_with_array</span><span class="s2">, </span><span class="s1">transpose=transpose)</span>

        <span class="s1">result = pi + per.freq</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">result = per.freq + pi</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_pi_add_offset_n_gt1_not_divisible(self</span><span class="s2">, </span><span class="s1">box_with_array):</span>
        <span class="s0"># GH#23215</span>
        <span class="s0"># PeriodIndex with freq.n &gt; 1 add offset with offset.n % freq.n != 0</span>
        <span class="s1">pi = PeriodIndex([</span><span class="s3">&quot;2016-01&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;2M&quot;</span><span class="s1">)</span>
        <span class="s1">expected = PeriodIndex([</span><span class="s3">&quot;2016-04&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;2M&quot;</span><span class="s1">)</span>

        <span class="s1">pi = tm.box_expected(pi</span><span class="s2">, </span><span class="s1">box_with_array)</span>
        <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">box_with_array)</span>

        <span class="s1">result = pi + to_offset(</span><span class="s3">&quot;3M&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">result = to_offset(</span><span class="s3">&quot;3M&quot;</span><span class="s1">) + pi</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s0"># ---------------------------------------------------------------</span>
    <span class="s0"># __add__/__sub__ with integer arrays</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;int_holder&quot;</span><span class="s2">, </span><span class="s1">[np.array</span><span class="s2">, </span><span class="s1">pd.Index])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;op&quot;</span><span class="s2">, </span><span class="s1">[operator.add</span><span class="s2">, </span><span class="s1">ops.radd])</span>
    <span class="s2">def </span><span class="s1">test_pi_add_intarray(self</span><span class="s2">, </span><span class="s1">int_holder</span><span class="s2">, </span><span class="s1">op):</span>
        <span class="s0"># GH#19959</span>
        <span class="s1">pi = PeriodIndex([Period(</span><span class="s3">&quot;2015Q1&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">Period(</span><span class="s3">&quot;NaT&quot;</span><span class="s1">)])</span>
        <span class="s1">other = int_holder([</span><span class="s4">4</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">])</span>

        <span class="s1">result = op(pi</span><span class="s2">, </span><span class="s1">other)</span>
        <span class="s1">expected = PeriodIndex([Period(</span><span class="s3">&quot;2016Q1&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">Period(</span><span class="s3">&quot;NaT&quot;</span><span class="s1">)])</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;int_holder&quot;</span><span class="s2">, </span><span class="s1">[np.array</span><span class="s2">, </span><span class="s1">pd.Index])</span>
    <span class="s2">def </span><span class="s1">test_pi_sub_intarray(self</span><span class="s2">, </span><span class="s1">int_holder):</span>
        <span class="s0"># GH#19959</span>
        <span class="s1">pi = PeriodIndex([Period(</span><span class="s3">&quot;2015Q1&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">Period(</span><span class="s3">&quot;NaT&quot;</span><span class="s1">)])</span>
        <span class="s1">other = int_holder([</span><span class="s4">4</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">])</span>

        <span class="s1">result = pi - other</span>
        <span class="s1">expected = PeriodIndex([Period(</span><span class="s3">&quot;2014Q1&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">Period(</span><span class="s3">&quot;NaT&quot;</span><span class="s1">)])</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">msg = </span><span class="s3">r&quot;bad operand type for unary -: 'PeriodArray'&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">other - pi</span>

    <span class="s0"># ---------------------------------------------------------------</span>
    <span class="s0"># Timedelta-like (timedelta, timedelta64, Timedelta, Tick)</span>
    <span class="s0"># TODO: Some of these are misnomers because of non-Tick DateOffsets</span>

    <span class="s2">def </span><span class="s1">test_parr_add_timedeltalike_minute_gt1(self</span><span class="s2">, </span><span class="s1">three_days</span><span class="s2">, </span><span class="s1">box_with_array):</span>
        <span class="s0"># GH#23031 adding a time-delta-like offset to a PeriodArray that has</span>
        <span class="s0"># minute frequency with n != 1.  A more general case is tested below</span>
        <span class="s0"># in test_pi_add_timedeltalike_tick_gt1, but here we write out the</span>
        <span class="s0"># expected result more explicitly.</span>
        <span class="s1">other = three_days</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;2014-05-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;2D&quot;</span><span class="s1">)</span>
        <span class="s1">rng = tm.box_expected(rng</span><span class="s2">, </span><span class="s1">box_with_array)</span>

        <span class="s1">expected = PeriodIndex([</span><span class="s3">&quot;2014-05-04&quot;</span><span class="s2">, </span><span class="s3">&quot;2014-05-06&quot;</span><span class="s2">, </span><span class="s3">&quot;2014-05-08&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;2D&quot;</span><span class="s1">)</span>
        <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">box_with_array)</span>

        <span class="s1">result = rng + other</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">result = other + rng</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s0"># subtraction</span>
        <span class="s1">expected = PeriodIndex([</span><span class="s3">&quot;2014-04-28&quot;</span><span class="s2">, </span><span class="s3">&quot;2014-04-30&quot;</span><span class="s2">, </span><span class="s3">&quot;2014-05-02&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;2D&quot;</span><span class="s1">)</span>
        <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">box_with_array)</span>
        <span class="s1">result = rng - other</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">msg = </span><span class="s3">&quot;|&quot;</span><span class="s1">.join(</span>
            <span class="s1">[</span>
                <span class="s3">r&quot;bad operand type for unary -: 'PeriodArray'&quot;</span><span class="s2">,</span>
                <span class="s3">r&quot;cannot subtract PeriodArray from timedelta64\[[hD]\]&quot;</span><span class="s2">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">other - rng</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;freqstr&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;5ns&quot;</span><span class="s2">, </span><span class="s3">&quot;5us&quot;</span><span class="s2">, </span><span class="s3">&quot;5ms&quot;</span><span class="s2">, </span><span class="s3">&quot;5s&quot;</span><span class="s2">, </span><span class="s3">&quot;5T&quot;</span><span class="s2">, </span><span class="s3">&quot;5h&quot;</span><span class="s2">, </span><span class="s3">&quot;5d&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_parr_add_timedeltalike_tick_gt1(self</span><span class="s2">, </span><span class="s1">three_days</span><span class="s2">, </span><span class="s1">freqstr</span><span class="s2">, </span><span class="s1">box_with_array):</span>
        <span class="s0"># GH#23031 adding a time-delta-like offset to a PeriodArray that has</span>
        <span class="s0"># tick-like frequency with n != 1</span>
        <span class="s1">other = three_days</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;2014-05-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">6</span><span class="s2">, </span><span class="s1">freq=freqstr)</span>
        <span class="s1">first = rng[</span><span class="s4">0</span><span class="s1">]</span>
        <span class="s1">rng = tm.box_expected(rng</span><span class="s2">, </span><span class="s1">box_with_array)</span>

        <span class="s1">expected = period_range(first + other</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">6</span><span class="s2">, </span><span class="s1">freq=freqstr)</span>
        <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">box_with_array)</span>

        <span class="s1">result = rng + other</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">result = other + rng</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s0"># subtraction</span>
        <span class="s1">expected = period_range(first - other</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">6</span><span class="s2">, </span><span class="s1">freq=freqstr)</span>
        <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">box_with_array)</span>
        <span class="s1">result = rng - other</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">msg = </span><span class="s3">&quot;|&quot;</span><span class="s1">.join(</span>
            <span class="s1">[</span>
                <span class="s3">r&quot;bad operand type for unary -: 'PeriodArray'&quot;</span><span class="s2">,</span>
                <span class="s3">r&quot;cannot subtract PeriodArray from timedelta64\[[hD]\]&quot;</span><span class="s2">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">other - rng</span>

    <span class="s2">def </span><span class="s1">test_pi_add_iadd_timedeltalike_daily(self</span><span class="s2">, </span><span class="s1">three_days):</span>
        <span class="s0"># Tick</span>
        <span class="s1">other = three_days</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;2014-05-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2014-05-15&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s1">expected = period_range(</span><span class="s3">&quot;2014-05-04&quot;</span><span class="s2">, </span><span class="s3">&quot;2014-05-18&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s1">)</span>

        <span class="s1">result = rng + other</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">rng += other</span>
        <span class="s1">tm.assert_index_equal(rng</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_pi_sub_isub_timedeltalike_daily(self</span><span class="s2">, </span><span class="s1">three_days):</span>
        <span class="s0"># Tick-like 3 Days</span>
        <span class="s1">other = three_days</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;2014-05-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2014-05-15&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s1">expected = period_range(</span><span class="s3">&quot;2014-04-28&quot;</span><span class="s2">, </span><span class="s3">&quot;2014-05-12&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s1">)</span>

        <span class="s1">result = rng - other</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">rng -= other</span>
        <span class="s1">tm.assert_index_equal(rng</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_parr_add_sub_timedeltalike_freq_mismatch_daily(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">not_daily</span><span class="s2">, </span><span class="s1">box_with_array</span>
    <span class="s1">):</span>
        <span class="s1">other = not_daily</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;2014-05-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2014-05-15&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s1">rng = tm.box_expected(rng</span><span class="s2">, </span><span class="s1">box_with_array)</span>

        <span class="s1">msg = </span><span class="s3">&quot;Input has different freq(=.+)? from Period.*?</span><span class="s2">\\</span><span class="s3">(freq=D</span><span class="s2">\\</span><span class="s3">)&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">rng + other</span>
        <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">rng += other</span>
        <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">rng - other</span>
        <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">rng -= other</span>

    <span class="s2">def </span><span class="s1">test_pi_add_iadd_timedeltalike_hourly(self</span><span class="s2">, </span><span class="s1">two_hours):</span>
        <span class="s1">other = two_hours</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;2014-01-01 10:00&quot;</span><span class="s2">, </span><span class="s3">&quot;2014-01-05 10:00&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;H&quot;</span><span class="s1">)</span>
        <span class="s1">expected = period_range(</span><span class="s3">&quot;2014-01-01 12:00&quot;</span><span class="s2">, </span><span class="s3">&quot;2014-01-05 12:00&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;H&quot;</span><span class="s1">)</span>

        <span class="s1">result = rng + other</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">rng += other</span>
        <span class="s1">tm.assert_index_equal(rng</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_parr_add_timedeltalike_mismatched_freq_hourly(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">not_hourly</span><span class="s2">, </span><span class="s1">box_with_array</span>
    <span class="s1">):</span>
        <span class="s1">other = not_hourly</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;2014-01-01 10:00&quot;</span><span class="s2">, </span><span class="s3">&quot;2014-01-05 10:00&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;H&quot;</span><span class="s1">)</span>
        <span class="s1">rng = tm.box_expected(rng</span><span class="s2">, </span><span class="s1">box_with_array)</span>
        <span class="s1">msg = </span><span class="s3">&quot;Input has different freq(=.+)? from Period.*?</span><span class="s2">\\</span><span class="s3">(freq=H</span><span class="s2">\\</span><span class="s3">)&quot;</span>

        <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">rng + other</span>

        <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">rng += other</span>

    <span class="s2">def </span><span class="s1">test_pi_sub_isub_timedeltalike_hourly(self</span><span class="s2">, </span><span class="s1">two_hours):</span>
        <span class="s1">other = two_hours</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;2014-01-01 10:00&quot;</span><span class="s2">, </span><span class="s3">&quot;2014-01-05 10:00&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;H&quot;</span><span class="s1">)</span>
        <span class="s1">expected = period_range(</span><span class="s3">&quot;2014-01-01 08:00&quot;</span><span class="s2">, </span><span class="s3">&quot;2014-01-05 08:00&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;H&quot;</span><span class="s1">)</span>

        <span class="s1">result = rng - other</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">rng -= other</span>
        <span class="s1">tm.assert_index_equal(rng</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_add_iadd_timedeltalike_annual(self):</span>
        <span class="s0"># offset</span>
        <span class="s0"># DateOffset</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;2014&quot;</span><span class="s2">, </span><span class="s3">&quot;2024&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;A&quot;</span><span class="s1">)</span>
        <span class="s1">result = rng + pd.offsets.YearEnd(</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">expected = period_range(</span><span class="s3">&quot;2019&quot;</span><span class="s2">, </span><span class="s3">&quot;2029&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;A&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">rng += pd.offsets.YearEnd(</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(rng</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_pi_add_sub_timedeltalike_freq_mismatch_annual(self</span><span class="s2">, </span><span class="s1">mismatched_freq):</span>
        <span class="s1">other = mismatched_freq</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;2014&quot;</span><span class="s2">, </span><span class="s3">&quot;2024&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;A&quot;</span><span class="s1">)</span>
        <span class="s1">msg = </span><span class="s3">&quot;Input has different freq(=.+)? from Period.*?</span><span class="s2">\\</span><span class="s3">(freq=A-DEC</span><span class="s2">\\</span><span class="s3">)&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">rng + other</span>
        <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">rng += other</span>
        <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">rng - other</span>
        <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">rng -= other</span>

    <span class="s2">def </span><span class="s1">test_pi_add_iadd_timedeltalike_M(self):</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;2014-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2016-12&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span>
        <span class="s1">expected = period_range(</span><span class="s3">&quot;2014-06&quot;</span><span class="s2">, </span><span class="s3">&quot;2017-05&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span>

        <span class="s1">result = rng + pd.offsets.MonthEnd(</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">rng += pd.offsets.MonthEnd(</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(rng</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_pi_add_sub_timedeltalike_freq_mismatch_monthly(self</span><span class="s2">, </span><span class="s1">mismatched_freq):</span>
        <span class="s1">other = mismatched_freq</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;2014-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2016-12&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span>
        <span class="s1">msg = </span><span class="s3">&quot;Input has different freq(=.+)? from Period.*?</span><span class="s2">\\</span><span class="s3">(freq=M</span><span class="s2">\\</span><span class="s3">)&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">rng + other</span>
        <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">rng += other</span>
        <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">rng - other</span>
        <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">rng -= other</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;transpose&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s2">True, False</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_parr_add_sub_td64_nat(self</span><span class="s2">, </span><span class="s1">box_with_array</span><span class="s2">, </span><span class="s1">transpose):</span>
        <span class="s0"># GH#23320 special handling for timedelta64(&quot;NaT&quot;)</span>
        <span class="s1">pi = period_range(</span><span class="s3">&quot;1994-04-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">9</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;19D&quot;</span><span class="s1">)</span>
        <span class="s1">other = np.timedelta64(</span><span class="s3">&quot;NaT&quot;</span><span class="s1">)</span>
        <span class="s1">expected = PeriodIndex([</span><span class="s3">&quot;NaT&quot;</span><span class="s1">] * </span><span class="s4">9</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;19D&quot;</span><span class="s1">)</span>

        <span class="s1">obj = tm.box_expected(pi</span><span class="s2">, </span><span class="s1">box_with_array</span><span class="s2">, </span><span class="s1">transpose=transpose)</span>
        <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">box_with_array</span><span class="s2">, </span><span class="s1">transpose=transpose)</span>

        <span class="s1">result = obj + other</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">result = other + obj</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">result = obj - other</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">msg = </span><span class="s3">r&quot;cannot subtract .* from .*&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">other - obj</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;other&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">np.array([</span><span class="s3">&quot;NaT&quot;</span><span class="s1">] * </span><span class="s4">9</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s3">&quot;m8[ns]&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">TimedeltaArray._from_sequence([</span><span class="s3">&quot;NaT&quot;</span><span class="s1">] * </span><span class="s4">9</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_parr_add_sub_tdt64_nat_array(self</span><span class="s2">, </span><span class="s1">box_with_array</span><span class="s2">, </span><span class="s1">other):</span>
        <span class="s1">pi = period_range(</span><span class="s3">&quot;1994-04-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">9</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;19D&quot;</span><span class="s1">)</span>
        <span class="s1">expected = PeriodIndex([</span><span class="s3">&quot;NaT&quot;</span><span class="s1">] * </span><span class="s4">9</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;19D&quot;</span><span class="s1">)</span>

        <span class="s1">obj = tm.box_expected(pi</span><span class="s2">, </span><span class="s1">box_with_array)</span>
        <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">box_with_array)</span>

        <span class="s1">result = obj + other</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">result = other + obj</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">result = obj - other</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">msg = </span><span class="s3">r&quot;cannot subtract .* from .*&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">other - obj</span>

    <span class="s0"># ---------------------------------------------------------------</span>
    <span class="s0"># Unsorted</span>

    <span class="s2">def </span><span class="s1">test_parr_add_sub_index(self):</span>
        <span class="s0"># Check that PeriodArray defers to Index on arithmetic ops</span>
        <span class="s1">pi = period_range(</span><span class="s3">&quot;2000-12-31&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">parr = pi.array</span>

        <span class="s1">result = parr - pi</span>
        <span class="s1">expected = pi - pi</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_parr_add_sub_object_array(self):</span>
        <span class="s1">pi = period_range(</span><span class="s3">&quot;2000-12-31&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s1">parr = pi.array</span>

        <span class="s1">other = np.array([Timedelta(days=</span><span class="s4">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">pd.offsets.Day(</span><span class="s4">2</span><span class="s1">)</span><span class="s2">, </span><span class="s4">3</span><span class="s1">])</span>

        <span class="s2">with </span><span class="s1">tm.assert_produces_warning(PerformanceWarning):</span>
            <span class="s1">result = parr + other</span>

        <span class="s1">expected = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2001-01-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2001-01-03&quot;</span><span class="s2">, </span><span class="s3">&quot;2001-01-05&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span>
        <span class="s1">).array</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s2">with </span><span class="s1">tm.assert_produces_warning(PerformanceWarning):</span>
            <span class="s1">result = parr - other</span>

        <span class="s1">expected = PeriodIndex([</span><span class="s3">&quot;2000-12-30&quot;</span><span class="s1">] * </span><span class="s4">3</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s1">).array</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s2">class </span><span class="s1">TestPeriodSeriesArithmetic:</span>
    <span class="s2">def </span><span class="s1">test_parr_add_timedeltalike_scalar(self</span><span class="s2">, </span><span class="s1">three_days</span><span class="s2">, </span><span class="s1">box_with_array):</span>
        <span class="s0"># GH#13043</span>
        <span class="s1">ser = Series(</span>
            <span class="s1">[Period(</span><span class="s3">&quot;2015-01-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">Period(</span><span class="s3">&quot;2015-01-02&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s1">)]</span><span class="s2">,</span>
            <span class="s1">name=</span><span class="s3">&quot;xxx&quot;</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">ser.dtype == </span><span class="s3">&quot;Period[D]&quot;</span>

        <span class="s1">expected = Series(</span>
            <span class="s1">[Period(</span><span class="s3">&quot;2015-01-04&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">Period(</span><span class="s3">&quot;2015-01-05&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s1">)]</span><span class="s2">,</span>
            <span class="s1">name=</span><span class="s3">&quot;xxx&quot;</span><span class="s2">,</span>
        <span class="s1">)</span>

        <span class="s1">obj = tm.box_expected(ser</span><span class="s2">, </span><span class="s1">box_with_array)</span>
        <span class="s2">if </span><span class="s1">box_with_array </span><span class="s2">is </span><span class="s1">pd.DataFrame:</span>
            <span class="s2">assert </span><span class="s1">(obj.dtypes == </span><span class="s3">&quot;Period[D]&quot;</span><span class="s1">).all()</span>

        <span class="s1">expected = tm.box_expected(expected</span><span class="s2">, </span><span class="s1">box_with_array)</span>

        <span class="s1">result = obj + three_days</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">result = three_days + obj</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_ops_series_period(self):</span>
        <span class="s0"># GH#13043</span>
        <span class="s1">ser = Series(</span>
            <span class="s1">[Period(</span><span class="s3">&quot;2015-01-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">Period(</span><span class="s3">&quot;2015-01-02&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s1">)]</span><span class="s2">,</span>
            <span class="s1">name=</span><span class="s3">&quot;xxx&quot;</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">ser.dtype == </span><span class="s3">&quot;Period[D]&quot;</span>

        <span class="s1">per = Period(</span><span class="s3">&quot;2015-01-10&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s1">off = per.freq</span>
        <span class="s0"># dtype will be object because of original dtype</span>
        <span class="s1">expected = Series([</span><span class="s4">9 </span><span class="s1">* off</span><span class="s2">, </span><span class="s4">8 </span><span class="s1">* off]</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;xxx&quot;</span><span class="s2">, </span><span class="s1">dtype=object)</span>
        <span class="s1">tm.assert_series_equal(per - ser</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">tm.assert_series_equal(ser - per</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1 </span><span class="s1">* expected)</span>

        <span class="s1">s2 = Series(</span>
            <span class="s1">[Period(</span><span class="s3">&quot;2015-01-05&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">Period(</span><span class="s3">&quot;2015-01-04&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s1">)]</span><span class="s2">,</span>
            <span class="s1">name=</span><span class="s3">&quot;xxx&quot;</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">s2.dtype == </span><span class="s3">&quot;Period[D]&quot;</span>

        <span class="s1">expected = Series([</span><span class="s4">4 </span><span class="s1">* off</span><span class="s2">, </span><span class="s4">2 </span><span class="s1">* off]</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;xxx&quot;</span><span class="s2">, </span><span class="s1">dtype=object)</span>
        <span class="s1">tm.assert_series_equal(s2 - ser</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">tm.assert_series_equal(ser - s2</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1 </span><span class="s1">* expected)</span>


<span class="s2">class </span><span class="s1">TestPeriodIndexSeriesMethods:</span>
    <span class="s5">&quot;&quot;&quot;Test PeriodIndex and Period Series Ops consistency&quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">_check(self</span><span class="s2">, </span><span class="s1">values</span><span class="s2">, </span><span class="s1">func</span><span class="s2">, </span><span class="s1">expected):</span>
        <span class="s1">idx = PeriodIndex(values)</span>
        <span class="s1">result = func(idx)</span>
        <span class="s1">tm.assert_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">ser = Series(values)</span>
        <span class="s1">result = func(ser)</span>

        <span class="s1">exp = Series(expected</span><span class="s2">, </span><span class="s1">name=values.name)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>

    <span class="s2">def </span><span class="s1">test_pi_ops(self):</span>
        <span class="s1">idx = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-02&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-03&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span>
        <span class="s1">)</span>

        <span class="s1">expected = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2011-03&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-05&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-06&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span>
        <span class="s1">)</span>

        <span class="s1">self._check(idx</span><span class="s2">, lambda </span><span class="s1">x: x + </span><span class="s4">2</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">self._check(idx</span><span class="s2">, lambda </span><span class="s1">x: </span><span class="s4">2 </span><span class="s1">+ x</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">self._check(idx + </span><span class="s4">2</span><span class="s2">, lambda </span><span class="s1">x: x - </span><span class="s4">2</span><span class="s2">, </span><span class="s1">idx)</span>

        <span class="s1">result = idx - Period(</span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span>
        <span class="s1">off = idx.freq</span>
        <span class="s1">exp = pd.Index([</span><span class="s4">0 </span><span class="s1">* off</span><span class="s2">, </span><span class="s4">1 </span><span class="s1">* off</span><span class="s2">, </span><span class="s4">2 </span><span class="s1">* off</span><span class="s2">, </span><span class="s4">3 </span><span class="s1">* off]</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">result = Period(</span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">) - idx</span>
        <span class="s1">exp = pd.Index([</span><span class="s4">0 </span><span class="s1">* off</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1 </span><span class="s1">* off</span><span class="s2">, </span><span class="s1">-</span><span class="s4">2 </span><span class="s1">* off</span><span class="s2">, </span><span class="s1">-</span><span class="s4">3 </span><span class="s1">* off]</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;ng&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;str&quot;</span><span class="s2">, </span><span class="s4">1.5</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;func&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s2">lambda </span><span class="s1">obj</span><span class="s2">, </span><span class="s1">ng: obj + ng</span><span class="s2">,</span>
            <span class="s2">lambda </span><span class="s1">obj</span><span class="s2">, </span><span class="s1">ng: ng + obj</span><span class="s2">,</span>
            <span class="s2">lambda </span><span class="s1">obj</span><span class="s2">, </span><span class="s1">ng: obj - ng</span><span class="s2">,</span>
            <span class="s2">lambda </span><span class="s1">obj</span><span class="s2">, </span><span class="s1">ng: ng - obj</span><span class="s2">,</span>
            <span class="s2">lambda </span><span class="s1">obj</span><span class="s2">, </span><span class="s1">ng: np.add(obj</span><span class="s2">, </span><span class="s1">ng)</span><span class="s2">,</span>
            <span class="s2">lambda </span><span class="s1">obj</span><span class="s2">, </span><span class="s1">ng: np.add(ng</span><span class="s2">, </span><span class="s1">obj)</span><span class="s2">,</span>
            <span class="s2">lambda </span><span class="s1">obj</span><span class="s2">, </span><span class="s1">ng: np.subtract(obj</span><span class="s2">, </span><span class="s1">ng)</span><span class="s2">,</span>
            <span class="s2">lambda </span><span class="s1">obj</span><span class="s2">, </span><span class="s1">ng: np.subtract(ng</span><span class="s2">, </span><span class="s1">obj)</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_parr_ops_errors(self</span><span class="s2">, </span><span class="s1">ng</span><span class="s2">, </span><span class="s1">func</span><span class="s2">, </span><span class="s1">box_with_array):</span>
        <span class="s1">idx = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-02&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-03&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span>
        <span class="s1">)</span>
        <span class="s1">obj = tm.box_expected(idx</span><span class="s2">, </span><span class="s1">box_with_array)</span>
        <span class="s1">msg = </span><span class="s3">&quot;|&quot;</span><span class="s1">.join(</span>
            <span class="s1">[</span>
                <span class="s3">r&quot;unsupported operand type\(s\)&quot;</span><span class="s2">,</span>
                <span class="s3">&quot;can only concatenate&quot;</span><span class="s2">,</span>
                <span class="s3">r&quot;must be str&quot;</span><span class="s2">,</span>
                <span class="s3">&quot;object to str implicitly&quot;</span><span class="s2">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">func(obj</span><span class="s2">, </span><span class="s1">ng)</span>

    <span class="s2">def </span><span class="s1">test_pi_ops_nat(self):</span>
        <span class="s1">idx = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-02&quot;</span><span class="s2">, </span><span class="s3">&quot;NaT&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span>
        <span class="s1">)</span>
        <span class="s1">expected = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2011-03&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04&quot;</span><span class="s2">, </span><span class="s3">&quot;NaT&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-06&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span>
        <span class="s1">)</span>

        <span class="s1">self._check(idx</span><span class="s2">, lambda </span><span class="s1">x: x + </span><span class="s4">2</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">self._check(idx</span><span class="s2">, lambda </span><span class="s1">x: </span><span class="s4">2 </span><span class="s1">+ x</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">self._check(idx</span><span class="s2">, lambda </span><span class="s1">x: np.add(x</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">self._check(idx + </span><span class="s4">2</span><span class="s2">, lambda </span><span class="s1">x: x - </span><span class="s4">2</span><span class="s2">, </span><span class="s1">idx)</span>
        <span class="s1">self._check(idx + </span><span class="s4">2</span><span class="s2">, lambda </span><span class="s1">x: np.subtract(x</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">idx)</span>

        <span class="s0"># freq with mult</span>
        <span class="s1">idx = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-02&quot;</span><span class="s2">, </span><span class="s3">&quot;NaT&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;2M&quot;</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span>
        <span class="s1">)</span>
        <span class="s1">expected = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2011-07&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-08&quot;</span><span class="s2">, </span><span class="s3">&quot;NaT&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-10&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;2M&quot;</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span>
        <span class="s1">)</span>

        <span class="s1">self._check(idx</span><span class="s2">, lambda </span><span class="s1">x: x + </span><span class="s4">3</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">self._check(idx</span><span class="s2">, lambda </span><span class="s1">x: </span><span class="s4">3 </span><span class="s1">+ x</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">self._check(idx</span><span class="s2">, lambda </span><span class="s1">x: np.add(x</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">self._check(idx + </span><span class="s4">3</span><span class="s2">, lambda </span><span class="s1">x: x - </span><span class="s4">3</span><span class="s2">, </span><span class="s1">idx)</span>
        <span class="s1">self._check(idx + </span><span class="s4">3</span><span class="s2">, lambda </span><span class="s1">x: np.subtract(x</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">idx)</span>

    <span class="s2">def </span><span class="s1">test_pi_ops_array_int(self):</span>

        <span class="s1">idx = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-02&quot;</span><span class="s2">, </span><span class="s3">&quot;NaT&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span>
        <span class="s1">)</span>
        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: x + np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">])</span>
        <span class="s1">exp = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2011-02&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04&quot;</span><span class="s2">, </span><span class="s3">&quot;NaT&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-08&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span>
        <span class="s1">)</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: np.add(x</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s4">4</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]))</span>
        <span class="s1">exp = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2011-05&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s3">&quot;NaT&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-06&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span>
        <span class="s1">)</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: x - np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">])</span>
        <span class="s1">exp = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2010-12&quot;</span><span class="s2">, </span><span class="s3">&quot;2010-12&quot;</span><span class="s2">, </span><span class="s3">&quot;NaT&quot;</span><span class="s2">, </span><span class="s3">&quot;2010-12&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span>
        <span class="s1">)</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: np.subtract(x</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s1">-</span><span class="s4">2</span><span class="s1">]))</span>
        <span class="s1">exp = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2010-10&quot;</span><span class="s2">, </span><span class="s3">&quot;2010-12&quot;</span><span class="s2">, </span><span class="s3">&quot;NaT&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-06&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span>
        <span class="s1">)</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>

    <span class="s2">def </span><span class="s1">test_pi_ops_offset(self):</span>
        <span class="s1">idx = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2011-01-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-02-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-03-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04-01&quot;</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s2">,</span>
            <span class="s1">name=</span><span class="s3">&quot;idx&quot;</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: x + pd.offsets.Day()</span>
        <span class="s1">exp = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2011-01-02&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-02-02&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-03-02&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04-02&quot;</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s2">,</span>
            <span class="s1">name=</span><span class="s3">&quot;idx&quot;</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: x + pd.offsets.Day(</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">exp = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2011-01-03&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-02-03&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-03-03&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04-03&quot;</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s2">,</span>
            <span class="s1">name=</span><span class="s3">&quot;idx&quot;</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">f = </span><span class="s2">lambda </span><span class="s1">x: x - pd.offsets.Day(</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">exp = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2010-12-30&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-01-30&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-02-27&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-03-30&quot;</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s2">,</span>
            <span class="s1">name=</span><span class="s3">&quot;idx&quot;</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">self._check(idx</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">exp)</span>

    <span class="s2">def </span><span class="s1">test_pi_offset_errors(self):</span>
        <span class="s1">idx = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2011-01-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-02-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-03-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04-01&quot;</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s2">,</span>
            <span class="s1">name=</span><span class="s3">&quot;idx&quot;</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">ser = Series(idx)</span>

        <span class="s0"># Series op is applied per Period instance, thus error is raised</span>
        <span class="s0"># from Period</span>
        <span class="s2">for </span><span class="s1">obj </span><span class="s2">in </span><span class="s1">[idx</span><span class="s2">, </span><span class="s1">ser]:</span>
            <span class="s1">msg = </span><span class="s3">r&quot;Input has different freq=2H from Period.*?\(freq=D\)&quot;</span>
            <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
                <span class="s1">obj + pd.offsets.Hour(</span><span class="s4">2</span><span class="s1">)</span>

            <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
                <span class="s1">pd.offsets.Hour(</span><span class="s4">2</span><span class="s1">) + obj</span>

            <span class="s1">msg = </span><span class="s3">r&quot;Input has different freq=-2H from Period.*?\(freq=D\)&quot;</span>
            <span class="s2">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match=msg):</span>
                <span class="s1">obj - pd.offsets.Hour(</span><span class="s4">2</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_pi_sub_period(self):</span>
        <span class="s0"># GH#13071</span>
        <span class="s1">idx = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-02&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-03&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span>
        <span class="s1">)</span>

        <span class="s1">result = idx - Period(</span><span class="s3">&quot;2012-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span>
        <span class="s1">off = idx.freq</span>
        <span class="s1">exp = pd.Index([-</span><span class="s4">12 </span><span class="s1">* off</span><span class="s2">, </span><span class="s1">-</span><span class="s4">11 </span><span class="s1">* off</span><span class="s2">, </span><span class="s1">-</span><span class="s4">10 </span><span class="s1">* off</span><span class="s2">, </span><span class="s1">-</span><span class="s4">9 </span><span class="s1">* off]</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">result = np.subtract(idx</span><span class="s2">, </span><span class="s1">Period(</span><span class="s3">&quot;2012-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">))</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">result = Period(</span><span class="s3">&quot;2012-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">) - idx</span>
        <span class="s1">exp = pd.Index([</span><span class="s4">12 </span><span class="s1">* off</span><span class="s2">, </span><span class="s4">11 </span><span class="s1">* off</span><span class="s2">, </span><span class="s4">10 </span><span class="s1">* off</span><span class="s2">, </span><span class="s4">9 </span><span class="s1">* off]</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">result = np.subtract(Period(</span><span class="s3">&quot;2012-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">idx)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">exp = TimedeltaIndex([np.nan</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">, </span><span class="s1">np.nan]</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span><span class="s1">)</span>
        <span class="s1">result = idx - Period(</span><span class="s3">&quot;NaT&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s2">assert </span><span class="s1">result.freq == exp.freq</span>

        <span class="s1">result = Period(</span><span class="s3">&quot;NaT&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">) - idx</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s2">assert </span><span class="s1">result.freq == exp.freq</span>

    <span class="s2">def </span><span class="s1">test_pi_sub_pdnat(self):</span>
        <span class="s0"># GH#13071</span>
        <span class="s1">idx = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-02&quot;</span><span class="s2">, </span><span class="s3">&quot;NaT&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span>
        <span class="s1">)</span>
        <span class="s1">exp = TimedeltaIndex([pd.NaT] * </span><span class="s4">4</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(pd.NaT - idx</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s1">tm.assert_index_equal(idx - pd.NaT</span><span class="s2">, </span><span class="s1">exp)</span>

    <span class="s2">def </span><span class="s1">test_pi_sub_period_nat(self):</span>
        <span class="s0"># GH#13071</span>
        <span class="s1">idx = PeriodIndex(</span>
            <span class="s1">[</span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s3">&quot;NaT&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-03&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-04&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span>
        <span class="s1">)</span>

        <span class="s1">result = idx - Period(</span><span class="s3">&quot;2012-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span>
        <span class="s1">off = idx.freq</span>
        <span class="s1">exp = pd.Index([-</span><span class="s4">12 </span><span class="s1">* off</span><span class="s2">, </span><span class="s1">pd.NaT</span><span class="s2">, </span><span class="s1">-</span><span class="s4">10 </span><span class="s1">* off</span><span class="s2">, </span><span class="s1">-</span><span class="s4">9 </span><span class="s1">* off]</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">result = Period(</span><span class="s3">&quot;2012-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">) - idx</span>
        <span class="s1">exp = pd.Index([</span><span class="s4">12 </span><span class="s1">* off</span><span class="s2">, </span><span class="s1">pd.NaT</span><span class="s2">, </span><span class="s4">10 </span><span class="s1">* off</span><span class="s2">, </span><span class="s4">9 </span><span class="s1">* off]</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s1">exp = TimedeltaIndex([np.nan</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">, </span><span class="s1">np.nan]</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(idx - Period(</span><span class="s3">&quot;NaT&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s1">tm.assert_index_equal(Period(</span><span class="s3">&quot;NaT&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">) - idx</span><span class="s2">, </span><span class="s1">exp)</span>
</pre>
</body>
</html>