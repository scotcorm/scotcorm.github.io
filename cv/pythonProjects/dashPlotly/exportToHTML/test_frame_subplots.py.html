<html>
<head>
<title>test_frame_subplots.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
.s5 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_frame_subplots.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; Test cases for DataFrame.plot &quot;&quot;&quot;</span>

<span class="s2">import </span><span class="s1">string</span>
<span class="s2">import </span><span class="s1">warnings</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">import </span><span class="s1">pytest</span>

<span class="s2">import </span><span class="s1">pandas.util._test_decorators </span><span class="s2">as </span><span class="s1">td</span>

<span class="s2">import </span><span class="s1">pandas </span><span class="s2">as </span><span class="s1">pd</span>
<span class="s2">from </span><span class="s1">pandas </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">DataFrame</span><span class="s2">,</span>
    <span class="s1">Series</span><span class="s2">,</span>
    <span class="s1">date_range</span><span class="s2">,</span>
<span class="s1">)</span>
<span class="s2">import </span><span class="s1">pandas._testing </span><span class="s2">as </span><span class="s1">tm</span>
<span class="s2">from </span><span class="s1">pandas.tests.plotting.common </span><span class="s2">import </span><span class="s1">TestPlotBase</span>

<span class="s2">from </span><span class="s1">pandas.io.formats.printing </span><span class="s2">import </span><span class="s1">pprint_thing</span>

<span class="s1">pytestmark = pytest.mark.slow</span>


<span class="s1">@td.skip_if_no_mpl</span>
<span class="s2">class </span><span class="s1">TestDataFramePlotsSubplots(TestPlotBase):</span>
    <span class="s2">def </span><span class="s1">setup_method(self</span><span class="s2">, </span><span class="s1">method):</span>
        <span class="s1">TestPlotBase.setup_method(self</span><span class="s2">, </span><span class="s1">method)</span>
        <span class="s2">import </span><span class="s1">matplotlib </span><span class="s2">as </span><span class="s1">mpl</span>

        <span class="s1">mpl.rcdefaults()</span>

        <span class="s1">self.tdf = tm.makeTimeDataFrame()</span>
        <span class="s1">self.hexbin_df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s3">&quot;A&quot;</span><span class="s1">: np.random.uniform(size=</span><span class="s4">20</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s3">&quot;B&quot;</span><span class="s1">: np.random.uniform(size=</span><span class="s4">20</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s3">&quot;C&quot;</span><span class="s1">: np.arange(</span><span class="s4">20</span><span class="s1">) + np.random.uniform(size=</span><span class="s4">20</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_subplots(self):</span>
        <span class="s1">df = DataFrame(np.random.rand(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">index=list(string.ascii_letters[:</span><span class="s4">10</span><span class="s1">]))</span>

        <span class="s2">for </span><span class="s1">kind </span><span class="s2">in </span><span class="s1">[</span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s3">&quot;line&quot;</span><span class="s2">, </span><span class="s3">&quot;area&quot;</span><span class="s1">]:</span>
            <span class="s1">axes = df.plot(kind=kind</span><span class="s2">, </span><span class="s1">subplots=</span><span class="s2">True, </span><span class="s1">sharex=</span><span class="s2">True, </span><span class="s1">legend=</span><span class="s2">True</span><span class="s1">)</span>
            <span class="s1">self._check_axes_shape(axes</span><span class="s2">, </span><span class="s1">axes_num=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">layout=(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s1">))</span>
            <span class="s2">assert </span><span class="s1">axes.shape == (</span><span class="s4">3</span><span class="s2">,</span><span class="s1">)</span>

            <span class="s2">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">column </span><span class="s2">in </span><span class="s1">zip(axes</span><span class="s2">, </span><span class="s1">df.columns):</span>
                <span class="s1">self._check_legend_labels(ax</span><span class="s2">, </span><span class="s1">labels=[pprint_thing(column)])</span>

            <span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">axes[:-</span><span class="s4">2</span><span class="s1">]:</span>
                <span class="s1">self._check_visible(ax.xaxis)  </span><span class="s5"># xaxis must be visible for grid</span>
                <span class="s1">self._check_visible(ax.get_xticklabels()</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">False</span><span class="s1">)</span>
                <span class="s2">if not </span><span class="s1">(kind == </span><span class="s3">&quot;bar&quot; </span><span class="s2">and </span><span class="s1">self.mpl_ge_3_1_0):</span>
                    <span class="s5"># change https://github.com/pandas-dev/pandas/issues/26714</span>
                    <span class="s1">self._check_visible(ax.get_xticklabels(minor=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">False</span><span class="s1">)</span>
                <span class="s1">self._check_visible(ax.xaxis.get_label()</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">False</span><span class="s1">)</span>
                <span class="s1">self._check_visible(ax.get_yticklabels())</span>

            <span class="s1">self._check_visible(axes[-</span><span class="s4">1</span><span class="s1">].xaxis)</span>
            <span class="s1">self._check_visible(axes[-</span><span class="s4">1</span><span class="s1">].get_xticklabels())</span>
            <span class="s1">self._check_visible(axes[-</span><span class="s4">1</span><span class="s1">].get_xticklabels(minor=</span><span class="s2">True</span><span class="s1">))</span>
            <span class="s1">self._check_visible(axes[-</span><span class="s4">1</span><span class="s1">].xaxis.get_label())</span>
            <span class="s1">self._check_visible(axes[-</span><span class="s4">1</span><span class="s1">].get_yticklabels())</span>

            <span class="s1">axes = df.plot(kind=kind</span><span class="s2">, </span><span class="s1">subplots=</span><span class="s2">True, </span><span class="s1">sharex=</span><span class="s2">False</span><span class="s1">)</span>
            <span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">axes:</span>
                <span class="s1">self._check_visible(ax.xaxis)</span>
                <span class="s1">self._check_visible(ax.get_xticklabels())</span>
                <span class="s1">self._check_visible(ax.get_xticklabels(minor=</span><span class="s2">True</span><span class="s1">))</span>
                <span class="s1">self._check_visible(ax.xaxis.get_label())</span>
                <span class="s1">self._check_visible(ax.get_yticklabels())</span>

            <span class="s1">axes = df.plot(kind=kind</span><span class="s2">, </span><span class="s1">subplots=</span><span class="s2">True, </span><span class="s1">legend=</span><span class="s2">False</span><span class="s1">)</span>
            <span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">axes:</span>
                <span class="s2">assert </span><span class="s1">ax.get_legend() </span><span class="s2">is None</span>

    <span class="s2">def </span><span class="s1">test_subplots_timeseries(self):</span>
        <span class="s1">idx = date_range(start=</span><span class="s3">&quot;2014-07-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">df = DataFrame(np.random.rand(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">index=idx)</span>

        <span class="s2">for </span><span class="s1">kind </span><span class="s2">in </span><span class="s1">[</span><span class="s3">&quot;line&quot;</span><span class="s2">, </span><span class="s3">&quot;area&quot;</span><span class="s1">]:</span>
            <span class="s1">axes = df.plot(kind=kind</span><span class="s2">, </span><span class="s1">subplots=</span><span class="s2">True, </span><span class="s1">sharex=</span><span class="s2">True</span><span class="s1">)</span>
            <span class="s1">self._check_axes_shape(axes</span><span class="s2">, </span><span class="s1">axes_num=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">layout=(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s1">))</span>

            <span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">axes[:-</span><span class="s4">2</span><span class="s1">]:</span>
                <span class="s5"># GH 7801</span>
                <span class="s1">self._check_visible(ax.xaxis)  </span><span class="s5"># xaxis must be visible for grid</span>
                <span class="s1">self._check_visible(ax.get_xticklabels()</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">False</span><span class="s1">)</span>
                <span class="s1">self._check_visible(ax.get_xticklabels(minor=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">False</span><span class="s1">)</span>
                <span class="s1">self._check_visible(ax.xaxis.get_label()</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">False</span><span class="s1">)</span>
                <span class="s1">self._check_visible(ax.get_yticklabels())</span>

            <span class="s1">self._check_visible(axes[-</span><span class="s4">1</span><span class="s1">].xaxis)</span>
            <span class="s1">self._check_visible(axes[-</span><span class="s4">1</span><span class="s1">].get_xticklabels())</span>
            <span class="s1">self._check_visible(axes[-</span><span class="s4">1</span><span class="s1">].get_xticklabels(minor=</span><span class="s2">True</span><span class="s1">))</span>
            <span class="s1">self._check_visible(axes[-</span><span class="s4">1</span><span class="s1">].xaxis.get_label())</span>
            <span class="s1">self._check_visible(axes[-</span><span class="s4">1</span><span class="s1">].get_yticklabels())</span>
            <span class="s1">self._check_ticks_props(axes</span><span class="s2">, </span><span class="s1">xrot=</span><span class="s4">0</span><span class="s1">)</span>

            <span class="s1">axes = df.plot(kind=kind</span><span class="s2">, </span><span class="s1">subplots=</span><span class="s2">True, </span><span class="s1">sharex=</span><span class="s2">False, </span><span class="s1">rot=</span><span class="s4">45</span><span class="s2">, </span><span class="s1">fontsize=</span><span class="s4">7</span><span class="s1">)</span>
            <span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">axes:</span>
                <span class="s1">self._check_visible(ax.xaxis)</span>
                <span class="s1">self._check_visible(ax.get_xticklabels())</span>
                <span class="s1">self._check_visible(ax.get_xticklabels(minor=</span><span class="s2">True</span><span class="s1">))</span>
                <span class="s1">self._check_visible(ax.xaxis.get_label())</span>
                <span class="s1">self._check_visible(ax.get_yticklabels())</span>
                <span class="s1">self._check_ticks_props(ax</span><span class="s2">, </span><span class="s1">xlabelsize=</span><span class="s4">7</span><span class="s2">, </span><span class="s1">xrot=</span><span class="s4">45</span><span class="s2">, </span><span class="s1">ylabelsize=</span><span class="s4">7</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_subplots_timeseries_y_axis(self):</span>
        <span class="s5"># GH16953</span>
        <span class="s1">data = {</span>
            <span class="s3">&quot;numeric&quot;</span><span class="s1">: np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s1">])</span><span class="s2">,</span>
            <span class="s3">&quot;timedelta&quot;</span><span class="s1">: [</span>
                <span class="s1">pd.Timedelta(-</span><span class="s4">10</span><span class="s2">, </span><span class="s1">unit=</span><span class="s3">&quot;s&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">pd.Timedelta(</span><span class="s4">10</span><span class="s2">, </span><span class="s1">unit=</span><span class="s3">&quot;m&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">pd.Timedelta(</span><span class="s4">10</span><span class="s2">, </span><span class="s1">unit=</span><span class="s3">&quot;h&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">,</span>
            <span class="s3">&quot;datetime_no_tz&quot;</span><span class="s1">: [</span>
                <span class="s1">pd.to_datetime(</span><span class="s3">&quot;2017-08-01 00:00:00&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">pd.to_datetime(</span><span class="s3">&quot;2017-08-01 02:00:00&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">pd.to_datetime(</span><span class="s3">&quot;2017-08-02 00:00:00&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">,</span>
            <span class="s3">&quot;datetime_all_tz&quot;</span><span class="s1">: [</span>
                <span class="s1">pd.to_datetime(</span><span class="s3">&quot;2017-08-01 00:00:00&quot;</span><span class="s2">, </span><span class="s1">utc=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">pd.to_datetime(</span><span class="s3">&quot;2017-08-01 02:00:00&quot;</span><span class="s2">, </span><span class="s1">utc=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">pd.to_datetime(</span><span class="s3">&quot;2017-08-02 00:00:00&quot;</span><span class="s2">, </span><span class="s1">utc=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">,</span>
            <span class="s3">&quot;text&quot;</span><span class="s1">: [</span><span class="s3">&quot;This&quot;</span><span class="s2">, </span><span class="s3">&quot;should&quot;</span><span class="s2">, </span><span class="s3">&quot;fail&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">}</span>
        <span class="s1">testdata = DataFrame(data)</span>

        <span class="s1">y_cols = [</span><span class="s3">&quot;numeric&quot;</span><span class="s2">, </span><span class="s3">&quot;timedelta&quot;</span><span class="s2">, </span><span class="s3">&quot;datetime_no_tz&quot;</span><span class="s2">, </span><span class="s3">&quot;datetime_all_tz&quot;</span><span class="s1">]</span>
        <span class="s2">for </span><span class="s1">col </span><span class="s2">in </span><span class="s1">y_cols:</span>
            <span class="s1">ax = testdata.plot(y=col)</span>
            <span class="s1">result = ax.get_lines()[</span><span class="s4">0</span><span class="s1">].get_data()[</span><span class="s4">1</span><span class="s1">]</span>
            <span class="s1">expected = testdata[col].values</span>
            <span class="s2">assert </span><span class="s1">(result == expected).all()</span>

        <span class="s1">msg = </span><span class="s3">&quot;no numeric data to plot&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">testdata.plot(y=</span><span class="s3">&quot;text&quot;</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.xfail(reason=</span><span class="s3">&quot;not support for period, categorical, datetime_mixed_tz&quot;</span><span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_subplots_timeseries_y_axis_not_supported(self):</span>
        <span class="s0">&quot;&quot;&quot; 
        This test will fail for: 
            period: 
                since period isn't yet implemented in ``select_dtypes`` 
                and because it will need a custom value converter + 
                tick formatter (as was done for x-axis plots) 
 
            categorical: 
                 because it will need a custom value converter + 
                 tick formatter (also doesn't work for x-axis, as of now) 
 
            datetime_mixed_tz: 
                because of the way how pandas handles ``Series`` of 
                ``datetime`` objects with different timezone, 
                generally converting ``datetime`` objects in a tz-aware 
                form could help with this problem 
        &quot;&quot;&quot;</span>
        <span class="s1">data = {</span>
            <span class="s3">&quot;numeric&quot;</span><span class="s1">: np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s1">])</span><span class="s2">,</span>
            <span class="s3">&quot;period&quot;</span><span class="s1">: [</span>
                <span class="s1">pd.Period(</span><span class="s3">&quot;2017-08-01 00:00:00&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;H&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">pd.Period(</span><span class="s3">&quot;2017-08-01 02:00&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;H&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">pd.Period(</span><span class="s3">&quot;2017-08-02 00:00:00&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;H&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">,</span>
            <span class="s3">&quot;categorical&quot;</span><span class="s1">: pd.Categorical(</span>
                <span class="s1">[</span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">categories=[</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ordered=</span><span class="s2">False</span>
            <span class="s1">)</span><span class="s2">,</span>
            <span class="s3">&quot;datetime_mixed_tz&quot;</span><span class="s1">: [</span>
                <span class="s1">pd.to_datetime(</span><span class="s3">&quot;2017-08-01 00:00:00&quot;</span><span class="s2">, </span><span class="s1">utc=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">pd.to_datetime(</span><span class="s3">&quot;2017-08-01 02:00:00&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">pd.to_datetime(</span><span class="s3">&quot;2017-08-02 00:00:00&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">,</span>
        <span class="s1">}</span>
        <span class="s1">testdata = DataFrame(data)</span>
        <span class="s1">ax_period = testdata.plot(x=</span><span class="s3">&quot;numeric&quot;</span><span class="s2">, </span><span class="s1">y=</span><span class="s3">&quot;period&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">(</span>
            <span class="s1">ax_period.get_lines()[</span><span class="s4">0</span><span class="s1">].get_data()[</span><span class="s4">1</span><span class="s1">] == testdata[</span><span class="s3">&quot;period&quot;</span><span class="s1">].values</span>
        <span class="s1">).all()</span>
        <span class="s1">ax_categorical = testdata.plot(x=</span><span class="s3">&quot;numeric&quot;</span><span class="s2">, </span><span class="s1">y=</span><span class="s3">&quot;categorical&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">(</span>
            <span class="s1">ax_categorical.get_lines()[</span><span class="s4">0</span><span class="s1">].get_data()[</span><span class="s4">1</span><span class="s1">]</span>
            <span class="s1">== testdata[</span><span class="s3">&quot;categorical&quot;</span><span class="s1">].values</span>
        <span class="s1">).all()</span>
        <span class="s1">ax_datetime_mixed_tz = testdata.plot(x=</span><span class="s3">&quot;numeric&quot;</span><span class="s2">, </span><span class="s1">y=</span><span class="s3">&quot;datetime_mixed_tz&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">(</span>
            <span class="s1">ax_datetime_mixed_tz.get_lines()[</span><span class="s4">0</span><span class="s1">].get_data()[</span><span class="s4">1</span><span class="s1">]</span>
            <span class="s1">== testdata[</span><span class="s3">&quot;datetime_mixed_tz&quot;</span><span class="s1">].values</span>
        <span class="s1">).all()</span>

    <span class="s2">def </span><span class="s1">test_subplots_layout_multi_column(self):</span>
        <span class="s5"># GH 6667</span>
        <span class="s1">df = DataFrame(np.random.rand(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">index=list(string.ascii_letters[:</span><span class="s4">10</span><span class="s1">]))</span>

        <span class="s1">axes = df.plot(subplots=</span><span class="s2">True, </span><span class="s1">layout=(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">))</span>
        <span class="s1">self._check_axes_shape(axes</span><span class="s2">, </span><span class="s1">axes_num=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">layout=(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">))</span>
        <span class="s2">assert </span><span class="s1">axes.shape == (</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)</span>

        <span class="s1">axes = df.plot(subplots=</span><span class="s2">True, </span><span class="s1">layout=(-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">))</span>
        <span class="s1">self._check_axes_shape(axes</span><span class="s2">, </span><span class="s1">axes_num=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">layout=(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">))</span>
        <span class="s2">assert </span><span class="s1">axes.shape == (</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)</span>

        <span class="s1">axes = df.plot(subplots=</span><span class="s2">True, </span><span class="s1">layout=(</span><span class="s4">2</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">))</span>
        <span class="s1">self._check_axes_shape(axes</span><span class="s2">, </span><span class="s1">axes_num=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">layout=(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">))</span>
        <span class="s2">assert </span><span class="s1">axes.shape == (</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)</span>

        <span class="s1">axes = df.plot(subplots=</span><span class="s2">True, </span><span class="s1">layout=(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s1">))</span>
        <span class="s1">self._check_axes_shape(axes</span><span class="s2">, </span><span class="s1">axes_num=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">layout=(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s1">))</span>
        <span class="s2">assert </span><span class="s1">axes.shape == (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span>

        <span class="s1">axes = df.plot(subplots=</span><span class="s2">True, </span><span class="s1">layout=(-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s1">))</span>
        <span class="s1">self._check_axes_shape(axes</span><span class="s2">, </span><span class="s1">axes_num=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">layout=(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s1">))</span>
        <span class="s2">assert </span><span class="s1">axes.shape == (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span>

        <span class="s1">axes = df.plot(subplots=</span><span class="s2">True, </span><span class="s1">layout=(</span><span class="s4">4</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">))</span>
        <span class="s1">self._check_axes_shape(axes</span><span class="s2">, </span><span class="s1">axes_num=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">layout=(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">1</span><span class="s1">))</span>
        <span class="s2">assert </span><span class="s1">axes.shape == (</span><span class="s4">4</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span>

        <span class="s1">msg = </span><span class="s3">&quot;Layout of 1x1 must be larger than required size 3&quot;</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">df.plot(subplots=</span><span class="s2">True, </span><span class="s1">layout=(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">))</span>

        <span class="s1">msg = </span><span class="s3">&quot;At least one dimension of layout must be positive&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">df.plot(subplots=</span><span class="s2">True, </span><span class="s1">layout=(-</span><span class="s4">1</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">))</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;kwargs, expected_axes_num, expected_layout, expected_shape&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">({}</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">1</span><span class="s2">,</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">({</span><span class="s3">&quot;layout&quot;</span><span class="s1">: (</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)}</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s1">))</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_subplots_layout_single_column(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">kwargs</span><span class="s2">, </span><span class="s1">expected_axes_num</span><span class="s2">, </span><span class="s1">expected_layout</span><span class="s2">, </span><span class="s1">expected_shape</span>
    <span class="s1">):</span>

        <span class="s5"># GH 6667</span>
        <span class="s1">df = DataFrame(np.random.rand(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">index=list(string.ascii_letters[:</span><span class="s4">10</span><span class="s1">]))</span>
        <span class="s1">axes = df.plot(subplots=</span><span class="s2">True, </span><span class="s1">**kwargs)</span>
        <span class="s1">self._check_axes_shape(</span>
            <span class="s1">axes</span><span class="s2">,</span>
            <span class="s1">axes_num=expected_axes_num</span><span class="s2">,</span>
            <span class="s1">layout=expected_layout</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">axes.shape == expected_shape</span>

    <span class="s2">def </span><span class="s1">test_subplots_warnings(self):</span>
        <span class="s5"># GH 9464</span>
        <span class="s2">with </span><span class="s1">tm.assert_produces_warning(</span><span class="s2">None</span><span class="s1">):</span>
            <span class="s1">df = DataFrame(np.random.randn(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">4</span><span class="s1">))</span>
            <span class="s1">df.plot(subplots=</span><span class="s2">True, </span><span class="s1">layout=(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s1">))</span>

            <span class="s1">df = DataFrame(</span>
                <span class="s1">np.random.randn(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span><span class="s2">, </span><span class="s1">index=date_range(</span><span class="s3">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">100</span><span class="s1">)</span>
            <span class="s1">)</span>
            <span class="s1">df.plot(subplots=</span><span class="s2">True, </span><span class="s1">layout=(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s1">))</span>

    <span class="s2">def </span><span class="s1">test_subplots_multiple_axes(self):</span>
        <span class="s5"># GH 5353, 6970, GH 7069</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">axes = self.plt.subplots(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">df = DataFrame(np.random.rand(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">index=list(string.ascii_letters[:</span><span class="s4">10</span><span class="s1">]))</span>

        <span class="s1">returned = df.plot(subplots=</span><span class="s2">True, </span><span class="s1">ax=axes[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">sharex=</span><span class="s2">False, </span><span class="s1">sharey=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">self._check_axes_shape(returned</span><span class="s2">, </span><span class="s1">axes_num=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">layout=(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s1">))</span>
        <span class="s2">assert </span><span class="s1">returned.shape == (</span><span class="s4">3</span><span class="s2">,</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">returned[</span><span class="s4">0</span><span class="s1">].figure </span><span class="s2">is </span><span class="s1">fig</span>
        <span class="s5"># draw on second row</span>
        <span class="s1">returned = df.plot(subplots=</span><span class="s2">True, </span><span class="s1">ax=axes[</span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">sharex=</span><span class="s2">False, </span><span class="s1">sharey=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">self._check_axes_shape(returned</span><span class="s2">, </span><span class="s1">axes_num=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">layout=(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s1">))</span>
        <span class="s2">assert </span><span class="s1">returned.shape == (</span><span class="s4">3</span><span class="s2">,</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">returned[</span><span class="s4">0</span><span class="s1">].figure </span><span class="s2">is </span><span class="s1">fig</span>
        <span class="s1">self._check_axes_shape(axes</span><span class="s2">, </span><span class="s1">axes_num=</span><span class="s4">6</span><span class="s2">, </span><span class="s1">layout=(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">))</span>
        <span class="s1">tm.close()</span>

        <span class="s1">msg = </span><span class="s3">&quot;The number of passed axes must be 3, the same as the output plot&quot;</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">fig</span><span class="s2">, </span><span class="s1">axes = self.plt.subplots(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)</span>
            <span class="s5"># pass different number of axes from required</span>
            <span class="s1">df.plot(subplots=</span><span class="s2">True, </span><span class="s1">ax=axes)</span>

        <span class="s5"># pass 2-dim axes and invalid layout</span>
        <span class="s5"># invalid lauout should not affect to input and return value</span>
        <span class="s5"># (show warning is tested in</span>
        <span class="s5"># TestDataFrameGroupByPlots.test_grouped_box_multiple_axes</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">axes = self.plt.subplots(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s2">with </span><span class="s1">warnings.catch_warnings():</span>
            <span class="s1">warnings.simplefilter(</span><span class="s3">&quot;ignore&quot;</span><span class="s2">, </span><span class="s1">UserWarning)</span>
            <span class="s1">df = DataFrame(np.random.rand(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span><span class="s2">, </span><span class="s1">index=list(string.ascii_letters[:</span><span class="s4">10</span><span class="s1">]))</span>

            <span class="s1">returned = df.plot(</span>
                <span class="s1">subplots=</span><span class="s2">True, </span><span class="s1">ax=axes</span><span class="s2">, </span><span class="s1">layout=(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">sharex=</span><span class="s2">False, </span><span class="s1">sharey=</span><span class="s2">False</span>
            <span class="s1">)</span>
            <span class="s1">self._check_axes_shape(returned</span><span class="s2">, </span><span class="s1">axes_num=</span><span class="s4">4</span><span class="s2">, </span><span class="s1">layout=(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">))</span>
            <span class="s2">assert </span><span class="s1">returned.shape == (</span><span class="s4">4</span><span class="s2">,</span><span class="s1">)</span>

            <span class="s1">returned = df.plot(</span>
                <span class="s1">subplots=</span><span class="s2">True, </span><span class="s1">ax=axes</span><span class="s2">, </span><span class="s1">layout=(</span><span class="s4">2</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">sharex=</span><span class="s2">False, </span><span class="s1">sharey=</span><span class="s2">False</span>
            <span class="s1">)</span>
            <span class="s1">self._check_axes_shape(returned</span><span class="s2">, </span><span class="s1">axes_num=</span><span class="s4">4</span><span class="s2">, </span><span class="s1">layout=(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">))</span>
            <span class="s2">assert </span><span class="s1">returned.shape == (</span><span class="s4">4</span><span class="s2">,</span><span class="s1">)</span>

            <span class="s1">returned = df.plot(</span>
                <span class="s1">subplots=</span><span class="s2">True, </span><span class="s1">ax=axes</span><span class="s2">, </span><span class="s1">layout=(-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">sharex=</span><span class="s2">False, </span><span class="s1">sharey=</span><span class="s2">False</span>
            <span class="s1">)</span>
        <span class="s1">self._check_axes_shape(returned</span><span class="s2">, </span><span class="s1">axes_num=</span><span class="s4">4</span><span class="s2">, </span><span class="s1">layout=(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">))</span>
        <span class="s2">assert </span><span class="s1">returned.shape == (</span><span class="s4">4</span><span class="s2">,</span><span class="s1">)</span>

        <span class="s5"># single column</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">axes = self.plt.subplots(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">df = DataFrame(np.random.rand(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">index=list(string.ascii_letters[:</span><span class="s4">10</span><span class="s1">]))</span>

        <span class="s1">axes = df.plot(subplots=</span><span class="s2">True, </span><span class="s1">ax=[axes]</span><span class="s2">, </span><span class="s1">sharex=</span><span class="s2">False, </span><span class="s1">sharey=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">self._check_axes_shape(axes</span><span class="s2">, </span><span class="s1">axes_num=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">layout=(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">))</span>
        <span class="s2">assert </span><span class="s1">axes.shape == (</span><span class="s4">1</span><span class="s2">,</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_subplots_ts_share_axes(self):</span>
        <span class="s5"># GH 3964</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">axes = self.plt.subplots(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s1">sharex=</span><span class="s2">True, </span><span class="s1">sharey=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">self.plt.subplots_adjust(left=</span><span class="s4">0.05</span><span class="s2">, </span><span class="s1">right=</span><span class="s4">0.95</span><span class="s2">, </span><span class="s1">hspace=</span><span class="s4">0.3</span><span class="s2">, </span><span class="s1">wspace=</span><span class="s4">0.3</span><span class="s1">)</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">np.random.randn(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">9</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">index=date_range(start=</span><span class="s3">&quot;2014-07-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">10</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s2">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">enumerate(axes.ravel()):</span>
            <span class="s1">df[i].plot(ax=ax</span><span class="s2">, </span><span class="s1">fontsize=</span><span class="s4">5</span><span class="s1">)</span>

        <span class="s5"># Rows other than bottom should not be visible</span>
        <span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">axes[</span><span class="s4">0</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">].ravel():</span>
            <span class="s1">self._check_visible(ax.get_xticklabels()</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">False</span><span class="s1">)</span>

        <span class="s5"># Bottom row should be visible</span>
        <span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">axes[-</span><span class="s4">1</span><span class="s1">].ravel():</span>
            <span class="s1">self._check_visible(ax.get_xticklabels()</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">True</span><span class="s1">)</span>

        <span class="s5"># First column should be visible</span>
        <span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">axes[[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s1">]].ravel():</span>
            <span class="s1">self._check_visible(ax.get_yticklabels()</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">True</span><span class="s1">)</span>

        <span class="s5"># Other columns should not be visible</span>
        <span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">axes[[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">]].ravel():</span>
            <span class="s1">self._check_visible(ax.get_yticklabels()</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">axes[[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">2</span><span class="s1">]].ravel():</span>
            <span class="s1">self._check_visible(ax.get_yticklabels()</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">False</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_subplots_sharex_axes_existing_axes(self):</span>
        <span class="s5"># GH 9158</span>
        <span class="s1">d = {</span><span class="s3">&quot;A&quot;</span><span class="s1">: [</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">3.0</span><span class="s2">, </span><span class="s4">4.0</span><span class="s1">]</span><span class="s2">, </span><span class="s3">&quot;B&quot;</span><span class="s1">: [</span><span class="s4">4.0</span><span class="s2">, </span><span class="s4">3.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s1">]</span><span class="s2">, </span><span class="s3">&quot;C&quot;</span><span class="s1">: [</span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]}</span>
        <span class="s1">df = DataFrame(d</span><span class="s2">, </span><span class="s1">index=date_range(</span><span class="s3">&quot;2014 10 11&quot;</span><span class="s2">, </span><span class="s3">&quot;2014 10 14&quot;</span><span class="s1">))</span>

        <span class="s1">axes = df[[</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;B&quot;</span><span class="s1">]].plot(subplots=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">df[</span><span class="s3">&quot;C&quot;</span><span class="s1">].plot(ax=axes[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">secondary_y=</span><span class="s2">True</span><span class="s1">)</span>

        <span class="s1">self._check_visible(axes[</span><span class="s4">0</span><span class="s1">].get_xticklabels()</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">self._check_visible(axes[</span><span class="s4">1</span><span class="s1">].get_xticklabels()</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">axes.ravel():</span>
            <span class="s1">self._check_visible(ax.get_yticklabels()</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">True</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_subplots_dup_columns(self):</span>
        <span class="s5"># GH 10962</span>
        <span class="s1">df = DataFrame(np.random.rand(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">5</span><span class="s1">)</span><span class="s2">, </span><span class="s1">columns=list(</span><span class="s3">&quot;aaaaa&quot;</span><span class="s1">))</span>
        <span class="s1">axes = df.plot(subplots=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">axes:</span>
            <span class="s1">self._check_legend_labels(ax</span><span class="s2">, </span><span class="s1">labels=[</span><span class="s3">&quot;a&quot;</span><span class="s1">])</span>
            <span class="s2">assert </span><span class="s1">len(ax.lines) == </span><span class="s4">1</span>
        <span class="s1">tm.close()</span>

        <span class="s1">axes = df.plot(subplots=</span><span class="s2">True, </span><span class="s1">secondary_y=</span><span class="s3">&quot;a&quot;</span><span class="s1">)</span>
        <span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">axes:</span>
            <span class="s5"># (right) is only attached when subplots=False</span>
            <span class="s1">self._check_legend_labels(ax</span><span class="s2">, </span><span class="s1">labels=[</span><span class="s3">&quot;a&quot;</span><span class="s1">])</span>
            <span class="s2">assert </span><span class="s1">len(ax.lines) == </span><span class="s4">1</span>
        <span class="s1">tm.close()</span>

        <span class="s1">ax = df.plot(secondary_y=</span><span class="s3">&quot;a&quot;</span><span class="s1">)</span>
        <span class="s1">self._check_legend_labels(ax</span><span class="s2">, </span><span class="s1">labels=[</span><span class="s3">&quot;a (right)&quot;</span><span class="s1">] * </span><span class="s4">5</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">len(ax.lines) == </span><span class="s4">0</span>
        <span class="s2">assert </span><span class="s1">len(ax.right_ax.lines) == </span><span class="s4">5</span>

    <span class="s2">def </span><span class="s1">test_bar_log_no_subplots(self):</span>
        <span class="s5"># GH3254, GH3298 matplotlib/matplotlib#1882, #1892</span>
        <span class="s5"># regressions in 1.2.1</span>
        <span class="s1">expected = np.array([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">10.0</span><span class="s2">, </span><span class="s4">100</span><span class="s1">])</span>

        <span class="s5"># no subplots</span>
        <span class="s1">df = DataFrame({</span><span class="s3">&quot;A&quot;</span><span class="s1">: [</span><span class="s4">3</span><span class="s1">] * </span><span class="s4">5</span><span class="s2">, </span><span class="s3">&quot;B&quot;</span><span class="s1">: list(range(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">6</span><span class="s1">))}</span><span class="s2">, </span><span class="s1">index=range(</span><span class="s4">5</span><span class="s1">))</span>
        <span class="s1">ax = df.plot.bar(grid=</span><span class="s2">True, </span><span class="s1">log=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_numpy_array_equal(ax.yaxis.get_ticklocs()</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_bar_log_subplots(self):</span>
        <span class="s1">expected = np.array([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">10.0</span><span class="s2">, </span><span class="s4">100.0</span><span class="s2">, </span><span class="s4">1000.0</span><span class="s2">, </span><span class="s4">1e4</span><span class="s1">])</span>

        <span class="s1">ax = DataFrame([Series([</span><span class="s4">200</span><span class="s2">, </span><span class="s4">300</span><span class="s1">])</span><span class="s2">, </span><span class="s1">Series([</span><span class="s4">300</span><span class="s2">, </span><span class="s4">500</span><span class="s1">])]).plot.bar(</span>
            <span class="s1">log=</span><span class="s2">True, </span><span class="s1">subplots=</span><span class="s2">True</span>
        <span class="s1">)</span>

        <span class="s1">tm.assert_numpy_array_equal(ax[</span><span class="s4">0</span><span class="s1">].yaxis.get_ticklocs()</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">tm.assert_numpy_array_equal(ax[</span><span class="s4">1</span><span class="s1">].yaxis.get_ticklocs()</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_boxplot_subplots_return_type(self):</span>
        <span class="s1">df = self.hist_df</span>

        <span class="s5"># normal style: return_type=None</span>
        <span class="s1">result = df.plot.box(subplots=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">isinstance(result</span><span class="s2">, </span><span class="s1">Series)</span>
        <span class="s1">self._check_box_return_type(</span>
            <span class="s1">result</span><span class="s2">, None, </span><span class="s1">expected_keys=[</span><span class="s3">&quot;height&quot;</span><span class="s2">, </span><span class="s3">&quot;weight&quot;</span><span class="s2">, </span><span class="s3">&quot;category&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>

        <span class="s2">for </span><span class="s1">t </span><span class="s2">in </span><span class="s1">[</span><span class="s3">&quot;dict&quot;</span><span class="s2">, </span><span class="s3">&quot;axes&quot;</span><span class="s2">, </span><span class="s3">&quot;both&quot;</span><span class="s1">]:</span>
            <span class="s1">returned = df.plot.box(return_type=t</span><span class="s2">, </span><span class="s1">subplots=</span><span class="s2">True</span><span class="s1">)</span>
            <span class="s1">self._check_box_return_type(</span>
                <span class="s1">returned</span><span class="s2">,</span>
                <span class="s1">t</span><span class="s2">,</span>
                <span class="s1">expected_keys=[</span><span class="s3">&quot;height&quot;</span><span class="s2">, </span><span class="s3">&quot;weight&quot;</span><span class="s2">, </span><span class="s3">&quot;category&quot;</span><span class="s1">]</span><span class="s2">,</span>
                <span class="s1">check_ax_title=</span><span class="s2">False,</span>
            <span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_df_subplots_patterns_minorticks(self):</span>
        <span class="s5"># GH 10657</span>
        <span class="s2">import </span><span class="s1">matplotlib.pyplot </span><span class="s2">as </span><span class="s1">plt</span>

        <span class="s1">df = DataFrame(</span>
            <span class="s1">np.random.randn(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">index=date_range(</span><span class="s3">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">10</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">columns=list(</span><span class="s3">&quot;AB&quot;</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">)</span>

        <span class="s5"># shared subplots</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">axes = plt.subplots(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">sharex=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">axes = df.plot(subplots=</span><span class="s2">True, </span><span class="s1">ax=axes)</span>
        <span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">axes:</span>
            <span class="s2">assert </span><span class="s1">len(ax.lines) == </span><span class="s4">1</span>
            <span class="s1">self._check_visible(ax.get_yticklabels()</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s5"># xaxis of 1st ax must be hidden</span>
        <span class="s1">self._check_visible(axes[</span><span class="s4">0</span><span class="s1">].get_xticklabels()</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">self._check_visible(axes[</span><span class="s4">0</span><span class="s1">].get_xticklabels(minor=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">self._check_visible(axes[</span><span class="s4">1</span><span class="s1">].get_xticklabels()</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">self._check_visible(axes[</span><span class="s4">1</span><span class="s1">].get_xticklabels(minor=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">tm.close()</span>

        <span class="s1">fig</span><span class="s2">, </span><span class="s1">axes = plt.subplots(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s2">with </span><span class="s1">tm.assert_produces_warning(UserWarning):</span>
            <span class="s1">axes = df.plot(subplots=</span><span class="s2">True, </span><span class="s1">ax=axes</span><span class="s2">, </span><span class="s1">sharex=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">axes:</span>
            <span class="s2">assert </span><span class="s1">len(ax.lines) == </span><span class="s4">1</span>
            <span class="s1">self._check_visible(ax.get_yticklabels()</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s5"># xaxis of 1st ax must be hidden</span>
        <span class="s1">self._check_visible(axes[</span><span class="s4">0</span><span class="s1">].get_xticklabels()</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">self._check_visible(axes[</span><span class="s4">0</span><span class="s1">].get_xticklabels(minor=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">self._check_visible(axes[</span><span class="s4">1</span><span class="s1">].get_xticklabels()</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">self._check_visible(axes[</span><span class="s4">1</span><span class="s1">].get_xticklabels(minor=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">tm.close()</span>

        <span class="s5"># not shared</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">axes = plt.subplots(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">axes = df.plot(subplots=</span><span class="s2">True, </span><span class="s1">ax=axes)</span>
        <span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">axes:</span>
            <span class="s2">assert </span><span class="s1">len(ax.lines) == </span><span class="s4">1</span>
            <span class="s1">self._check_visible(ax.get_yticklabels()</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">True</span><span class="s1">)</span>
            <span class="s1">self._check_visible(ax.get_xticklabels()</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">True</span><span class="s1">)</span>
            <span class="s1">self._check_visible(ax.get_xticklabels(minor=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">visible=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">tm.close()</span>

    <span class="s2">def </span><span class="s1">test_subplots_sharex_false(self):</span>
        <span class="s5"># test when sharex is set to False, two plots should have different</span>
        <span class="s5"># labels, GH 25160</span>
        <span class="s1">df = DataFrame(np.random.rand(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">2</span><span class="s1">))</span>
        <span class="s1">df.iloc[</span><span class="s4">5</span><span class="s1">:</span><span class="s2">, </span><span class="s4">1</span><span class="s1">] = np.nan</span>
        <span class="s1">df.iloc[:</span><span class="s4">5</span><span class="s2">, </span><span class="s4">0</span><span class="s1">] = np.nan</span>

        <span class="s1">figs</span><span class="s2">, </span><span class="s1">axs = self.plt.subplots(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">df.plot.line(ax=axs</span><span class="s2">, </span><span class="s1">subplots=</span><span class="s2">True, </span><span class="s1">sharex=</span><span class="s2">False</span><span class="s1">)</span>

        <span class="s1">expected_ax1 = np.arange(</span><span class="s4">4.5</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">0.5</span><span class="s1">)</span>
        <span class="s1">expected_ax2 = np.arange(-</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s1">)</span>

        <span class="s1">tm.assert_numpy_array_equal(axs[</span><span class="s4">0</span><span class="s1">].get_xticks()</span><span class="s2">, </span><span class="s1">expected_ax1)</span>
        <span class="s1">tm.assert_numpy_array_equal(axs[</span><span class="s4">1</span><span class="s1">].get_xticks()</span><span class="s2">, </span><span class="s1">expected_ax2)</span>

    <span class="s2">def </span><span class="s1">test_subplots_constrained_layout(self):</span>
        <span class="s5"># GH 25261</span>
        <span class="s1">idx = date_range(start=</span><span class="s3">&quot;now&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">df = DataFrame(np.random.rand(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">index=idx)</span>
        <span class="s1">kwargs = {}</span>
        <span class="s2">if </span><span class="s1">hasattr(self.plt.Figure</span><span class="s2">, </span><span class="s3">&quot;get_constrained_layout&quot;</span><span class="s1">):</span>
            <span class="s1">kwargs[</span><span class="s3">&quot;constrained_layout&quot;</span><span class="s1">] = </span><span class="s2">True</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">axes = self.plt.subplots(</span><span class="s4">2</span><span class="s2">, </span><span class="s1">**kwargs)</span>
        <span class="s2">with </span><span class="s1">tm.assert_produces_warning(</span><span class="s2">None</span><span class="s1">):</span>
            <span class="s1">df.plot(ax=axes[</span><span class="s4">0</span><span class="s1">])</span>
            <span class="s2">with </span><span class="s1">tm.ensure_clean(return_filelike=</span><span class="s2">True</span><span class="s1">) </span><span class="s2">as </span><span class="s1">path:</span>
                <span class="s1">self.plt.savefig(path)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;index_name, old_label, new_label&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">(</span><span class="s2">None, </span><span class="s3">&quot;&quot;</span><span class="s2">, </span><span class="s3">&quot;new&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">&quot;old&quot;</span><span class="s2">, </span><span class="s3">&quot;old&quot;</span><span class="s2">, </span><span class="s3">&quot;new&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s2">None, </span><span class="s3">&quot;&quot;</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s2">None, </span><span class="s3">&quot;&quot;</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s2">None, </span><span class="s3">&quot;&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">])</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;kind&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;line&quot;</span><span class="s2">, </span><span class="s3">&quot;area&quot;</span><span class="s2">, </span><span class="s3">&quot;bar&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_xlabel_ylabel_dataframe_subplots(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">, </span><span class="s1">index_name</span><span class="s2">, </span><span class="s1">old_label</span><span class="s2">, </span><span class="s1">new_label</span>
    <span class="s1">):</span>
        <span class="s5"># GH 9093</span>
        <span class="s1">df = DataFrame([[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">columns=[</span><span class="s3">&quot;Type A&quot;</span><span class="s2">, </span><span class="s3">&quot;Type B&quot;</span><span class="s1">])</span>
        <span class="s1">df.index.name = index_name</span>

        <span class="s5"># default is the ylabel is not shown and xlabel is index name</span>
        <span class="s1">axes = df.plot(kind=kind</span><span class="s2">, </span><span class="s1">subplots=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">all(ax.get_ylabel() == </span><span class="s3">&quot;&quot; </span><span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">axes)</span>
        <span class="s2">assert </span><span class="s1">all(ax.get_xlabel() == old_label </span><span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">axes)</span>

        <span class="s5"># old xlabel will be overridden and assigned ylabel will be used as ylabel</span>
        <span class="s1">axes = df.plot(kind=kind</span><span class="s2">, </span><span class="s1">ylabel=new_label</span><span class="s2">, </span><span class="s1">xlabel=new_label</span><span class="s2">, </span><span class="s1">subplots=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">all(ax.get_ylabel() == str(new_label) </span><span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">axes)</span>
        <span class="s2">assert </span><span class="s1">all(ax.get_xlabel() == str(new_label) </span><span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">axes)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;kwargs&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s5"># stacked center</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">True</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">True, </span><span class="s3">&quot;width&quot;</span><span class="s1">: </span><span class="s4">0.9</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">True</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">True, </span><span class="s3">&quot;width&quot;</span><span class="s1">: </span><span class="s4">0.9</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s5"># center</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">False</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">False, </span><span class="s3">&quot;width&quot;</span><span class="s1">: </span><span class="s4">0.9</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">False</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">False, </span><span class="s3">&quot;width&quot;</span><span class="s1">: </span><span class="s4">0.9</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s5"># subplots center</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;subplots&quot;</span><span class="s1">: </span><span class="s2">True</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;subplots&quot;</span><span class="s1">: </span><span class="s2">True, </span><span class="s3">&quot;width&quot;</span><span class="s1">: </span><span class="s4">0.9</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s3">&quot;subplots&quot;</span><span class="s1">: </span><span class="s2">True</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s3">&quot;subplots&quot;</span><span class="s1">: </span><span class="s2">True, </span><span class="s3">&quot;width&quot;</span><span class="s1">: </span><span class="s4">0.9</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s5"># align edge</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">True, </span><span class="s3">&quot;align&quot;</span><span class="s1">: </span><span class="s3">&quot;edge&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">True, </span><span class="s3">&quot;width&quot;</span><span class="s1">: </span><span class="s4">0.9</span><span class="s2">, </span><span class="s3">&quot;align&quot;</span><span class="s1">: </span><span class="s3">&quot;edge&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">True, </span><span class="s3">&quot;align&quot;</span><span class="s1">: </span><span class="s3">&quot;edge&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">True, </span><span class="s3">&quot;width&quot;</span><span class="s1">: </span><span class="s4">0.9</span><span class="s2">, </span><span class="s3">&quot;align&quot;</span><span class="s1">: </span><span class="s3">&quot;edge&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">False, </span><span class="s3">&quot;align&quot;</span><span class="s1">: </span><span class="s3">&quot;edge&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">False, </span><span class="s3">&quot;width&quot;</span><span class="s1">: </span><span class="s4">0.9</span><span class="s2">, </span><span class="s3">&quot;align&quot;</span><span class="s1">: </span><span class="s3">&quot;edge&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">False, </span><span class="s3">&quot;align&quot;</span><span class="s1">: </span><span class="s3">&quot;edge&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">False, </span><span class="s3">&quot;width&quot;</span><span class="s1">: </span><span class="s4">0.9</span><span class="s2">, </span><span class="s3">&quot;align&quot;</span><span class="s1">: </span><span class="s3">&quot;edge&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;subplots&quot;</span><span class="s1">: </span><span class="s2">True, </span><span class="s3">&quot;align&quot;</span><span class="s1">: </span><span class="s3">&quot;edge&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;subplots&quot;</span><span class="s1">: </span><span class="s2">True, </span><span class="s3">&quot;width&quot;</span><span class="s1">: </span><span class="s4">0.9</span><span class="s2">, </span><span class="s3">&quot;align&quot;</span><span class="s1">: </span><span class="s3">&quot;edge&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s3">&quot;subplots&quot;</span><span class="s1">: </span><span class="s2">True, </span><span class="s3">&quot;align&quot;</span><span class="s1">: </span><span class="s3">&quot;edge&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s3">&quot;subplots&quot;</span><span class="s1">: </span><span class="s2">True, </span><span class="s3">&quot;width&quot;</span><span class="s1">: </span><span class="s4">0.9</span><span class="s2">, </span><span class="s3">&quot;align&quot;</span><span class="s1">: </span><span class="s3">&quot;edge&quot;</span><span class="s1">}</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_bar_align_multiple_columns(self</span><span class="s2">, </span><span class="s1">kwargs):</span>
        <span class="s5"># GH2157</span>
        <span class="s1">df = DataFrame({</span><span class="s3">&quot;A&quot;</span><span class="s1">: [</span><span class="s4">3</span><span class="s1">] * </span><span class="s4">5</span><span class="s2">, </span><span class="s3">&quot;B&quot;</span><span class="s1">: list(range(</span><span class="s4">5</span><span class="s1">))}</span><span class="s2">, </span><span class="s1">index=range(</span><span class="s4">5</span><span class="s1">))</span>
        <span class="s1">self._check_bar_alignment(df</span><span class="s2">, </span><span class="s1">**kwargs)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;kwargs&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">False</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">True</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">False</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">True</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;subplots&quot;</span><span class="s1">: </span><span class="s2">True</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s3">&quot;subplots&quot;</span><span class="s1">: </span><span class="s2">True</span><span class="s1">}</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_bar_align_single_column(self</span><span class="s2">, </span><span class="s1">kwargs):</span>
        <span class="s1">df = DataFrame(np.random.randn(</span><span class="s4">5</span><span class="s1">))</span>
        <span class="s1">self._check_bar_alignment(df</span><span class="s2">, </span><span class="s1">**kwargs)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;kwargs&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">False</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">True</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">False</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s3">&quot;stacked&quot;</span><span class="s1">: </span><span class="s2">True</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;subplots&quot;</span><span class="s1">: </span><span class="s2">True</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;kind&quot;</span><span class="s1">: </span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s3">&quot;subplots&quot;</span><span class="s1">: </span><span class="s2">True</span><span class="s1">}</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_bar_barwidth_position(self</span><span class="s2">, </span><span class="s1">kwargs):</span>
        <span class="s1">df = DataFrame(np.random.randn(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">5</span><span class="s1">))</span>
        <span class="s1">self._check_bar_alignment(df</span><span class="s2">, </span><span class="s1">width=</span><span class="s4">0.9</span><span class="s2">, </span><span class="s1">position=</span><span class="s4">0.2</span><span class="s2">, </span><span class="s1">**kwargs)</span>

    <span class="s2">def </span><span class="s1">test_bar_barwidth_position_int(self):</span>
        <span class="s5"># GH 12979</span>
        <span class="s1">df = DataFrame(np.random.randn(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">5</span><span class="s1">))</span>

        <span class="s2">for </span><span class="s1">w </span><span class="s2">in </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1.0</span><span class="s1">]:</span>
            <span class="s1">ax = df.plot.bar(stacked=</span><span class="s2">True, </span><span class="s1">width=w)</span>
            <span class="s1">ticks = ax.xaxis.get_ticklocs()</span>
            <span class="s1">tm.assert_numpy_array_equal(ticks</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]))</span>
            <span class="s2">assert </span><span class="s1">ax.get_xlim() == (-</span><span class="s4">0.75</span><span class="s2">, </span><span class="s4">4.75</span><span class="s1">)</span>
            <span class="s5"># check left-edge of bars</span>
            <span class="s2">assert </span><span class="s1">ax.patches[</span><span class="s4">0</span><span class="s1">].get_x() == -</span><span class="s4">0.5</span>
            <span class="s2">assert </span><span class="s1">ax.patches[-</span><span class="s4">1</span><span class="s1">].get_x() == </span><span class="s4">3.5</span>

        <span class="s1">self._check_bar_alignment(df</span><span class="s2">, </span><span class="s1">kind=</span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s1">stacked=</span><span class="s2">True, </span><span class="s1">width=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">self._check_bar_alignment(df</span><span class="s2">, </span><span class="s1">kind=</span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s1">stacked=</span><span class="s2">False, </span><span class="s1">width=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">self._check_bar_alignment(df</span><span class="s2">, </span><span class="s1">kind=</span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s1">stacked=</span><span class="s2">True, </span><span class="s1">width=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">self._check_bar_alignment(df</span><span class="s2">, </span><span class="s1">kind=</span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s1">subplots=</span><span class="s2">True, </span><span class="s1">width=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">self._check_bar_alignment(df</span><span class="s2">, </span><span class="s1">kind=</span><span class="s3">&quot;barh&quot;</span><span class="s2">, </span><span class="s1">subplots=</span><span class="s2">True, </span><span class="s1">width=</span><span class="s4">1</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">_check_bar_alignment(</span>
        <span class="s1">self</span><span class="s2">,</span>
        <span class="s1">df</span><span class="s2">,</span>
        <span class="s1">kind=</span><span class="s3">&quot;bar&quot;</span><span class="s2">,</span>
        <span class="s1">stacked=</span><span class="s2">False,</span>
        <span class="s1">subplots=</span><span class="s2">False,</span>
        <span class="s1">align=</span><span class="s3">&quot;center&quot;</span><span class="s2">,</span>
        <span class="s1">width=</span><span class="s4">0.5</span><span class="s2">,</span>
        <span class="s1">position=</span><span class="s4">0.5</span><span class="s2">,</span>
    <span class="s1">):</span>

        <span class="s1">axes = df.plot(</span>
            <span class="s1">kind=kind</span><span class="s2">,</span>
            <span class="s1">stacked=stacked</span><span class="s2">,</span>
            <span class="s1">subplots=subplots</span><span class="s2">,</span>
            <span class="s1">align=align</span><span class="s2">,</span>
            <span class="s1">width=width</span><span class="s2">,</span>
            <span class="s1">position=position</span><span class="s2">,</span>
            <span class="s1">grid=</span><span class="s2">True,</span>
        <span class="s1">)</span>

        <span class="s1">axes = self._flatten_visible(axes)</span>

        <span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">axes:</span>
            <span class="s2">if </span><span class="s1">kind == </span><span class="s3">&quot;bar&quot;</span><span class="s1">:</span>
                <span class="s1">axis = ax.xaxis</span>
                <span class="s1">ax_min</span><span class="s2">, </span><span class="s1">ax_max = ax.get_xlim()</span>
                <span class="s1">min_edge = min(p.get_x() </span><span class="s2">for </span><span class="s1">p </span><span class="s2">in </span><span class="s1">ax.patches)</span>
                <span class="s1">max_edge = max(p.get_x() + p.get_width() </span><span class="s2">for </span><span class="s1">p </span><span class="s2">in </span><span class="s1">ax.patches)</span>
            <span class="s2">elif </span><span class="s1">kind == </span><span class="s3">&quot;barh&quot;</span><span class="s1">:</span>
                <span class="s1">axis = ax.yaxis</span>
                <span class="s1">ax_min</span><span class="s2">, </span><span class="s1">ax_max = ax.get_ylim()</span>
                <span class="s1">min_edge = min(p.get_y() </span><span class="s2">for </span><span class="s1">p </span><span class="s2">in </span><span class="s1">ax.patches)</span>
                <span class="s1">max_edge = max(p.get_y() + p.get_height() </span><span class="s2">for </span><span class="s1">p </span><span class="s2">in </span><span class="s1">ax.patches)</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s2">raise </span><span class="s1">ValueError</span>

            <span class="s5"># GH 7498</span>
            <span class="s5"># compare margins between lim and bar edges</span>
            <span class="s1">tm.assert_almost_equal(ax_min</span><span class="s2">, </span><span class="s1">min_edge - </span><span class="s4">0.25</span><span class="s1">)</span>
            <span class="s1">tm.assert_almost_equal(ax_max</span><span class="s2">, </span><span class="s1">max_edge + </span><span class="s4">0.25</span><span class="s1">)</span>

            <span class="s1">p = ax.patches[</span><span class="s4">0</span><span class="s1">]</span>
            <span class="s2">if </span><span class="s1">kind == </span><span class="s3">&quot;bar&quot; </span><span class="s2">and </span><span class="s1">(stacked </span><span class="s2">is True or </span><span class="s1">subplots </span><span class="s2">is True</span><span class="s1">):</span>
                <span class="s1">edge = p.get_x()</span>
                <span class="s1">center = edge + p.get_width() * position</span>
            <span class="s2">elif </span><span class="s1">kind == </span><span class="s3">&quot;bar&quot; </span><span class="s2">and </span><span class="s1">stacked </span><span class="s2">is False</span><span class="s1">:</span>
                <span class="s1">center = p.get_x() + p.get_width() * len(df.columns) * position</span>
                <span class="s1">edge = p.get_x()</span>
            <span class="s2">elif </span><span class="s1">kind == </span><span class="s3">&quot;barh&quot; </span><span class="s2">and </span><span class="s1">(stacked </span><span class="s2">is True or </span><span class="s1">subplots </span><span class="s2">is True</span><span class="s1">):</span>
                <span class="s1">center = p.get_y() + p.get_height() * position</span>
                <span class="s1">edge = p.get_y()</span>
            <span class="s2">elif </span><span class="s1">kind == </span><span class="s3">&quot;barh&quot; </span><span class="s2">and </span><span class="s1">stacked </span><span class="s2">is False</span><span class="s1">:</span>
                <span class="s1">center = p.get_y() + p.get_height() * len(df.columns) * position</span>
                <span class="s1">edge = p.get_y()</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s2">raise </span><span class="s1">ValueError</span>

            <span class="s5"># Check the ticks locates on integer</span>
            <span class="s2">assert </span><span class="s1">(axis.get_ticklocs() == np.arange(len(df))).all()</span>

            <span class="s2">if </span><span class="s1">align == </span><span class="s3">&quot;center&quot;</span><span class="s1">:</span>
                <span class="s5"># Check whether the bar locates on center</span>
                <span class="s1">tm.assert_almost_equal(axis.get_ticklocs()[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">center)</span>
            <span class="s2">elif </span><span class="s1">align == </span><span class="s3">&quot;edge&quot;</span><span class="s1">:</span>
                <span class="s5"># Check whether the bar's edge starts from the tick</span>
                <span class="s1">tm.assert_almost_equal(axis.get_ticklocs()[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">edge)</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s2">raise </span><span class="s1">ValueError</span>

        <span class="s2">return </span><span class="s1">axes</span>
</pre>
</body>
</html>