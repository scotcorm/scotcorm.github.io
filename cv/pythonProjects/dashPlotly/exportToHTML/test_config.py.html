<html>
<head>
<title>test_config.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #808080;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_config.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">warnings</span>

<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas._config </span><span class="s0">import </span><span class="s1">config </span><span class="s0">as </span><span class="s1">cf</span>
<span class="s0">from </span><span class="s1">pandas._config.config </span><span class="s0">import </span><span class="s1">OptionError</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>


<span class="s0">class </span><span class="s1">TestConfig:</span>
    <span class="s1">@classmethod</span>
    <span class="s0">def </span><span class="s1">setup_class(cls):</span>
        <span class="s0">from </span><span class="s1">copy </span><span class="s0">import </span><span class="s1">deepcopy</span>

        <span class="s1">cls.cf = cf</span>
        <span class="s1">cls.gc = deepcopy(getattr(cls.cf</span><span class="s0">, </span><span class="s2">&quot;_global_config&quot;</span><span class="s1">))</span>
        <span class="s1">cls.do = deepcopy(getattr(cls.cf</span><span class="s0">, </span><span class="s2">&quot;_deprecated_options&quot;</span><span class="s1">))</span>
        <span class="s1">cls.ro = deepcopy(getattr(cls.cf</span><span class="s0">, </span><span class="s2">&quot;_registered_options&quot;</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">setup_method(self</span><span class="s0">, </span><span class="s1">method):</span>
        <span class="s1">setattr(self.cf</span><span class="s0">, </span><span class="s2">&quot;_global_config&quot;</span><span class="s0">, </span><span class="s1">{})</span>
        <span class="s1">setattr(self.cf</span><span class="s0">, </span><span class="s2">&quot;options&quot;</span><span class="s0">, </span><span class="s1">self.cf.DictWrapper(self.cf._global_config))</span>
        <span class="s1">setattr(self.cf</span><span class="s0">, </span><span class="s2">&quot;_deprecated_options&quot;</span><span class="s0">, </span><span class="s1">{})</span>
        <span class="s1">setattr(self.cf</span><span class="s0">, </span><span class="s2">&quot;_registered_options&quot;</span><span class="s0">, </span><span class="s1">{})</span>

        <span class="s3"># Our test fixture in conftest.py sets &quot;chained_assignment&quot;</span>
        <span class="s3"># to &quot;raise&quot; only after all test methods have been setup.</span>
        <span class="s3"># However, after this setup, there is no longer any</span>
        <span class="s3"># &quot;chained_assignment&quot; option, so re-register it.</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;chained_assignment&quot;</span><span class="s0">, </span><span class="s2">&quot;raise&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">teardown_method(self</span><span class="s0">, </span><span class="s1">method):</span>
        <span class="s1">setattr(self.cf</span><span class="s0">, </span><span class="s2">&quot;_global_config&quot;</span><span class="s0">, </span><span class="s1">self.gc)</span>
        <span class="s1">setattr(self.cf</span><span class="s0">, </span><span class="s2">&quot;_deprecated_options&quot;</span><span class="s0">, </span><span class="s1">self.do)</span>
        <span class="s1">setattr(self.cf</span><span class="s0">, </span><span class="s2">&quot;_registered_options&quot;</span><span class="s0">, </span><span class="s1">self.ro)</span>

    <span class="s0">def </span><span class="s1">test_api(self):</span>

        <span class="s3"># the pandas object exposes the user API</span>
        <span class="s0">assert </span><span class="s1">hasattr(pd</span><span class="s0">, </span><span class="s2">&quot;get_option&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">hasattr(pd</span><span class="s0">, </span><span class="s2">&quot;set_option&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">hasattr(pd</span><span class="s0">, </span><span class="s2">&quot;reset_option&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">hasattr(pd</span><span class="s0">, </span><span class="s2">&quot;describe_option&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_is_one_of_factory(self):</span>
        <span class="s1">v = self.cf.is_one_of_factory([</span><span class="s0">None, </span><span class="s4">12</span><span class="s1">])</span>

        <span class="s1">v(</span><span class="s4">12</span><span class="s1">)</span>
        <span class="s1">v(</span><span class="s0">None</span><span class="s1">)</span>
        <span class="s1">msg = </span><span class="s2">r&quot;Value must be one of None\|12&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">v(</span><span class="s4">1.1</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_register_option(self):</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s2">&quot;doc&quot;</span><span class="s1">)</span>

        <span class="s3"># can't register an already registered option</span>
        <span class="s1">msg = </span><span class="s2">&quot;Option 'a' has already been registered&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(OptionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">self.cf.register_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s2">&quot;doc&quot;</span><span class="s1">)</span>

        <span class="s3"># can't register an already registered option</span>
        <span class="s1">msg = </span><span class="s2">&quot;Path prefix to option 'a' is already an option&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(OptionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">self.cf.register_option(</span><span class="s2">&quot;a.b.c.d1&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s2">&quot;doc&quot;</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(OptionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">self.cf.register_option(</span><span class="s2">&quot;a.b.c.d2&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s2">&quot;doc&quot;</span><span class="s1">)</span>

        <span class="s3"># no python keywords</span>
        <span class="s1">msg = </span><span class="s2">&quot;for is a python keyword&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">self.cf.register_option(</span><span class="s2">&quot;for&quot;</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">self.cf.register_option(</span><span class="s2">&quot;a.for.b&quot;</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s3"># must be valid identifier (ensure attribute access works)</span>
        <span class="s1">msg = </span><span class="s2">&quot;oh my goddess! is not a valid identifier&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">self.cf.register_option(</span><span class="s2">&quot;Oh my Goddess!&quot;</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span>

        <span class="s3"># we can register options several levels deep</span>
        <span class="s3"># without predefining the intermediate steps</span>
        <span class="s3"># and we can define differently named options</span>
        <span class="s3"># in the same namespace</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;k.b.c.d1&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s2">&quot;doc&quot;</span><span class="s1">)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;k.b.c.d2&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s2">&quot;doc&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_describe_option(self):</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s2">&quot;doc&quot;</span><span class="s1">)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s2">&quot;doc2&quot;</span><span class="s1">)</span>
        <span class="s1">self.cf.deprecate_option(</span><span class="s2">&quot;b&quot;</span><span class="s1">)</span>

        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;c.d.e1&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s2">&quot;doc3&quot;</span><span class="s1">)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;c.d.e2&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s2">&quot;doc4&quot;</span><span class="s1">)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;f&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;g.h&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;k&quot;</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">self.cf.deprecate_option(</span><span class="s2">&quot;g.h&quot;</span><span class="s0">, </span><span class="s1">rkey=</span><span class="s2">&quot;k&quot;</span><span class="s1">)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;l&quot;</span><span class="s0">, </span><span class="s2">&quot;foo&quot;</span><span class="s1">)</span>

        <span class="s3"># non-existent keys raise KeyError</span>
        <span class="s1">msg = </span><span class="s2">r&quot;No such keys\(s\)&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(OptionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">self.cf.describe_option(</span><span class="s2">&quot;no.such.key&quot;</span><span class="s1">)</span>

        <span class="s3"># we can get the description for any key we registered</span>
        <span class="s0">assert </span><span class="s2">&quot;doc&quot; </span><span class="s0">in </span><span class="s1">self.cf.describe_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s1">_print_desc=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s2">&quot;doc2&quot; </span><span class="s0">in </span><span class="s1">self.cf.describe_option(</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s1">_print_desc=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s2">&quot;precated&quot; </span><span class="s0">in </span><span class="s1">self.cf.describe_option(</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s1">_print_desc=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s2">&quot;doc3&quot; </span><span class="s0">in </span><span class="s1">self.cf.describe_option(</span><span class="s2">&quot;c.d.e1&quot;</span><span class="s0">, </span><span class="s1">_print_desc=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s2">&quot;doc4&quot; </span><span class="s0">in </span><span class="s1">self.cf.describe_option(</span><span class="s2">&quot;c.d.e2&quot;</span><span class="s0">, </span><span class="s1">_print_desc=</span><span class="s0">False</span><span class="s1">)</span>

        <span class="s3"># if no doc is specified we get a default message</span>
        <span class="s3"># saying &quot;description not available&quot;</span>
        <span class="s0">assert </span><span class="s2">&quot;available&quot; </span><span class="s0">in </span><span class="s1">self.cf.describe_option(</span><span class="s2">&quot;f&quot;</span><span class="s0">, </span><span class="s1">_print_desc=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s2">&quot;available&quot; </span><span class="s0">in </span><span class="s1">self.cf.describe_option(</span><span class="s2">&quot;g.h&quot;</span><span class="s0">, </span><span class="s1">_print_desc=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s2">&quot;precated&quot; </span><span class="s0">in </span><span class="s1">self.cf.describe_option(</span><span class="s2">&quot;g.h&quot;</span><span class="s0">, </span><span class="s1">_print_desc=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s2">&quot;k&quot; </span><span class="s0">in </span><span class="s1">self.cf.describe_option(</span><span class="s2">&quot;g.h&quot;</span><span class="s0">, </span><span class="s1">_print_desc=</span><span class="s0">False</span><span class="s1">)</span>

        <span class="s3"># default is reported</span>
        <span class="s0">assert </span><span class="s2">&quot;foo&quot; </span><span class="s0">in </span><span class="s1">self.cf.describe_option(</span><span class="s2">&quot;l&quot;</span><span class="s0">, </span><span class="s1">_print_desc=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s3"># current value is reported</span>
        <span class="s0">assert </span><span class="s2">&quot;bar&quot; </span><span class="s0">not in </span><span class="s1">self.cf.describe_option(</span><span class="s2">&quot;l&quot;</span><span class="s0">, </span><span class="s1">_print_desc=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">self.cf.set_option(</span><span class="s2">&quot;l&quot;</span><span class="s0">, </span><span class="s2">&quot;bar&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s2">&quot;bar&quot; </span><span class="s0">in </span><span class="s1">self.cf.describe_option(</span><span class="s2">&quot;l&quot;</span><span class="s0">, </span><span class="s1">_print_desc=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_case_insensitive(self):</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;KanBAN&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s2">&quot;doc&quot;</span><span class="s1">)</span>

        <span class="s0">assert </span><span class="s2">&quot;doc&quot; </span><span class="s0">in </span><span class="s1">self.cf.describe_option(</span><span class="s2">&quot;kanbaN&quot;</span><span class="s0">, </span><span class="s1">_print_desc=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;kanBaN&quot;</span><span class="s1">) == </span><span class="s4">1</span>
        <span class="s1">self.cf.set_option(</span><span class="s2">&quot;KanBan&quot;</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;kAnBaN&quot;</span><span class="s1">) == </span><span class="s4">2</span>

        <span class="s3"># gets of non-existent keys fail</span>
        <span class="s1">msg = </span><span class="s2">r&quot;No such keys\(s\): 'no_such_option'&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(OptionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">self.cf.get_option(</span><span class="s2">&quot;no_such_option&quot;</span><span class="s1">)</span>
        <span class="s1">self.cf.deprecate_option(</span><span class="s2">&quot;KanBan&quot;</span><span class="s1">)</span>

        <span class="s0">assert </span><span class="s1">self.cf._is_deprecated(</span><span class="s2">&quot;kAnBaN&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_get_option(self):</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s2">&quot;doc&quot;</span><span class="s1">)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s0">, </span><span class="s2">&quot;hullo&quot;</span><span class="s0">, </span><span class="s2">&quot;doc2&quot;</span><span class="s1">)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;b.b&quot;</span><span class="s0">, None, </span><span class="s2">&quot;doc2&quot;</span><span class="s1">)</span>

        <span class="s3"># gets of existing keys succeed</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;a&quot;</span><span class="s1">) == </span><span class="s4">1</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s1">) == </span><span class="s2">&quot;hullo&quot;</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;b.b&quot;</span><span class="s1">) </span><span class="s0">is None</span>

        <span class="s3"># gets of non-existent keys fail</span>
        <span class="s1">msg = </span><span class="s2">r&quot;No such keys\(s\): 'no_such_option'&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(OptionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">self.cf.get_option(</span><span class="s2">&quot;no_such_option&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_set_option(self):</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s2">&quot;doc&quot;</span><span class="s1">)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s0">, </span><span class="s2">&quot;hullo&quot;</span><span class="s0">, </span><span class="s2">&quot;doc2&quot;</span><span class="s1">)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;b.b&quot;</span><span class="s0">, None, </span><span class="s2">&quot;doc2&quot;</span><span class="s1">)</span>

        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;a&quot;</span><span class="s1">) == </span><span class="s4">1</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s1">) == </span><span class="s2">&quot;hullo&quot;</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;b.b&quot;</span><span class="s1">) </span><span class="s0">is None</span>

        <span class="s1">self.cf.set_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">self.cf.set_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s0">, </span><span class="s2">&quot;wurld&quot;</span><span class="s1">)</span>
        <span class="s1">self.cf.set_option(</span><span class="s2">&quot;b.b&quot;</span><span class="s0">, </span><span class="s4">1.1</span><span class="s1">)</span>

        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;a&quot;</span><span class="s1">) == </span><span class="s4">2</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s1">) == </span><span class="s2">&quot;wurld&quot;</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;b.b&quot;</span><span class="s1">) == </span><span class="s4">1.1</span>

        <span class="s1">msg = </span><span class="s2">r&quot;No such keys\(s\): 'no.such.key'&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(OptionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">self.cf.set_option(</span><span class="s2">&quot;no.such.key&quot;</span><span class="s0">, None</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_set_option_empty_args(self):</span>
        <span class="s1">msg = </span><span class="s2">&quot;Must provide an even number of non-keyword arguments&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">self.cf.set_option()</span>

    <span class="s0">def </span><span class="s1">test_set_option_uneven_args(self):</span>
        <span class="s1">msg = </span><span class="s2">&quot;Must provide an even number of non-keyword arguments&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">self.cf.set_option(</span><span class="s2">&quot;a.b&quot;</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s2">&quot;b.c&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_set_option_invalid_single_argument_type(self):</span>
        <span class="s1">msg = </span><span class="s2">&quot;Must provide an even number of non-keyword arguments&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">self.cf.set_option(</span><span class="s4">2</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_set_option_multiple(self):</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s2">&quot;doc&quot;</span><span class="s1">)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s0">, </span><span class="s2">&quot;hullo&quot;</span><span class="s0">, </span><span class="s2">&quot;doc2&quot;</span><span class="s1">)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;b.b&quot;</span><span class="s0">, None, </span><span class="s2">&quot;doc2&quot;</span><span class="s1">)</span>

        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;a&quot;</span><span class="s1">) == </span><span class="s4">1</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s1">) == </span><span class="s2">&quot;hullo&quot;</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;b.b&quot;</span><span class="s1">) </span><span class="s0">is None</span>

        <span class="s1">self.cf.set_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;2&quot;</span><span class="s0">, </span><span class="s2">&quot;b.c&quot;</span><span class="s0">, None, </span><span class="s2">&quot;b.b&quot;</span><span class="s0">, </span><span class="s4">10.0</span><span class="s1">)</span>

        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;a&quot;</span><span class="s1">) == </span><span class="s2">&quot;2&quot;</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s1">) </span><span class="s0">is None</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;b.b&quot;</span><span class="s1">) == </span><span class="s4">10.0</span>

    <span class="s0">def </span><span class="s1">test_validation(self):</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s2">&quot;doc&quot;</span><span class="s0">, </span><span class="s1">validator=self.cf.is_int)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s2">&quot;doc&quot;</span><span class="s0">, </span><span class="s1">validator=self.cf.is_nonnegative_int)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s0">, </span><span class="s2">&quot;hullo&quot;</span><span class="s0">, </span><span class="s2">&quot;doc2&quot;</span><span class="s0">, </span><span class="s1">validator=self.cf.is_text)</span>

        <span class="s1">msg = </span><span class="s2">&quot;Value must have type '&lt;class 'int'&gt;'&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">self.cf.register_option(</span><span class="s2">&quot;a.b.c.d2&quot;</span><span class="s0">, </span><span class="s2">&quot;NO&quot;</span><span class="s0">, </span><span class="s2">&quot;doc&quot;</span><span class="s0">, </span><span class="s1">validator=self.cf.is_int)</span>

        <span class="s1">self.cf.set_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)  </span><span class="s3"># int is_int</span>
        <span class="s1">self.cf.set_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s0">, </span><span class="s2">&quot;wurld&quot;</span><span class="s1">)  </span><span class="s3"># str is_str</span>
        <span class="s1">self.cf.set_option(</span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">self.cf.set_option(</span><span class="s2">&quot;d&quot;</span><span class="s0">, None</span><span class="s1">)  </span><span class="s3"># non-negative int can be None</span>

        <span class="s3"># None not is_int</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">self.cf.set_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, None</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">self.cf.set_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;ab&quot;</span><span class="s1">)</span>

        <span class="s1">msg = </span><span class="s2">&quot;Value must be a nonnegative integer or None&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">self.cf.register_option(</span>
                <span class="s2">&quot;a.b.c.d3&quot;</span><span class="s0">, </span><span class="s2">&quot;NO&quot;</span><span class="s0">, </span><span class="s2">&quot;doc&quot;</span><span class="s0">, </span><span class="s1">validator=self.cf.is_nonnegative_int</span>
            <span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">self.cf.register_option(</span>
                <span class="s2">&quot;a.b.c.d3&quot;</span><span class="s0">, </span><span class="s1">-</span><span class="s4">2</span><span class="s0">, </span><span class="s2">&quot;doc&quot;</span><span class="s0">, </span><span class="s1">validator=self.cf.is_nonnegative_int</span>
            <span class="s1">)</span>

        <span class="s1">msg = </span><span class="s2">r&quot;Value must be an instance of &lt;class 'str'&gt;\|&lt;class 'bytes'&gt;&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">self.cf.set_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>

        <span class="s1">validator = self.cf.is_one_of_factory([</span><span class="s0">None, </span><span class="s1">self.cf.is_callable])</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;b&quot;</span><span class="s0">, lambda</span><span class="s1">: </span><span class="s0">None, </span><span class="s2">&quot;doc&quot;</span><span class="s0">, </span><span class="s1">validator=validator)</span>
        <span class="s1">self.cf.set_option(</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;%.1f&quot;</span><span class="s1">.format)  </span><span class="s3"># Formatter is callable</span>
        <span class="s1">self.cf.set_option(</span><span class="s2">&quot;b&quot;</span><span class="s0">, None</span><span class="s1">)  </span><span class="s3"># Formatter is none (default)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;Value must be a callable&quot;</span><span class="s1">):</span>
            <span class="s1">self.cf.set_option(</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;%.1f&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_reset_option(self):</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s2">&quot;doc&quot;</span><span class="s0">, </span><span class="s1">validator=self.cf.is_int)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s0">, </span><span class="s2">&quot;hullo&quot;</span><span class="s0">, </span><span class="s2">&quot;doc2&quot;</span><span class="s0">, </span><span class="s1">validator=self.cf.is_str)</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;a&quot;</span><span class="s1">) == </span><span class="s4">1</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s1">) == </span><span class="s2">&quot;hullo&quot;</span>

        <span class="s1">self.cf.set_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">self.cf.set_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s0">, </span><span class="s2">&quot;wurld&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;a&quot;</span><span class="s1">) == </span><span class="s4">2</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s1">) == </span><span class="s2">&quot;wurld&quot;</span>

        <span class="s1">self.cf.reset_option(</span><span class="s2">&quot;a&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;a&quot;</span><span class="s1">) == </span><span class="s4">1</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s1">) == </span><span class="s2">&quot;wurld&quot;</span>
        <span class="s1">self.cf.reset_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;a&quot;</span><span class="s1">) == </span><span class="s4">1</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s1">) == </span><span class="s2">&quot;hullo&quot;</span>

    <span class="s0">def </span><span class="s1">test_reset_option_all(self):</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s2">&quot;doc&quot;</span><span class="s0">, </span><span class="s1">validator=self.cf.is_int)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s0">, </span><span class="s2">&quot;hullo&quot;</span><span class="s0">, </span><span class="s2">&quot;doc2&quot;</span><span class="s0">, </span><span class="s1">validator=self.cf.is_str)</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;a&quot;</span><span class="s1">) == </span><span class="s4">1</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s1">) == </span><span class="s2">&quot;hullo&quot;</span>

        <span class="s1">self.cf.set_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">self.cf.set_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s0">, </span><span class="s2">&quot;wurld&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;a&quot;</span><span class="s1">) == </span><span class="s4">2</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s1">) == </span><span class="s2">&quot;wurld&quot;</span>

        <span class="s1">self.cf.reset_option(</span><span class="s2">&quot;all&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;a&quot;</span><span class="s1">) == </span><span class="s4">1</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s1">) == </span><span class="s2">&quot;hullo&quot;</span>

    <span class="s0">def </span><span class="s1">test_deprecate_option(self):</span>
        <span class="s3"># we can deprecate non-existent options</span>
        <span class="s1">self.cf.deprecate_option(</span><span class="s2">&quot;foo&quot;</span><span class="s1">)</span>

        <span class="s0">assert </span><span class="s1">self.cf._is_deprecated(</span><span class="s2">&quot;foo&quot;</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">warnings.catch_warnings(record=</span><span class="s0">True</span><span class="s1">) </span><span class="s0">as </span><span class="s1">w:</span>
            <span class="s1">warnings.simplefilter(</span><span class="s2">&quot;always&quot;</span><span class="s1">)</span>
            <span class="s0">with </span><span class="s1">pytest.raises(KeyError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;No such keys.s.: 'foo'&quot;</span><span class="s1">):</span>
                <span class="s1">self.cf.get_option(</span><span class="s2">&quot;foo&quot;</span><span class="s1">)</span>
            <span class="s0">assert </span><span class="s1">len(w) == </span><span class="s4">1  </span><span class="s3"># should have raised one warning</span>
            <span class="s0">assert </span><span class="s2">&quot;deprecated&quot; </span><span class="s0">in </span><span class="s1">str(w[-</span><span class="s4">1</span><span class="s1">])  </span><span class="s3"># we get the default message</span>

        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s2">&quot;doc&quot;</span><span class="s0">, </span><span class="s1">validator=self.cf.is_int)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s0">, </span><span class="s2">&quot;hullo&quot;</span><span class="s0">, </span><span class="s2">&quot;doc2&quot;</span><span class="s1">)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;foo&quot;</span><span class="s0">, </span><span class="s2">&quot;hullo&quot;</span><span class="s0">, </span><span class="s2">&quot;doc2&quot;</span><span class="s1">)</span>

        <span class="s1">self.cf.deprecate_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s1">removal_ver=</span><span class="s2">&quot;nifty_ver&quot;</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">warnings.catch_warnings(record=</span><span class="s0">True</span><span class="s1">) </span><span class="s0">as </span><span class="s1">w:</span>
            <span class="s1">warnings.simplefilter(</span><span class="s2">&quot;always&quot;</span><span class="s1">)</span>
            <span class="s1">self.cf.get_option(</span><span class="s2">&quot;a&quot;</span><span class="s1">)</span>

            <span class="s0">assert </span><span class="s1">len(w) == </span><span class="s4">1  </span><span class="s3"># should have raised one warning</span>
            <span class="s0">assert </span><span class="s2">&quot;eprecated&quot; </span><span class="s0">in </span><span class="s1">str(w[-</span><span class="s4">1</span><span class="s1">])  </span><span class="s3"># we get the default message</span>
            <span class="s0">assert </span><span class="s2">&quot;nifty_ver&quot; </span><span class="s0">in </span><span class="s1">str(w[-</span><span class="s4">1</span><span class="s1">])  </span><span class="s3"># with the removal_ver quoted</span>

            <span class="s1">msg = </span><span class="s2">&quot;Option 'a' has already been defined as deprecated&quot;</span>
            <span class="s0">with </span><span class="s1">pytest.raises(OptionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
                <span class="s1">self.cf.deprecate_option(</span><span class="s2">&quot;a&quot;</span><span class="s1">)</span>

        <span class="s1">self.cf.deprecate_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s0">, </span><span class="s2">&quot;zounds!&quot;</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">warnings.catch_warnings(record=</span><span class="s0">True</span><span class="s1">) </span><span class="s0">as </span><span class="s1">w:</span>
            <span class="s1">warnings.simplefilter(</span><span class="s2">&quot;always&quot;</span><span class="s1">)</span>
            <span class="s1">self.cf.get_option(</span><span class="s2">&quot;b.c&quot;</span><span class="s1">)</span>

            <span class="s0">assert </span><span class="s1">len(w) == </span><span class="s4">1  </span><span class="s3"># should have raised one warning</span>
            <span class="s0">assert </span><span class="s2">&quot;zounds!&quot; </span><span class="s0">in </span><span class="s1">str(w[-</span><span class="s4">1</span><span class="s1">])  </span><span class="s3"># we get the custom message</span>

        <span class="s3"># test rerouting keys</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;d.a&quot;</span><span class="s0">, </span><span class="s2">&quot;foo&quot;</span><span class="s0">, </span><span class="s2">&quot;doc2&quot;</span><span class="s1">)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;d.dep&quot;</span><span class="s0">, </span><span class="s2">&quot;bar&quot;</span><span class="s0">, </span><span class="s2">&quot;doc2&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;d.a&quot;</span><span class="s1">) == </span><span class="s2">&quot;foo&quot;</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;d.dep&quot;</span><span class="s1">) == </span><span class="s2">&quot;bar&quot;</span>

        <span class="s1">self.cf.deprecate_option(</span><span class="s2">&quot;d.dep&quot;</span><span class="s0">, </span><span class="s1">rkey=</span><span class="s2">&quot;d.a&quot;</span><span class="s1">)  </span><span class="s3"># reroute d.dep to d.a</span>
        <span class="s0">with </span><span class="s1">warnings.catch_warnings(record=</span><span class="s0">True</span><span class="s1">) </span><span class="s0">as </span><span class="s1">w:</span>
            <span class="s1">warnings.simplefilter(</span><span class="s2">&quot;always&quot;</span><span class="s1">)</span>
            <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;d.dep&quot;</span><span class="s1">) == </span><span class="s2">&quot;foo&quot;</span>

            <span class="s0">assert </span><span class="s1">len(w) == </span><span class="s4">1  </span><span class="s3"># should have raised one warning</span>
            <span class="s0">assert </span><span class="s2">&quot;eprecated&quot; </span><span class="s0">in </span><span class="s1">str(w[-</span><span class="s4">1</span><span class="s1">])  </span><span class="s3"># we get the custom message</span>

        <span class="s0">with </span><span class="s1">warnings.catch_warnings(record=</span><span class="s0">True</span><span class="s1">) </span><span class="s0">as </span><span class="s1">w:</span>
            <span class="s1">warnings.simplefilter(</span><span class="s2">&quot;always&quot;</span><span class="s1">)</span>
            <span class="s1">self.cf.set_option(</span><span class="s2">&quot;d.dep&quot;</span><span class="s0">, </span><span class="s2">&quot;baz&quot;</span><span class="s1">)  </span><span class="s3"># should overwrite &quot;d.a&quot;</span>

            <span class="s0">assert </span><span class="s1">len(w) == </span><span class="s4">1  </span><span class="s3"># should have raised one warning</span>
            <span class="s0">assert </span><span class="s2">&quot;eprecated&quot; </span><span class="s0">in </span><span class="s1">str(w[-</span><span class="s4">1</span><span class="s1">])  </span><span class="s3"># we get the custom message</span>

        <span class="s0">with </span><span class="s1">warnings.catch_warnings(record=</span><span class="s0">True</span><span class="s1">) </span><span class="s0">as </span><span class="s1">w:</span>
            <span class="s1">warnings.simplefilter(</span><span class="s2">&quot;always&quot;</span><span class="s1">)</span>
            <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;d.dep&quot;</span><span class="s1">) == </span><span class="s2">&quot;baz&quot;</span>

            <span class="s0">assert </span><span class="s1">len(w) == </span><span class="s4">1  </span><span class="s3"># should have raised one warning</span>
            <span class="s0">assert </span><span class="s2">&quot;eprecated&quot; </span><span class="s0">in </span><span class="s1">str(w[-</span><span class="s4">1</span><span class="s1">])  </span><span class="s3"># we get the custom message</span>

    <span class="s0">def </span><span class="s1">test_config_prefix(self):</span>
        <span class="s0">with </span><span class="s1">self.cf.config_prefix(</span><span class="s2">&quot;base&quot;</span><span class="s1">):</span>
            <span class="s1">self.cf.register_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s2">&quot;doc1&quot;</span><span class="s1">)</span>
            <span class="s1">self.cf.register_option(</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s2">&quot;doc2&quot;</span><span class="s1">)</span>
            <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;a&quot;</span><span class="s1">) == </span><span class="s4">1</span>
            <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;b&quot;</span><span class="s1">) == </span><span class="s4">2</span>

            <span class="s1">self.cf.set_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
            <span class="s1">self.cf.set_option(</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span>
            <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;a&quot;</span><span class="s1">) == </span><span class="s4">3</span>
            <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;b&quot;</span><span class="s1">) == </span><span class="s4">4</span>

        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;base.a&quot;</span><span class="s1">) == </span><span class="s4">3</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;base.b&quot;</span><span class="s1">) == </span><span class="s4">4</span>
        <span class="s0">assert </span><span class="s2">&quot;doc1&quot; </span><span class="s0">in </span><span class="s1">self.cf.describe_option(</span><span class="s2">&quot;base.a&quot;</span><span class="s0">, </span><span class="s1">_print_desc=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s2">&quot;doc2&quot; </span><span class="s0">in </span><span class="s1">self.cf.describe_option(</span><span class="s2">&quot;base.b&quot;</span><span class="s0">, </span><span class="s1">_print_desc=</span><span class="s0">False</span><span class="s1">)</span>

        <span class="s1">self.cf.reset_option(</span><span class="s2">&quot;base.a&quot;</span><span class="s1">)</span>
        <span class="s1">self.cf.reset_option(</span><span class="s2">&quot;base.b&quot;</span><span class="s1">)</span>

        <span class="s0">with </span><span class="s1">self.cf.config_prefix(</span><span class="s2">&quot;base&quot;</span><span class="s1">):</span>
            <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;a&quot;</span><span class="s1">) == </span><span class="s4">1</span>
            <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;b&quot;</span><span class="s1">) == </span><span class="s4">2</span>

    <span class="s0">def </span><span class="s1">test_callback(self):</span>
        <span class="s1">k = [</span><span class="s0">None</span><span class="s1">]</span>
        <span class="s1">v = [</span><span class="s0">None</span><span class="s1">]</span>

        <span class="s0">def </span><span class="s1">callback(key):</span>
            <span class="s1">k.append(key)</span>
            <span class="s1">v.append(self.cf.get_option(key))</span>

        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;d.a&quot;</span><span class="s0">, </span><span class="s2">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">cb=callback)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;d.b&quot;</span><span class="s0">, </span><span class="s2">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">cb=callback)</span>

        <span class="s0">del </span><span class="s1">k[-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">v[-</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">self.cf.set_option(</span><span class="s2">&quot;d.a&quot;</span><span class="s0">, </span><span class="s2">&quot;fooz&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">k[-</span><span class="s4">1</span><span class="s1">] == </span><span class="s2">&quot;d.a&quot;</span>
        <span class="s0">assert </span><span class="s1">v[-</span><span class="s4">1</span><span class="s1">] == </span><span class="s2">&quot;fooz&quot;</span>

        <span class="s0">del </span><span class="s1">k[-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">v[-</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">self.cf.set_option(</span><span class="s2">&quot;d.b&quot;</span><span class="s0">, </span><span class="s2">&quot;boo&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">k[-</span><span class="s4">1</span><span class="s1">] == </span><span class="s2">&quot;d.b&quot;</span>
        <span class="s0">assert </span><span class="s1">v[-</span><span class="s4">1</span><span class="s1">] == </span><span class="s2">&quot;boo&quot;</span>

        <span class="s0">del </span><span class="s1">k[-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">v[-</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">self.cf.reset_option(</span><span class="s2">&quot;d.b&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">k[-</span><span class="s4">1</span><span class="s1">] == </span><span class="s2">&quot;d.b&quot;</span>

    <span class="s0">def </span><span class="s1">test_set_ContextManager(self):</span>
        <span class="s0">def </span><span class="s1">eq(val):</span>
            <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;a&quot;</span><span class="s1">) == val</span>

        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">eq(</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">self.cf.option_context(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">15</span><span class="s1">):</span>
            <span class="s1">eq(</span><span class="s4">15</span><span class="s1">)</span>
            <span class="s0">with </span><span class="s1">self.cf.option_context(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">25</span><span class="s1">):</span>
                <span class="s1">eq(</span><span class="s4">25</span><span class="s1">)</span>
            <span class="s1">eq(</span><span class="s4">15</span><span class="s1">)</span>
        <span class="s1">eq(</span><span class="s4">0</span><span class="s1">)</span>

        <span class="s1">self.cf.set_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">17</span><span class="s1">)</span>
        <span class="s1">eq(</span><span class="s4">17</span><span class="s1">)</span>

        <span class="s3"># Test that option_context can be used as a decorator too (#34253).</span>
        <span class="s1">@self.cf.option_context(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">123</span><span class="s1">)</span>
        <span class="s0">def </span><span class="s1">f():</span>
            <span class="s1">eq(</span><span class="s4">123</span><span class="s1">)</span>

        <span class="s1">f()</span>

    <span class="s0">def </span><span class="s1">test_attribute_access(self):</span>
        <span class="s1">holder = []</span>

        <span class="s0">def </span><span class="s1">f3(key):</span>
            <span class="s1">holder.append(</span><span class="s0">True</span><span class="s1">)</span>

        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">self.cf.register_option(</span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s1">cb=f3)</span>
        <span class="s1">options = self.cf.options</span>

        <span class="s0">assert </span><span class="s1">options.a == </span><span class="s4">0</span>
        <span class="s0">with </span><span class="s1">self.cf.option_context(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">15</span><span class="s1">):</span>
            <span class="s0">assert </span><span class="s1">options.a == </span><span class="s4">15</span>

        <span class="s1">options.a = </span><span class="s4">500</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(</span><span class="s2">&quot;a&quot;</span><span class="s1">) == </span><span class="s4">500</span>

        <span class="s1">self.cf.reset_option(</span><span class="s2">&quot;a&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">options.a == self.cf.get_option(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span>

        <span class="s1">msg = </span><span class="s2">&quot;You can only set the value of existing options&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(OptionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">options.b = </span><span class="s4">1</span>
        <span class="s0">with </span><span class="s1">pytest.raises(OptionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">options.display = </span><span class="s4">1</span>

        <span class="s3"># make sure callback kicks when using this form of setting</span>
        <span class="s1">options.c = </span><span class="s4">1</span>
        <span class="s0">assert </span><span class="s1">len(holder) == </span><span class="s4">1</span>

    <span class="s0">def </span><span class="s1">test_option_context_scope(self):</span>
        <span class="s3"># Ensure that creating a context does not affect the existing</span>
        <span class="s3"># environment as it is supposed to be used with the `with` statement.</span>
        <span class="s3"># See https://github.com/pandas-dev/pandas/issues/8514</span>

        <span class="s1">original_value = </span><span class="s4">60</span>
        <span class="s1">context_value = </span><span class="s4">10</span>
        <span class="s1">option_name = </span><span class="s2">&quot;a&quot;</span>

        <span class="s1">self.cf.register_option(option_name</span><span class="s0">, </span><span class="s1">original_value)</span>

        <span class="s3"># Ensure creating contexts didn't affect the current context.</span>
        <span class="s1">ctx = self.cf.option_context(option_name</span><span class="s0">, </span><span class="s1">context_value)</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(option_name) == original_value</span>

        <span class="s3"># Ensure the correct value is available inside the context.</span>
        <span class="s0">with </span><span class="s1">ctx:</span>
            <span class="s0">assert </span><span class="s1">self.cf.get_option(option_name) == context_value</span>

        <span class="s3"># Ensure the current context is reset</span>
        <span class="s0">assert </span><span class="s1">self.cf.get_option(option_name) == original_value</span>

    <span class="s0">def </span><span class="s1">test_dictwrapper_getattr(self):</span>
        <span class="s1">options = self.cf.options</span>
        <span class="s3"># GH 19789</span>
        <span class="s0">with </span><span class="s1">pytest.raises(OptionError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;No such option&quot;</span><span class="s1">):</span>
            <span class="s1">options.bananas</span>
        <span class="s0">assert not </span><span class="s1">hasattr(options</span><span class="s0">, </span><span class="s2">&quot;bananas&quot;</span><span class="s1">)</span>
</pre>
</body>
</html>