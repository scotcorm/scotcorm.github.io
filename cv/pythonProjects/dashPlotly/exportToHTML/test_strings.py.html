<html>
<head>
<title>test_strings.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
.s5 { color: #a5c261;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_strings.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">datetime</span><span class="s0">,</span>
    <span class="s1">timedelta</span><span class="s0">,</span>
<span class="s1">)</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">DataFrame</span><span class="s0">,</span>
    <span class="s1">Index</span><span class="s0">,</span>
    <span class="s1">MultiIndex</span><span class="s0">,</span>
    <span class="s1">Series</span><span class="s0">,</span>
    <span class="s1">isna</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">pandas._testing </span><span class="s0">as </span><span class="s1">tm</span>


<span class="s0">def </span><span class="s1">assert_series_or_index_equal(left</span><span class="s0">, </span><span class="s1">right):</span>
    <span class="s0">if </span><span class="s1">isinstance(left</span><span class="s0">, </span><span class="s1">Series):</span>
        <span class="s1">tm.assert_series_equal(left</span><span class="s0">, </span><span class="s1">right)</span>
    <span class="s0">else</span><span class="s1">:  </span><span class="s2"># Index</span>
        <span class="s1">tm.assert_index_equal(left</span><span class="s0">, </span><span class="s1">right)</span>


<span class="s0">def </span><span class="s1">test_iter():</span>
    <span class="s2"># GH3638</span>
    <span class="s1">strs = </span><span class="s3">&quot;google&quot;</span><span class="s0">, </span><span class="s3">&quot;wikimedia&quot;</span><span class="s0">, </span><span class="s3">&quot;wikipedia&quot;</span><span class="s0">, </span><span class="s3">&quot;wikitravel&quot;</span>
    <span class="s1">ser = Series(strs)</span>

    <span class="s0">with </span><span class="s1">tm.assert_produces_warning(FutureWarning):</span>
        <span class="s0">for </span><span class="s1">s </span><span class="s0">in </span><span class="s1">ser.str:</span>
            <span class="s2"># iter must yield a Series</span>
            <span class="s0">assert </span><span class="s1">isinstance(s</span><span class="s0">, </span><span class="s1">Series)</span>

            <span class="s2"># indices of each yielded Series should be equal to the index of</span>
            <span class="s2"># the original Series</span>
            <span class="s1">tm.assert_index_equal(s.index</span><span class="s0">, </span><span class="s1">ser.index)</span>

            <span class="s0">for </span><span class="s1">el </span><span class="s0">in </span><span class="s1">s:</span>
                <span class="s2"># each element of the series is either a basestring/str or nan</span>
                <span class="s0">assert </span><span class="s1">isinstance(el</span><span class="s0">, </span><span class="s1">str) </span><span class="s0">or </span><span class="s1">isna(el)</span>

    <span class="s2"># desired behavior is to iterate until everything would be nan on the</span>
    <span class="s2"># next iter so make sure the last element of the iterator was 'l' in</span>
    <span class="s2"># this case since 'wikitravel' is the longest string</span>
    <span class="s0">assert </span><span class="s1">s.dropna().values.item() == </span><span class="s3">&quot;l&quot;</span>


<span class="s0">def </span><span class="s1">test_iter_empty(any_string_dtype):</span>
    <span class="s1">ser = Series([]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>

    <span class="s1">i</span><span class="s0">, </span><span class="s1">s = </span><span class="s4">100</span><span class="s0">, </span><span class="s4">1</span>

    <span class="s0">with </span><span class="s1">tm.assert_produces_warning(FutureWarning):</span>
        <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">s </span><span class="s0">in </span><span class="s1">enumerate(ser.str):</span>
            <span class="s0">pass</span>

    <span class="s2"># nothing to iterate over so nothing defined values should remain</span>
    <span class="s2"># unchanged</span>
    <span class="s0">assert </span><span class="s1">i == </span><span class="s4">100</span>
    <span class="s0">assert </span><span class="s1">s == </span><span class="s4">1</span>


<span class="s0">def </span><span class="s1">test_iter_single_element(any_string_dtype):</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;a&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>

    <span class="s0">with </span><span class="s1">tm.assert_produces_warning(FutureWarning):</span>
        <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">s </span><span class="s0">in </span><span class="s1">enumerate(ser.str):</span>
            <span class="s0">pass</span>

    <span class="s0">assert not </span><span class="s1">i</span>
    <span class="s1">tm.assert_series_equal(ser</span><span class="s0">, </span><span class="s1">s)</span>


<span class="s0">def </span><span class="s1">test_iter_object_try_string():</span>
    <span class="s1">ser = Series(</span>
        <span class="s1">[</span>
            <span class="s1">slice(</span><span class="s0">None, </span><span class="s1">np.random.randint(</span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.random.randint(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">20</span><span class="s1">))</span>
            <span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)</span>
        <span class="s1">]</span>
    <span class="s1">)</span>

    <span class="s1">i</span><span class="s0">, </span><span class="s1">s = </span><span class="s4">100</span><span class="s0">, </span><span class="s3">&quot;h&quot;</span>

    <span class="s0">with </span><span class="s1">tm.assert_produces_warning(FutureWarning):</span>
        <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">s </span><span class="s0">in </span><span class="s1">enumerate(ser.str):</span>
            <span class="s0">pass</span>

    <span class="s0">assert </span><span class="s1">i == </span><span class="s4">100</span>
    <span class="s0">assert </span><span class="s1">s == </span><span class="s3">&quot;h&quot;</span>


<span class="s2"># test integer/float dtypes (inferred by constructor) and mixed</span>


<span class="s0">def </span><span class="s1">test_count(any_string_dtype):</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;foofoo&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;foooofooofommmfoo&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">result = ser.str.count(</span><span class="s3">&quot;f[o]+&quot;</span><span class="s1">)</span>
    <span class="s1">expected_dtype = np.float64 </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;Int64&quot;</span>
    <span class="s1">expected = Series([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_count_mixed_object():</span>
    <span class="s1">ser = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, True, </span><span class="s1">datetime.today()</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s0">, None, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2.0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">dtype=object</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">result = ser.str.count(</span><span class="s3">&quot;a&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s4">1</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan])</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_repeat(any_string_dtype):</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;d&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>

    <span class="s1">result = ser.str.repeat(</span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;aaa&quot;</span><span class="s0">, </span><span class="s3">&quot;bbb&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;ccc&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;ddd&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ser.str.repeat([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">])</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;bb&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;cccc&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;dddddd&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_repeat_mixed_object():</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, True, </span><span class="s1">datetime.today()</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s0">, None, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2.0</span><span class="s1">])</span>
    <span class="s1">result = ser.str.repeat(</span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;aaa&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;bbb&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;foofoofoo&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan]</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;arg, repeat&quot;</span><span class="s0">, </span><span class="s1">[[</span><span class="s0">None, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;b&quot;</span><span class="s0">, None</span><span class="s1">]])</span>
<span class="s0">def </span><span class="s1">test_repeat_with_null(any_string_dtype</span><span class="s0">, </span><span class="s1">arg</span><span class="s0">, </span><span class="s1">repeat):</span>
    <span class="s2"># GH: 31632</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">arg]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">result = ser.str.repeat([</span><span class="s4">3</span><span class="s0">, </span><span class="s1">repeat])</span>
    <span class="s1">expected = Series([</span><span class="s3">&quot;aaa&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_empty_str_methods(any_string_dtype):</span>
    <span class="s1">empty_str = empty = Series(dtype=any_string_dtype)</span>
    <span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot;</span><span class="s1">:</span>
        <span class="s1">empty_int = Series(dtype=</span><span class="s3">&quot;int64&quot;</span><span class="s1">)</span>
        <span class="s1">empty_bool = Series(dtype=bool)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">empty_int = Series(dtype=</span><span class="s3">&quot;Int64&quot;</span><span class="s1">)</span>
        <span class="s1">empty_bool = Series(dtype=</span><span class="s3">&quot;boolean&quot;</span><span class="s1">)</span>
    <span class="s1">empty_object = Series(dtype=object)</span>
    <span class="s1">empty_bytes = Series(dtype=object)</span>
    <span class="s1">empty_df = DataFrame()</span>

    <span class="s2"># GH7241</span>
    <span class="s2"># (extract) on empty series</span>

    <span class="s1">tm.assert_series_equal(empty_str</span><span class="s0">, </span><span class="s1">empty.str.cat(empty))</span>
    <span class="s0">assert </span><span class="s3">&quot;&quot; </span><span class="s1">== empty.str.cat()</span>
    <span class="s1">tm.assert_series_equal(empty_str</span><span class="s0">, </span><span class="s1">empty.str.title())</span>
    <span class="s1">tm.assert_series_equal(empty_int</span><span class="s0">, </span><span class="s1">empty.str.count(</span><span class="s3">&quot;a&quot;</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(empty_bool</span><span class="s0">, </span><span class="s1">empty.str.contains(</span><span class="s3">&quot;a&quot;</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(empty_bool</span><span class="s0">, </span><span class="s1">empty.str.startswith(</span><span class="s3">&quot;a&quot;</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(empty_bool</span><span class="s0">, </span><span class="s1">empty.str.endswith(</span><span class="s3">&quot;a&quot;</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(empty_str</span><span class="s0">, </span><span class="s1">empty.str.lower())</span>
    <span class="s1">tm.assert_series_equal(empty_str</span><span class="s0">, </span><span class="s1">empty.str.upper())</span>
    <span class="s1">tm.assert_series_equal(empty_str</span><span class="s0">, </span><span class="s1">empty.str.replace(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(empty_str</span><span class="s0">, </span><span class="s1">empty.str.repeat(</span><span class="s4">3</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(empty_bool</span><span class="s0">, </span><span class="s1">empty.str.match(</span><span class="s3">&quot;^a&quot;</span><span class="s1">))</span>
    <span class="s1">tm.assert_frame_equal(</span>
        <span class="s1">DataFrame(columns=[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span><span class="s0">,</span>
        <span class="s1">empty.str.extract(</span><span class="s3">&quot;()&quot;</span><span class="s0">, </span><span class="s1">expand=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(</span>
        <span class="s1">DataFrame(columns=[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span><span class="s0">,</span>
        <span class="s1">empty.str.extract(</span><span class="s3">&quot;()()&quot;</span><span class="s0">, </span><span class="s1">expand=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(empty_str</span><span class="s0">, </span><span class="s1">empty.str.extract(</span><span class="s3">&quot;()&quot;</span><span class="s0">, </span><span class="s1">expand=</span><span class="s0">False</span><span class="s1">))</span>
    <span class="s1">tm.assert_frame_equal(</span>
        <span class="s1">DataFrame(columns=[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span><span class="s0">,</span>
        <span class="s1">empty.str.extract(</span><span class="s3">&quot;()()&quot;</span><span class="s0">, </span><span class="s1">expand=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(empty_df</span><span class="s0">, </span><span class="s1">empty.str.get_dummies())</span>
    <span class="s1">tm.assert_series_equal(empty_str</span><span class="s0">, </span><span class="s1">empty_str.str.join(</span><span class="s3">&quot;&quot;</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(empty_int</span><span class="s0">, </span><span class="s1">empty.str.len())</span>
    <span class="s1">tm.assert_series_equal(empty_object</span><span class="s0">, </span><span class="s1">empty_str.str.findall(</span><span class="s3">&quot;a&quot;</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(empty_int</span><span class="s0">, </span><span class="s1">empty.str.find(</span><span class="s3">&quot;a&quot;</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(empty_int</span><span class="s0">, </span><span class="s1">empty.str.rfind(</span><span class="s3">&quot;a&quot;</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(empty_str</span><span class="s0">, </span><span class="s1">empty.str.pad(</span><span class="s4">42</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(empty_str</span><span class="s0">, </span><span class="s1">empty.str.center(</span><span class="s4">42</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(empty_object</span><span class="s0">, </span><span class="s1">empty.str.split(</span><span class="s3">&quot;a&quot;</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(empty_object</span><span class="s0">, </span><span class="s1">empty.str.rsplit(</span><span class="s3">&quot;a&quot;</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(empty_object</span><span class="s0">, </span><span class="s1">empty.str.partition(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">expand=</span><span class="s0">False</span><span class="s1">))</span>
    <span class="s1">tm.assert_frame_equal(empty_df</span><span class="s0">, </span><span class="s1">empty.str.partition(</span><span class="s3">&quot;a&quot;</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(empty_object</span><span class="s0">, </span><span class="s1">empty.str.rpartition(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">expand=</span><span class="s0">False</span><span class="s1">))</span>
    <span class="s1">tm.assert_frame_equal(empty_df</span><span class="s0">, </span><span class="s1">empty.str.rpartition(</span><span class="s3">&quot;a&quot;</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(empty_str</span><span class="s0">, </span><span class="s1">empty.str.slice(stop=</span><span class="s4">1</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(empty_str</span><span class="s0">, </span><span class="s1">empty.str.slice(step=</span><span class="s4">1</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(empty_str</span><span class="s0">, </span><span class="s1">empty.str.strip())</span>
    <span class="s1">tm.assert_series_equal(empty_str</span><span class="s0">, </span><span class="s1">empty.str.lstrip())</span>
    <span class="s1">tm.assert_series_equal(empty_str</span><span class="s0">, </span><span class="s1">empty.str.rstrip())</span>
    <span class="s1">tm.assert_series_equal(empty_str</span><span class="s0">, </span><span class="s1">empty.str.wrap(</span><span class="s4">42</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(empty_str</span><span class="s0">, </span><span class="s1">empty.str.get(</span><span class="s4">0</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(empty_object</span><span class="s0">, </span><span class="s1">empty_bytes.str.decode(</span><span class="s3">&quot;ascii&quot;</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(empty_bytes</span><span class="s0">, </span><span class="s1">empty.str.encode(</span><span class="s3">&quot;ascii&quot;</span><span class="s1">))</span>
    <span class="s2"># ismethods should always return boolean (GH 29624)</span>
    <span class="s1">tm.assert_series_equal(empty_bool</span><span class="s0">, </span><span class="s1">empty.str.isalnum())</span>
    <span class="s1">tm.assert_series_equal(empty_bool</span><span class="s0">, </span><span class="s1">empty.str.isalpha())</span>
    <span class="s1">tm.assert_series_equal(empty_bool</span><span class="s0">, </span><span class="s1">empty.str.isdigit())</span>
    <span class="s1">tm.assert_series_equal(empty_bool</span><span class="s0">, </span><span class="s1">empty.str.isspace())</span>
    <span class="s1">tm.assert_series_equal(empty_bool</span><span class="s0">, </span><span class="s1">empty.str.islower())</span>
    <span class="s1">tm.assert_series_equal(empty_bool</span><span class="s0">, </span><span class="s1">empty.str.isupper())</span>
    <span class="s1">tm.assert_series_equal(empty_bool</span><span class="s0">, </span><span class="s1">empty.str.istitle())</span>
    <span class="s1">tm.assert_series_equal(empty_bool</span><span class="s0">, </span><span class="s1">empty.str.isnumeric())</span>
    <span class="s1">tm.assert_series_equal(empty_bool</span><span class="s0">, </span><span class="s1">empty.str.isdecimal())</span>
    <span class="s1">tm.assert_series_equal(empty_str</span><span class="s0">, </span><span class="s1">empty.str.capitalize())</span>
    <span class="s1">tm.assert_series_equal(empty_str</span><span class="s0">, </span><span class="s1">empty.str.swapcase())</span>
    <span class="s1">tm.assert_series_equal(empty_str</span><span class="s0">, </span><span class="s1">empty.str.normalize(</span><span class="s3">&quot;NFC&quot;</span><span class="s1">))</span>

    <span class="s1">table = str.maketrans(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(empty_str</span><span class="s0">, </span><span class="s1">empty.str.translate(table))</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;method, expected&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s3">&quot;isalnum&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, True, True, True, True, False, True, True, False, False</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;isalpha&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, True, True, False, False, False, True, False, False, False</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s3">&quot;isdigit&quot;</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s0">False, False, False, True, False, False, False, True, False, False</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s3">&quot;isnumeric&quot;</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s0">False, False, False, True, False, False, False, True, False, False</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s3">&quot;isspace&quot;</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s0">False, False, False, False, False, False, False, False, False, True</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s3">&quot;islower&quot;</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s0">False, True, False, False, False, False, False, False, False, False</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s3">&quot;isupper&quot;</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s0">True, False, False, False, True, False, True, False, False, False</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s3">&quot;istitle&quot;</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s0">True, False, True, False, True, False, False, False, False, False</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_ismethods(method</span><span class="s0">, </span><span class="s1">expected</span><span class="s0">, </span><span class="s1">any_string_dtype):</span>
    <span class="s1">ser = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;Xy&quot;</span><span class="s0">, </span><span class="s3">&quot;4&quot;</span><span class="s0">, </span><span class="s3">&quot;3A&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s3">&quot;TT&quot;</span><span class="s0">, </span><span class="s3">&quot;55&quot;</span><span class="s0">, </span><span class="s3">&quot;-&quot;</span><span class="s0">, </span><span class="s3">&quot;  &quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype</span>
    <span class="s1">)</span>
    <span class="s1">expected_dtype = </span><span class="s3">&quot;bool&quot; </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;boolean&quot;</span>
    <span class="s1">expected = Series(expected</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">result = getattr(ser.str</span><span class="s0">, </span><span class="s1">method)()</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s2"># compare with standard library</span>
    <span class="s1">expected = [getattr(item</span><span class="s0">, </span><span class="s1">method)() </span><span class="s0">for </span><span class="s1">item </span><span class="s0">in </span><span class="s1">ser]</span>
    <span class="s0">assert </span><span class="s1">list(result) == expected</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;method, expected&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s3">&quot;isnumeric&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True, True, False, True, True, False</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;isdecimal&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True, False, False, False, True, False</span><span class="s1">])</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_isnumeric_unicode(method</span><span class="s0">, </span><span class="s1">expected</span><span class="s0">, </span><span class="s1">any_string_dtype):</span>
    <span class="s2"># 0x00bc: ¼ VULGAR FRACTION ONE QUARTER</span>
    <span class="s2"># 0x2605: ★ not number</span>
    <span class="s2"># 0x1378: ፸ ETHIOPIC NUMBER SEVENTY</span>
    <span class="s2"># 0xFF13: ３ Em 3</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;3&quot;</span><span class="s0">, </span><span class="s3">&quot;¼&quot;</span><span class="s0">, </span><span class="s3">&quot;★&quot;</span><span class="s0">, </span><span class="s3">&quot;፸&quot;</span><span class="s0">, </span><span class="s3">&quot;３&quot;</span><span class="s0">, </span><span class="s3">&quot;four&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">expected_dtype = </span><span class="s3">&quot;bool&quot; </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;boolean&quot;</span>
    <span class="s1">expected = Series(expected</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">result = getattr(ser.str</span><span class="s0">, </span><span class="s1">method)()</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s2"># compare with standard library</span>
    <span class="s1">expected = [getattr(item</span><span class="s0">, </span><span class="s1">method)() </span><span class="s0">for </span><span class="s1">item </span><span class="s0">in </span><span class="s1">ser]</span>
    <span class="s0">assert </span><span class="s1">list(result) == expected</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;method, expected&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s3">&quot;isnumeric&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, </span><span class="s1">np.nan</span><span class="s0">, True, False, </span><span class="s1">np.nan</span><span class="s0">, True, False</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;isdecimal&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, </span><span class="s1">np.nan</span><span class="s0">, False, False, </span><span class="s1">np.nan</span><span class="s0">, True, False</span><span class="s1">])</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_isnumeric_unicode_missing(method</span><span class="s0">, </span><span class="s1">expected</span><span class="s0">, </span><span class="s1">any_string_dtype):</span>
    <span class="s1">values = [</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;¼&quot;</span><span class="s0">, </span><span class="s3">&quot;★&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;３&quot;</span><span class="s0">, </span><span class="s3">&quot;four&quot;</span><span class="s1">]</span>
    <span class="s1">ser = Series(values</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">expected_dtype = </span><span class="s3">&quot;object&quot; </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;boolean&quot;</span>
    <span class="s1">expected = Series(expected</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">result = getattr(ser.str</span><span class="s0">, </span><span class="s1">method)()</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_spilt_join_roundtrip(any_string_dtype):</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;a_b_c&quot;</span><span class="s0">, </span><span class="s3">&quot;c_d_e&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;f_g_h&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">result = ser.str.split(</span><span class="s3">&quot;_&quot;</span><span class="s1">).str.join(</span><span class="s3">&quot;_&quot;</span><span class="s1">)</span>
    <span class="s1">expected = ser.astype(object)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_spilt_join_roundtrip_mixed_object():</span>
    <span class="s1">ser = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;a_b&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;asdf_cas_asdf&quot;</span><span class="s0">, True, </span><span class="s1">datetime.today()</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s0">, None, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2.0</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">result = ser.str.split(</span><span class="s3">&quot;_&quot;</span><span class="s1">).str.join(</span><span class="s3">&quot;_&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;a_b&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;asdf_cas_asdf&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan]</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_len(any_string_dtype):</span>
    <span class="s1">ser = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;fooo&quot;</span><span class="s0">, </span><span class="s3">&quot;fooooo&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;fooooooo&quot;</span><span class="s0">, </span><span class="s3">&quot;foo</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s0">, </span><span class="s3">&quot;あ&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">dtype=any_string_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">result = ser.str.len()</span>
    <span class="s1">expected_dtype = </span><span class="s3">&quot;float64&quot; </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;Int64&quot;</span>
    <span class="s1">expected = Series([</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_len_mixed():</span>
    <span class="s1">ser = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;a_b&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;asdf_cas_asdf&quot;</span><span class="s0">, True, </span><span class="s1">datetime.today()</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s0">, None, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2.0</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">result = ser.str.len()</span>
    <span class="s1">expected = Series([</span><span class="s4">3</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">13</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan])</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;method,sub,start,end,expected&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s3">&quot;index&quot;</span><span class="s0">, </span><span class="s3">&quot;EF&quot;</span><span class="s0">, None, None, </span><span class="s1">[</span><span class="s4">4</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;rindex&quot;</span><span class="s0">, </span><span class="s3">&quot;EF&quot;</span><span class="s0">, None, None, </span><span class="s1">[</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;index&quot;</span><span class="s0">, </span><span class="s3">&quot;EF&quot;</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, None, </span><span class="s1">[</span><span class="s4">4</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;rindex&quot;</span><span class="s0">, </span><span class="s3">&quot;EF&quot;</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, None, </span><span class="s1">[</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;index&quot;</span><span class="s0">, </span><span class="s3">&quot;E&quot;</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s1">[</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;rindex&quot;</span><span class="s0">, </span><span class="s3">&quot;E&quot;</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s1">[</span><span class="s4">4</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_index(</span>
    <span class="s1">method</span><span class="s0">, </span><span class="s1">sub</span><span class="s0">, </span><span class="s1">start</span><span class="s0">, </span><span class="s1">end</span><span class="s0">, </span><span class="s1">index_or_series</span><span class="s0">, </span><span class="s1">any_string_dtype</span><span class="s0">, </span><span class="s1">expected</span><span class="s0">, </span><span class="s1">request</span>
<span class="s1">):</span>

    <span class="s1">obj = index_or_series(</span>
        <span class="s1">[</span><span class="s3">&quot;ABCDEFG&quot;</span><span class="s0">, </span><span class="s3">&quot;BCDEFEF&quot;</span><span class="s0">, </span><span class="s3">&quot;DEFGHIJEF&quot;</span><span class="s0">, </span><span class="s3">&quot;EFGHEF&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype</span>
    <span class="s1">)</span>
    <span class="s1">expected_dtype = np.int64 </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;Int64&quot;</span>
    <span class="s1">expected = index_or_series(expected</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>

    <span class="s1">result = getattr(obj.str</span><span class="s0">, </span><span class="s1">method)(sub</span><span class="s0">, </span><span class="s1">start</span><span class="s0">, </span><span class="s1">end)</span>

    <span class="s0">if </span><span class="s1">index_or_series </span><span class="s0">is </span><span class="s1">Series:</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s2"># compare with standard library</span>
    <span class="s1">expected = [getattr(item</span><span class="s0">, </span><span class="s1">method)(sub</span><span class="s0">, </span><span class="s1">start</span><span class="s0">, </span><span class="s1">end) </span><span class="s0">for </span><span class="s1">item </span><span class="s0">in </span><span class="s1">obj]</span>
    <span class="s0">assert </span><span class="s1">list(result) == expected</span>


<span class="s0">def </span><span class="s1">test_index_not_found_raises(index_or_series</span><span class="s0">, </span><span class="s1">any_string_dtype):</span>
    <span class="s1">obj = index_or_series(</span>
        <span class="s1">[</span><span class="s3">&quot;ABCDEFG&quot;</span><span class="s0">, </span><span class="s3">&quot;BCDEFEF&quot;</span><span class="s0">, </span><span class="s3">&quot;DEFGHIJEF&quot;</span><span class="s0">, </span><span class="s3">&quot;EFGHEF&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype</span>
    <span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;substring not found&quot;</span><span class="s1">):</span>
        <span class="s1">obj.str.index(</span><span class="s3">&quot;DE&quot;</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;method&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;index&quot;</span><span class="s0">, </span><span class="s3">&quot;rindex&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_index_wrong_type_raises(index_or_series</span><span class="s0">, </span><span class="s1">any_string_dtype</span><span class="s0">, </span><span class="s1">method):</span>
    <span class="s1">obj = index_or_series([]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">msg = </span><span class="s3">&quot;expected a string object, not int&quot;</span>

    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">getattr(obj.str</span><span class="s0">, </span><span class="s1">method)(</span><span class="s4">0</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;method, exp&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">[</span><span class="s3">&quot;index&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s3">&quot;rindex&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]]</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_index_missing(any_string_dtype</span><span class="s0">, </span><span class="s1">method</span><span class="s0">, </span><span class="s1">exp):</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;abcb&quot;</span><span class="s0">, </span><span class="s3">&quot;ab&quot;</span><span class="s0">, </span><span class="s3">&quot;bcbe&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">expected_dtype = np.float64 </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;Int64&quot;</span>

    <span class="s1">result = getattr(ser.str</span><span class="s0">, </span><span class="s1">method)(</span><span class="s3">&quot;b&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series(exp + [np.nan]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_pipe_failures(any_string_dtype):</span>
    <span class="s2"># #2119</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;A|B|C&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>

    <span class="s1">result = ser.str.split(</span><span class="s3">&quot;|&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series([[</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s3">&quot;C&quot;</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=object)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ser.str.replace(</span><span class="s3">&quot;|&quot;</span><span class="s0">, </span><span class="s3">&quot; &quot;</span><span class="s0">, </span><span class="s1">regex=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s3">&quot;A B C&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;start, stop, step, expected&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, None, </span><span class="s1">[</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;bar&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;baz&quot;</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s0">None, None, </span><span class="s1">-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;owtoofaa&quot;</span><span class="s0">, </span><span class="s3">&quot;owtrabaa&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;xuqzabaa&quot;</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;oto&quot;</span><span class="s0">, </span><span class="s3">&quot;ato&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;aqx&quot;</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;ofa&quot;</span><span class="s0">, </span><span class="s3">&quot;aba&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;aba&quot;</span><span class="s1">])</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_slice(start</span><span class="s0">, </span><span class="s1">stop</span><span class="s0">, </span><span class="s1">step</span><span class="s0">, </span><span class="s1">expected</span><span class="s0">, </span><span class="s1">any_string_dtype):</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;aafootwo&quot;</span><span class="s0">, </span><span class="s3">&quot;aabartwo&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;aabazqux&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">result = ser.str.slice(start</span><span class="s0">, </span><span class="s1">stop</span><span class="s0">, </span><span class="s1">step)</span>
    <span class="s1">expected = Series(expected</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;start, stop, step, expected&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, None, </span><span class="s1">[</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;bar&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;oof&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;rab&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan])</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_slice_mixed_object(start</span><span class="s0">, </span><span class="s1">stop</span><span class="s0">, </span><span class="s1">step</span><span class="s0">, </span><span class="s1">expected):</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;aafootwo&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;aabartwo&quot;</span><span class="s0">, True, </span><span class="s1">datetime.today()</span><span class="s0">, None, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2.0</span><span class="s1">])</span>
    <span class="s1">result = ser.str.slice(start</span><span class="s0">, </span><span class="s1">stop</span><span class="s0">, </span><span class="s1">step)</span>
    <span class="s1">expected = Series(expected)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;start,stop,repl,expected&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, None, </span><span class="s1">[</span><span class="s3">&quot;shrt&quot;</span><span class="s0">, </span><span class="s3">&quot;a it longer&quot;</span><span class="s0">, </span><span class="s3">&quot;evnlongerthanthat&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">np.nan])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;shzrt&quot;</span><span class="s0">, </span><span class="s3">&quot;a zit longer&quot;</span><span class="s0">, </span><span class="s3">&quot;evznlongerthanthat&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s1">np.nan])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;shzort&quot;</span><span class="s0">, </span><span class="s3">&quot;a zbit longer&quot;</span><span class="s0">, </span><span class="s3">&quot;evzenlongerthanthat&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s1">np.nan])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;shzort&quot;</span><span class="s0">, </span><span class="s3">&quot;a zbit longer&quot;</span><span class="s0">, </span><span class="s3">&quot;evzenlongerthanthat&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s1">np.nan])</span><span class="s0">,</span>
        <span class="s1">(-</span><span class="s4">1</span><span class="s0">, None, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;shorz&quot;</span><span class="s0">, </span><span class="s3">&quot;a bit longez&quot;</span><span class="s0">, </span><span class="s3">&quot;evenlongerthanthaz&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s1">np.nan])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s0">None, </span><span class="s1">-</span><span class="s4">2</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;zrt&quot;</span><span class="s0">, </span><span class="s3">&quot;zer&quot;</span><span class="s0">, </span><span class="s3">&quot;zat&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s1">np.nan])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">6</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;shortz&quot;</span><span class="s0">, </span><span class="s3">&quot;a bit znger&quot;</span><span class="s0">, </span><span class="s3">&quot;evenlozerthanthat&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s1">np.nan])</span><span class="s0">,</span>
        <span class="s1">(-</span><span class="s4">10</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;zrt&quot;</span><span class="s0">, </span><span class="s3">&quot;a zit longer&quot;</span><span class="s0">, </span><span class="s3">&quot;evenlongzerthanthat&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s1">np.nan])</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_slice_replace(start</span><span class="s0">, </span><span class="s1">stop</span><span class="s0">, </span><span class="s1">repl</span><span class="s0">, </span><span class="s1">expected</span><span class="s0">, </span><span class="s1">any_string_dtype):</span>
    <span class="s1">ser = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;short&quot;</span><span class="s0">, </span><span class="s3">&quot;a bit longer&quot;</span><span class="s0">, </span><span class="s3">&quot;evenlongerthanthat&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">,</span>
        <span class="s1">dtype=any_string_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">expected = Series(expected</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">result = ser.str.slice_replace(start</span><span class="s0">, </span><span class="s1">stop</span><span class="s0">, </span><span class="s1">repl)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;method, exp&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">[</span><span class="s3">&quot;strip&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;aa&quot;</span><span class="s0">, </span><span class="s3">&quot;bb&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;cc&quot;</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s3">&quot;lstrip&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;aa   &quot;</span><span class="s0">, </span><span class="s3">&quot;bb </span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;cc  &quot;</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s3">&quot;rstrip&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;  aa&quot;</span><span class="s0">, </span><span class="s3">&quot; bb&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;cc&quot;</span><span class="s1">]]</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_strip_lstrip_rstrip(any_string_dtype</span><span class="s0">, </span><span class="s1">method</span><span class="s0">, </span><span class="s1">exp):</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;  aa   &quot;</span><span class="s0">, </span><span class="s3">&quot; bb </span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;cc  &quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>

    <span class="s1">result = getattr(ser.str</span><span class="s0">, </span><span class="s1">method)()</span>
    <span class="s1">expected = Series(exp</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;method, exp&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">[</span><span class="s3">&quot;strip&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;aa&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;bb&quot;</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s3">&quot;lstrip&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;aa  &quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;bb </span><span class="s0">\t\n</span><span class="s3">&quot;</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s3">&quot;rstrip&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;  aa&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot; bb&quot;</span><span class="s1">]]</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_strip_lstrip_rstrip_mixed_object(method</span><span class="s0">, </span><span class="s1">exp):</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;  aa  &quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot; bb </span><span class="s0">\t\n</span><span class="s3">&quot;</span><span class="s0">, True, </span><span class="s1">datetime.today()</span><span class="s0">, None, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2.0</span><span class="s1">])</span>

    <span class="s1">result = getattr(ser.str</span><span class="s0">, </span><span class="s1">method)()</span>
    <span class="s1">expected = Series(exp + [np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan])</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;method, exp&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">[</span><span class="s3">&quot;strip&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;ABC&quot;</span><span class="s0">, </span><span class="s3">&quot; BNSD&quot;</span><span class="s0">, </span><span class="s3">&quot;LDFJH &quot;</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s3">&quot;lstrip&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;ABCxx&quot;</span><span class="s0">, </span><span class="s3">&quot; BNSD&quot;</span><span class="s0">, </span><span class="s3">&quot;LDFJH xx&quot;</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s3">&quot;rstrip&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;xxABC&quot;</span><span class="s0">, </span><span class="s3">&quot;xx BNSD&quot;</span><span class="s0">, </span><span class="s3">&quot;LDFJH &quot;</span><span class="s1">]]</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_strip_lstrip_rstrip_args(any_string_dtype</span><span class="s0">, </span><span class="s1">method</span><span class="s0">, </span><span class="s1">exp):</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;xxABCxx&quot;</span><span class="s0">, </span><span class="s3">&quot;xx BNSD&quot;</span><span class="s0">, </span><span class="s3">&quot;LDFJH xx&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>

    <span class="s1">result = getattr(ser.str</span><span class="s0">, </span><span class="s1">method)(</span><span class="s3">&quot;x&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series(exp</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;prefix, expected&quot;</span><span class="s0">, </span><span class="s1">[(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot; b c&quot;</span><span class="s0">, </span><span class="s3">&quot;bc&quot;</span><span class="s1">])</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;ab&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s3">&quot;a b c&quot;</span><span class="s0">, </span><span class="s3">&quot;bc&quot;</span><span class="s1">])]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_removeprefix(any_string_dtype</span><span class="s0">, </span><span class="s1">prefix</span><span class="s0">, </span><span class="s1">expected):</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;ab&quot;</span><span class="s0">, </span><span class="s3">&quot;a b c&quot;</span><span class="s0">, </span><span class="s3">&quot;bc&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">result = ser.str.removeprefix(prefix)</span>
    <span class="s1">ser_expected = Series(expected</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">ser_expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;suffix, expected&quot;</span><span class="s0">, </span><span class="s1">[(</span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;ab&quot;</span><span class="s0">, </span><span class="s3">&quot;a b &quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">])</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;bc&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;ab&quot;</span><span class="s0">, </span><span class="s3">&quot;a b c&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">])]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_removesuffix(any_string_dtype</span><span class="s0">, </span><span class="s1">suffix</span><span class="s0">, </span><span class="s1">expected):</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;ab&quot;</span><span class="s0">, </span><span class="s3">&quot;a b c&quot;</span><span class="s0">, </span><span class="s3">&quot;bc&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">result = ser.str.removesuffix(suffix)</span>
    <span class="s1">ser_expected = Series(expected</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">ser_expected)</span>


<span class="s0">def </span><span class="s1">test_string_slice_get_syntax(any_string_dtype):</span>
    <span class="s1">ser = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;YYY&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s3">&quot;C&quot;</span><span class="s0">, </span><span class="s3">&quot;YYYYYYbYYY&quot;</span><span class="s0">, </span><span class="s3">&quot;BYYYcYYY&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;CYYYBYYY&quot;</span><span class="s0">, </span><span class="s3">&quot;dog&quot;</span><span class="s0">, </span><span class="s3">&quot;cYYYt&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">dtype=any_string_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s1">result = ser.str[</span><span class="s4">0</span><span class="s1">]</span>
    <span class="s1">expected = ser.str.get(</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ser.str[:</span><span class="s4">3</span><span class="s1">]</span>
    <span class="s1">expected = ser.str.slice(stop=</span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ser.str[</span><span class="s4">2</span><span class="s1">::-</span><span class="s4">1</span><span class="s1">]</span>
    <span class="s1">expected = ser.str.slice(start=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">step=-</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_string_slice_out_of_bounds_nested():</span>
    <span class="s1">ser = Series([(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)])</span>
    <span class="s1">result = ser.str[</span><span class="s4">1</span><span class="s1">]</span>
    <span class="s1">expected = Series([</span><span class="s4">2</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_string_slice_out_of_bounds(any_string_dtype):</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;ba&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">result = ser.str[</span><span class="s4">1</span><span class="s1">]</span>
    <span class="s1">expected = Series([</span><span class="s3">&quot;o&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_encode_decode(any_string_dtype):</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;a</span><span class="s0">\xe4</span><span class="s3">&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype).str.encode(</span><span class="s3">&quot;utf-8&quot;</span><span class="s1">)</span>
    <span class="s1">result = ser.str.decode(</span><span class="s3">&quot;utf-8&quot;</span><span class="s1">)</span>
    <span class="s1">expected = ser.map(</span><span class="s0">lambda </span><span class="s1">x: x.decode(</span><span class="s3">&quot;utf-8&quot;</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_encode_errors_kwarg(any_string_dtype):</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;a</span><span class="s0">\x9d</span><span class="s3">&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>

    <span class="s1">msg = (</span>
        <span class="s3">r&quot;'charmap' codec can't encode character '\\x9d' in position 1: &quot;</span>
        <span class="s3">&quot;character maps to &lt;undefined&gt;&quot;</span>
    <span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(UnicodeEncodeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">ser.str.encode(</span><span class="s3">&quot;cp1252&quot;</span><span class="s1">)</span>

    <span class="s1">result = ser.str.encode(</span><span class="s3">&quot;cp1252&quot;</span><span class="s0">, </span><span class="s3">&quot;ignore&quot;</span><span class="s1">)</span>
    <span class="s1">expected = ser.map(</span><span class="s0">lambda </span><span class="s1">x: x.encode(</span><span class="s3">&quot;cp1252&quot;</span><span class="s0">, </span><span class="s3">&quot;ignore&quot;</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_decode_errors_kwarg():</span>
    <span class="s1">ser = Series([</span><span class="s5">b&quot;a&quot;</span><span class="s0">, </span><span class="s5">b&quot;b&quot;</span><span class="s0">, </span><span class="s5">b&quot;a</span><span class="s0">\x9d</span><span class="s5">&quot;</span><span class="s1">])</span>

    <span class="s1">msg = (</span>
        <span class="s3">&quot;'charmap' codec can't decode byte 0x9d in position 1: &quot;</span>
        <span class="s3">&quot;character maps to &lt;undefined&gt;&quot;</span>
    <span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(UnicodeDecodeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">ser.str.decode(</span><span class="s3">&quot;cp1252&quot;</span><span class="s1">)</span>

    <span class="s1">result = ser.str.decode(</span><span class="s3">&quot;cp1252&quot;</span><span class="s0">, </span><span class="s3">&quot;ignore&quot;</span><span class="s1">)</span>
    <span class="s1">expected = ser.map(</span><span class="s0">lambda </span><span class="s1">x: x.decode(</span><span class="s3">&quot;cp1252&quot;</span><span class="s0">, </span><span class="s3">&quot;ignore&quot;</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;form, expected&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s3">&quot;NFKC&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;ABC&quot;</span><span class="s0">, </span><span class="s3">&quot;ABC&quot;</span><span class="s0">, </span><span class="s3">&quot;123&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;アイエ&quot;</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;NFC&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;ABC&quot;</span><span class="s0">, </span><span class="s3">&quot;ＡＢＣ&quot;</span><span class="s0">, </span><span class="s3">&quot;１２３&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;ｱｲｴ&quot;</span><span class="s1">])</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_normalize(form</span><span class="s0">, </span><span class="s1">expected</span><span class="s0">, </span><span class="s1">any_string_dtype):</span>
    <span class="s1">ser = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;ABC&quot;</span><span class="s0">, </span><span class="s3">&quot;ＡＢＣ&quot;</span><span class="s0">, </span><span class="s3">&quot;１２３&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;ｱｲｴ&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">index=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;d&quot;</span><span class="s0">, </span><span class="s3">&quot;e&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">dtype=any_string_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">expected = Series(expected</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;d&quot;</span><span class="s0">, </span><span class="s3">&quot;e&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">result = ser.str.normalize(form)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_normalize_bad_arg_raises(any_string_dtype):</span>
    <span class="s1">ser = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;ABC&quot;</span><span class="s0">, </span><span class="s3">&quot;ＡＢＣ&quot;</span><span class="s0">, </span><span class="s3">&quot;１２３&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;ｱｲｴ&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">index=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;d&quot;</span><span class="s0">, </span><span class="s3">&quot;e&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">dtype=any_string_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;invalid normalization form&quot;</span><span class="s1">):</span>
        <span class="s1">ser.str.normalize(</span><span class="s3">&quot;xxx&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_normalize_index():</span>
    <span class="s1">idx = Index([</span><span class="s3">&quot;ＡＢＣ&quot;</span><span class="s0">, </span><span class="s3">&quot;１２３&quot;</span><span class="s0">, </span><span class="s3">&quot;ｱｲｴ&quot;</span><span class="s1">])</span>
    <span class="s1">expected = Index([</span><span class="s3">&quot;ABC&quot;</span><span class="s0">, </span><span class="s3">&quot;123&quot;</span><span class="s0">, </span><span class="s3">&quot;アイエ&quot;</span><span class="s1">])</span>
    <span class="s1">result = idx.str.normalize(</span><span class="s3">&quot;NFKC&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_index_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;values,inferred_type&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;string&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;mixed-integer&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s4">1.3</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;mixed&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s4">1.3</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;mixed-integer&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([</span><span class="s3">&quot;aa&quot;</span><span class="s0">, </span><span class="s1">datetime(</span><span class="s4">2011</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)]</span><span class="s0">, </span><span class="s3">&quot;mixed&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_index_str_accessor_visibility(values</span><span class="s0">, </span><span class="s1">inferred_type</span><span class="s0">, </span><span class="s1">index_or_series):</span>
    <span class="s0">from </span><span class="s1">pandas.core.strings </span><span class="s0">import </span><span class="s1">StringMethods</span>

    <span class="s1">obj = index_or_series(values)</span>
    <span class="s0">if </span><span class="s1">index_or_series </span><span class="s0">is </span><span class="s1">Index:</span>
        <span class="s0">assert </span><span class="s1">obj.inferred_type == inferred_type</span>

    <span class="s0">assert </span><span class="s1">isinstance(obj.str</span><span class="s0">, </span><span class="s1">StringMethods)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;values,inferred_type&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">([</span><span class="s4">1</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s3">&quot;floating&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([datetime(</span><span class="s4">2011</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)]</span><span class="s0">, </span><span class="s3">&quot;datetime64&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([timedelta(</span><span class="s4">1</span><span class="s1">)]</span><span class="s0">, </span><span class="s3">&quot;timedelta64&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_index_str_accessor_non_string_values_raises(</span>
    <span class="s1">values</span><span class="s0">, </span><span class="s1">inferred_type</span><span class="s0">, </span><span class="s1">index_or_series</span>
<span class="s1">):</span>
    <span class="s1">obj = index_or_series(values)</span>
    <span class="s0">if </span><span class="s1">index_or_series </span><span class="s0">is </span><span class="s1">Index:</span>
        <span class="s0">assert </span><span class="s1">obj.inferred_type == inferred_type</span>

    <span class="s1">msg = </span><span class="s3">&quot;Can only use .str accessor with string values&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.raises(AttributeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">obj.str</span>


<span class="s0">def </span><span class="s1">test_index_str_accessor_multiindex_raises():</span>
    <span class="s2"># MultiIndex has mixed dtype, but not allow to use accessor</span>
    <span class="s1">idx = MultiIndex.from_tuples([(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">)])</span>
    <span class="s0">assert </span><span class="s1">idx.inferred_type == </span><span class="s3">&quot;mixed&quot;</span>

    <span class="s1">msg = </span><span class="s3">&quot;Can only use .str accessor with Index, not MultiIndex&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.raises(AttributeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">idx.str</span>


<span class="s0">def </span><span class="s1">test_str_accessor_no_new_attributes(any_string_dtype):</span>
    <span class="s2"># https://github.com/pandas-dev/pandas/issues/10673</span>
    <span class="s1">ser = Series(list(</span><span class="s3">&quot;aabbcde&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(AttributeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;You cannot add any new attribute&quot;</span><span class="s1">):</span>
        <span class="s1">ser.str.xlabel = </span><span class="s3">&quot;a&quot;</span>


<span class="s0">def </span><span class="s1">test_cat_on_bytes_raises():</span>
    <span class="s1">lhs = Series(np.array(list(</span><span class="s3">&quot;abc&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s3">&quot;S1&quot;</span><span class="s1">).astype(object))</span>
    <span class="s1">rhs = Series(np.array(list(</span><span class="s3">&quot;def&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s3">&quot;S1&quot;</span><span class="s1">).astype(object))</span>
    <span class="s1">msg = </span><span class="s3">&quot;Cannot use .str.cat with values of inferred dtype 'bytes'&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">lhs.str.cat(rhs)</span>


<span class="s0">def </span><span class="s1">test_str_accessor_in_apply_func():</span>
    <span class="s2"># https://github.com/pandas-dev/pandas/issues/38979</span>
    <span class="s1">df = DataFrame(zip(</span><span class="s3">&quot;abc&quot;</span><span class="s0">, </span><span class="s3">&quot;def&quot;</span><span class="s1">))</span>
    <span class="s1">expected = Series([</span><span class="s3">&quot;A/D&quot;</span><span class="s0">, </span><span class="s3">&quot;B/E&quot;</span><span class="s0">, </span><span class="s3">&quot;C/F&quot;</span><span class="s1">])</span>
    <span class="s1">result = df.apply(</span><span class="s0">lambda </span><span class="s1">f: </span><span class="s3">&quot;/&quot;</span><span class="s1">.join(f.str.upper())</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
</pre>
</body>
</html>