<html>
<head>
<title>test_unary_ops.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_unary_ops.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">datetime</span>

<span class="s0">from </span><span class="s1">dateutil.tz </span><span class="s0">import </span><span class="s1">gettz</span>
<span class="s0">from </span><span class="s1">hypothesis </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">given</span><span class="s0">,</span>
    <span class="s1">strategies </span><span class="s0">as </span><span class="s1">st</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">import </span><span class="s1">pytz</span>
<span class="s0">from </span><span class="s1">pytz </span><span class="s0">import </span><span class="s1">utc</span>

<span class="s0">from </span><span class="s1">pandas._libs </span><span class="s0">import </span><span class="s1">lib</span>
<span class="s0">from </span><span class="s1">pandas._libs.tslibs </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">NaT</span><span class="s0">,</span>
    <span class="s1">Timedelta</span><span class="s0">,</span>
    <span class="s1">Timestamp</span><span class="s0">,</span>
    <span class="s1">conversion</span><span class="s0">,</span>
    <span class="s1">iNaT</span><span class="s0">,</span>
    <span class="s1">to_offset</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">from </span><span class="s1">pandas._libs.tslibs.period </span><span class="s0">import </span><span class="s1">INVALID_FREQ_ERR_MSG</span>
<span class="s0">import </span><span class="s1">pandas.util._test_decorators </span><span class="s0">as </span><span class="s1">td</span>

<span class="s0">import </span><span class="s1">pandas._testing </span><span class="s0">as </span><span class="s1">tm</span>


<span class="s0">class </span><span class="s1">TestTimestampUnaryOps:</span>

    <span class="s2"># --------------------------------------------------------------</span>
    <span class="s2"># Timestamp.round</span>
    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;timestamp, freq, expected&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">(</span><span class="s3">&quot;20130101 09:10:11&quot;</span><span class="s0">, </span><span class="s3">&quot;D&quot;</span><span class="s0">, </span><span class="s3">&quot;20130101&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s3">&quot;20130101 19:10:11&quot;</span><span class="s0">, </span><span class="s3">&quot;D&quot;</span><span class="s0">, </span><span class="s3">&quot;20130102&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s3">&quot;20130201 12:00:00&quot;</span><span class="s0">, </span><span class="s3">&quot;D&quot;</span><span class="s0">, </span><span class="s3">&quot;20130202&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s3">&quot;20130104 12:00:00&quot;</span><span class="s0">, </span><span class="s3">&quot;D&quot;</span><span class="s0">, </span><span class="s3">&quot;20130105&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s3">&quot;2000-01-05 05:09:15.13&quot;</span><span class="s0">, </span><span class="s3">&quot;D&quot;</span><span class="s0">, </span><span class="s3">&quot;2000-01-05 00:00:00&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s3">&quot;2000-01-05 05:09:15.13&quot;</span><span class="s0">, </span><span class="s3">&quot;H&quot;</span><span class="s0">, </span><span class="s3">&quot;2000-01-05 05:00:00&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s3">&quot;2000-01-05 05:09:15.13&quot;</span><span class="s0">, </span><span class="s3">&quot;S&quot;</span><span class="s0">, </span><span class="s3">&quot;2000-01-05 05:09:15&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_round_frequencies(self</span><span class="s0">, </span><span class="s1">timestamp</span><span class="s0">, </span><span class="s1">freq</span><span class="s0">, </span><span class="s1">expected):</span>
        <span class="s1">dt = Timestamp(timestamp)</span>
        <span class="s1">result = dt.round(freq)</span>
        <span class="s1">expected = Timestamp(expected)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s0">def </span><span class="s1">test_round_tzaware(self):</span>
        <span class="s1">dt = Timestamp(</span><span class="s3">&quot;20130101 09:10:11&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s1">result = dt.round(</span><span class="s3">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Timestamp(</span><span class="s3">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

        <span class="s1">dt = Timestamp(</span><span class="s3">&quot;20130101 09:10:11&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s1">result = dt.round(</span><span class="s3">&quot;s&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result == dt</span>

    <span class="s0">def </span><span class="s1">test_round_30min(self):</span>
        <span class="s2"># round</span>
        <span class="s1">dt = Timestamp(</span><span class="s3">&quot;20130104 12:32:00&quot;</span><span class="s1">)</span>
        <span class="s1">result = dt.round(</span><span class="s3">&quot;30Min&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Timestamp(</span><span class="s3">&quot;20130104 12:30:00&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s0">def </span><span class="s1">test_round_subsecond(self):</span>
        <span class="s2"># GH#14440 &amp; GH#15578</span>
        <span class="s1">result = Timestamp(</span><span class="s3">&quot;2016-10-17 12:00:00.0015&quot;</span><span class="s1">).round(</span><span class="s3">&quot;ms&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Timestamp(</span><span class="s3">&quot;2016-10-17 12:00:00.002000&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

        <span class="s1">result = Timestamp(</span><span class="s3">&quot;2016-10-17 12:00:00.00149&quot;</span><span class="s1">).round(</span><span class="s3">&quot;ms&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Timestamp(</span><span class="s3">&quot;2016-10-17 12:00:00.001000&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

        <span class="s1">ts = Timestamp(</span><span class="s3">&quot;2016-10-17 12:00:00.0015&quot;</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">freq </span><span class="s0">in </span><span class="s1">[</span><span class="s3">&quot;us&quot;</span><span class="s0">, </span><span class="s3">&quot;ns&quot;</span><span class="s1">]:</span>
            <span class="s0">assert </span><span class="s1">ts == ts.round(freq)</span>

        <span class="s1">result = Timestamp(</span><span class="s3">&quot;2016-10-17 12:00:00.001501031&quot;</span><span class="s1">).round(</span><span class="s3">&quot;10ns&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Timestamp(</span><span class="s3">&quot;2016-10-17 12:00:00.001501030&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s0">def </span><span class="s1">test_round_nonstandard_freq(self):</span>
        <span class="s0">with </span><span class="s1">tm.assert_produces_warning(</span><span class="s0">False</span><span class="s1">):</span>
            <span class="s1">Timestamp(</span><span class="s3">&quot;2016-10-17 12:00:00.001501031&quot;</span><span class="s1">).round(</span><span class="s3">&quot;1010ns&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_round_invalid_arg(self):</span>
        <span class="s1">stamp = Timestamp(</span><span class="s3">&quot;2000-01-05 05:09:15.13&quot;</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=INVALID_FREQ_ERR_MSG):</span>
            <span class="s1">stamp.round(</span><span class="s3">&quot;foo&quot;</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;test_input, rounder, freq, expected&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">(</span><span class="s3">&quot;2117-01-01 00:00:45&quot;</span><span class="s0">, </span><span class="s3">&quot;floor&quot;</span><span class="s0">, </span><span class="s3">&quot;15s&quot;</span><span class="s0">, </span><span class="s3">&quot;2117-01-01 00:00:45&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s3">&quot;2117-01-01 00:00:45&quot;</span><span class="s0">, </span><span class="s3">&quot;ceil&quot;</span><span class="s0">, </span><span class="s3">&quot;15s&quot;</span><span class="s0">, </span><span class="s3">&quot;2117-01-01 00:00:45&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span>
                <span class="s3">&quot;2117-01-01 00:00:45.000000012&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;floor&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;10ns&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2117-01-01 00:00:45.000000010&quot;</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span>
                <span class="s3">&quot;1823-01-01 00:00:01.000000012&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;ceil&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;10ns&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;1823-01-01 00:00:01.000000020&quot;</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s3">&quot;1823-01-01 00:00:01&quot;</span><span class="s0">, </span><span class="s3">&quot;floor&quot;</span><span class="s0">, </span><span class="s3">&quot;1s&quot;</span><span class="s0">, </span><span class="s3">&quot;1823-01-01 00:00:01&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s3">&quot;1823-01-01 00:00:01&quot;</span><span class="s0">, </span><span class="s3">&quot;ceil&quot;</span><span class="s0">, </span><span class="s3">&quot;1s&quot;</span><span class="s0">, </span><span class="s3">&quot;1823-01-01 00:00:01&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s3">&quot;NaT&quot;</span><span class="s0">, </span><span class="s3">&quot;floor&quot;</span><span class="s0">, </span><span class="s3">&quot;1s&quot;</span><span class="s0">, </span><span class="s3">&quot;NaT&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s3">&quot;NaT&quot;</span><span class="s0">, </span><span class="s3">&quot;ceil&quot;</span><span class="s0">, </span><span class="s3">&quot;1s&quot;</span><span class="s0">, </span><span class="s3">&quot;NaT&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_ceil_floor_edge(self</span><span class="s0">, </span><span class="s1">test_input</span><span class="s0">, </span><span class="s1">rounder</span><span class="s0">, </span><span class="s1">freq</span><span class="s0">, </span><span class="s1">expected):</span>
        <span class="s1">dt = Timestamp(test_input)</span>
        <span class="s1">func = getattr(dt</span><span class="s0">, </span><span class="s1">rounder)</span>
        <span class="s1">result = func(freq)</span>

        <span class="s0">if </span><span class="s1">dt </span><span class="s0">is </span><span class="s1">NaT:</span>
            <span class="s0">assert </span><span class="s1">result </span><span class="s0">is </span><span class="s1">NaT</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">expected = Timestamp(expected)</span>
            <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;test_input, freq, expected&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">(</span><span class="s3">&quot;2018-01-01 00:02:06&quot;</span><span class="s0">, </span><span class="s3">&quot;2s&quot;</span><span class="s0">, </span><span class="s3">&quot;2018-01-01 00:02:06&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s3">&quot;2018-01-01 00:02:00&quot;</span><span class="s0">, </span><span class="s3">&quot;2T&quot;</span><span class="s0">, </span><span class="s3">&quot;2018-01-01 00:02:00&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s3">&quot;2018-01-01 00:04:00&quot;</span><span class="s0">, </span><span class="s3">&quot;4T&quot;</span><span class="s0">, </span><span class="s3">&quot;2018-01-01 00:04:00&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s3">&quot;2018-01-01 00:15:00&quot;</span><span class="s0">, </span><span class="s3">&quot;15T&quot;</span><span class="s0">, </span><span class="s3">&quot;2018-01-01 00:15:00&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s3">&quot;2018-01-01 00:20:00&quot;</span><span class="s0">, </span><span class="s3">&quot;20T&quot;</span><span class="s0">, </span><span class="s3">&quot;2018-01-01 00:20:00&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s3">&quot;2018-01-01 03:00:00&quot;</span><span class="s0">, </span><span class="s3">&quot;3H&quot;</span><span class="s0">, </span><span class="s3">&quot;2018-01-01 03:00:00&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;rounder&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;ceil&quot;</span><span class="s0">, </span><span class="s3">&quot;floor&quot;</span><span class="s0">, </span><span class="s3">&quot;round&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_round_minute_freq(self</span><span class="s0">, </span><span class="s1">test_input</span><span class="s0">, </span><span class="s1">freq</span><span class="s0">, </span><span class="s1">expected</span><span class="s0">, </span><span class="s1">rounder):</span>
        <span class="s2"># Ensure timestamps that shouldn't round dont!</span>
        <span class="s2"># GH#21262</span>

        <span class="s1">dt = Timestamp(test_input)</span>
        <span class="s1">expected = Timestamp(expected)</span>
        <span class="s1">func = getattr(dt</span><span class="s0">, </span><span class="s1">rounder)</span>
        <span class="s1">result = func(freq)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s0">def </span><span class="s1">test_ceil(self):</span>
        <span class="s1">dt = Timestamp(</span><span class="s3">&quot;20130101 09:10:11&quot;</span><span class="s1">)</span>
        <span class="s1">result = dt.ceil(</span><span class="s3">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Timestamp(</span><span class="s3">&quot;20130102&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s0">def </span><span class="s1">test_floor(self):</span>
        <span class="s1">dt = Timestamp(</span><span class="s3">&quot;20130101 09:10:11&quot;</span><span class="s1">)</span>
        <span class="s1">result = dt.floor(</span><span class="s3">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Timestamp(</span><span class="s3">&quot;20130101&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;method&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;ceil&quot;</span><span class="s0">, </span><span class="s3">&quot;round&quot;</span><span class="s0">, </span><span class="s3">&quot;floor&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_round_dst_border_ambiguous(self</span><span class="s0">, </span><span class="s1">method):</span>
        <span class="s2"># GH 18946 round near &quot;fall back&quot; DST</span>
        <span class="s1">ts = Timestamp(</span><span class="s3">&quot;2017-10-29 00:00:00&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">&quot;UTC&quot;</span><span class="s1">).tz_convert(</span><span class="s3">&quot;Europe/Madrid&quot;</span><span class="s1">)</span>
        <span class="s2">#</span>
        <span class="s1">result = getattr(ts</span><span class="s0">, </span><span class="s1">method)(</span><span class="s3">&quot;H&quot;</span><span class="s0">, </span><span class="s1">ambiguous=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result == ts</span>

        <span class="s1">result = getattr(ts</span><span class="s0">, </span><span class="s1">method)(</span><span class="s3">&quot;H&quot;</span><span class="s0">, </span><span class="s1">ambiguous=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">expected = Timestamp(</span><span class="s3">&quot;2017-10-29 01:00:00&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">&quot;UTC&quot;</span><span class="s1">).tz_convert(</span>
            <span class="s3">&quot;Europe/Madrid&quot;</span>
        <span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

        <span class="s1">result = getattr(ts</span><span class="s0">, </span><span class="s1">method)(</span><span class="s3">&quot;H&quot;</span><span class="s0">, </span><span class="s1">ambiguous=</span><span class="s3">&quot;NaT&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s0">is </span><span class="s1">NaT</span>

        <span class="s1">msg = </span><span class="s3">&quot;Cannot infer dst time&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(pytz.AmbiguousTimeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">getattr(ts</span><span class="s0">, </span><span class="s1">method)(</span><span class="s3">&quot;H&quot;</span><span class="s0">, </span><span class="s1">ambiguous=</span><span class="s3">&quot;raise&quot;</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;method, ts_str, freq&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">[</span><span class="s3">&quot;ceil&quot;</span><span class="s0">, </span><span class="s3">&quot;2018-03-11 01:59:00-0600&quot;</span><span class="s0">, </span><span class="s3">&quot;5min&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s3">&quot;round&quot;</span><span class="s0">, </span><span class="s3">&quot;2018-03-11 01:59:00-0600&quot;</span><span class="s0">, </span><span class="s3">&quot;5min&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s3">&quot;floor&quot;</span><span class="s0">, </span><span class="s3">&quot;2018-03-11 03:01:00-0500&quot;</span><span class="s0">, </span><span class="s3">&quot;2H&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_round_dst_border_nonexistent(self</span><span class="s0">, </span><span class="s1">method</span><span class="s0">, </span><span class="s1">ts_str</span><span class="s0">, </span><span class="s1">freq):</span>
        <span class="s2"># GH 23324 round near &quot;spring forward&quot; DST</span>
        <span class="s1">ts = Timestamp(ts_str</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">&quot;America/Chicago&quot;</span><span class="s1">)</span>
        <span class="s1">result = getattr(ts</span><span class="s0">, </span><span class="s1">method)(freq</span><span class="s0">, </span><span class="s1">nonexistent=</span><span class="s3">&quot;shift_forward&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Timestamp(</span><span class="s3">&quot;2018-03-11 03:00:00&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">&quot;America/Chicago&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

        <span class="s1">result = getattr(ts</span><span class="s0">, </span><span class="s1">method)(freq</span><span class="s0">, </span><span class="s1">nonexistent=</span><span class="s3">&quot;NaT&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s0">is </span><span class="s1">NaT</span>

        <span class="s1">msg = </span><span class="s3">&quot;2018-03-11 02:00:00&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(pytz.NonExistentTimeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">getattr(ts</span><span class="s0">, </span><span class="s1">method)(freq</span><span class="s0">, </span><span class="s1">nonexistent=</span><span class="s3">&quot;raise&quot;</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;timestamp&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s3">&quot;2018-01-01 0:0:0.124999360&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;2018-01-01 0:0:0.125000367&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;2018-01-01 0:0:0.125500&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;2018-01-01 0:0:0.126500&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;2018-01-01 12:00:00&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;2019-01-01 12:00:00&quot;</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;freq&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s3">&quot;2ns&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;3ns&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;4ns&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;5ns&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;6ns&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;7ns&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;250ns&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;500ns&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;750ns&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;1us&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;19us&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;250us&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;500us&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;750us&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;1s&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;2s&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;3s&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;1D&quot;</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_round_int64(self</span><span class="s0">, </span><span class="s1">timestamp</span><span class="s0">, </span><span class="s1">freq):</span>
        <span class="s2"># check that all rounding modes are accurate to int64 precision</span>
        <span class="s2"># see GH#22591</span>
        <span class="s1">dt = Timestamp(timestamp)</span>
        <span class="s1">unit = to_offset(freq).nanos</span>

        <span class="s2"># test floor</span>
        <span class="s1">result = dt.floor(freq)</span>
        <span class="s0">assert </span><span class="s1">result.value % unit == </span><span class="s4">0</span><span class="s0">, </span><span class="s3">f&quot;floor not a </span><span class="s0">{</span><span class="s1">freq</span><span class="s0">} </span><span class="s3">multiple&quot;</span>
        <span class="s0">assert </span><span class="s4">0 </span><span class="s1">&lt;= dt.value - result.value &lt; unit</span><span class="s0">, </span><span class="s3">&quot;floor error&quot;</span>

        <span class="s2"># test ceil</span>
        <span class="s1">result = dt.ceil(freq)</span>
        <span class="s0">assert </span><span class="s1">result.value % unit == </span><span class="s4">0</span><span class="s0">, </span><span class="s3">f&quot;ceil not a </span><span class="s0">{</span><span class="s1">freq</span><span class="s0">} </span><span class="s3">multiple&quot;</span>
        <span class="s0">assert </span><span class="s4">0 </span><span class="s1">&lt;= result.value - dt.value &lt; unit</span><span class="s0">, </span><span class="s3">&quot;ceil error&quot;</span>

        <span class="s2"># test round</span>
        <span class="s1">result = dt.round(freq)</span>
        <span class="s0">assert </span><span class="s1">result.value % unit == </span><span class="s4">0</span><span class="s0">, </span><span class="s3">f&quot;round not a </span><span class="s0">{</span><span class="s1">freq</span><span class="s0">} </span><span class="s3">multiple&quot;</span>
        <span class="s0">assert </span><span class="s1">abs(result.value - dt.value) &lt;= unit // </span><span class="s4">2</span><span class="s0">, </span><span class="s3">&quot;round error&quot;</span>
        <span class="s0">if </span><span class="s1">unit % </span><span class="s4">2 </span><span class="s1">== </span><span class="s4">0 </span><span class="s0">and </span><span class="s1">abs(result.value - dt.value) == unit // </span><span class="s4">2</span><span class="s1">:</span>
            <span class="s2"># round half to even</span>
            <span class="s0">assert </span><span class="s1">result.value // unit % </span><span class="s4">2 </span><span class="s1">== </span><span class="s4">0</span><span class="s0">, </span><span class="s3">&quot;round half to even error&quot;</span>

    <span class="s0">def </span><span class="s1">test_round_implementation_bounds(self):</span>
        <span class="s2"># See also: analogous test for Timedelta</span>
        <span class="s1">result = Timestamp.min.ceil(</span><span class="s3">&quot;s&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Timestamp(</span><span class="s4">1677</span><span class="s0">, </span><span class="s4">9</span><span class="s0">, </span><span class="s4">21</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">12</span><span class="s0">, </span><span class="s4">44</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

        <span class="s1">result = Timestamp.max.floor(</span><span class="s3">&quot;s&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Timestamp.max - Timedelta(</span><span class="s4">854775807</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

        <span class="s0">with </span><span class="s1">pytest.raises(OverflowError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;value too large&quot;</span><span class="s1">):</span>
            <span class="s1">Timestamp.min.floor(</span><span class="s3">&quot;s&quot;</span><span class="s1">)</span>

        <span class="s2"># the second message here shows up in windows builds</span>
        <span class="s1">msg = </span><span class="s3">&quot;|&quot;</span><span class="s1">.join(</span>
            <span class="s1">[</span><span class="s3">&quot;Python int too large to convert to C long&quot;</span><span class="s0">, </span><span class="s3">&quot;int too big to convert&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(OverflowError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">Timestamp.max.ceil(</span><span class="s3">&quot;s&quot;</span><span class="s1">)</span>

    <span class="s1">@given(val=st.integers(iNaT + </span><span class="s4">1</span><span class="s0">, </span><span class="s1">lib.i8max))</span>
    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;method&quot;</span><span class="s0">, </span><span class="s1">[Timestamp.round</span><span class="s0">, </span><span class="s1">Timestamp.floor</span><span class="s0">, </span><span class="s1">Timestamp.ceil]</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_round_sanity(self</span><span class="s0">, </span><span class="s1">val</span><span class="s0">, </span><span class="s1">method):</span>
        <span class="s1">val = np.int64(val)</span>
        <span class="s1">ts = Timestamp(val)</span>

        <span class="s0">def </span><span class="s1">checker(res</span><span class="s0">, </span><span class="s1">ts</span><span class="s0">, </span><span class="s1">nanos):</span>
            <span class="s0">if </span><span class="s1">method </span><span class="s0">is </span><span class="s1">Timestamp.round:</span>
                <span class="s1">diff = np.abs((res - ts).value)</span>
                <span class="s0">assert </span><span class="s1">diff &lt;= nanos / </span><span class="s4">2</span>
            <span class="s0">elif </span><span class="s1">method </span><span class="s0">is </span><span class="s1">Timestamp.floor:</span>
                <span class="s0">assert </span><span class="s1">res &lt;= ts</span>
            <span class="s0">elif </span><span class="s1">method </span><span class="s0">is </span><span class="s1">Timestamp.ceil:</span>
                <span class="s0">assert </span><span class="s1">res &gt;= ts</span>

        <span class="s0">assert </span><span class="s1">method(ts</span><span class="s0">, </span><span class="s3">&quot;ns&quot;</span><span class="s1">) == ts</span>

        <span class="s1">res = method(ts</span><span class="s0">, </span><span class="s3">&quot;us&quot;</span><span class="s1">)</span>
        <span class="s1">nanos = </span><span class="s4">1000</span>
        <span class="s0">assert </span><span class="s1">np.abs((res - ts).value) &lt; nanos</span>
        <span class="s0">assert </span><span class="s1">res.value % nanos == </span><span class="s4">0</span>
        <span class="s1">checker(res</span><span class="s0">, </span><span class="s1">ts</span><span class="s0">, </span><span class="s1">nanos)</span>

        <span class="s1">res = method(ts</span><span class="s0">, </span><span class="s3">&quot;ms&quot;</span><span class="s1">)</span>
        <span class="s1">nanos = </span><span class="s4">1_000_000</span>
        <span class="s0">assert </span><span class="s1">np.abs((res - ts).value) &lt; nanos</span>
        <span class="s0">assert </span><span class="s1">res.value % nanos == </span><span class="s4">0</span>
        <span class="s1">checker(res</span><span class="s0">, </span><span class="s1">ts</span><span class="s0">, </span><span class="s1">nanos)</span>

        <span class="s1">res = method(ts</span><span class="s0">, </span><span class="s3">&quot;s&quot;</span><span class="s1">)</span>
        <span class="s1">nanos = </span><span class="s4">1_000_000_000</span>
        <span class="s0">assert </span><span class="s1">np.abs((res - ts).value) &lt; nanos</span>
        <span class="s0">assert </span><span class="s1">res.value % nanos == </span><span class="s4">0</span>
        <span class="s1">checker(res</span><span class="s0">, </span><span class="s1">ts</span><span class="s0">, </span><span class="s1">nanos)</span>

        <span class="s1">res = method(ts</span><span class="s0">, </span><span class="s3">&quot;min&quot;</span><span class="s1">)</span>
        <span class="s1">nanos = </span><span class="s4">60 </span><span class="s1">* </span><span class="s4">1_000_000_000</span>
        <span class="s0">assert </span><span class="s1">np.abs((res - ts).value) &lt; nanos</span>
        <span class="s0">assert </span><span class="s1">res.value % nanos == </span><span class="s4">0</span>
        <span class="s1">checker(res</span><span class="s0">, </span><span class="s1">ts</span><span class="s0">, </span><span class="s1">nanos)</span>

        <span class="s1">res = method(ts</span><span class="s0">, </span><span class="s3">&quot;h&quot;</span><span class="s1">)</span>
        <span class="s1">nanos = </span><span class="s4">60 </span><span class="s1">* </span><span class="s4">60 </span><span class="s1">* </span><span class="s4">1_000_000_000</span>
        <span class="s0">assert </span><span class="s1">np.abs((res - ts).value) &lt; nanos</span>
        <span class="s0">assert </span><span class="s1">res.value % nanos == </span><span class="s4">0</span>
        <span class="s1">checker(res</span><span class="s0">, </span><span class="s1">ts</span><span class="s0">, </span><span class="s1">nanos)</span>

        <span class="s1">res = method(ts</span><span class="s0">, </span><span class="s3">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s1">nanos = </span><span class="s4">24 </span><span class="s1">* </span><span class="s4">60 </span><span class="s1">* </span><span class="s4">60 </span><span class="s1">* </span><span class="s4">1_000_000_000</span>
        <span class="s0">assert </span><span class="s1">np.abs((res - ts).value) &lt; nanos</span>
        <span class="s0">assert </span><span class="s1">res.value % nanos == </span><span class="s4">0</span>
        <span class="s1">checker(res</span><span class="s0">, </span><span class="s1">ts</span><span class="s0">, </span><span class="s1">nanos)</span>

    <span class="s2"># --------------------------------------------------------------</span>
    <span class="s2"># Timestamp.replace</span>

    <span class="s0">def </span><span class="s1">test_replace_naive(self):</span>
        <span class="s2"># GH#14621, GH#7825</span>
        <span class="s1">ts = Timestamp(</span><span class="s3">&quot;2016-01-01 09:00:00&quot;</span><span class="s1">)</span>
        <span class="s1">result = ts.replace(hour=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">expected = Timestamp(</span><span class="s3">&quot;2016-01-01 00:00:00&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s0">def </span><span class="s1">test_replace_aware(self</span><span class="s0">, </span><span class="s1">tz_aware_fixture):</span>
        <span class="s1">tz = tz_aware_fixture</span>
        <span class="s2"># GH#14621, GH#7825</span>
        <span class="s2"># replacing datetime components with and w/o presence of a timezone</span>
        <span class="s1">ts = Timestamp(</span><span class="s3">&quot;2016-01-01 09:00:00&quot;</span><span class="s0">, </span><span class="s1">tz=tz)</span>
        <span class="s1">result = ts.replace(hour=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">expected = Timestamp(</span><span class="s3">&quot;2016-01-01 00:00:00&quot;</span><span class="s0">, </span><span class="s1">tz=tz)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s0">def </span><span class="s1">test_replace_preserves_nanos(self</span><span class="s0">, </span><span class="s1">tz_aware_fixture):</span>
        <span class="s1">tz = tz_aware_fixture</span>
        <span class="s2"># GH#14621, GH#7825</span>
        <span class="s1">ts = Timestamp(</span><span class="s3">&quot;2016-01-01 09:00:00.000000123&quot;</span><span class="s0">, </span><span class="s1">tz=tz)</span>
        <span class="s1">result = ts.replace(hour=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">expected = Timestamp(</span><span class="s3">&quot;2016-01-01 00:00:00.000000123&quot;</span><span class="s0">, </span><span class="s1">tz=tz)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s0">def </span><span class="s1">test_replace_multiple(self</span><span class="s0">, </span><span class="s1">tz_aware_fixture):</span>
        <span class="s1">tz = tz_aware_fixture</span>
        <span class="s2"># GH#14621, GH#7825</span>
        <span class="s2"># replacing datetime components with and w/o presence of a timezone</span>
        <span class="s2"># test all</span>
        <span class="s1">ts = Timestamp(</span><span class="s3">&quot;2016-01-01 09:00:00.000000123&quot;</span><span class="s0">, </span><span class="s1">tz=tz)</span>
        <span class="s1">result = ts.replace(</span>
            <span class="s1">year=</span><span class="s4">2015</span><span class="s0">,</span>
            <span class="s1">month=</span><span class="s4">2</span><span class="s0">,</span>
            <span class="s1">day=</span><span class="s4">2</span><span class="s0">,</span>
            <span class="s1">hour=</span><span class="s4">0</span><span class="s0">,</span>
            <span class="s1">minute=</span><span class="s4">5</span><span class="s0">,</span>
            <span class="s1">second=</span><span class="s4">5</span><span class="s0">,</span>
            <span class="s1">microsecond=</span><span class="s4">5</span><span class="s0">,</span>
            <span class="s1">nanosecond=</span><span class="s4">5</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">expected = Timestamp(</span><span class="s3">&quot;2015-02-02 00:05:05.000005005&quot;</span><span class="s0">, </span><span class="s1">tz=tz)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s0">def </span><span class="s1">test_replace_invalid_kwarg(self</span><span class="s0">, </span><span class="s1">tz_aware_fixture):</span>
        <span class="s1">tz = tz_aware_fixture</span>
        <span class="s2"># GH#14621, GH#7825</span>
        <span class="s1">ts = Timestamp(</span><span class="s3">&quot;2016-01-01 09:00:00.000000123&quot;</span><span class="s0">, </span><span class="s1">tz=tz)</span>
        <span class="s1">msg = </span><span class="s3">r&quot;replace\(\) got an unexpected keyword argument&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">ts.replace(foo=</span><span class="s4">5</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_replace_integer_args(self</span><span class="s0">, </span><span class="s1">tz_aware_fixture):</span>
        <span class="s1">tz = tz_aware_fixture</span>
        <span class="s2"># GH#14621, GH#7825</span>
        <span class="s1">ts = Timestamp(</span><span class="s3">&quot;2016-01-01 09:00:00.000000123&quot;</span><span class="s0">, </span><span class="s1">tz=tz)</span>
        <span class="s1">msg = </span><span class="s3">&quot;value must be an integer, received &lt;class 'float'&gt; for hour&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">ts.replace(hour=</span><span class="s4">0.1</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_replace_tzinfo_equiv_tz_localize_none(self):</span>
        <span class="s2"># GH#14621, GH#7825</span>
        <span class="s2"># assert conversion to naive is the same as replacing tzinfo with None</span>
        <span class="s1">ts = Timestamp(</span><span class="s3">&quot;2013-11-03 01:59:59.999999-0400&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">ts.tz_localize(</span><span class="s0">None</span><span class="s1">) == ts.replace(tzinfo=</span><span class="s0">None</span><span class="s1">)</span>

    <span class="s1">@td.skip_if_windows</span>
    <span class="s0">def </span><span class="s1">test_replace_tzinfo(self):</span>
        <span class="s2"># GH#15683</span>
        <span class="s1">dt = datetime(</span><span class="s4">2016</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">27</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">tzinfo = pytz.timezone(</span><span class="s3">&quot;CET&quot;</span><span class="s1">).localize(dt</span><span class="s0">, </span><span class="s1">is_dst=</span><span class="s0">False</span><span class="s1">).tzinfo</span>

        <span class="s1">result_dt = dt.replace(tzinfo=tzinfo)</span>
        <span class="s1">result_pd = Timestamp(dt).replace(tzinfo=tzinfo)</span>

        <span class="s2"># datetime.timestamp() converts in the local timezone</span>
        <span class="s0">with </span><span class="s1">tm.set_timezone(</span><span class="s3">&quot;UTC&quot;</span><span class="s1">):</span>
            <span class="s0">assert </span><span class="s1">result_dt.timestamp() == result_pd.timestamp()</span>

        <span class="s0">assert </span><span class="s1">result_dt == result_pd</span>
        <span class="s0">assert </span><span class="s1">result_dt == result_pd.to_pydatetime()</span>

        <span class="s1">result_dt = dt.replace(tzinfo=tzinfo).replace(tzinfo=</span><span class="s0">None</span><span class="s1">)</span>
        <span class="s1">result_pd = Timestamp(dt).replace(tzinfo=tzinfo).replace(tzinfo=</span><span class="s0">None</span><span class="s1">)</span>

        <span class="s2"># datetime.timestamp() converts in the local timezone</span>
        <span class="s0">with </span><span class="s1">tm.set_timezone(</span><span class="s3">&quot;UTC&quot;</span><span class="s1">):</span>
            <span class="s0">assert </span><span class="s1">result_dt.timestamp() == result_pd.timestamp()</span>

        <span class="s0">assert </span><span class="s1">result_dt == result_pd</span>
        <span class="s0">assert </span><span class="s1">result_dt == result_pd.to_pydatetime()</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;tz, normalize&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">(pytz.timezone(</span><span class="s3">&quot;US/Eastern&quot;</span><span class="s1">)</span><span class="s0">, lambda </span><span class="s1">x: x.tzinfo.normalize(x))</span><span class="s0">,</span>
            <span class="s1">(gettz(</span><span class="s3">&quot;US/Eastern&quot;</span><span class="s1">)</span><span class="s0">, lambda </span><span class="s1">x: x)</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_replace_across_dst(self</span><span class="s0">, </span><span class="s1">tz</span><span class="s0">, </span><span class="s1">normalize):</span>
        <span class="s2"># GH#18319 check that 1) timezone is correctly normalized and</span>
        <span class="s2"># 2) that hour is not incorrectly changed by this normalization</span>
        <span class="s1">ts_naive = Timestamp(</span><span class="s3">&quot;2017-12-03 16:03:30&quot;</span><span class="s1">)</span>
        <span class="s1">ts_aware = conversion.localize_pydatetime(ts_naive</span><span class="s0">, </span><span class="s1">tz)</span>

        <span class="s2"># Preliminary sanity-check</span>
        <span class="s0">assert </span><span class="s1">ts_aware == normalize(ts_aware)</span>

        <span class="s2"># Replace across DST boundary</span>
        <span class="s1">ts2 = ts_aware.replace(month=</span><span class="s4">6</span><span class="s1">)</span>

        <span class="s2"># Check that `replace` preserves hour literal</span>
        <span class="s0">assert </span><span class="s1">(ts2.hour</span><span class="s0">, </span><span class="s1">ts2.minute) == (ts_aware.hour</span><span class="s0">, </span><span class="s1">ts_aware.minute)</span>

        <span class="s2"># Check that post-replace object is appropriately normalized</span>
        <span class="s1">ts2b = normalize(ts2)</span>
        <span class="s0">assert </span><span class="s1">ts2 == ts2b</span>

    <span class="s0">def </span><span class="s1">test_replace_dst_border(self):</span>
        <span class="s2"># Gh 7825</span>
        <span class="s1">t = Timestamp(</span><span class="s3">&quot;2013-11-3&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">&quot;America/Chicago&quot;</span><span class="s1">)</span>
        <span class="s1">result = t.replace(hour=</span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">expected = Timestamp(</span><span class="s3">&quot;2013-11-3 03:00:00&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">&quot;America/Chicago&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;fold&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;tz&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;dateutil/Europe/London&quot;</span><span class="s0">, </span><span class="s3">&quot;Europe/London&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_replace_dst_fold(self</span><span class="s0">, </span><span class="s1">fold</span><span class="s0">, </span><span class="s1">tz):</span>
        <span class="s2"># GH 25017</span>
        <span class="s1">d = datetime(</span><span class="s4">2019</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">27</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">30</span><span class="s1">)</span>
        <span class="s1">ts = Timestamp(d</span><span class="s0">, </span><span class="s1">tz=tz)</span>
        <span class="s1">result = ts.replace(hour=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">fold=fold)</span>
        <span class="s1">expected = Timestamp(datetime(</span><span class="s4">2019</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">27</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">30</span><span class="s1">)).tz_localize(</span>
            <span class="s1">tz</span><span class="s0">, </span><span class="s1">ambiguous=</span><span class="s0">not </span><span class="s1">fold</span>
        <span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s2"># --------------------------------------------------------------</span>
    <span class="s2"># Timestamp.normalize</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;arg&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;2013-11-30&quot;</span><span class="s0">, </span><span class="s3">&quot;2013-11-30 12:00:00&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_normalize(self</span><span class="s0">, </span><span class="s1">tz_naive_fixture</span><span class="s0">, </span><span class="s1">arg):</span>
        <span class="s1">tz = tz_naive_fixture</span>
        <span class="s1">ts = Timestamp(arg</span><span class="s0">, </span><span class="s1">tz=tz)</span>
        <span class="s1">result = ts.normalize()</span>
        <span class="s1">expected = Timestamp(</span><span class="s3">&quot;2013-11-30&quot;</span><span class="s0">, </span><span class="s1">tz=tz)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s0">def </span><span class="s1">test_normalize_pre_epoch_dates(self):</span>
        <span class="s2"># GH: 36294</span>
        <span class="s1">result = Timestamp(</span><span class="s3">&quot;1969-01-01 09:00:00&quot;</span><span class="s1">).normalize()</span>
        <span class="s1">expected = Timestamp(</span><span class="s3">&quot;1969-01-01 00:00:00&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s2"># --------------------------------------------------------------</span>

    <span class="s1">@td.skip_if_windows</span>
    <span class="s0">def </span><span class="s1">test_timestamp(self</span><span class="s0">, </span><span class="s1">fixed_now_ts):</span>
        <span class="s2"># GH#17329</span>
        <span class="s2"># tz-naive --&gt; treat it as if it were UTC for purposes of timestamp()</span>
        <span class="s1">ts = fixed_now_ts</span>
        <span class="s1">uts = ts.replace(tzinfo=utc)</span>
        <span class="s0">assert </span><span class="s1">ts.timestamp() == uts.timestamp()</span>

        <span class="s1">tsc = Timestamp(</span><span class="s3">&quot;2014-10-11 11:00:01.12345678&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">&quot;US/Central&quot;</span><span class="s1">)</span>
        <span class="s1">utsc = tsc.tz_convert(</span><span class="s3">&quot;UTC&quot;</span><span class="s1">)</span>

        <span class="s2"># utsc is a different representation of the same time</span>
        <span class="s0">assert </span><span class="s1">tsc.timestamp() == utsc.timestamp()</span>

        <span class="s2"># datetime.timestamp() converts in the local timezone</span>
        <span class="s0">with </span><span class="s1">tm.set_timezone(</span><span class="s3">&quot;UTC&quot;</span><span class="s1">):</span>
            <span class="s2"># should agree with datetime.timestamp method</span>
            <span class="s1">dt = ts.to_pydatetime()</span>
            <span class="s0">assert </span><span class="s1">dt.timestamp() == ts.timestamp()</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;fold&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_replace_preserves_fold(fold):</span>
    <span class="s2"># GH 37610. Check that replace preserves Timestamp fold property</span>
    <span class="s1">tz = gettz(</span><span class="s3">&quot;Europe/Moscow&quot;</span><span class="s1">)</span>

    <span class="s1">ts = Timestamp(year=</span><span class="s4">2009</span><span class="s0">, </span><span class="s1">month=</span><span class="s4">10</span><span class="s0">, </span><span class="s1">day=</span><span class="s4">25</span><span class="s0">, </span><span class="s1">hour=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">minute=</span><span class="s4">30</span><span class="s0">, </span><span class="s1">fold=fold</span><span class="s0">, </span><span class="s1">tzinfo=tz)</span>
    <span class="s1">ts_replaced = ts.replace(second=</span><span class="s4">1</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">ts_replaced.fold == fold</span>
</pre>
</body>
</html>