<html>
<head>
<title>test_arithmetics.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #629755; font-style: italic;}
.s4 { color: #808080;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_arithmetics.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">operator</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas.compat </span><span class="s0">import </span><span class="s1">np_version_under1p20</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">import </span><span class="s1">pandas._testing </span><span class="s0">as </span><span class="s1">tm</span>
<span class="s0">from </span><span class="s1">pandas.core </span><span class="s0">import </span><span class="s1">ops</span>
<span class="s0">from </span><span class="s1">pandas.core.arrays.sparse </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">SparseArray</span><span class="s0">,</span>
    <span class="s1">SparseDtype</span><span class="s0">,</span>
<span class="s1">)</span>


<span class="s1">@pytest.fixture(params=[</span><span class="s2">&quot;integer&quot;</span><span class="s0">, </span><span class="s2">&quot;block&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">kind(request):</span>
    <span class="s3">&quot;&quot;&quot;kind kwarg to pass to SparseArray/SparseSeries&quot;&quot;&quot;</span>
    <span class="s0">return </span><span class="s1">request.param</span>


<span class="s1">@pytest.fixture(params=[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">mix(request):</span>
    <span class="s4"># whether to operate op(sparse, dense) instead of op(sparse, sparse)</span>
    <span class="s0">return </span><span class="s1">request.param</span>


<span class="s0">class </span><span class="s1">TestSparseArrayArithmetics:</span>

    <span class="s1">_base = np.array</span>
    <span class="s1">_klass = SparseArray</span>

    <span class="s0">def </span><span class="s1">_assert(self</span><span class="s0">, </span><span class="s1">a</span><span class="s0">, </span><span class="s1">b):</span>
        <span class="s4"># We have to use tm.assert_sp_array_equal. See GH #45126</span>
        <span class="s1">tm.assert_numpy_array_equal(a</span><span class="s0">, </span><span class="s1">b)</span>

    <span class="s0">def </span><span class="s1">_check_numeric_ops(self</span><span class="s0">, </span><span class="s1">a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">a_dense</span><span class="s0">, </span><span class="s1">b_dense</span><span class="s0">, </span><span class="s1">mix: bool</span><span class="s0">, </span><span class="s1">op):</span>
        <span class="s4"># Check that arithmetic behavior matches non-Sparse Series arithmetic</span>

        <span class="s0">if </span><span class="s1">isinstance(a_dense</span><span class="s0">, </span><span class="s1">np.ndarray):</span>
            <span class="s1">expected = op(pd.Series(a_dense)</span><span class="s0">, </span><span class="s1">b_dense).values</span>
        <span class="s0">elif </span><span class="s1">isinstance(b_dense</span><span class="s0">, </span><span class="s1">np.ndarray):</span>
            <span class="s1">expected = op(a_dense</span><span class="s0">, </span><span class="s1">pd.Series(b_dense)).values</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">raise </span><span class="s1">NotImplementedError</span>

        <span class="s0">with </span><span class="s1">np.errstate(invalid=</span><span class="s2">&quot;ignore&quot;</span><span class="s0">, </span><span class="s1">divide=</span><span class="s2">&quot;ignore&quot;</span><span class="s1">):</span>
            <span class="s0">if </span><span class="s1">mix:</span>
                <span class="s1">result = op(a</span><span class="s0">, </span><span class="s1">b_dense).to_dense()</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">result = op(a</span><span class="s0">, </span><span class="s1">b).to_dense()</span>

        <span class="s1">self._assert(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">_check_bool_result(self</span><span class="s0">, </span><span class="s1">res):</span>
        <span class="s0">assert </span><span class="s1">isinstance(res</span><span class="s0">, </span><span class="s1">self._klass)</span>
        <span class="s0">assert </span><span class="s1">isinstance(res.dtype</span><span class="s0">, </span><span class="s1">SparseDtype)</span>
        <span class="s0">assert </span><span class="s1">res.dtype.subtype == np.bool_</span>
        <span class="s0">assert </span><span class="s1">isinstance(res.fill_value</span><span class="s0">, </span><span class="s1">bool)</span>

    <span class="s0">def </span><span class="s1">_check_comparison_ops(self</span><span class="s0">, </span><span class="s1">a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">a_dense</span><span class="s0">, </span><span class="s1">b_dense):</span>
        <span class="s0">with </span><span class="s1">np.errstate(invalid=</span><span class="s2">&quot;ignore&quot;</span><span class="s1">):</span>
            <span class="s4"># Unfortunately, trying to wrap the computation of each expected</span>
            <span class="s4"># value is with np.errstate() is too tedious.</span>
            <span class="s4">#</span>
            <span class="s4"># sparse &amp; sparse</span>
            <span class="s1">self._check_bool_result(a == b)</span>
            <span class="s1">self._assert((a == b).to_dense()</span><span class="s0">, </span><span class="s1">a_dense == b_dense)</span>

            <span class="s1">self._check_bool_result(a != b)</span>
            <span class="s1">self._assert((a != b).to_dense()</span><span class="s0">, </span><span class="s1">a_dense != b_dense)</span>

            <span class="s1">self._check_bool_result(a &gt;= b)</span>
            <span class="s1">self._assert((a &gt;= b).to_dense()</span><span class="s0">, </span><span class="s1">a_dense &gt;= b_dense)</span>

            <span class="s1">self._check_bool_result(a &lt;= b)</span>
            <span class="s1">self._assert((a &lt;= b).to_dense()</span><span class="s0">, </span><span class="s1">a_dense &lt;= b_dense)</span>

            <span class="s1">self._check_bool_result(a &gt; b)</span>
            <span class="s1">self._assert((a &gt; b).to_dense()</span><span class="s0">, </span><span class="s1">a_dense &gt; b_dense)</span>

            <span class="s1">self._check_bool_result(a &lt; b)</span>
            <span class="s1">self._assert((a &lt; b).to_dense()</span><span class="s0">, </span><span class="s1">a_dense &lt; b_dense)</span>

            <span class="s4"># sparse &amp; dense</span>
            <span class="s1">self._check_bool_result(a == b_dense)</span>
            <span class="s1">self._assert((a == b_dense).to_dense()</span><span class="s0">, </span><span class="s1">a_dense == b_dense)</span>

            <span class="s1">self._check_bool_result(a != b_dense)</span>
            <span class="s1">self._assert((a != b_dense).to_dense()</span><span class="s0">, </span><span class="s1">a_dense != b_dense)</span>

            <span class="s1">self._check_bool_result(a &gt;= b_dense)</span>
            <span class="s1">self._assert((a &gt;= b_dense).to_dense()</span><span class="s0">, </span><span class="s1">a_dense &gt;= b_dense)</span>

            <span class="s1">self._check_bool_result(a &lt;= b_dense)</span>
            <span class="s1">self._assert((a &lt;= b_dense).to_dense()</span><span class="s0">, </span><span class="s1">a_dense &lt;= b_dense)</span>

            <span class="s1">self._check_bool_result(a &gt; b_dense)</span>
            <span class="s1">self._assert((a &gt; b_dense).to_dense()</span><span class="s0">, </span><span class="s1">a_dense &gt; b_dense)</span>

            <span class="s1">self._check_bool_result(a &lt; b_dense)</span>
            <span class="s1">self._assert((a &lt; b_dense).to_dense()</span><span class="s0">, </span><span class="s1">a_dense &lt; b_dense)</span>

    <span class="s0">def </span><span class="s1">_check_logical_ops(self</span><span class="s0">, </span><span class="s1">a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">a_dense</span><span class="s0">, </span><span class="s1">b_dense):</span>
        <span class="s4"># sparse &amp; sparse</span>
        <span class="s1">self._check_bool_result(a &amp; b)</span>
        <span class="s1">self._assert((a &amp; b).to_dense()</span><span class="s0">, </span><span class="s1">a_dense &amp; b_dense)</span>

        <span class="s1">self._check_bool_result(a | b)</span>
        <span class="s1">self._assert((a | b).to_dense()</span><span class="s0">, </span><span class="s1">a_dense | b_dense)</span>
        <span class="s4"># sparse &amp; dense</span>
        <span class="s1">self._check_bool_result(a &amp; b_dense)</span>
        <span class="s1">self._assert((a &amp; b_dense).to_dense()</span><span class="s0">, </span><span class="s1">a_dense &amp; b_dense)</span>

        <span class="s1">self._check_bool_result(a | b_dense)</span>
        <span class="s1">self._assert((a | b_dense).to_dense()</span><span class="s0">, </span><span class="s1">a_dense | b_dense)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;scalar&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">3</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;fill_value&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">2</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_float_scalar(</span>
        <span class="s1">self</span><span class="s0">, </span><span class="s1">kind</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">all_arithmetic_functions</span><span class="s0">, </span><span class="s1">fill_value</span><span class="s0">, </span><span class="s1">scalar</span><span class="s0">, </span><span class="s1">request</span>
    <span class="s1">):</span>
        <span class="s1">op = all_arithmetic_functions</span>

        <span class="s0">if </span><span class="s1">np_version_under1p20:</span>
            <span class="s0">if </span><span class="s1">op </span><span class="s0">in </span><span class="s1">[operator.floordiv</span><span class="s0">, </span><span class="s1">ops.rfloordiv]:</span>
                <span class="s0">if </span><span class="s1">op </span><span class="s0">is </span><span class="s1">operator.floordiv </span><span class="s0">and </span><span class="s1">scalar != </span><span class="s5">0</span><span class="s1">:</span>
                    <span class="s0">pass</span>
                <span class="s0">elif </span><span class="s1">op </span><span class="s0">is </span><span class="s1">ops.rfloordiv </span><span class="s0">and </span><span class="s1">scalar == </span><span class="s5">0</span><span class="s1">:</span>
                    <span class="s0">pass</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">mark = pytest.mark.xfail(raises=AssertionError</span><span class="s0">, </span><span class="s1">reason=</span><span class="s2">&quot;GH#38172&quot;</span><span class="s1">)</span>
                    <span class="s1">request.node.add_marker(mark)</span>

        <span class="s1">values = self._base([np.nan</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s1">np.nan])</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=fill_value)</span>
        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">scalar</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">scalar</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>

    <span class="s0">def </span><span class="s1">test_float_scalar_comparison(self</span><span class="s0">, </span><span class="s1">kind):</span>
        <span class="s1">values = self._base([np.nan</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s1">np.nan])</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s5">3</span><span class="s1">)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s5">3</span><span class="s1">)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s5">3</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_float_same_index_without_nans(self</span><span class="s0">, </span><span class="s1">kind</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">all_arithmetic_functions):</span>
        <span class="s4"># when sp_index are the same</span>
        <span class="s1">op = all_arithmetic_functions</span>

        <span class="s1">values = self._base([</span><span class="s5">0.0</span><span class="s0">, </span><span class="s5">1.0</span><span class="s0">, </span><span class="s5">2.0</span><span class="s0">, </span><span class="s5">6.0</span><span class="s0">, </span><span class="s5">0.0</span><span class="s0">, </span><span class="s5">0.0</span><span class="s0">, </span><span class="s5">1.0</span><span class="s0">, </span><span class="s5">2.0</span><span class="s0">, </span><span class="s5">1.0</span><span class="s0">, </span><span class="s5">0.0</span><span class="s1">])</span>
        <span class="s1">rvalues = self._base([</span><span class="s5">0.0</span><span class="s0">, </span><span class="s5">2.0</span><span class="s0">, </span><span class="s5">3.0</span><span class="s0">, </span><span class="s5">4.0</span><span class="s0">, </span><span class="s5">0.0</span><span class="s0">, </span><span class="s5">0.0</span><span class="s0">, </span><span class="s5">1.0</span><span class="s0">, </span><span class="s5">3.0</span><span class="s0">, </span><span class="s5">2.0</span><span class="s0">, </span><span class="s5">0.0</span><span class="s1">])</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>

    <span class="s0">def </span><span class="s1">test_float_same_index_with_nans(</span>
        <span class="s1">self</span><span class="s0">, </span><span class="s1">kind</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">all_arithmetic_functions</span><span class="s0">, </span><span class="s1">request</span>
    <span class="s1">):</span>
        <span class="s4"># when sp_index are the same</span>
        <span class="s1">op = all_arithmetic_functions</span>

        <span class="s0">if </span><span class="s1">(</span>
            <span class="s1">np_version_under1p20</span>
            <span class="s0">and </span><span class="s1">op </span><span class="s0">is </span><span class="s1">ops.rfloordiv</span>
            <span class="s0">and not </span><span class="s1">(mix </span><span class="s0">and </span><span class="s1">kind == </span><span class="s2">&quot;block&quot;</span><span class="s1">)</span>
        <span class="s1">):</span>
            <span class="s1">mark = pytest.mark.xfail(raises=AssertionError</span><span class="s0">, </span><span class="s1">reason=</span><span class="s2">&quot;GH#38172&quot;</span><span class="s1">)</span>
            <span class="s1">request.node.add_marker(mark)</span>
        <span class="s1">values = self._base([np.nan</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s1">np.nan])</span>
        <span class="s1">rvalues = self._base([np.nan</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s5">4</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s1">np.nan])</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>

    <span class="s0">def </span><span class="s1">test_float_same_index_comparison(self</span><span class="s0">, </span><span class="s1">kind):</span>
        <span class="s4"># when sp_index are the same</span>
        <span class="s1">values = self._base([np.nan</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s1">np.nan])</span>
        <span class="s1">rvalues = self._base([np.nan</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s5">4</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s1">np.nan])</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues)</span>

        <span class="s1">values = self._base([</span><span class="s5">0.0</span><span class="s0">, </span><span class="s5">1.0</span><span class="s0">, </span><span class="s5">2.0</span><span class="s0">, </span><span class="s5">6.0</span><span class="s0">, </span><span class="s5">0.0</span><span class="s0">, </span><span class="s5">0.0</span><span class="s0">, </span><span class="s5">1.0</span><span class="s0">, </span><span class="s5">2.0</span><span class="s0">, </span><span class="s5">1.0</span><span class="s0">, </span><span class="s5">0.0</span><span class="s1">])</span>
        <span class="s1">rvalues = self._base([</span><span class="s5">0.0</span><span class="s0">, </span><span class="s5">2.0</span><span class="s0">, </span><span class="s5">3.0</span><span class="s0">, </span><span class="s5">4.0</span><span class="s0">, </span><span class="s5">0.0</span><span class="s0">, </span><span class="s5">0.0</span><span class="s0">, </span><span class="s5">1.0</span><span class="s0">, </span><span class="s5">3.0</span><span class="s0">, </span><span class="s5">2.0</span><span class="s0">, </span><span class="s5">0.0</span><span class="s1">])</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues)</span>

    <span class="s0">def </span><span class="s1">test_float_array(self</span><span class="s0">, </span><span class="s1">kind</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">all_arithmetic_functions):</span>
        <span class="s1">op = all_arithmetic_functions</span>

        <span class="s1">values = self._base([np.nan</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s1">np.nan])</span>
        <span class="s1">rvalues = self._base([</span><span class="s5">2</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">5</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s1">np.nan])</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>
        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b * </span><span class="s5">0</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues * </span><span class="s5">0</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>

    <span class="s0">def </span><span class="s1">test_float_array_different_kind(self</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">all_arithmetic_functions):</span>
        <span class="s1">op = all_arithmetic_functions</span>

        <span class="s1">values = self._base([np.nan</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s1">np.nan])</span>
        <span class="s1">rvalues = self._base([</span><span class="s5">2</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">5</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s1">np.nan])</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;integer&quot;</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;block&quot;</span><span class="s1">)</span>
        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>
        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b * </span><span class="s5">0</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues * </span><span class="s5">0</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;integer&quot;</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;block&quot;</span><span class="s1">)</span>
        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;integer&quot;</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;block&quot;</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;integer&quot;</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;block&quot;</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>

    <span class="s0">def </span><span class="s1">test_float_array_comparison(self</span><span class="s0">, </span><span class="s1">kind):</span>
        <span class="s1">values = self._base([np.nan</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s1">np.nan])</span>
        <span class="s1">rvalues = self._base([</span><span class="s5">2</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">5</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s1">np.nan])</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s1">b * </span><span class="s5">0</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues * </span><span class="s5">0</span><span class="s1">)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues)</span>

    <span class="s0">def </span><span class="s1">test_int_array(self</span><span class="s0">, </span><span class="s1">kind</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">all_arithmetic_functions):</span>
        <span class="s1">op = all_arithmetic_functions</span>

        <span class="s4"># have to specify dtype explicitly until fixing GH 667</span>
        <span class="s1">dtype = np.int64</span>

        <span class="s1">values = self._base([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
        <span class="s1">rvalues = self._base([</span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">5</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">dtype=dtype</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s0">assert </span><span class="s1">a.dtype == SparseDtype(dtype)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">dtype=dtype</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s0">assert </span><span class="s1">b.dtype == SparseDtype(dtype)</span>

        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>
        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b * </span><span class="s5">0</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues * </span><span class="s5">0</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s0">, </span><span class="s1">dtype=dtype</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s0">assert </span><span class="s1">a.dtype == SparseDtype(dtype)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">dtype=dtype</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s0">assert </span><span class="s1">b.dtype == SparseDtype(dtype)</span>

        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s0">, </span><span class="s1">dtype=dtype</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s0">assert </span><span class="s1">a.dtype == SparseDtype(dtype)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s0">, </span><span class="s1">dtype=dtype</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s0">assert </span><span class="s1">b.dtype == SparseDtype(dtype)</span>
        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">1</span><span class="s0">, </span><span class="s1">dtype=dtype</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s0">assert </span><span class="s1">a.dtype == SparseDtype(dtype</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">2</span><span class="s0">, </span><span class="s1">dtype=dtype</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s0">assert </span><span class="s1">b.dtype == SparseDtype(dtype</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>

    <span class="s0">def </span><span class="s1">test_int_array_comparison(self</span><span class="s0">, </span><span class="s1">kind):</span>
        <span class="s1">dtype = </span><span class="s2">&quot;int64&quot;</span>
        <span class="s4"># int32 NI ATM</span>

        <span class="s1">values = self._base([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
        <span class="s1">rvalues = self._base([</span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">5</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">dtype=dtype</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">dtype=dtype</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s1">b * </span><span class="s5">0</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues * </span><span class="s5">0</span><span class="s1">)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">dtype=dtype</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">dtype=dtype</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">dtype=dtype</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">dtype=dtype</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">dtype=dtype</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">dtype=dtype</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;fill_value&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False, </span><span class="s1">np.nan])</span>
    <span class="s0">def </span><span class="s1">test_bool_same_index(self</span><span class="s0">, </span><span class="s1">kind</span><span class="s0">, </span><span class="s1">fill_value):</span>
        <span class="s4"># GH 14000</span>
        <span class="s4"># when sp_index are the same</span>
        <span class="s1">values = self._base([</span><span class="s0">True, False, True, True</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.bool_)</span>
        <span class="s1">rvalues = self._base([</span><span class="s0">True, False, True, True</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.bool_)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">dtype=np.bool_</span><span class="s0">, </span><span class="s1">fill_value=fill_value)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">dtype=np.bool_</span><span class="s0">, </span><span class="s1">fill_value=fill_value)</span>
        <span class="s1">self._check_logical_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;fill_value&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False, </span><span class="s1">np.nan])</span>
    <span class="s0">def </span><span class="s1">test_bool_array_logical(self</span><span class="s0">, </span><span class="s1">kind</span><span class="s0">, </span><span class="s1">fill_value):</span>
        <span class="s4"># GH 14000</span>
        <span class="s4"># when sp_index are the same</span>
        <span class="s1">values = self._base([</span><span class="s0">True, False, True, False, True, True</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.bool_)</span>
        <span class="s1">rvalues = self._base([</span><span class="s0">True, False, False, True, False, True</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.bool_)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">dtype=np.bool_</span><span class="s0">, </span><span class="s1">fill_value=fill_value)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">dtype=np.bool_</span><span class="s0">, </span><span class="s1">fill_value=fill_value)</span>
        <span class="s1">self._check_logical_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues)</span>

    <span class="s0">def </span><span class="s1">test_mixed_array_float_int(self</span><span class="s0">, </span><span class="s1">kind</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">all_arithmetic_functions</span><span class="s0">, </span><span class="s1">request):</span>
        <span class="s1">op = all_arithmetic_functions</span>

        <span class="s0">if </span><span class="s1">np_version_under1p20 </span><span class="s0">and </span><span class="s1">op </span><span class="s0">in </span><span class="s1">[operator.floordiv</span><span class="s0">, </span><span class="s1">ops.rfloordiv] </span><span class="s0">and </span><span class="s1">mix:</span>
            <span class="s1">mark = pytest.mark.xfail(raises=AssertionError</span><span class="s0">, </span><span class="s1">reason=</span><span class="s2">&quot;GH#38172&quot;</span><span class="s1">)</span>
            <span class="s1">request.node.add_marker(mark)</span>

        <span class="s1">rdtype = </span><span class="s2">&quot;int64&quot;</span>

        <span class="s1">values = self._base([np.nan</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s1">np.nan])</span>
        <span class="s1">rvalues = self._base([</span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">5</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=rdtype)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s0">assert </span><span class="s1">b.dtype == SparseDtype(rdtype)</span>

        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>
        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b * </span><span class="s5">0</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues * </span><span class="s5">0</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s0">assert </span><span class="s1">b.dtype == SparseDtype(rdtype)</span>
        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">b.dtype == SparseDtype(rdtype)</span>
        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">2</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">b.dtype == SparseDtype(rdtype</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">self._check_numeric_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues</span><span class="s0">, </span><span class="s1">mix</span><span class="s0">, </span><span class="s1">op)</span>

    <span class="s0">def </span><span class="s1">test_mixed_array_comparison(self</span><span class="s0">, </span><span class="s1">kind):</span>
        <span class="s1">rdtype = </span><span class="s2">&quot;int64&quot;</span>
        <span class="s4"># int32 NI ATM</span>

        <span class="s1">values = self._base([np.nan</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s1">np.nan])</span>
        <span class="s1">rvalues = self._base([</span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">5</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=rdtype)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s0">assert </span><span class="s1">b.dtype == SparseDtype(rdtype)</span>

        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s1">b * </span><span class="s5">0</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues * </span><span class="s5">0</span><span class="s1">)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind)</span>
        <span class="s0">assert </span><span class="s1">b.dtype == SparseDtype(rdtype)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">b.dtype == SparseDtype(rdtype)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues)</span>

        <span class="s1">a = self._klass(values</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">b = self._klass(rvalues</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">2</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">b.dtype == SparseDtype(rdtype</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">self._check_comparison_ops(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">rvalues)</span>

    <span class="s0">def </span><span class="s1">test_xor(self):</span>
        <span class="s1">s = SparseArray([</span><span class="s0">True, True, False, False</span><span class="s1">])</span>
        <span class="s1">t = SparseArray([</span><span class="s0">True, False, True, False</span><span class="s1">])</span>
        <span class="s1">result = s ^ t</span>
        <span class="s1">sp_index = pd.core.arrays.sparse.IntIndex(</span><span class="s5">4</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;int32&quot;</span><span class="s1">))</span>
        <span class="s1">expected = SparseArray([</span><span class="s0">False, True, True</span><span class="s1">]</span><span class="s0">, </span><span class="s1">sparse_index=sp_index)</span>
        <span class="s1">tm.assert_sp_array_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;op&quot;</span><span class="s0">, </span><span class="s1">[operator.eq</span><span class="s0">, </span><span class="s1">operator.add])</span>
<span class="s0">def </span><span class="s1">test_with_list(op):</span>
    <span class="s1">arr = SparseArray([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
    <span class="s1">result = op(arr</span><span class="s0">, </span><span class="s1">[</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s1">])</span>
    <span class="s1">expected = op(arr</span><span class="s0">, </span><span class="s1">SparseArray([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s1">]))</span>
    <span class="s1">tm.assert_sp_array_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_with_dataframe():</span>
    <span class="s4"># GH#27910</span>
    <span class="s1">arr = SparseArray([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
    <span class="s1">df = pd.DataFrame([[</span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">3</span><span class="s0">, </span><span class="s5">4</span><span class="s1">]])</span>
    <span class="s1">result = arr.__add__(df)</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s0">is </span><span class="s1">NotImplemented</span>


<span class="s0">def </span><span class="s1">test_with_zerodim_ndarray():</span>
    <span class="s4"># GH#27910</span>
    <span class="s1">arr = SparseArray([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>

    <span class="s1">result = arr * np.array(</span><span class="s5">2</span><span class="s1">)</span>
    <span class="s1">expected = arr * </span><span class="s5">2</span>
    <span class="s1">tm.assert_sp_array_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;ufunc&quot;</span><span class="s0">, </span><span class="s1">[np.abs</span><span class="s0">, </span><span class="s1">np.exp])</span>
<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;arr&quot;</span><span class="s0">, </span><span class="s1">[SparseArray([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s1">-</span><span class="s5">1</span><span class="s0">, </span><span class="s5">1</span><span class="s1">])</span><span class="s0">, </span><span class="s1">SparseArray([</span><span class="s0">None, None, </span><span class="s1">-</span><span class="s5">1</span><span class="s0">, </span><span class="s5">1</span><span class="s1">])]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_ufuncs(ufunc</span><span class="s0">, </span><span class="s1">arr):</span>
    <span class="s1">result = ufunc(arr)</span>
    <span class="s1">fill_value = ufunc(arr.fill_value)</span>
    <span class="s1">expected = SparseArray(ufunc(np.asarray(arr))</span><span class="s0">, </span><span class="s1">fill_value=fill_value)</span>
    <span class="s1">tm.assert_sp_array_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;a, b&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(SparseArray([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s1">])</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s1">]))</span><span class="s0">,</span>
        <span class="s1">(SparseArray([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s1">]))</span><span class="s0">,</span>
        <span class="s1">(SparseArray([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s1">]))</span><span class="s0">,</span>
        <span class="s1">(SparseArray([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s1">]))</span><span class="s0">,</span>
        <span class="s1">(SparseArray([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s1">]))</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;ufunc&quot;</span><span class="s0">, </span><span class="s1">[np.add</span><span class="s0">, </span><span class="s1">np.greater])</span>
<span class="s0">def </span><span class="s1">test_binary_ufuncs(ufunc</span><span class="s0">, </span><span class="s1">a</span><span class="s0">, </span><span class="s1">b):</span>
    <span class="s4"># can't say anything about fill value here.</span>
    <span class="s1">result = ufunc(a</span><span class="s0">, </span><span class="s1">b)</span>
    <span class="s1">expected = ufunc(np.asarray(a)</span><span class="s0">, </span><span class="s1">np.asarray(b))</span>
    <span class="s0">assert </span><span class="s1">isinstance(result</span><span class="s0">, </span><span class="s1">SparseArray)</span>
    <span class="s1">tm.assert_numpy_array_equal(np.asarray(result)</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_ndarray_inplace():</span>
    <span class="s1">sparray = SparseArray([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s1">])</span>
    <span class="s1">ndarray = np.array([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s1">])</span>
    <span class="s1">ndarray += sparray</span>
    <span class="s1">expected = np.array([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s1">])</span>
    <span class="s1">tm.assert_numpy_array_equal(ndarray</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_sparray_inplace():</span>
    <span class="s1">sparray = SparseArray([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s1">])</span>
    <span class="s1">ndarray = np.array([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s1">])</span>
    <span class="s1">sparray += ndarray</span>
    <span class="s1">expected = SparseArray([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s5">0</span><span class="s1">)</span>
    <span class="s1">tm.assert_sp_array_equal(sparray</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;fill_value&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_invert(fill_value):</span>
    <span class="s1">arr = np.array([</span><span class="s0">True, False, False, True</span><span class="s1">])</span>
    <span class="s1">sparray = SparseArray(arr</span><span class="s0">, </span><span class="s1">fill_value=fill_value)</span>
    <span class="s1">result = ~sparray</span>
    <span class="s1">expected = SparseArray(~arr</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s0">not </span><span class="s1">fill_value)</span>
    <span class="s1">tm.assert_sp_array_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ~pd.Series(sparray)</span>
    <span class="s1">expected = pd.Series(expected)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ~pd.DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: sparray})</span>
    <span class="s1">expected = pd.DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: expected})</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;fill_value&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s5">0</span><span class="s0">, </span><span class="s1">np.nan])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;op&quot;</span><span class="s0">, </span><span class="s1">[operator.pos</span><span class="s0">, </span><span class="s1">operator.neg])</span>
<span class="s0">def </span><span class="s1">test_unary_op(op</span><span class="s0">, </span><span class="s1">fill_value):</span>
    <span class="s1">arr = np.array([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s5">2</span><span class="s1">])</span>
    <span class="s1">sparray = SparseArray(arr</span><span class="s0">, </span><span class="s1">fill_value=fill_value)</span>
    <span class="s1">result = op(sparray)</span>
    <span class="s1">expected = SparseArray(op(arr)</span><span class="s0">, </span><span class="s1">fill_value=op(fill_value))</span>
    <span class="s1">tm.assert_sp_array_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;cons&quot;</span><span class="s0">, </span><span class="s1">[list</span><span class="s0">, </span><span class="s1">np.array</span><span class="s0">, </span><span class="s1">SparseArray])</span>
<span class="s0">def </span><span class="s1">test_mismatched_length_cmp_op(cons):</span>
    <span class="s1">left = SparseArray([</span><span class="s0">True, True</span><span class="s1">])</span>
    <span class="s1">right = cons([</span><span class="s0">True, True, True</span><span class="s1">])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;operands have mismatched length&quot;</span><span class="s1">):</span>
        <span class="s1">left &amp; right</span>
</pre>
</body>
</html>