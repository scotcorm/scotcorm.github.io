<html>
<head>
<title>test_index_new.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6a8759;}
.s4 { color: #808080;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_index_new.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Tests for the Index constructor conducting inference. 
&quot;&quot;&quot;</span>
<span class="s2">from </span><span class="s1">datetime </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">datetime</span><span class="s2">,</span>
    <span class="s1">timedelta</span><span class="s2">,</span>
<span class="s1">)</span>
<span class="s2">from </span><span class="s1">decimal </span><span class="s2">import </span><span class="s1">Decimal</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">import </span><span class="s1">pytest</span>

<span class="s2">from </span><span class="s1">pandas.core.dtypes.common </span><span class="s2">import </span><span class="s1">is_unsigned_integer_dtype</span>

<span class="s2">from </span><span class="s1">pandas </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">NA</span><span class="s2">,</span>
    <span class="s1">Categorical</span><span class="s2">,</span>
    <span class="s1">CategoricalIndex</span><span class="s2">,</span>
    <span class="s1">DatetimeIndex</span><span class="s2">,</span>
    <span class="s1">Index</span><span class="s2">,</span>
    <span class="s1">IntervalIndex</span><span class="s2">,</span>
    <span class="s1">MultiIndex</span><span class="s2">,</span>
    <span class="s1">NaT</span><span class="s2">,</span>
    <span class="s1">PeriodIndex</span><span class="s2">,</span>
    <span class="s1">Series</span><span class="s2">,</span>
    <span class="s1">TimedeltaIndex</span><span class="s2">,</span>
    <span class="s1">Timestamp</span><span class="s2">,</span>
    <span class="s1">array</span><span class="s2">,</span>
    <span class="s1">date_range</span><span class="s2">,</span>
    <span class="s1">period_range</span><span class="s2">,</span>
    <span class="s1">timedelta_range</span><span class="s2">,</span>
<span class="s1">)</span>
<span class="s2">import </span><span class="s1">pandas._testing </span><span class="s2">as </span><span class="s1">tm</span>
<span class="s2">from </span><span class="s1">pandas.core.api </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">Float64Index</span><span class="s2">,</span>
    <span class="s1">Int64Index</span><span class="s2">,</span>
    <span class="s1">UInt64Index</span><span class="s2">,</span>
<span class="s1">)</span>


<span class="s2">class </span><span class="s1">TestIndexConstructorInference:</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;na_value&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s2">None, </span><span class="s1">np.nan])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;vtype&quot;</span><span class="s2">, </span><span class="s1">[list</span><span class="s2">, </span><span class="s1">tuple</span><span class="s2">, </span><span class="s1">iter])</span>
    <span class="s2">def </span><span class="s1">test_construction_list_tuples_nan(self</span><span class="s2">, </span><span class="s1">na_value</span><span class="s2">, </span><span class="s1">vtype):</span>
        <span class="s4"># GH#18505 : valid tuples containing NaN</span>
        <span class="s1">values = [(</span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;two&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s5">3.0</span><span class="s2">, </span><span class="s1">na_value)]</span>
        <span class="s1">result = Index(vtype(values))</span>
        <span class="s1">expected = MultiIndex.from_tuples(values)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;dtype&quot;</span><span class="s2">,</span>
        <span class="s1">[int</span><span class="s2">, </span><span class="s3">&quot;int64&quot;</span><span class="s2">, </span><span class="s3">&quot;int32&quot;</span><span class="s2">, </span><span class="s3">&quot;int16&quot;</span><span class="s2">, </span><span class="s3">&quot;int8&quot;</span><span class="s2">, </span><span class="s3">&quot;uint64&quot;</span><span class="s2">, </span><span class="s3">&quot;uint32&quot;</span><span class="s2">, </span><span class="s3">&quot;uint16&quot;</span><span class="s2">, </span><span class="s3">&quot;uint8&quot;</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_constructor_int_dtype_float(self</span><span class="s2">, </span><span class="s1">dtype):</span>
        <span class="s4"># GH#18400</span>
        <span class="s2">if </span><span class="s1">is_unsigned_integer_dtype(dtype):</span>
            <span class="s1">index_type = UInt64Index</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">index_type = Int64Index</span>

        <span class="s1">expected = index_type([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s1">])</span>
        <span class="s1">result = Index([</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">3.0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=dtype)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;cast_index&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s2">True, False</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;vals&quot;</span><span class="s2">, </span><span class="s1">[[</span><span class="s2">True, False, True</span><span class="s1">]</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s2">True, False, True</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=bool)]</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_constructor_dtypes_to_object(self</span><span class="s2">, </span><span class="s1">cast_index</span><span class="s2">, </span><span class="s1">vals):</span>
        <span class="s2">if </span><span class="s1">cast_index:</span>
            <span class="s1">index = Index(vals</span><span class="s2">, </span><span class="s1">dtype=bool)</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">index = Index(vals)</span>

        <span class="s2">assert </span><span class="s1">type(index) </span><span class="s2">is </span><span class="s1">Index</span>
        <span class="s2">assert </span><span class="s1">index.dtype == object</span>

    <span class="s2">def </span><span class="s1">test_constructor_categorical_to_object(self):</span>
        <span class="s4"># GH#32167 Categorical data and dtype=object should return object-dtype</span>
        <span class="s1">ci = CategoricalIndex(range(</span><span class="s5">5</span><span class="s1">))</span>
        <span class="s1">result = Index(ci</span><span class="s2">, </span><span class="s1">dtype=object)</span>
        <span class="s2">assert not </span><span class="s1">isinstance(result</span><span class="s2">, </span><span class="s1">CategoricalIndex)</span>

    <span class="s2">def </span><span class="s1">test_constructor_infer_periodindex(self):</span>
        <span class="s1">xp = period_range(</span><span class="s3">&quot;2012-1-1&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s5">3</span><span class="s1">)</span>
        <span class="s1">rs = Index(xp)</span>
        <span class="s1">tm.assert_index_equal(rs</span><span class="s2">, </span><span class="s1">xp)</span>
        <span class="s2">assert </span><span class="s1">isinstance(rs</span><span class="s2">, </span><span class="s1">PeriodIndex)</span>

    <span class="s2">def </span><span class="s1">test_from_list_of_periods(self):</span>
        <span class="s1">rng = period_range(</span><span class="s3">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s5">20</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s1">periods = list(rng)</span>

        <span class="s1">result = Index(periods)</span>
        <span class="s2">assert </span><span class="s1">isinstance(result</span><span class="s2">, </span><span class="s1">PeriodIndex)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;pos&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;klass,dtype,ctor&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">(DatetimeIndex</span><span class="s2">, </span><span class="s3">&quot;datetime64[ns]&quot;</span><span class="s2">, </span><span class="s1">np.datetime64(</span><span class="s3">&quot;nat&quot;</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(TimedeltaIndex</span><span class="s2">, </span><span class="s3">&quot;timedelta64[ns]&quot;</span><span class="s2">, </span><span class="s1">np.timedelta64(</span><span class="s3">&quot;nat&quot;</span><span class="s1">))</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_constructor_infer_nat_dt_like(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">klass</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">ctor</span><span class="s2">, </span><span class="s1">nulls_fixture</span><span class="s2">, </span><span class="s1">request</span>
    <span class="s1">):</span>
        <span class="s2">if </span><span class="s1">isinstance(nulls_fixture</span><span class="s2">, </span><span class="s1">Decimal):</span>
            <span class="s4"># We dont cast these to datetime64/timedelta64</span>
            <span class="s2">return</span>

        <span class="s1">expected = klass([NaT</span><span class="s2">, </span><span class="s1">NaT])</span>
        <span class="s2">assert </span><span class="s1">expected.dtype == dtype</span>
        <span class="s1">data = [ctor]</span>
        <span class="s1">data.insert(pos</span><span class="s2">, </span><span class="s1">nulls_fixture)</span>

        <span class="s1">warn = </span><span class="s2">None</span>
        <span class="s2">if </span><span class="s1">nulls_fixture </span><span class="s2">is </span><span class="s1">NA:</span>
            <span class="s1">expected = Index([NA</span><span class="s2">, </span><span class="s1">NaT])</span>
            <span class="s1">mark = pytest.mark.xfail(reason=</span><span class="s3">&quot;Broken with np.NaT ctor; see GH 31884&quot;</span><span class="s1">)</span>
            <span class="s1">request.node.add_marker(mark)</span>
            <span class="s4"># GH#35942 numpy will emit a DeprecationWarning within the</span>
            <span class="s4">#  assert_index_equal calls.  Since we can't do anything</span>
            <span class="s4">#  about it until GH#31884 is fixed, we suppress that warning.</span>
            <span class="s1">warn = DeprecationWarning</span>

        <span class="s1">result = Index(data)</span>

        <span class="s2">with </span><span class="s1">tm.assert_produces_warning(warn):</span>
            <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">result = Index(np.array(data</span><span class="s2">, </span><span class="s1">dtype=object))</span>

        <span class="s2">with </span><span class="s1">tm.assert_produces_warning(warn):</span>
            <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;swap_objs&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s2">True, False</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_constructor_mixed_nat_objs_infers_object(self</span><span class="s2">, </span><span class="s1">swap_objs):</span>
        <span class="s4"># mixed np.datetime64/timedelta64 nat results in object</span>
        <span class="s1">data = [np.datetime64(</span><span class="s3">&quot;nat&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">np.timedelta64(</span><span class="s3">&quot;nat&quot;</span><span class="s1">)]</span>
        <span class="s2">if </span><span class="s1">swap_objs:</span>
            <span class="s1">data = data[::-</span><span class="s5">1</span><span class="s1">]</span>

        <span class="s1">expected = Index(data</span><span class="s2">, </span><span class="s1">dtype=object)</span>
        <span class="s1">tm.assert_index_equal(Index(data)</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">tm.assert_index_equal(Index(np.array(data</span><span class="s2">, </span><span class="s1">dtype=object))</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;swap_objs&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s2">True, False</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_constructor_datetime_and_datetime64(self</span><span class="s2">, </span><span class="s1">swap_objs):</span>
        <span class="s1">data = [Timestamp(</span><span class="s5">2021</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">9</span><span class="s2">, </span><span class="s5">42</span><span class="s1">)</span><span class="s2">, </span><span class="s1">np.datetime64(</span><span class="s3">&quot;now&quot;</span><span class="s1">)]</span>
        <span class="s2">if </span><span class="s1">swap_objs:</span>
            <span class="s1">data = data[::-</span><span class="s5">1</span><span class="s1">]</span>
        <span class="s1">expected = DatetimeIndex(data)</span>

        <span class="s1">tm.assert_index_equal(Index(data)</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">tm.assert_index_equal(Index(np.array(data</span><span class="s2">, </span><span class="s1">dtype=object))</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s2">class </span><span class="s1">TestDtypeEnforced:</span>
    <span class="s4"># check we don't silently ignore the dtype keyword</span>

    <span class="s2">def </span><span class="s1">test_constructor_object_dtype_with_ea_data(self</span><span class="s2">, </span><span class="s1">any_numeric_ea_dtype):</span>
        <span class="s4"># GH#45206</span>
        <span class="s1">arr = array([</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=any_numeric_ea_dtype)</span>

        <span class="s1">idx = Index(arr</span><span class="s2">, </span><span class="s1">dtype=object)</span>
        <span class="s2">assert </span><span class="s1">idx.dtype == object</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;dtype&quot;</span><span class="s2">, </span><span class="s1">[object</span><span class="s2">, </span><span class="s3">&quot;float64&quot;</span><span class="s2">, </span><span class="s3">&quot;uint64&quot;</span><span class="s2">, </span><span class="s3">&quot;category&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_constructor_range_values_mismatched_dtype(self</span><span class="s2">, </span><span class="s1">dtype):</span>
        <span class="s1">rng = Index(range(</span><span class="s5">5</span><span class="s1">))</span>

        <span class="s1">result = Index(rng</span><span class="s2">, </span><span class="s1">dtype=dtype)</span>
        <span class="s2">assert </span><span class="s1">result.dtype == dtype</span>

        <span class="s1">result = Index(range(</span><span class="s5">5</span><span class="s1">)</span><span class="s2">, </span><span class="s1">dtype=dtype)</span>
        <span class="s2">assert </span><span class="s1">result.dtype == dtype</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;dtype&quot;</span><span class="s2">, </span><span class="s1">[object</span><span class="s2">, </span><span class="s3">&quot;float64&quot;</span><span class="s2">, </span><span class="s3">&quot;uint64&quot;</span><span class="s2">, </span><span class="s3">&quot;category&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_constructor_categorical_values_mismatched_non_ea_dtype(self</span><span class="s2">, </span><span class="s1">dtype):</span>
        <span class="s1">cat = Categorical([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s1">])</span>

        <span class="s1">result = Index(cat</span><span class="s2">, </span><span class="s1">dtype=dtype)</span>
        <span class="s2">assert </span><span class="s1">result.dtype == dtype</span>

    <span class="s2">def </span><span class="s1">test_constructor_categorical_values_mismatched_dtype(self):</span>
        <span class="s1">dti = date_range(</span><span class="s3">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s5">3</span><span class="s1">)</span>
        <span class="s1">cat = Categorical(dti)</span>
        <span class="s1">result = Index(cat</span><span class="s2">, </span><span class="s1">dti.dtype)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">dti)</span>

        <span class="s1">dti2 = dti.tz_localize(</span><span class="s3">&quot;Asia/Tokyo&quot;</span><span class="s1">)</span>
        <span class="s1">cat2 = Categorical(dti2)</span>
        <span class="s1">result = Index(cat2</span><span class="s2">, </span><span class="s1">dti2.dtype)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">dti2)</span>

        <span class="s1">ii = IntervalIndex.from_breaks(range(</span><span class="s5">5</span><span class="s1">))</span>
        <span class="s1">cat3 = Categorical(ii)</span>
        <span class="s1">result = Index(cat3</span><span class="s2">, </span><span class="s1">dtype=ii.dtype)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">ii)</span>

    <span class="s2">def </span><span class="s1">test_constructor_ea_values_mismatched_categorical_dtype(self):</span>
        <span class="s1">dti = date_range(</span><span class="s3">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s5">3</span><span class="s1">)</span>
        <span class="s1">result = Index(dti</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s3">&quot;category&quot;</span><span class="s1">)</span>
        <span class="s1">expected = CategoricalIndex(dti)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">dti2 = date_range(</span><span class="s3">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s5">3</span><span class="s2">, </span><span class="s1">tz=</span><span class="s3">&quot;US/Pacific&quot;</span><span class="s1">)</span>
        <span class="s1">result = Index(dti2</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s3">&quot;category&quot;</span><span class="s1">)</span>
        <span class="s1">expected = CategoricalIndex(dti2)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_constructor_period_values_mismatched_dtype(self):</span>
        <span class="s1">pi = period_range(</span><span class="s3">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s5">3</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s1">result = Index(pi</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s3">&quot;category&quot;</span><span class="s1">)</span>
        <span class="s1">expected = CategoricalIndex(pi)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_constructor_timedelta64_values_mismatched_dtype(self):</span>
        <span class="s4"># check we don't silently ignore the dtype keyword</span>
        <span class="s1">tdi = timedelta_range(</span><span class="s3">&quot;4 Days&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s5">5</span><span class="s1">)</span>
        <span class="s1">result = Index(tdi</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s3">&quot;category&quot;</span><span class="s1">)</span>
        <span class="s1">expected = CategoricalIndex(tdi)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_constructor_interval_values_mismatched_dtype(self):</span>
        <span class="s1">dti = date_range(</span><span class="s3">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s5">3</span><span class="s1">)</span>
        <span class="s1">ii = IntervalIndex.from_breaks(dti)</span>
        <span class="s1">result = Index(ii</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s3">&quot;category&quot;</span><span class="s1">)</span>
        <span class="s1">expected = CategoricalIndex(ii)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_constructor_datetime64_values_mismatched_period_dtype(self):</span>
        <span class="s1">dti = date_range(</span><span class="s3">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s5">3</span><span class="s1">)</span>
        <span class="s1">result = Index(dti</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s3">&quot;Period[D]&quot;</span><span class="s1">)</span>
        <span class="s1">expected = dti.to_period(</span><span class="s3">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;dtype&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;int64&quot;</span><span class="s2">, </span><span class="s3">&quot;uint64&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_constructor_int_dtype_nan_raises(self</span><span class="s2">, </span><span class="s1">dtype):</span>
        <span class="s4"># see GH#15187</span>
        <span class="s1">data = [np.nan]</span>
        <span class="s1">msg = </span><span class="s3">&quot;cannot convert&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">Index(data</span><span class="s2">, </span><span class="s1">dtype=dtype)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;vals&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">np.array([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s1">])</span><span class="s2">,</span>
            <span class="s1">np.array([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=int)</span><span class="s2">,</span>
            <span class="s4"># below should coerce</span>
            <span class="s1">[</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">3.0</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">np.array([</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">3.0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=float)</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_constructor_dtypes_to_int64(self</span><span class="s2">, </span><span class="s1">vals):</span>
        <span class="s1">index = Index(vals</span><span class="s2">, </span><span class="s1">dtype=int)</span>
        <span class="s2">assert </span><span class="s1">isinstance(index</span><span class="s2">, </span><span class="s1">Int64Index)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;vals&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">[</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">3.0</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">np.array([</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">3.0</span><span class="s1">])</span><span class="s2">,</span>
            <span class="s1">np.array([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=int)</span><span class="s2">,</span>
            <span class="s1">np.array([</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">3.0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=float)</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_constructor_dtypes_to_float64(self</span><span class="s2">, </span><span class="s1">vals):</span>
        <span class="s1">index = Index(vals</span><span class="s2">, </span><span class="s1">dtype=float)</span>
        <span class="s2">assert </span><span class="s1">isinstance(index</span><span class="s2">, </span><span class="s1">Float64Index)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;vals&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">np.array([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=int)</span><span class="s2">,</span>
            <span class="s1">np.array([</span><span class="s3">&quot;2011-01-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2011-01-02&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s3">&quot;datetime64[ns]&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">[datetime(</span><span class="s5">2011</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s5">2011</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)]</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_constructor_dtypes_to_categorical(self</span><span class="s2">, </span><span class="s1">vals):</span>
        <span class="s1">index = Index(vals</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s3">&quot;category&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">isinstance(index</span><span class="s2">, </span><span class="s1">CategoricalIndex)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;cast_index&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s2">True, False</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;vals&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">Index(np.array([np.datetime64(</span><span class="s3">&quot;2011-01-01&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">np.datetime64(</span><span class="s3">&quot;2011-01-02&quot;</span><span class="s1">)]))</span><span class="s2">,</span>
            <span class="s1">Index([datetime(</span><span class="s5">2011</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s5">2011</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)])</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_constructor_dtypes_to_datetime(self</span><span class="s2">, </span><span class="s1">cast_index</span><span class="s2">, </span><span class="s1">vals):</span>
        <span class="s2">if </span><span class="s1">cast_index:</span>
            <span class="s1">index = Index(vals</span><span class="s2">, </span><span class="s1">dtype=object)</span>
            <span class="s2">assert </span><span class="s1">isinstance(index</span><span class="s2">, </span><span class="s1">Index)</span>
            <span class="s2">assert </span><span class="s1">index.dtype == object</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">index = Index(vals)</span>
            <span class="s2">assert </span><span class="s1">isinstance(index</span><span class="s2">, </span><span class="s1">DatetimeIndex)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;cast_index&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s2">True, False</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;vals&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">np.array([np.timedelta64(</span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;D&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">np.timedelta64(</span><span class="s5">1</span><span class="s2">, </span><span class="s3">&quot;D&quot;</span><span class="s1">)])</span><span class="s2">,</span>
            <span class="s1">[timedelta(</span><span class="s5">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">timedelta(</span><span class="s5">1</span><span class="s1">)]</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_constructor_dtypes_to_timedelta(self</span><span class="s2">, </span><span class="s1">cast_index</span><span class="s2">, </span><span class="s1">vals):</span>
        <span class="s2">if </span><span class="s1">cast_index:</span>
            <span class="s1">index = Index(vals</span><span class="s2">, </span><span class="s1">dtype=object)</span>
            <span class="s2">assert </span><span class="s1">isinstance(index</span><span class="s2">, </span><span class="s1">Index)</span>
            <span class="s2">assert </span><span class="s1">index.dtype == object</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">index = Index(vals)</span>
            <span class="s2">assert </span><span class="s1">isinstance(index</span><span class="s2">, </span><span class="s1">TimedeltaIndex)</span>


<span class="s2">class </span><span class="s1">TestIndexConstructorUnwrapping:</span>
    <span class="s4"># Test passing different arraylike values to pd.Index</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;klass&quot;</span><span class="s2">, </span><span class="s1">[Index</span><span class="s2">, </span><span class="s1">DatetimeIndex])</span>
    <span class="s2">def </span><span class="s1">test_constructor_from_series_dt64(self</span><span class="s2">, </span><span class="s1">klass):</span>
        <span class="s1">stamps = [Timestamp(</span><span class="s3">&quot;20110101&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">Timestamp(</span><span class="s3">&quot;20120101&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">Timestamp(</span><span class="s3">&quot;20130101&quot;</span><span class="s1">)]</span>
        <span class="s1">expected = DatetimeIndex(stamps)</span>
        <span class="s1">ser = Series(stamps)</span>
        <span class="s1">result = klass(ser)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_constructor_no_pandas_array(self):</span>
        <span class="s1">ser = Series([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s1">])</span>
        <span class="s1">result = Index(ser.array)</span>
        <span class="s1">expected = Index([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s1">])</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;array&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">np.arange(</span><span class="s5">5</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">np.array([</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span><span class="s2">,</span>
            <span class="s1">date_range(</span><span class="s3">&quot;2000-01-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s5">3</span><span class="s1">).values</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_constructor_ndarray_like(self</span><span class="s2">, </span><span class="s1">array):</span>
        <span class="s4"># GH#5460#issuecomment-44474502</span>
        <span class="s4"># it should be possible to convert any object that satisfies the numpy</span>
        <span class="s4"># ndarray interface directly into an Index</span>
        <span class="s2">class </span><span class="s1">ArrayLike:</span>
            <span class="s2">def </span><span class="s1">__init__(self</span><span class="s2">, </span><span class="s1">array):</span>
                <span class="s1">self.array = array</span>

            <span class="s2">def </span><span class="s1">__array__(self</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s2">None</span><span class="s1">) -&gt; np.ndarray:</span>
                <span class="s2">return </span><span class="s1">self.array</span>

        <span class="s1">expected = Index(array)</span>
        <span class="s1">result = Index(ArrayLike(array))</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s2">class </span><span class="s1">TestIndexConstructionErrors:</span>
    <span class="s2">def </span><span class="s1">test_constructor_overflow_int64(self):</span>
        <span class="s4"># see GH#15832</span>
        <span class="s1">msg = (</span>
            <span class="s3">&quot;The elements provided in the data cannot &quot;</span>
            <span class="s3">&quot;all be casted to the dtype int64&quot;</span>
        <span class="s1">)</span>
        <span class="s2">with </span><span class="s1">pytest.raises(OverflowError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">Index([np.iinfo(np.uint64).max - </span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s3">&quot;int64&quot;</span><span class="s1">)</span>
</pre>
</body>
</html>