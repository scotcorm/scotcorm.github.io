<html>
<head>
<title>test_assert_frame_equal.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #629755; font-style: italic;}
.s4 { color: #6897bb;}
.s5 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_assert_frame_equal.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">DataFrame</span>
<span class="s0">import </span><span class="s1">pandas._testing </span><span class="s0">as </span><span class="s1">tm</span>


<span class="s1">@pytest.fixture(params=[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">by_blocks_fixture(request):</span>
    <span class="s0">return </span><span class="s1">request.param</span>


<span class="s1">@pytest.fixture(params=[</span><span class="s2">&quot;DataFrame&quot;</span><span class="s0">, </span><span class="s2">&quot;Series&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">obj_fixture(request):</span>
    <span class="s0">return </span><span class="s1">request.param</span>


<span class="s0">def </span><span class="s1">_assert_frame_equal_both(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">**kwargs):</span>
    <span class="s3">&quot;&quot;&quot; 
    Check that two DataFrame equal. 
 
    This check is performed commutatively. 
 
    Parameters 
    ---------- 
    a : DataFrame 
        The first DataFrame to compare. 
    b : DataFrame 
        The second DataFrame to compare. 
    kwargs : dict 
        The arguments passed to `tm.assert_frame_equal`. 
    &quot;&quot;&quot;</span>
    <span class="s1">tm.assert_frame_equal(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s1">tm.assert_frame_equal(b</span><span class="s0">, </span><span class="s1">a</span><span class="s0">, </span><span class="s1">**kwargs)</span>


<span class="s0">def </span><span class="s1">_assert_not_frame_equal(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">**kwargs):</span>
    <span class="s3">&quot;&quot;&quot; 
    Check that two DataFrame are not equal. 
 
    Parameters 
    ---------- 
    a : DataFrame 
        The first DataFrame to compare. 
    b : DataFrame 
        The second DataFrame to compare. 
    kwargs : dict 
        The arguments passed to `tm.assert_frame_equal`. 
    &quot;&quot;&quot;</span>
    <span class="s1">msg = </span><span class="s2">&quot;The two DataFrames were equal when they shouldn't have been&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.raises(AssertionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">tm.assert_frame_equal(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">**kwargs)</span>


<span class="s0">def </span><span class="s1">_assert_not_frame_equal_both(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">**kwargs):</span>
    <span class="s3">&quot;&quot;&quot; 
    Check that two DataFrame are not equal. 
 
    This check is performed commutatively. 
 
    Parameters 
    ---------- 
    a : DataFrame 
        The first DataFrame to compare. 
    b : DataFrame 
        The second DataFrame to compare. 
    kwargs : dict 
        The arguments passed to `tm.assert_frame_equal`. 
    &quot;&quot;&quot;</span>
    <span class="s1">_assert_not_frame_equal(a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s1">_assert_not_frame_equal(b</span><span class="s0">, </span><span class="s1">a</span><span class="s0">, </span><span class="s1">**kwargs)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;check_like&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_frame_equal_row_order_mismatch(check_like</span><span class="s0">, </span><span class="s1">obj_fixture):</span>
    <span class="s1">df1 = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: [</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">])</span>
    <span class="s1">df2 = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: [</span><span class="s4">6</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">])</span>

    <span class="s0">if not </span><span class="s1">check_like:  </span><span class="s5"># Do not ignore row-column orderings.</span>
        <span class="s1">msg = </span><span class="s2">f&quot;</span><span class="s0">{</span><span class="s1">obj_fixture</span><span class="s0">}</span><span class="s2">.index are different&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(AssertionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">tm.assert_frame_equal(df1</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">check_like=check_like</span><span class="s0">, </span><span class="s1">obj=obj_fixture)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">_assert_frame_equal_both(df1</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">check_like=check_like</span><span class="s0">, </span><span class="s1">obj=obj_fixture)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;df1,df2&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]})</span><span class="s0">, </span><span class="s1">DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]}))</span><span class="s0">,</span>
        <span class="s1">(DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: [</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]})</span><span class="s0">, </span><span class="s1">DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]}))</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_frame_equal_shape_mismatch(df1</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">obj_fixture):</span>
    <span class="s1">msg = </span><span class="s2">f&quot;</span><span class="s0">{</span><span class="s1">obj_fixture</span><span class="s0">} </span><span class="s2">are different&quot;</span>

    <span class="s0">with </span><span class="s1">pytest.raises(AssertionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">tm.assert_frame_equal(df1</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">obj=obj_fixture)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;df1,df2,msg&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s5"># Index</span>
        <span class="s1">(</span>
            <span class="s1">DataFrame.from_records({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">: [</span><span class="s2">&quot;l1&quot;</span><span class="s0">, </span><span class="s2">&quot;l2&quot;</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s2">&quot;a&quot;</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">DataFrame.from_records({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">2.0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">: [</span><span class="s2">&quot;l1&quot;</span><span class="s0">, </span><span class="s2">&quot;l2&quot;</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s2">&quot;a&quot;</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s2">&quot;DataFrame</span><span class="s0">\\</span><span class="s2">.index are different&quot;</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s5"># MultiIndex</span>
        <span class="s1">(</span>
            <span class="s1">DataFrame.from_records(</span>
                <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s4">2.1</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">: [</span><span class="s2">&quot;l1&quot;</span><span class="s0">, </span><span class="s2">&quot;l2&quot;</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">]</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">DataFrame.from_records(</span>
                <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">2.0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s4">2.1</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">: [</span><span class="s2">&quot;l1&quot;</span><span class="s0">, </span><span class="s2">&quot;l2&quot;</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">]</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s2">&quot;MultiIndex level </span><span class="s0">\\</span><span class="s2">[0</span><span class="s0">\\</span><span class="s2">] are different&quot;</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_frame_equal_index_dtype_mismatch(df1</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">msg</span><span class="s0">, </span><span class="s1">check_index_type):</span>
    <span class="s1">kwargs = {</span><span class="s2">&quot;check_index_type&quot;</span><span class="s1">: check_index_type}</span>

    <span class="s0">if </span><span class="s1">check_index_type:</span>
        <span class="s0">with </span><span class="s1">pytest.raises(AssertionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">tm.assert_frame_equal(df1</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">tm.assert_frame_equal(df1</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">**kwargs)</span>


<span class="s0">def </span><span class="s1">test_empty_dtypes(check_dtype):</span>
    <span class="s1">columns = [</span><span class="s2">&quot;col1&quot;</span><span class="s0">, </span><span class="s2">&quot;col2&quot;</span><span class="s1">]</span>
    <span class="s1">df1 = DataFrame(columns=columns)</span>
    <span class="s1">df2 = DataFrame(columns=columns)</span>

    <span class="s1">kwargs = {</span><span class="s2">&quot;check_dtype&quot;</span><span class="s1">: check_dtype}</span>
    <span class="s1">df1[</span><span class="s2">&quot;col1&quot;</span><span class="s1">] = df1[</span><span class="s2">&quot;col1&quot;</span><span class="s1">].astype(</span><span class="s2">&quot;int64&quot;</span><span class="s1">)</span>

    <span class="s0">if </span><span class="s1">check_dtype:</span>
        <span class="s1">msg = </span><span class="s2">r&quot;Attributes of DataFrame\..* are different&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(AssertionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">tm.assert_frame_equal(df1</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">tm.assert_frame_equal(df1</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">**kwargs)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;check_like&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_frame_equal_index_mismatch(check_like</span><span class="s0">, </span><span class="s1">obj_fixture):</span>
    <span class="s1">msg = </span><span class="s2">f&quot;&quot;&quot;</span><span class="s0">{</span><span class="s1">obj_fixture</span><span class="s0">}\\</span><span class="s2">.index are different</span>

<span class="s0">{</span><span class="s1">obj_fixture</span><span class="s0">}\\</span><span class="s2">.index values are different </span><span class="s0">\\</span><span class="s2">(33</span><span class="s0">\\</span><span class="s2">.33333 %</span><span class="s0">\\</span><span class="s2">)</span>
<span class="s0">\\</span><span class="s2">[left</span><span class="s0">\\</span><span class="s2">]:  Index</span><span class="s0">\\</span><span class="s2">(</span><span class="s0">\\</span><span class="s2">['a', 'b', 'c'</span><span class="s0">\\</span><span class="s2">], dtype='object'</span><span class="s0">\\</span><span class="s2">)</span>
<span class="s0">\\</span><span class="s2">[right</span><span class="s0">\\</span><span class="s2">]: Index</span><span class="s0">\\</span><span class="s2">(</span><span class="s0">\\</span><span class="s2">['a', 'b', 'd'</span><span class="s0">\\</span><span class="s2">], dtype='object'</span><span class="s0">\\</span><span class="s2">)&quot;&quot;&quot;</span>

    <span class="s1">df1 = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: [</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">])</span>
    <span class="s1">df2 = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: [</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s1">])</span>

    <span class="s0">with </span><span class="s1">pytest.raises(AssertionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">tm.assert_frame_equal(df1</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">check_like=check_like</span><span class="s0">, </span><span class="s1">obj=obj_fixture)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;check_like&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_frame_equal_columns_mismatch(check_like</span><span class="s0">, </span><span class="s1">obj_fixture):</span>
    <span class="s1">msg = </span><span class="s2">f&quot;&quot;&quot;</span><span class="s0">{</span><span class="s1">obj_fixture</span><span class="s0">}\\</span><span class="s2">.columns are different</span>

<span class="s0">{</span><span class="s1">obj_fixture</span><span class="s0">}\\</span><span class="s2">.columns values are different </span><span class="s0">\\</span><span class="s2">(50</span><span class="s0">\\</span><span class="s2">.0 %</span><span class="s0">\\</span><span class="s2">)</span>
<span class="s0">\\</span><span class="s2">[left</span><span class="s0">\\</span><span class="s2">]:  Index</span><span class="s0">\\</span><span class="s2">(</span><span class="s0">\\</span><span class="s2">['A', 'B'</span><span class="s0">\\</span><span class="s2">], dtype='object'</span><span class="s0">\\</span><span class="s2">)</span>
<span class="s0">\\</span><span class="s2">[right</span><span class="s0">\\</span><span class="s2">]: Index</span><span class="s0">\\</span><span class="s2">(</span><span class="s0">\\</span><span class="s2">['A', 'b'</span><span class="s0">\\</span><span class="s2">], dtype='object'</span><span class="s0">\\</span><span class="s2">)&quot;&quot;&quot;</span>

    <span class="s1">df1 = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: [</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">])</span>
    <span class="s1">df2 = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">])</span>

    <span class="s0">with </span><span class="s1">pytest.raises(AssertionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">tm.assert_frame_equal(df1</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">check_like=check_like</span><span class="s0">, </span><span class="s1">obj=obj_fixture)</span>


<span class="s0">def </span><span class="s1">test_frame_equal_block_mismatch(by_blocks_fixture</span><span class="s0">, </span><span class="s1">obj_fixture):</span>
    <span class="s1">obj = obj_fixture</span>
    <span class="s1">msg = </span><span class="s2">f&quot;&quot;&quot;</span><span class="s0">{</span><span class="s1">obj</span><span class="s0">}\\</span><span class="s2">.iloc</span><span class="s0">\\</span><span class="s2">[:, 1</span><span class="s0">\\</span><span class="s2">] </span><span class="s0">\\</span><span class="s2">(column name=&quot;B&quot;</span><span class="s0">\\</span><span class="s2">) are different</span>

<span class="s0">{</span><span class="s1">obj</span><span class="s0">}\\</span><span class="s2">.iloc</span><span class="s0">\\</span><span class="s2">[:, 1</span><span class="s0">\\</span><span class="s2">] </span><span class="s0">\\</span><span class="s2">(column name=&quot;B&quot;</span><span class="s0">\\</span><span class="s2">) values are different </span><span class="s0">\\</span><span class="s2">(33</span><span class="s0">\\</span><span class="s2">.33333 %</span><span class="s0">\\</span><span class="s2">)</span>
<span class="s0">\\</span><span class="s2">[index</span><span class="s0">\\</span><span class="s2">]: </span><span class="s0">\\</span><span class="s2">[0, 1, 2</span><span class="s0">\\</span><span class="s2">]</span>
<span class="s0">\\</span><span class="s2">[left</span><span class="s0">\\</span><span class="s2">]:  </span><span class="s0">\\</span><span class="s2">[4, 5, 6</span><span class="s0">\\</span><span class="s2">]</span>
<span class="s0">\\</span><span class="s2">[right</span><span class="s0">\\</span><span class="s2">]: </span><span class="s0">\\</span><span class="s2">[4, 5, 7</span><span class="s0">\\</span><span class="s2">]&quot;&quot;&quot;</span>

    <span class="s1">df1 = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: [</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]})</span>
    <span class="s1">df2 = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: [</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]})</span>

    <span class="s0">with </span><span class="s1">pytest.raises(AssertionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">tm.assert_frame_equal(df1</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">by_blocks=by_blocks_fixture</span><span class="s0">, </span><span class="s1">obj=obj_fixture)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;df1,df2,msg&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span>
            <span class="s1">DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s2">&quot;á&quot;</span><span class="s0">, </span><span class="s2">&quot;à&quot;</span><span class="s0">, </span><span class="s2">&quot;ä&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;E&quot;</span><span class="s1">: [</span><span class="s2">&quot;é&quot;</span><span class="s0">, </span><span class="s2">&quot;è&quot;</span><span class="s0">, </span><span class="s2">&quot;ë&quot;</span><span class="s1">]})</span><span class="s0">,</span>
            <span class="s1">DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s2">&quot;á&quot;</span><span class="s0">, </span><span class="s2">&quot;à&quot;</span><span class="s0">, </span><span class="s2">&quot;ä&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;E&quot;</span><span class="s1">: [</span><span class="s2">&quot;é&quot;</span><span class="s0">, </span><span class="s2">&quot;è&quot;</span><span class="s0">, </span><span class="s2">&quot;e̊&quot;</span><span class="s1">]})</span><span class="s0">,</span>
            <span class="s2">&quot;&quot;&quot;{obj}</span><span class="s0">\\</span><span class="s2">.iloc</span><span class="s0">\\</span><span class="s2">[:, 1</span><span class="s0">\\</span><span class="s2">] </span><span class="s0">\\</span><span class="s2">(column name=&quot;E&quot;</span><span class="s0">\\</span><span class="s2">) are different 
 
{obj}</span><span class="s0">\\</span><span class="s2">.iloc</span><span class="s0">\\</span><span class="s2">[:, 1</span><span class="s0">\\</span><span class="s2">] </span><span class="s0">\\</span><span class="s2">(column name=&quot;E&quot;</span><span class="s0">\\</span><span class="s2">) values are different </span><span class="s0">\\</span><span class="s2">(33</span><span class="s0">\\</span><span class="s2">.33333 %</span><span class="s0">\\</span><span class="s2">) 
</span><span class="s0">\\</span><span class="s2">[index</span><span class="s0">\\</span><span class="s2">]: </span><span class="s0">\\</span><span class="s2">[0, 1, 2</span><span class="s0">\\</span><span class="s2">] 
</span><span class="s0">\\</span><span class="s2">[left</span><span class="s0">\\</span><span class="s2">]:  </span><span class="s0">\\</span><span class="s2">[é, è, ë</span><span class="s0">\\</span><span class="s2">] 
</span><span class="s0">\\</span><span class="s2">[right</span><span class="s0">\\</span><span class="s2">]: </span><span class="s0">\\</span><span class="s2">[é, è, e̊</span><span class="s0">\\</span><span class="s2">]&quot;&quot;&quot;</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s2">&quot;á&quot;</span><span class="s0">, </span><span class="s2">&quot;à&quot;</span><span class="s0">, </span><span class="s2">&quot;ä&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;E&quot;</span><span class="s1">: [</span><span class="s2">&quot;é&quot;</span><span class="s0">, </span><span class="s2">&quot;è&quot;</span><span class="s0">, </span><span class="s2">&quot;ë&quot;</span><span class="s1">]})</span><span class="s0">,</span>
            <span class="s1">DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;E&quot;</span><span class="s1">: [</span><span class="s2">&quot;e&quot;</span><span class="s0">, </span><span class="s2">&quot;e&quot;</span><span class="s0">, </span><span class="s2">&quot;e&quot;</span><span class="s1">]})</span><span class="s0">,</span>
            <span class="s2">&quot;&quot;&quot;{obj}</span><span class="s0">\\</span><span class="s2">.iloc</span><span class="s0">\\</span><span class="s2">[:, 0</span><span class="s0">\\</span><span class="s2">] </span><span class="s0">\\</span><span class="s2">(column name=&quot;A&quot;</span><span class="s0">\\</span><span class="s2">) are different 
 
{obj}</span><span class="s0">\\</span><span class="s2">.iloc</span><span class="s0">\\</span><span class="s2">[:, 0</span><span class="s0">\\</span><span class="s2">] </span><span class="s0">\\</span><span class="s2">(column name=&quot;A&quot;</span><span class="s0">\\</span><span class="s2">) values are different </span><span class="s0">\\</span><span class="s2">(100</span><span class="s0">\\</span><span class="s2">.0 %</span><span class="s0">\\</span><span class="s2">) 
</span><span class="s0">\\</span><span class="s2">[index</span><span class="s0">\\</span><span class="s2">]: </span><span class="s0">\\</span><span class="s2">[0, 1, 2</span><span class="s0">\\</span><span class="s2">] 
</span><span class="s0">\\</span><span class="s2">[left</span><span class="s0">\\</span><span class="s2">]:  </span><span class="s0">\\</span><span class="s2">[á, à, ä</span><span class="s0">\\</span><span class="s2">] 
</span><span class="s0">\\</span><span class="s2">[right</span><span class="s0">\\</span><span class="s2">]: </span><span class="s0">\\</span><span class="s2">[a, a, a</span><span class="s0">\\</span><span class="s2">]&quot;&quot;&quot;</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_frame_equal_unicode(df1</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">msg</span><span class="s0">, </span><span class="s1">by_blocks_fixture</span><span class="s0">, </span><span class="s1">obj_fixture):</span>
    <span class="s5"># see gh-20503</span>
    <span class="s5">#</span>
    <span class="s5"># Test ensures that `tm.assert_frame_equals` raises the right exception</span>
    <span class="s5"># when comparing DataFrames containing differing unicode objects.</span>
    <span class="s1">msg = msg.format(obj=obj_fixture)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(AssertionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">tm.assert_frame_equal(df1</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">by_blocks=by_blocks_fixture</span><span class="s0">, </span><span class="s1">obj=obj_fixture)</span>


<span class="s0">def </span><span class="s1">test_assert_frame_equal_extension_dtype_mismatch():</span>
    <span class="s5"># https://github.com/pandas-dev/pandas/issues/32747</span>
    <span class="s1">left = DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;Int64&quot;</span><span class="s1">)</span>
    <span class="s1">right = left.astype(int)</span>

    <span class="s1">msg = (</span>
        <span class="s2">&quot;Attributes of DataFrame</span><span class="s0">\\</span><span class="s2">.iloc</span><span class="s0">\\</span><span class="s2">[:, 0</span><span class="s0">\\</span><span class="s2">] &quot;</span>
        <span class="s2">'</span><span class="s0">\\</span><span class="s2">(column name=&quot;a&quot;</span><span class="s0">\\</span><span class="s2">) are different</span><span class="s0">\n\n</span><span class="s2">'</span>
        <span class="s2">'Attribute &quot;dtype&quot; are different</span><span class="s0">\n</span><span class="s2">'</span>
        <span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">[left</span><span class="s0">\\</span><span class="s2">]:  Int64</span><span class="s0">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">[right</span><span class="s0">\\</span><span class="s2">]: int[32|64]&quot;</span>
    <span class="s1">)</span>

    <span class="s1">tm.assert_frame_equal(left</span><span class="s0">, </span><span class="s1">right</span><span class="s0">, </span><span class="s1">check_dtype=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(AssertionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">tm.assert_frame_equal(left</span><span class="s0">, </span><span class="s1">right</span><span class="s0">, </span><span class="s1">check_dtype=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_assert_frame_equal_interval_dtype_mismatch():</span>
    <span class="s5"># https://github.com/pandas-dev/pandas/issues/32747</span>
    <span class="s1">left = DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [pd.Interval(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)]}</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;interval&quot;</span><span class="s1">)</span>
    <span class="s1">right = left.astype(object)</span>

    <span class="s1">msg = (</span>
        <span class="s2">&quot;Attributes of DataFrame</span><span class="s0">\\</span><span class="s2">.iloc</span><span class="s0">\\</span><span class="s2">[:, 0</span><span class="s0">\\</span><span class="s2">] &quot;</span>
        <span class="s2">'</span><span class="s0">\\</span><span class="s2">(column name=&quot;a&quot;</span><span class="s0">\\</span><span class="s2">) are different</span><span class="s0">\n\n</span><span class="s2">'</span>
        <span class="s2">'Attribute &quot;dtype&quot; are different</span><span class="s0">\n</span><span class="s2">'</span>
        <span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">[left</span><span class="s0">\\</span><span class="s2">]:  interval</span><span class="s0">\\</span><span class="s2">[int64, right</span><span class="s0">\\</span><span class="s2">]</span><span class="s0">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">[right</span><span class="s0">\\</span><span class="s2">]: object&quot;</span>
    <span class="s1">)</span>

    <span class="s1">tm.assert_frame_equal(left</span><span class="s0">, </span><span class="s1">right</span><span class="s0">, </span><span class="s1">check_dtype=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(AssertionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">tm.assert_frame_equal(left</span><span class="s0">, </span><span class="s1">right</span><span class="s0">, </span><span class="s1">check_dtype=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;right_dtype&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;Int32&quot;</span><span class="s0">, </span><span class="s2">&quot;int64&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_assert_frame_equal_ignore_extension_dtype_mismatch(right_dtype):</span>
    <span class="s5"># https://github.com/pandas-dev/pandas/issues/35715</span>
    <span class="s1">left = DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;Int64&quot;</span><span class="s1">)</span>
    <span class="s1">right = DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">dtype=right_dtype)</span>
    <span class="s1">tm.assert_frame_equal(left</span><span class="s0">, </span><span class="s1">right</span><span class="s0">, </span><span class="s1">check_dtype=</span><span class="s0">False</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;dtype&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s2">&quot;timedelta64[ns]&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;datetime64[ns, UTC]&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;Period[D]&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_assert_frame_equal_datetime_like_dtype_mismatch(dtype):</span>
    <span class="s1">df1 = DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: []}</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
    <span class="s1">df2 = DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: []})</span>
    <span class="s1">tm.assert_frame_equal(df1</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">check_dtype=</span><span class="s0">False</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_allows_duplicate_labels():</span>
    <span class="s1">left = DataFrame()</span>
    <span class="s1">right = DataFrame().set_flags(allows_duplicate_labels=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(left</span><span class="s0">, </span><span class="s1">left)</span>
    <span class="s1">tm.assert_frame_equal(right</span><span class="s0">, </span><span class="s1">right)</span>
    <span class="s1">tm.assert_frame_equal(left</span><span class="s0">, </span><span class="s1">right</span><span class="s0">, </span><span class="s1">check_flags=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(right</span><span class="s0">, </span><span class="s1">left</span><span class="s0">, </span><span class="s1">check_flags=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(AssertionError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;&lt;Flags&quot;</span><span class="s1">):</span>
        <span class="s1">tm.assert_frame_equal(left</span><span class="s0">, </span><span class="s1">right)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(AssertionError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;&lt;Flags&quot;</span><span class="s1">):</span>
        <span class="s1">tm.assert_frame_equal(left</span><span class="s0">, </span><span class="s1">right)</span>


<span class="s0">def </span><span class="s1">test_assert_frame_equal_columns_mixed_dtype():</span>
    <span class="s5"># GH#39168</span>
    <span class="s1">df = DataFrame([[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s2">&quot;foo&quot;</span><span class="s0">, </span><span class="s2">&quot;bar&quot;</span><span class="s0">, </span><span class="s4">42</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s4">1</span><span class="s0">, </span><span class="s2">&quot;test&quot;</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>
    <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">df</span><span class="s0">, </span><span class="s1">check_like=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_frame_equal_extension_dtype(frame_or_series</span><span class="s0">, </span><span class="s1">any_numeric_ea_dtype):</span>
    <span class="s5"># GH#39410</span>
    <span class="s1">obj = frame_or_series([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_numeric_ea_dtype)</span>
    <span class="s1">tm.assert_equal(obj</span><span class="s0">, </span><span class="s1">obj</span><span class="s0">, </span><span class="s1">check_exact=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;indexer&quot;</span><span class="s0">, </span><span class="s1">[(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)])</span>
<span class="s0">def </span><span class="s1">test_frame_equal_mixed_dtypes(frame_or_series</span><span class="s0">, </span><span class="s1">any_numeric_ea_dtype</span><span class="s0">, </span><span class="s1">indexer):</span>
    <span class="s1">dtypes = (any_numeric_ea_dtype</span><span class="s0">, </span><span class="s2">&quot;int64&quot;</span><span class="s1">)</span>
    <span class="s1">obj1 = frame_or_series([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=dtypes[indexer[</span><span class="s4">0</span><span class="s1">]])</span>
    <span class="s1">obj2 = frame_or_series([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=dtypes[indexer[</span><span class="s4">1</span><span class="s1">]])</span>
    <span class="s1">msg = </span><span class="s2">r'(Series|DataFrame.iloc\[:, 0\] \(column name=&quot;0&quot;\) classes) are different'</span>
    <span class="s0">with </span><span class="s1">pytest.raises(AssertionError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">tm.assert_equal(obj1</span><span class="s0">, </span><span class="s1">obj2</span><span class="s0">, </span><span class="s1">check_exact=</span><span class="s0">True, </span><span class="s1">check_dtype=</span><span class="s0">False</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_assert_series_equal_check_like_different_indexes():</span>
    <span class="s5"># GH#39739</span>
    <span class="s1">df1 = DataFrame(index=pd.Index([]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;object&quot;</span><span class="s1">))</span>
    <span class="s1">df2 = DataFrame(index=pd.RangeIndex(start=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">stop=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">step=</span><span class="s4">1</span><span class="s1">))</span>
    <span class="s0">with </span><span class="s1">pytest.raises(AssertionError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;DataFrame.index are different&quot;</span><span class="s1">):</span>
        <span class="s1">tm.assert_frame_equal(df1</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">check_like=</span><span class="s0">True</span><span class="s1">)</span>
</pre>
</body>
</html>