<html>
<head>
<title>misc.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #6a8759;}
.s4 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
misc.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">__future__ </span><span class="s0">import </span><span class="s1">annotations</span>

<span class="s0">import </span><span class="s1">random</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">TYPE_CHECKING</span><span class="s0">,</span>
    <span class="s1">Hashable</span><span class="s0">,</span>
<span class="s1">)</span>

<span class="s0">import </span><span class="s1">matplotlib.lines </span><span class="s0">as </span><span class="s1">mlines</span>
<span class="s0">import </span><span class="s1">matplotlib.patches </span><span class="s0">as </span><span class="s1">patches</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>

<span class="s0">from </span><span class="s1">pandas.core.dtypes.missing </span><span class="s0">import </span><span class="s1">notna</span>

<span class="s0">from </span><span class="s1">pandas.io.formats.printing </span><span class="s0">import </span><span class="s1">pprint_thing</span>
<span class="s0">from </span><span class="s1">pandas.plotting._matplotlib.style </span><span class="s0">import </span><span class="s1">get_standard_colors</span>
<span class="s0">from </span><span class="s1">pandas.plotting._matplotlib.tools </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">create_subplots</span><span class="s0">,</span>
    <span class="s1">do_adjust_figure</span><span class="s0">,</span>
    <span class="s1">maybe_adjust_figure</span><span class="s0">,</span>
    <span class="s1">set_ticks_props</span><span class="s0">,</span>
<span class="s1">)</span>

<span class="s0">if </span><span class="s1">TYPE_CHECKING:</span>
    <span class="s0">from </span><span class="s1">matplotlib.axes </span><span class="s0">import </span><span class="s1">Axes</span>
    <span class="s0">from </span><span class="s1">matplotlib.figure </span><span class="s0">import </span><span class="s1">Figure</span>

    <span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">(</span>
        <span class="s1">DataFrame</span><span class="s0">,</span>
        <span class="s1">Series</span><span class="s0">,</span>
    <span class="s1">)</span>


<span class="s0">def </span><span class="s1">scatter_matrix(</span>
    <span class="s1">frame: DataFrame</span><span class="s0">,</span>
    <span class="s1">alpha=</span><span class="s2">0.5</span><span class="s0">,</span>
    <span class="s1">figsize=</span><span class="s0">None,</span>
    <span class="s1">ax=</span><span class="s0">None,</span>
    <span class="s1">grid=</span><span class="s0">False,</span>
    <span class="s1">diagonal=</span><span class="s3">&quot;hist&quot;</span><span class="s0">,</span>
    <span class="s1">marker=</span><span class="s3">&quot;.&quot;</span><span class="s0">,</span>
    <span class="s1">density_kwds=</span><span class="s0">None,</span>
    <span class="s1">hist_kwds=</span><span class="s0">None,</span>
    <span class="s1">range_padding=</span><span class="s2">0.05</span><span class="s0">,</span>
    <span class="s1">**kwds</span><span class="s0">,</span>
<span class="s1">):</span>
    <span class="s1">df = frame._get_numeric_data()</span>
    <span class="s1">n = df.columns.size</span>
    <span class="s1">naxes = n * n</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axes = create_subplots(naxes=naxes</span><span class="s0">, </span><span class="s1">figsize=figsize</span><span class="s0">, </span><span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">squeeze=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s4"># no gaps between subplots</span>
    <span class="s1">maybe_adjust_figure(fig</span><span class="s0">, </span><span class="s1">wspace=</span><span class="s2">0</span><span class="s0">, </span><span class="s1">hspace=</span><span class="s2">0</span><span class="s1">)</span>

    <span class="s1">mask = notna(df)</span>

    <span class="s1">marker = _get_marker_compat(marker)</span>

    <span class="s1">hist_kwds = hist_kwds </span><span class="s0">or </span><span class="s1">{}</span>
    <span class="s1">density_kwds = density_kwds </span><span class="s0">or </span><span class="s1">{}</span>

    <span class="s4"># GH 14855</span>
    <span class="s1">kwds.setdefault(</span><span class="s3">&quot;edgecolors&quot;</span><span class="s0">, </span><span class="s3">&quot;none&quot;</span><span class="s1">)</span>

    <span class="s1">boundaries_list = []</span>
    <span class="s0">for </span><span class="s1">a </span><span class="s0">in </span><span class="s1">df.columns:</span>
        <span class="s1">values = df[a].values[mask[a].values]</span>
        <span class="s1">rmin_</span><span class="s0">, </span><span class="s1">rmax_ = np.min(values)</span><span class="s0">, </span><span class="s1">np.max(values)</span>
        <span class="s1">rdelta_ext = (rmax_ - rmin_) * range_padding / </span><span class="s2">2</span>
        <span class="s1">boundaries_list.append((rmin_ - rdelta_ext</span><span class="s0">, </span><span class="s1">rmax_ + rdelta_ext))</span>

    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">a </span><span class="s0">in </span><span class="s1">enumerate(df.columns):</span>
        <span class="s0">for </span><span class="s1">j</span><span class="s0">, </span><span class="s1">b </span><span class="s0">in </span><span class="s1">enumerate(df.columns):</span>
            <span class="s1">ax = axes[i</span><span class="s0">, </span><span class="s1">j]</span>

            <span class="s0">if </span><span class="s1">i == j:</span>
                <span class="s1">values = df[a].values[mask[a].values]</span>

                <span class="s4"># Deal with the diagonal by drawing a histogram there.</span>
                <span class="s0">if </span><span class="s1">diagonal == </span><span class="s3">&quot;hist&quot;</span><span class="s1">:</span>
                    <span class="s1">ax.hist(values</span><span class="s0">, </span><span class="s1">**hist_kwds)</span>

                <span class="s0">elif </span><span class="s1">diagonal </span><span class="s0">in </span><span class="s1">(</span><span class="s3">&quot;kde&quot;</span><span class="s0">, </span><span class="s3">&quot;density&quot;</span><span class="s1">):</span>
                    <span class="s0">from </span><span class="s1">scipy.stats </span><span class="s0">import </span><span class="s1">gaussian_kde</span>

                    <span class="s1">y = values</span>
                    <span class="s1">gkde = gaussian_kde(y)</span>
                    <span class="s1">ind = np.linspace(y.min()</span><span class="s0">, </span><span class="s1">y.max()</span><span class="s0">, </span><span class="s2">1000</span><span class="s1">)</span>
                    <span class="s1">ax.plot(ind</span><span class="s0">, </span><span class="s1">gkde.evaluate(ind)</span><span class="s0">, </span><span class="s1">**density_kwds)</span>

                <span class="s1">ax.set_xlim(boundaries_list[i])</span>

            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">common = (mask[a] &amp; mask[b]).values</span>

                <span class="s1">ax.scatter(</span>
                    <span class="s1">df[b][common]</span><span class="s0">, </span><span class="s1">df[a][common]</span><span class="s0">, </span><span class="s1">marker=marker</span><span class="s0">, </span><span class="s1">alpha=alpha</span><span class="s0">, </span><span class="s1">**kwds</span>
                <span class="s1">)</span>

                <span class="s1">ax.set_xlim(boundaries_list[j])</span>
                <span class="s1">ax.set_ylim(boundaries_list[i])</span>

            <span class="s1">ax.set_xlabel(b)</span>
            <span class="s1">ax.set_ylabel(a)</span>

            <span class="s0">if </span><span class="s1">j != </span><span class="s2">0</span><span class="s1">:</span>
                <span class="s1">ax.yaxis.set_visible(</span><span class="s0">False</span><span class="s1">)</span>
            <span class="s0">if </span><span class="s1">i != n - </span><span class="s2">1</span><span class="s1">:</span>
                <span class="s1">ax.xaxis.set_visible(</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s0">if </span><span class="s1">len(df.columns) &gt; </span><span class="s2">1</span><span class="s1">:</span>
        <span class="s1">lim1 = boundaries_list[</span><span class="s2">0</span><span class="s1">]</span>
        <span class="s1">locs = axes[</span><span class="s2">0</span><span class="s1">][</span><span class="s2">1</span><span class="s1">].yaxis.get_majorticklocs()</span>
        <span class="s1">locs = locs[(lim1[</span><span class="s2">0</span><span class="s1">] &lt;= locs) &amp; (locs &lt;= lim1[</span><span class="s2">1</span><span class="s1">])]</span>
        <span class="s1">adj = (locs - lim1[</span><span class="s2">0</span><span class="s1">]) / (lim1[</span><span class="s2">1</span><span class="s1">] - lim1[</span><span class="s2">0</span><span class="s1">])</span>

        <span class="s1">lim0 = axes[</span><span class="s2">0</span><span class="s1">][</span><span class="s2">0</span><span class="s1">].get_ylim()</span>
        <span class="s1">adj = adj * (lim0[</span><span class="s2">1</span><span class="s1">] - lim0[</span><span class="s2">0</span><span class="s1">]) + lim0[</span><span class="s2">0</span><span class="s1">]</span>
        <span class="s1">axes[</span><span class="s2">0</span><span class="s1">][</span><span class="s2">0</span><span class="s1">].yaxis.set_ticks(adj)</span>

        <span class="s0">if </span><span class="s1">np.all(locs == locs.astype(int)):</span>
            <span class="s4"># if all ticks are int</span>
            <span class="s1">locs = locs.astype(int)</span>
        <span class="s1">axes[</span><span class="s2">0</span><span class="s1">][</span><span class="s2">0</span><span class="s1">].yaxis.set_ticklabels(locs)</span>

    <span class="s1">set_ticks_props(axes</span><span class="s0">, </span><span class="s1">xlabelsize=</span><span class="s2">8</span><span class="s0">, </span><span class="s1">xrot=</span><span class="s2">90</span><span class="s0">, </span><span class="s1">ylabelsize=</span><span class="s2">8</span><span class="s0">, </span><span class="s1">yrot=</span><span class="s2">0</span><span class="s1">)</span>

    <span class="s0">return </span><span class="s1">axes</span>


<span class="s0">def </span><span class="s1">_get_marker_compat(marker):</span>
    <span class="s0">if </span><span class="s1">marker </span><span class="s0">not in </span><span class="s1">mlines.lineMarkers:</span>
        <span class="s0">return </span><span class="s3">&quot;o&quot;</span>
    <span class="s0">return </span><span class="s1">marker</span>


<span class="s0">def </span><span class="s1">radviz(</span>
    <span class="s1">frame: DataFrame</span><span class="s0">,</span>
    <span class="s1">class_column</span><span class="s0">,</span>
    <span class="s1">ax: Axes | </span><span class="s0">None </span><span class="s1">= </span><span class="s0">None,</span>
    <span class="s1">color=</span><span class="s0">None,</span>
    <span class="s1">colormap=</span><span class="s0">None,</span>
    <span class="s1">**kwds</span><span class="s0">,</span>
<span class="s1">) -&gt; Axes:</span>
    <span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>

    <span class="s0">def </span><span class="s1">normalize(series):</span>
        <span class="s1">a = min(series)</span>
        <span class="s1">b = max(series)</span>
        <span class="s0">return </span><span class="s1">(series - a) / (b - a)</span>

    <span class="s1">n = len(frame)</span>
    <span class="s1">classes = frame[class_column].drop_duplicates()</span>
    <span class="s1">class_col = frame[class_column]</span>
    <span class="s1">df = frame.drop(class_column</span><span class="s0">, </span><span class="s1">axis=</span><span class="s2">1</span><span class="s1">).apply(normalize)</span>

    <span class="s0">if </span><span class="s1">ax </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s1">ax = plt.gca()</span>
        <span class="s1">ax.set_xlim(-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">ax.set_ylim(-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

    <span class="s1">to_plot: dict[Hashable</span><span class="s0">, </span><span class="s1">list[list]] = {}</span>
    <span class="s1">colors = get_standard_colors(</span>
        <span class="s1">num_colors=len(classes)</span><span class="s0">, </span><span class="s1">colormap=colormap</span><span class="s0">, </span><span class="s1">color_type=</span><span class="s3">&quot;random&quot;</span><span class="s0">, </span><span class="s1">color=color</span>
    <span class="s1">)</span>

    <span class="s0">for </span><span class="s1">kls </span><span class="s0">in </span><span class="s1">classes:</span>
        <span class="s1">to_plot[kls] = [[]</span><span class="s0">, </span><span class="s1">[]]</span>

    <span class="s1">m = len(frame.columns) - </span><span class="s2">1</span>
    <span class="s1">s = np.array(</span>
        <span class="s1">[(np.cos(t)</span><span class="s0">, </span><span class="s1">np.sin(t)) </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">[</span><span class="s2">2 </span><span class="s1">* np.pi * (i / m) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(m)]]</span>
    <span class="s1">)</span>

    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(n):</span>
        <span class="s1">row = df.iloc[i].values</span>
        <span class="s1">row_ = np.repeat(np.expand_dims(row</span><span class="s0">, </span><span class="s1">axis=</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">axis=</span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">y = (s * row_).sum(axis=</span><span class="s2">0</span><span class="s1">) / row.sum()</span>
        <span class="s1">kls = class_col.iat[i]</span>
        <span class="s1">to_plot[kls][</span><span class="s2">0</span><span class="s1">].append(y[</span><span class="s2">0</span><span class="s1">])</span>
        <span class="s1">to_plot[kls][</span><span class="s2">1</span><span class="s1">].append(y[</span><span class="s2">1</span><span class="s1">])</span>

    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">kls </span><span class="s0">in </span><span class="s1">enumerate(classes):</span>
        <span class="s1">ax.scatter(</span>
            <span class="s1">to_plot[kls][</span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">to_plot[kls][</span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">color=colors[i]</span><span class="s0">,</span>
            <span class="s1">label=pprint_thing(kls)</span><span class="s0">,</span>
            <span class="s1">**kwds</span><span class="s0">,</span>
        <span class="s1">)</span>
    <span class="s1">ax.legend()</span>

    <span class="s1">ax.add_patch(patches.Circle((</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">0.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">radius=</span><span class="s2">1.0</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">&quot;none&quot;</span><span class="s1">))</span>

    <span class="s0">for </span><span class="s1">xy</span><span class="s0">, </span><span class="s1">name </span><span class="s0">in </span><span class="s1">zip(s</span><span class="s0">, </span><span class="s1">df.columns):</span>

        <span class="s1">ax.add_patch(patches.Circle(xy</span><span class="s0">, </span><span class="s1">radius=</span><span class="s2">0.025</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">&quot;gray&quot;</span><span class="s1">))</span>

        <span class="s0">if </span><span class="s1">xy[</span><span class="s2">0</span><span class="s1">] &lt; </span><span class="s2">0.0 </span><span class="s0">and </span><span class="s1">xy[</span><span class="s2">1</span><span class="s1">] &lt; </span><span class="s2">0.0</span><span class="s1">:</span>
            <span class="s1">ax.text(</span>
                <span class="s1">xy[</span><span class="s2">0</span><span class="s1">] - </span><span class="s2">0.025</span><span class="s0">, </span><span class="s1">xy[</span><span class="s2">1</span><span class="s1">] - </span><span class="s2">0.025</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">ha=</span><span class="s3">&quot;right&quot;</span><span class="s0">, </span><span class="s1">va=</span><span class="s3">&quot;top&quot;</span><span class="s0">, </span><span class="s1">size=</span><span class="s3">&quot;small&quot;</span>
            <span class="s1">)</span>
        <span class="s0">elif </span><span class="s1">xy[</span><span class="s2">0</span><span class="s1">] &lt; </span><span class="s2">0.0 </span><span class="s0">and </span><span class="s1">xy[</span><span class="s2">1</span><span class="s1">] &gt;= </span><span class="s2">0.0</span><span class="s1">:</span>
            <span class="s1">ax.text(</span>
                <span class="s1">xy[</span><span class="s2">0</span><span class="s1">] - </span><span class="s2">0.025</span><span class="s0">,</span>
                <span class="s1">xy[</span><span class="s2">1</span><span class="s1">] + </span><span class="s2">0.025</span><span class="s0">,</span>
                <span class="s1">name</span><span class="s0">,</span>
                <span class="s1">ha=</span><span class="s3">&quot;right&quot;</span><span class="s0">,</span>
                <span class="s1">va=</span><span class="s3">&quot;bottom&quot;</span><span class="s0">,</span>
                <span class="s1">size=</span><span class="s3">&quot;small&quot;</span><span class="s0">,</span>
            <span class="s1">)</span>
        <span class="s0">elif </span><span class="s1">xy[</span><span class="s2">0</span><span class="s1">] &gt;= </span><span class="s2">0.0 </span><span class="s0">and </span><span class="s1">xy[</span><span class="s2">1</span><span class="s1">] &lt; </span><span class="s2">0.0</span><span class="s1">:</span>
            <span class="s1">ax.text(</span>
                <span class="s1">xy[</span><span class="s2">0</span><span class="s1">] + </span><span class="s2">0.025</span><span class="s0">, </span><span class="s1">xy[</span><span class="s2">1</span><span class="s1">] - </span><span class="s2">0.025</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">ha=</span><span class="s3">&quot;left&quot;</span><span class="s0">, </span><span class="s1">va=</span><span class="s3">&quot;top&quot;</span><span class="s0">, </span><span class="s1">size=</span><span class="s3">&quot;small&quot;</span>
            <span class="s1">)</span>
        <span class="s0">elif </span><span class="s1">xy[</span><span class="s2">0</span><span class="s1">] &gt;= </span><span class="s2">0.0 </span><span class="s0">and </span><span class="s1">xy[</span><span class="s2">1</span><span class="s1">] &gt;= </span><span class="s2">0.0</span><span class="s1">:</span>
            <span class="s1">ax.text(</span>
                <span class="s1">xy[</span><span class="s2">0</span><span class="s1">] + </span><span class="s2">0.025</span><span class="s0">, </span><span class="s1">xy[</span><span class="s2">1</span><span class="s1">] + </span><span class="s2">0.025</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">ha=</span><span class="s3">&quot;left&quot;</span><span class="s0">, </span><span class="s1">va=</span><span class="s3">&quot;bottom&quot;</span><span class="s0">, </span><span class="s1">size=</span><span class="s3">&quot;small&quot;</span>
            <span class="s1">)</span>

    <span class="s1">ax.axis(</span><span class="s3">&quot;equal&quot;</span><span class="s1">)</span>
    <span class="s0">return </span><span class="s1">ax</span>


<span class="s0">def </span><span class="s1">andrews_curves(</span>
    <span class="s1">frame: DataFrame</span><span class="s0">,</span>
    <span class="s1">class_column</span><span class="s0">,</span>
    <span class="s1">ax: Axes | </span><span class="s0">None </span><span class="s1">= </span><span class="s0">None,</span>
    <span class="s1">samples: int = </span><span class="s2">200</span><span class="s0">,</span>
    <span class="s1">color=</span><span class="s0">None,</span>
    <span class="s1">colormap=</span><span class="s0">None,</span>
    <span class="s1">**kwds</span><span class="s0">,</span>
<span class="s1">) -&gt; Axes:</span>
    <span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>

    <span class="s0">def </span><span class="s1">function(amplitudes):</span>
        <span class="s0">def </span><span class="s1">f(t):</span>
            <span class="s1">x1 = amplitudes[</span><span class="s2">0</span><span class="s1">]</span>
            <span class="s1">result = x1 / np.sqrt(</span><span class="s2">2.0</span><span class="s1">)</span>

            <span class="s4"># Take the rest of the coefficients and resize them</span>
            <span class="s4"># appropriately. Take a copy of amplitudes as otherwise numpy</span>
            <span class="s4"># deletes the element from amplitudes itself.</span>
            <span class="s1">coeffs = np.delete(np.copy(amplitudes)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
            <span class="s1">coeffs = np.resize(coeffs</span><span class="s0">, </span><span class="s1">(int((coeffs.size + </span><span class="s2">1</span><span class="s1">) / </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>

            <span class="s4"># Generate the harmonics and arguments for the sin and cos</span>
            <span class="s4"># functions.</span>
            <span class="s1">harmonics = np.arange(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">coeffs.shape[</span><span class="s2">0</span><span class="s1">]) + </span><span class="s2">1</span>
            <span class="s1">trig_args = np.outer(harmonics</span><span class="s0">, </span><span class="s1">t)</span>

            <span class="s1">result += np.sum(</span>
                <span class="s1">coeffs[:</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">np.newaxis] * np.sin(trig_args)</span>
                <span class="s1">+ coeffs[:</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">np.newaxis] * np.cos(trig_args)</span><span class="s0">,</span>
                <span class="s1">axis=</span><span class="s2">0</span><span class="s0">,</span>
            <span class="s1">)</span>
            <span class="s0">return </span><span class="s1">result</span>

        <span class="s0">return </span><span class="s1">f</span>

    <span class="s1">n = len(frame)</span>
    <span class="s1">class_col = frame[class_column]</span>
    <span class="s1">classes = frame[class_column].drop_duplicates()</span>
    <span class="s1">df = frame.drop(class_column</span><span class="s0">, </span><span class="s1">axis=</span><span class="s2">1</span><span class="s1">)</span>
    <span class="s1">t = np.linspace(-np.pi</span><span class="s0">, </span><span class="s1">np.pi</span><span class="s0">, </span><span class="s1">samples)</span>
    <span class="s1">used_legends: set[str] = set()</span>

    <span class="s1">color_values = get_standard_colors(</span>
        <span class="s1">num_colors=len(classes)</span><span class="s0">, </span><span class="s1">colormap=colormap</span><span class="s0">, </span><span class="s1">color_type=</span><span class="s3">&quot;random&quot;</span><span class="s0">, </span><span class="s1">color=color</span>
    <span class="s1">)</span>
    <span class="s1">colors = dict(zip(classes</span><span class="s0">, </span><span class="s1">color_values))</span>
    <span class="s0">if </span><span class="s1">ax </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s1">ax = plt.gca()</span>
        <span class="s1">ax.set_xlim(-np.pi</span><span class="s0">, </span><span class="s1">np.pi)</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(n):</span>
        <span class="s1">row = df.iloc[i].values</span>
        <span class="s1">f = function(row)</span>
        <span class="s1">y = f(t)</span>
        <span class="s1">kls = class_col.iat[i]</span>
        <span class="s1">label = pprint_thing(kls)</span>
        <span class="s0">if </span><span class="s1">label </span><span class="s0">not in </span><span class="s1">used_legends:</span>
            <span class="s1">used_legends.add(label)</span>
            <span class="s1">ax.plot(t</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">color=colors[kls]</span><span class="s0">, </span><span class="s1">label=label</span><span class="s0">, </span><span class="s1">**kwds)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">ax.plot(t</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">color=colors[kls]</span><span class="s0">, </span><span class="s1">**kwds)</span>

    <span class="s1">ax.legend(loc=</span><span class="s3">&quot;upper right&quot;</span><span class="s1">)</span>
    <span class="s1">ax.grid()</span>
    <span class="s0">return </span><span class="s1">ax</span>


<span class="s0">def </span><span class="s1">bootstrap_plot(</span>
    <span class="s1">series: Series</span><span class="s0">,</span>
    <span class="s1">fig: Figure | </span><span class="s0">None </span><span class="s1">= </span><span class="s0">None,</span>
    <span class="s1">size: int = </span><span class="s2">50</span><span class="s0">,</span>
    <span class="s1">samples: int = </span><span class="s2">500</span><span class="s0">,</span>
    <span class="s1">**kwds</span><span class="s0">,</span>
<span class="s1">) -&gt; Figure:</span>

    <span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>

    <span class="s4"># TODO: is the failure mentioned below still relevant?</span>
    <span class="s4"># random.sample(ndarray, int) fails on python 3.3, sigh</span>
    <span class="s1">data = list(series.values)</span>
    <span class="s1">samplings = [random.sample(data</span><span class="s0">, </span><span class="s1">size) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(samples)]</span>

    <span class="s1">means = np.array([np.mean(sampling) </span><span class="s0">for </span><span class="s1">sampling </span><span class="s0">in </span><span class="s1">samplings])</span>
    <span class="s1">medians = np.array([np.median(sampling) </span><span class="s0">for </span><span class="s1">sampling </span><span class="s0">in </span><span class="s1">samplings])</span>
    <span class="s1">midranges = np.array(</span>
        <span class="s1">[(min(sampling) + max(sampling)) * </span><span class="s2">0.5 </span><span class="s0">for </span><span class="s1">sampling </span><span class="s0">in </span><span class="s1">samplings]</span>
    <span class="s1">)</span>
    <span class="s0">if </span><span class="s1">fig </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s1">fig = plt.figure()</span>
    <span class="s1">x = list(range(samples))</span>
    <span class="s1">axes = []</span>
    <span class="s1">ax1 = fig.add_subplot(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
    <span class="s1">ax1.set_xlabel(</span><span class="s3">&quot;Sample&quot;</span><span class="s1">)</span>
    <span class="s1">axes.append(ax1)</span>
    <span class="s1">ax1.plot(x</span><span class="s0">, </span><span class="s1">means</span><span class="s0">, </span><span class="s1">**kwds)</span>
    <span class="s1">ax2 = fig.add_subplot(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
    <span class="s1">ax2.set_xlabel(</span><span class="s3">&quot;Sample&quot;</span><span class="s1">)</span>
    <span class="s1">axes.append(ax2)</span>
    <span class="s1">ax2.plot(x</span><span class="s0">, </span><span class="s1">medians</span><span class="s0">, </span><span class="s1">**kwds)</span>
    <span class="s1">ax3 = fig.add_subplot(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span>
    <span class="s1">ax3.set_xlabel(</span><span class="s3">&quot;Sample&quot;</span><span class="s1">)</span>
    <span class="s1">axes.append(ax3)</span>
    <span class="s1">ax3.plot(x</span><span class="s0">, </span><span class="s1">midranges</span><span class="s0">, </span><span class="s1">**kwds)</span>
    <span class="s1">ax4 = fig.add_subplot(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span>
    <span class="s1">ax4.set_xlabel(</span><span class="s3">&quot;Mean&quot;</span><span class="s1">)</span>
    <span class="s1">axes.append(ax4)</span>
    <span class="s1">ax4.hist(means</span><span class="s0">, </span><span class="s1">**kwds)</span>
    <span class="s1">ax5 = fig.add_subplot(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span>
    <span class="s1">ax5.set_xlabel(</span><span class="s3">&quot;Median&quot;</span><span class="s1">)</span>
    <span class="s1">axes.append(ax5)</span>
    <span class="s1">ax5.hist(medians</span><span class="s0">, </span><span class="s1">**kwds)</span>
    <span class="s1">ax6 = fig.add_subplot(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s1">)</span>
    <span class="s1">ax6.set_xlabel(</span><span class="s3">&quot;Midrange&quot;</span><span class="s1">)</span>
    <span class="s1">axes.append(ax6)</span>
    <span class="s1">ax6.hist(midranges</span><span class="s0">, </span><span class="s1">**kwds)</span>
    <span class="s0">for </span><span class="s1">axis </span><span class="s0">in </span><span class="s1">axes:</span>
        <span class="s1">plt.setp(axis.get_xticklabels()</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">8</span><span class="s1">)</span>
        <span class="s1">plt.setp(axis.get_yticklabels()</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">8</span><span class="s1">)</span>
    <span class="s0">if </span><span class="s1">do_adjust_figure(fig):</span>
        <span class="s1">plt.tight_layout()</span>
    <span class="s0">return </span><span class="s1">fig</span>


<span class="s0">def </span><span class="s1">parallel_coordinates(</span>
    <span class="s1">frame: DataFrame</span><span class="s0">,</span>
    <span class="s1">class_column</span><span class="s0">,</span>
    <span class="s1">cols=</span><span class="s0">None,</span>
    <span class="s1">ax: Axes | </span><span class="s0">None </span><span class="s1">= </span><span class="s0">None,</span>
    <span class="s1">color=</span><span class="s0">None,</span>
    <span class="s1">use_columns=</span><span class="s0">False,</span>
    <span class="s1">xticks=</span><span class="s0">None,</span>
    <span class="s1">colormap=</span><span class="s0">None,</span>
    <span class="s1">axvlines: bool = </span><span class="s0">True,</span>
    <span class="s1">axvlines_kwds=</span><span class="s0">None,</span>
    <span class="s1">sort_labels: bool = </span><span class="s0">False,</span>
    <span class="s1">**kwds</span><span class="s0">,</span>
<span class="s1">) -&gt; Axes:</span>
    <span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>

    <span class="s0">if </span><span class="s1">axvlines_kwds </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s1">axvlines_kwds = {</span><span class="s3">&quot;linewidth&quot;</span><span class="s1">: </span><span class="s2">1</span><span class="s0">, </span><span class="s3">&quot;color&quot;</span><span class="s1">: </span><span class="s3">&quot;black&quot;</span><span class="s1">}</span>

    <span class="s1">n = len(frame)</span>
    <span class="s1">classes = frame[class_column].drop_duplicates()</span>
    <span class="s1">class_col = frame[class_column]</span>

    <span class="s0">if </span><span class="s1">cols </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s1">df = frame.drop(class_column</span><span class="s0">, </span><span class="s1">axis=</span><span class="s2">1</span><span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">df = frame[cols]</span>

    <span class="s1">used_legends: set[str] = set()</span>

    <span class="s1">ncols = len(df.columns)</span>

    <span class="s4"># determine values to use for xticks</span>
    <span class="s0">if </span><span class="s1">use_columns </span><span class="s0">is True</span><span class="s1">:</span>
        <span class="s0">if not </span><span class="s1">np.all(np.isreal(list(df.columns))):</span>
            <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s3">&quot;Columns must be numeric to be used as xticks&quot;</span><span class="s1">)</span>
        <span class="s1">x = df.columns</span>
    <span class="s0">elif </span><span class="s1">xticks </span><span class="s0">is not None</span><span class="s1">:</span>
        <span class="s0">if not </span><span class="s1">np.all(np.isreal(xticks)):</span>
            <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s3">&quot;xticks specified must be numeric&quot;</span><span class="s1">)</span>
        <span class="s0">elif </span><span class="s1">len(xticks) != ncols:</span>
            <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s3">&quot;Length of xticks must match number of columns&quot;</span><span class="s1">)</span>
        <span class="s1">x = xticks</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">x = list(range(ncols))</span>

    <span class="s0">if </span><span class="s1">ax </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s1">ax = plt.gca()</span>

    <span class="s1">color_values = get_standard_colors(</span>
        <span class="s1">num_colors=len(classes)</span><span class="s0">, </span><span class="s1">colormap=colormap</span><span class="s0">, </span><span class="s1">color_type=</span><span class="s3">&quot;random&quot;</span><span class="s0">, </span><span class="s1">color=color</span>
    <span class="s1">)</span>

    <span class="s0">if </span><span class="s1">sort_labels:</span>
        <span class="s1">classes = sorted(classes)</span>
        <span class="s1">color_values = sorted(color_values)</span>
    <span class="s1">colors = dict(zip(classes</span><span class="s0">, </span><span class="s1">color_values))</span>

    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(n):</span>
        <span class="s1">y = df.iloc[i].values</span>
        <span class="s1">kls = class_col.iat[i]</span>
        <span class="s1">label = pprint_thing(kls)</span>
        <span class="s0">if </span><span class="s1">label </span><span class="s0">not in </span><span class="s1">used_legends:</span>
            <span class="s1">used_legends.add(label)</span>
            <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">color=colors[kls]</span><span class="s0">, </span><span class="s1">label=label</span><span class="s0">, </span><span class="s1">**kwds)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">color=colors[kls]</span><span class="s0">, </span><span class="s1">**kwds)</span>

    <span class="s0">if </span><span class="s1">axvlines:</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">x:</span>
            <span class="s1">ax.axvline(i</span><span class="s0">, </span><span class="s1">**axvlines_kwds)</span>

    <span class="s1">ax.set_xticks(x)</span>
    <span class="s1">ax.set_xticklabels(df.columns)</span>
    <span class="s1">ax.set_xlim(x[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[-</span><span class="s2">1</span><span class="s1">])</span>
    <span class="s1">ax.legend(loc=</span><span class="s3">&quot;upper right&quot;</span><span class="s1">)</span>
    <span class="s1">ax.grid()</span>
    <span class="s0">return </span><span class="s1">ax</span>


<span class="s0">def </span><span class="s1">lag_plot(series: Series</span><span class="s0">, </span><span class="s1">lag: int = </span><span class="s2">1</span><span class="s0">, </span><span class="s1">ax: Axes | </span><span class="s0">None </span><span class="s1">= </span><span class="s0">None, </span><span class="s1">**kwds) -&gt; Axes:</span>
    <span class="s4"># workaround because `c='b'` is hardcoded in matplotlib's scatter method</span>
    <span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>

    <span class="s1">kwds.setdefault(</span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s1">plt.rcParams[</span><span class="s3">&quot;patch.facecolor&quot;</span><span class="s1">])</span>

    <span class="s1">data = series.values</span>
    <span class="s1">y1 = data[:-lag]</span>
    <span class="s1">y2 = data[lag:]</span>
    <span class="s0">if </span><span class="s1">ax </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s1">ax = plt.gca()</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">&quot;y(t)&quot;</span><span class="s1">)</span>
    <span class="s1">ax.set_ylabel(</span><span class="s3">f&quot;y(t + </span><span class="s0">{</span><span class="s1">lag</span><span class="s0">}</span><span class="s3">)&quot;</span><span class="s1">)</span>
    <span class="s1">ax.scatter(y1</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">, </span><span class="s1">**kwds)</span>
    <span class="s0">return </span><span class="s1">ax</span>


<span class="s0">def </span><span class="s1">autocorrelation_plot(series: Series</span><span class="s0">, </span><span class="s1">ax: Axes | </span><span class="s0">None </span><span class="s1">= </span><span class="s0">None, </span><span class="s1">**kwds) -&gt; Axes:</span>
    <span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>

    <span class="s1">n = len(series)</span>
    <span class="s1">data = np.asarray(series)</span>
    <span class="s0">if </span><span class="s1">ax </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s1">ax = plt.gca()</span>
        <span class="s1">ax.set_xlim(</span><span class="s2">1</span><span class="s0">, </span><span class="s1">n)</span>
        <span class="s1">ax.set_ylim(-</span><span class="s2">1.0</span><span class="s0">, </span><span class="s2">1.0</span><span class="s1">)</span>
    <span class="s1">mean = np.mean(data)</span>
    <span class="s1">c0 = np.sum((data - mean) ** </span><span class="s2">2</span><span class="s1">) / n</span>

    <span class="s0">def </span><span class="s1">r(h):</span>
        <span class="s0">return </span><span class="s1">((data[: n - h] - mean) * (data[h:] - mean)).sum() / n / c0</span>

    <span class="s1">x = np.arange(n) + </span><span class="s2">1</span>
    <span class="s1">y = [r(loc) </span><span class="s0">for </span><span class="s1">loc </span><span class="s0">in </span><span class="s1">x]</span>
    <span class="s1">z95 = </span><span class="s2">1.959963984540054</span>
    <span class="s1">z99 = </span><span class="s2">2.5758293035489004</span>
    <span class="s1">ax.axhline(y=z99 / np.sqrt(n)</span><span class="s0">, </span><span class="s1">linestyle=</span><span class="s3">&quot;--&quot;</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">&quot;grey&quot;</span><span class="s1">)</span>
    <span class="s1">ax.axhline(y=z95 / np.sqrt(n)</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">&quot;grey&quot;</span><span class="s1">)</span>
    <span class="s1">ax.axhline(y=</span><span class="s2">0.0</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">&quot;black&quot;</span><span class="s1">)</span>
    <span class="s1">ax.axhline(y=-z95 / np.sqrt(n)</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">&quot;grey&quot;</span><span class="s1">)</span>
    <span class="s1">ax.axhline(y=-z99 / np.sqrt(n)</span><span class="s0">, </span><span class="s1">linestyle=</span><span class="s3">&quot;--&quot;</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">&quot;grey&quot;</span><span class="s1">)</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">&quot;Lag&quot;</span><span class="s1">)</span>
    <span class="s1">ax.set_ylabel(</span><span class="s3">&quot;Autocorrelation&quot;</span><span class="s1">)</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">**kwds)</span>
    <span class="s0">if </span><span class="s3">&quot;label&quot; </span><span class="s0">in </span><span class="s1">kwds:</span>
        <span class="s1">ax.legend()</span>
    <span class="s1">ax.grid()</span>
    <span class="s0">return </span><span class="s1">ax</span>
</pre>
</body>
</html>