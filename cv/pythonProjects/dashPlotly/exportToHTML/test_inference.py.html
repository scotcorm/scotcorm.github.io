<html>
<head>
<title>test_inference.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #6a8759;}
.s4 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_inference.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">datetime</span><span class="s0">,</span>
    <span class="s1">timedelta</span><span class="s0">,</span>
<span class="s1">)</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas._libs.tslibs.ccalendar </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">DAYS</span><span class="s0">,</span>
    <span class="s1">MONTHS</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">from </span><span class="s1">pandas._libs.tslibs.period </span><span class="s0">import </span><span class="s1">INVALID_FREQ_ERR_MSG</span>
<span class="s0">from </span><span class="s1">pandas.compat </span><span class="s0">import </span><span class="s1">is_platform_windows</span>

<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">DatetimeIndex</span><span class="s0">,</span>
    <span class="s1">Index</span><span class="s0">,</span>
    <span class="s1">Series</span><span class="s0">,</span>
    <span class="s1">Timestamp</span><span class="s0">,</span>
    <span class="s1">date_range</span><span class="s0">,</span>
    <span class="s1">period_range</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">pandas._testing </span><span class="s0">as </span><span class="s1">tm</span>
<span class="s0">from </span><span class="s1">pandas.core.tools.datetimes </span><span class="s0">import </span><span class="s1">to_datetime</span>

<span class="s0">import </span><span class="s1">pandas.tseries.frequencies </span><span class="s0">as </span><span class="s1">frequencies</span>
<span class="s0">import </span><span class="s1">pandas.tseries.offsets </span><span class="s0">as </span><span class="s1">offsets</span>


<span class="s1">@pytest.fixture(</span>
    <span class="s1">params=[</span>
        <span class="s1">(timedelta(</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s3">&quot;D&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(timedelta(hours=</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s3">&quot;H&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(timedelta(minutes=</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s3">&quot;T&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(timedelta(seconds=</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s3">&quot;S&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(np.timedelta64(</span><span class="s2">1</span><span class="s0">, </span><span class="s3">&quot;ns&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s3">&quot;N&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(timedelta(microseconds=</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s3">&quot;U&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(timedelta(microseconds=</span><span class="s2">1000</span><span class="s1">)</span><span class="s0">, </span><span class="s3">&quot;L&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">base_delta_code_pair(request):</span>
    <span class="s0">return </span><span class="s1">request.param</span>


<span class="s1">freqs = (</span>
    <span class="s1">[</span><span class="s3">f&quot;Q-</span><span class="s0">{</span><span class="s1">month</span><span class="s0">}</span><span class="s3">&quot; </span><span class="s0">for </span><span class="s1">month </span><span class="s0">in </span><span class="s1">MONTHS]</span>
    <span class="s1">+ [</span><span class="s3">f&quot;</span><span class="s0">{</span><span class="s1">annual</span><span class="s0">}</span><span class="s3">-</span><span class="s0">{</span><span class="s1">month</span><span class="s0">}</span><span class="s3">&quot; </span><span class="s0">for </span><span class="s1">annual </span><span class="s0">in </span><span class="s1">[</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;BA&quot;</span><span class="s1">] </span><span class="s0">for </span><span class="s1">month </span><span class="s0">in </span><span class="s1">MONTHS]</span>
    <span class="s1">+ [</span><span class="s3">&quot;M&quot;</span><span class="s0">, </span><span class="s3">&quot;BM&quot;</span><span class="s0">, </span><span class="s3">&quot;BMS&quot;</span><span class="s1">]</span>
    <span class="s1">+ [</span><span class="s3">f&quot;WOM-</span><span class="s0">{</span><span class="s1">count</span><span class="s0">}{</span><span class="s1">day</span><span class="s0">}</span><span class="s3">&quot; </span><span class="s0">for </span><span class="s1">count </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">5</span><span class="s1">) </span><span class="s0">for </span><span class="s1">day </span><span class="s0">in </span><span class="s1">DAYS]</span>
    <span class="s1">+ [</span><span class="s3">f&quot;W-</span><span class="s0">{</span><span class="s1">day</span><span class="s0">}</span><span class="s3">&quot; </span><span class="s0">for </span><span class="s1">day </span><span class="s0">in </span><span class="s1">DAYS]</span>
<span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;freq&quot;</span><span class="s0">, </span><span class="s1">freqs)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;periods&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">7</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_infer_freq_range(periods</span><span class="s0">, </span><span class="s1">freq):</span>
    <span class="s1">freq = freq.upper()</span>

    <span class="s1">gen = date_range(</span><span class="s3">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s1">periods=periods</span><span class="s0">, </span><span class="s1">freq=freq)</span>
    <span class="s1">index = DatetimeIndex(gen.values)</span>

    <span class="s0">if not </span><span class="s1">freq.startswith(</span><span class="s3">&quot;Q-&quot;</span><span class="s1">):</span>
        <span class="s0">assert </span><span class="s1">frequencies.infer_freq(index) == gen.freqstr</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">inf_freq = frequencies.infer_freq(index)</span>
        <span class="s1">is_dec_range = inf_freq == </span><span class="s3">&quot;Q-DEC&quot; </span><span class="s0">and </span><span class="s1">gen.freqstr </span><span class="s0">in </span><span class="s1">(</span>
            <span class="s3">&quot;Q&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;Q-DEC&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;Q-SEP&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;Q-JUN&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;Q-MAR&quot;</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">is_nov_range = inf_freq == </span><span class="s3">&quot;Q-NOV&quot; </span><span class="s0">and </span><span class="s1">gen.freqstr </span><span class="s0">in </span><span class="s1">(</span>
            <span class="s3">&quot;Q-NOV&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;Q-AUG&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;Q-MAY&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;Q-FEB&quot;</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">is_oct_range = inf_freq == </span><span class="s3">&quot;Q-OCT&quot; </span><span class="s0">and </span><span class="s1">gen.freqstr </span><span class="s0">in </span><span class="s1">(</span>
            <span class="s3">&quot;Q-OCT&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;Q-JUL&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;Q-APR&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;Q-JAN&quot;</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">is_dec_range </span><span class="s0">or </span><span class="s1">is_nov_range </span><span class="s0">or </span><span class="s1">is_oct_range</span>


<span class="s0">def </span><span class="s1">test_raise_if_period_index():</span>
    <span class="s1">index = period_range(start=</span><span class="s3">&quot;1/1/1990&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s2">20</span><span class="s0">, </span><span class="s1">freq=</span><span class="s3">&quot;M&quot;</span><span class="s1">)</span>
    <span class="s1">msg = </span><span class="s3">&quot;Check the `freq` attribute instead of using infer_freq&quot;</span>

    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">frequencies.infer_freq(index)</span>


<span class="s0">def </span><span class="s1">test_raise_if_too_few():</span>
    <span class="s1">index = DatetimeIndex([</span><span class="s3">&quot;12/31/1998&quot;</span><span class="s0">, </span><span class="s3">&quot;1/3/1999&quot;</span><span class="s1">])</span>
    <span class="s1">msg = </span><span class="s3">&quot;Need at least 3 dates to infer frequency&quot;</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">frequencies.infer_freq(index)</span>


<span class="s0">def </span><span class="s1">test_business_daily():</span>
    <span class="s1">index = DatetimeIndex([</span><span class="s3">&quot;01/01/1999&quot;</span><span class="s0">, </span><span class="s3">&quot;1/4/1999&quot;</span><span class="s0">, </span><span class="s3">&quot;1/5/1999&quot;</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">frequencies.infer_freq(index) == </span><span class="s3">&quot;B&quot;</span>


<span class="s0">def </span><span class="s1">test_business_daily_look_alike():</span>
    <span class="s4"># see gh-16624</span>
    <span class="s4">#</span>
    <span class="s4"># Do not infer &quot;B when &quot;weekend&quot; (2-day gap) in wrong place.</span>
    <span class="s1">index = DatetimeIndex([</span><span class="s3">&quot;12/31/1998&quot;</span><span class="s0">, </span><span class="s3">&quot;1/3/1999&quot;</span><span class="s0">, </span><span class="s3">&quot;1/4/1999&quot;</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">frequencies.infer_freq(index) </span><span class="s0">is None</span>


<span class="s0">def </span><span class="s1">test_day_corner():</span>
    <span class="s1">index = DatetimeIndex([</span><span class="s3">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s3">&quot;1/2/2000&quot;</span><span class="s0">, </span><span class="s3">&quot;1/3/2000&quot;</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">frequencies.infer_freq(index) == </span><span class="s3">&quot;D&quot;</span>


<span class="s0">def </span><span class="s1">test_non_datetime_index():</span>
    <span class="s1">dates = to_datetime([</span><span class="s3">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s3">&quot;1/2/2000&quot;</span><span class="s0">, </span><span class="s3">&quot;1/3/2000&quot;</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">frequencies.infer_freq(dates) == </span><span class="s3">&quot;D&quot;</span>


<span class="s0">def </span><span class="s1">test_fifth_week_of_month_infer():</span>
    <span class="s4"># see gh-9425</span>
    <span class="s4">#</span>
    <span class="s4"># Only attempt to infer up to WOM-4.</span>
    <span class="s1">index = DatetimeIndex([</span><span class="s3">&quot;2014-03-31&quot;</span><span class="s0">, </span><span class="s3">&quot;2014-06-30&quot;</span><span class="s0">, </span><span class="s3">&quot;2015-03-30&quot;</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">frequencies.infer_freq(index) </span><span class="s0">is None</span>


<span class="s0">def </span><span class="s1">test_week_of_month_fake():</span>
    <span class="s4"># All of these dates are on same day</span>
    <span class="s4"># of week and are 4 or 5 weeks apart.</span>
    <span class="s1">index = DatetimeIndex([</span><span class="s3">&quot;2013-08-27&quot;</span><span class="s0">, </span><span class="s3">&quot;2013-10-01&quot;</span><span class="s0">, </span><span class="s3">&quot;2013-10-29&quot;</span><span class="s0">, </span><span class="s3">&quot;2013-11-26&quot;</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">frequencies.infer_freq(index) != </span><span class="s3">&quot;WOM-4TUE&quot;</span>


<span class="s0">def </span><span class="s1">test_fifth_week_of_month():</span>
    <span class="s4"># see gh-9425</span>
    <span class="s4">#</span>
    <span class="s4"># Only supports freq up to WOM-4.</span>
    <span class="s1">msg = (</span>
        <span class="s3">&quot;Of the four parameters: start, end, periods, &quot;</span>
        <span class="s3">&quot;and freq, exactly three must be specified&quot;</span>
    <span class="s1">)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">date_range(</span><span class="s3">&quot;2014-01-01&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s3">&quot;WOM-5MON&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_monthly_ambiguous():</span>
    <span class="s1">rng = DatetimeIndex([</span><span class="s3">&quot;1/31/2000&quot;</span><span class="s0">, </span><span class="s3">&quot;2/29/2000&quot;</span><span class="s0">, </span><span class="s3">&quot;3/31/2000&quot;</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">rng.inferred_freq == </span><span class="s3">&quot;M&quot;</span>


<span class="s0">def </span><span class="s1">test_annual_ambiguous():</span>
    <span class="s1">rng = DatetimeIndex([</span><span class="s3">&quot;1/31/2000&quot;</span><span class="s0">, </span><span class="s3">&quot;1/31/2001&quot;</span><span class="s0">, </span><span class="s3">&quot;1/31/2002&quot;</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">rng.inferred_freq == </span><span class="s3">&quot;A-JAN&quot;</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;count&quot;</span><span class="s0">, </span><span class="s1">range(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">5</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_infer_freq_delta(base_delta_code_pair</span><span class="s0">, </span><span class="s1">count):</span>
    <span class="s1">b = Timestamp(datetime.now())</span>
    <span class="s1">base_delta</span><span class="s0">, </span><span class="s1">code = base_delta_code_pair</span>

    <span class="s1">inc = base_delta * count</span>
    <span class="s1">index = DatetimeIndex([b + inc * j </span><span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">3</span><span class="s1">)])</span>

    <span class="s1">exp_freq = </span><span class="s3">f&quot;</span><span class="s0">{</span><span class="s1">count</span><span class="s0">:</span><span class="s3">d</span><span class="s0">}{</span><span class="s1">code</span><span class="s0">}</span><span class="s3">&quot; </span><span class="s0">if </span><span class="s1">count &gt; </span><span class="s2">1 </span><span class="s0">else </span><span class="s1">code</span>
    <span class="s0">assert </span><span class="s1">frequencies.infer_freq(index) == exp_freq</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;constructor&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s0">lambda </span><span class="s1">now</span><span class="s0">, </span><span class="s1">delta: DatetimeIndex(</span>
            <span class="s1">[now + delta * </span><span class="s2">7</span><span class="s1">] + [now + delta * j </span><span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">3</span><span class="s1">)]</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s0">lambda </span><span class="s1">now</span><span class="s0">, </span><span class="s1">delta: DatetimeIndex(</span>
            <span class="s1">[now + delta * j </span><span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">3</span><span class="s1">)] + [now + delta * </span><span class="s2">7</span><span class="s1">]</span>
        <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_infer_freq_custom(base_delta_code_pair</span><span class="s0">, </span><span class="s1">constructor):</span>
    <span class="s1">b = Timestamp(datetime.now())</span>
    <span class="s1">base_delta</span><span class="s0">, </span><span class="s1">_ = base_delta_code_pair</span>

    <span class="s1">index = constructor(b</span><span class="s0">, </span><span class="s1">base_delta)</span>
    <span class="s0">assert </span><span class="s1">frequencies.infer_freq(index) </span><span class="s0">is None</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;freq,expected&quot;</span><span class="s0">, </span><span class="s1">[(</span><span class="s3">&quot;Q&quot;</span><span class="s0">, </span><span class="s3">&quot;Q-DEC&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;Q-NOV&quot;</span><span class="s0">, </span><span class="s3">&quot;Q-NOV&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;Q-OCT&quot;</span><span class="s0">, </span><span class="s3">&quot;Q-OCT&quot;</span><span class="s1">)]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_infer_freq_index(freq</span><span class="s0">, </span><span class="s1">expected):</span>
    <span class="s1">rng = period_range(</span><span class="s3">&quot;1959Q2&quot;</span><span class="s0">, </span><span class="s3">&quot;2009Q3&quot;</span><span class="s0">, </span><span class="s1">freq=freq)</span>
    <span class="s1">rng = Index(rng.to_timestamp(</span><span class="s3">&quot;D&quot;</span><span class="s0">, </span><span class="s1">how=</span><span class="s3">&quot;e&quot;</span><span class="s1">).astype(object))</span>

    <span class="s0">assert </span><span class="s1">rng.inferred_freq == expected</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;expected,dates&quot;</span><span class="s0">,</span>
    <span class="s1">list(</span>
        <span class="s1">{</span>
            <span class="s3">&quot;AS-JAN&quot;</span><span class="s1">: [</span><span class="s3">&quot;2009-01-01&quot;</span><span class="s0">, </span><span class="s3">&quot;2010-01-01&quot;</span><span class="s0">, </span><span class="s3">&quot;2011-01-01&quot;</span><span class="s0">, </span><span class="s3">&quot;2012-01-01&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s3">&quot;Q-OCT&quot;</span><span class="s1">: [</span><span class="s3">&quot;2009-01-31&quot;</span><span class="s0">, </span><span class="s3">&quot;2009-04-30&quot;</span><span class="s0">, </span><span class="s3">&quot;2009-07-31&quot;</span><span class="s0">, </span><span class="s3">&quot;2009-10-31&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s3">&quot;M&quot;</span><span class="s1">: [</span><span class="s3">&quot;2010-11-30&quot;</span><span class="s0">, </span><span class="s3">&quot;2010-12-31&quot;</span><span class="s0">, </span><span class="s3">&quot;2011-01-31&quot;</span><span class="s0">, </span><span class="s3">&quot;2011-02-28&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s3">&quot;W-SAT&quot;</span><span class="s1">: [</span><span class="s3">&quot;2010-12-25&quot;</span><span class="s0">, </span><span class="s3">&quot;2011-01-01&quot;</span><span class="s0">, </span><span class="s3">&quot;2011-01-08&quot;</span><span class="s0">, </span><span class="s3">&quot;2011-01-15&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s3">&quot;D&quot;</span><span class="s1">: [</span><span class="s3">&quot;2011-01-01&quot;</span><span class="s0">, </span><span class="s3">&quot;2011-01-02&quot;</span><span class="s0">, </span><span class="s3">&quot;2011-01-03&quot;</span><span class="s0">, </span><span class="s3">&quot;2011-01-04&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s3">&quot;H&quot;</span><span class="s1">: [</span>
                <span class="s3">&quot;2011-12-31 22:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2011-12-31 23:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2012-01-01 00:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2012-01-01 01:00&quot;</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
        <span class="s1">}.items()</span>
    <span class="s1">)</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_infer_freq_tz(tz_naive_fixture</span><span class="s0">, </span><span class="s1">expected</span><span class="s0">, </span><span class="s1">dates):</span>
    <span class="s4"># see gh-7310</span>
    <span class="s1">tz = tz_naive_fixture</span>
    <span class="s1">idx = DatetimeIndex(dates</span><span class="s0">, </span><span class="s1">tz=tz)</span>
    <span class="s0">assert </span><span class="s1">idx.inferred_freq == expected</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;date_pair&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">[</span><span class="s3">&quot;2013-11-02&quot;</span><span class="s0">, </span><span class="s3">&quot;2013-11-5&quot;</span><span class="s1">]</span><span class="s0">,  </span><span class="s4"># Fall DST</span>
        <span class="s1">[</span><span class="s3">&quot;2014-03-08&quot;</span><span class="s0">, </span><span class="s3">&quot;2014-03-11&quot;</span><span class="s1">]</span><span class="s0">,  </span><span class="s4"># Spring DST</span>
        <span class="s1">[</span><span class="s3">&quot;2014-01-01&quot;</span><span class="s0">, </span><span class="s3">&quot;2014-01-03&quot;</span><span class="s1">]</span><span class="s0">,  </span><span class="s4"># Regular Time</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;freq&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;H&quot;</span><span class="s0">, </span><span class="s3">&quot;3H&quot;</span><span class="s0">, </span><span class="s3">&quot;10T&quot;</span><span class="s0">, </span><span class="s3">&quot;3601S&quot;</span><span class="s0">, </span><span class="s3">&quot;3600001L&quot;</span><span class="s0">, </span><span class="s3">&quot;3600000001U&quot;</span><span class="s0">, </span><span class="s3">&quot;3600000000001N&quot;</span><span class="s1">]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_infer_freq_tz_transition(tz_naive_fixture</span><span class="s0">, </span><span class="s1">date_pair</span><span class="s0">, </span><span class="s1">freq):</span>
    <span class="s4"># see gh-8772</span>
    <span class="s1">tz = tz_naive_fixture</span>
    <span class="s1">idx = date_range(date_pair[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">date_pair[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">freq=freq</span><span class="s0">, </span><span class="s1">tz=tz)</span>
    <span class="s0">assert </span><span class="s1">idx.inferred_freq == freq</span>


<span class="s0">def </span><span class="s1">test_infer_freq_tz_transition_custom():</span>
    <span class="s1">index = date_range(</span><span class="s3">&quot;2013-11-03&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s2">5</span><span class="s0">, </span><span class="s1">freq=</span><span class="s3">&quot;3H&quot;</span><span class="s1">).tz_localize(</span>
        <span class="s3">&quot;America/Chicago&quot;</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">index.inferred_freq </span><span class="s0">is None</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;data,expected&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s4"># Hourly freq in a day must result in &quot;H&quot;</span>
        <span class="s1">(</span>
            <span class="s1">[</span>
                <span class="s3">&quot;2014-07-01 09:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-01 10:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-01 11:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-01 12:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-01 13:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-01 14:00&quot;</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s3">&quot;H&quot;</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">[</span>
                <span class="s3">&quot;2014-07-01 09:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-01 10:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-01 11:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-01 12:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-01 13:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-01 14:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-01 15:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-01 16:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-02 09:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-02 10:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-02 11:00&quot;</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s3">&quot;BH&quot;</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">[</span>
                <span class="s3">&quot;2014-07-04 09:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-04 10:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-04 11:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-04 12:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-04 13:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-04 14:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-04 15:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-04 16:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-07 09:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-07 10:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-07 11:00&quot;</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s3">&quot;BH&quot;</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">[</span>
                <span class="s3">&quot;2014-07-04 09:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-04 10:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-04 11:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-04 12:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-04 13:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-04 14:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-04 15:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-04 16:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-07 09:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-07 10:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-07 11:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-07 12:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-07 13:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-07 14:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-07 15:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-07 16:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-08 09:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-08 10:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-08 11:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-08 12:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-08 13:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-08 14:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-08 15:00&quot;</span><span class="s0">,</span>
                <span class="s3">&quot;2014-07-08 16:00&quot;</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s3">&quot;BH&quot;</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_infer_freq_business_hour(data</span><span class="s0">, </span><span class="s1">expected):</span>
    <span class="s4"># see gh-7905</span>
    <span class="s1">idx = DatetimeIndex(data)</span>
    <span class="s0">assert </span><span class="s1">idx.inferred_freq == expected</span>


<span class="s0">def </span><span class="s1">test_not_monotonic():</span>
    <span class="s1">rng = DatetimeIndex([</span><span class="s3">&quot;1/31/2000&quot;</span><span class="s0">, </span><span class="s3">&quot;1/31/2001&quot;</span><span class="s0">, </span><span class="s3">&quot;1/31/2002&quot;</span><span class="s1">])</span>
    <span class="s1">rng = rng[::-</span><span class="s2">1</span><span class="s1">]</span>

    <span class="s0">assert </span><span class="s1">rng.inferred_freq == </span><span class="s3">&quot;-1A-JAN&quot;</span>


<span class="s0">def </span><span class="s1">test_non_datetime_index2():</span>
    <span class="s1">rng = DatetimeIndex([</span><span class="s3">&quot;1/31/2000&quot;</span><span class="s0">, </span><span class="s3">&quot;1/31/2001&quot;</span><span class="s0">, </span><span class="s3">&quot;1/31/2002&quot;</span><span class="s1">])</span>
    <span class="s1">vals = rng.to_pydatetime()</span>

    <span class="s1">result = frequencies.infer_freq(vals)</span>
    <span class="s0">assert </span><span class="s1">result == rng.inferred_freq</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;idx&quot;</span><span class="s0">, </span><span class="s1">[tm.makeIntIndex(</span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">tm.makeFloatIndex(</span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">tm.makePeriodIndex(</span><span class="s2">10</span><span class="s1">)]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_invalid_index_types(idx):</span>
    <span class="s1">msg = </span><span class="s3">&quot;|&quot;</span><span class="s1">.join(</span>
        <span class="s1">[</span>
            <span class="s3">&quot;cannot infer freq from a non-convertible&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;Check the `freq` attribute instead of using infer_freq&quot;</span><span class="s0">,</span>
        <span class="s1">]</span>
    <span class="s1">)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">frequencies.infer_freq(idx)</span>


<span class="s1">@pytest.mark.skipif(is_platform_windows()</span><span class="s0">, </span><span class="s1">reason=</span><span class="s3">&quot;see gh-10822: Windows issue&quot;</span><span class="s1">)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;idx&quot;</span><span class="s0">, </span><span class="s1">[tm.makeStringIndex(</span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">tm.makeUnicodeIndex(</span><span class="s2">10</span><span class="s1">)])</span>
<span class="s0">def </span><span class="s1">test_invalid_index_types_unicode(idx):</span>
    <span class="s4"># see gh-10822</span>
    <span class="s4">#</span>
    <span class="s4"># Odd error message on conversions to datetime for unicode.</span>
    <span class="s1">msg = </span><span class="s3">&quot;Unknown string format&quot;</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">frequencies.infer_freq(idx)</span>


<span class="s0">def </span><span class="s1">test_string_datetime_like_compat():</span>
    <span class="s4"># see gh-6463</span>
    <span class="s1">data = [</span><span class="s3">&quot;2004-01&quot;</span><span class="s0">, </span><span class="s3">&quot;2004-02&quot;</span><span class="s0">, </span><span class="s3">&quot;2004-03&quot;</span><span class="s0">, </span><span class="s3">&quot;2004-04&quot;</span><span class="s1">]</span>

    <span class="s1">expected = frequencies.infer_freq(data)</span>
    <span class="s1">result = frequencies.infer_freq(Index(data))</span>

    <span class="s0">assert </span><span class="s1">result == expected</span>


<span class="s0">def </span><span class="s1">test_series():</span>
    <span class="s4"># see gh-6407</span>
    <span class="s1">s = Series(date_range(</span><span class="s3">&quot;20130101&quot;</span><span class="s0">, </span><span class="s3">&quot;20130110&quot;</span><span class="s1">))</span>
    <span class="s1">inferred = frequencies.infer_freq(s)</span>
    <span class="s0">assert </span><span class="s1">inferred == </span><span class="s3">&quot;D&quot;</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;end&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">10</span><span class="s0">, </span><span class="s2">10.0</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_series_invalid_type(end):</span>
    <span class="s4"># see gh-6407</span>
    <span class="s1">msg = </span><span class="s3">&quot;cannot infer freq from a non-convertible dtype on a Series&quot;</span>
    <span class="s1">s = Series(np.arange(end))</span>

    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">frequencies.infer_freq(s)</span>


<span class="s0">def </span><span class="s1">test_series_inconvertible_string():</span>
    <span class="s4"># see gh-6407</span>
    <span class="s1">msg = </span><span class="s3">&quot;Unknown string format&quot;</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">frequencies.infer_freq(Series([</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;bar&quot;</span><span class="s1">]))</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;freq&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s3">&quot;L&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_series_period_index(freq):</span>
    <span class="s4"># see gh-6407</span>
    <span class="s4">#</span>
    <span class="s4"># Cannot infer on PeriodIndex</span>
    <span class="s1">msg = </span><span class="s3">&quot;cannot infer freq from a non-convertible dtype on a Series&quot;</span>
    <span class="s1">s = Series(period_range(</span><span class="s3">&quot;2013&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s2">10</span><span class="s0">, </span><span class="s1">freq=freq))</span>

    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">frequencies.infer_freq(s)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;freq&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;M&quot;</span><span class="s0">, </span><span class="s3">&quot;L&quot;</span><span class="s0">, </span><span class="s3">&quot;S&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_series_datetime_index(freq):</span>
    <span class="s1">s = Series(date_range(</span><span class="s3">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s2">10</span><span class="s0">, </span><span class="s1">freq=freq))</span>
    <span class="s1">inferred = frequencies.infer_freq(s)</span>
    <span class="s0">assert </span><span class="s1">inferred == freq</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;offset_func&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">frequencies._get_offset</span><span class="s0">,</span>
        <span class="s0">lambda </span><span class="s1">freq: date_range(</span><span class="s3">&quot;2011-01-01&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s2">5</span><span class="s0">, </span><span class="s1">freq=freq)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;freq&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s3">&quot;WEEKDAY&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;EOM&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;W@MON&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;W@TUE&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;W@WED&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;W@THU&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;W@FRI&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;W@SAT&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;W@SUN&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;Q@JAN&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;Q@FEB&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;Q@MAR&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;A@JAN&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;A@FEB&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;A@MAR&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;A@APR&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;A@MAY&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;A@JUN&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;A@JUL&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;A@AUG&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;A@SEP&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;A@OCT&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;A@NOV&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;A@DEC&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;Y@JAN&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;WOM@1MON&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;WOM@2MON&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;WOM@3MON&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;WOM@4MON&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;WOM@1TUE&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;WOM@2TUE&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;WOM@3TUE&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;WOM@4TUE&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;WOM@1WED&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;WOM@2WED&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;WOM@3WED&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;WOM@4WED&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;WOM@1THU&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;WOM@2THU&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;WOM@3THU&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;WOM@4THU&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;WOM@1FRI&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;WOM@2FRI&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;WOM@3FRI&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;WOM@4FRI&quot;</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_legacy_offset_warnings(offset_func</span><span class="s0">, </span><span class="s1">freq):</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=INVALID_FREQ_ERR_MSG):</span>
        <span class="s1">offset_func(freq)</span>


<span class="s0">def </span><span class="s1">test_ms_vs_capital_ms():</span>
    <span class="s1">left = frequencies._get_offset(</span><span class="s3">&quot;ms&quot;</span><span class="s1">)</span>
    <span class="s1">right = frequencies._get_offset(</span><span class="s3">&quot;MS&quot;</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">left == offsets.Milli()</span>
    <span class="s0">assert </span><span class="s1">right == offsets.MonthBegin()</span>
</pre>
</body>
</html>