<html>
<head>
<title>test_mrecords.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #629755; font-style: italic;}
.s3 { color: #cc7832;}
.s4 { color: #6897bb;}
.s5 { color: #a5c261;}
.s6 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_mrecords.py</font>
</center></td></tr></table>
<pre><span class="s0"># pylint: disable-msg=W0611, W0612, W0511,R0201</span>
<span class="s2">&quot;&quot;&quot;Tests suite for mrecords. 
 
:author: Pierre Gerard-Marchant 
:contact: pierregm_at_uga_dot_edu 
 
&quot;&quot;&quot;</span>
<span class="s3">import </span><span class="s1">numpy </span><span class="s3">as </span><span class="s1">np</span>
<span class="s3">import </span><span class="s1">numpy.ma </span><span class="s3">as </span><span class="s1">ma</span>
<span class="s3">from </span><span class="s1">numpy </span><span class="s3">import </span><span class="s1">recarray</span>
<span class="s3">from </span><span class="s1">numpy.ma </span><span class="s3">import </span><span class="s1">masked</span><span class="s3">, </span><span class="s1">nomask</span>
<span class="s3">from </span><span class="s1">numpy.testing </span><span class="s3">import </span><span class="s1">temppath</span>
<span class="s3">from </span><span class="s1">numpy.core.records </span><span class="s3">import </span><span class="s1">(</span>
    <span class="s1">fromrecords </span><span class="s3">as </span><span class="s1">recfromrecords</span><span class="s3">, </span><span class="s1">fromarrays </span><span class="s3">as </span><span class="s1">recfromarrays</span>
    <span class="s1">)</span>
<span class="s3">from </span><span class="s1">numpy.ma.mrecords </span><span class="s3">import </span><span class="s1">(</span>
    <span class="s1">MaskedRecords</span><span class="s3">, </span><span class="s1">mrecarray</span><span class="s3">, </span><span class="s1">fromarrays</span><span class="s3">, </span><span class="s1">fromtextfile</span><span class="s3">, </span><span class="s1">fromrecords</span><span class="s3">,</span>
    <span class="s1">addfield</span>
    <span class="s1">)</span>
<span class="s3">from </span><span class="s1">numpy.ma.testutils </span><span class="s3">import </span><span class="s1">(</span>
    <span class="s1">assert_</span><span class="s3">, </span><span class="s1">assert_equal</span><span class="s3">,</span>
    <span class="s1">assert_equal_records</span><span class="s3">,</span>
    <span class="s1">)</span>
<span class="s3">from </span><span class="s1">numpy.compat </span><span class="s3">import </span><span class="s1">pickle</span>


<span class="s3">class </span><span class="s1">TestMRecords:</span>

    <span class="s1">ilist = [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s1">]</span>
    <span class="s1">flist = [</span><span class="s4">1.1</span><span class="s3">, </span><span class="s4">2.2</span><span class="s3">, </span><span class="s4">3.3</span><span class="s3">, </span><span class="s4">4.4</span><span class="s3">, </span><span class="s4">5.5</span><span class="s1">]</span>
    <span class="s1">slist = [</span><span class="s5">b'one'</span><span class="s3">, </span><span class="s5">b'two'</span><span class="s3">, </span><span class="s5">b'three'</span><span class="s3">, </span><span class="s5">b'four'</span><span class="s3">, </span><span class="s5">b'five'</span><span class="s1">]</span>
    <span class="s1">ddtype = [(</span><span class="s6">'a'</span><span class="s3">, </span><span class="s1">int)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'b'</span><span class="s3">, </span><span class="s1">float)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'c'</span><span class="s3">, </span><span class="s6">'|S8'</span><span class="s1">)]</span>
    <span class="s1">mask = [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span>
    <span class="s1">base = ma.array(list(zip(ilist</span><span class="s3">, </span><span class="s1">flist</span><span class="s3">, </span><span class="s1">slist))</span><span class="s3">, </span><span class="s1">mask=mask</span><span class="s3">, </span><span class="s1">dtype=ddtype)</span>

    <span class="s3">def </span><span class="s1">test_byview(self):</span>
        <span class="s0"># Test creation by view</span>
        <span class="s1">base = self.base</span>
        <span class="s1">mbase = base.view(mrecarray)</span>
        <span class="s1">assert_equal(mbase.recordmask</span><span class="s3">, </span><span class="s1">base.recordmask)</span>
        <span class="s1">assert_equal_records(mbase._mask</span><span class="s3">, </span><span class="s1">base._mask)</span>
        <span class="s1">assert_(isinstance(mbase._data</span><span class="s3">, </span><span class="s1">recarray))</span>
        <span class="s1">assert_equal_records(mbase._data</span><span class="s3">, </span><span class="s1">base._data.view(recarray))</span>
        <span class="s3">for </span><span class="s1">field </span><span class="s3">in </span><span class="s1">(</span><span class="s6">'a'</span><span class="s3">, </span><span class="s6">'b'</span><span class="s3">, </span><span class="s6">'c'</span><span class="s1">):</span>
            <span class="s1">assert_equal(base[field]</span><span class="s3">, </span><span class="s1">mbase[field])</span>
        <span class="s1">assert_equal_records(mbase.view(mrecarray)</span><span class="s3">, </span><span class="s1">mbase)</span>

    <span class="s3">def </span><span class="s1">test_get(self):</span>
        <span class="s0"># Tests fields retrieval</span>
        <span class="s1">base = self.base.copy()</span>
        <span class="s1">mbase = base.view(mrecarray)</span>
        <span class="s0"># As fields..........</span>
        <span class="s3">for </span><span class="s1">field </span><span class="s3">in </span><span class="s1">(</span><span class="s6">'a'</span><span class="s3">, </span><span class="s6">'b'</span><span class="s3">, </span><span class="s6">'c'</span><span class="s1">):</span>
            <span class="s1">assert_equal(getattr(mbase</span><span class="s3">, </span><span class="s1">field)</span><span class="s3">, </span><span class="s1">mbase[field])</span>
            <span class="s1">assert_equal(base[field]</span><span class="s3">, </span><span class="s1">mbase[field])</span>
        <span class="s0"># as elements .......</span>
        <span class="s1">mbase_first = mbase[</span><span class="s4">0</span><span class="s1">]</span>
        <span class="s1">assert_(isinstance(mbase_first</span><span class="s3">, </span><span class="s1">mrecarray))</span>
        <span class="s1">assert_equal(mbase_first.dtype</span><span class="s3">, </span><span class="s1">mbase.dtype)</span>
        <span class="s1">assert_equal(mbase_first.tolist()</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1.1</span><span class="s3">, </span><span class="s5">b'one'</span><span class="s1">))</span>
        <span class="s0"># Used to be mask, now it's recordmask</span>
        <span class="s1">assert_equal(mbase_first.recordmask</span><span class="s3">, </span><span class="s1">nomask)</span>
        <span class="s1">assert_equal(mbase_first._mask.item()</span><span class="s3">, </span><span class="s1">(</span><span class="s3">False, False, False</span><span class="s1">))</span>
        <span class="s1">assert_equal(mbase_first[</span><span class="s6">'a'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mbase[</span><span class="s6">'a'</span><span class="s1">][</span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">mbase_last = mbase[-</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">assert_(isinstance(mbase_last</span><span class="s3">, </span><span class="s1">mrecarray))</span>
        <span class="s1">assert_equal(mbase_last.dtype</span><span class="s3">, </span><span class="s1">mbase.dtype)</span>
        <span class="s1">assert_equal(mbase_last.tolist()</span><span class="s3">, </span><span class="s1">(</span><span class="s3">None, None, None</span><span class="s1">))</span>
        <span class="s0"># Used to be mask, now it's recordmask</span>
        <span class="s1">assert_equal(mbase_last.recordmask</span><span class="s3">, True</span><span class="s1">)</span>
        <span class="s1">assert_equal(mbase_last._mask.item()</span><span class="s3">, </span><span class="s1">(</span><span class="s3">True, True, True</span><span class="s1">))</span>
        <span class="s1">assert_equal(mbase_last[</span><span class="s6">'a'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mbase[</span><span class="s6">'a'</span><span class="s1">][-</span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_((mbase_last[</span><span class="s6">'a'</span><span class="s1">] </span><span class="s3">is </span><span class="s1">masked))</span>
        <span class="s0"># as slice ..........</span>
        <span class="s1">mbase_sl = mbase[:</span><span class="s4">2</span><span class="s1">]</span>
        <span class="s1">assert_(isinstance(mbase_sl</span><span class="s3">, </span><span class="s1">mrecarray))</span>
        <span class="s1">assert_equal(mbase_sl.dtype</span><span class="s3">, </span><span class="s1">mbase.dtype)</span>
        <span class="s0"># Used to be mask, now it's recordmask</span>
        <span class="s1">assert_equal(mbase_sl.recordmask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal_records(mbase_sl.mask</span><span class="s3">,</span>
                             <span class="s1">np.array([(</span><span class="s3">False, False, False</span><span class="s1">)</span><span class="s3">,</span>
                                       <span class="s1">(</span><span class="s3">True, True, True</span><span class="s1">)]</span><span class="s3">,</span>
                                      <span class="s1">dtype=mbase._mask.dtype))</span>
        <span class="s1">assert_equal_records(mbase_sl</span><span class="s3">, </span><span class="s1">base[:</span><span class="s4">2</span><span class="s1">].view(mrecarray))</span>
        <span class="s3">for </span><span class="s1">field </span><span class="s3">in </span><span class="s1">(</span><span class="s6">'a'</span><span class="s3">, </span><span class="s6">'b'</span><span class="s3">, </span><span class="s6">'c'</span><span class="s1">):</span>
            <span class="s1">assert_equal(getattr(mbase_sl</span><span class="s3">, </span><span class="s1">field)</span><span class="s3">, </span><span class="s1">base[:</span><span class="s4">2</span><span class="s1">][field])</span>

    <span class="s3">def </span><span class="s1">test_set_fields(self):</span>
        <span class="s0"># Tests setting fields.</span>
        <span class="s1">base = self.base.copy()</span>
        <span class="s1">mbase = base.view(mrecarray)</span>
        <span class="s1">mbase = mbase.copy()</span>
        <span class="s1">mbase.fill_value = (</span><span class="s4">999999</span><span class="s3">, </span><span class="s4">1e20</span><span class="s3">, </span><span class="s6">'N/A'</span><span class="s1">)</span>
        <span class="s0"># Change the data, the mask should be conserved</span>
        <span class="s1">mbase.a._data[:] = </span><span class="s4">5</span>
        <span class="s1">assert_equal(mbase[</span><span class="s6">'a'</span><span class="s1">]._data</span><span class="s3">, </span><span class="s1">[</span><span class="s4">5</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">5</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase[</span><span class="s6">'a'</span><span class="s1">]._mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s0"># Change the elements, and the mask will follow</span>
        <span class="s1">mbase.a = </span><span class="s4">1</span>
        <span class="s1">assert_equal(mbase[</span><span class="s6">'a'</span><span class="s1">]._data</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">]*</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">assert_equal(ma.getmaskarray(mbase[</span><span class="s6">'a'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s1">]*</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s0"># Use to be _mask, now it's recordmask</span>
        <span class="s1">assert_equal(mbase.recordmask</span><span class="s3">, </span><span class="s1">[</span><span class="s3">False</span><span class="s1">]*</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">assert_equal(mbase._mask.tolist()</span><span class="s3">,</span>
                     <span class="s1">np.array([(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">,</span>
                               <span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">,</span>
                               <span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">,</span>
                               <span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">,</span>
                               <span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)]</span><span class="s3">,</span>
                              <span class="s1">dtype=bool))</span>
        <span class="s0"># Set a field to mask ........................</span>
        <span class="s1">mbase.c = masked</span>
        <span class="s0"># Use to be mask, and now it's still mask !</span>
        <span class="s1">assert_equal(mbase.c.mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">]*</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">assert_equal(mbase.c.recordmask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">]*</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">assert_equal(ma.getmaskarray(mbase[</span><span class="s6">'c'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">]*</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">assert_equal(ma.getdata(mbase[</span><span class="s6">'c'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[</span><span class="s5">b'N/A'</span><span class="s1">]*</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">assert_equal(mbase._mask.tolist()</span><span class="s3">,</span>
                     <span class="s1">np.array([(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">,</span>
                               <span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">,</span>
                               <span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">,</span>
                               <span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">,</span>
                               <span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)]</span><span class="s3">,</span>
                              <span class="s1">dtype=bool))</span>
        <span class="s0"># Set fields by slices .......................</span>
        <span class="s1">mbase = base.view(mrecarray).copy()</span>
        <span class="s1">mbase.a[</span><span class="s4">3</span><span class="s1">:] = </span><span class="s4">5</span>
        <span class="s1">assert_equal(mbase.a</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">5</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.a._mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">mbase.b[</span><span class="s4">3</span><span class="s1">:] = masked</span>
        <span class="s1">assert_equal(mbase.b</span><span class="s3">, </span><span class="s1">base[</span><span class="s6">'b'</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.b._mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s0"># Set fields globally..........................</span>
        <span class="s1">ndtype = [(</span><span class="s6">'alpha'</span><span class="s3">, </span><span class="s6">'|S1'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'num'</span><span class="s3">, </span><span class="s1">int)]</span>
        <span class="s1">data = ma.array([(</span><span class="s6">'a'</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'b'</span><span class="s3">, </span><span class="s4">2</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'c'</span><span class="s3">, </span><span class="s4">3</span><span class="s1">)]</span><span class="s3">, </span><span class="s1">dtype=ndtype)</span>
        <span class="s1">rdata = data.view(MaskedRecords)</span>
        <span class="s1">val = ma.array([</span><span class="s4">10</span><span class="s3">, </span><span class="s4">20</span><span class="s3">, </span><span class="s4">30</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>

        <span class="s1">rdata[</span><span class="s6">'num'</span><span class="s1">] = val</span>
        <span class="s1">assert_equal(rdata.num</span><span class="s3">, </span><span class="s1">val)</span>
        <span class="s1">assert_equal(rdata.num.mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_set_fields_mask(self):</span>
        <span class="s0"># Tests setting the mask of a field.</span>
        <span class="s1">base = self.base.copy()</span>
        <span class="s0"># This one has already a mask....</span>
        <span class="s1">mbase = base.view(mrecarray)</span>
        <span class="s1">mbase[</span><span class="s6">'a'</span><span class="s1">][-</span><span class="s4">2</span><span class="s1">] = masked</span>
        <span class="s1">assert_equal(mbase.a</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.a._mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s0"># This one has not yet</span>
        <span class="s1">mbase = fromarrays([np.arange(</span><span class="s4">5</span><span class="s1">)</span><span class="s3">, </span><span class="s1">np.random.rand(</span><span class="s4">5</span><span class="s1">)]</span><span class="s3">,</span>
                           <span class="s1">dtype=[(</span><span class="s6">'a'</span><span class="s3">, </span><span class="s1">int)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'b'</span><span class="s3">, </span><span class="s1">float)])</span>
        <span class="s1">mbase[</span><span class="s6">'a'</span><span class="s1">][-</span><span class="s4">2</span><span class="s1">] = masked</span>
        <span class="s1">assert_equal(mbase.a</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.a._mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_set_mask(self):</span>
        <span class="s1">base = self.base.copy()</span>
        <span class="s1">mbase = base.view(mrecarray)</span>
        <span class="s0"># Set the mask to True .......................</span>
        <span class="s1">mbase.mask = masked</span>
        <span class="s1">assert_equal(ma.getmaskarray(mbase[</span><span class="s6">'b'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">]*</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">assert_equal(mbase[</span><span class="s6">'a'</span><span class="s1">]._mask</span><span class="s3">, </span><span class="s1">mbase[</span><span class="s6">'b'</span><span class="s1">]._mask)</span>
        <span class="s1">assert_equal(mbase[</span><span class="s6">'a'</span><span class="s1">]._mask</span><span class="s3">, </span><span class="s1">mbase[</span><span class="s6">'c'</span><span class="s1">]._mask)</span>
        <span class="s1">assert_equal(mbase._mask.tolist()</span><span class="s3">,</span>
                     <span class="s1">np.array([(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)]*</span><span class="s4">5</span><span class="s3">, </span><span class="s1">dtype=bool))</span>
        <span class="s0"># Delete the mask ............................</span>
        <span class="s1">mbase.mask = nomask</span>
        <span class="s1">assert_equal(ma.getmaskarray(mbase[</span><span class="s6">'c'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s1">]*</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">assert_equal(mbase._mask.tolist()</span><span class="s3">,</span>
                     <span class="s1">np.array([(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)]*</span><span class="s4">5</span><span class="s3">, </span><span class="s1">dtype=bool))</span>

    <span class="s3">def </span><span class="s1">test_set_mask_fromarray(self):</span>
        <span class="s1">base = self.base.copy()</span>
        <span class="s1">mbase = base.view(mrecarray)</span>
        <span class="s0"># Sets the mask w/ an array</span>
        <span class="s1">mbase.mask = [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">assert_equal(mbase.a.mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.b.mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.c.mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s0"># Yay, once more !</span>
        <span class="s1">mbase.mask = [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">assert_equal(mbase.a.mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.b.mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.c.mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_set_mask_fromfields(self):</span>
        <span class="s1">mbase = self.base.copy().view(mrecarray)</span>

        <span class="s1">nmask = np.array(</span>
            <span class="s1">[(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)]</span><span class="s3">,</span>
            <span class="s1">dtype=[(</span><span class="s6">'a'</span><span class="s3">, </span><span class="s1">bool)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'b'</span><span class="s3">, </span><span class="s1">bool)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'c'</span><span class="s3">, </span><span class="s1">bool)])</span>
        <span class="s1">mbase.mask = nmask</span>
        <span class="s1">assert_equal(mbase.a.mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.b.mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.c.mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s0"># Reinitialize and redo</span>
        <span class="s1">mbase.mask = </span><span class="s3">False</span>
        <span class="s1">mbase.fieldmask = nmask</span>
        <span class="s1">assert_equal(mbase.a.mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.b.mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.c.mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_set_elements(self):</span>
        <span class="s1">base = self.base.copy()</span>
        <span class="s0"># Set an element to mask .....................</span>
        <span class="s1">mbase = base.view(mrecarray).copy()</span>
        <span class="s1">mbase[-</span><span class="s4">2</span><span class="s1">] = masked</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">mbase._mask.tolist()</span><span class="s3">,</span>
            <span class="s1">np.array([(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)]</span><span class="s3">,</span>
                     <span class="s1">dtype=bool))</span>
        <span class="s0"># Used to be mask, now it's recordmask!</span>
        <span class="s1">assert_equal(mbase.recordmask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s0"># Set slices .................................</span>
        <span class="s1">mbase = base.view(mrecarray).copy()</span>
        <span class="s1">mbase[:</span><span class="s4">2</span><span class="s1">] = (</span><span class="s4">5</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">assert_equal(mbase.a._data</span><span class="s3">, </span><span class="s1">[</span><span class="s4">5</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.a._mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.b._data</span><span class="s3">, </span><span class="s1">[</span><span class="s4">5.</span><span class="s3">, </span><span class="s4">5.</span><span class="s3">, </span><span class="s4">3.3</span><span class="s3">, </span><span class="s4">4.4</span><span class="s3">, </span><span class="s4">5.5</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.b._mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.c._data</span><span class="s3">,</span>
                     <span class="s1">[</span><span class="s5">b'5'</span><span class="s3">, </span><span class="s5">b'5'</span><span class="s3">, </span><span class="s5">b'three'</span><span class="s3">, </span><span class="s5">b'four'</span><span class="s3">, </span><span class="s5">b'five'</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.b._mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>

        <span class="s1">mbase = base.view(mrecarray).copy()</span>
        <span class="s1">mbase[:</span><span class="s4">2</span><span class="s1">] = masked</span>
        <span class="s1">assert_equal(mbase.a._data</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.a._mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.b._data</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1.1</span><span class="s3">, </span><span class="s4">2.2</span><span class="s3">, </span><span class="s4">3.3</span><span class="s3">, </span><span class="s4">4.4</span><span class="s3">, </span><span class="s4">5.5</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.b._mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.c._data</span><span class="s3">,</span>
                     <span class="s1">[</span><span class="s5">b'one'</span><span class="s3">, </span><span class="s5">b'two'</span><span class="s3">, </span><span class="s5">b'three'</span><span class="s3">, </span><span class="s5">b'four'</span><span class="s3">, </span><span class="s5">b'five'</span><span class="s1">])</span>
        <span class="s1">assert_equal(mbase.b._mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_setslices_hardmask(self):</span>
        <span class="s0"># Tests setting slices w/ hardmask.</span>
        <span class="s1">base = self.base.copy()</span>
        <span class="s1">mbase = base.view(mrecarray)</span>
        <span class="s1">mbase.harden_mask()</span>
        <span class="s3">try</span><span class="s1">:</span>
            <span class="s1">mbase[-</span><span class="s4">2</span><span class="s1">:] = (</span><span class="s4">5</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">5</span><span class="s1">)</span>
            <span class="s1">assert_equal(mbase.a._data</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">5</span><span class="s1">])</span>
            <span class="s1">assert_equal(mbase.b._data</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1.1</span><span class="s3">, </span><span class="s4">2.2</span><span class="s3">, </span><span class="s4">3.3</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">5.5</span><span class="s1">])</span>
            <span class="s1">assert_equal(mbase.c._data</span><span class="s3">,</span>
                         <span class="s1">[</span><span class="s5">b'one'</span><span class="s3">, </span><span class="s5">b'two'</span><span class="s3">, </span><span class="s5">b'three'</span><span class="s3">, </span><span class="s5">b'5'</span><span class="s3">, </span><span class="s5">b'five'</span><span class="s1">])</span>
            <span class="s1">assert_equal(mbase.a._mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
            <span class="s1">assert_equal(mbase.b._mask</span><span class="s3">, </span><span class="s1">mbase.a._mask)</span>
            <span class="s1">assert_equal(mbase.b._mask</span><span class="s3">, </span><span class="s1">mbase.c._mask)</span>
        <span class="s3">except </span><span class="s1">NotImplementedError:</span>
            <span class="s0"># OK, not implemented yet...</span>
            <span class="s3">pass</span>
        <span class="s3">except </span><span class="s1">AssertionError:</span>
            <span class="s3">raise</span>
        <span class="s3">else</span><span class="s1">:</span>
            <span class="s3">raise </span><span class="s1">Exception(</span><span class="s6">&quot;Flexible hard masks should be supported !&quot;</span><span class="s1">)</span>
        <span class="s0"># Not using a tuple should crash</span>
        <span class="s3">try</span><span class="s1">:</span>
            <span class="s1">mbase[-</span><span class="s4">2</span><span class="s1">:] = </span><span class="s4">3</span>
        <span class="s3">except </span><span class="s1">(NotImplementedError</span><span class="s3">, </span><span class="s1">TypeError):</span>
            <span class="s3">pass</span>
        <span class="s3">else</span><span class="s1">:</span>
            <span class="s3">raise </span><span class="s1">TypeError(</span><span class="s6">&quot;Should have expected a readable buffer object!&quot;</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_hardmask(self):</span>
        <span class="s0"># Test hardmask</span>
        <span class="s1">base = self.base.copy()</span>
        <span class="s1">mbase = base.view(mrecarray)</span>
        <span class="s1">mbase.harden_mask()</span>
        <span class="s1">assert_(mbase._hardmask)</span>
        <span class="s1">mbase.mask = nomask</span>
        <span class="s1">assert_equal_records(mbase._mask</span><span class="s3">, </span><span class="s1">base._mask)</span>
        <span class="s1">mbase.soften_mask()</span>
        <span class="s1">assert_(</span><span class="s3">not </span><span class="s1">mbase._hardmask)</span>
        <span class="s1">mbase.mask = nomask</span>
        <span class="s0"># So, the mask of a field is no longer set to nomask...</span>
        <span class="s1">assert_equal_records(mbase._mask</span><span class="s3">,</span>
                             <span class="s1">ma.make_mask_none(base.shape</span><span class="s3">, </span><span class="s1">base.dtype))</span>
        <span class="s1">assert_(ma.make_mask(mbase[</span><span class="s6">'b'</span><span class="s1">]._mask) </span><span class="s3">is </span><span class="s1">nomask)</span>
        <span class="s1">assert_equal(mbase[</span><span class="s6">'a'</span><span class="s1">]._mask</span><span class="s3">, </span><span class="s1">mbase[</span><span class="s6">'b'</span><span class="s1">]._mask)</span>

    <span class="s3">def </span><span class="s1">test_pickling(self):</span>
        <span class="s0"># Test pickling</span>
        <span class="s1">base = self.base.copy()</span>
        <span class="s1">mrec = base.view(mrecarray)</span>
        <span class="s3">for </span><span class="s1">proto </span><span class="s3">in </span><span class="s1">range(</span><span class="s4">2</span><span class="s3">, </span><span class="s1">pickle.HIGHEST_PROTOCOL + </span><span class="s4">1</span><span class="s1">):</span>
            <span class="s1">_ = pickle.dumps(mrec</span><span class="s3">, </span><span class="s1">protocol=proto)</span>
            <span class="s1">mrec_ = pickle.loads(_)</span>
            <span class="s1">assert_equal(mrec_.dtype</span><span class="s3">, </span><span class="s1">mrec.dtype)</span>
            <span class="s1">assert_equal_records(mrec_._data</span><span class="s3">, </span><span class="s1">mrec._data)</span>
            <span class="s1">assert_equal(mrec_._mask</span><span class="s3">, </span><span class="s1">mrec._mask)</span>
            <span class="s1">assert_equal_records(mrec_._mask</span><span class="s3">, </span><span class="s1">mrec._mask)</span>

    <span class="s3">def </span><span class="s1">test_filled(self):</span>
        <span class="s0"># Test filling the array</span>
        <span class="s1">_a = ma.array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">dtype=int)</span>
        <span class="s1">_b = ma.array([</span><span class="s4">1.1</span><span class="s3">, </span><span class="s4">2.2</span><span class="s3">, </span><span class="s4">3.3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">dtype=float)</span>
        <span class="s1">_c = ma.array([</span><span class="s6">'one'</span><span class="s3">, </span><span class="s6">'two'</span><span class="s3">, </span><span class="s6">'three'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">dtype=</span><span class="s6">'|S8'</span><span class="s1">)</span>
        <span class="s1">ddtype = [(</span><span class="s6">'a'</span><span class="s3">, </span><span class="s1">int)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'b'</span><span class="s3">, </span><span class="s1">float)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'c'</span><span class="s3">, </span><span class="s6">'|S8'</span><span class="s1">)]</span>
        <span class="s1">mrec = fromarrays([_a</span><span class="s3">, </span><span class="s1">_b</span><span class="s3">, </span><span class="s1">_c]</span><span class="s3">, </span><span class="s1">dtype=ddtype</span><span class="s3">,</span>
                          <span class="s1">fill_value=(</span><span class="s4">99999</span><span class="s3">, </span><span class="s4">99999.</span><span class="s3">, </span><span class="s6">'N/A'</span><span class="s1">))</span>
        <span class="s1">mrecfilled = mrec.filled()</span>
        <span class="s1">assert_equal(mrecfilled[</span><span class="s6">'a'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">np.array((</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">99999</span><span class="s1">)</span><span class="s3">, </span><span class="s1">dtype=int))</span>
        <span class="s1">assert_equal(mrecfilled[</span><span class="s6">'b'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">np.array((</span><span class="s4">1.1</span><span class="s3">, </span><span class="s4">2.2</span><span class="s3">, </span><span class="s4">99999.</span><span class="s1">)</span><span class="s3">,</span>
                                               <span class="s1">dtype=float))</span>
        <span class="s1">assert_equal(mrecfilled[</span><span class="s6">'c'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">np.array((</span><span class="s6">'one'</span><span class="s3">, </span><span class="s6">'two'</span><span class="s3">, </span><span class="s6">'N/A'</span><span class="s1">)</span><span class="s3">,</span>
                                               <span class="s1">dtype=</span><span class="s6">'|S8'</span><span class="s1">))</span>

    <span class="s3">def </span><span class="s1">test_tolist(self):</span>
        <span class="s0"># Test tolist.</span>
        <span class="s1">_a = ma.array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">dtype=int)</span>
        <span class="s1">_b = ma.array([</span><span class="s4">1.1</span><span class="s3">, </span><span class="s4">2.2</span><span class="s3">, </span><span class="s4">3.3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">dtype=float)</span>
        <span class="s1">_c = ma.array([</span><span class="s6">'one'</span><span class="s3">, </span><span class="s6">'two'</span><span class="s3">, </span><span class="s6">'three'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">dtype=</span><span class="s6">'|S8'</span><span class="s1">)</span>
        <span class="s1">ddtype = [(</span><span class="s6">'a'</span><span class="s3">, </span><span class="s1">int)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'b'</span><span class="s3">, </span><span class="s1">float)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'c'</span><span class="s3">, </span><span class="s6">'|S8'</span><span class="s1">)]</span>
        <span class="s1">mrec = fromarrays([_a</span><span class="s3">, </span><span class="s1">_b</span><span class="s3">, </span><span class="s1">_c]</span><span class="s3">, </span><span class="s1">dtype=ddtype</span><span class="s3">,</span>
                          <span class="s1">fill_value=(</span><span class="s4">99999</span><span class="s3">, </span><span class="s4">99999.</span><span class="s3">, </span><span class="s6">'N/A'</span><span class="s1">))</span>

        <span class="s1">assert_equal(mrec.tolist()</span><span class="s3">,</span>
                     <span class="s1">[(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1.1</span><span class="s3">, None</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2.2</span><span class="s3">, </span><span class="s5">b'two'</span><span class="s1">)</span><span class="s3">,</span>
                      <span class="s1">(</span><span class="s3">None, None, </span><span class="s5">b'three'</span><span class="s1">)])</span>

    <span class="s3">def </span><span class="s1">test_withnames(self):</span>
        <span class="s0"># Test the creation w/ format and names</span>
        <span class="s1">x = mrecarray(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">formats=float</span><span class="s3">, </span><span class="s1">names=</span><span class="s6">'base'</span><span class="s1">)</span>
        <span class="s1">x[</span><span class="s4">0</span><span class="s1">][</span><span class="s6">'base'</span><span class="s1">] = </span><span class="s4">10</span>
        <span class="s1">assert_equal(x[</span><span class="s6">'base'</span><span class="s1">][</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s4">10</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_exotic_formats(self):</span>
        <span class="s0"># Test that 'exotic' formats are processed properly</span>
        <span class="s1">easy = mrecarray(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">dtype=[(</span><span class="s6">'i'</span><span class="s3">, </span><span class="s1">int)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'s'</span><span class="s3">, </span><span class="s6">'|S8'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'f'</span><span class="s3">, </span><span class="s1">float)])</span>
        <span class="s1">easy[</span><span class="s4">0</span><span class="s1">] = masked</span>
        <span class="s1">assert_equal(easy.filled(</span><span class="s4">1</span><span class="s1">).item()</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s5">b'1'</span><span class="s3">, </span><span class="s4">1.</span><span class="s1">))</span>

        <span class="s1">solo = mrecarray(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">dtype=[(</span><span class="s6">'f0'</span><span class="s3">, </span><span class="s6">'&lt;f8'</span><span class="s3">, </span><span class="s1">(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s1">))])</span>
        <span class="s1">solo[</span><span class="s4">0</span><span class="s1">] = masked</span>
        <span class="s1">assert_equal(solo.filled(</span><span class="s4">1</span><span class="s1">).item()</span><span class="s3">,</span>
                     <span class="s1">np.array((</span><span class="s4">1</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">dtype=solo.dtype).item())</span>

        <span class="s1">mult = mrecarray(</span><span class="s4">2</span><span class="s3">, </span><span class="s1">dtype=</span><span class="s6">&quot;i4, (2,3)float, float&quot;</span><span class="s1">)</span>
        <span class="s1">mult[</span><span class="s4">0</span><span class="s1">] = masked</span>
        <span class="s1">mult[</span><span class="s4">1</span><span class="s1">] = (</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">mult.filled(</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_equal_records(mult.filled(</span><span class="s4">0</span><span class="s1">)</span><span class="s3">,</span>
                             <span class="s1">np.array([(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)]</span><span class="s3">,</span>
                                      <span class="s1">dtype=mult.dtype))</span>


<span class="s3">class </span><span class="s1">TestView:</span>

    <span class="s3">def </span><span class="s1">setup(self):</span>
        <span class="s1">(a</span><span class="s3">, </span><span class="s1">b) = (np.arange(</span><span class="s4">10</span><span class="s1">)</span><span class="s3">, </span><span class="s1">np.random.rand(</span><span class="s4">10</span><span class="s1">))</span>
        <span class="s1">ndtype = [(</span><span class="s6">'a'</span><span class="s3">, </span><span class="s1">float)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'b'</span><span class="s3">, </span><span class="s1">float)]</span>
        <span class="s1">arr = np.array(list(zip(a</span><span class="s3">, </span><span class="s1">b))</span><span class="s3">, </span><span class="s1">dtype=ndtype)</span>

        <span class="s1">mrec = fromarrays([a</span><span class="s3">, </span><span class="s1">b]</span><span class="s3">, </span><span class="s1">dtype=ndtype</span><span class="s3">, </span><span class="s1">fill_value=(-</span><span class="s4">9.</span><span class="s3">, </span><span class="s1">-</span><span class="s4">99.</span><span class="s1">))</span>
        <span class="s1">mrec.mask[</span><span class="s4">3</span><span class="s1">] = (</span><span class="s3">False, True</span><span class="s1">)</span>
        <span class="s1">self.data = (mrec</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">arr)</span>

    <span class="s3">def </span><span class="s1">test_view_by_itself(self):</span>
        <span class="s1">(mrec</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">arr) = self.data</span>
        <span class="s1">test = mrec.view()</span>
        <span class="s1">assert_(isinstance(test</span><span class="s3">, </span><span class="s1">MaskedRecords))</span>
        <span class="s1">assert_equal_records(test</span><span class="s3">, </span><span class="s1">mrec)</span>
        <span class="s1">assert_equal_records(test._mask</span><span class="s3">, </span><span class="s1">mrec._mask)</span>

    <span class="s3">def </span><span class="s1">test_view_simple_dtype(self):</span>
        <span class="s1">(mrec</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">arr) = self.data</span>
        <span class="s1">ntype = (float</span><span class="s3">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">test = mrec.view(ntype)</span>
        <span class="s1">assert_(isinstance(test</span><span class="s3">, </span><span class="s1">ma.MaskedArray))</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">np.array(list(zip(a</span><span class="s3">, </span><span class="s1">b))</span><span class="s3">, </span><span class="s1">dtype=float))</span>
        <span class="s1">assert_(test[</span><span class="s4">3</span><span class="s3">, </span><span class="s4">1</span><span class="s1">] </span><span class="s3">is </span><span class="s1">ma.masked)</span>

    <span class="s3">def </span><span class="s1">test_view_flexible_type(self):</span>
        <span class="s1">(mrec</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">arr) = self.data</span>
        <span class="s1">alttype = [(</span><span class="s6">'A'</span><span class="s3">, </span><span class="s1">float)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'B'</span><span class="s3">, </span><span class="s1">float)]</span>
        <span class="s1">test = mrec.view(alttype)</span>
        <span class="s1">assert_(isinstance(test</span><span class="s3">, </span><span class="s1">MaskedRecords))</span>
        <span class="s1">assert_equal_records(test</span><span class="s3">, </span><span class="s1">arr.view(alttype))</span>
        <span class="s1">assert_(test[</span><span class="s6">'B'</span><span class="s1">][</span><span class="s4">3</span><span class="s1">] </span><span class="s3">is </span><span class="s1">masked)</span>
        <span class="s1">assert_equal(test.dtype</span><span class="s3">, </span><span class="s1">np.dtype(alttype))</span>
        <span class="s1">assert_(test._fill_value </span><span class="s3">is None</span><span class="s1">)</span>


<span class="s0">##############################################################################</span>
<span class="s3">class </span><span class="s1">TestMRecordsImport:</span>

    <span class="s1">_a = ma.array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">dtype=int)</span>
    <span class="s1">_b = ma.array([</span><span class="s4">1.1</span><span class="s3">, </span><span class="s4">2.2</span><span class="s3">, </span><span class="s4">3.3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">dtype=float)</span>
    <span class="s1">_c = ma.array([</span><span class="s5">b'one'</span><span class="s3">, </span><span class="s5">b'two'</span><span class="s3">, </span><span class="s5">b'three'</span><span class="s1">]</span><span class="s3">,</span>
                  <span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">dtype=</span><span class="s6">'|S8'</span><span class="s1">)</span>
    <span class="s1">ddtype = [(</span><span class="s6">'a'</span><span class="s3">, </span><span class="s1">int)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'b'</span><span class="s3">, </span><span class="s1">float)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'c'</span><span class="s3">, </span><span class="s6">'|S8'</span><span class="s1">)]</span>
    <span class="s1">mrec = fromarrays([_a</span><span class="s3">, </span><span class="s1">_b</span><span class="s3">, </span><span class="s1">_c]</span><span class="s3">, </span><span class="s1">dtype=ddtype</span><span class="s3">,</span>
                      <span class="s1">fill_value=(</span><span class="s5">b'99999'</span><span class="s3">, </span><span class="s5">b'99999.'</span><span class="s3">,</span>
                                  <span class="s5">b'N/A'</span><span class="s1">))</span>
    <span class="s1">nrec = recfromarrays((_a._data</span><span class="s3">, </span><span class="s1">_b._data</span><span class="s3">, </span><span class="s1">_c._data)</span><span class="s3">, </span><span class="s1">dtype=ddtype)</span>
    <span class="s1">data = (mrec</span><span class="s3">, </span><span class="s1">nrec</span><span class="s3">, </span><span class="s1">ddtype)</span>

    <span class="s3">def </span><span class="s1">test_fromarrays(self):</span>
        <span class="s1">_a = ma.array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">dtype=int)</span>
        <span class="s1">_b = ma.array([</span><span class="s4">1.1</span><span class="s3">, </span><span class="s4">2.2</span><span class="s3">, </span><span class="s4">3.3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">dtype=float)</span>
        <span class="s1">_c = ma.array([</span><span class="s6">'one'</span><span class="s3">, </span><span class="s6">'two'</span><span class="s3">, </span><span class="s6">'three'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">dtype=</span><span class="s6">'|S8'</span><span class="s1">)</span>
        <span class="s1">(mrec</span><span class="s3">, </span><span class="s1">nrec</span><span class="s3">, </span><span class="s1">_) = self.data</span>
        <span class="s3">for </span><span class="s1">(f</span><span class="s3">, </span><span class="s1">l) </span><span class="s3">in </span><span class="s1">zip((</span><span class="s6">'a'</span><span class="s3">, </span><span class="s6">'b'</span><span class="s3">, </span><span class="s6">'c'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(_a</span><span class="s3">, </span><span class="s1">_b</span><span class="s3">, </span><span class="s1">_c)):</span>
            <span class="s1">assert_equal(getattr(mrec</span><span class="s3">, </span><span class="s1">f)._mask</span><span class="s3">, </span><span class="s1">l._mask)</span>
        <span class="s0"># One record only</span>
        <span class="s1">_x = ma.array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1.1</span><span class="s3">, </span><span class="s6">'one'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">dtype=object)</span>
        <span class="s1">assert_equal_records(fromarrays(_x</span><span class="s3">, </span><span class="s1">dtype=mrec.dtype)</span><span class="s3">, </span><span class="s1">mrec[</span><span class="s4">0</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_fromrecords(self):</span>
        <span class="s0"># Test construction from records.</span>
        <span class="s1">(mrec</span><span class="s3">, </span><span class="s1">nrec</span><span class="s3">, </span><span class="s1">ddtype) = self.data</span>
        <span class="s0">#......</span>
        <span class="s1">palist = [(</span><span class="s4">1</span><span class="s3">, </span><span class="s6">'abc'</span><span class="s3">, </span><span class="s4">3.7000002861022949</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">,</span>
                  <span class="s1">(</span><span class="s4">2</span><span class="s3">, </span><span class="s6">'xy'</span><span class="s3">, </span><span class="s4">6.6999998092651367</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">,</span>
                  <span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s6">' '</span><span class="s3">, </span><span class="s4">0.40000000596046448</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)]</span>
        <span class="s1">pa = recfromrecords(palist</span><span class="s3">, </span><span class="s1">names=</span><span class="s6">'c1, c2, c3, c4'</span><span class="s1">)</span>
        <span class="s1">mpa = fromrecords(palist</span><span class="s3">, </span><span class="s1">names=</span><span class="s6">'c1, c2, c3, c4'</span><span class="s1">)</span>
        <span class="s1">assert_equal_records(pa</span><span class="s3">, </span><span class="s1">mpa)</span>
        <span class="s0">#.....</span>
        <span class="s1">_mrec = fromrecords(nrec)</span>
        <span class="s1">assert_equal(_mrec.dtype</span><span class="s3">, </span><span class="s1">mrec.dtype)</span>
        <span class="s3">for </span><span class="s1">field </span><span class="s3">in </span><span class="s1">_mrec.dtype.names:</span>
            <span class="s1">assert_equal(getattr(_mrec</span><span class="s3">, </span><span class="s1">field)</span><span class="s3">, </span><span class="s1">getattr(mrec._data</span><span class="s3">, </span><span class="s1">field))</span>

        <span class="s1">_mrec = fromrecords(nrec.tolist()</span><span class="s3">, </span><span class="s1">names=</span><span class="s6">'c1,c2,c3'</span><span class="s1">)</span>
        <span class="s1">assert_equal(_mrec.dtype</span><span class="s3">, </span><span class="s1">[(</span><span class="s6">'c1'</span><span class="s3">, </span><span class="s1">int)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'c2'</span><span class="s3">, </span><span class="s1">float)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'c3'</span><span class="s3">, </span><span class="s6">'|S5'</span><span class="s1">)])</span>
        <span class="s3">for </span><span class="s1">(f</span><span class="s3">, </span><span class="s1">n) </span><span class="s3">in </span><span class="s1">zip((</span><span class="s6">'c1'</span><span class="s3">, </span><span class="s6">'c2'</span><span class="s3">, </span><span class="s6">'c3'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'a'</span><span class="s3">, </span><span class="s6">'b'</span><span class="s3">, </span><span class="s6">'c'</span><span class="s1">)):</span>
            <span class="s1">assert_equal(getattr(_mrec</span><span class="s3">, </span><span class="s1">f)</span><span class="s3">, </span><span class="s1">getattr(mrec._data</span><span class="s3">, </span><span class="s1">n))</span>

        <span class="s1">_mrec = fromrecords(mrec)</span>
        <span class="s1">assert_equal(_mrec.dtype</span><span class="s3">, </span><span class="s1">mrec.dtype)</span>
        <span class="s1">assert_equal_records(_mrec._data</span><span class="s3">, </span><span class="s1">mrec.filled())</span>
        <span class="s1">assert_equal_records(_mrec._mask</span><span class="s3">, </span><span class="s1">mrec._mask)</span>

    <span class="s3">def </span><span class="s1">test_fromrecords_wmask(self):</span>
        <span class="s0"># Tests construction from records w/ mask.</span>
        <span class="s1">(mrec</span><span class="s3">, </span><span class="s1">nrec</span><span class="s3">, </span><span class="s1">ddtype) = self.data</span>

        <span class="s1">_mrec = fromrecords(nrec.tolist()</span><span class="s3">, </span><span class="s1">dtype=ddtype</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">,</span><span class="s1">])</span>
        <span class="s1">assert_equal_records(_mrec._data</span><span class="s3">, </span><span class="s1">mrec._data)</span>
        <span class="s1">assert_equal(_mrec._mask.tolist()</span><span class="s3">, </span><span class="s1">[(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)])</span>

        <span class="s1">_mrec = fromrecords(nrec.tolist()</span><span class="s3">, </span><span class="s1">dtype=ddtype</span><span class="s3">, </span><span class="s1">mask=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal_records(_mrec._data</span><span class="s3">, </span><span class="s1">mrec._data)</span>
        <span class="s1">assert_equal(_mrec._mask.tolist()</span><span class="s3">, </span><span class="s1">[(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)])</span>

        <span class="s1">_mrec = fromrecords(nrec.tolist()</span><span class="s3">, </span><span class="s1">dtype=ddtype</span><span class="s3">, </span><span class="s1">mask=mrec._mask)</span>
        <span class="s1">assert_equal_records(_mrec._data</span><span class="s3">, </span><span class="s1">mrec._data)</span>
        <span class="s1">assert_equal(_mrec._mask.tolist()</span><span class="s3">, </span><span class="s1">mrec._mask.tolist())</span>

        <span class="s1">_mrec = fromrecords(nrec.tolist()</span><span class="s3">, </span><span class="s1">dtype=ddtype</span><span class="s3">,</span>
                            <span class="s1">mask=mrec._mask.tolist())</span>
        <span class="s1">assert_equal_records(_mrec._data</span><span class="s3">, </span><span class="s1">mrec._data)</span>
        <span class="s1">assert_equal(_mrec._mask.tolist()</span><span class="s3">, </span><span class="s1">mrec._mask.tolist())</span>

    <span class="s3">def </span><span class="s1">test_fromtextfile(self):</span>
        <span class="s0"># Tests reading from a text file.</span>
        <span class="s1">fcontent = (</span>
<span class="s6">&quot;&quot;&quot;# 
'One (S)','Two (I)','Three (F)','Four (M)','Five (-)','Six (C)' 
'strings',1,1.0,'mixed column',,1 
'with embedded &quot;double quotes&quot;',2,2.0,1.0,,1 
'strings',3,3.0E5,3,,1 
'strings',4,-1e-10,,,1 
&quot;&quot;&quot;</span><span class="s1">)</span>
        <span class="s3">with </span><span class="s1">temppath() </span><span class="s3">as </span><span class="s1">path:</span>
            <span class="s3">with </span><span class="s1">open(path</span><span class="s3">, </span><span class="s6">'w'</span><span class="s1">) </span><span class="s3">as </span><span class="s1">f:</span>
                <span class="s1">f.write(fcontent)</span>
            <span class="s1">mrectxt = fromtextfile(path</span><span class="s3">, </span><span class="s1">delimiter=</span><span class="s6">','</span><span class="s3">, </span><span class="s1">varnames=</span><span class="s6">'ABCDEFG'</span><span class="s1">)</span>
        <span class="s1">assert_(isinstance(mrectxt</span><span class="s3">, </span><span class="s1">MaskedRecords))</span>
        <span class="s1">assert_equal(mrectxt.F</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(mrectxt.E._mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(mrectxt.C</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3.e+5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1e-10</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_addfield(self):</span>
        <span class="s0"># Tests addfield</span>
        <span class="s1">(mrec</span><span class="s3">, </span><span class="s1">nrec</span><span class="s3">, </span><span class="s1">ddtype) = self.data</span>
        <span class="s1">(d</span><span class="s3">, </span><span class="s1">m) = ([</span><span class="s4">100</span><span class="s3">, </span><span class="s4">200</span><span class="s3">, </span><span class="s4">300</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">mrec = addfield(mrec</span><span class="s3">, </span><span class="s1">ma.array(d</span><span class="s3">, </span><span class="s1">mask=m))</span>
        <span class="s1">assert_equal(mrec.f3</span><span class="s3">, </span><span class="s1">d)</span>
        <span class="s1">assert_equal(mrec.f3._mask</span><span class="s3">, </span><span class="s1">m)</span>


<span class="s3">def </span><span class="s1">test_record_array_with_object_field():</span>
    <span class="s0"># Trac #1839</span>
    <span class="s1">y = ma.masked_array(</span>
        <span class="s1">[(</span><span class="s4">1</span><span class="s3">, </span><span class="s6">'2'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">3</span><span class="s3">, </span><span class="s6">'4'</span><span class="s1">)]</span><span class="s3">,</span>
        <span class="s1">mask=[(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)]</span><span class="s3">,</span>
        <span class="s1">dtype=[(</span><span class="s6">'a'</span><span class="s3">, </span><span class="s1">int)</span><span class="s3">, </span><span class="s1">(</span><span class="s6">'b'</span><span class="s3">, </span><span class="s1">object)])</span>
    <span class="s0"># getting an item used to fail</span>
    <span class="s1">y[</span><span class="s4">1</span><span class="s1">]</span>
</pre>
</body>
</html>