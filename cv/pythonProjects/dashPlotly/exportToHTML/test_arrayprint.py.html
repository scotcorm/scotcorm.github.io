<html>
<head>
<title>test_arrayprint.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #808080;}
.s4 { color: #6897bb;}
.s5 { color: #a5c261;}
.s6 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_arrayprint.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">sys</span>
<span class="s0">import </span><span class="s1">gc</span>
<span class="s0">from </span><span class="s1">hypothesis </span><span class="s0">import </span><span class="s1">given</span>
<span class="s0">from </span><span class="s1">hypothesis.extra </span><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">hynp</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy.testing </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">assert_</span><span class="s0">, </span><span class="s1">assert_equal</span><span class="s0">, </span><span class="s1">assert_raises</span><span class="s0">, </span><span class="s1">assert_warns</span><span class="s0">, </span><span class="s1">HAS_REFCOUNT</span><span class="s0">,</span>
    <span class="s1">assert_raises_regex</span><span class="s0">,</span>
    <span class="s1">)</span>
<span class="s0">import </span><span class="s1">textwrap</span>

<span class="s0">class </span><span class="s1">TestArrayRepr:</span>
    <span class="s0">def </span><span class="s1">test_nan_inf(self):</span>
        <span class="s1">x = np.array([np.nan</span><span class="s0">, </span><span class="s1">np.inf])</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s2">'array([nan, inf])'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_subclass(self):</span>
        <span class="s0">class </span><span class="s1">sub(np.ndarray): </span><span class="s0">pass</span>

        <span class="s3"># one dimensional</span>
        <span class="s1">x1d = np.array([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]).view(sub)</span>
        <span class="s1">assert_equal(repr(x1d)</span><span class="s0">, </span><span class="s2">'sub([1, 2])'</span><span class="s1">)</span>

        <span class="s3"># two dimensional</span>
        <span class="s1">x2d = np.array([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]]).view(sub)</span>
        <span class="s1">assert_equal(repr(x2d)</span><span class="s0">,</span>
            <span class="s2">'sub([[1, 2],</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'     [3, 4]])'</span><span class="s1">)</span>

        <span class="s3"># two dimensional with flexible dtype</span>
        <span class="s1">xstruct = np.ones((</span><span class="s4">2</span><span class="s0">,</span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=[(</span><span class="s2">'a'</span><span class="s0">, </span><span class="s2">'&lt;i4'</span><span class="s1">)]).view(sub)</span>
        <span class="s1">assert_equal(repr(xstruct)</span><span class="s0">,</span>
            <span class="s2">&quot;sub([[(1,), (1,)],</span><span class="s0">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;     [(1,), (1,)]], dtype=[('a', '&lt;i4')])&quot;</span>
        <span class="s1">)</span>

    <span class="s1">@pytest.mark.xfail(reason=</span><span class="s2">&quot;See gh-10544&quot;</span><span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_object_subclass(self):</span>
        <span class="s0">class </span><span class="s1">sub(np.ndarray):</span>
            <span class="s0">def </span><span class="s1">__new__(cls</span><span class="s0">, </span><span class="s1">inp):</span>
                <span class="s1">obj = np.asarray(inp).view(cls)</span>
                <span class="s0">return </span><span class="s1">obj</span>

            <span class="s0">def </span><span class="s1">__getitem__(self</span><span class="s0">, </span><span class="s1">ind):</span>
                <span class="s1">ret = super().__getitem__(ind)</span>
                <span class="s0">return </span><span class="s1">sub(ret)</span>

        <span class="s3"># test that object + subclass is OK:</span>
        <span class="s1">x = sub([</span><span class="s0">None, None</span><span class="s1">])</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s2">'sub([None, None], dtype=object)'</span><span class="s1">)</span>
        <span class="s1">assert_equal(str(x)</span><span class="s0">, </span><span class="s2">'[None None]'</span><span class="s1">)</span>

        <span class="s1">x = sub([</span><span class="s0">None, </span><span class="s1">sub([</span><span class="s0">None, None</span><span class="s1">])])</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">,</span>
            <span class="s2">'sub([None, sub([None, None], dtype=object)], dtype=object)'</span><span class="s1">)</span>
        <span class="s1">assert_equal(str(x)</span><span class="s0">, </span><span class="s2">'[None sub([None, None], dtype=object)]'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_0d_object_subclass(self):</span>
        <span class="s3"># make sure that subclasses which return 0ds instead</span>
        <span class="s3"># of scalars don't cause infinite recursion in str</span>
        <span class="s0">class </span><span class="s1">sub(np.ndarray):</span>
            <span class="s0">def </span><span class="s1">__new__(cls</span><span class="s0">, </span><span class="s1">inp):</span>
                <span class="s1">obj = np.asarray(inp).view(cls)</span>
                <span class="s0">return </span><span class="s1">obj</span>

            <span class="s0">def </span><span class="s1">__getitem__(self</span><span class="s0">, </span><span class="s1">ind):</span>
                <span class="s1">ret = super().__getitem__(ind)</span>
                <span class="s0">return </span><span class="s1">sub(ret)</span>

        <span class="s1">x = sub(</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s2">'sub(1)'</span><span class="s1">)</span>
        <span class="s1">assert_equal(str(x)</span><span class="s0">, </span><span class="s2">'1'</span><span class="s1">)</span>

        <span class="s1">x = sub([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s2">'sub([1, 1])'</span><span class="s1">)</span>
        <span class="s1">assert_equal(str(x)</span><span class="s0">, </span><span class="s2">'[1 1]'</span><span class="s1">)</span>

        <span class="s3"># check it works properly with object arrays too</span>
        <span class="s1">x = sub(</span><span class="s0">None</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s2">'sub(None, dtype=object)'</span><span class="s1">)</span>
        <span class="s1">assert_equal(str(x)</span><span class="s0">, </span><span class="s2">'None'</span><span class="s1">)</span>

        <span class="s3"># plus recursive object arrays (even depth &gt; 1)</span>
        <span class="s1">y = sub(</span><span class="s0">None</span><span class="s1">)</span>
        <span class="s1">x[()] = y</span>
        <span class="s1">y[()] = x</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">,</span>
            <span class="s2">'sub(sub(sub(..., dtype=object), dtype=object), dtype=object)'</span><span class="s1">)</span>
        <span class="s1">assert_equal(str(x)</span><span class="s0">, </span><span class="s2">'...'</span><span class="s1">)</span>
        <span class="s1">x[()] = </span><span class="s4">0  </span><span class="s3"># resolve circular references for garbage collector</span>

        <span class="s3"># nested 0d-subclass-object</span>
        <span class="s1">x = sub(</span><span class="s0">None</span><span class="s1">)</span>
        <span class="s1">x[()] = sub(</span><span class="s0">None</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s2">'sub(sub(None, dtype=object), dtype=object)'</span><span class="s1">)</span>
        <span class="s1">assert_equal(str(x)</span><span class="s0">, </span><span class="s2">'None'</span><span class="s1">)</span>

        <span class="s3"># gh-10663</span>
        <span class="s0">class </span><span class="s1">DuckCounter(np.ndarray):</span>
            <span class="s0">def </span><span class="s1">__getitem__(self</span><span class="s0">, </span><span class="s1">item):</span>
                <span class="s1">result = super().__getitem__(item)</span>
                <span class="s0">if not </span><span class="s1">isinstance(result</span><span class="s0">, </span><span class="s1">DuckCounter):</span>
                    <span class="s1">result = result[...].view(DuckCounter)</span>
                <span class="s0">return </span><span class="s1">result</span>

            <span class="s0">def </span><span class="s1">to_string(self):</span>
                <span class="s0">return </span><span class="s1">{</span><span class="s4">0</span><span class="s1">: </span><span class="s2">'zero'</span><span class="s0">, </span><span class="s4">1</span><span class="s1">: </span><span class="s2">'one'</span><span class="s0">, </span><span class="s4">2</span><span class="s1">: </span><span class="s2">'two'</span><span class="s1">}.get(self.item()</span><span class="s0">, </span><span class="s2">'many'</span><span class="s1">)</span>

            <span class="s0">def </span><span class="s1">__str__(self):</span>
                <span class="s0">if </span><span class="s1">self.shape == ():</span>
                    <span class="s0">return </span><span class="s1">self.to_string()</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">fmt = {</span><span class="s2">'all'</span><span class="s1">: </span><span class="s0">lambda </span><span class="s1">x: x.to_string()}</span>
                    <span class="s0">return </span><span class="s1">np.array2string(self</span><span class="s0">, </span><span class="s1">formatter=fmt)</span>

        <span class="s1">dc = np.arange(</span><span class="s4">5</span><span class="s1">).view(DuckCounter)</span>
        <span class="s1">assert_equal(str(dc)</span><span class="s0">, </span><span class="s2">&quot;[zero one two many many]&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(str(dc[</span><span class="s4">0</span><span class="s1">])</span><span class="s0">, </span><span class="s2">&quot;zero&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_self_containing(self):</span>
        <span class="s1">arr0d = np.array(</span><span class="s0">None</span><span class="s1">)</span>
        <span class="s1">arr0d[()] = arr0d</span>
        <span class="s1">assert_equal(repr(arr0d)</span><span class="s0">,</span>
            <span class="s2">'array(array(..., dtype=object), dtype=object)'</span><span class="s1">)</span>
        <span class="s1">arr0d[()] = </span><span class="s4">0  </span><span class="s3"># resolve recursion for garbage collector</span>

        <span class="s1">arr1d = np.array([</span><span class="s0">None, None</span><span class="s1">])</span>
        <span class="s1">arr1d[</span><span class="s4">1</span><span class="s1">] = arr1d</span>
        <span class="s1">assert_equal(repr(arr1d)</span><span class="s0">,</span>
            <span class="s2">'array([None, array(..., dtype=object)], dtype=object)'</span><span class="s1">)</span>
        <span class="s1">arr1d[</span><span class="s4">1</span><span class="s1">] = </span><span class="s4">0  </span><span class="s3"># resolve recursion for garbage collector</span>

        <span class="s1">first = np.array(</span><span class="s0">None</span><span class="s1">)</span>
        <span class="s1">second = np.array(</span><span class="s0">None</span><span class="s1">)</span>
        <span class="s1">first[()] = second</span>
        <span class="s1">second[()] = first</span>
        <span class="s1">assert_equal(repr(first)</span><span class="s0">,</span>
            <span class="s2">'array(array(array(..., dtype=object), dtype=object), dtype=object)'</span><span class="s1">)</span>
        <span class="s1">first[()] = </span><span class="s4">0  </span><span class="s3"># resolve circular references for garbage collector</span>

    <span class="s0">def </span><span class="s1">test_containing_list(self):</span>
        <span class="s3"># printing square brackets directly would be ambiguuous</span>
        <span class="s1">arr1d = np.array([</span><span class="s0">None, None</span><span class="s1">])</span>
        <span class="s1">arr1d[</span><span class="s4">0</span><span class="s1">] = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
        <span class="s1">arr1d[</span><span class="s4">1</span><span class="s1">] = [</span><span class="s4">3</span><span class="s1">]</span>
        <span class="s1">assert_equal(repr(arr1d)</span><span class="s0">,</span>
            <span class="s2">'array([list([1, 2]), list([3])], dtype=object)'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_void_scalar_recursion(self):</span>
        <span class="s3"># gh-9345</span>
        <span class="s1">repr(np.void(</span><span class="s5">b'test'</span><span class="s1">))  </span><span class="s3"># RecursionError ?</span>

    <span class="s0">def </span><span class="s1">test_fieldless_structured(self):</span>
        <span class="s3"># gh-10366</span>
        <span class="s1">no_fields = np.dtype([])</span>
        <span class="s1">arr_no_fields = np.empty(</span><span class="s4">4</span><span class="s0">, </span><span class="s1">dtype=no_fields)</span>
        <span class="s1">assert_equal(repr(arr_no_fields)</span><span class="s0">, </span><span class="s2">'array([(), (), (), ()], dtype=[])'</span><span class="s1">)</span>


<span class="s0">class </span><span class="s1">TestComplexArray:</span>
    <span class="s0">def </span><span class="s1">test_str(self):</span>
        <span class="s1">rvals = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">np.inf</span><span class="s0">, </span><span class="s1">-np.inf</span><span class="s0">, </span><span class="s1">np.nan]</span>
        <span class="s1">cvals = [complex(rp</span><span class="s0">, </span><span class="s1">ip) </span><span class="s0">for </span><span class="s1">rp </span><span class="s0">in </span><span class="s1">rvals </span><span class="s0">for </span><span class="s1">ip </span><span class="s0">in </span><span class="s1">rvals]</span>
        <span class="s1">dtypes = [np.complex64</span><span class="s0">, </span><span class="s1">np.cdouble</span><span class="s0">, </span><span class="s1">np.clongdouble]</span>
        <span class="s1">actual = [str(np.array([c]</span><span class="s0">, </span><span class="s1">dt)) </span><span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">cvals </span><span class="s0">for </span><span class="s1">dt </span><span class="s0">in </span><span class="s1">dtypes]</span>
        <span class="s1">wanted = [</span>
            <span class="s2">'[0.+0.j]'</span><span class="s0">,    </span><span class="s2">'[0.+0.j]'</span><span class="s0">,    </span><span class="s2">'[0.+0.j]'</span><span class="s0">,</span>
            <span class="s2">'[0.+1.j]'</span><span class="s0">,    </span><span class="s2">'[0.+1.j]'</span><span class="s0">,    </span><span class="s2">'[0.+1.j]'</span><span class="s0">,</span>
            <span class="s2">'[0.-1.j]'</span><span class="s0">,    </span><span class="s2">'[0.-1.j]'</span><span class="s0">,    </span><span class="s2">'[0.-1.j]'</span><span class="s0">,</span>
            <span class="s2">'[0.+infj]'</span><span class="s0">,   </span><span class="s2">'[0.+infj]'</span><span class="s0">,   </span><span class="s2">'[0.+infj]'</span><span class="s0">,</span>
            <span class="s2">'[0.-infj]'</span><span class="s0">,   </span><span class="s2">'[0.-infj]'</span><span class="s0">,   </span><span class="s2">'[0.-infj]'</span><span class="s0">,</span>
            <span class="s2">'[0.+nanj]'</span><span class="s0">,   </span><span class="s2">'[0.+nanj]'</span><span class="s0">,   </span><span class="s2">'[0.+nanj]'</span><span class="s0">,</span>
            <span class="s2">'[1.+0.j]'</span><span class="s0">,    </span><span class="s2">'[1.+0.j]'</span><span class="s0">,    </span><span class="s2">'[1.+0.j]'</span><span class="s0">,</span>
            <span class="s2">'[1.+1.j]'</span><span class="s0">,    </span><span class="s2">'[1.+1.j]'</span><span class="s0">,    </span><span class="s2">'[1.+1.j]'</span><span class="s0">,</span>
            <span class="s2">'[1.-1.j]'</span><span class="s0">,    </span><span class="s2">'[1.-1.j]'</span><span class="s0">,    </span><span class="s2">'[1.-1.j]'</span><span class="s0">,</span>
            <span class="s2">'[1.+infj]'</span><span class="s0">,   </span><span class="s2">'[1.+infj]'</span><span class="s0">,   </span><span class="s2">'[1.+infj]'</span><span class="s0">,</span>
            <span class="s2">'[1.-infj]'</span><span class="s0">,   </span><span class="s2">'[1.-infj]'</span><span class="s0">,   </span><span class="s2">'[1.-infj]'</span><span class="s0">,</span>
            <span class="s2">'[1.+nanj]'</span><span class="s0">,   </span><span class="s2">'[1.+nanj]'</span><span class="s0">,   </span><span class="s2">'[1.+nanj]'</span><span class="s0">,</span>
            <span class="s2">'[-1.+0.j]'</span><span class="s0">,   </span><span class="s2">'[-1.+0.j]'</span><span class="s0">,   </span><span class="s2">'[-1.+0.j]'</span><span class="s0">,</span>
            <span class="s2">'[-1.+1.j]'</span><span class="s0">,   </span><span class="s2">'[-1.+1.j]'</span><span class="s0">,   </span><span class="s2">'[-1.+1.j]'</span><span class="s0">,</span>
            <span class="s2">'[-1.-1.j]'</span><span class="s0">,   </span><span class="s2">'[-1.-1.j]'</span><span class="s0">,   </span><span class="s2">'[-1.-1.j]'</span><span class="s0">,</span>
            <span class="s2">'[-1.+infj]'</span><span class="s0">,  </span><span class="s2">'[-1.+infj]'</span><span class="s0">,  </span><span class="s2">'[-1.+infj]'</span><span class="s0">,</span>
            <span class="s2">'[-1.-infj]'</span><span class="s0">,  </span><span class="s2">'[-1.-infj]'</span><span class="s0">,  </span><span class="s2">'[-1.-infj]'</span><span class="s0">,</span>
            <span class="s2">'[-1.+nanj]'</span><span class="s0">,  </span><span class="s2">'[-1.+nanj]'</span><span class="s0">,  </span><span class="s2">'[-1.+nanj]'</span><span class="s0">,</span>
            <span class="s2">'[inf+0.j]'</span><span class="s0">,   </span><span class="s2">'[inf+0.j]'</span><span class="s0">,   </span><span class="s2">'[inf+0.j]'</span><span class="s0">,</span>
            <span class="s2">'[inf+1.j]'</span><span class="s0">,   </span><span class="s2">'[inf+1.j]'</span><span class="s0">,   </span><span class="s2">'[inf+1.j]'</span><span class="s0">,</span>
            <span class="s2">'[inf-1.j]'</span><span class="s0">,   </span><span class="s2">'[inf-1.j]'</span><span class="s0">,   </span><span class="s2">'[inf-1.j]'</span><span class="s0">,</span>
            <span class="s2">'[inf+infj]'</span><span class="s0">,  </span><span class="s2">'[inf+infj]'</span><span class="s0">,  </span><span class="s2">'[inf+infj]'</span><span class="s0">,</span>
            <span class="s2">'[inf-infj]'</span><span class="s0">,  </span><span class="s2">'[inf-infj]'</span><span class="s0">,  </span><span class="s2">'[inf-infj]'</span><span class="s0">,</span>
            <span class="s2">'[inf+nanj]'</span><span class="s0">,  </span><span class="s2">'[inf+nanj]'</span><span class="s0">,  </span><span class="s2">'[inf+nanj]'</span><span class="s0">,</span>
            <span class="s2">'[-inf+0.j]'</span><span class="s0">,  </span><span class="s2">'[-inf+0.j]'</span><span class="s0">,  </span><span class="s2">'[-inf+0.j]'</span><span class="s0">,</span>
            <span class="s2">'[-inf+1.j]'</span><span class="s0">,  </span><span class="s2">'[-inf+1.j]'</span><span class="s0">,  </span><span class="s2">'[-inf+1.j]'</span><span class="s0">,</span>
            <span class="s2">'[-inf-1.j]'</span><span class="s0">,  </span><span class="s2">'[-inf-1.j]'</span><span class="s0">,  </span><span class="s2">'[-inf-1.j]'</span><span class="s0">,</span>
            <span class="s2">'[-inf+infj]'</span><span class="s0">, </span><span class="s2">'[-inf+infj]'</span><span class="s0">, </span><span class="s2">'[-inf+infj]'</span><span class="s0">,</span>
            <span class="s2">'[-inf-infj]'</span><span class="s0">, </span><span class="s2">'[-inf-infj]'</span><span class="s0">, </span><span class="s2">'[-inf-infj]'</span><span class="s0">,</span>
            <span class="s2">'[-inf+nanj]'</span><span class="s0">, </span><span class="s2">'[-inf+nanj]'</span><span class="s0">, </span><span class="s2">'[-inf+nanj]'</span><span class="s0">,</span>
            <span class="s2">'[nan+0.j]'</span><span class="s0">,   </span><span class="s2">'[nan+0.j]'</span><span class="s0">,   </span><span class="s2">'[nan+0.j]'</span><span class="s0">,</span>
            <span class="s2">'[nan+1.j]'</span><span class="s0">,   </span><span class="s2">'[nan+1.j]'</span><span class="s0">,   </span><span class="s2">'[nan+1.j]'</span><span class="s0">,</span>
            <span class="s2">'[nan-1.j]'</span><span class="s0">,   </span><span class="s2">'[nan-1.j]'</span><span class="s0">,   </span><span class="s2">'[nan-1.j]'</span><span class="s0">,</span>
            <span class="s2">'[nan+infj]'</span><span class="s0">,  </span><span class="s2">'[nan+infj]'</span><span class="s0">,  </span><span class="s2">'[nan+infj]'</span><span class="s0">,</span>
            <span class="s2">'[nan-infj]'</span><span class="s0">,  </span><span class="s2">'[nan-infj]'</span><span class="s0">,  </span><span class="s2">'[nan-infj]'</span><span class="s0">,</span>
            <span class="s2">'[nan+nanj]'</span><span class="s0">,  </span><span class="s2">'[nan+nanj]'</span><span class="s0">,  </span><span class="s2">'[nan+nanj]'</span><span class="s1">]</span>

        <span class="s0">for </span><span class="s1">res</span><span class="s0">, </span><span class="s1">val </span><span class="s0">in </span><span class="s1">zip(actual</span><span class="s0">, </span><span class="s1">wanted):</span>
            <span class="s1">assert_equal(res</span><span class="s0">, </span><span class="s1">val)</span>

<span class="s0">class </span><span class="s1">TestArray2String:</span>
    <span class="s0">def </span><span class="s1">test_basic(self):</span>
        <span class="s6">&quot;&quot;&quot;Basic test of array2string.&quot;&quot;&quot;</span>
        <span class="s1">a = np.arange(</span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">assert_(np.array2string(a) == </span><span class="s2">'[0 1 2]'</span><span class="s1">)</span>
        <span class="s1">assert_(np.array2string(a</span><span class="s0">, </span><span class="s1">max_line_width=</span><span class="s4">4</span><span class="s0">, </span><span class="s1">legacy=</span><span class="s2">'1.13'</span><span class="s1">) == </span><span class="s2">'[0 1</span><span class="s0">\n </span><span class="s2">2]'</span><span class="s1">)</span>
        <span class="s1">assert_(np.array2string(a</span><span class="s0">, </span><span class="s1">max_line_width=</span><span class="s4">4</span><span class="s1">) == </span><span class="s2">'[0</span><span class="s0">\n </span><span class="s2">1</span><span class="s0">\n </span><span class="s2">2]'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_unexpected_kwarg(self):</span>
        <span class="s3"># ensure than an appropriate TypeError</span>
        <span class="s3"># is raised when array2string receives</span>
        <span class="s3"># an unexpected kwarg</span>

        <span class="s0">with </span><span class="s1">assert_raises_regex(TypeError</span><span class="s0">, </span><span class="s2">'nonsense'</span><span class="s1">):</span>
            <span class="s1">np.array2string(np.array([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span><span class="s0">,</span>
                            <span class="s1">nonsense=</span><span class="s0">None</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_format_function(self):</span>
        <span class="s6">&quot;&quot;&quot;Test custom format function for each element in array.&quot;&quot;&quot;</span>
        <span class="s0">def </span><span class="s1">_format_function(x):</span>
            <span class="s0">if </span><span class="s1">np.abs(x) &lt; </span><span class="s4">1</span><span class="s1">:</span>
                <span class="s0">return </span><span class="s2">'.'</span>
            <span class="s0">elif </span><span class="s1">np.abs(x) &lt; </span><span class="s4">2</span><span class="s1">:</span>
                <span class="s0">return </span><span class="s2">'o'</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s0">return </span><span class="s2">'O'</span>

        <span class="s1">x = np.arange(</span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">x_hex = </span><span class="s2">&quot;[0x0 0x1 0x2]&quot;</span>
        <span class="s1">x_oct = </span><span class="s2">&quot;[0o0 0o1 0o2]&quot;</span>
        <span class="s1">assert_(np.array2string(x</span><span class="s0">, </span><span class="s1">formatter={</span><span class="s2">'all'</span><span class="s1">:_format_function}) ==</span>
                <span class="s2">&quot;[. o O]&quot;</span><span class="s1">)</span>
        <span class="s1">assert_(np.array2string(x</span><span class="s0">, </span><span class="s1">formatter={</span><span class="s2">'int_kind'</span><span class="s1">:_format_function}) ==</span>
                <span class="s2">&quot;[. o O]&quot;</span><span class="s1">)</span>
        <span class="s1">assert_(np.array2string(x</span><span class="s0">, </span><span class="s1">formatter={</span><span class="s2">'all'</span><span class="s1">:</span><span class="s0">lambda </span><span class="s1">x: </span><span class="s2">&quot;%.4f&quot; </span><span class="s1">% x}) ==</span>
                <span class="s2">&quot;[0.0000 1.0000 2.0000]&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.array2string(x</span><span class="s0">, </span><span class="s1">formatter={</span><span class="s2">'int'</span><span class="s1">:</span><span class="s0">lambda </span><span class="s1">x: hex(x)})</span><span class="s0">,</span>
                <span class="s1">x_hex)</span>
        <span class="s1">assert_equal(np.array2string(x</span><span class="s0">, </span><span class="s1">formatter={</span><span class="s2">'int'</span><span class="s1">:</span><span class="s0">lambda </span><span class="s1">x: oct(x)})</span><span class="s0">,</span>
                <span class="s1">x_oct)</span>

        <span class="s1">x = np.arange(</span><span class="s4">3.</span><span class="s1">)</span>
        <span class="s1">assert_(np.array2string(x</span><span class="s0">, </span><span class="s1">formatter={</span><span class="s2">'float_kind'</span><span class="s1">:</span><span class="s0">lambda </span><span class="s1">x: </span><span class="s2">&quot;%.2f&quot; </span><span class="s1">% x}) ==</span>
                <span class="s2">&quot;[0.00 1.00 2.00]&quot;</span><span class="s1">)</span>
        <span class="s1">assert_(np.array2string(x</span><span class="s0">, </span><span class="s1">formatter={</span><span class="s2">'float'</span><span class="s1">:</span><span class="s0">lambda </span><span class="s1">x: </span><span class="s2">&quot;%.2f&quot; </span><span class="s1">% x}) ==</span>
                <span class="s2">&quot;[0.00 1.00 2.00]&quot;</span><span class="s1">)</span>

        <span class="s1">s = np.array([</span><span class="s2">'abc'</span><span class="s0">, </span><span class="s2">'def'</span><span class="s1">])</span>
        <span class="s1">assert_(np.array2string(s</span><span class="s0">, </span><span class="s1">formatter={</span><span class="s2">'numpystr'</span><span class="s1">:</span><span class="s0">lambda </span><span class="s1">s: s*</span><span class="s4">2</span><span class="s1">}) ==</span>
                <span class="s2">'[abcabc defdef]'</span><span class="s1">)</span>


    <span class="s0">def </span><span class="s1">test_structure_format(self):</span>
        <span class="s1">dt = np.dtype([(</span><span class="s2">'name'</span><span class="s0">, </span><span class="s1">np.str_</span><span class="s0">, </span><span class="s4">16</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'grades'</span><span class="s0">, </span><span class="s1">np.float64</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">,</span><span class="s1">))])</span>
        <span class="s1">x = np.array([(</span><span class="s2">'Sarah'</span><span class="s0">, </span><span class="s1">(</span><span class="s4">8.0</span><span class="s0">, </span><span class="s4">7.0</span><span class="s1">))</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'John'</span><span class="s0">, </span><span class="s1">(</span><span class="s4">6.0</span><span class="s0">, </span><span class="s4">7.0</span><span class="s1">))]</span><span class="s0">, </span><span class="s1">dtype=dt)</span>
        <span class="s1">assert_equal(np.array2string(x)</span><span class="s0">,</span>
                <span class="s2">&quot;[('Sarah', [8., 7.]) ('John', [6., 7.])]&quot;</span><span class="s1">)</span>

        <span class="s1">np.set_printoptions(legacy=</span><span class="s2">'1.13'</span><span class="s1">)</span>
        <span class="s0">try</span><span class="s1">:</span>
            <span class="s3"># for issue #5692</span>
            <span class="s1">A = np.zeros(shape=</span><span class="s4">10</span><span class="s0">, </span><span class="s1">dtype=[(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;M8[s]&quot;</span><span class="s1">)])</span>
            <span class="s1">A[</span><span class="s4">5</span><span class="s1">:].fill(np.datetime64(</span><span class="s2">'NaT'</span><span class="s1">))</span>
            <span class="s1">assert_equal(</span>
                <span class="s1">np.array2string(A)</span><span class="s0">,</span>
                <span class="s1">textwrap.dedent(</span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
                </span><span class="s2">[('1970-01-01T00:00:00',) ('1970-01-01T00:00:00',) ('1970-01-01T00:00:00',) 
                 ('1970-01-01T00:00:00',) ('1970-01-01T00:00:00',) ('NaT',) ('NaT',) 
                 ('NaT',) ('NaT',) ('NaT',)]&quot;&quot;&quot;</span><span class="s1">)</span>
            <span class="s1">)</span>
        <span class="s0">finally</span><span class="s1">:</span>
            <span class="s1">np.set_printoptions(legacy=</span><span class="s0">False</span><span class="s1">)</span>

        <span class="s3"># same again, but with non-legacy behavior</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">np.array2string(A)</span><span class="s0">,</span>
            <span class="s1">textwrap.dedent(</span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s2">[('1970-01-01T00:00:00',) ('1970-01-01T00:00:00',) 
             ('1970-01-01T00:00:00',) ('1970-01-01T00:00:00',) 
             ('1970-01-01T00:00:00',) (                'NaT',) 
             (                'NaT',) (                'NaT',) 
             (                'NaT',) (                'NaT',)]&quot;&quot;&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>

        <span class="s3"># and again, with timedeltas</span>
        <span class="s1">A = np.full(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">123456</span><span class="s0">, </span><span class="s1">dtype=[(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;m8[s]&quot;</span><span class="s1">)])</span>
        <span class="s1">A[</span><span class="s4">5</span><span class="s1">:].fill(np.datetime64(</span><span class="s2">'NaT'</span><span class="s1">))</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">np.array2string(A)</span><span class="s0">,</span>
            <span class="s1">textwrap.dedent(</span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s2">[(123456,) (123456,) (123456,) (123456,) (123456,) ( 'NaT',) ( 'NaT',) 
             ( 'NaT',) ( 'NaT',) ( 'NaT',)]&quot;&quot;&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>

        <span class="s3"># See #8160</span>
        <span class="s1">struct_int = np.array([([</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">([</span><span class="s4">123</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">dtype=[(</span><span class="s2">'B'</span><span class="s0">, </span><span class="s2">'i4'</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)])</span>
        <span class="s1">assert_equal(np.array2string(struct_int)</span><span class="s0">,</span>
                <span class="s2">&quot;[([  1,  -1],) ([123,   1],)]&quot;</span><span class="s1">)</span>
        <span class="s1">struct_2dint = np.array([([[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]]</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">([[</span><span class="s4">12</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]]</span><span class="s0">,</span><span class="s1">)]</span><span class="s0">,</span>
                <span class="s1">dtype=[(</span><span class="s2">'B'</span><span class="s0">, </span><span class="s2">'i4'</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">))])</span>
        <span class="s1">assert_equal(np.array2string(struct_2dint)</span><span class="s0">,</span>
                <span class="s2">&quot;[([[ 0,  1], [ 2,  3]],) ([[12,  0], [ 0,  0]],)]&quot;</span><span class="s1">)</span>

        <span class="s3"># See #8172</span>
        <span class="s1">array_scalar = np.array(</span>
                <span class="s1">(</span><span class="s4">1.</span><span class="s0">, </span><span class="s4">2.1234567890123456789</span><span class="s0">, </span><span class="s4">3.</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=(</span><span class="s2">'f8,f8,f8'</span><span class="s1">))</span>
        <span class="s1">assert_equal(np.array2string(array_scalar)</span><span class="s0">, </span><span class="s2">&quot;(1., 2.12345679, 3.)&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_unstructured_void_repr(self):</span>
        <span class="s1">a = np.array([</span><span class="s4">27</span><span class="s0">, </span><span class="s4">91</span><span class="s0">, </span><span class="s4">50</span><span class="s0">, </span><span class="s4">75</span><span class="s0">,  </span><span class="s4">7</span><span class="s0">, </span><span class="s4">65</span><span class="s0">, </span><span class="s4">10</span><span class="s0">,  </span><span class="s4">8</span><span class="s0">,</span>
                      <span class="s4">27</span><span class="s0">, </span><span class="s4">91</span><span class="s0">, </span><span class="s4">51</span><span class="s0">, </span><span class="s4">49</span><span class="s0">,</span><span class="s4">109</span><span class="s0">, </span><span class="s4">82</span><span class="s0">,</span><span class="s4">101</span><span class="s0">,</span><span class="s4">100</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">'u1'</span><span class="s1">).view(</span><span class="s2">'V8'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(a[</span><span class="s4">0</span><span class="s1">])</span><span class="s0">, </span><span class="s2">r&quot;void(b'\x1B\x5B\x32\x4B\x07\x41\x0A\x08')&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(str(a[</span><span class="s4">0</span><span class="s1">])</span><span class="s0">, </span><span class="s2">r&quot;b'\x1B\x5B\x32\x4B\x07\x41\x0A\x08'&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(a)</span><span class="s0">,</span>
            <span class="s2">r&quot;array([b'\x1B\x5B\x32\x4B\x07\x41\x0A\x08',&quot; &quot;</span><span class="s0">\n</span><span class="s2">&quot;</span>
            <span class="s2">r&quot;       b'\x1B\x5B\x33\x31\x6D\x52\x65\x64'], dtype='|V8')&quot;</span><span class="s1">)</span>

        <span class="s1">assert_equal(eval(repr(a)</span><span class="s0">, </span><span class="s1">vars(np))</span><span class="s0">, </span><span class="s1">a)</span>
        <span class="s1">assert_equal(eval(repr(a[</span><span class="s4">0</span><span class="s1">])</span><span class="s0">, </span><span class="s1">vars(np))</span><span class="s0">, </span><span class="s1">a[</span><span class="s4">0</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_edgeitems_kwarg(self):</span>
        <span class="s3"># previously the global print options would be taken over the kwarg</span>
        <span class="s1">arr = np.zeros(</span><span class="s4">3</span><span class="s0">, </span><span class="s1">int)</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">np.array2string(arr</span><span class="s0">, </span><span class="s1">edgeitems=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">threshold=</span><span class="s4">0</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s2">&quot;[0 ... 0]&quot;</span>
        <span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_summarize_1d(self):</span>
        <span class="s1">A = np.arange(</span><span class="s4">1001</span><span class="s1">)</span>
        <span class="s1">strA = </span><span class="s2">'[   0    1    2 ...  998  999 1000]'</span>
        <span class="s1">assert_equal(str(A)</span><span class="s0">, </span><span class="s1">strA)</span>

        <span class="s1">reprA = </span><span class="s2">'array([   0,    1,    2, ...,  998,  999, 1000])'</span>
        <span class="s1">assert_equal(repr(A)</span><span class="s0">, </span><span class="s1">reprA)</span>

    <span class="s0">def </span><span class="s1">test_summarize_2d(self):</span>
        <span class="s1">A = np.arange(</span><span class="s4">1002</span><span class="s1">).reshape(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">501</span><span class="s1">)</span>
        <span class="s1">strA = </span><span class="s2">'[[   0    1    2 ...  498  499  500]</span><span class="s0">\n</span><span class="s2">' </span><span class="s1">\</span>
               <span class="s2">' [ 501  502  503 ...  999 1000 1001]]'</span>
        <span class="s1">assert_equal(str(A)</span><span class="s0">, </span><span class="s1">strA)</span>

        <span class="s1">reprA = </span><span class="s2">'array([[   0,    1,    2, ...,  498,  499,  500],</span><span class="s0">\n</span><span class="s2">' </span><span class="s1">\</span>
                <span class="s2">'       [ 501,  502,  503, ...,  999, 1000, 1001]])'</span>
        <span class="s1">assert_equal(repr(A)</span><span class="s0">, </span><span class="s1">reprA)</span>

    <span class="s0">def </span><span class="s1">test_linewidth(self):</span>
        <span class="s1">a = np.full(</span><span class="s4">6</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>

        <span class="s0">def </span><span class="s1">make_str(a</span><span class="s0">, </span><span class="s1">width</span><span class="s0">, </span><span class="s1">**kw):</span>
            <span class="s0">return </span><span class="s1">np.array2string(a</span><span class="s0">, </span><span class="s1">separator=</span><span class="s2">&quot;&quot;</span><span class="s0">, </span><span class="s1">max_line_width=width</span><span class="s0">, </span><span class="s1">**kw)</span>

        <span class="s1">assert_equal(make_str(a</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s1">legacy=</span><span class="s2">'1.13'</span><span class="s1">)</span><span class="s0">, </span><span class="s2">'[111111]'</span><span class="s1">)</span>
        <span class="s1">assert_equal(make_str(a</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s1">legacy=</span><span class="s2">'1.13'</span><span class="s1">)</span><span class="s0">, </span><span class="s2">'[111111]'</span><span class="s1">)</span>
        <span class="s1">assert_equal(make_str(a</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s1">legacy=</span><span class="s2">'1.13'</span><span class="s1">)</span><span class="s0">, </span><span class="s2">'[1111</span><span class="s0">\n</span><span class="s2">'</span>
                                                    <span class="s2">' 11]'</span><span class="s1">)</span>

        <span class="s1">assert_equal(make_str(a</span><span class="s0">, </span><span class="s4">8</span><span class="s1">)</span><span class="s0">, </span><span class="s2">'[111111]'</span><span class="s1">)</span>
        <span class="s1">assert_equal(make_str(a</span><span class="s0">, </span><span class="s4">7</span><span class="s1">)</span><span class="s0">, </span><span class="s2">'[11111</span><span class="s0">\n</span><span class="s2">'</span>
                                     <span class="s2">' 1]'</span><span class="s1">)</span>
        <span class="s1">assert_equal(make_str(a</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s2">'[111</span><span class="s0">\n</span><span class="s2">'</span>
                                     <span class="s2">' 111]'</span><span class="s1">)</span>

        <span class="s1">b = a[</span><span class="s0">None,None,</span><span class="s1">:]</span>

        <span class="s1">assert_equal(make_str(b</span><span class="s0">, </span><span class="s4">12</span><span class="s0">, </span><span class="s1">legacy=</span><span class="s2">'1.13'</span><span class="s1">)</span><span class="s0">, </span><span class="s2">'[[[111111]]]'</span><span class="s1">)</span>
        <span class="s1">assert_equal(make_str(b</span><span class="s0">,  </span><span class="s4">9</span><span class="s0">, </span><span class="s1">legacy=</span><span class="s2">'1.13'</span><span class="s1">)</span><span class="s0">, </span><span class="s2">'[[[111111]]]'</span><span class="s1">)</span>
        <span class="s1">assert_equal(make_str(b</span><span class="s0">,  </span><span class="s4">8</span><span class="s0">, </span><span class="s1">legacy=</span><span class="s2">'1.13'</span><span class="s1">)</span><span class="s0">, </span><span class="s2">'[[[11111</span><span class="s0">\n</span><span class="s2">'</span>
                                                     <span class="s2">'   1]]]'</span><span class="s1">)</span>

        <span class="s1">assert_equal(make_str(b</span><span class="s0">, </span><span class="s4">12</span><span class="s1">)</span><span class="s0">, </span><span class="s2">'[[[111111]]]'</span><span class="s1">)</span>
        <span class="s1">assert_equal(make_str(b</span><span class="s0">,  </span><span class="s4">9</span><span class="s1">)</span><span class="s0">, </span><span class="s2">'[[[111</span><span class="s0">\n</span><span class="s2">'</span>
                                      <span class="s2">'   111]]]'</span><span class="s1">)</span>
        <span class="s1">assert_equal(make_str(b</span><span class="s0">,  </span><span class="s4">8</span><span class="s1">)</span><span class="s0">, </span><span class="s2">'[[[11</span><span class="s0">\n</span><span class="s2">'</span>
                                      <span class="s2">'   11</span><span class="s0">\n</span><span class="s2">'</span>
                                      <span class="s2">'   11]]]'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_wide_element(self):</span>
        <span class="s1">a = np.array([</span><span class="s2">'xxxxx'</span><span class="s1">])</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">np.array2string(a</span><span class="s0">, </span><span class="s1">max_line_width=</span><span class="s4">5</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s2">&quot;['xxxxx']&quot;</span>
        <span class="s1">)</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">np.array2string(a</span><span class="s0">, </span><span class="s1">max_line_width=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">legacy=</span><span class="s2">'1.13'</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s2">&quot;[ 'xxxxx']&quot;</span>
        <span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_multiline_repr(self):</span>
        <span class="s0">class </span><span class="s1">MultiLine:</span>
            <span class="s0">def </span><span class="s1">__repr__(self):</span>
                <span class="s0">return </span><span class="s2">&quot;Line 1</span><span class="s0">\n</span><span class="s2">Line 2&quot;</span>

        <span class="s1">a = np.array([[</span><span class="s0">None, </span><span class="s1">MultiLine()]</span><span class="s0">, </span><span class="s1">[MultiLine()</span><span class="s0">, None</span><span class="s1">]])</span>

        <span class="s1">assert_equal(</span>
            <span class="s1">np.array2string(a)</span><span class="s0">,</span>
            <span class="s2">'[[None Line 1</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'       Line 2]</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">' [Line 1</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'  Line 2 None]]'</span>
        <span class="s1">)</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">np.array2string(a</span><span class="s0">, </span><span class="s1">max_line_width=</span><span class="s4">5</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s2">'[[None</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'  Line 1</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'  Line 2]</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">' [Line 1</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'  Line 2</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'  None]]'</span>
        <span class="s1">)</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">repr(a)</span><span class="s0">,</span>
            <span class="s2">'array([[None, Line 1</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'              Line 2],</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'       [Line 1</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'        Line 2, None]], dtype=object)'</span>
        <span class="s1">)</span>

        <span class="s0">class </span><span class="s1">MultiLineLong:</span>
            <span class="s0">def </span><span class="s1">__repr__(self):</span>
                <span class="s0">return </span><span class="s2">&quot;Line 1</span><span class="s0">\n</span><span class="s2">LooooooooooongestLine2</span><span class="s0">\n</span><span class="s2">LongerLine 3&quot;</span>

        <span class="s1">a = np.array([[</span><span class="s0">None, </span><span class="s1">MultiLineLong()]</span><span class="s0">, </span><span class="s1">[MultiLineLong()</span><span class="s0">, None</span><span class="s1">]])</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">repr(a)</span><span class="s0">,</span>
            <span class="s2">'array([[None, Line 1</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'              LooooooooooongestLine2</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'              LongerLine 3          ],</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'       [Line 1</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'        LooooooooooongestLine2</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'        LongerLine 3          , None]], dtype=object)'</span>
        <span class="s1">)</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">np.array_repr(a</span><span class="s0">, </span><span class="s4">20</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s2">'array([[None,</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'        Line 1</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'        LooooooooooongestLine2</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'        LongerLine 3          ],</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'       [Line 1</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'        LooooooooooongestLine2</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'        LongerLine 3          ,</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'        None]],</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'      dtype=object)'</span>
        <span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_nested_array_repr(self):</span>
        <span class="s1">a = np.empty((</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=object)</span>
        <span class="s1">a[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">] = np.eye(</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">a[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">] = np.eye(</span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">a[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">] = </span><span class="s0">None</span>
        <span class="s1">a[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">] = np.ones((</span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">repr(a)</span><span class="s0">,</span>
            <span class="s2">'array([[array([[1., 0.],</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'               [0., 1.]]), array([[1., 0., 0.],</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'                                  [0., 1., 0.],</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'                                  [0., 0., 1.]])],</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'       [None, array([[1.],</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'                     [1.],</span><span class="s0">\n</span><span class="s2">'</span>
            <span class="s2">'                     [1.]])]], dtype=object)'</span>
        <span class="s1">)</span>

    <span class="s1">@given(hynp.from_dtype(np.dtype(</span><span class="s2">&quot;U&quot;</span><span class="s1">)))</span>
    <span class="s0">def </span><span class="s1">test_any_text(self</span><span class="s0">, </span><span class="s1">text):</span>
        <span class="s3"># This test checks that, given any value that can be represented in an</span>
        <span class="s3"># array of dtype(&quot;U&quot;) (i.e. unicode string), ...</span>
        <span class="s1">a = np.array([text</span><span class="s0">, </span><span class="s1">text</span><span class="s0">, </span><span class="s1">text])</span>
        <span class="s3"># casting a list of them to an array does not e.g. truncate the value</span>
        <span class="s1">assert_equal(a[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">text)</span>
        <span class="s3"># and that np.array2string puts a newline in the expected location</span>
        <span class="s1">expected_repr = </span><span class="s2">&quot;[{0!r} {0!r}</span><span class="s0">\n </span><span class="s2">{0!r}]&quot;</span><span class="s1">.format(text)</span>
        <span class="s1">result = np.array2string(a</span><span class="s0">, </span><span class="s1">max_line_width=len(repr(text)) * </span><span class="s4">2 </span><span class="s1">+ </span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">assert_equal(result</span><span class="s0">, </span><span class="s1">expected_repr)</span>

    <span class="s1">@pytest.mark.skipif(</span><span class="s0">not </span><span class="s1">HAS_REFCOUNT</span><span class="s0">, </span><span class="s1">reason=</span><span class="s2">&quot;Python lacks refcounts&quot;</span><span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_refcount(self):</span>
        <span class="s3"># make sure we do not hold references to the array due to a recursive</span>
        <span class="s3"># closure (gh-10620)</span>
        <span class="s1">gc.disable()</span>
        <span class="s1">a = np.arange(</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">r1 = sys.getrefcount(a)</span>
        <span class="s1">np.array2string(a)</span>
        <span class="s1">np.array2string(a)</span>
        <span class="s1">r2 = sys.getrefcount(a)</span>
        <span class="s1">gc.collect()</span>
        <span class="s1">gc.enable()</span>
        <span class="s1">assert_(r1 == r2)</span>

<span class="s0">class </span><span class="s1">TestPrintOptions:</span>
    <span class="s6">&quot;&quot;&quot;Test getting and setting global print options.&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">setup(self):</span>
        <span class="s1">self.oldopts = np.get_printoptions()</span>

    <span class="s0">def </span><span class="s1">teardown(self):</span>
        <span class="s1">np.set_printoptions(**self.oldopts)</span>

    <span class="s0">def </span><span class="s1">test_basic(self):</span>
        <span class="s1">x = np.array([</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1.234567890</span><span class="s1">])</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s2">&quot;array([1.5       , 0.        , 1.23456789])&quot;</span><span class="s1">)</span>
        <span class="s1">np.set_printoptions(precision=</span><span class="s4">4</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s2">&quot;array([1.5   , 0.    , 1.2346])&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_precision_zero(self):</span>
        <span class="s1">np.set_printoptions(precision=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">values</span><span class="s0">, </span><span class="s1">string </span><span class="s0">in </span><span class="s1">(</span>
                <span class="s1">([</span><span class="s4">0.</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;0.&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">([</span><span class="s4">.3</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;0.&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">([-</span><span class="s4">.3</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;-0.&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">([</span><span class="s4">.7</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;1.&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">([</span><span class="s4">1.5</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;2.&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">([-</span><span class="s4">1.5</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;-2.&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">([-</span><span class="s4">15.34</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;-15.&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">([</span><span class="s4">100.</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;100.&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">([</span><span class="s4">.2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">122.51</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;  0.,  -1., 123.&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">([</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;0&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">([-</span><span class="s4">12</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;-12&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">([complex(</span><span class="s4">.3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">.7</span><span class="s1">)]</span><span class="s0">, </span><span class="s2">&quot;0.-1.j&quot;</span><span class="s1">)):</span>
            <span class="s1">x = np.array(values)</span>
            <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s2">&quot;array([%s])&quot; </span><span class="s1">% string)</span>

    <span class="s0">def </span><span class="s1">test_formatter(self):</span>
        <span class="s1">x = np.arange(</span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">np.set_printoptions(formatter={</span><span class="s2">'all'</span><span class="s1">:</span><span class="s0">lambda </span><span class="s1">x: str(x-</span><span class="s4">1</span><span class="s1">)})</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s2">&quot;array([-1, 0, 1])&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_formatter_reset(self):</span>
        <span class="s1">x = np.arange(</span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">np.set_printoptions(formatter={</span><span class="s2">'all'</span><span class="s1">:</span><span class="s0">lambda </span><span class="s1">x: str(x-</span><span class="s4">1</span><span class="s1">)})</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s2">&quot;array([-1, 0, 1])&quot;</span><span class="s1">)</span>
        <span class="s1">np.set_printoptions(formatter={</span><span class="s2">'int'</span><span class="s1">:</span><span class="s0">None</span><span class="s1">})</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s2">&quot;array([0, 1, 2])&quot;</span><span class="s1">)</span>

        <span class="s1">np.set_printoptions(formatter={</span><span class="s2">'all'</span><span class="s1">:</span><span class="s0">lambda </span><span class="s1">x: str(x-</span><span class="s4">1</span><span class="s1">)})</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s2">&quot;array([-1, 0, 1])&quot;</span><span class="s1">)</span>
        <span class="s1">np.set_printoptions(formatter={</span><span class="s2">'all'</span><span class="s1">:</span><span class="s0">None</span><span class="s1">})</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s2">&quot;array([0, 1, 2])&quot;</span><span class="s1">)</span>

        <span class="s1">np.set_printoptions(formatter={</span><span class="s2">'int'</span><span class="s1">:</span><span class="s0">lambda </span><span class="s1">x: str(x-</span><span class="s4">1</span><span class="s1">)})</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s2">&quot;array([-1, 0, 1])&quot;</span><span class="s1">)</span>
        <span class="s1">np.set_printoptions(formatter={</span><span class="s2">'int_kind'</span><span class="s1">:</span><span class="s0">None</span><span class="s1">})</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s2">&quot;array([0, 1, 2])&quot;</span><span class="s1">)</span>

        <span class="s1">x = np.arange(</span><span class="s4">3.</span><span class="s1">)</span>
        <span class="s1">np.set_printoptions(formatter={</span><span class="s2">'float'</span><span class="s1">:</span><span class="s0">lambda </span><span class="s1">x: str(x-</span><span class="s4">1</span><span class="s1">)})</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s2">&quot;array([-1.0, 0.0, 1.0])&quot;</span><span class="s1">)</span>
        <span class="s1">np.set_printoptions(formatter={</span><span class="s2">'float_kind'</span><span class="s1">:</span><span class="s0">None</span><span class="s1">})</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s2">&quot;array([0., 1., 2.])&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_0d_arrays(self):</span>
        <span class="s1">assert_equal(str(np.array(</span><span class="s2">u'café'</span><span class="s0">, </span><span class="s2">'&lt;U4'</span><span class="s1">))</span><span class="s0">, </span><span class="s2">u'café'</span><span class="s1">)</span>

        <span class="s1">assert_equal(repr(np.array(</span><span class="s2">'café'</span><span class="s0">, </span><span class="s2">'&lt;U4'</span><span class="s1">))</span><span class="s0">,</span>
                     <span class="s2">&quot;array('café', dtype='&lt;U4')&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(str(np.array(</span><span class="s2">'test'</span><span class="s0">, </span><span class="s1">np.str_))</span><span class="s0">, </span><span class="s2">'test'</span><span class="s1">)</span>

        <span class="s1">a = np.zeros(</span><span class="s4">1</span><span class="s0">, </span><span class="s1">dtype=[(</span><span class="s2">'a'</span><span class="s0">, </span><span class="s2">'&lt;i4'</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3</span><span class="s0">,</span><span class="s1">))])</span>
        <span class="s1">assert_equal(str(a[</span><span class="s4">0</span><span class="s1">])</span><span class="s0">, </span><span class="s2">'([0, 0, 0],)'</span><span class="s1">)</span>

        <span class="s1">assert_equal(repr(np.datetime64(</span><span class="s2">'2005-02-25'</span><span class="s1">)[...])</span><span class="s0">,</span>
                     <span class="s2">&quot;array('2005-02-25', dtype='datetime64[D]')&quot;</span><span class="s1">)</span>

        <span class="s1">assert_equal(repr(np.timedelta64(</span><span class="s2">'10'</span><span class="s0">, </span><span class="s2">'Y'</span><span class="s1">)[...])</span><span class="s0">,</span>
                     <span class="s2">&quot;array(10, dtype='timedelta64[Y]')&quot;</span><span class="s1">)</span>

        <span class="s3"># repr of 0d arrays is affected by printoptions</span>
        <span class="s1">x = np.array(</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">np.set_printoptions(formatter={</span><span class="s2">'all'</span><span class="s1">:</span><span class="s0">lambda </span><span class="s1">x: </span><span class="s2">&quot;test&quot;</span><span class="s1">})</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s2">&quot;array(test)&quot;</span><span class="s1">)</span>
        <span class="s3"># str is unaffected</span>
        <span class="s1">assert_equal(str(x)</span><span class="s0">, </span><span class="s2">&quot;1&quot;</span><span class="s1">)</span>

        <span class="s3"># check `style` arg raises</span>
        <span class="s1">assert_warns(DeprecationWarning</span><span class="s0">, </span><span class="s1">np.array2string</span><span class="s0">,</span>
                                         <span class="s1">np.array(</span><span class="s4">1.</span><span class="s1">)</span><span class="s0">, </span><span class="s1">style=repr)</span>
        <span class="s3"># but not in legacy mode</span>
        <span class="s1">np.array2string(np.array(</span><span class="s4">1.</span><span class="s1">)</span><span class="s0">, </span><span class="s1">style=repr</span><span class="s0">, </span><span class="s1">legacy=</span><span class="s2">'1.13'</span><span class="s1">)</span>
        <span class="s3"># gh-10934 style was broken in legacy mode, check it works</span>
        <span class="s1">np.array2string(np.array(</span><span class="s4">1.</span><span class="s1">)</span><span class="s0">, </span><span class="s1">legacy=</span><span class="s2">'1.13'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_float_spacing(self):</span>
        <span class="s1">x = np.array([</span><span class="s4">1.</span><span class="s0">, </span><span class="s4">2.</span><span class="s0">, </span><span class="s4">3.</span><span class="s1">])</span>
        <span class="s1">y = np.array([</span><span class="s4">1.</span><span class="s0">, </span><span class="s4">2.</span><span class="s0">, </span><span class="s1">-</span><span class="s4">10.</span><span class="s1">])</span>
        <span class="s1">z = np.array([</span><span class="s4">100.</span><span class="s0">, </span><span class="s4">2.</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1.</span><span class="s1">])</span>
        <span class="s1">w = np.array([-</span><span class="s4">100.</span><span class="s0">, </span><span class="s4">2.</span><span class="s0">, </span><span class="s4">1.</span><span class="s1">])</span>

        <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s2">'array([1., 2., 3.])'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(y)</span><span class="s0">, </span><span class="s2">'array([  1.,   2., -10.])'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(np.array(y[</span><span class="s4">0</span><span class="s1">]))</span><span class="s0">, </span><span class="s2">'array(1.)'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(np.array(y[-</span><span class="s4">1</span><span class="s1">]))</span><span class="s0">, </span><span class="s2">'array(-10.)'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(z)</span><span class="s0">, </span><span class="s2">'array([100.,   2.,  -1.])'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(w)</span><span class="s0">, </span><span class="s2">'array([-100.,    2.,    1.])'</span><span class="s1">)</span>

        <span class="s1">assert_equal(repr(np.array([np.nan</span><span class="s0">, </span><span class="s1">np.inf]))</span><span class="s0">, </span><span class="s2">'array([nan, inf])'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(np.array([np.nan</span><span class="s0">, </span><span class="s1">-np.inf]))</span><span class="s0">, </span><span class="s2">'array([ nan, -inf])'</span><span class="s1">)</span>

        <span class="s1">x = np.array([np.inf</span><span class="s0">, </span><span class="s4">100000</span><span class="s0">, </span><span class="s4">1.1234</span><span class="s1">])</span>
        <span class="s1">y = np.array([np.inf</span><span class="s0">, </span><span class="s4">100000</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1.1234</span><span class="s1">])</span>
        <span class="s1">z = np.array([np.inf</span><span class="s0">, </span><span class="s4">1.1234</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1e120</span><span class="s1">])</span>
        <span class="s1">np.set_printoptions(precision=</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s2">'array([     inf, 1.00e+05, 1.12e+00])'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(y)</span><span class="s0">, </span><span class="s2">'array([      inf,  1.00e+05, -1.12e+00])'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(z)</span><span class="s0">, </span><span class="s2">'array([       inf,  1.12e+000, -1.00e+120])'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_bool_spacing(self):</span>
        <span class="s1">assert_equal(repr(np.array([</span><span class="s0">True,  True</span><span class="s1">]))</span><span class="s0">,</span>
                     <span class="s2">'array([ True,  True])'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(np.array([</span><span class="s0">True, False</span><span class="s1">]))</span><span class="s0">,</span>
                     <span class="s2">'array([ True, False])'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(np.array([</span><span class="s0">True</span><span class="s1">]))</span><span class="s0">,</span>
                     <span class="s2">'array([ True])'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(np.array(</span><span class="s0">True</span><span class="s1">))</span><span class="s0">,</span>
                     <span class="s2">'array(True)'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(np.array(</span><span class="s0">False</span><span class="s1">))</span><span class="s0">,</span>
                     <span class="s2">'array(False)'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_sign_spacing(self):</span>
        <span class="s1">a = np.arange(</span><span class="s4">4.</span><span class="s1">)</span>
        <span class="s1">b = np.array([</span><span class="s4">1.234e9</span><span class="s1">])</span>
        <span class="s1">c = np.array([</span><span class="s4">1.0 </span><span class="s1">+ </span><span class="s4">1.0j</span><span class="s0">, </span><span class="s4">1.123456789 </span><span class="s1">+ </span><span class="s4">1.123456789j</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">'c16'</span><span class="s1">)</span>

        <span class="s1">assert_equal(repr(a)</span><span class="s0">, </span><span class="s2">'array([0., 1., 2., 3.])'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(np.array(</span><span class="s4">1.</span><span class="s1">))</span><span class="s0">, </span><span class="s2">'array(1.)'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(b)</span><span class="s0">, </span><span class="s2">'array([1.234e+09])'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(np.array([</span><span class="s4">0.</span><span class="s1">]))</span><span class="s0">, </span><span class="s2">'array([0.])'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(c)</span><span class="s0">,</span>
            <span class="s2">&quot;array([1.        +1.j        , 1.12345679+1.12345679j])&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(np.array([</span><span class="s4">0.</span><span class="s0">, </span><span class="s1">-</span><span class="s4">0.</span><span class="s1">]))</span><span class="s0">, </span><span class="s2">'array([ 0., -0.])'</span><span class="s1">)</span>

        <span class="s1">np.set_printoptions(sign=</span><span class="s2">' '</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(a)</span><span class="s0">, </span><span class="s2">'array([ 0.,  1.,  2.,  3.])'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(np.array(</span><span class="s4">1.</span><span class="s1">))</span><span class="s0">, </span><span class="s2">'array( 1.)'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(b)</span><span class="s0">, </span><span class="s2">'array([ 1.234e+09])'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(c)</span><span class="s0">,</span>
            <span class="s2">&quot;array([ 1.        +1.j        ,  1.12345679+1.12345679j])&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(np.array([</span><span class="s4">0.</span><span class="s0">, </span><span class="s1">-</span><span class="s4">0.</span><span class="s1">]))</span><span class="s0">, </span><span class="s2">'array([ 0., -0.])'</span><span class="s1">)</span>

        <span class="s1">np.set_printoptions(sign=</span><span class="s2">'+'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(a)</span><span class="s0">, </span><span class="s2">'array([+0., +1., +2., +3.])'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(np.array(</span><span class="s4">1.</span><span class="s1">))</span><span class="s0">, </span><span class="s2">'array(+1.)'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(b)</span><span class="s0">, </span><span class="s2">'array([+1.234e+09])'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(c)</span><span class="s0">,</span>
            <span class="s2">&quot;array([+1.        +1.j        , +1.12345679+1.12345679j])&quot;</span><span class="s1">)</span>

        <span class="s1">np.set_printoptions(legacy=</span><span class="s2">'1.13'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(a)</span><span class="s0">, </span><span class="s2">'array([ 0.,  1.,  2.,  3.])'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(b)</span><span class="s0">,  </span><span class="s2">'array([  1.23400000e+09])'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(-b)</span><span class="s0">, </span><span class="s2">'array([ -1.23400000e+09])'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(np.array(</span><span class="s4">1.</span><span class="s1">))</span><span class="s0">, </span><span class="s2">'array(1.0)'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(np.array([</span><span class="s4">0.</span><span class="s1">]))</span><span class="s0">, </span><span class="s2">'array([ 0.])'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(c)</span><span class="s0">,</span>
            <span class="s2">&quot;array([ 1.00000000+1.j        ,  1.12345679+1.12345679j])&quot;</span><span class="s1">)</span>
        <span class="s3"># gh-10383</span>
        <span class="s1">assert_equal(str(np.array([-</span><span class="s4">1.</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]))</span><span class="s0">, </span><span class="s2">&quot;[ -1.  10.]&quot;</span><span class="s1">)</span>

        <span class="s1">assert_raises(TypeError</span><span class="s0">, </span><span class="s1">np.set_printoptions</span><span class="s0">, </span><span class="s1">wrongarg=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_float_overflow_nowarn(self):</span>
        <span class="s3"># make sure internal computations in FloatingFormat don't</span>
        <span class="s3"># warn about overflow</span>
        <span class="s1">repr(np.array([</span><span class="s4">1e4</span><span class="s0">, </span><span class="s4">0.1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">'f2'</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_sign_spacing_structured(self):</span>
        <span class="s1">a = np.ones(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">'&lt;f,&lt;f'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(a)</span><span class="s0">,</span>
            <span class="s2">&quot;array([(1., 1.), (1., 1.)], dtype=[('f0', '&lt;f4'), ('f1', '&lt;f4')])&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(a[</span><span class="s4">0</span><span class="s1">])</span><span class="s0">, </span><span class="s2">&quot;(1., 1.)&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_floatmode(self):</span>
        <span class="s1">x = np.array([</span><span class="s4">0.6104</span><span class="s0">, </span><span class="s4">0.922</span><span class="s0">, </span><span class="s4">0.457</span><span class="s0">, </span><span class="s4">0.0906</span><span class="s0">, </span><span class="s4">0.3733</span><span class="s0">, </span><span class="s4">0.007244</span><span class="s0">,</span>
                      <span class="s4">0.5933</span><span class="s0">, </span><span class="s4">0.947</span><span class="s0">, </span><span class="s4">0.2383</span><span class="s0">, </span><span class="s4">0.4226</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.float16)</span>
        <span class="s1">y = np.array([</span><span class="s4">0.2918820979355541</span><span class="s0">, </span><span class="s4">0.5064172631089138</span><span class="s0">,</span>
                      <span class="s4">0.2848750619642916</span><span class="s0">, </span><span class="s4">0.4342965294660567</span><span class="s0">,</span>
                      <span class="s4">0.7326538397312751</span><span class="s0">, </span><span class="s4">0.3459503329096204</span><span class="s0">,</span>
                      <span class="s4">0.0862072768214508</span><span class="s0">, </span><span class="s4">0.39112753029631175</span><span class="s1">]</span><span class="s0">,</span>
                      <span class="s1">dtype=np.float64)</span>
        <span class="s1">z = np.arange(</span><span class="s4">6</span><span class="s0">, </span><span class="s1">dtype=np.float16)/</span><span class="s4">10</span>
        <span class="s1">c = np.array([</span><span class="s4">1.0 </span><span class="s1">+ </span><span class="s4">1.0j</span><span class="s0">, </span><span class="s4">1.123456789 </span><span class="s1">+ </span><span class="s4">1.123456789j</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">'c16'</span><span class="s1">)</span>

        <span class="s3"># also make sure 1e23 is right (is between two fp numbers)</span>
        <span class="s1">w = np.array([</span><span class="s2">'1e{}'</span><span class="s1">.format(i) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">25</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">dtype=np.float64)</span>
        <span class="s3"># note: we construct w from the strings `1eXX` instead of doing</span>
        <span class="s3"># `10.**arange(24)` because it turns out the two are not equivalent in</span>
        <span class="s3"># python. On some architectures `1e23 != 10.**23`.</span>
        <span class="s1">wp = np.array([</span><span class="s4">1.234e1</span><span class="s0">, </span><span class="s4">1e2</span><span class="s0">, </span><span class="s4">1e123</span><span class="s1">])</span>

        <span class="s3"># unique mode</span>
        <span class="s1">np.set_printoptions(floatmode=</span><span class="s2">'unique'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">,</span>
            <span class="s2">&quot;array([0.6104  , 0.922   , 0.457   , 0.0906  , 0.3733  , 0.007244,</span><span class="s0">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;       0.5933  , 0.947   , 0.2383  , 0.4226  ], dtype=float16)&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(y)</span><span class="s0">,</span>
            <span class="s2">&quot;array([0.2918820979355541 , 0.5064172631089138 , 0.2848750619642916 ,</span><span class="s0">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;       0.4342965294660567 , 0.7326538397312751 , 0.3459503329096204 ,</span><span class="s0">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;       0.0862072768214508 , 0.39112753029631175])&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(z)</span><span class="s0">,</span>
            <span class="s2">&quot;array([0. , 0.1, 0.2, 0.3, 0.4, 0.5], dtype=float16)&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(w)</span><span class="s0">,</span>
            <span class="s2">&quot;array([1.e+00, 1.e+01, 1.e+02, 1.e+03, 1.e+04, 1.e+05, 1.e+06, 1.e+07,</span><span class="s0">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;       1.e+08, 1.e+09, 1.e+10, 1.e+11, 1.e+12, 1.e+13, 1.e+14, 1.e+15,</span><span class="s0">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;       1.e+16, 1.e+17, 1.e+18, 1.e+19, 1.e+20, 1.e+21, 1.e+22, 1.e+23,</span><span class="s0">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;       1.e+24])&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(wp)</span><span class="s0">, </span><span class="s2">&quot;array([1.234e+001, 1.000e+002, 1.000e+123])&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(c)</span><span class="s0">,</span>
            <span class="s2">&quot;array([1.         +1.j         , 1.123456789+1.123456789j])&quot;</span><span class="s1">)</span>

        <span class="s3"># maxprec mode, precision=8</span>
        <span class="s1">np.set_printoptions(floatmode=</span><span class="s2">'maxprec'</span><span class="s0">, </span><span class="s1">precision=</span><span class="s4">8</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">,</span>
            <span class="s2">&quot;array([0.6104  , 0.922   , 0.457   , 0.0906  , 0.3733  , 0.007244,</span><span class="s0">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;       0.5933  , 0.947   , 0.2383  , 0.4226  ], dtype=float16)&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(y)</span><span class="s0">,</span>
            <span class="s2">&quot;array([0.2918821 , 0.50641726, 0.28487506, 0.43429653, 0.73265384,</span><span class="s0">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;       0.34595033, 0.08620728, 0.39112753])&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(z)</span><span class="s0">,</span>
            <span class="s2">&quot;array([0. , 0.1, 0.2, 0.3, 0.4, 0.5], dtype=float16)&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(w[::</span><span class="s4">5</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s2">&quot;array([1.e+00, 1.e+05, 1.e+10, 1.e+15, 1.e+20])&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(wp)</span><span class="s0">, </span><span class="s2">&quot;array([1.234e+001, 1.000e+002, 1.000e+123])&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(c)</span><span class="s0">,</span>
            <span class="s2">&quot;array([1.        +1.j        , 1.12345679+1.12345679j])&quot;</span><span class="s1">)</span>

        <span class="s3"># fixed mode, precision=4</span>
        <span class="s1">np.set_printoptions(floatmode=</span><span class="s2">'fixed'</span><span class="s0">, </span><span class="s1">precision=</span><span class="s4">4</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">,</span>
            <span class="s2">&quot;array([0.6104, 0.9219, 0.4570, 0.0906, 0.3733, 0.0072, 0.5933, 0.9468,</span><span class="s0">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;       0.2383, 0.4226], dtype=float16)&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(y)</span><span class="s0">,</span>
            <span class="s2">&quot;array([0.2919, 0.5064, 0.2849, 0.4343, 0.7327, 0.3460, 0.0862, 0.3911])&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(z)</span><span class="s0">,</span>
            <span class="s2">&quot;array([0.0000, 0.1000, 0.2000, 0.3000, 0.3999, 0.5000], dtype=float16)&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(w[::</span><span class="s4">5</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s2">&quot;array([1.0000e+00, 1.0000e+05, 1.0000e+10, 1.0000e+15, 1.0000e+20])&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(wp)</span><span class="s0">, </span><span class="s2">&quot;array([1.2340e+001, 1.0000e+002, 1.0000e+123])&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(np.zeros(</span><span class="s4">3</span><span class="s1">))</span><span class="s0">, </span><span class="s2">&quot;array([0.0000, 0.0000, 0.0000])&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(c)</span><span class="s0">,</span>
            <span class="s2">&quot;array([1.0000+1.0000j, 1.1235+1.1235j])&quot;</span><span class="s1">)</span>
        <span class="s3"># for larger precision, representation error becomes more apparent:</span>
        <span class="s1">np.set_printoptions(floatmode=</span><span class="s2">'fixed'</span><span class="s0">, </span><span class="s1">precision=</span><span class="s4">8</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(z)</span><span class="s0">,</span>
            <span class="s2">&quot;array([0.00000000, 0.09997559, 0.19995117, 0.30004883, 0.39990234,</span><span class="s0">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;       0.50000000], dtype=float16)&quot;</span><span class="s1">)</span>

        <span class="s3"># maxprec_equal  mode, precision=8</span>
        <span class="s1">np.set_printoptions(floatmode=</span><span class="s2">'maxprec_equal'</span><span class="s0">, </span><span class="s1">precision=</span><span class="s4">8</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(x)</span><span class="s0">,</span>
            <span class="s2">&quot;array([0.610352, 0.921875, 0.457031, 0.090576, 0.373291, 0.007244,</span><span class="s0">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;       0.593262, 0.946777, 0.238281, 0.422607], dtype=float16)&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(y)</span><span class="s0">,</span>
            <span class="s2">&quot;array([0.29188210, 0.50641726, 0.28487506, 0.43429653, 0.73265384,</span><span class="s0">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;       0.34595033, 0.08620728, 0.39112753])&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(z)</span><span class="s0">,</span>
            <span class="s2">&quot;array([0.0, 0.1, 0.2, 0.3, 0.4, 0.5], dtype=float16)&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(w[::</span><span class="s4">5</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s2">&quot;array([1.e+00, 1.e+05, 1.e+10, 1.e+15, 1.e+20])&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(wp)</span><span class="s0">, </span><span class="s2">&quot;array([1.234e+001, 1.000e+002, 1.000e+123])&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(c)</span><span class="s0">,</span>
            <span class="s2">&quot;array([1.00000000+1.00000000j, 1.12345679+1.12345679j])&quot;</span><span class="s1">)</span>

        <span class="s3"># test unique special case (gh-18609)</span>
        <span class="s1">a = np.float64.fromhex(</span><span class="s2">'-1p-97'</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.float64(np.array2string(a</span><span class="s0">, </span><span class="s1">floatmode=</span><span class="s2">'unique'</span><span class="s1">))</span><span class="s0">, </span><span class="s1">a)</span>

    <span class="s0">def </span><span class="s1">test_legacy_mode_scalars(self):</span>
        <span class="s3"># in legacy mode, str of floats get truncated, and complex scalars</span>
        <span class="s3"># use * for non-finite imaginary part</span>
        <span class="s1">np.set_printoptions(legacy=</span><span class="s2">'1.13'</span><span class="s1">)</span>
        <span class="s1">assert_equal(str(np.float64(</span><span class="s4">1.123456789123456789</span><span class="s1">))</span><span class="s0">, </span><span class="s2">'1.12345678912'</span><span class="s1">)</span>
        <span class="s1">assert_equal(str(np.complex128(complex(</span><span class="s4">1</span><span class="s0">, </span><span class="s1">np.nan)))</span><span class="s0">, </span><span class="s2">'(1+nan*j)'</span><span class="s1">)</span>

        <span class="s1">np.set_printoptions(legacy=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">assert_equal(str(np.float64(</span><span class="s4">1.123456789123456789</span><span class="s1">))</span><span class="s0">,</span>
                     <span class="s2">'1.1234567891234568'</span><span class="s1">)</span>
        <span class="s1">assert_equal(str(np.complex128(complex(</span><span class="s4">1</span><span class="s0">, </span><span class="s1">np.nan)))</span><span class="s0">, </span><span class="s2">'(1+nanj)'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_legacy_stray_comma(self):</span>
        <span class="s1">np.set_printoptions(legacy=</span><span class="s2">'1.13'</span><span class="s1">)</span>
        <span class="s1">assert_equal(str(np.arange(</span><span class="s4">10000</span><span class="s1">))</span><span class="s0">, </span><span class="s2">'[   0    1    2 ..., 9997 9998 9999]'</span><span class="s1">)</span>

        <span class="s1">np.set_printoptions(legacy=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">assert_equal(str(np.arange(</span><span class="s4">10000</span><span class="s1">))</span><span class="s0">, </span><span class="s2">'[   0    1    2 ... 9997 9998 9999]'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_dtype_linewidth_wrapping(self):</span>
        <span class="s1">np.set_printoptions(linewidth=</span><span class="s4">75</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(np.arange(</span><span class="s4">10</span><span class="s0">,</span><span class="s4">20.</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">'f4'</span><span class="s1">))</span><span class="s0">,</span>
            <span class="s2">&quot;array([10., 11., 12., 13., 14., 15., 16., 17., 18., 19.], dtype=float32)&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(np.arange(</span><span class="s4">10</span><span class="s0">,</span><span class="s4">23.</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">'f4'</span><span class="s1">))</span><span class="s0">, </span><span class="s1">textwrap.dedent(</span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s2">array([10., 11., 12., 13., 14., 15., 16., 17., 18., 19., 20., 21., 22.], 
                  dtype=float32)&quot;&quot;&quot;</span><span class="s1">))</span>

        <span class="s1">styp = </span><span class="s2">'&lt;U4'</span>
        <span class="s1">assert_equal(repr(np.ones(</span><span class="s4">3</span><span class="s0">, </span><span class="s1">dtype=styp))</span><span class="s0">,</span>
            <span class="s2">&quot;array(['1', '1', '1'], dtype='{}')&quot;</span><span class="s1">.format(styp))</span>
        <span class="s1">assert_equal(repr(np.ones(</span><span class="s4">12</span><span class="s0">, </span><span class="s1">dtype=styp))</span><span class="s0">, </span><span class="s1">textwrap.dedent(</span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s2">array(['1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1'], 
                  dtype='{}')&quot;&quot;&quot;</span><span class="s1">.format(styp)))</span>

    <span class="s0">def </span><span class="s1">test_linewidth_repr(self):</span>
        <span class="s1">a = np.full(</span><span class="s4">7</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">np.set_printoptions(linewidth=</span><span class="s4">17</span><span class="s1">)</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">repr(a)</span><span class="s0">,</span>
            <span class="s1">textwrap.dedent(</span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s2">array([2, 2, 2, 
                   2, 2, 2, 
                   2])&quot;&quot;&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>
        <span class="s1">np.set_printoptions(linewidth=</span><span class="s4">17</span><span class="s0">, </span><span class="s1">legacy=</span><span class="s2">'1.13'</span><span class="s1">)</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">repr(a)</span><span class="s0">,</span>
            <span class="s1">textwrap.dedent(</span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s2">array([2, 2, 2, 
                   2, 2, 2, 2])&quot;&quot;&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>

        <span class="s1">a = np.full(</span><span class="s4">8</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s4">2</span><span class="s1">)</span>

        <span class="s1">np.set_printoptions(linewidth=</span><span class="s4">18</span><span class="s0">, </span><span class="s1">legacy=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">repr(a)</span><span class="s0">,</span>
            <span class="s1">textwrap.dedent(</span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s2">array([2, 2, 2, 
                   2, 2, 2, 
                   2, 2])&quot;&quot;&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>

        <span class="s1">np.set_printoptions(linewidth=</span><span class="s4">18</span><span class="s0">, </span><span class="s1">legacy=</span><span class="s2">'1.13'</span><span class="s1">)</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">repr(a)</span><span class="s0">,</span>
            <span class="s1">textwrap.dedent(</span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s2">array([2, 2, 2, 2, 
                   2, 2, 2, 2])&quot;&quot;&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_linewidth_str(self):</span>
        <span class="s1">a = np.full(</span><span class="s4">18</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">np.set_printoptions(linewidth=</span><span class="s4">18</span><span class="s1">)</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">str(a)</span><span class="s0">,</span>
            <span class="s1">textwrap.dedent(</span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s2">[2 2 2 2 2 2 2 2 
             2 2 2 2 2 2 2 2 
             2 2]&quot;&quot;&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>
        <span class="s1">np.set_printoptions(linewidth=</span><span class="s4">18</span><span class="s0">, </span><span class="s1">legacy=</span><span class="s2">'1.13'</span><span class="s1">)</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">str(a)</span><span class="s0">,</span>
            <span class="s1">textwrap.dedent(</span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s2">[2 2 2 2 2 2 2 2 2 
             2 2 2 2 2 2 2 2 2]&quot;&quot;&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_edgeitems(self):</span>
        <span class="s1">np.set_printoptions(edgeitems=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">threshold=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">a = np.arange(</span><span class="s4">27</span><span class="s1">).reshape((</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">))</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">repr(a)</span><span class="s0">,</span>
            <span class="s1">textwrap.dedent(</span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s2">array([[[ 0, ...,  2], 
                    ..., 
                    [ 6, ...,  8]], 
 
                   ..., 
 
                   [[18, ..., 20], 
                    ..., 
                    [24, ..., 26]]])&quot;&quot;&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>

        <span class="s1">b = np.zeros((</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">repr(b)</span><span class="s0">,</span>
            <span class="s1">textwrap.dedent(</span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s2">array([[[[0.]], 
 
                    ..., 
 
                    [[0.]]], 
 
 
                   ..., 
 
 
                   [[[0.]], 
 
                    ..., 
 
                    [[0.]]]])&quot;&quot;&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>

        <span class="s3"># 1.13 had extra trailing spaces, and was missing newlines</span>
        <span class="s1">np.set_printoptions(legacy=</span><span class="s2">'1.13'</span><span class="s1">)</span>

        <span class="s1">assert_equal(</span>
            <span class="s1">repr(a)</span><span class="s0">,</span>
            <span class="s1">textwrap.dedent(</span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s2">array([[[ 0, ...,  2], 
                    ...,  
                    [ 6, ...,  8]], 
 
                   ...,  
                   [[18, ..., 20], 
                    ...,  
                    [24, ..., 26]]])&quot;&quot;&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>

        <span class="s1">assert_equal(</span>
            <span class="s1">repr(b)</span><span class="s0">,</span>
            <span class="s1">textwrap.dedent(</span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s2">array([[[[ 0.]], 
 
                    ...,  
                    [[ 0.]]], 
 
 
                   ...,  
                   [[[ 0.]], 
 
                    ...,  
                    [[ 0.]]]])&quot;&quot;&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_bad_args(self):</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">np.set_printoptions</span><span class="s0">, </span><span class="s1">threshold=float(</span><span class="s2">'nan'</span><span class="s1">))</span>
        <span class="s1">assert_raises(TypeError</span><span class="s0">, </span><span class="s1">np.set_printoptions</span><span class="s0">, </span><span class="s1">threshold=</span><span class="s2">'1'</span><span class="s1">)</span>
        <span class="s1">assert_raises(TypeError</span><span class="s0">, </span><span class="s1">np.set_printoptions</span><span class="s0">, </span><span class="s1">threshold=</span><span class="s5">b'1'</span><span class="s1">)</span>

        <span class="s1">assert_raises(TypeError</span><span class="s0">, </span><span class="s1">np.set_printoptions</span><span class="s0">, </span><span class="s1">precision=</span><span class="s2">'1'</span><span class="s1">)</span>
        <span class="s1">assert_raises(TypeError</span><span class="s0">, </span><span class="s1">np.set_printoptions</span><span class="s0">, </span><span class="s1">precision=</span><span class="s4">1.5</span><span class="s1">)</span>

<span class="s0">def </span><span class="s1">test_unicode_object_array():</span>
    <span class="s1">expected = </span><span class="s2">&quot;array(['é'], dtype=object)&quot;</span>
    <span class="s1">x = np.array([</span><span class="s2">u'</span><span class="s0">\xe9</span><span class="s2">'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=object)</span>
    <span class="s1">assert_equal(repr(x)</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">class </span><span class="s1">TestContextManager:</span>
    <span class="s0">def </span><span class="s1">test_ctx_mgr(self):</span>
        <span class="s3"># test that context manager actually works</span>
        <span class="s0">with </span><span class="s1">np.printoptions(precision=</span><span class="s4">2</span><span class="s1">):</span>
            <span class="s1">s = str(np.array([</span><span class="s4">2.0</span><span class="s1">]) / </span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">assert_equal(s</span><span class="s0">, </span><span class="s2">'[0.67]'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_ctx_mgr_restores(self):</span>
        <span class="s3"># test that print options are actually restrored</span>
        <span class="s1">opts = np.get_printoptions()</span>
        <span class="s0">with </span><span class="s1">np.printoptions(precision=opts[</span><span class="s2">'precision'</span><span class="s1">] - </span><span class="s4">1</span><span class="s0">,</span>
                             <span class="s1">linewidth=opts[</span><span class="s2">'linewidth'</span><span class="s1">] - </span><span class="s4">4</span><span class="s1">):</span>
            <span class="s0">pass</span>
        <span class="s1">assert_equal(np.get_printoptions()</span><span class="s0">, </span><span class="s1">opts)</span>

    <span class="s0">def </span><span class="s1">test_ctx_mgr_exceptions(self):</span>
        <span class="s3"># test that print options are restored even if an exception is raised</span>
        <span class="s1">opts = np.get_printoptions()</span>
        <span class="s0">try</span><span class="s1">:</span>
            <span class="s0">with </span><span class="s1">np.printoptions(precision=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s4">11</span><span class="s1">):</span>
                <span class="s0">raise </span><span class="s1">ValueError</span>
        <span class="s0">except </span><span class="s1">ValueError:</span>
            <span class="s0">pass</span>
        <span class="s1">assert_equal(np.get_printoptions()</span><span class="s0">, </span><span class="s1">opts)</span>

    <span class="s0">def </span><span class="s1">test_ctx_mgr_as_smth(self):</span>
        <span class="s1">opts = {</span><span class="s2">&quot;precision&quot;</span><span class="s1">: </span><span class="s4">2</span><span class="s1">}</span>
        <span class="s0">with </span><span class="s1">np.printoptions(**opts) </span><span class="s0">as </span><span class="s1">ctx:</span>
            <span class="s1">saved_opts = ctx.copy()</span>
        <span class="s1">assert_equal({k: saved_opts[k] </span><span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">opts}</span><span class="s0">, </span><span class="s1">opts)</span>
</pre>
</body>
</html>