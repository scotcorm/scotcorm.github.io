<html>
<head>
<title>_r_components_generation.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #629755; font-style: italic;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
_r_components_generation.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">os</span>
<span class="s0">import </span><span class="s1">sys</span>
<span class="s0">import </span><span class="s1">shutil</span>
<span class="s0">import </span><span class="s1">importlib</span>
<span class="s0">import </span><span class="s1">textwrap</span>
<span class="s0">import </span><span class="s1">re</span>
<span class="s0">import </span><span class="s1">warnings</span>

<span class="s0">from </span><span class="s1">._all_keywords </span><span class="s0">import </span><span class="s1">r_keywords</span>
<span class="s0">from </span><span class="s1">._py_components_generation </span><span class="s0">import </span><span class="s1">reorder_props</span>


<span class="s2"># Declaring longer string templates as globals to improve</span>
<span class="s2"># readability, make method logic clearer to anyone inspecting</span>
<span class="s2"># code below</span>
<span class="s1">r_component_string = </span><span class="s3">&quot;&quot;&quot;#' @export 
{funcname} &lt;- function({default_argtext}{wildcards}) {{ 
    {wildcard_declaration} 
    props &lt;- list({default_paramtext}{wildcards}) 
    if (length(props) &gt; 0) {{ 
        props &lt;- props[!vapply(props, is.null, logical(1))] 
    }} 
    component &lt;- list( 
        props = props, 
        type = '{name}', 
        namespace = '{project_shortname}', 
        propNames = c({prop_names}{wildcard_names}), 
        package = '{package_name}' 
        ) 
 
    structure(component, class = c('dash_component', 'list')) 
}} 
&quot;&quot;&quot;  </span><span class="s2"># noqa:E501</span>

<span class="s2"># the following strings represent all the elements in an object</span>
<span class="s2"># of the html_dependency class, which will be propagated by</span>
<span class="s2"># iterating over _js_dist in __init__.py</span>
<span class="s1">frame_open_template = </span><span class="s3">&quot;&quot;&quot;.{rpkgname}_js_metadata &lt;- function() {{ 
deps_metadata &lt;- list(&quot;&quot;&quot;</span>

<span class="s1">frame_element_template = </span><span class="s3">&quot;&quot;&quot;`{dep_name}` = structure(list(name = &quot;{dep_name}&quot;, 
version = &quot;{project_ver}&quot;, src = list(href = NULL, 
file = &quot;deps&quot;), meta = NULL, 
script = {script_name}, 
stylesheet = {css_name}, head = NULL, attachment = NULL, package = &quot;{rpkgname}&quot;, 
all_files = FALSE{async_or_dynamic}), class = &quot;html_dependency&quot;)&quot;&quot;&quot;  </span><span class="s2"># noqa:E501</span>

<span class="s1">frame_body_template = </span><span class="s3">&quot;&quot;&quot;`{project_shortname}` = structure(list(name = &quot;{project_shortname}&quot;, 
version = &quot;{project_ver}&quot;, src = list(href = NULL, 
file = &quot;deps&quot;), meta = NULL, 
script = {script_name}, 
stylesheet = {css_name}, head = NULL, attachment = NULL, package = &quot;{rpkgname}&quot;, 
all_files = FALSE{async_or_dynamic}), class = &quot;html_dependency&quot;)&quot;&quot;&quot;  </span><span class="s2"># noqa:E501</span>

<span class="s1">frame_close_template = </span><span class="s3">&quot;&quot;&quot;) 
return(deps_metadata) 
} 
&quot;&quot;&quot;</span>

<span class="s1">help_string = </span><span class="s3">&quot;&quot;&quot;% Auto-generated: do not edit by hand 
</span><span class="s0">\\</span><span class="s3">name{{{funcname}}} 
 
</span><span class="s0">\\</span><span class="s3">alias{{{funcname}}} 
 
</span><span class="s0">\\</span><span class="s3">title{{{name} component}} 
 
</span><span class="s0">\\</span><span class="s3">description{{ 
{description} 
}} 
 
</span><span class="s0">\\</span><span class="s3">usage{{ 
{funcname}({default_argtext}) 
}} 
 
</span><span class="s0">\\</span><span class="s3">arguments{{ 
{item_text} 
}} 
 
</span><span class="s0">\\</span><span class="s3">value{{{value_text}}} 
 
&quot;&quot;&quot;</span>

<span class="s1">description_template = </span><span class="s3">&quot;&quot;&quot;Package: {package_name} 
Title: {package_title} 
Version: {package_version} 
Description: {package_description} 
Depends: R (&gt;= 3.0.2){package_depends} 
Imports: {package_imports} 
Suggests: {package_suggests}{package_rauthors} 
License: {package_license}{package_copyright} 
URL: {package_url} 
BugReports: {package_issues} 
Encoding: UTF-8 
LazyData: true{vignette_builder} 
KeepSource: true 
&quot;&quot;&quot;</span>

<span class="s1">rbuild_ignore_string = </span><span class="s3">r&quot;&quot;&quot;# ignore JS config files/folders 
node_modules/ 
coverage/ 
src/ 
lib/ 
.babelrc 
.builderrc 
.eslintrc 
.npmignore 
.editorconfig 
.eslintignore 
.prettierrc 
.circleci 
.github 
 
# demo folder has special meaning in R 
# this should hopefully make it still 
# allow for the possibility to make R demos 
demo/.*\.js 
demo/.*\.html 
demo/.*\.css 
 
# ignore Python files/folders 
setup.py 
usage.py 
setup.py 
requirements.txt 
MANIFEST.in 
CHANGELOG.md 
test/ 
# CRAN has weird LICENSE requirements 
LICENSE.txt 
^.*\.Rproj$ 
^\.Rproj\.user$ 
&quot;&quot;&quot;</span>

<span class="s1">pkghelp_stub = </span><span class="s3">&quot;&quot;&quot;% Auto-generated: do not edit by hand 
</span><span class="s0">\\</span><span class="s3">docType{{package}} 
</span><span class="s0">\\</span><span class="s3">name{{{package_name}-package}} 
</span><span class="s0">\\</span><span class="s3">alias{{{package_name}}} 
</span><span class="s0">\\</span><span class="s3">title{{{pkg_help_title}}} 
</span><span class="s0">\\</span><span class="s3">description{{ 
{pkg_help_description} 
}} 
</span><span class="s0">\\</span><span class="s3">author{{ 
</span><span class="s0">\\</span><span class="s3">strong{{Maintainer}}: {maintainer} 
}} 
&quot;&quot;&quot;</span>

<span class="s1">wildcard_helper = </span><span class="s3">&quot;&quot;&quot; 
dash_assert_valid_wildcards &lt;- function (attrib = list(&quot;data&quot;, &quot;aria&quot;), ...) 
{ 
    args &lt;- list(...) 
    validation_results &lt;- lapply(names(args), function(x) { 
        grepl(paste0(&quot;^(&quot;, paste0(attrib, collapse=&quot;|&quot;), &quot;)-[a-zA-Z0-9_-]+$&quot;), 
            x) 
    }) 
    if (FALSE %in% validation_results) { 
        stop(sprintf(&quot;The following props are not valid in this component: '%s'&quot;, 
            paste(names(args)[grepl(FALSE, unlist(validation_results))], 
                collapse = &quot;, &quot;)), call. = FALSE) 
    } 
    else { 
        return(args) 
    } 
} 
&quot;&quot;&quot;  </span><span class="s2"># noqa:E501</span>

<span class="s1">wildcard_template = </span><span class="s3">&quot;&quot;&quot; 
    wildcard_names = names(dash_assert_valid_wildcards(attrib = list({}), ...)) 
&quot;&quot;&quot;</span>

<span class="s1">wildcard_help_template = </span><span class="s3">&quot;&quot;&quot; 
 
 
</span><span class="s0">\\</span><span class="s3">item{{...}}{{wildcards allowed have the form: `{}`}} 
&quot;&quot;&quot;</span>


<span class="s2"># pylint: disable=R0914</span>
<span class="s0">def </span><span class="s1">generate_class_string(name</span><span class="s0">, </span><span class="s1">props</span><span class="s0">, </span><span class="s1">project_shortname</span><span class="s0">, </span><span class="s1">prefix):</span>
    <span class="s2"># Here we convert from snake case to camel case</span>
    <span class="s1">package_name = snake_case_to_camel_case(project_shortname)</span>

    <span class="s2"># Ensure props are ordered with children first</span>
    <span class="s1">props = reorder_props(props=props)</span>

    <span class="s1">prop_keys = list(props.keys())</span>

    <span class="s1">wildcards = </span><span class="s3">&quot;&quot;</span>
    <span class="s1">wildcard_declaration = </span><span class="s3">&quot;&quot;</span>
    <span class="s1">wildcard_names = </span><span class="s3">&quot;&quot;</span>
    <span class="s1">default_paramtext = </span><span class="s3">&quot;&quot;</span>
    <span class="s1">default_argtext = </span><span class="s3">&quot;&quot;</span>
    <span class="s1">accepted_wildcards = </span><span class="s3">&quot;&quot;</span>

    <span class="s0">if </span><span class="s1">any(key.endswith(</span><span class="s3">&quot;-*&quot;</span><span class="s1">) </span><span class="s0">for </span><span class="s1">key </span><span class="s0">in </span><span class="s1">prop_keys):</span>
        <span class="s1">accepted_wildcards = get_wildcards_r(prop_keys)</span>
        <span class="s1">wildcards = </span><span class="s3">&quot;, ...&quot;</span>
        <span class="s1">wildcard_declaration = wildcard_template.format(</span>
            <span class="s1">accepted_wildcards.replace(</span><span class="s3">&quot;-*&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>
        <span class="s1">wildcard_names = </span><span class="s3">&quot;, wildcard_names&quot;</span>

    <span class="s2"># Produce a string with all property names other than WCs</span>
    <span class="s1">prop_names = </span><span class="s3">&quot;, &quot;</span><span class="s1">.join(</span>
        <span class="s3">&quot;'{}'&quot;</span><span class="s1">.format(p) </span><span class="s0">for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">prop_keys </span><span class="s0">if </span><span class="s3">&quot;*&quot; </span><span class="s0">not in </span><span class="s1">p </span><span class="s0">and </span><span class="s1">p </span><span class="s0">not in </span><span class="s1">[</span><span class="s3">&quot;setProps&quot;</span><span class="s1">]</span>
    <span class="s1">)</span>

    <span class="s2"># Filter props to remove those we don't want to expose</span>
    <span class="s0">for </span><span class="s1">item </span><span class="s0">in </span><span class="s1">prop_keys[:]:</span>
        <span class="s0">if </span><span class="s1">item.endswith(</span><span class="s3">&quot;-*&quot;</span><span class="s1">) </span><span class="s0">or </span><span class="s1">item == </span><span class="s3">&quot;setProps&quot;</span><span class="s1">:</span>
            <span class="s1">prop_keys.remove(item)</span>
        <span class="s0">elif </span><span class="s1">item </span><span class="s0">in </span><span class="s1">r_keywords:</span>
            <span class="s1">prop_keys.remove(item)</span>
            <span class="s1">warnings.warn(</span>
                <span class="s1">(</span>
                    <span class="s3">'WARNING: prop &quot;{}&quot; in component &quot;{}&quot; is an R keyword'</span>
                    <span class="s3">&quot; - REMOVED FROM THE R COMPONENT&quot;</span>
                <span class="s1">).format(item</span><span class="s0">, </span><span class="s1">name)</span>
            <span class="s1">)</span>

    <span class="s1">default_argtext += </span><span class="s3">&quot;, &quot;</span><span class="s1">.join(</span><span class="s3">&quot;{}=NULL&quot;</span><span class="s1">.format(p) </span><span class="s0">for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">prop_keys)</span>

    <span class="s2"># pylint: disable=C0301</span>
    <span class="s1">default_paramtext += </span><span class="s3">&quot;, &quot;</span><span class="s1">.join(</span>
        <span class="s3">&quot;{0}={0}&quot;</span><span class="s1">.format(p) </span><span class="s0">if </span><span class="s1">p != </span><span class="s3">&quot;children&quot; </span><span class="s0">else </span><span class="s3">&quot;{}=children&quot;</span><span class="s1">.format(p)</span>
        <span class="s0">for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">prop_keys</span>
    <span class="s1">)</span>

    <span class="s0">return </span><span class="s1">r_component_string.format(</span>
        <span class="s1">funcname=format_fn_name(prefix</span><span class="s0">, </span><span class="s1">name)</span><span class="s0">,</span>
        <span class="s1">name=name</span><span class="s0">,</span>
        <span class="s1">default_argtext=default_argtext</span><span class="s0">,</span>
        <span class="s1">wildcards=wildcards</span><span class="s0">,</span>
        <span class="s1">wildcard_declaration=wildcard_declaration</span><span class="s0">,</span>
        <span class="s1">default_paramtext=default_paramtext</span><span class="s0">,</span>
        <span class="s1">project_shortname=project_shortname</span><span class="s0">,</span>
        <span class="s1">prop_names=prop_names</span><span class="s0">,</span>
        <span class="s1">wildcard_names=wildcard_names</span><span class="s0">,</span>
        <span class="s1">package_name=package_name</span><span class="s0">,</span>
    <span class="s1">)</span>


<span class="s2"># pylint: disable=R0914</span>
<span class="s0">def </span><span class="s1">generate_js_metadata(pkg_data</span><span class="s0">, </span><span class="s1">project_shortname):</span>
    <span class="s4">&quot;&quot;&quot;Dynamically generate R function to supply JavaScript and CSS dependency 
    information required by the dash package for R. 
 
    Parameters 
    ---------- 
    project_shortname = component library name, in snake case 
 
    Returns 
    ------- 
    function_string = complete R function code to provide component features 
    &quot;&quot;&quot;</span>
    <span class="s2"># make sure the module we're building is available to Python,</span>
    <span class="s2"># even if it hasn't been installed yet</span>
    <span class="s1">sys.path.insert(</span><span class="s5">0</span><span class="s0">, </span><span class="s1">os.getcwd())</span>
    <span class="s1">mod = importlib.import_module(project_shortname)</span>

    <span class="s1">alldist = getattr(mod</span><span class="s0">, </span><span class="s3">&quot;_js_dist&quot;</span><span class="s0">, </span><span class="s1">[]) + getattr(mod</span><span class="s0">, </span><span class="s3">&quot;_css_dist&quot;</span><span class="s0">, </span><span class="s1">[])</span>

    <span class="s1">project_ver = pkg_data.get(</span><span class="s3">&quot;version&quot;</span><span class="s1">)</span>

    <span class="s1">rpkgname = snake_case_to_camel_case(project_shortname)</span>

    <span class="s2"># since _js_dist may suggest more than one dependency, need</span>
    <span class="s2"># a way to iterate over all dependencies for a given set.</span>
    <span class="s2"># here we define an opening, element, and closing string --</span>
    <span class="s2"># if the total number of dependencies &gt; 1, we can concatenate</span>
    <span class="s2"># them and write a list object in R with multiple elements</span>
    <span class="s1">function_frame_open = frame_open_template.format(rpkgname=rpkgname)</span>

    <span class="s1">function_frame = []</span>
    <span class="s1">function_frame_body = []</span>

    <span class="s2"># pylint: disable=consider-using-enumerate</span>
    <span class="s0">if </span><span class="s1">len(alldist) &gt; </span><span class="s5">1</span><span class="s1">:</span>
        <span class="s0">for </span><span class="s1">dep </span><span class="s0">in </span><span class="s1">range(len(alldist)):</span>
            <span class="s1">curr_dep = alldist[dep]</span>
            <span class="s1">rpp = curr_dep[</span><span class="s3">&quot;relative_package_path&quot;</span><span class="s1">]</span>

            <span class="s1">async_or_dynamic = get_async_type(curr_dep)</span>

            <span class="s0">if </span><span class="s3">&quot;dash_&quot; </span><span class="s0">in </span><span class="s1">rpp:</span>
                <span class="s1">dep_name = rpp.split(</span><span class="s3">&quot;.&quot;</span><span class="s1">)[</span><span class="s5">0</span><span class="s1">]</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">dep_name = </span><span class="s3">&quot;{}&quot;</span><span class="s1">.format(project_shortname)</span>

            <span class="s0">if </span><span class="s3">&quot;css&quot; </span><span class="s0">in </span><span class="s1">rpp:</span>
                <span class="s1">css_name = </span><span class="s3">&quot;'{}'&quot;</span><span class="s1">.format(rpp)</span>
                <span class="s1">script_name = </span><span class="s3">&quot;NULL&quot;</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">script_name = </span><span class="s3">&quot;'{}'&quot;</span><span class="s1">.format(rpp)</span>
                <span class="s1">css_name = </span><span class="s3">&quot;NULL&quot;</span>

            <span class="s1">function_frame += [</span>
                <span class="s1">frame_element_template.format(</span>
                    <span class="s1">dep_name=dep_name</span><span class="s0">,</span>
                    <span class="s1">project_ver=project_ver</span><span class="s0">,</span>
                    <span class="s1">rpkgname=rpkgname</span><span class="s0">,</span>
                    <span class="s1">project_shortname=project_shortname</span><span class="s0">,</span>
                    <span class="s1">script_name=script_name</span><span class="s0">,</span>
                    <span class="s1">css_name=css_name</span><span class="s0">,</span>
                    <span class="s1">async_or_dynamic=async_or_dynamic</span><span class="s0">,</span>
                <span class="s1">)</span>
            <span class="s1">]</span>
            <span class="s1">function_frame_body = </span><span class="s3">&quot;,</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s1">.join(function_frame)</span>
    <span class="s0">elif </span><span class="s1">len(alldist) == </span><span class="s5">1</span><span class="s1">:</span>
        <span class="s1">dep = alldist[</span><span class="s5">0</span><span class="s1">]</span>
        <span class="s1">rpp = dep[</span><span class="s3">&quot;relative_package_path&quot;</span><span class="s1">]</span>

        <span class="s1">async_or_dynamic = get_async_type(dep)</span>

        <span class="s0">if </span><span class="s3">&quot;css&quot; </span><span class="s0">in </span><span class="s1">rpp:</span>
            <span class="s1">css_name = </span><span class="s3">&quot;'{}'&quot;</span><span class="s1">.format(rpp)</span>
            <span class="s1">script_name = </span><span class="s3">&quot;NULL&quot;</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">script_name = </span><span class="s3">&quot;'{}'&quot;</span><span class="s1">.format(rpp)</span>
            <span class="s1">css_name = </span><span class="s3">&quot;NULL&quot;</span>

        <span class="s1">function_frame_body = frame_body_template.format(</span>
            <span class="s1">project_shortname=project_shortname</span><span class="s0">,</span>
            <span class="s1">project_ver=project_ver</span><span class="s0">,</span>
            <span class="s1">rpkgname=rpkgname</span><span class="s0">,</span>
            <span class="s1">script_name=script_name</span><span class="s0">,</span>
            <span class="s1">css_name=css_name</span><span class="s0">,</span>
            <span class="s1">async_or_dynamic=async_or_dynamic</span><span class="s0">,</span>
        <span class="s1">)</span>

    <span class="s1">function_string = </span><span class="s3">&quot;&quot;</span><span class="s1">.join(</span>
        <span class="s1">[function_frame_open</span><span class="s0">, </span><span class="s1">function_frame_body</span><span class="s0">, </span><span class="s1">frame_close_template]</span>
    <span class="s1">)</span>

    <span class="s0">return </span><span class="s1">function_string</span>


<span class="s2"># determine whether dependency uses async or dynamic flag</span>
<span class="s2"># then return the properly formatted string if so, i.e.</span>
<span class="s2"># &quot; async = TRUE,&quot;. a dependency can have async or</span>
<span class="s2"># dynamic elements, neither of these, but never both.</span>
<span class="s0">def </span><span class="s1">get_async_type(dep):</span>
    <span class="s1">async_or_dynamic = </span><span class="s3">&quot;&quot;</span>
    <span class="s0">for </span><span class="s1">key </span><span class="s0">in </span><span class="s1">dep.keys():</span>
        <span class="s0">if </span><span class="s1">key </span><span class="s0">in </span><span class="s1">[</span><span class="s3">&quot;async&quot;</span><span class="s0">, </span><span class="s3">&quot;dynamic&quot;</span><span class="s1">]:</span>
            <span class="s1">keyval = dep[key]</span>
            <span class="s0">if not </span><span class="s1">isinstance(keyval</span><span class="s0">, </span><span class="s1">bool):</span>
                <span class="s1">keyval = </span><span class="s3">&quot;'{}'&quot;</span><span class="s1">.format(keyval.lower())</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">keyval = str(keyval).upper()</span>
            <span class="s1">async_or_dynamic = </span><span class="s3">&quot;, {} = {}&quot;</span><span class="s1">.format(key</span><span class="s0">, </span><span class="s1">keyval)</span>
    <span class="s0">return </span><span class="s1">async_or_dynamic</span>


<span class="s2"># This method wraps code within arbitrary LaTeX-like tags, which are used</span>
<span class="s2"># by R's internal help parser for constructing man pages</span>
<span class="s0">def </span><span class="s1">wrap(tag</span><span class="s0">, </span><span class="s1">code):</span>
    <span class="s0">if </span><span class="s1">tag == </span><span class="s3">&quot;&quot;</span><span class="s1">:</span>
        <span class="s0">return </span><span class="s1">code</span>
    <span class="s0">return </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">{}{{</span><span class="s0">\n</span><span class="s3">{}}}&quot;</span><span class="s1">.format(tag</span><span class="s0">, </span><span class="s1">code)</span>


<span class="s0">def </span><span class="s1">write_help_file(name</span><span class="s0">, </span><span class="s1">props</span><span class="s0">, </span><span class="s1">description</span><span class="s0">, </span><span class="s1">prefix</span><span class="s0">, </span><span class="s1">rpkg_data):</span>
    <span class="s4">&quot;&quot;&quot;Write R documentation file (.Rd) given component name and properties. 
 
    Parameters 
    ---------- 
    name = the name of the Dash component for which a help file is generated 
    props = the properties of the component 
    description = the component's description, inserted into help file header 
    prefix = the DashR library prefix (optional, can be a blank string) 
    rpkg_data = package metadata (optional) 
 
    Returns 
    ------- 
    writes an R help file to the man directory for the generated R package 
    &quot;&quot;&quot;</span>
    <span class="s1">funcname = format_fn_name(prefix</span><span class="s0">, </span><span class="s1">name)</span>
    <span class="s1">file_name = funcname + </span><span class="s3">&quot;.Rd&quot;</span>

    <span class="s1">wildcards = </span><span class="s3">&quot;&quot;</span>
    <span class="s1">default_argtext = </span><span class="s3">&quot;&quot;</span>
    <span class="s1">item_text = </span><span class="s3">&quot;&quot;</span>
    <span class="s1">accepted_wildcards = </span><span class="s3">&quot;&quot;</span>

    <span class="s2"># the return value of all Dash components should be the same,</span>
    <span class="s2"># in an abstract sense -- they produce a list</span>
    <span class="s1">value_text = </span><span class="s3">&quot;named list of JSON elements corresponding to React.js properties and their values&quot;  </span><span class="s2"># noqa:E501</span>

    <span class="s1">prop_keys = list(props.keys())</span>

    <span class="s0">if </span><span class="s1">any(key.endswith(</span><span class="s3">&quot;-*&quot;</span><span class="s1">) </span><span class="s0">for </span><span class="s1">key </span><span class="s0">in </span><span class="s1">prop_keys):</span>
        <span class="s1">accepted_wildcards = get_wildcards_r(prop_keys)</span>
        <span class="s1">wildcards = </span><span class="s3">&quot;, ...&quot;</span>

    <span class="s2"># Filter props to remove those we don't want to expose</span>
    <span class="s0">for </span><span class="s1">item </span><span class="s0">in </span><span class="s1">prop_keys[:]:</span>
        <span class="s0">if </span><span class="s1">item.endswith(</span><span class="s3">&quot;-*&quot;</span><span class="s1">) </span><span class="s0">or </span><span class="s1">item </span><span class="s0">in </span><span class="s1">r_keywords </span><span class="s0">or </span><span class="s1">item == </span><span class="s3">&quot;setProps&quot;</span><span class="s1">:</span>
            <span class="s1">prop_keys.remove(item)</span>

    <span class="s1">default_argtext += </span><span class="s3">&quot;, &quot;</span><span class="s1">.join(</span><span class="s3">&quot;{}=NULL&quot;</span><span class="s1">.format(p) </span><span class="s0">for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">prop_keys)</span>

    <span class="s1">item_text += </span><span class="s3">&quot;</span><span class="s0">\n\n</span><span class="s3">&quot;</span><span class="s1">.join(</span>
        <span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">item{{{}}}{{{}{}}}&quot;</span><span class="s1">.format(</span>
            <span class="s1">p</span><span class="s0">, </span><span class="s1">print_r_type(props[p][</span><span class="s3">&quot;type&quot;</span><span class="s1">])</span><span class="s0">, </span><span class="s1">props[p][</span><span class="s3">&quot;description&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s0">for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">prop_keys</span>
    <span class="s1">)</span>

    <span class="s2"># auto-replace any unescaped backslashes for compatibility with R docs</span>
    <span class="s1">description = re.sub(</span><span class="s3">r&quot;(?&lt;!\\)%&quot;</span><span class="s0">, </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">%&quot;</span><span class="s0">, </span><span class="s1">description)</span>
    <span class="s1">item_text = re.sub(</span><span class="s3">r&quot;(?&lt;!\\)%&quot;</span><span class="s0">, </span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">%&quot;</span><span class="s0">, </span><span class="s1">item_text)</span>

    <span class="s2"># scrub examples which begin with **Example Usage**, as these should be</span>
    <span class="s2"># provided as R code within dash-info.yaml</span>
    <span class="s0">if </span><span class="s3">&quot;**Example Usage**&quot; </span><span class="s0">in </span><span class="s1">description:</span>
        <span class="s1">description = description.split(</span><span class="s3">&quot;**Example Usage**&quot;</span><span class="s1">)[</span><span class="s5">0</span><span class="s1">].rstrip()</span>

    <span class="s0">if </span><span class="s1">wildcards == </span><span class="s3">&quot;, ...&quot;</span><span class="s1">:</span>
        <span class="s1">default_argtext += wildcards</span>
        <span class="s1">item_text += wildcard_help_template.format(accepted_wildcards)</span>

    <span class="s2"># in R, the online help viewer does not properly wrap lines for</span>
    <span class="s2"># the usage string -- we will hard wrap at 60 characters using</span>
    <span class="s2"># textwrap.fill, starting from the beginning of the usage string</span>

    <span class="s1">file_path = os.path.join(</span><span class="s3">&quot;man&quot;</span><span class="s0">, </span><span class="s1">file_name)</span>
    <span class="s0">with </span><span class="s1">open(file_path</span><span class="s0">, </span><span class="s3">&quot;w&quot;</span><span class="s1">) </span><span class="s0">as </span><span class="s1">f:</span>
        <span class="s1">f.write(</span>
            <span class="s1">help_string.format(</span>
                <span class="s1">funcname=funcname</span><span class="s0">,</span>
                <span class="s1">name=name</span><span class="s0">,</span>
                <span class="s1">default_argtext=textwrap.fill(</span>
                    <span class="s1">default_argtext</span><span class="s0">, </span><span class="s1">width=</span><span class="s5">60</span><span class="s0">, </span><span class="s1">break_long_words=</span><span class="s0">False</span>
                <span class="s1">)</span><span class="s0">,</span>
                <span class="s1">item_text=item_text</span><span class="s0">,</span>
                <span class="s1">value_text=value_text</span><span class="s0">,</span>
                <span class="s1">description=description.replace(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s0">, </span><span class="s3">&quot; &quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span>
        <span class="s1">)</span>
    <span class="s0">if </span><span class="s1">rpkg_data </span><span class="s0">is not None and </span><span class="s3">&quot;r_examples&quot; </span><span class="s0">in </span><span class="s1">rpkg_data:</span>
        <span class="s1">ex = rpkg_data.get(</span><span class="s3">&quot;r_examples&quot;</span><span class="s1">)</span>
        <span class="s1">the_ex = ([e </span><span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s1">ex </span><span class="s0">if </span><span class="s1">e.get(</span><span class="s3">&quot;name&quot;</span><span class="s1">) == funcname] </span><span class="s0">or </span><span class="s1">[</span><span class="s0">None</span><span class="s1">])[</span><span class="s5">0</span><span class="s1">]</span>
        <span class="s1">result = </span><span class="s3">&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">the_ex </span><span class="s0">and </span><span class="s3">&quot;code&quot; </span><span class="s0">in </span><span class="s1">the_ex.keys():</span>
            <span class="s1">result += wrap(</span>
                <span class="s3">&quot;examples&quot;</span><span class="s0">,</span>
                <span class="s1">wrap(</span><span class="s3">&quot;dontrun&quot; </span><span class="s0">if </span><span class="s1">the_ex.get(</span><span class="s3">&quot;dontrun&quot;</span><span class="s1">) </span><span class="s0">else </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">the_ex[</span><span class="s3">&quot;code&quot;</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">)</span>
            <span class="s0">with </span><span class="s1">open(file_path</span><span class="s0">, </span><span class="s3">&quot;a+&quot;</span><span class="s1">) </span><span class="s0">as </span><span class="s1">fa:</span>
                <span class="s1">fa.write(result + </span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s1">)</span>


<span class="s2"># pylint: disable=too-many-arguments</span>
<span class="s0">def </span><span class="s1">write_class_file(</span>
    <span class="s1">name</span><span class="s0">,</span>
    <span class="s1">props</span><span class="s0">,</span>
    <span class="s1">description</span><span class="s0">,</span>
    <span class="s1">project_shortname</span><span class="s0">,</span>
    <span class="s1">prefix=</span><span class="s0">None,</span>
    <span class="s1">rpkg_data=</span><span class="s0">None,</span>
<span class="s1">):</span>
    <span class="s1">props = reorder_props(props=props)</span>

    <span class="s2"># generate the R help pages for each of the Dash components that we</span>
    <span class="s2"># are transpiling -- this is done to avoid using Roxygen2 syntax,</span>
    <span class="s2"># we may eventually be able to generate similar documentation using</span>
    <span class="s2"># doxygen and an R plugin, but for now we'll just do it on our own</span>
    <span class="s2"># from within Python</span>
    <span class="s1">write_help_file(name</span><span class="s0">, </span><span class="s1">props</span><span class="s0">, </span><span class="s1">description</span><span class="s0">, </span><span class="s1">prefix</span><span class="s0">, </span><span class="s1">rpkg_data)</span>

    <span class="s1">import_string = </span><span class="s3">&quot;# AUTO GENERATED FILE - DO NOT EDIT</span><span class="s0">\n\n</span><span class="s3">&quot;</span>
    <span class="s1">class_string = generate_class_string(name</span><span class="s0">, </span><span class="s1">props</span><span class="s0">, </span><span class="s1">project_shortname</span><span class="s0">, </span><span class="s1">prefix)</span>

    <span class="s1">file_name = format_fn_name(prefix</span><span class="s0">, </span><span class="s1">name) + </span><span class="s3">&quot;.R&quot;</span>

    <span class="s1">file_path = os.path.join(</span><span class="s3">&quot;R&quot;</span><span class="s0">, </span><span class="s1">file_name)</span>
    <span class="s0">with </span><span class="s1">open(file_path</span><span class="s0">, </span><span class="s3">&quot;w&quot;</span><span class="s1">) </span><span class="s0">as </span><span class="s1">f:</span>
        <span class="s1">f.write(import_string)</span>
        <span class="s1">f.write(class_string)</span>

    <span class="s1">print(</span><span class="s3">&quot;Generated {}&quot;</span><span class="s1">.format(file_name))</span>


<span class="s0">def </span><span class="s1">write_js_metadata(pkg_data</span><span class="s0">, </span><span class="s1">project_shortname</span><span class="s0">, </span><span class="s1">has_wildcards):</span>
    <span class="s4">&quot;&quot;&quot;Write an internal (not exported) R function to return all JS 
    dependencies as required by dash. 
 
    Parameters 
    ---------- 
    project_shortname = hyphenated string, e.g. dash-html-components 
 
    Returns 
    ------- 
    &quot;&quot;&quot;</span>
    <span class="s1">function_string = generate_js_metadata(</span>
        <span class="s1">pkg_data=pkg_data</span><span class="s0">, </span><span class="s1">project_shortname=project_shortname</span>
    <span class="s1">)</span>
    <span class="s1">file_name = </span><span class="s3">&quot;internal.R&quot;</span>

    <span class="s2"># the R source directory for the package won't exist on first call</span>
    <span class="s2"># create the R directory if it is missing</span>
    <span class="s0">if not </span><span class="s1">os.path.exists(</span><span class="s3">&quot;R&quot;</span><span class="s1">):</span>
        <span class="s1">os.makedirs(</span><span class="s3">&quot;R&quot;</span><span class="s1">)</span>

    <span class="s1">file_path = os.path.join(</span><span class="s3">&quot;R&quot;</span><span class="s0">, </span><span class="s1">file_name)</span>
    <span class="s0">with </span><span class="s1">open(file_path</span><span class="s0">, </span><span class="s3">&quot;w&quot;</span><span class="s1">) </span><span class="s0">as </span><span class="s1">f:</span>
        <span class="s1">f.write(function_string)</span>
        <span class="s0">if </span><span class="s1">has_wildcards:</span>
            <span class="s1">f.write(wildcard_helper)</span>

    <span class="s2"># now copy over all JS dependencies from the (Python) components dir</span>
    <span class="s2"># the inst/lib directory for the package won't exist on first call</span>
    <span class="s2"># create this directory if it is missing</span>
    <span class="s0">if </span><span class="s1">os.path.exists(</span><span class="s3">&quot;inst/deps&quot;</span><span class="s1">):</span>
        <span class="s1">shutil.rmtree(</span><span class="s3">&quot;inst/deps&quot;</span><span class="s1">)</span>

    <span class="s1">os.makedirs(</span><span class="s3">&quot;inst/deps&quot;</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">rel_dirname</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">filenames </span><span class="s0">in </span><span class="s1">os.walk(project_shortname):</span>
        <span class="s0">for </span><span class="s1">filename </span><span class="s0">in </span><span class="s1">filenames:</span>
            <span class="s1">extension = os.path.splitext(filename)[</span><span class="s5">1</span><span class="s1">]</span>

            <span class="s0">if </span><span class="s1">extension </span><span class="s0">in </span><span class="s1">[</span><span class="s3">&quot;.py&quot;</span><span class="s0">, </span><span class="s3">&quot;.pyc&quot;</span><span class="s0">, </span><span class="s3">&quot;.json&quot;</span><span class="s1">]:</span>
                <span class="s0">continue</span>

            <span class="s1">target_dirname = os.path.join(</span>
                <span class="s1">os.path.join(</span>
                    <span class="s3">&quot;inst/deps/&quot;</span><span class="s0">, </span><span class="s1">os.path.relpath(rel_dirname</span><span class="s0">, </span><span class="s1">project_shortname)</span>
                <span class="s1">)</span>
            <span class="s1">)</span>

            <span class="s0">if not </span><span class="s1">os.path.exists(target_dirname):</span>
                <span class="s1">os.makedirs(target_dirname)</span>

            <span class="s1">shutil.copy(os.path.join(rel_dirname</span><span class="s0">, </span><span class="s1">filename)</span><span class="s0">, </span><span class="s1">target_dirname)</span>


<span class="s2"># pylint: disable=R0914, R0913, R0912, R0915</span>
<span class="s0">def </span><span class="s1">generate_rpkg(</span>
    <span class="s1">pkg_data</span><span class="s0">,</span>
    <span class="s1">rpkg_data</span><span class="s0">,</span>
    <span class="s1">project_shortname</span><span class="s0">,</span>
    <span class="s1">export_string</span><span class="s0">,</span>
    <span class="s1">package_depends</span><span class="s0">,</span>
    <span class="s1">package_imports</span><span class="s0">,</span>
    <span class="s1">package_suggests</span><span class="s0">,</span>
    <span class="s1">has_wildcards</span><span class="s0">,</span>
<span class="s1">):</span>
    <span class="s4">&quot;&quot;&quot;Generate documents for R package creation. 
 
    Parameters 
    ---------- 
    pkg_data 
    rpkg_data 
    project_shortname 
    export_string 
    package_depends 
    package_imports 
    package_suggests 
    has_wildcards 
 
    Returns 
    ------- 
    &quot;&quot;&quot;</span>
    <span class="s2"># Leverage package.json to import specifics which are also applicable</span>
    <span class="s2"># to R package that we're generating here, use .get in case the key</span>
    <span class="s2"># does not exist in package.json</span>

    <span class="s1">package_name = snake_case_to_camel_case(project_shortname)</span>
    <span class="s1">package_copyright = </span><span class="s3">&quot;&quot;</span>
    <span class="s1">package_rauthors = </span><span class="s3">&quot;&quot;</span>
    <span class="s1">lib_name = pkg_data.get(</span><span class="s3">&quot;name&quot;</span><span class="s1">)</span>

    <span class="s0">if </span><span class="s1">rpkg_data </span><span class="s0">is not None</span><span class="s1">:</span>
        <span class="s0">if </span><span class="s1">rpkg_data.get(</span><span class="s3">&quot;pkg_help_title&quot;</span><span class="s1">):</span>
            <span class="s1">package_title = rpkg_data.get(</span>
                <span class="s3">&quot;pkg_help_title&quot;</span><span class="s0">, </span><span class="s1">pkg_data.get(</span><span class="s3">&quot;description&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">)</span>
            <span class="s1">)</span>
        <span class="s0">if </span><span class="s1">rpkg_data.get(</span><span class="s3">&quot;pkg_help_description&quot;</span><span class="s1">):</span>
            <span class="s1">package_description = rpkg_data.get(</span>
                <span class="s3">&quot;pkg_help_description&quot;</span><span class="s0">, </span><span class="s1">pkg_data.get(</span><span class="s3">&quot;description&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">)</span>
            <span class="s1">)</span>
        <span class="s0">if </span><span class="s1">rpkg_data.get(</span><span class="s3">&quot;pkg_copyright&quot;</span><span class="s1">):</span>
            <span class="s1">package_copyright = </span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Copyright: {}&quot;</span><span class="s1">.format(</span>
                <span class="s1">rpkg_data.get(</span><span class="s3">&quot;pkg_copyright&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">)</span>
            <span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s2"># fall back to using description in package.json, if present</span>
        <span class="s1">package_title = pkg_data.get(</span><span class="s3">&quot;description&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">)</span>
        <span class="s1">package_description = pkg_data.get(</span><span class="s3">&quot;description&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">)</span>

    <span class="s1">package_version = pkg_data.get(</span><span class="s3">&quot;version&quot;</span><span class="s0">, </span><span class="s3">&quot;0.0.1&quot;</span><span class="s1">)</span>

    <span class="s2"># remove leading and trailing commas, add space after comma if missing</span>
    <span class="s0">if </span><span class="s1">package_depends:</span>
        <span class="s1">package_depends = </span><span class="s3">&quot;, &quot; </span><span class="s1">+ package_depends.strip(</span><span class="s3">&quot;,&quot;</span><span class="s1">).lstrip()</span>
        <span class="s1">package_depends = re.sub(</span><span class="s3">r&quot;(,(?![ ]))&quot;</span><span class="s0">, </span><span class="s3">&quot;, &quot;</span><span class="s0">, </span><span class="s1">package_depends)</span>

    <span class="s0">if </span><span class="s1">package_imports:</span>
        <span class="s1">package_imports = package_imports.strip(</span><span class="s3">&quot;,&quot;</span><span class="s1">).lstrip()</span>
        <span class="s1">package_imports = re.sub(</span><span class="s3">r&quot;(,(?![ ]))&quot;</span><span class="s0">, </span><span class="s3">&quot;, &quot;</span><span class="s0">, </span><span class="s1">package_imports)</span>

    <span class="s0">if </span><span class="s1">package_suggests:</span>
        <span class="s1">package_suggests = package_suggests.strip(</span><span class="s3">&quot;,&quot;</span><span class="s1">).lstrip()</span>
        <span class="s1">package_suggests = re.sub(</span><span class="s3">r&quot;(,(?![ ]))&quot;</span><span class="s0">, </span><span class="s3">&quot;, &quot;</span><span class="s0">, </span><span class="s1">package_suggests)</span>

    <span class="s0">if </span><span class="s3">&quot;bugs&quot; </span><span class="s0">in </span><span class="s1">pkg_data:</span>
        <span class="s1">package_issues = pkg_data[</span><span class="s3">&quot;bugs&quot;</span><span class="s1">].get(</span><span class="s3">&quot;url&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">package_issues = </span><span class="s3">&quot;&quot;</span>
        <span class="s1">print(</span>
            <span class="s3">&quot;Warning: a URL for bug reports was &quot;</span>
            <span class="s3">&quot;not provided. Empty string inserted.&quot;</span><span class="s0">,</span>
            <span class="s1">file=sys.stderr</span><span class="s0">,</span>
        <span class="s1">)</span>

    <span class="s0">if </span><span class="s3">&quot;homepage&quot; </span><span class="s0">in </span><span class="s1">pkg_data:</span>
        <span class="s1">package_url = pkg_data.get(</span><span class="s3">&quot;homepage&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">package_url = </span><span class="s3">&quot;&quot;</span>
        <span class="s1">print(</span>
            <span class="s3">&quot;Warning: a homepage URL was not provided. Empty string inserted.&quot;</span><span class="s0">,</span>
            <span class="s1">file=sys.stderr</span><span class="s0">,</span>
        <span class="s1">)</span>

    <span class="s1">package_author = pkg_data.get(</span><span class="s3">&quot;author&quot;</span><span class="s1">)</span>

    <span class="s1">package_author_name = package_author.split(</span><span class="s3">&quot; &lt;&quot;</span><span class="s1">)[</span><span class="s5">0</span><span class="s1">]</span>
    <span class="s1">package_author_email = package_author.split(</span><span class="s3">&quot; &lt;&quot;</span><span class="s1">)[</span><span class="s5">1</span><span class="s1">][:-</span><span class="s5">1</span><span class="s1">]</span>

    <span class="s1">package_author_fn = package_author_name.split(</span><span class="s3">&quot; &quot;</span><span class="s1">)[</span><span class="s5">0</span><span class="s1">]</span>
    <span class="s1">package_author_ln = package_author_name.rsplit(</span><span class="s3">&quot; &quot;</span><span class="s0">, </span><span class="s5">2</span><span class="s1">)[-</span><span class="s5">1</span><span class="s1">]</span>

    <span class="s1">maintainer = pkg_data.get(</span><span class="s3">&quot;maintainer&quot;</span><span class="s0">, </span><span class="s1">pkg_data.get(</span><span class="s3">&quot;author&quot;</span><span class="s1">))</span>

    <span class="s0">if </span><span class="s3">&quot;&lt;&quot; </span><span class="s0">not in </span><span class="s1">package_author:</span>
        <span class="s1">print(</span>
            <span class="s3">&quot;Error, aborting R package generation: &quot;</span>
            <span class="s3">&quot;R packages require a properly formatted author field &quot;</span>
            <span class="s3">&quot;or installation will fail. Please include an email &quot;</span>
            <span class="s3">&quot;address enclosed within &lt; &gt; brackets in package.json. &quot;</span><span class="s0">,</span>
            <span class="s1">file=sys.stderr</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">sys.exit(</span><span class="s5">1</span><span class="s1">)</span>

    <span class="s0">if </span><span class="s1">rpkg_data </span><span class="s0">is not None</span><span class="s1">:</span>
        <span class="s0">if </span><span class="s1">rpkg_data.get(</span><span class="s3">&quot;pkg_authors&quot;</span><span class="s1">):</span>
            <span class="s1">package_rauthors = </span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">Authors@R: {}&quot;</span><span class="s1">.format(</span>
                <span class="s1">rpkg_data.get(</span><span class="s3">&quot;pkg_authors&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">)</span>
            <span class="s1">)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">package_rauthors = </span><span class="s3">'</span><span class="s0">\n</span><span class="s3">Authors@R: person(&quot;{}&quot;, &quot;{}&quot;, role = c(&quot;aut&quot;, &quot;cre&quot;), email = &quot;{}&quot;)'</span><span class="s1">.format(</span>
                <span class="s1">package_author_fn</span><span class="s0">, </span><span class="s1">package_author_ln</span><span class="s0">, </span><span class="s1">package_author_email</span>
            <span class="s1">)</span>

    <span class="s0">if not </span><span class="s1">(os.path.isfile(</span><span class="s3">&quot;LICENSE&quot;</span><span class="s1">) </span><span class="s0">or </span><span class="s1">os.path.isfile(</span><span class="s3">&quot;LICENSE.txt&quot;</span><span class="s1">)):</span>
        <span class="s1">package_license = pkg_data.get(</span><span class="s3">&quot;license&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">package_license = pkg_data.get(</span><span class="s3">&quot;license&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">) + </span><span class="s3">&quot; + file LICENSE&quot;</span>
        <span class="s2"># R requires that the LICENSE.txt file be named LICENSE</span>
        <span class="s0">if not </span><span class="s1">os.path.isfile(</span><span class="s3">&quot;LICENSE&quot;</span><span class="s1">):</span>
            <span class="s1">os.symlink(</span><span class="s3">&quot;LICENSE.txt&quot;</span><span class="s0">, </span><span class="s3">&quot;LICENSE&quot;</span><span class="s1">)</span>

    <span class="s1">import_string = </span><span class="s3">&quot;# AUTO GENERATED FILE - DO NOT EDIT</span><span class="s0">\n\n</span><span class="s3">&quot;</span>
    <span class="s1">packages_string = </span><span class="s3">&quot;&quot;</span>

    <span class="s1">rpackage_list = package_depends.split(</span><span class="s3">&quot;, &quot;</span><span class="s1">) + package_imports.split(</span><span class="s3">&quot;, &quot;</span><span class="s1">)</span>
    <span class="s1">rpackage_list = filter(bool</span><span class="s0">, </span><span class="s1">rpackage_list)</span>

    <span class="s0">if </span><span class="s1">rpackage_list:</span>
        <span class="s0">for </span><span class="s1">rpackage </span><span class="s0">in </span><span class="s1">rpackage_list:</span>
            <span class="s1">packages_string += </span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">import({})</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s1">.format(rpackage)</span>

    <span class="s0">if </span><span class="s1">os.path.exists(</span><span class="s3">&quot;vignettes&quot;</span><span class="s1">):</span>
        <span class="s1">vignette_builder = </span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">VignetteBuilder: knitr&quot;</span>
        <span class="s0">if </span><span class="s3">&quot;knitr&quot; </span><span class="s0">not in </span><span class="s1">package_suggests </span><span class="s0">and </span><span class="s3">&quot;rmarkdown&quot; </span><span class="s0">not in </span><span class="s1">package_suggests:</span>
            <span class="s1">package_suggests += </span><span class="s3">&quot;, knitr, rmarkdown&quot;</span>
            <span class="s1">package_suggests = package_suggests.lstrip(</span><span class="s3">&quot;, &quot;</span><span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">vignette_builder = </span><span class="s3">&quot;&quot;</span>

    <span class="s1">pkghelp_stub_path = os.path.join(</span><span class="s3">&quot;man&quot;</span><span class="s0">, </span><span class="s1">package_name + </span><span class="s3">&quot;-package.Rd&quot;</span><span class="s1">)</span>

    <span class="s2"># generate the internal (not exported to the user) functions which</span>
    <span class="s2"># supply the JavaScript dependencies to the dash package.</span>
    <span class="s2"># this avoids having to generate an RData file from within Python.</span>
    <span class="s1">write_js_metadata(pkg_data</span><span class="s0">, </span><span class="s1">project_shortname</span><span class="s0">, </span><span class="s1">has_wildcards)</span>

    <span class="s0">with </span><span class="s1">open(</span><span class="s3">&quot;NAMESPACE&quot;</span><span class="s0">, </span><span class="s3">&quot;w+&quot;</span><span class="s1">) </span><span class="s0">as </span><span class="s1">f:</span>
        <span class="s1">f.write(import_string)</span>
        <span class="s1">f.write(export_string)</span>
        <span class="s1">f.write(packages_string)</span>

    <span class="s0">with </span><span class="s1">open(</span><span class="s3">&quot;.Rbuildignore&quot;</span><span class="s0">, </span><span class="s3">&quot;w+&quot;</span><span class="s1">) </span><span class="s0">as </span><span class="s1">f2:</span>
        <span class="s1">f2.write(rbuild_ignore_string)</span>

    <span class="s1">description_string = description_template.format(</span>
        <span class="s1">package_name=package_name</span><span class="s0">,</span>
        <span class="s1">package_title=package_title</span><span class="s0">,</span>
        <span class="s1">package_description=package_description</span><span class="s0">,</span>
        <span class="s1">package_version=package_version</span><span class="s0">,</span>
        <span class="s1">package_rauthors=package_rauthors</span><span class="s0">,</span>
        <span class="s1">package_depends=package_depends</span><span class="s0">,</span>
        <span class="s1">package_imports=package_imports</span><span class="s0">,</span>
        <span class="s1">package_suggests=package_suggests</span><span class="s0">,</span>
        <span class="s1">package_license=package_license</span><span class="s0">,</span>
        <span class="s1">package_copyright=package_copyright</span><span class="s0">,</span>
        <span class="s1">package_url=package_url</span><span class="s0">,</span>
        <span class="s1">package_issues=package_issues</span><span class="s0">,</span>
        <span class="s1">vignette_builder=vignette_builder</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s0">with </span><span class="s1">open(</span><span class="s3">&quot;DESCRIPTION&quot;</span><span class="s0">, </span><span class="s3">&quot;w+&quot;</span><span class="s1">) </span><span class="s0">as </span><span class="s1">f3:</span>
        <span class="s1">f3.write(description_string)</span>

    <span class="s0">if </span><span class="s1">rpkg_data </span><span class="s0">is not None</span><span class="s1">:</span>
        <span class="s0">if </span><span class="s1">rpkg_data.get(</span><span class="s3">&quot;pkg_help_description&quot;</span><span class="s1">):</span>
            <span class="s1">pkghelp = pkghelp_stub.format(</span>
                <span class="s1">package_name=package_name</span><span class="s0">,</span>
                <span class="s1">pkg_help_title=rpkg_data.get(</span><span class="s3">&quot;pkg_help_title&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">pkg_help_description=rpkg_data.get(</span><span class="s3">&quot;pkg_help_description&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">lib_name=lib_name</span><span class="s0">,</span>
                <span class="s1">maintainer=maintainer</span><span class="s0">,</span>
            <span class="s1">)</span>
            <span class="s0">with </span><span class="s1">open(pkghelp_stub_path</span><span class="s0">, </span><span class="s3">&quot;w&quot;</span><span class="s1">) </span><span class="s0">as </span><span class="s1">f4:</span>
                <span class="s1">f4.write(pkghelp)</span>


<span class="s2"># This converts a string from snake case to camel case</span>
<span class="s2"># Not required for R package name to be in camel case,</span>
<span class="s2"># but probably more conventional this way</span>
<span class="s0">def </span><span class="s1">snake_case_to_camel_case(namestring):</span>
    <span class="s1">s = namestring.split(</span><span class="s3">&quot;_&quot;</span><span class="s1">)</span>
    <span class="s0">return </span><span class="s1">s[</span><span class="s5">0</span><span class="s1">] + </span><span class="s3">&quot;&quot;</span><span class="s1">.join(w.capitalize() </span><span class="s0">for </span><span class="s1">w </span><span class="s0">in </span><span class="s1">s[</span><span class="s5">1</span><span class="s1">:])</span>


<span class="s2"># this logic will permit passing blank R prefixes to</span>
<span class="s2"># dash-generate-components, while also enforcing</span>
<span class="s2"># camelCase for the resulting functions; if a prefix</span>
<span class="s2"># is supplied, leave it as-is</span>
<span class="s0">def </span><span class="s1">format_fn_name(prefix</span><span class="s0">, </span><span class="s1">name):</span>
    <span class="s0">if </span><span class="s1">prefix:</span>
        <span class="s0">return </span><span class="s1">prefix + snake_case_to_camel_case(name)</span>
    <span class="s0">return </span><span class="s1">snake_case_to_camel_case(name[</span><span class="s5">0</span><span class="s1">].lower() + name[</span><span class="s5">1</span><span class="s1">:])</span>


<span class="s2"># pylint: disable=unused-argument</span>
<span class="s0">def </span><span class="s1">generate_exports(</span>
    <span class="s1">project_shortname</span><span class="s0">,</span>
    <span class="s1">components</span><span class="s0">,</span>
    <span class="s1">metadata</span><span class="s0">,</span>
    <span class="s1">pkg_data</span><span class="s0">,</span>
    <span class="s1">rpkg_data</span><span class="s0">,</span>
    <span class="s1">prefix</span><span class="s0">,</span>
    <span class="s1">package_depends</span><span class="s0">,</span>
    <span class="s1">package_imports</span><span class="s0">,</span>
    <span class="s1">package_suggests</span><span class="s0">,</span>
    <span class="s1">**kwargs</span>
<span class="s1">):</span>
    <span class="s1">export_string = make_namespace_exports(components</span><span class="s0">, </span><span class="s1">prefix)</span>

    <span class="s2"># Look for wildcards in the metadata</span>
    <span class="s1">has_wildcards = </span><span class="s0">False</span>
    <span class="s0">for </span><span class="s1">component_data </span><span class="s0">in </span><span class="s1">metadata.values():</span>
        <span class="s0">if </span><span class="s1">any(key.endswith(</span><span class="s3">&quot;-*&quot;</span><span class="s1">) </span><span class="s0">for </span><span class="s1">key </span><span class="s0">in </span><span class="s1">component_data[</span><span class="s3">&quot;props&quot;</span><span class="s1">]):</span>
            <span class="s1">has_wildcards = </span><span class="s0">True</span>
            <span class="s0">break</span>

    <span class="s2"># now, bundle up the package information and create all the requisite</span>
    <span class="s2"># elements of an R package, so that the end result is installable either</span>
    <span class="s2"># locally or directly from GitHub</span>
    <span class="s1">generate_rpkg(</span>
        <span class="s1">pkg_data</span><span class="s0">,</span>
        <span class="s1">rpkg_data</span><span class="s0">,</span>
        <span class="s1">project_shortname</span><span class="s0">,</span>
        <span class="s1">export_string</span><span class="s0">,</span>
        <span class="s1">package_depends</span><span class="s0">,</span>
        <span class="s1">package_imports</span><span class="s0">,</span>
        <span class="s1">package_suggests</span><span class="s0">,</span>
        <span class="s1">has_wildcards</span><span class="s0">,</span>
    <span class="s1">)</span>


<span class="s0">def </span><span class="s1">make_namespace_exports(components</span><span class="s0">, </span><span class="s1">prefix):</span>
    <span class="s1">export_string = </span><span class="s3">&quot;&quot;</span>
    <span class="s0">for </span><span class="s1">component </span><span class="s0">in </span><span class="s1">components:</span>
        <span class="s0">if </span><span class="s1">(</span>
            <span class="s0">not </span><span class="s1">component.endswith(</span><span class="s3">&quot;-*&quot;</span><span class="s1">)</span>
            <span class="s0">and </span><span class="s1">str(component) </span><span class="s0">not in </span><span class="s1">r_keywords</span>
            <span class="s0">and </span><span class="s1">str(component) </span><span class="s0">not in </span><span class="s1">[</span><span class="s3">&quot;setProps&quot;</span><span class="s0">, </span><span class="s3">&quot;children&quot;</span><span class="s1">]</span>
        <span class="s1">):</span>
            <span class="s1">export_string += </span><span class="s3">&quot;export({}{})</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s1">.format(prefix</span><span class="s0">, </span><span class="s1">component)</span>

    <span class="s2"># the following lines enable rudimentary support for bundling in</span>
    <span class="s2"># R functions that are not automatically generated by the transpiler</span>
    <span class="s2"># such that functions contained in the R subdirectory are exported,</span>
    <span class="s2"># so long as they are not in utils.R.</span>
    <span class="s1">rfilelist = []</span>
    <span class="s1">omitlist = [</span><span class="s3">&quot;utils.R&quot;</span><span class="s0">, </span><span class="s3">&quot;internal.R&quot;</span><span class="s1">] + [</span>
        <span class="s3">&quot;{}{}.R&quot;</span><span class="s1">.format(prefix</span><span class="s0">, </span><span class="s1">component) </span><span class="s0">for </span><span class="s1">component </span><span class="s0">in </span><span class="s1">components</span>
    <span class="s1">]</span>
    <span class="s1">fnlist = []</span>

    <span class="s0">for </span><span class="s1">script </span><span class="s0">in </span><span class="s1">os.listdir(</span><span class="s3">&quot;R&quot;</span><span class="s1">):</span>
        <span class="s0">if </span><span class="s1">script.endswith(</span><span class="s3">&quot;.R&quot;</span><span class="s1">) </span><span class="s0">and </span><span class="s1">script </span><span class="s0">not in </span><span class="s1">omitlist:</span>
            <span class="s1">rfilelist += [os.path.join(</span><span class="s3">&quot;R&quot;</span><span class="s0">, </span><span class="s1">script)]</span>

    <span class="s0">for </span><span class="s1">rfile </span><span class="s0">in </span><span class="s1">rfilelist:</span>
        <span class="s0">with </span><span class="s1">open(rfile</span><span class="s0">, </span><span class="s3">&quot;r&quot;</span><span class="s1">) </span><span class="s0">as </span><span class="s1">script:</span>
            <span class="s1">s = script.read()</span>

            <span class="s2"># remove comments</span>
            <span class="s1">s = re.sub(</span><span class="s3">&quot;#.*$&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">s</span><span class="s0">, </span><span class="s1">flags=re.M)</span>

            <span class="s2"># put the whole file on one line</span>
            <span class="s1">s = s.replace(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s0">, </span><span class="s3">&quot; &quot;</span><span class="s1">).replace(</span><span class="s3">&quot;</span><span class="s0">\r</span><span class="s3">&quot;</span><span class="s0">, </span><span class="s3">&quot; &quot;</span><span class="s1">)</span>

            <span class="s2"># empty out strings, in case of unmatched block terminators</span>
            <span class="s1">s = re.sub(</span><span class="s3">r&quot;'([^'\\]|\\'|\\[^'])*'&quot;</span><span class="s0">, </span><span class="s3">&quot;''&quot;</span><span class="s0">, </span><span class="s1">s)</span>
            <span class="s1">s = re.sub(</span><span class="s3">r'&quot;([^&quot;\\]|\\&quot;|\\[^&quot;])*&quot;'</span><span class="s0">, </span><span class="s3">'&quot;&quot;'</span><span class="s0">, </span><span class="s1">s)</span>

            <span class="s2"># empty out block terminators () and {}</span>
            <span class="s2"># so we don't catch nested functions, or functions as arguments</span>
            <span class="s2"># repeat until it stops changing, in case of multiply nested blocks</span>
            <span class="s1">prev_len = len(s) + </span><span class="s5">1</span>
            <span class="s0">while </span><span class="s1">len(s) &lt; prev_len:</span>
                <span class="s1">prev_len = len(s)</span>
                <span class="s1">s = re.sub(</span><span class="s3">r&quot;\(([^()]|\(\))*\)&quot;</span><span class="s0">, </span><span class="s3">&quot;()&quot;</span><span class="s0">, </span><span class="s1">s)</span>
                <span class="s1">s = re.sub(</span><span class="s3">r&quot;\{([^{}]|\{\})*\}&quot;</span><span class="s0">, </span><span class="s3">&quot;{}&quot;</span><span class="s0">, </span><span class="s1">s)</span>

            <span class="s2"># now, in whatever is left, look for functions</span>
            <span class="s1">matches = re.findall(</span>
                <span class="s2"># in R, either = or &lt;- may be used to create and assign objects</span>
                <span class="s3">r&quot;([^A-Za-z0-9._]|^)([A-Za-z0-9._]+)\s*(=|&lt;-)\s*function&quot;</span><span class="s0">,</span>
                <span class="s1">s</span><span class="s0">,</span>
            <span class="s1">)</span>
            <span class="s0">for </span><span class="s1">match </span><span class="s0">in </span><span class="s1">matches:</span>
                <span class="s1">fn = match[</span><span class="s5">1</span><span class="s1">]</span>
                <span class="s2"># Allow users to mark functions as private by prefixing with .</span>
                <span class="s0">if </span><span class="s1">fn[</span><span class="s5">0</span><span class="s1">] != </span><span class="s3">&quot;.&quot; </span><span class="s0">and </span><span class="s1">fn </span><span class="s0">not in </span><span class="s1">fnlist:</span>
                    <span class="s1">fnlist.append(fn)</span>

    <span class="s1">export_string += </span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s1">.join(</span><span class="s3">&quot;export({})&quot;</span><span class="s1">.format(function) </span><span class="s0">for </span><span class="s1">function </span><span class="s0">in </span><span class="s1">fnlist)</span>
    <span class="s0">return </span><span class="s1">export_string</span>


<span class="s0">def </span><span class="s1">get_r_prop_types(type_object):</span>
    <span class="s4">&quot;&quot;&quot;Mapping from the PropTypes js type object to the R type.&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">shape_or_exact():</span>
        <span class="s0">return </span><span class="s3">&quot;lists containing elements {}.</span><span class="s0">\n</span><span class="s3">{}&quot;</span><span class="s1">.format(</span>
            <span class="s3">&quot;, &quot;</span><span class="s1">.join(</span><span class="s3">&quot;'{}'&quot;</span><span class="s1">.format(t) </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">type_object[</span><span class="s3">&quot;value&quot;</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s3">&quot;Those elements have the following types:</span><span class="s0">\n</span><span class="s3">{}&quot;</span><span class="s1">.format(</span>
                <span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s1">.join(</span>
                    <span class="s1">create_prop_docstring_r(</span>
                        <span class="s1">prop_name=prop_name</span><span class="s0">,</span>
                        <span class="s1">type_object=prop</span><span class="s0">,</span>
                        <span class="s1">required=prop[</span><span class="s3">&quot;required&quot;</span><span class="s1">]</span><span class="s0">,</span>
                        <span class="s1">description=prop.get(</span><span class="s3">&quot;description&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">)</span><span class="s0">,</span>
                        <span class="s1">indent_num=</span><span class="s5">1</span><span class="s0">,</span>
                    <span class="s1">)</span>
                    <span class="s0">for </span><span class="s1">prop_name</span><span class="s0">, </span><span class="s1">prop </span><span class="s0">in </span><span class="s1">type_object[</span><span class="s3">&quot;value&quot;</span><span class="s1">].items()</span>
                <span class="s1">)</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>

    <span class="s0">return </span><span class="s1">dict(</span>
        <span class="s1">array=</span><span class="s0">lambda</span><span class="s1">: </span><span class="s3">&quot;unnamed list&quot;</span><span class="s0">,</span>
        <span class="s1">bool=</span><span class="s0">lambda</span><span class="s1">: </span><span class="s3">&quot;logical&quot;</span><span class="s0">,</span>
        <span class="s1">number=</span><span class="s0">lambda</span><span class="s1">: </span><span class="s3">&quot;numeric&quot;</span><span class="s0">,</span>
        <span class="s1">string=</span><span class="s0">lambda</span><span class="s1">: </span><span class="s3">&quot;character&quot;</span><span class="s0">,</span>
        <span class="s1">object=</span><span class="s0">lambda</span><span class="s1">: </span><span class="s3">&quot;named list&quot;</span><span class="s0">,</span>
        <span class="s1">any=</span><span class="s0">lambda</span><span class="s1">: </span><span class="s3">&quot;logical | numeric | character | named list | unnamed list&quot;</span><span class="s0">,</span>
        <span class="s1">element=</span><span class="s0">lambda</span><span class="s1">: </span><span class="s3">&quot;dash component&quot;</span><span class="s0">,</span>
        <span class="s1">node=</span><span class="s0">lambda</span><span class="s1">: </span><span class="s3">&quot;a list of or a singular dash component, string or number&quot;</span><span class="s0">,</span>
        <span class="s2"># React's PropTypes.oneOf</span>
        <span class="s1">enum=</span><span class="s0">lambda</span><span class="s1">: </span><span class="s3">&quot;a value equal to: {}&quot;</span><span class="s1">.format(</span>
            <span class="s3">&quot;, &quot;</span><span class="s1">.join(</span><span class="s3">&quot;{}&quot;</span><span class="s1">.format(str(t[</span><span class="s3">&quot;value&quot;</span><span class="s1">])) </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">type_object[</span><span class="s3">&quot;value&quot;</span><span class="s1">])</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s2"># React's PropTypes.oneOfType</span>
        <span class="s1">union=</span><span class="s0">lambda</span><span class="s1">: </span><span class="s3">&quot;{}&quot;</span><span class="s1">.format(</span>
            <span class="s3">&quot; | &quot;</span><span class="s1">.join(</span>
                <span class="s3">&quot;{}&quot;</span><span class="s1">.format(get_r_type(subType))</span>
                <span class="s0">for </span><span class="s1">subType </span><span class="s0">in </span><span class="s1">type_object[</span><span class="s3">&quot;value&quot;</span><span class="s1">]</span>
                <span class="s0">if </span><span class="s1">get_r_type(subType) != </span><span class="s3">&quot;&quot;</span>
            <span class="s1">)</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s2"># React's PropTypes.arrayOf</span>
        <span class="s1">arrayOf=</span><span class="s0">lambda</span><span class="s1">: (</span>
            <span class="s3">&quot;list&quot;</span>
            <span class="s1">+ (</span>
                <span class="s3">&quot; of {}s&quot;</span><span class="s1">.format(get_r_type(type_object[</span><span class="s3">&quot;value&quot;</span><span class="s1">]))</span>
                <span class="s0">if </span><span class="s1">get_r_type(type_object[</span><span class="s3">&quot;value&quot;</span><span class="s1">]) != </span><span class="s3">&quot;&quot;</span>
                <span class="s0">else </span><span class="s3">&quot;&quot;</span>
            <span class="s1">)</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s2"># React's PropTypes.objectOf</span>
        <span class="s1">objectOf=</span><span class="s0">lambda</span><span class="s1">: </span><span class="s3">&quot;list with named elements and values of type {}&quot;</span><span class="s1">.format(</span>
            <span class="s1">get_r_type(type_object[</span><span class="s3">&quot;value&quot;</span><span class="s1">])</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s2"># React's PropTypes.shape</span>
        <span class="s1">shape=shape_or_exact</span><span class="s0">,</span>
        <span class="s2"># React's PropTypes.exact</span>
        <span class="s1">exact=shape_or_exact</span><span class="s0">,</span>
    <span class="s1">)</span>


<span class="s0">def </span><span class="s1">get_r_type(type_object</span><span class="s0">, </span><span class="s1">is_flow_type=</span><span class="s0">False, </span><span class="s1">indent_num=</span><span class="s5">0</span><span class="s1">):</span>
    <span class="s4">&quot;&quot;&quot; 
    Convert JS types to R types for the component definition 
    Parameters 
    ---------- 
    type_object: dict 
        react-docgen-generated prop type dictionary 
    is_flow_type: bool 
    indent_num: int 
        Number of indents to use for the docstring for the prop 
    Returns 
    ------- 
    str 
        Python type string 
    &quot;&quot;&quot;</span>
    <span class="s1">js_type_name = type_object[</span><span class="s3">&quot;name&quot;</span><span class="s1">]</span>
    <span class="s1">js_to_r_types = get_r_prop_types(type_object=type_object)</span>
    <span class="s0">if </span><span class="s1">(</span>
        <span class="s3">&quot;computed&quot; </span><span class="s0">in </span><span class="s1">type_object</span>
        <span class="s0">and </span><span class="s1">type_object[</span><span class="s3">&quot;computed&quot;</span><span class="s1">]</span>
        <span class="s0">or </span><span class="s1">type_object.get(</span><span class="s3">&quot;type&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">) == </span><span class="s3">&quot;function&quot;</span>
    <span class="s1">):</span>
        <span class="s0">return </span><span class="s3">&quot;&quot;</span>
    <span class="s0">if </span><span class="s1">js_type_name </span><span class="s0">in </span><span class="s1">js_to_r_types:</span>
        <span class="s1">prop_type = js_to_r_types[js_type_name]()</span>
        <span class="s0">return </span><span class="s1">prop_type</span>
    <span class="s0">return </span><span class="s3">&quot;&quot;</span>


<span class="s0">def </span><span class="s1">print_r_type(typedata):</span>
    <span class="s1">typestring = get_r_type(typedata).capitalize()</span>
    <span class="s0">if </span><span class="s1">typestring:</span>
        <span class="s1">typestring += </span><span class="s3">&quot;. &quot;</span>
    <span class="s0">return </span><span class="s1">typestring</span>


<span class="s2"># pylint: disable=too-many-arguments</span>
<span class="s0">def </span><span class="s1">create_prop_docstring_r(</span>
    <span class="s1">prop_name</span><span class="s0">, </span><span class="s1">type_object</span><span class="s0">, </span><span class="s1">required</span><span class="s0">, </span><span class="s1">description</span><span class="s0">, </span><span class="s1">indent_num</span><span class="s0">, </span><span class="s1">is_flow_type=</span><span class="s0">False</span>
<span class="s1">):</span>
    <span class="s4">&quot;&quot;&quot; 
    Create the Dash component prop docstring 
    Parameters 
    ---------- 
    prop_name: str 
        Name of the Dash component prop 
    type_object: dict 
        react-docgen-generated prop type dictionary 
    required: bool 
        Component is required? 
    description: str 
        Dash component description 
    indent_num: int 
        Number of indents to use for the context block 
        (creates 2 spaces for every indent) 
    is_flow_type: bool 
        Does the prop use Flow types? Otherwise, uses PropTypes 
    Returns 
    ------- 
    str 
        Dash component prop docstring 
    &quot;&quot;&quot;</span>
    <span class="s1">r_type_name = get_r_type(</span>
        <span class="s1">type_object=type_object</span><span class="s0">, </span><span class="s1">is_flow_type=is_flow_type</span><span class="s0">, </span><span class="s1">indent_num=indent_num + </span><span class="s5">1</span>
    <span class="s1">)</span>

    <span class="s1">indent_spacing = </span><span class="s3">&quot;  &quot; </span><span class="s1">* indent_num</span>
    <span class="s0">if </span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">&quot; </span><span class="s0">in </span><span class="s1">r_type_name:</span>
        <span class="s0">return </span><span class="s1">(</span>
            <span class="s3">&quot;{indent_spacing}- {name} ({is_required}): {description}. &quot;</span>
            <span class="s3">&quot;{name} has the following type: {type}&quot;</span><span class="s1">.format(</span>
                <span class="s1">indent_spacing=indent_spacing</span><span class="s0">,</span>
                <span class="s1">name=prop_name</span><span class="s0">,</span>
                <span class="s1">type=r_type_name</span><span class="s0">,</span>
                <span class="s1">description=description</span><span class="s0">,</span>
                <span class="s1">is_required=</span><span class="s3">&quot;required&quot; </span><span class="s0">if </span><span class="s1">required </span><span class="s0">else </span><span class="s3">&quot;optional&quot;</span><span class="s0">,</span>
            <span class="s1">)</span>
        <span class="s1">)</span>
    <span class="s0">return </span><span class="s3">&quot;{indent_spacing}- {name} ({type}{is_required}){description}&quot;</span><span class="s1">.format(</span>
        <span class="s1">indent_spacing=indent_spacing</span><span class="s0">,</span>
        <span class="s1">name=prop_name</span><span class="s0">,</span>
        <span class="s1">type=</span><span class="s3">&quot;{}; &quot;</span><span class="s1">.format(r_type_name) </span><span class="s0">if </span><span class="s1">r_type_name </span><span class="s0">else </span><span class="s3">&quot;&quot;</span><span class="s0">,</span>
        <span class="s1">description=(</span><span class="s3">&quot;: {}&quot;</span><span class="s1">.format(description) </span><span class="s0">if </span><span class="s1">description != </span><span class="s3">&quot;&quot; </span><span class="s0">else </span><span class="s3">&quot;&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">is_required=</span><span class="s3">&quot;required&quot; </span><span class="s0">if </span><span class="s1">required </span><span class="s0">else </span><span class="s3">&quot;optional&quot;</span><span class="s0">,</span>
    <span class="s1">)</span>


<span class="s0">def </span><span class="s1">get_wildcards_r(prop_keys):</span>
    <span class="s1">wildcards = </span><span class="s3">&quot;&quot;</span>
    <span class="s1">wildcards += </span><span class="s3">&quot;, &quot;</span><span class="s1">.join(</span><span class="s3">&quot;'{}'&quot;</span><span class="s1">.format(p) </span><span class="s0">for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">prop_keys </span><span class="s0">if </span><span class="s1">p.endswith(</span><span class="s3">&quot;-*&quot;</span><span class="s1">))</span>

    <span class="s0">if </span><span class="s1">wildcards == </span><span class="s3">&quot;&quot;</span><span class="s1">:</span>
        <span class="s1">wildcards = </span><span class="s3">&quot;NULL&quot;</span>
    <span class="s0">return </span><span class="s1">wildcards</span>
</pre>
</body>
</html>