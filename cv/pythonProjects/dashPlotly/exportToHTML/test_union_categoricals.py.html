<html>
<head>
<title>test_union_categoricals.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_union_categoricals.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas.core.dtypes.concat </span><span class="s0">import </span><span class="s1">union_categoricals</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">Categorical</span><span class="s0">,</span>
    <span class="s1">CategoricalIndex</span><span class="s0">,</span>
    <span class="s1">Series</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">pandas._testing </span><span class="s0">as </span><span class="s1">tm</span>


<span class="s0">class </span><span class="s1">TestUnionCategoricals:</span>
    <span class="s0">def </span><span class="s1">test_union_categorical(self):</span>
        <span class="s2"># GH 13361</span>
        <span class="s1">data = [</span>
            <span class="s1">(list(</span><span class="s3">&quot;abc&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">list(</span><span class="s3">&quot;abd&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">list(</span><span class="s3">&quot;abcabd&quot;</span><span class="s1">))</span><span class="s0">,</span>
            <span class="s1">([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1.2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3.4</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1.2</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3.4</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">(</span>
                <span class="s1">[</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span>
                <span class="s1">pd.date_range(</span><span class="s3">&quot;2014-01-01&quot;</span><span class="s0">, </span><span class="s3">&quot;2014-01-05&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">pd.date_range(</span><span class="s3">&quot;2014-01-06&quot;</span><span class="s0">, </span><span class="s3">&quot;2014-01-07&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">pd.date_range(</span><span class="s3">&quot;2014-01-01&quot;</span><span class="s0">, </span><span class="s3">&quot;2014-01-07&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span>
                <span class="s1">pd.date_range(</span><span class="s3">&quot;2014-01-01&quot;</span><span class="s0">, </span><span class="s3">&quot;2014-01-05&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">&quot;US/Central&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">pd.date_range(</span><span class="s3">&quot;2014-01-06&quot;</span><span class="s0">, </span><span class="s3">&quot;2014-01-07&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">&quot;US/Central&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">pd.date_range(</span><span class="s3">&quot;2014-01-01&quot;</span><span class="s0">, </span><span class="s3">&quot;2014-01-07&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">&quot;US/Central&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span>
                <span class="s1">pd.period_range(</span><span class="s3">&quot;2014-01-01&quot;</span><span class="s0">, </span><span class="s3">&quot;2014-01-05&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">pd.period_range(</span><span class="s3">&quot;2014-01-06&quot;</span><span class="s0">, </span><span class="s3">&quot;2014-01-07&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">pd.period_range(</span><span class="s3">&quot;2014-01-01&quot;</span><span class="s0">, </span><span class="s3">&quot;2014-01-07&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span>

        <span class="s0">for </span><span class="s1">a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">combined </span><span class="s0">in </span><span class="s1">data:</span>
            <span class="s0">for </span><span class="s1">box </span><span class="s0">in </span><span class="s1">[Categorical</span><span class="s0">, </span><span class="s1">CategoricalIndex</span><span class="s0">, </span><span class="s1">Series]:</span>
                <span class="s1">result = union_categoricals([box(Categorical(a))</span><span class="s0">, </span><span class="s1">box(Categorical(b))])</span>
                <span class="s1">expected = Categorical(combined)</span>
                <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># new categories ordered by appearance</span>
        <span class="s1">s = Categorical([</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s1">])</span>
        <span class="s1">s2 = Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">result = union_categoricals([s</span><span class="s0">, </span><span class="s1">s2])</span>
        <span class="s1">expected = Categorical(</span>
            <span class="s1">[</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">s = Categorical([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1.2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">s2 = Categorical([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1.2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">result = union_categoricals([s</span><span class="s0">, </span><span class="s1">s2])</span>
        <span class="s1">expected = Categorical([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1.2</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1.2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># must exactly match types</span>
        <span class="s1">s = Categorical([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1.2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>
        <span class="s1">s2 = Categorical([</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])</span>
        <span class="s1">msg = </span><span class="s3">&quot;dtype of categories must be the same&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">union_categoricals([s</span><span class="s0">, </span><span class="s1">s2])</span>

        <span class="s1">msg = </span><span class="s3">&quot;No Categoricals to union&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">union_categoricals([])</span>

    <span class="s0">def </span><span class="s1">test_union_categoricals_nan(self):</span>
        <span class="s2"># GH 13759</span>
        <span class="s1">res = union_categoricals(</span>
            <span class="s1">[Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">np.nan])</span><span class="s0">, </span><span class="s1">Categorical([</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">np.nan])]</span>
        <span class="s1">)</span>
        <span class="s1">exp = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">np.nan])</span>
        <span class="s1">tm.assert_categorical_equal(res</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s1">res = union_categoricals(</span>
            <span class="s1">[Categorical([</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s1">])</span><span class="s0">, </span><span class="s1">Categorical([</span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s1">np.nan])]</span>
        <span class="s1">)</span>
        <span class="s1">exp = Categorical([</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s1">np.nan])</span>
        <span class="s1">tm.assert_categorical_equal(res</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s1">val1 = [pd.Timestamp(</span><span class="s3">&quot;2011-01-01&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">pd.Timestamp(</span><span class="s3">&quot;2011-03-01&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">pd.NaT]</span>
        <span class="s1">val2 = [pd.NaT</span><span class="s0">, </span><span class="s1">pd.Timestamp(</span><span class="s3">&quot;2011-01-01&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">pd.Timestamp(</span><span class="s3">&quot;2011-02-01&quot;</span><span class="s1">)]</span>

        <span class="s1">res = union_categoricals([Categorical(val1)</span><span class="s0">, </span><span class="s1">Categorical(val2)])</span>
        <span class="s1">exp = Categorical(</span>
            <span class="s1">val1 + val2</span><span class="s0">,</span>
            <span class="s1">categories=[</span>
                <span class="s1">pd.Timestamp(</span><span class="s3">&quot;2011-01-01&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">pd.Timestamp(</span><span class="s3">&quot;2011-03-01&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">pd.Timestamp(</span><span class="s3">&quot;2011-02-01&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_categorical_equal(res</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s2"># all NaN</span>
        <span class="s1">res = union_categoricals(</span>
            <span class="s1">[</span>
                <span class="s1">Categorical(np.array([np.nan</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=object))</span><span class="s0">,</span>
                <span class="s1">Categorical([</span><span class="s3">&quot;X&quot;</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">exp = Categorical([np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;X&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_categorical_equal(res</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s1">res = union_categoricals(</span>
            <span class="s1">[Categorical([np.nan</span><span class="s0">, </span><span class="s1">np.nan])</span><span class="s0">, </span><span class="s1">Categorical([np.nan</span><span class="s0">, </span><span class="s1">np.nan])]</span>
        <span class="s1">)</span>
        <span class="s1">exp = Categorical([np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan])</span>
        <span class="s1">tm.assert_categorical_equal(res</span><span class="s0">, </span><span class="s1">exp)</span>

    <span class="s0">def </span><span class="s1">test_union_categoricals_empty(self):</span>
        <span class="s2"># GH 13759</span>
        <span class="s1">res = union_categoricals([Categorical([])</span><span class="s0">, </span><span class="s1">Categorical([])])</span>
        <span class="s1">exp = Categorical([])</span>
        <span class="s1">tm.assert_categorical_equal(res</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s1">res = union_categoricals([Categorical([])</span><span class="s0">, </span><span class="s1">Categorical([</span><span class="s3">&quot;1&quot;</span><span class="s1">])])</span>
        <span class="s1">exp = Categorical([</span><span class="s3">&quot;1&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_categorical_equal(res</span><span class="s0">, </span><span class="s1">exp)</span>

    <span class="s0">def </span><span class="s1">test_union_categorical_same_category(self):</span>
        <span class="s2"># check fastpath</span>
        <span class="s1">c1 = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])</span>
        <span class="s1">c2 = Categorical([</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])</span>
        <span class="s1">res = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2])</span>
        <span class="s1">exp = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])</span>
        <span class="s1">tm.assert_categorical_equal(res</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s1">c1 = Categorical([</span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s1">])</span>
        <span class="s1">c2 = Categorical([</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;x&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s1">])</span>
        <span class="s1">res = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2])</span>
        <span class="s1">exp = Categorical([</span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;x&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_categorical_equal(res</span><span class="s0">, </span><span class="s1">exp)</span>

    <span class="s0">def </span><span class="s1">test_union_categorical_same_categories_different_order(self):</span>
        <span class="s2"># https://github.com/pandas-dev/pandas/issues/19096</span>
        <span class="s1">c1 = Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">c2 = Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">result = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2])</span>
        <span class="s1">expected = Categorical(</span>
            <span class="s1">[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_union_categoricals_ordered(self):</span>
        <span class="s1">c1 = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">c2 = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">False</span><span class="s1">)</span>

        <span class="s1">msg = </span><span class="s3">&quot;Categorical.ordered must be the same&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2])</span>

        <span class="s1">res = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c1])</span>
        <span class="s1">exp = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_categorical_equal(res</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s1">c1 = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">c2 = Categorical([</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>

        <span class="s1">res = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2])</span>
        <span class="s1">exp = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_categorical_equal(res</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s1">c1 = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">c2 = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>

        <span class="s1">msg = </span><span class="s3">&quot;to union ordered Categoricals, all categories must be the same&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2])</span>

    <span class="s0">def </span><span class="s1">test_union_categoricals_ignore_order(self):</span>
        <span class="s2"># GH 15219</span>
        <span class="s1">c1 = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">c2 = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">False</span><span class="s1">)</span>

        <span class="s1">res = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2]</span><span class="s0">, </span><span class="s1">ignore_order=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">exp = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span>
        <span class="s1">tm.assert_categorical_equal(res</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s1">msg = </span><span class="s3">&quot;Categorical.ordered must be the same&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2]</span><span class="s0">, </span><span class="s1">ignore_order=</span><span class="s0">False</span><span class="s1">)</span>

        <span class="s1">res = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c1]</span><span class="s0">, </span><span class="s1">ignore_order=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">exp = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span>
        <span class="s1">tm.assert_categorical_equal(res</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s1">res = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c1]</span><span class="s0">, </span><span class="s1">ignore_order=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">exp = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_categorical_equal(res</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s1">c1 = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">c2 = Categorical([</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>

        <span class="s1">res = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2]</span><span class="s0">, </span><span class="s1">ignore_order=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">exp = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>
        <span class="s1">tm.assert_categorical_equal(res</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s1">c1 = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">c2 = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>

        <span class="s1">res = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2]</span><span class="s0">, </span><span class="s1">ignore_order=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">exp = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span>
        <span class="s1">tm.assert_categorical_equal(res</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s1">res = union_categoricals([c2</span><span class="s0">, </span><span class="s1">c1]</span><span class="s0">, </span><span class="s1">ignore_order=</span><span class="s0">True, </span><span class="s1">sort_categories=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">exp = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span>
        <span class="s1">tm.assert_categorical_equal(res</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s1">c1 = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">c2 = Categorical([</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">result = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2]</span><span class="s0">, </span><span class="s1">ignore_order=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected = Categorical([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">])</span>
        <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">msg = </span><span class="s3">&quot;to union ordered Categoricals, all categories must be the same&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2]</span><span class="s0">, </span><span class="s1">ignore_order=</span><span class="s0">False</span><span class="s1">)</span>

        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2])</span>

    <span class="s0">def </span><span class="s1">test_union_categoricals_sort(self):</span>
        <span class="s2"># GH 13846</span>
        <span class="s1">c1 = Categorical([</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s1">])</span>
        <span class="s1">c2 = Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">result = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2]</span><span class="s0">, </span><span class="s1">sort_categories=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected = Categorical(</span>
            <span class="s1">[</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># fastpath</span>
        <span class="s1">c1 = Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">c2 = Categorical([</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">result = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2]</span><span class="s0">, </span><span class="s1">sort_categories=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected = Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">c1 = Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">])</span>
        <span class="s1">c2 = Categorical([</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">])</span>
        <span class="s1">result = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2]</span><span class="s0">, </span><span class="s1">sort_categories=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected = Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># fastpath - skip resort</span>
        <span class="s1">c1 = Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">c2 = Categorical([</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">result = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2]</span><span class="s0">, </span><span class="s1">sort_categories=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected = Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">c1 = Categorical([</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s1">np.nan])</span>
        <span class="s1">c2 = Categorical([np.nan</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">])</span>
        <span class="s1">result = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2]</span><span class="s0">, </span><span class="s1">sort_categories=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected = Categorical([</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;x&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">c1 = Categorical([np.nan])</span>
        <span class="s1">c2 = Categorical([np.nan])</span>
        <span class="s1">result = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2]</span><span class="s0">, </span><span class="s1">sort_categories=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected = Categorical([np.nan</span><span class="s0">, </span><span class="s1">np.nan])</span>
        <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">c1 = Categorical([])</span>
        <span class="s1">c2 = Categorical([])</span>
        <span class="s1">result = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2]</span><span class="s0">, </span><span class="s1">sort_categories=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected = Categorical([])</span>
        <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">c1 = Categorical([</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">c2 = Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">msg = </span><span class="s3">&quot;Cannot use sort_categories=True with ordered Categoricals&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2]</span><span class="s0">, </span><span class="s1">sort_categories=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_union_categoricals_sort_false(self):</span>
        <span class="s2"># GH 13846</span>
        <span class="s1">c1 = Categorical([</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s1">])</span>
        <span class="s1">c2 = Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">result = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2]</span><span class="s0">, </span><span class="s1">sort_categories=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">expected = Categorical(</span>
            <span class="s1">[</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s0">, </span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># fastpath</span>
        <span class="s1">c1 = Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">c2 = Categorical([</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">result = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2]</span><span class="s0">, </span><span class="s1">sort_categories=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">expected = Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># fastpath - skip resort</span>
        <span class="s1">c1 = Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">c2 = Categorical([</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">result = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2]</span><span class="s0">, </span><span class="s1">sort_categories=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">expected = Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">c1 = Categorical([</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s1">np.nan])</span>
        <span class="s1">c2 = Categorical([np.nan</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">])</span>
        <span class="s1">result = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2]</span><span class="s0">, </span><span class="s1">sort_categories=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">expected = Categorical([</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">c1 = Categorical([np.nan])</span>
        <span class="s1">c2 = Categorical([np.nan])</span>
        <span class="s1">result = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2]</span><span class="s0">, </span><span class="s1">sort_categories=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">expected = Categorical([np.nan</span><span class="s0">, </span><span class="s1">np.nan])</span>
        <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">c1 = Categorical([])</span>
        <span class="s1">c2 = Categorical([])</span>
        <span class="s1">result = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2]</span><span class="s0">, </span><span class="s1">sort_categories=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">expected = Categorical([])</span>
        <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">c1 = Categorical([</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">c2 = Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">result = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2]</span><span class="s0">, </span><span class="s1">sort_categories=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">expected = Categorical(</span>
            <span class="s1">[</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ordered=</span><span class="s0">True</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_union_categorical_unwrap(self):</span>
        <span class="s2"># GH 14173</span>
        <span class="s1">c1 = Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">])</span>
        <span class="s1">c2 = Series([</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;category&quot;</span><span class="s1">)</span>
        <span class="s1">result = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2])</span>
        <span class="s1">expected = Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">c2 = CategoricalIndex(c2)</span>
        <span class="s1">result = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2])</span>
        <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">c1 = Series(c1)</span>
        <span class="s1">result = union_categoricals([c1</span><span class="s0">, </span><span class="s1">c2])</span>
        <span class="s1">tm.assert_categorical_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">msg = </span><span class="s3">&quot;all components to combine must be Categorical&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">union_categoricals([c1</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]])</span>
</pre>
</body>
</html>