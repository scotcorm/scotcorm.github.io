<html>
<head>
<title>test_date_range.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
.s5 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_date_range.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
test date_range, bdate_range construction from the convenience range functions 
&quot;&quot;&quot;</span>

<span class="s2">from </span><span class="s1">datetime </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">datetime</span><span class="s2">,</span>
    <span class="s1">time</span><span class="s2">,</span>
    <span class="s1">timedelta</span><span class="s2">,</span>
<span class="s1">)</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">import </span><span class="s1">pytest</span>
<span class="s2">import </span><span class="s1">pytz</span>
<span class="s2">from </span><span class="s1">pytz </span><span class="s2">import </span><span class="s1">timezone</span>

<span class="s2">from </span><span class="s1">pandas._libs.tslibs </span><span class="s2">import </span><span class="s1">timezones</span>
<span class="s2">from </span><span class="s1">pandas._libs.tslibs.offsets </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">BDay</span><span class="s2">,</span>
    <span class="s1">CDay</span><span class="s2">,</span>
    <span class="s1">DateOffset</span><span class="s2">,</span>
    <span class="s1">MonthEnd</span><span class="s2">,</span>
    <span class="s1">prefix_mapping</span><span class="s2">,</span>
<span class="s1">)</span>
<span class="s2">from </span><span class="s1">pandas.errors </span><span class="s2">import </span><span class="s1">OutOfBoundsDatetime</span>
<span class="s2">import </span><span class="s1">pandas.util._test_decorators </span><span class="s2">as </span><span class="s1">td</span>

<span class="s2">import </span><span class="s1">pandas </span><span class="s2">as </span><span class="s1">pd</span>
<span class="s2">from </span><span class="s1">pandas </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">DatetimeIndex</span><span class="s2">,</span>
    <span class="s1">Timedelta</span><span class="s2">,</span>
    <span class="s1">Timestamp</span><span class="s2">,</span>
    <span class="s1">bdate_range</span><span class="s2">,</span>
    <span class="s1">date_range</span><span class="s2">,</span>
    <span class="s1">offsets</span><span class="s2">,</span>
<span class="s1">)</span>
<span class="s2">import </span><span class="s1">pandas._testing </span><span class="s2">as </span><span class="s1">tm</span>
<span class="s2">from </span><span class="s1">pandas.core.arrays.datetimes </span><span class="s2">import </span><span class="s1">generate_range</span>

<span class="s1">START</span><span class="s2">, </span><span class="s1">END = datetime(</span><span class="s3">2009</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2010</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">_get_expected_range(</span>
    <span class="s1">begin_to_match</span><span class="s2">,</span>
    <span class="s1">end_to_match</span><span class="s2">,</span>
    <span class="s1">both_range</span><span class="s2">,</span>
    <span class="s1">inclusive_endpoints</span><span class="s2">,</span>
<span class="s1">):</span>
    <span class="s0">&quot;&quot;&quot;Helper to get expected range from a both inclusive range&quot;&quot;&quot;</span>
    <span class="s1">left_match = begin_to_match == both_range[</span><span class="s3">0</span><span class="s1">]</span>
    <span class="s1">right_match = end_to_match == both_range[-</span><span class="s3">1</span><span class="s1">]</span>

    <span class="s2">if </span><span class="s1">inclusive_endpoints == </span><span class="s4">&quot;left&quot; </span><span class="s2">and </span><span class="s1">right_match:</span>
        <span class="s1">expected_range = both_range[:-</span><span class="s3">1</span><span class="s1">]</span>
    <span class="s2">elif </span><span class="s1">inclusive_endpoints == </span><span class="s4">&quot;right&quot; </span><span class="s2">and </span><span class="s1">left_match:</span>
        <span class="s1">expected_range = both_range[</span><span class="s3">1</span><span class="s1">:]</span>
    <span class="s2">elif </span><span class="s1">inclusive_endpoints == </span><span class="s4">&quot;neither&quot; </span><span class="s2">and </span><span class="s1">left_match </span><span class="s2">and </span><span class="s1">right_match:</span>
        <span class="s1">expected_range = both_range[</span><span class="s3">1</span><span class="s1">:-</span><span class="s3">1</span><span class="s1">]</span>
    <span class="s2">elif </span><span class="s1">inclusive_endpoints == </span><span class="s4">&quot;neither&quot; </span><span class="s2">and </span><span class="s1">right_match:</span>
        <span class="s1">expected_range = both_range[:-</span><span class="s3">1</span><span class="s1">]</span>
    <span class="s2">elif </span><span class="s1">inclusive_endpoints == </span><span class="s4">&quot;neither&quot; </span><span class="s2">and </span><span class="s1">left_match:</span>
        <span class="s1">expected_range = both_range[</span><span class="s3">1</span><span class="s1">:]</span>
    <span class="s2">elif </span><span class="s1">inclusive_endpoints == </span><span class="s4">&quot;both&quot;</span><span class="s1">:</span>
        <span class="s1">expected_range = both_range[:]</span>
    <span class="s2">else</span><span class="s1">:</span>
        <span class="s1">expected_range = both_range[:]</span>

    <span class="s2">return </span><span class="s1">expected_range</span>


<span class="s2">class </span><span class="s1">TestTimestampEquivDateRange:</span>
    <span class="s5"># Older tests in TestTimeSeries constructed their `stamp` objects</span>
    <span class="s5"># using `date_range` instead of the `Timestamp` constructor.</span>
    <span class="s5"># TestTimestampEquivDateRange checks that these are equivalent in the</span>
    <span class="s5"># pertinent cases.</span>

    <span class="s2">def </span><span class="s1">test_date_range_timestamp_equiv(self):</span>
        <span class="s1">rng = date_range(</span><span class="s4">&quot;20090415&quot;</span><span class="s2">, </span><span class="s4">&quot;20090519&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s1">stamp = rng[</span><span class="s3">0</span><span class="s1">]</span>

        <span class="s1">ts = Timestamp(</span><span class="s4">&quot;20090415&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">ts == stamp</span>

    <span class="s2">def </span><span class="s1">test_date_range_timestamp_equiv_dateutil(self):</span>
        <span class="s1">rng = date_range(</span><span class="s4">&quot;20090415&quot;</span><span class="s2">, </span><span class="s4">&quot;20090519&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;dateutil/US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s1">stamp = rng[</span><span class="s3">0</span><span class="s1">]</span>

        <span class="s1">ts = Timestamp(</span><span class="s4">&quot;20090415&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;dateutil/US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">ts == stamp</span>

    <span class="s2">def </span><span class="s1">test_date_range_timestamp_equiv_explicit_pytz(self):</span>
        <span class="s1">rng = date_range(</span><span class="s4">&quot;20090415&quot;</span><span class="s2">, </span><span class="s4">&quot;20090519&quot;</span><span class="s2">, </span><span class="s1">tz=pytz.timezone(</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">))</span>
        <span class="s1">stamp = rng[</span><span class="s3">0</span><span class="s1">]</span>

        <span class="s1">ts = Timestamp(</span><span class="s4">&quot;20090415&quot;</span><span class="s2">, </span><span class="s1">tz=pytz.timezone(</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">))</span>
        <span class="s2">assert </span><span class="s1">ts == stamp</span>

    <span class="s1">@td.skip_if_windows</span>
    <span class="s2">def </span><span class="s1">test_date_range_timestamp_equiv_explicit_dateutil(self):</span>
        <span class="s2">from </span><span class="s1">pandas._libs.tslibs.timezones </span><span class="s2">import </span><span class="s1">dateutil_gettz </span><span class="s2">as </span><span class="s1">gettz</span>

        <span class="s1">rng = date_range(</span><span class="s4">&quot;20090415&quot;</span><span class="s2">, </span><span class="s4">&quot;20090519&quot;</span><span class="s2">, </span><span class="s1">tz=gettz(</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">))</span>
        <span class="s1">stamp = rng[</span><span class="s3">0</span><span class="s1">]</span>

        <span class="s1">ts = Timestamp(</span><span class="s4">&quot;20090415&quot;</span><span class="s2">, </span><span class="s1">tz=gettz(</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">))</span>
        <span class="s2">assert </span><span class="s1">ts == stamp</span>

    <span class="s2">def </span><span class="s1">test_date_range_timestamp_equiv_from_datetime_instance(self):</span>
        <span class="s1">datetime_instance = datetime(</span><span class="s3">2014</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s1">)</span>
        <span class="s5"># build a timestamp with a frequency, since then it supports</span>
        <span class="s5"># addition/subtraction of integers</span>
        <span class="s1">timestamp_instance = date_range(datetime_instance</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;D&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">]</span>

        <span class="s1">ts = Timestamp(datetime_instance)</span>
        <span class="s2">assert </span><span class="s1">ts == timestamp_instance</span>

    <span class="s2">def </span><span class="s1">test_date_range_timestamp_equiv_preserve_frequency(self):</span>
        <span class="s1">timestamp_instance = date_range(</span><span class="s4">&quot;2014-03-05&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;D&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">]</span>
        <span class="s1">ts = Timestamp(</span><span class="s4">&quot;2014-03-05&quot;</span><span class="s1">)</span>

        <span class="s2">assert </span><span class="s1">timestamp_instance == ts</span>


<span class="s2">class </span><span class="s1">TestDateRanges:</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;freq&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">&quot;N&quot;</span><span class="s2">, </span><span class="s4">&quot;U&quot;</span><span class="s2">, </span><span class="s4">&quot;L&quot;</span><span class="s2">, </span><span class="s4">&quot;T&quot;</span><span class="s2">, </span><span class="s4">&quot;S&quot;</span><span class="s2">, </span><span class="s4">&quot;H&quot;</span><span class="s2">, </span><span class="s4">&quot;D&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_date_range_edges(self</span><span class="s2">, </span><span class="s1">freq):</span>
        <span class="s5"># GH#13672</span>
        <span class="s1">td = Timedelta(</span><span class="s4">f&quot;1</span><span class="s2">{</span><span class="s1">freq</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s1">)</span>
        <span class="s1">ts = Timestamp(</span><span class="s4">&quot;1970-01-01&quot;</span><span class="s1">)</span>

        <span class="s1">idx = date_range(</span>
            <span class="s1">start=ts + td</span><span class="s2">,</span>
            <span class="s1">end=ts + </span><span class="s3">4 </span><span class="s1">* td</span><span class="s2">,</span>
            <span class="s1">freq=freq</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">exp = DatetimeIndex(</span>
            <span class="s1">[ts + n * td </span><span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">range(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">5</span><span class="s1">)]</span><span class="s2">,</span>
            <span class="s1">freq=freq</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(idx</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s5"># start after end</span>
        <span class="s1">idx = date_range(</span>
            <span class="s1">start=ts + </span><span class="s3">4 </span><span class="s1">* td</span><span class="s2">,</span>
            <span class="s1">end=ts + td</span><span class="s2">,</span>
            <span class="s1">freq=freq</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">exp = DatetimeIndex([]</span><span class="s2">, </span><span class="s1">freq=freq)</span>
        <span class="s1">tm.assert_index_equal(idx</span><span class="s2">, </span><span class="s1">exp)</span>

        <span class="s5"># start matches end</span>
        <span class="s1">idx = date_range(</span>
            <span class="s1">start=ts + td</span><span class="s2">,</span>
            <span class="s1">end=ts + td</span><span class="s2">,</span>
            <span class="s1">freq=freq</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">exp = DatetimeIndex([ts + td]</span><span class="s2">, </span><span class="s1">freq=freq)</span>
        <span class="s1">tm.assert_index_equal(idx</span><span class="s2">, </span><span class="s1">exp)</span>

    <span class="s2">def </span><span class="s1">test_date_range_near_implementation_bound(self):</span>
        <span class="s5"># GH#???</span>
        <span class="s1">freq = Timedelta(</span><span class="s3">1</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(OutOfBoundsDatetime</span><span class="s2">, </span><span class="s1">match=</span><span class="s4">&quot;Cannot generate range with&quot;</span><span class="s1">):</span>
            <span class="s1">date_range(end=Timestamp.min</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">freq=freq)</span>

    <span class="s2">def </span><span class="s1">test_date_range_nat(self):</span>
        <span class="s5"># GH#11587</span>
        <span class="s1">msg = </span><span class="s4">&quot;Neither `start` nor `end` can be NaT&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(start=</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">end=pd.NaT</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(start=pd.NaT</span><span class="s2">, </span><span class="s1">end=</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;D&quot;</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_multiplication_overflow(self):</span>
        <span class="s5"># GH#24255</span>
        <span class="s5"># check that overflows in calculating `addend = periods * stride`</span>
        <span class="s5">#  are caught</span>
        <span class="s2">with </span><span class="s1">tm.assert_produces_warning(</span><span class="s2">None</span><span class="s1">):</span>
            <span class="s5"># we should _not_ be seeing a overflow RuntimeWarning</span>
            <span class="s1">dti = date_range(start=</span><span class="s4">&quot;1677-09-22&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">213503</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;D&quot;</span><span class="s1">)</span>

        <span class="s2">assert </span><span class="s1">dti[</span><span class="s3">0</span><span class="s1">] == Timestamp(</span><span class="s4">&quot;1677-09-22&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">len(dti) == </span><span class="s3">213503</span>

        <span class="s1">msg = </span><span class="s4">&quot;Cannot generate range with&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(OutOfBoundsDatetime</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(</span><span class="s4">&quot;1969-05-04&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">200000000</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;30000D&quot;</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_unsigned_overflow_handling(self):</span>
        <span class="s5"># GH#24255</span>
        <span class="s5"># case where `addend = periods * stride` overflows int64 bounds</span>
        <span class="s5">#  but not uint64 bounds</span>
        <span class="s1">dti = date_range(start=</span><span class="s4">&quot;1677-09-22&quot;</span><span class="s2">, </span><span class="s1">end=</span><span class="s4">&quot;2262-04-11&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;D&quot;</span><span class="s1">)</span>

        <span class="s1">dti2 = date_range(start=dti[</span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">periods=len(dti)</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">dti2.equals(dti)</span>

        <span class="s1">dti3 = date_range(end=dti[-</span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">periods=len(dti)</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">dti3.equals(dti)</span>

    <span class="s2">def </span><span class="s1">test_date_range_int64_overflow_non_recoverable(self):</span>
        <span class="s5"># GH#24255</span>
        <span class="s5"># case with start later than 1970-01-01, overflow int64 but not uint64</span>
        <span class="s1">msg = </span><span class="s4">&quot;Cannot generate range with&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(OutOfBoundsDatetime</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(start=</span><span class="s4">&quot;1970-02-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">106752 </span><span class="s1">* </span><span class="s3">24</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;H&quot;</span><span class="s1">)</span>

        <span class="s5"># case with end before 1970-01-01, overflow int64 but not uint64</span>
        <span class="s2">with </span><span class="s1">pytest.raises(OutOfBoundsDatetime</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(end=</span><span class="s4">&quot;1969-11-14&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">106752 </span><span class="s1">* </span><span class="s3">24</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;H&quot;</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.slow</span>
    <span class="s2">def </span><span class="s1">test_date_range_int64_overflow_stride_endpoint_different_signs(self):</span>
        <span class="s5"># cases where stride * periods overflow int64 and stride/endpoint</span>
        <span class="s5">#  have different signs</span>
        <span class="s1">start = Timestamp(</span><span class="s4">&quot;2262-02-23&quot;</span><span class="s1">)</span>
        <span class="s1">end = Timestamp(</span><span class="s4">&quot;1969-11-14&quot;</span><span class="s1">)</span>

        <span class="s1">expected = date_range(start=start</span><span class="s2">, </span><span class="s1">end=end</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;-1H&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">expected[</span><span class="s3">0</span><span class="s1">] == start</span>
        <span class="s2">assert </span><span class="s1">expected[-</span><span class="s3">1</span><span class="s1">] == end</span>

        <span class="s1">dti = date_range(end=end</span><span class="s2">, </span><span class="s1">periods=len(expected)</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;-1H&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(dti</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">start2 = Timestamp(</span><span class="s4">&quot;1970-02-01&quot;</span><span class="s1">)</span>
        <span class="s1">end2 = Timestamp(</span><span class="s4">&quot;1677-10-22&quot;</span><span class="s1">)</span>

        <span class="s1">expected2 = date_range(start=start2</span><span class="s2">, </span><span class="s1">end=end2</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;-1H&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">expected2[</span><span class="s3">0</span><span class="s1">] == start2</span>
        <span class="s2">assert </span><span class="s1">expected2[-</span><span class="s3">1</span><span class="s1">] == end2</span>

        <span class="s1">dti2 = date_range(start=start2</span><span class="s2">, </span><span class="s1">periods=len(expected2)</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;-1H&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(dti2</span><span class="s2">, </span><span class="s1">expected2)</span>

    <span class="s2">def </span><span class="s1">test_date_range_out_of_bounds(self):</span>
        <span class="s5"># GH#14187</span>
        <span class="s1">msg = </span><span class="s4">&quot;Cannot generate range&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(OutOfBoundsDatetime</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">100000</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s2">with </span><span class="s1">pytest.raises(OutOfBoundsDatetime</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(end=</span><span class="s4">&quot;1763-10-12&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">100000</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;D&quot;</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_gen_error(self):</span>
        <span class="s1">rng = date_range(</span><span class="s4">&quot;1/1/2000 00:00&quot;</span><span class="s2">, </span><span class="s4">&quot;1/1/2000 00:18&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;5min&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">len(rng) == </span><span class="s3">4</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;freq&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">&quot;AS&quot;</span><span class="s2">, </span><span class="s4">&quot;YS&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_begin_year_alias(self</span><span class="s2">, </span><span class="s1">freq):</span>
        <span class="s5"># see gh-9313</span>
        <span class="s1">rng = date_range(</span><span class="s4">&quot;1/1/2013&quot;</span><span class="s2">, </span><span class="s4">&quot;7/1/2017&quot;</span><span class="s2">, </span><span class="s1">freq=freq)</span>
        <span class="s1">exp = DatetimeIndex(</span>
            <span class="s1">[</span><span class="s4">&quot;2013-01-01&quot;</span><span class="s2">, </span><span class="s4">&quot;2014-01-01&quot;</span><span class="s2">, </span><span class="s4">&quot;2015-01-01&quot;</span><span class="s2">, </span><span class="s4">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s4">&quot;2017-01-01&quot;</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">freq=freq</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(rng</span><span class="s2">, </span><span class="s1">exp)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;freq&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;Y&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_end_year_alias(self</span><span class="s2">, </span><span class="s1">freq):</span>
        <span class="s5"># see gh-9313</span>
        <span class="s1">rng = date_range(</span><span class="s4">&quot;1/1/2013&quot;</span><span class="s2">, </span><span class="s4">&quot;7/1/2017&quot;</span><span class="s2">, </span><span class="s1">freq=freq)</span>
        <span class="s1">exp = DatetimeIndex(</span>
            <span class="s1">[</span><span class="s4">&quot;2013-12-31&quot;</span><span class="s2">, </span><span class="s4">&quot;2014-12-31&quot;</span><span class="s2">, </span><span class="s4">&quot;2015-12-31&quot;</span><span class="s2">, </span><span class="s4">&quot;2016-12-31&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=freq</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(rng</span><span class="s2">, </span><span class="s1">exp)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;freq&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">&quot;BA&quot;</span><span class="s2">, </span><span class="s4">&quot;BY&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_business_end_year_alias(self</span><span class="s2">, </span><span class="s1">freq):</span>
        <span class="s5"># see gh-9313</span>
        <span class="s1">rng = date_range(</span><span class="s4">&quot;1/1/2013&quot;</span><span class="s2">, </span><span class="s4">&quot;7/1/2017&quot;</span><span class="s2">, </span><span class="s1">freq=freq)</span>
        <span class="s1">exp = DatetimeIndex(</span>
            <span class="s1">[</span><span class="s4">&quot;2013-12-31&quot;</span><span class="s2">, </span><span class="s4">&quot;2014-12-31&quot;</span><span class="s2">, </span><span class="s4">&quot;2015-12-31&quot;</span><span class="s2">, </span><span class="s4">&quot;2016-12-30&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=freq</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(rng</span><span class="s2">, </span><span class="s1">exp)</span>

    <span class="s2">def </span><span class="s1">test_date_range_negative_freq(self):</span>
        <span class="s5"># GH 11018</span>
        <span class="s1">rng = date_range(</span><span class="s4">&quot;2011-12-31&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;-2A&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">)</span>
        <span class="s1">exp = DatetimeIndex([</span><span class="s4">&quot;2011-12-31&quot;</span><span class="s2">, </span><span class="s4">&quot;2009-12-31&quot;</span><span class="s2">, </span><span class="s4">&quot;2007-12-31&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;-2A&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(rng</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s2">assert </span><span class="s1">rng.freq == </span><span class="s4">&quot;-2A&quot;</span>

        <span class="s1">rng = date_range(</span><span class="s4">&quot;2011-01-31&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;-2M&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">)</span>
        <span class="s1">exp = DatetimeIndex([</span><span class="s4">&quot;2011-01-31&quot;</span><span class="s2">, </span><span class="s4">&quot;2010-11-30&quot;</span><span class="s2">, </span><span class="s4">&quot;2010-09-30&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;-2M&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(rng</span><span class="s2">, </span><span class="s1">exp)</span>
        <span class="s2">assert </span><span class="s1">rng.freq == </span><span class="s4">&quot;-2M&quot;</span>

    <span class="s2">def </span><span class="s1">test_date_range_bms_bug(self):</span>
        <span class="s5"># #1645</span>
        <span class="s1">rng = date_range(</span><span class="s4">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">10</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;BMS&quot;</span><span class="s1">)</span>

        <span class="s1">ex_first = Timestamp(</span><span class="s4">&quot;2000-01-03&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">rng[</span><span class="s3">0</span><span class="s1">] == ex_first</span>

    <span class="s2">def </span><span class="s1">test_date_range_normalize(self):</span>
        <span class="s1">snap = datetime.today()</span>
        <span class="s1">n = </span><span class="s3">50</span>

        <span class="s1">rng = date_range(snap</span><span class="s2">, </span><span class="s1">periods=n</span><span class="s2">, </span><span class="s1">normalize=</span><span class="s2">False, </span><span class="s1">freq=</span><span class="s4">&quot;2D&quot;</span><span class="s1">)</span>

        <span class="s1">offset = timedelta(</span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">values = DatetimeIndex([snap + i * offset </span><span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(n)]</span><span class="s2">, </span><span class="s1">freq=offset)</span>

        <span class="s1">tm.assert_index_equal(rng</span><span class="s2">, </span><span class="s1">values)</span>

        <span class="s1">rng = date_range(</span><span class="s4">&quot;1/1/2000 08:15&quot;</span><span class="s2">, </span><span class="s1">periods=n</span><span class="s2">, </span><span class="s1">normalize=</span><span class="s2">False, </span><span class="s1">freq=</span><span class="s4">&quot;B&quot;</span><span class="s1">)</span>
        <span class="s1">the_time = time(</span><span class="s3">8</span><span class="s2">, </span><span class="s3">15</span><span class="s1">)</span>
        <span class="s2">for </span><span class="s1">val </span><span class="s2">in </span><span class="s1">rng:</span>
            <span class="s2">assert </span><span class="s1">val.time() == the_time</span>

    <span class="s2">def </span><span class="s1">test_date_range_fy5252(self):</span>
        <span class="s1">dr = date_range(</span>
            <span class="s1">start=</span><span class="s4">&quot;2013-01-01&quot;</span><span class="s2">,</span>
            <span class="s1">periods=</span><span class="s3">2</span><span class="s2">,</span>
            <span class="s1">freq=offsets.FY5253(startingMonth=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">weekday=</span><span class="s3">3</span><span class="s2">, </span><span class="s1">variation=</span><span class="s4">&quot;nearest&quot;</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">dr[</span><span class="s3">0</span><span class="s1">] == Timestamp(</span><span class="s4">&quot;2013-01-31&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">dr[</span><span class="s3">1</span><span class="s1">] == Timestamp(</span><span class="s4">&quot;2014-01-30&quot;</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_ambiguous_arguments(self):</span>
        <span class="s5"># #2538</span>
        <span class="s1">start = datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">40</span><span class="s1">)</span>
        <span class="s1">end = datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">8</span><span class="s2">, </span><span class="s3">9</span><span class="s2">, </span><span class="s3">40</span><span class="s1">)</span>

        <span class="s1">msg = (</span>
            <span class="s4">&quot;Of the four parameters: start, end, periods, and &quot;</span>
            <span class="s4">&quot;freq, exactly three must be specified&quot;</span>
        <span class="s1">)</span>
        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">10</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;s&quot;</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_convenience_periods(self):</span>
        <span class="s5"># GH 20808</span>
        <span class="s1">result = date_range(</span><span class="s4">&quot;2018-04-24&quot;</span><span class="s2">, </span><span class="s4">&quot;2018-04-27&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">)</span>
        <span class="s1">expected = DatetimeIndex(</span>
            <span class="s1">[</span><span class="s4">&quot;2018-04-24 00:00:00&quot;</span><span class="s2">, </span><span class="s4">&quot;2018-04-25 12:00:00&quot;</span><span class="s2">, </span><span class="s4">&quot;2018-04-27 00:00:00&quot;</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">freq=</span><span class="s2">None,</span>
        <span class="s1">)</span>

        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s5"># Test if spacing remains linear if tz changes to dst in range</span>
        <span class="s1">result = date_range(</span>
            <span class="s4">&quot;2018-04-01 01:00:00&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2018-04-01 04:00:00&quot;</span><span class="s2">,</span>
            <span class="s1">tz=</span><span class="s4">&quot;Australia/Sydney&quot;</span><span class="s2">,</span>
            <span class="s1">periods=</span><span class="s3">3</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">expected = DatetimeIndex(</span>
            <span class="s1">[</span>
                <span class="s1">Timestamp(</span><span class="s4">&quot;2018-04-01 01:00:00+1100&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;Australia/Sydney&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">Timestamp(</span><span class="s4">&quot;2018-04-01 02:00:00+1000&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;Australia/Sydney&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">Timestamp(</span><span class="s4">&quot;2018-04-01 04:00:00+1000&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;Australia/Sydney&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s4">&quot;start,end,result_tz&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">[</span><span class="s4">&quot;20180101&quot;</span><span class="s2">, </span><span class="s4">&quot;20180103&quot;</span><span class="s2">, </span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">[datetime(</span><span class="s3">2018</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2018</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">[Timestamp(</span><span class="s4">&quot;20180101&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">Timestamp(</span><span class="s4">&quot;20180103&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">[</span>
                <span class="s1">Timestamp(</span><span class="s4">&quot;20180101&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">Timestamp(</span><span class="s4">&quot;20180103&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s4">&quot;US/Eastern&quot;</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">,</span>
            <span class="s1">[</span>
                <span class="s1">Timestamp(</span><span class="s4">&quot;20180101&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">Timestamp(</span><span class="s4">&quot;20180103&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s2">None,</span>
            <span class="s1">]</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_date_range_linspacing_tz(self</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">result_tz):</span>
        <span class="s5"># GH 20983</span>
        <span class="s1">result = date_range(start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s2">, </span><span class="s1">tz=result_tz)</span>
        <span class="s1">expected = date_range(</span><span class="s4">&quot;20180101&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;D&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_date_range_businesshour(self):</span>
        <span class="s1">idx = DatetimeIndex(</span>
            <span class="s1">[</span>
                <span class="s4">&quot;2014-07-04 09:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 10:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 11:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 12:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 13:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 14:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 15:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 16:00&quot;</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">,</span>
            <span class="s1">freq=</span><span class="s4">&quot;BH&quot;</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">rng = date_range(</span><span class="s4">&quot;2014-07-04 09:00&quot;</span><span class="s2">, </span><span class="s4">&quot;2014-07-04 16:00&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;BH&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(idx</span><span class="s2">, </span><span class="s1">rng)</span>

        <span class="s1">idx = DatetimeIndex([</span><span class="s4">&quot;2014-07-04 16:00&quot;</span><span class="s2">, </span><span class="s4">&quot;2014-07-07 09:00&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;BH&quot;</span><span class="s1">)</span>
        <span class="s1">rng = date_range(</span><span class="s4">&quot;2014-07-04 16:00&quot;</span><span class="s2">, </span><span class="s4">&quot;2014-07-07 09:00&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;BH&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(idx</span><span class="s2">, </span><span class="s1">rng)</span>

        <span class="s1">idx = DatetimeIndex(</span>
            <span class="s1">[</span>
                <span class="s4">&quot;2014-07-04 09:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 10:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 11:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 12:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 13:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 14:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 15:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 16:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-07 09:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-07 10:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-07 11:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-07 12:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-07 13:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-07 14:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-07 15:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-07 16:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-08 09:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-08 10:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-08 11:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-08 12:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-08 13:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-08 14:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-08 15:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-08 16:00&quot;</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">,</span>
            <span class="s1">freq=</span><span class="s4">&quot;BH&quot;</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">rng = date_range(</span><span class="s4">&quot;2014-07-04 09:00&quot;</span><span class="s2">, </span><span class="s4">&quot;2014-07-08 16:00&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;BH&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(idx</span><span class="s2">, </span><span class="s1">rng)</span>

    <span class="s2">def </span><span class="s1">test_range_misspecified(self):</span>
        <span class="s5"># GH #1095</span>
        <span class="s1">msg = (</span>
            <span class="s4">&quot;Of the four parameters: start, end, periods, and &quot;</span>
            <span class="s4">&quot;freq, exactly three must be specified&quot;</span>
        <span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(start=</span><span class="s4">&quot;1/1/2000&quot;</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(end=</span><span class="s4">&quot;1/1/2000&quot;</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(periods=</span><span class="s3">10</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(start=</span><span class="s4">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;H&quot;</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(end=</span><span class="s4">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;H&quot;</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(periods=</span><span class="s3">10</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;H&quot;</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range()</span>

    <span class="s2">def </span><span class="s1">test_compat_replace(self):</span>
        <span class="s5"># https://github.com/statsmodels/statsmodels/issues/3349</span>
        <span class="s5"># replace should take ints/longs for compat</span>
        <span class="s1">result = date_range(Timestamp(</span><span class="s4">&quot;1960-04-01 00:00:00&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">76</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;QS-JAN&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">len(result) == </span><span class="s3">76</span>

    <span class="s2">def </span><span class="s1">test_catch_infinite_loop(self):</span>
        <span class="s1">offset = offsets.DateOffset(minute=</span><span class="s3">5</span><span class="s1">)</span>
        <span class="s5"># blow up, don't loop forever</span>
        <span class="s1">msg = </span><span class="s4">&quot;Offset &lt;DateOffset: minute=5&gt; did not increment date&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">11</span><span class="s2">, </span><span class="s3">11</span><span class="s1">)</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">11</span><span class="s2">, </span><span class="s3">12</span><span class="s1">)</span><span class="s2">, </span><span class="s1">freq=offset)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;periods&quot;</span><span class="s2">, </span><span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">))</span>
    <span class="s2">def </span><span class="s1">test_wom_len(self</span><span class="s2">, </span><span class="s1">periods):</span>
        <span class="s5"># https://github.com/pandas-dev/pandas/issues/20517</span>
        <span class="s1">res = date_range(start=</span><span class="s4">&quot;20110101&quot;</span><span class="s2">, </span><span class="s1">periods=periods</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;WOM-1MON&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">len(res) == periods</span>

    <span class="s2">def </span><span class="s1">test_construct_over_dst(self):</span>
        <span class="s5"># GH 20854</span>
        <span class="s1">pre_dst = Timestamp(</span><span class="s4">&quot;2010-11-07 01:00:00&quot;</span><span class="s1">).tz_localize(</span>
            <span class="s4">&quot;US/Pacific&quot;</span><span class="s2">, </span><span class="s1">ambiguous=</span><span class="s2">True</span>
        <span class="s1">)</span>
        <span class="s1">pst_dst = Timestamp(</span><span class="s4">&quot;2010-11-07 01:00:00&quot;</span><span class="s1">).tz_localize(</span>
            <span class="s4">&quot;US/Pacific&quot;</span><span class="s2">, </span><span class="s1">ambiguous=</span><span class="s2">False</span>
        <span class="s1">)</span>
        <span class="s1">expect_data = [</span>
            <span class="s1">Timestamp(</span><span class="s4">&quot;2010-11-07 00:00:00&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Pacific&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">pre_dst</span><span class="s2">,</span>
            <span class="s1">pst_dst</span><span class="s2">,</span>
        <span class="s1">]</span>
        <span class="s1">expected = DatetimeIndex(expect_data</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;H&quot;</span><span class="s1">)</span>
        <span class="s1">result = date_range(start=</span><span class="s4">&quot;2010-11-7&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;H&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Pacific&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_construct_with_different_start_end_string_format(self):</span>
        <span class="s5"># GH 12064</span>
        <span class="s1">result = date_range(</span>
            <span class="s4">&quot;2013-01-01 00:00:00+09:00&quot;</span><span class="s2">, </span><span class="s4">&quot;2013/01/01 02:00:00+09:00&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;H&quot;</span>
        <span class="s1">)</span>
        <span class="s1">expected = DatetimeIndex(</span>
            <span class="s1">[</span>
                <span class="s1">Timestamp(</span><span class="s4">&quot;2013-01-01 00:00:00+09:00&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">Timestamp(</span><span class="s4">&quot;2013-01-01 01:00:00+09:00&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">Timestamp(</span><span class="s4">&quot;2013-01-01 02:00:00+09:00&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">,</span>
            <span class="s1">freq=</span><span class="s4">&quot;H&quot;</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_error_with_zero_monthends(self):</span>
        <span class="s1">msg = </span><span class="s4">r&quot;Offset &lt;0 \* MonthEnds&gt; did not increment date&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(</span><span class="s4">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s4">&quot;1/1/2001&quot;</span><span class="s2">, </span><span class="s1">freq=MonthEnd(</span><span class="s3">0</span><span class="s1">))</span>

    <span class="s2">def </span><span class="s1">test_range_bug(self):</span>
        <span class="s5"># GH #770</span>
        <span class="s1">offset = DateOffset(months=</span><span class="s3">3</span><span class="s1">)</span>
        <span class="s1">result = date_range(</span><span class="s4">&quot;2011-1-1&quot;</span><span class="s2">, </span><span class="s4">&quot;2012-1-31&quot;</span><span class="s2">, </span><span class="s1">freq=offset)</span>

        <span class="s1">start = datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">expected = DatetimeIndex([start + i * offset </span><span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(</span><span class="s3">5</span><span class="s1">)]</span><span class="s2">, </span><span class="s1">freq=offset)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_range_tz_pytz(self):</span>
        <span class="s5"># see gh-2906</span>
        <span class="s1">tz = timezone(</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s1">start = tz.localize(datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">))</span>
        <span class="s1">end = tz.localize(datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">3</span><span class="s1">))</span>

        <span class="s1">dr = date_range(start=start</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">dr.tz.zone == tz.zone</span>
        <span class="s2">assert </span><span class="s1">dr[</span><span class="s3">0</span><span class="s1">] == start</span>
        <span class="s2">assert </span><span class="s1">dr[</span><span class="s3">2</span><span class="s1">] == end</span>

        <span class="s1">dr = date_range(end=end</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">dr.tz.zone == tz.zone</span>
        <span class="s2">assert </span><span class="s1">dr[</span><span class="s3">0</span><span class="s1">] == start</span>
        <span class="s2">assert </span><span class="s1">dr[</span><span class="s3">2</span><span class="s1">] == end</span>

        <span class="s1">dr = date_range(start=start</span><span class="s2">, </span><span class="s1">end=end)</span>
        <span class="s2">assert </span><span class="s1">dr.tz.zone == tz.zone</span>
        <span class="s2">assert </span><span class="s1">dr[</span><span class="s3">0</span><span class="s1">] == start</span>
        <span class="s2">assert </span><span class="s1">dr[</span><span class="s3">2</span><span class="s1">] == end</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s4">&quot;start, end&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">[</span>
                <span class="s1">Timestamp(datetime(</span><span class="s3">2014</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">6</span><span class="s1">)</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">Timestamp(datetime(</span><span class="s3">2014</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">12</span><span class="s1">)</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">,</span>
            <span class="s1">[</span>
                <span class="s1">Timestamp(datetime(</span><span class="s3">2013</span><span class="s2">, </span><span class="s3">11</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">Timestamp(datetime(</span><span class="s3">2013</span><span class="s2">, </span><span class="s3">11</span><span class="s2">, </span><span class="s3">6</span><span class="s1">)</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_range_tz_dst_straddle_pytz(self</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">end):</span>
        <span class="s1">dr = date_range(start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">dr[</span><span class="s3">0</span><span class="s1">] == start</span>
        <span class="s2">assert </span><span class="s1">dr[-</span><span class="s3">1</span><span class="s1">] == end</span>
        <span class="s2">assert </span><span class="s1">np.all(dr.hour == </span><span class="s3">0</span><span class="s1">)</span>

        <span class="s1">dr = date_range(start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;D&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">dr[</span><span class="s3">0</span><span class="s1">] == start</span>
        <span class="s2">assert </span><span class="s1">dr[-</span><span class="s3">1</span><span class="s1">] == end</span>
        <span class="s2">assert </span><span class="s1">np.all(dr.hour == </span><span class="s3">0</span><span class="s1">)</span>

        <span class="s1">dr = date_range(</span>
            <span class="s1">start.replace(tzinfo=</span><span class="s2">None</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">end.replace(tzinfo=</span><span class="s2">None</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">freq=</span><span class="s4">&quot;D&quot;</span><span class="s2">,</span>
            <span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">dr[</span><span class="s3">0</span><span class="s1">] == start</span>
        <span class="s2">assert </span><span class="s1">dr[-</span><span class="s3">1</span><span class="s1">] == end</span>
        <span class="s2">assert </span><span class="s1">np.all(dr.hour == </span><span class="s3">0</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_range_tz_dateutil(self):</span>
        <span class="s5"># see gh-2906</span>

        <span class="s5"># Use maybe_get_tz to fix filename in tz under dateutil.</span>
        <span class="s2">from </span><span class="s1">pandas._libs.tslibs.timezones </span><span class="s2">import </span><span class="s1">maybe_get_tz</span>

        <span class="s1">tz = </span><span class="s2">lambda </span><span class="s1">x: maybe_get_tz(</span><span class="s4">&quot;dateutil/&quot; </span><span class="s1">+ x)</span>

        <span class="s1">start = datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">tzinfo=tz(</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">))</span>
        <span class="s1">end = datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s1">tzinfo=tz(</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">))</span>

        <span class="s1">dr = date_range(start=start</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">dr.tz == tz(</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">dr[</span><span class="s3">0</span><span class="s1">] == start</span>
        <span class="s2">assert </span><span class="s1">dr[</span><span class="s3">2</span><span class="s1">] == end</span>

        <span class="s1">dr = date_range(end=end</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">dr.tz == tz(</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">dr[</span><span class="s3">0</span><span class="s1">] == start</span>
        <span class="s2">assert </span><span class="s1">dr[</span><span class="s3">2</span><span class="s1">] == end</span>

        <span class="s1">dr = date_range(start=start</span><span class="s2">, </span><span class="s1">end=end)</span>
        <span class="s2">assert </span><span class="s1">dr.tz == tz(</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">dr[</span><span class="s3">0</span><span class="s1">] == start</span>
        <span class="s2">assert </span><span class="s1">dr[</span><span class="s3">2</span><span class="s1">] == end</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;freq&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">&quot;1D&quot;</span><span class="s2">, </span><span class="s4">&quot;3D&quot;</span><span class="s2">, </span><span class="s4">&quot;2M&quot;</span><span class="s2">, </span><span class="s4">&quot;7W&quot;</span><span class="s2">, </span><span class="s4">&quot;3H&quot;</span><span class="s2">, </span><span class="s4">&quot;A&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_range_closed(self</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">inclusive_endpoints_fixture):</span>
        <span class="s1">begin = datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">end = datetime(</span><span class="s3">2014</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span>

        <span class="s1">result_range = date_range(</span>
            <span class="s1">begin</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">inclusive=inclusive_endpoints_fixture</span><span class="s2">, </span><span class="s1">freq=freq</span>
        <span class="s1">)</span>
        <span class="s1">both_range = date_range(begin</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">inclusive=</span><span class="s4">&quot;both&quot;</span><span class="s2">, </span><span class="s1">freq=freq)</span>
        <span class="s1">expected_range = _get_expected_range(</span>
            <span class="s1">begin</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">both_range</span><span class="s2">, </span><span class="s1">inclusive_endpoints_fixture</span>
        <span class="s1">)</span>

        <span class="s1">tm.assert_index_equal(expected_range</span><span class="s2">, </span><span class="s1">result_range)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;freq&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">&quot;1D&quot;</span><span class="s2">, </span><span class="s4">&quot;3D&quot;</span><span class="s2">, </span><span class="s4">&quot;2M&quot;</span><span class="s2">, </span><span class="s4">&quot;7W&quot;</span><span class="s2">, </span><span class="s4">&quot;3H&quot;</span><span class="s2">, </span><span class="s4">&quot;A&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_range_closed_with_tz_aware_start_end(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">inclusive_endpoints_fixture</span>
    <span class="s1">):</span>
        <span class="s5"># GH12409, GH12684</span>
        <span class="s1">begin = Timestamp(</span><span class="s4">&quot;2011/1/1&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s1">end = Timestamp(</span><span class="s4">&quot;2014/1/1&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span>

        <span class="s1">result_range = date_range(</span>
            <span class="s1">begin</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">inclusive=inclusive_endpoints_fixture</span><span class="s2">, </span><span class="s1">freq=freq</span>
        <span class="s1">)</span>
        <span class="s1">both_range = date_range(begin</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">inclusive=</span><span class="s4">&quot;both&quot;</span><span class="s2">, </span><span class="s1">freq=freq)</span>
        <span class="s1">expected_range = _get_expected_range(</span>
            <span class="s1">begin</span><span class="s2">,</span>
            <span class="s1">end</span><span class="s2">,</span>
            <span class="s1">both_range</span><span class="s2">,</span>
            <span class="s1">inclusive_endpoints_fixture</span><span class="s2">,</span>
        <span class="s1">)</span>

        <span class="s1">tm.assert_index_equal(expected_range</span><span class="s2">, </span><span class="s1">result_range)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;freq&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">&quot;1D&quot;</span><span class="s2">, </span><span class="s4">&quot;3D&quot;</span><span class="s2">, </span><span class="s4">&quot;2M&quot;</span><span class="s2">, </span><span class="s4">&quot;7W&quot;</span><span class="s2">, </span><span class="s4">&quot;3H&quot;</span><span class="s2">, </span><span class="s4">&quot;A&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_range_with_tz_closed_with_tz_aware_start_end(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">inclusive_endpoints_fixture</span>
    <span class="s1">):</span>
        <span class="s1">begin = Timestamp(</span><span class="s4">&quot;2011/1/1&quot;</span><span class="s1">)</span>
        <span class="s1">end = Timestamp(</span><span class="s4">&quot;2014/1/1&quot;</span><span class="s1">)</span>
        <span class="s1">begintz = Timestamp(</span><span class="s4">&quot;2011/1/1&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s1">endtz = Timestamp(</span><span class="s4">&quot;2014/1/1&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span>

        <span class="s1">result_range = date_range(</span>
            <span class="s1">begin</span><span class="s2">,</span>
            <span class="s1">end</span><span class="s2">,</span>
            <span class="s1">inclusive=inclusive_endpoints_fixture</span><span class="s2">,</span>
            <span class="s1">freq=freq</span><span class="s2">,</span>
            <span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">both_range = date_range(</span>
            <span class="s1">begin</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">inclusive=</span><span class="s4">&quot;both&quot;</span><span class="s2">, </span><span class="s1">freq=freq</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span>
        <span class="s1">)</span>
        <span class="s1">expected_range = _get_expected_range(</span>
            <span class="s1">begintz</span><span class="s2">,</span>
            <span class="s1">endtz</span><span class="s2">,</span>
            <span class="s1">both_range</span><span class="s2">,</span>
            <span class="s1">inclusive_endpoints_fixture</span><span class="s2">,</span>
        <span class="s1">)</span>

        <span class="s1">tm.assert_index_equal(expected_range</span><span class="s2">, </span><span class="s1">result_range)</span>

    <span class="s2">def </span><span class="s1">test_range_closed_boundary(self</span><span class="s2">, </span><span class="s1">inclusive_endpoints_fixture):</span>
        <span class="s5"># GH#11804</span>
        <span class="s1">right_boundary = date_range(</span>
            <span class="s4">&quot;2015-09-12&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2015-12-01&quot;</span><span class="s2">,</span>
            <span class="s1">freq=</span><span class="s4">&quot;QS-MAR&quot;</span><span class="s2">,</span>
            <span class="s1">inclusive=inclusive_endpoints_fixture</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">left_boundary = date_range(</span>
            <span class="s4">&quot;2015-09-01&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2015-09-12&quot;</span><span class="s2">,</span>
            <span class="s1">freq=</span><span class="s4">&quot;QS-MAR&quot;</span><span class="s2">,</span>
            <span class="s1">inclusive=inclusive_endpoints_fixture</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">both_boundary = date_range(</span>
            <span class="s4">&quot;2015-09-01&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2015-12-01&quot;</span><span class="s2">,</span>
            <span class="s1">freq=</span><span class="s4">&quot;QS-MAR&quot;</span><span class="s2">,</span>
            <span class="s1">inclusive=inclusive_endpoints_fixture</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">neither_boundary = date_range(</span>
            <span class="s4">&quot;2015-09-11&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2015-09-12&quot;</span><span class="s2">,</span>
            <span class="s1">freq=</span><span class="s4">&quot;QS-MAR&quot;</span><span class="s2">,</span>
            <span class="s1">inclusive=inclusive_endpoints_fixture</span><span class="s2">,</span>
        <span class="s1">)</span>

        <span class="s1">expected_right = both_boundary</span>
        <span class="s1">expected_left = both_boundary</span>
        <span class="s1">expected_both = both_boundary</span>

        <span class="s2">if </span><span class="s1">inclusive_endpoints_fixture == </span><span class="s4">&quot;right&quot;</span><span class="s1">:</span>
            <span class="s1">expected_left = both_boundary[</span><span class="s3">1</span><span class="s1">:]</span>
        <span class="s2">elif </span><span class="s1">inclusive_endpoints_fixture == </span><span class="s4">&quot;left&quot;</span><span class="s1">:</span>
            <span class="s1">expected_right = both_boundary[:-</span><span class="s3">1</span><span class="s1">]</span>
        <span class="s2">elif </span><span class="s1">inclusive_endpoints_fixture == </span><span class="s4">&quot;both&quot;</span><span class="s1">:</span>
            <span class="s1">expected_right = both_boundary[</span><span class="s3">1</span><span class="s1">:]</span>
            <span class="s1">expected_left = both_boundary[:-</span><span class="s3">1</span><span class="s1">]</span>

        <span class="s1">expected_neither = both_boundary[</span><span class="s3">1</span><span class="s1">:-</span><span class="s3">1</span><span class="s1">]</span>

        <span class="s1">tm.assert_index_equal(right_boundary</span><span class="s2">, </span><span class="s1">expected_right)</span>
        <span class="s1">tm.assert_index_equal(left_boundary</span><span class="s2">, </span><span class="s1">expected_left)</span>
        <span class="s1">tm.assert_index_equal(both_boundary</span><span class="s2">, </span><span class="s1">expected_both)</span>
        <span class="s1">tm.assert_index_equal(neither_boundary</span><span class="s2">, </span><span class="s1">expected_neither)</span>

    <span class="s2">def </span><span class="s1">test_years_only(self):</span>
        <span class="s5"># GH 6961</span>
        <span class="s1">dr = date_range(</span><span class="s4">&quot;2014&quot;</span><span class="s2">, </span><span class="s4">&quot;2015&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;M&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">dr[</span><span class="s3">0</span><span class="s1">] == datetime(</span><span class="s3">2014</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">31</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">dr[-</span><span class="s3">1</span><span class="s1">] == datetime(</span><span class="s3">2014</span><span class="s2">, </span><span class="s3">12</span><span class="s2">, </span><span class="s3">31</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_freq_divides_end_in_nanos(self):</span>
        <span class="s5"># GH 10885</span>
        <span class="s1">result_1 = date_range(</span><span class="s4">&quot;2005-01-12 10:00&quot;</span><span class="s2">, </span><span class="s4">&quot;2005-01-12 16:00&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;345min&quot;</span><span class="s1">)</span>
        <span class="s1">result_2 = date_range(</span><span class="s4">&quot;2005-01-13 10:00&quot;</span><span class="s2">, </span><span class="s4">&quot;2005-01-13 16:00&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;345min&quot;</span><span class="s1">)</span>
        <span class="s1">expected_1 = DatetimeIndex(</span>
            <span class="s1">[</span><span class="s4">&quot;2005-01-12 10:00:00&quot;</span><span class="s2">, </span><span class="s4">&quot;2005-01-12 15:45:00&quot;</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">dtype=</span><span class="s4">&quot;datetime64[ns]&quot;</span><span class="s2">,</span>
            <span class="s1">freq=</span><span class="s4">&quot;345T&quot;</span><span class="s2">,</span>
            <span class="s1">tz=</span><span class="s2">None,</span>
        <span class="s1">)</span>
        <span class="s1">expected_2 = DatetimeIndex(</span>
            <span class="s1">[</span><span class="s4">&quot;2005-01-13 10:00:00&quot;</span><span class="s2">, </span><span class="s4">&quot;2005-01-13 15:45:00&quot;</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">dtype=</span><span class="s4">&quot;datetime64[ns]&quot;</span><span class="s2">,</span>
            <span class="s1">freq=</span><span class="s4">&quot;345T&quot;</span><span class="s2">,</span>
            <span class="s1">tz=</span><span class="s2">None,</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result_1</span><span class="s2">, </span><span class="s1">expected_1)</span>
        <span class="s1">tm.assert_index_equal(result_2</span><span class="s2">, </span><span class="s1">expected_2)</span>

    <span class="s2">def </span><span class="s1">test_cached_range_bug(self):</span>
        <span class="s1">rng = date_range(</span><span class="s4">&quot;2010-09-01 05:00:00&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">50</span><span class="s2">, </span><span class="s1">freq=DateOffset(hours=</span><span class="s3">6</span><span class="s1">))</span>
        <span class="s2">assert </span><span class="s1">len(rng) == </span><span class="s3">50</span>
        <span class="s2">assert </span><span class="s1">rng[</span><span class="s3">0</span><span class="s1">] == datetime(</span><span class="s3">2010</span><span class="s2">, </span><span class="s3">9</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">5</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_timezone_comparison_bug(self):</span>
        <span class="s5"># smoke test</span>
        <span class="s1">start = Timestamp(</span><span class="s4">&quot;20130220 10:00&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s1">result = date_range(start</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">len(result) == </span><span class="s3">2</span>

    <span class="s2">def </span><span class="s1">test_timezone_comparison_assert(self):</span>
        <span class="s1">start = Timestamp(</span><span class="s4">&quot;20130220 10:00&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s1">msg = </span><span class="s4">&quot;Inferred time zone not equal to passed time zone&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(AssertionError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(start</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;Europe/Berlin&quot;</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_negative_non_tick_frequency_descending_dates(self</span><span class="s2">, </span><span class="s1">tz_aware_fixture):</span>
        <span class="s5"># GH 23270</span>
        <span class="s1">tz = tz_aware_fixture</span>
        <span class="s1">result = date_range(start=</span><span class="s4">&quot;2011-06-01&quot;</span><span class="s2">, </span><span class="s1">end=</span><span class="s4">&quot;2011-01-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;-1MS&quot;</span><span class="s2">, </span><span class="s1">tz=tz)</span>
        <span class="s1">expected = date_range(end=</span><span class="s4">&quot;2011-06-01&quot;</span><span class="s2">, </span><span class="s1">start=</span><span class="s4">&quot;2011-01-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;1MS&quot;</span><span class="s2">, </span><span class="s1">tz=tz)[</span>
            <span class="s1">::-</span><span class="s3">1</span>
        <span class="s1">]</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_range_where_start_equal_end(self</span><span class="s2">, </span><span class="s1">inclusive_endpoints_fixture):</span>
        <span class="s5"># GH 43394</span>
        <span class="s1">start = </span><span class="s4">&quot;2021-09-02&quot;</span>
        <span class="s1">end = </span><span class="s4">&quot;2021-09-02&quot;</span>
        <span class="s1">result = date_range(</span>
            <span class="s1">start=start</span><span class="s2">, </span><span class="s1">end=end</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;D&quot;</span><span class="s2">, </span><span class="s1">inclusive=inclusive_endpoints_fixture</span>
        <span class="s1">)</span>

        <span class="s1">both_range = date_range(start=start</span><span class="s2">, </span><span class="s1">end=end</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;D&quot;</span><span class="s2">, </span><span class="s1">inclusive=</span><span class="s4">&quot;both&quot;</span><span class="s1">)</span>
        <span class="s2">if </span><span class="s1">inclusive_endpoints_fixture == </span><span class="s4">&quot;neither&quot;</span><span class="s1">:</span>
            <span class="s1">expected = both_range[</span><span class="s3">1</span><span class="s1">:-</span><span class="s3">1</span><span class="s1">]</span>
        <span class="s2">elif </span><span class="s1">inclusive_endpoints_fixture </span><span class="s2">in </span><span class="s1">(</span><span class="s4">&quot;left&quot;</span><span class="s2">, </span><span class="s4">&quot;right&quot;</span><span class="s2">, </span><span class="s4">&quot;both&quot;</span><span class="s1">):</span>
            <span class="s1">expected = both_range[:]</span>

        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s2">class </span><span class="s1">TestDateRangeTZ:</span>
    <span class="s0">&quot;&quot;&quot;Tests for date_range with timezones&quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">test_hongkong_tz_convert(self):</span>
        <span class="s5"># GH#1673 smoke test</span>
        <span class="s1">dr = date_range(</span><span class="s4">&quot;2012-01-01&quot;</span><span class="s2">, </span><span class="s4">&quot;2012-01-10&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;D&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;Hongkong&quot;</span><span class="s1">)</span>

        <span class="s5"># it works!</span>
        <span class="s1">dr.hour</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;tzstr&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s2">, </span><span class="s4">&quot;dateutil/US/Eastern&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_date_range_span_dst_transition(self</span><span class="s2">, </span><span class="s1">tzstr):</span>
        <span class="s5"># GH#1778</span>

        <span class="s5"># Standard -&gt; Daylight Savings Time</span>
        <span class="s1">dr = date_range(</span><span class="s4">&quot;03/06/2012 00:00&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">200</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;W-FRI&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s1">)</span>

        <span class="s2">assert </span><span class="s1">(dr.hour == </span><span class="s3">0</span><span class="s1">).all()</span>

        <span class="s1">dr = date_range(</span><span class="s4">&quot;2012-11-02&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">10</span><span class="s2">, </span><span class="s1">tz=tzstr)</span>
        <span class="s1">result = dr.hour</span>
        <span class="s1">expected = pd.Index([</span><span class="s3">0</span><span class="s1">] * </span><span class="s3">10</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;tzstr&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s2">, </span><span class="s4">&quot;dateutil/US/Eastern&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_date_range_timezone_str_argument(self</span><span class="s2">, </span><span class="s1">tzstr):</span>
        <span class="s1">tz = timezones.maybe_get_tz(tzstr)</span>
        <span class="s1">result = date_range(</span><span class="s4">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">10</span><span class="s2">, </span><span class="s1">tz=tzstr)</span>
        <span class="s1">expected = date_range(</span><span class="s4">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">10</span><span class="s2">, </span><span class="s1">tz=tz)</span>

        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_date_range_with_fixedoffset_noname(self):</span>
        <span class="s2">from </span><span class="s1">pandas.tests.indexes.datetimes.test_timezones </span><span class="s2">import </span><span class="s1">fixed_off_no_name</span>

        <span class="s1">off = fixed_off_no_name</span>
        <span class="s1">start = datetime(</span><span class="s3">2012</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">11</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">tzinfo=off)</span>
        <span class="s1">end = datetime(</span><span class="s3">2012</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s3">11</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">tzinfo=off)</span>
        <span class="s1">rng = date_range(start=start</span><span class="s2">, </span><span class="s1">end=end)</span>
        <span class="s2">assert </span><span class="s1">off == rng.tz</span>

        <span class="s1">idx = pd.Index([start</span><span class="s2">, </span><span class="s1">end])</span>
        <span class="s2">assert </span><span class="s1">off == idx.tz</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;tzstr&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s2">, </span><span class="s4">&quot;dateutil/US/Eastern&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_date_range_with_tz(self</span><span class="s2">, </span><span class="s1">tzstr):</span>
        <span class="s1">stamp = Timestamp(</span><span class="s4">&quot;3/11/2012 05:00&quot;</span><span class="s2">, </span><span class="s1">tz=tzstr)</span>
        <span class="s2">assert </span><span class="s1">stamp.hour == </span><span class="s3">5</span>

        <span class="s1">rng = date_range(</span><span class="s4">&quot;3/11/2012 04:00&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">10</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;H&quot;</span><span class="s2">, </span><span class="s1">tz=tzstr)</span>

        <span class="s2">assert </span><span class="s1">stamp == rng[</span><span class="s3">1</span><span class="s1">]</span>


<span class="s2">class </span><span class="s1">TestGenRangeGeneration:</span>
    <span class="s2">def </span><span class="s1">test_generate(self):</span>
        <span class="s1">rng1 = list(generate_range(START</span><span class="s2">, </span><span class="s1">END</span><span class="s2">, </span><span class="s1">offset=BDay()))</span>
        <span class="s1">rng2 = list(generate_range(START</span><span class="s2">, </span><span class="s1">END</span><span class="s2">, </span><span class="s1">offset=</span><span class="s4">&quot;B&quot;</span><span class="s1">))</span>
        <span class="s2">assert </span><span class="s1">rng1 == rng2</span>

    <span class="s2">def </span><span class="s1">test_generate_cday(self):</span>
        <span class="s1">rng1 = list(generate_range(START</span><span class="s2">, </span><span class="s1">END</span><span class="s2">, </span><span class="s1">offset=CDay()))</span>
        <span class="s1">rng2 = list(generate_range(START</span><span class="s2">, </span><span class="s1">END</span><span class="s2">, </span><span class="s1">offset=</span><span class="s4">&quot;C&quot;</span><span class="s1">))</span>
        <span class="s2">assert </span><span class="s1">rng1 == rng2</span>

    <span class="s2">def </span><span class="s1">test_1(self):</span>
        <span class="s1">rng = list(generate_range(start=datetime(</span><span class="s3">2009</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">25</span><span class="s1">)</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">2</span><span class="s1">))</span>
        <span class="s1">expected = [datetime(</span><span class="s3">2009</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">25</span><span class="s1">)</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2009</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">26</span><span class="s1">)]</span>
        <span class="s2">assert </span><span class="s1">rng == expected</span>

    <span class="s2">def </span><span class="s1">test_2(self):</span>
        <span class="s1">rng = list(generate_range(start=datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">end=datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">3</span><span class="s1">)))</span>
        <span class="s1">expected = [datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">3</span><span class="s1">)]</span>
        <span class="s2">assert </span><span class="s1">rng == expected</span>

    <span class="s2">def </span><span class="s1">test_3(self):</span>
        <span class="s1">rng = list(generate_range(start=datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">5</span><span class="s1">)</span><span class="s2">, </span><span class="s1">end=datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">6</span><span class="s1">)))</span>
        <span class="s1">expected = []</span>
        <span class="s2">assert </span><span class="s1">rng == expected</span>

    <span class="s2">def </span><span class="s1">test_precision_finer_than_offset(self):</span>
        <span class="s5"># GH#9907</span>
        <span class="s1">result1 = date_range(</span>
            <span class="s1">start=</span><span class="s4">&quot;2015-04-15 00:00:03&quot;</span><span class="s2">, </span><span class="s1">end=</span><span class="s4">&quot;2016-04-22 00:00:00&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;Q&quot;</span>
        <span class="s1">)</span>
        <span class="s1">result2 = date_range(</span>
            <span class="s1">start=</span><span class="s4">&quot;2015-04-15 00:00:03&quot;</span><span class="s2">, </span><span class="s1">end=</span><span class="s4">&quot;2015-06-22 00:00:04&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;W&quot;</span>
        <span class="s1">)</span>
        <span class="s1">expected1_list = [</span>
            <span class="s4">&quot;2015-06-30 00:00:03&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2015-09-30 00:00:03&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2015-12-31 00:00:03&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2016-03-31 00:00:03&quot;</span><span class="s2">,</span>
        <span class="s1">]</span>
        <span class="s1">expected2_list = [</span>
            <span class="s4">&quot;2015-04-19 00:00:03&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2015-04-26 00:00:03&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2015-05-03 00:00:03&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2015-05-10 00:00:03&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2015-05-17 00:00:03&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2015-05-24 00:00:03&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2015-05-31 00:00:03&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2015-06-07 00:00:03&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2015-06-14 00:00:03&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2015-06-21 00:00:03&quot;</span><span class="s2">,</span>
        <span class="s1">]</span>
        <span class="s1">expected1 = DatetimeIndex(</span>
            <span class="s1">expected1_list</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s4">&quot;datetime64[ns]&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;Q-DEC&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s2">None</span>
        <span class="s1">)</span>
        <span class="s1">expected2 = DatetimeIndex(</span>
            <span class="s1">expected2_list</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s4">&quot;datetime64[ns]&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;W-SUN&quot;</span><span class="s2">, </span><span class="s1">tz=</span><span class="s2">None</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result1</span><span class="s2">, </span><span class="s1">expected1)</span>
        <span class="s1">tm.assert_index_equal(result2</span><span class="s2">, </span><span class="s1">expected2)</span>

    <span class="s1">dt1</span><span class="s2">, </span><span class="s1">dt2 = </span><span class="s4">&quot;2017-01-01&quot;</span><span class="s2">, </span><span class="s4">&quot;2017-01-01&quot;</span>
    <span class="s1">tz1</span><span class="s2">, </span><span class="s1">tz2 = </span><span class="s4">&quot;US/Eastern&quot;</span><span class="s2">, </span><span class="s4">&quot;Europe/London&quot;</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s4">&quot;start,end&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">(Timestamp(dt1</span><span class="s2">, </span><span class="s1">tz=tz1)</span><span class="s2">, </span><span class="s1">Timestamp(dt2))</span><span class="s2">,</span>
            <span class="s1">(Timestamp(dt1)</span><span class="s2">, </span><span class="s1">Timestamp(dt2</span><span class="s2">, </span><span class="s1">tz=tz2))</span><span class="s2">,</span>
            <span class="s1">(Timestamp(dt1</span><span class="s2">, </span><span class="s1">tz=tz1)</span><span class="s2">, </span><span class="s1">Timestamp(dt2</span><span class="s2">, </span><span class="s1">tz=tz2))</span><span class="s2">,</span>
            <span class="s1">(Timestamp(dt1</span><span class="s2">, </span><span class="s1">tz=tz2)</span><span class="s2">, </span><span class="s1">Timestamp(dt2</span><span class="s2">, </span><span class="s1">tz=tz1))</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_mismatching_tz_raises_err(self</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">end):</span>
        <span class="s5"># issue 18488</span>
        <span class="s1">msg = </span><span class="s4">&quot;Start and end cannot both be tz-aware with different timezones&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(start</span><span class="s2">, </span><span class="s1">end)</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">freq=BDay())</span>


<span class="s2">class </span><span class="s1">TestBusinessDateRange:</span>
    <span class="s2">def </span><span class="s1">test_constructor(self):</span>
        <span class="s1">bdate_range(START</span><span class="s2">, </span><span class="s1">END</span><span class="s2">, </span><span class="s1">freq=BDay())</span>
        <span class="s1">bdate_range(START</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">20</span><span class="s2">, </span><span class="s1">freq=BDay())</span>
        <span class="s1">bdate_range(end=START</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">20</span><span class="s2">, </span><span class="s1">freq=BDay())</span>

        <span class="s1">msg = </span><span class="s4">&quot;periods must be a number, got B&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(</span><span class="s4">&quot;2011-1-1&quot;</span><span class="s2">, </span><span class="s4">&quot;2012-1-1&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">bdate_range(</span><span class="s4">&quot;2011-1-1&quot;</span><span class="s2">, </span><span class="s4">&quot;2012-1-1&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s1">)</span>

        <span class="s1">msg = </span><span class="s4">&quot;freq must be specified for bdate_range; use date_range instead&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">bdate_range(START</span><span class="s2">, </span><span class="s1">END</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">10</span><span class="s2">, </span><span class="s1">freq=</span><span class="s2">None</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_misc(self):</span>
        <span class="s1">end = datetime(</span><span class="s3">2009</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">13</span><span class="s1">)</span>
        <span class="s1">dr = bdate_range(end=end</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">20</span><span class="s1">)</span>
        <span class="s1">firstDate = end - </span><span class="s3">19 </span><span class="s1">* BDay()</span>

        <span class="s2">assert </span><span class="s1">len(dr) == </span><span class="s3">20</span>
        <span class="s2">assert </span><span class="s1">dr[</span><span class="s3">0</span><span class="s1">] == firstDate</span>
        <span class="s2">assert </span><span class="s1">dr[-</span><span class="s3">1</span><span class="s1">] == end</span>

    <span class="s2">def </span><span class="s1">test_date_parse_failure(self):</span>
        <span class="s1">badly_formed_date = </span><span class="s4">&quot;2007/100/1&quot;</span>

        <span class="s1">msg = </span><span class="s4">&quot;could not convert string to Timestamp&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">Timestamp(badly_formed_date)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">bdate_range(start=badly_formed_date</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">10</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">bdate_range(end=badly_formed_date</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">10</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">bdate_range(badly_formed_date</span><span class="s2">, </span><span class="s1">badly_formed_date)</span>

    <span class="s2">def </span><span class="s1">test_daterange_bug_456(self):</span>
        <span class="s5"># GH #456</span>
        <span class="s1">rng1 = bdate_range(</span><span class="s4">&quot;12/5/2011&quot;</span><span class="s2">, </span><span class="s4">&quot;12/5/2011&quot;</span><span class="s1">)</span>
        <span class="s1">rng2 = bdate_range(</span><span class="s4">&quot;12/2/2011&quot;</span><span class="s2">, </span><span class="s4">&quot;12/5/2011&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">rng2._data.freq == BDay()</span>

        <span class="s1">result = rng1.union(rng2)</span>
        <span class="s2">assert </span><span class="s1">isinstance(result</span><span class="s2">, </span><span class="s1">DatetimeIndex)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;inclusive&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">&quot;left&quot;</span><span class="s2">, </span><span class="s4">&quot;right&quot;</span><span class="s2">, </span><span class="s4">&quot;neither&quot;</span><span class="s2">, </span><span class="s4">&quot;both&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_bdays_and_open_boundaries(self</span><span class="s2">, </span><span class="s1">inclusive):</span>
        <span class="s5"># GH 6673</span>
        <span class="s1">start = </span><span class="s4">&quot;2018-07-21&quot;  </span><span class="s5"># Saturday</span>
        <span class="s1">end = </span><span class="s4">&quot;2018-07-29&quot;  </span><span class="s5"># Sunday</span>
        <span class="s1">result = date_range(start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s1">inclusive=inclusive)</span>

        <span class="s1">bday_start = </span><span class="s4">&quot;2018-07-23&quot;  </span><span class="s5"># Monday</span>
        <span class="s1">bday_end = </span><span class="s4">&quot;2018-07-27&quot;  </span><span class="s5"># Friday</span>
        <span class="s1">expected = date_range(bday_start</span><span class="s2">, </span><span class="s1">bday_end</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s5"># Note: we do _not_ expect the freqs to match here</span>

    <span class="s2">def </span><span class="s1">test_bday_near_overflow(self):</span>
        <span class="s5"># GH#24252 avoid doing unnecessary addition that _would_ overflow</span>
        <span class="s1">start = Timestamp.max.floor(</span><span class="s4">&quot;D&quot;</span><span class="s1">).to_pydatetime()</span>
        <span class="s1">rng = date_range(start</span><span class="s2">, </span><span class="s1">end=</span><span class="s2">None, </span><span class="s1">periods=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;B&quot;</span><span class="s1">)</span>
        <span class="s1">expected = DatetimeIndex([start]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;B&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(rng</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_bday_overflow_error(self):</span>
        <span class="s5"># GH#24252 check that we get OutOfBoundsDatetime and not OverflowError</span>
        <span class="s1">msg = </span><span class="s4">&quot;Out of bounds nanosecond timestamp&quot;</span>
        <span class="s1">start = Timestamp.max.floor(</span><span class="s4">&quot;D&quot;</span><span class="s1">).to_pydatetime()</span>
        <span class="s2">with </span><span class="s1">pytest.raises(OutOfBoundsDatetime</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(start</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;B&quot;</span><span class="s1">)</span>


<span class="s2">class </span><span class="s1">TestCustomDateRange:</span>
    <span class="s2">def </span><span class="s1">test_constructor(self):</span>
        <span class="s1">bdate_range(START</span><span class="s2">, </span><span class="s1">END</span><span class="s2">, </span><span class="s1">freq=CDay())</span>
        <span class="s1">bdate_range(START</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">20</span><span class="s2">, </span><span class="s1">freq=CDay())</span>
        <span class="s1">bdate_range(end=START</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">20</span><span class="s2">, </span><span class="s1">freq=CDay())</span>

        <span class="s1">msg = </span><span class="s4">&quot;periods must be a number, got C&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">date_range(</span><span class="s4">&quot;2011-1-1&quot;</span><span class="s2">, </span><span class="s4">&quot;2012-1-1&quot;</span><span class="s2">, </span><span class="s4">&quot;C&quot;</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">bdate_range(</span><span class="s4">&quot;2011-1-1&quot;</span><span class="s2">, </span><span class="s4">&quot;2012-1-1&quot;</span><span class="s2">, </span><span class="s4">&quot;C&quot;</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_misc(self):</span>
        <span class="s1">end = datetime(</span><span class="s3">2009</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">13</span><span class="s1">)</span>
        <span class="s1">dr = bdate_range(end=end</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">20</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;C&quot;</span><span class="s1">)</span>
        <span class="s1">firstDate = end - </span><span class="s3">19 </span><span class="s1">* CDay()</span>

        <span class="s2">assert </span><span class="s1">len(dr) == </span><span class="s3">20</span>
        <span class="s2">assert </span><span class="s1">dr[</span><span class="s3">0</span><span class="s1">] == firstDate</span>
        <span class="s2">assert </span><span class="s1">dr[-</span><span class="s3">1</span><span class="s1">] == end</span>

    <span class="s2">def </span><span class="s1">test_daterange_bug_456(self):</span>
        <span class="s5"># GH #456</span>
        <span class="s1">rng1 = bdate_range(</span><span class="s4">&quot;12/5/2011&quot;</span><span class="s2">, </span><span class="s4">&quot;12/5/2011&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;C&quot;</span><span class="s1">)</span>
        <span class="s1">rng2 = bdate_range(</span><span class="s4">&quot;12/2/2011&quot;</span><span class="s2">, </span><span class="s4">&quot;12/5/2011&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;C&quot;</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">rng2._data.freq == CDay()</span>

        <span class="s1">result = rng1.union(rng2)</span>
        <span class="s2">assert </span><span class="s1">isinstance(result</span><span class="s2">, </span><span class="s1">DatetimeIndex)</span>

    <span class="s2">def </span><span class="s1">test_cdaterange(self):</span>
        <span class="s1">result = bdate_range(</span><span class="s4">&quot;2013-05-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;C&quot;</span><span class="s1">)</span>
        <span class="s1">expected = DatetimeIndex([</span><span class="s4">&quot;2013-05-01&quot;</span><span class="s2">, </span><span class="s4">&quot;2013-05-02&quot;</span><span class="s2">, </span><span class="s4">&quot;2013-05-03&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;C&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s2">assert </span><span class="s1">result.freq == expected.freq</span>

    <span class="s2">def </span><span class="s1">test_cdaterange_weekmask(self):</span>
        <span class="s1">result = bdate_range(</span>
            <span class="s4">&quot;2013-05-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;C&quot;</span><span class="s2">, </span><span class="s1">weekmask=</span><span class="s4">&quot;Sun Mon Tue Wed Thu&quot;</span>
        <span class="s1">)</span>
        <span class="s1">expected = DatetimeIndex(</span>
            <span class="s1">[</span><span class="s4">&quot;2013-05-01&quot;</span><span class="s2">, </span><span class="s4">&quot;2013-05-02&quot;</span><span class="s2">, </span><span class="s4">&quot;2013-05-05&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=result.freq</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s2">assert </span><span class="s1">result.freq == expected.freq</span>

        <span class="s5"># raise with non-custom freq</span>
        <span class="s1">msg = (</span>
            <span class="s4">&quot;a custom frequency string is required when holidays or &quot;</span>
            <span class="s4">&quot;weekmask are passed, got frequency B&quot;</span>
        <span class="s1">)</span>
        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">bdate_range(</span><span class="s4">&quot;2013-05-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s2">, </span><span class="s1">weekmask=</span><span class="s4">&quot;Sun Mon Tue Wed Thu&quot;</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_cdaterange_holidays(self):</span>
        <span class="s1">result = bdate_range(</span><span class="s4">&quot;2013-05-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s2">, </span><span class="s1">freq=</span><span class="s4">&quot;C&quot;</span><span class="s2">, </span><span class="s1">holidays=[</span><span class="s4">&quot;2013-05-01&quot;</span><span class="s1">])</span>
        <span class="s1">expected = DatetimeIndex(</span>
            <span class="s1">[</span><span class="s4">&quot;2013-05-02&quot;</span><span class="s2">, </span><span class="s4">&quot;2013-05-03&quot;</span><span class="s2">, </span><span class="s4">&quot;2013-05-06&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=result.freq</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s2">assert </span><span class="s1">result.freq == expected.freq</span>

        <span class="s5"># raise with non-custom freq</span>
        <span class="s1">msg = (</span>
            <span class="s4">&quot;a custom frequency string is required when holidays or &quot;</span>
            <span class="s4">&quot;weekmask are passed, got frequency B&quot;</span>
        <span class="s1">)</span>
        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">bdate_range(</span><span class="s4">&quot;2013-05-01&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s2">, </span><span class="s1">holidays=[</span><span class="s4">&quot;2013-05-01&quot;</span><span class="s1">])</span>

    <span class="s2">def </span><span class="s1">test_cdaterange_weekmask_and_holidays(self):</span>
        <span class="s1">result = bdate_range(</span>
            <span class="s4">&quot;2013-05-01&quot;</span><span class="s2">,</span>
            <span class="s1">periods=</span><span class="s3">3</span><span class="s2">,</span>
            <span class="s1">freq=</span><span class="s4">&quot;C&quot;</span><span class="s2">,</span>
            <span class="s1">weekmask=</span><span class="s4">&quot;Sun Mon Tue Wed Thu&quot;</span><span class="s2">,</span>
            <span class="s1">holidays=[</span><span class="s4">&quot;2013-05-01&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">expected = DatetimeIndex(</span>
            <span class="s1">[</span><span class="s4">&quot;2013-05-02&quot;</span><span class="s2">, </span><span class="s4">&quot;2013-05-05&quot;</span><span class="s2">, </span><span class="s4">&quot;2013-05-06&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">freq=result.freq</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s2">assert </span><span class="s1">result.freq == expected.freq</span>

        <span class="s5"># raise with non-custom freq</span>
        <span class="s1">msg = (</span>
            <span class="s4">&quot;a custom frequency string is required when holidays or &quot;</span>
            <span class="s4">&quot;weekmask are passed, got frequency B&quot;</span>
        <span class="s1">)</span>
        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">bdate_range(</span>
                <span class="s4">&quot;2013-05-01&quot;</span><span class="s2">,</span>
                <span class="s1">periods=</span><span class="s3">3</span><span class="s2">,</span>
                <span class="s1">weekmask=</span><span class="s4">&quot;Sun Mon Tue Wed Thu&quot;</span><span class="s2">,</span>
                <span class="s1">holidays=[</span><span class="s4">&quot;2013-05-01&quot;</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s4">&quot;freq&quot;</span><span class="s2">, </span><span class="s1">[freq </span><span class="s2">for </span><span class="s1">freq </span><span class="s2">in </span><span class="s1">prefix_mapping </span><span class="s2">if </span><span class="s1">freq.startswith(</span><span class="s4">&quot;C&quot;</span><span class="s1">)]</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_all_custom_freq(self</span><span class="s2">, </span><span class="s1">freq):</span>
        <span class="s5"># should not raise</span>
        <span class="s1">bdate_range(</span>
            <span class="s1">START</span><span class="s2">, </span><span class="s1">END</span><span class="s2">, </span><span class="s1">freq=freq</span><span class="s2">, </span><span class="s1">weekmask=</span><span class="s4">&quot;Mon Wed Fri&quot;</span><span class="s2">, </span><span class="s1">holidays=[</span><span class="s4">&quot;2009-03-14&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>

        <span class="s1">bad_freq = freq + </span><span class="s4">&quot;FOO&quot;</span>
        <span class="s1">msg = </span><span class="s4">f&quot;invalid custom frequency string: </span><span class="s2">{</span><span class="s1">bad_freq</span><span class="s2">}</span><span class="s4">&quot;</span>
        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">bdate_range(START</span><span class="s2">, </span><span class="s1">END</span><span class="s2">, </span><span class="s1">freq=bad_freq)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s4">&quot;start_end&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">(</span><span class="s4">&quot;2018-01-01T00:00:01.000Z&quot;</span><span class="s2">, </span><span class="s4">&quot;2018-01-03T00:00:01.000Z&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s4">&quot;2018-01-01T00:00:00.010Z&quot;</span><span class="s2">, </span><span class="s4">&quot;2018-01-03T00:00:00.010Z&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s4">&quot;2001-01-01T00:00:00.010Z&quot;</span><span class="s2">, </span><span class="s4">&quot;2001-01-03T00:00:00.010Z&quot;</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_range_with_millisecond_resolution(self</span><span class="s2">, </span><span class="s1">start_end):</span>
        <span class="s5"># https://github.com/pandas-dev/pandas/issues/24110</span>
        <span class="s1">start</span><span class="s2">, </span><span class="s1">end = start_end</span>
        <span class="s1">result = date_range(start=start</span><span class="s2">, </span><span class="s1">end=end</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">inclusive=</span><span class="s4">&quot;left&quot;</span><span class="s1">)</span>
        <span class="s1">expected = DatetimeIndex([start])</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s2">def </span><span class="s1">test_date_range_with_custom_holidays():</span>
    <span class="s5"># GH 30593</span>
    <span class="s1">freq = offsets.CustomBusinessHour(start=</span><span class="s4">&quot;15:00&quot;</span><span class="s2">, </span><span class="s1">holidays=[</span><span class="s4">&quot;2020-11-26&quot;</span><span class="s1">])</span>
    <span class="s1">result = date_range(start=</span><span class="s4">&quot;2020-11-25 15:00&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s3">4</span><span class="s2">, </span><span class="s1">freq=freq)</span>
    <span class="s1">expected = DatetimeIndex(</span>
        <span class="s1">[</span>
            <span class="s4">&quot;2020-11-25 15:00:00&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2020-11-25 16:00:00&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2020-11-27 15:00:00&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;2020-11-27 16:00:00&quot;</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
        <span class="s1">freq=freq</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_index_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
</pre>
</body>
</html>