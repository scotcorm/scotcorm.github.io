<html>
<head>
<title>test_extras.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #629755; font-style: italic;}
.s3 { color: #cc7832;}
.s4 { color: #6897bb;}
.s5 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_extras.py</font>
</center></td></tr></table>
<pre><span class="s0"># pylint: disable-msg=W0611, W0612, W0511</span>
<span class="s2">&quot;&quot;&quot;Tests suite for MaskedArray. 
Adapted from the original test_ma by Pierre Gerard-Marchant 
 
:author: Pierre Gerard-Marchant 
:contact: pierregm_at_uga_dot_edu 
:version: $Id: test_extras.py 3473 2007-10-29 15:18:13Z jarrod.millman $ 
 
&quot;&quot;&quot;</span>
<span class="s3">import </span><span class="s1">warnings</span>
<span class="s3">import </span><span class="s1">itertools</span>
<span class="s3">import </span><span class="s1">pytest</span>

<span class="s3">import </span><span class="s1">numpy </span><span class="s3">as </span><span class="s1">np</span>
<span class="s3">from </span><span class="s1">numpy.testing </span><span class="s3">import </span><span class="s1">(</span>
    <span class="s1">assert_warns</span><span class="s3">, </span><span class="s1">suppress_warnings</span>
    <span class="s1">)</span>
<span class="s3">from </span><span class="s1">numpy.ma.testutils </span><span class="s3">import </span><span class="s1">(</span>
    <span class="s1">assert_</span><span class="s3">, </span><span class="s1">assert_array_equal</span><span class="s3">, </span><span class="s1">assert_equal</span><span class="s3">, </span><span class="s1">assert_almost_equal</span>
    <span class="s1">)</span>
<span class="s3">from </span><span class="s1">numpy.ma.core </span><span class="s3">import </span><span class="s1">(</span>
    <span class="s1">array</span><span class="s3">, </span><span class="s1">arange</span><span class="s3">, </span><span class="s1">masked</span><span class="s3">, </span><span class="s1">MaskedArray</span><span class="s3">, </span><span class="s1">masked_array</span><span class="s3">, </span><span class="s1">getmaskarray</span><span class="s3">, </span><span class="s1">shape</span><span class="s3">,</span>
    <span class="s1">nomask</span><span class="s3">, </span><span class="s1">ones</span><span class="s3">, </span><span class="s1">zeros</span><span class="s3">, </span><span class="s1">count</span>
    <span class="s1">)</span>
<span class="s3">from </span><span class="s1">numpy.ma.extras </span><span class="s3">import </span><span class="s1">(</span>
    <span class="s1">atleast_1d</span><span class="s3">, </span><span class="s1">atleast_2d</span><span class="s3">, </span><span class="s1">atleast_3d</span><span class="s3">, </span><span class="s1">mr_</span><span class="s3">, </span><span class="s1">dot</span><span class="s3">, </span><span class="s1">polyfit</span><span class="s3">, </span><span class="s1">cov</span><span class="s3">, </span><span class="s1">corrcoef</span><span class="s3">,</span>
    <span class="s1">median</span><span class="s3">, </span><span class="s1">average</span><span class="s3">, </span><span class="s1">unique</span><span class="s3">, </span><span class="s1">setxor1d</span><span class="s3">, </span><span class="s1">setdiff1d</span><span class="s3">, </span><span class="s1">union1d</span><span class="s3">, </span><span class="s1">intersect1d</span><span class="s3">, </span><span class="s1">in1d</span><span class="s3">,</span>
    <span class="s1">ediff1d</span><span class="s3">, </span><span class="s1">apply_over_axes</span><span class="s3">, </span><span class="s1">apply_along_axis</span><span class="s3">, </span><span class="s1">compress_nd</span><span class="s3">, </span><span class="s1">compress_rowcols</span><span class="s3">,</span>
    <span class="s1">mask_rowcols</span><span class="s3">, </span><span class="s1">clump_masked</span><span class="s3">, </span><span class="s1">clump_unmasked</span><span class="s3">, </span><span class="s1">flatnotmasked_contiguous</span><span class="s3">,</span>
    <span class="s1">notmasked_contiguous</span><span class="s3">, </span><span class="s1">notmasked_edges</span><span class="s3">, </span><span class="s1">masked_all</span><span class="s3">, </span><span class="s1">masked_all_like</span><span class="s3">, </span><span class="s1">isin</span><span class="s3">,</span>
    <span class="s1">diagflat</span><span class="s3">, </span><span class="s1">stack</span><span class="s3">, </span><span class="s1">vstack</span>
    <span class="s1">)</span>


<span class="s3">class </span><span class="s1">TestGeneric:</span>
    <span class="s0">#</span>
    <span class="s3">def </span><span class="s1">test_masked_all(self):</span>
        <span class="s0"># Tests masked_all</span>
        <span class="s0"># Standard dtype</span>
        <span class="s1">test = masked_all((</span><span class="s4">2</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">dtype=float)</span>
        <span class="s1">control = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">dtype=float)</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">control)</span>
        <span class="s0"># Flexible dtype</span>
        <span class="s1">dt = np.dtype({</span><span class="s5">'names'</span><span class="s1">: [</span><span class="s5">'a'</span><span class="s3">, </span><span class="s5">'b'</span><span class="s1">]</span><span class="s3">, </span><span class="s5">'formats'</span><span class="s1">: [</span><span class="s5">'f'</span><span class="s3">, </span><span class="s5">'f'</span><span class="s1">]})</span>
        <span class="s1">test = masked_all((</span><span class="s4">2</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">dtype=dt)</span>
        <span class="s1">control = array([(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)]</span><span class="s3">, </span><span class="s1">mask=[(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)]</span><span class="s3">, </span><span class="s1">dtype=dt)</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">control)</span>
        <span class="s1">test = masked_all((</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s1">)</span><span class="s3">, </span><span class="s1">dtype=dt)</span>
        <span class="s1">control = array([[(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)]</span><span class="s3">, </span><span class="s1">[(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)]]</span><span class="s3">,</span>
                        <span class="s1">mask=[[(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)]</span><span class="s3">, </span><span class="s1">[(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)]]</span><span class="s3">,</span>
                        <span class="s1">dtype=dt)</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">control)</span>
        <span class="s0"># Nested dtype</span>
        <span class="s1">dt = np.dtype([(</span><span class="s5">'a'</span><span class="s3">, </span><span class="s5">'f'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s5">'b'</span><span class="s3">, </span><span class="s1">[(</span><span class="s5">'ba'</span><span class="s3">, </span><span class="s5">'f'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s5">'bb'</span><span class="s3">, </span><span class="s5">'f'</span><span class="s1">)])])</span>
        <span class="s1">test = masked_all((</span><span class="s4">2</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">dtype=dt)</span>
        <span class="s1">control = array([(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))]</span><span class="s3">,</span>
                        <span class="s1">mask=[(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))]</span><span class="s3">, </span><span class="s1">dtype=dt)</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">control)</span>
        <span class="s1">test = masked_all((</span><span class="s4">2</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">dtype=dt)</span>
        <span class="s1">control = array([(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))]</span><span class="s3">,</span>
                        <span class="s1">mask=[(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))]</span><span class="s3">, </span><span class="s1">dtype=dt)</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">control)</span>
        <span class="s1">test = masked_all((</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">dtype=dt)</span>
        <span class="s1">control = array([[(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))]]</span><span class="s3">, </span><span class="s1">mask=[[(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))]]</span><span class="s3">, </span><span class="s1">dtype=dt)</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">control)</span>

    <span class="s3">def </span><span class="s1">test_masked_all_with_object_nested(self):</span>
        <span class="s0"># Test masked_all works with nested array with dtype of an 'object'</span>
        <span class="s0"># refers to issue #15895</span>
        <span class="s1">my_dtype = np.dtype([(</span><span class="s5">'b'</span><span class="s3">, </span><span class="s1">([(</span><span class="s5">'c'</span><span class="s3">, </span><span class="s1">object)]</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">,</span><span class="s1">)))])</span>
        <span class="s1">masked_arr = np.ma.masked_all((</span><span class="s4">1</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">my_dtype)</span>

        <span class="s1">assert_equal(type(masked_arr[</span><span class="s5">'b'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">np.ma.core.MaskedArray)</span>
        <span class="s1">assert_equal(type(masked_arr[</span><span class="s5">'b'</span><span class="s1">][</span><span class="s5">'c'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">np.ma.core.MaskedArray)</span>
        <span class="s1">assert_equal(len(masked_arr[</span><span class="s5">'b'</span><span class="s1">][</span><span class="s5">'c'</span><span class="s1">])</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(masked_arr[</span><span class="s5">'b'</span><span class="s1">][</span><span class="s5">'c'</span><span class="s1">].shape</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))</span>
        <span class="s1">assert_equal(masked_arr[</span><span class="s5">'b'</span><span class="s1">][</span><span class="s5">'c'</span><span class="s1">]._fill_value.shape</span><span class="s3">, </span><span class="s1">())</span>
    
    <span class="s3">def </span><span class="s1">test_masked_all_with_object(self):</span>
        <span class="s0"># same as above except that the array is not nested</span>
        <span class="s1">my_dtype = np.dtype([(</span><span class="s5">'b'</span><span class="s3">, </span><span class="s1">(object</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">,</span><span class="s1">)))])</span>
        <span class="s1">masked_arr = np.ma.masked_all((</span><span class="s4">1</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">my_dtype)</span>

        <span class="s1">assert_equal(type(masked_arr[</span><span class="s5">'b'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">np.ma.core.MaskedArray)</span>
        <span class="s1">assert_equal(len(masked_arr[</span><span class="s5">'b'</span><span class="s1">])</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(masked_arr[</span><span class="s5">'b'</span><span class="s1">].shape</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))</span>
        <span class="s1">assert_equal(masked_arr[</span><span class="s5">'b'</span><span class="s1">]._fill_value.shape</span><span class="s3">, </span><span class="s1">())</span>

    <span class="s3">def </span><span class="s1">test_masked_all_like(self):</span>
        <span class="s0"># Tests masked_all</span>
        <span class="s0"># Standard dtype</span>
        <span class="s1">base = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">dtype=float)</span>
        <span class="s1">test = masked_all_like(base)</span>
        <span class="s1">control = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">dtype=float)</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">control)</span>
        <span class="s0"># Flexible dtype</span>
        <span class="s1">dt = np.dtype({</span><span class="s5">'names'</span><span class="s1">: [</span><span class="s5">'a'</span><span class="s3">, </span><span class="s5">'b'</span><span class="s1">]</span><span class="s3">, </span><span class="s5">'formats'</span><span class="s1">: [</span><span class="s5">'f'</span><span class="s3">, </span><span class="s5">'f'</span><span class="s1">]})</span>
        <span class="s1">base = array([(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)]</span><span class="s3">, </span><span class="s1">mask=[(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)]</span><span class="s3">, </span><span class="s1">dtype=dt)</span>
        <span class="s1">test = masked_all_like(base)</span>
        <span class="s1">control = array([(</span><span class="s4">10</span><span class="s3">, </span><span class="s4">10</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">10</span><span class="s3">, </span><span class="s4">10</span><span class="s1">)]</span><span class="s3">, </span><span class="s1">mask=[(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)]</span><span class="s3">, </span><span class="s1">dtype=dt)</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">control)</span>
        <span class="s0"># Nested dtype</span>
        <span class="s1">dt = np.dtype([(</span><span class="s5">'a'</span><span class="s3">, </span><span class="s5">'f'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s5">'b'</span><span class="s3">, </span><span class="s1">[(</span><span class="s5">'ba'</span><span class="s3">, </span><span class="s5">'f'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s5">'bb'</span><span class="s3">, </span><span class="s5">'f'</span><span class="s1">)])])</span>
        <span class="s1">control = array([(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))]</span><span class="s3">,</span>
                        <span class="s1">mask=[(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))]</span><span class="s3">, </span><span class="s1">dtype=dt)</span>
        <span class="s1">test = masked_all_like(control)</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">control)</span>

    <span class="s3">def </span><span class="s1">check_clump(self</span><span class="s3">, </span><span class="s1">f):</span>
        <span class="s3">for </span><span class="s1">i </span><span class="s3">in </span><span class="s1">range(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">7</span><span class="s1">):</span>
            <span class="s3">for </span><span class="s1">j </span><span class="s3">in </span><span class="s1">range(</span><span class="s4">2</span><span class="s1">**i):</span>
                <span class="s1">k = np.arange(i</span><span class="s3">, </span><span class="s1">dtype=int)</span>
                <span class="s1">ja = np.full(i</span><span class="s3">, </span><span class="s1">j</span><span class="s3">, </span><span class="s1">dtype=int)</span>
                <span class="s1">a = masked_array(</span><span class="s4">2</span><span class="s1">**k)</span>
                <span class="s1">a.mask = (ja &amp; (</span><span class="s4">2</span><span class="s1">**k)) != </span><span class="s4">0</span>
                <span class="s1">s = </span><span class="s4">0</span>
                <span class="s3">for </span><span class="s1">sl </span><span class="s3">in </span><span class="s1">f(a):</span>
                    <span class="s1">s += a.data[sl].sum()</span>
                <span class="s3">if </span><span class="s1">f == clump_unmasked:</span>
                    <span class="s1">assert_equal(a.compressed().sum()</span><span class="s3">, </span><span class="s1">s)</span>
                <span class="s3">else</span><span class="s1">:</span>
                    <span class="s1">a.mask = ~a.mask</span>
                    <span class="s1">assert_equal(a.compressed().sum()</span><span class="s3">, </span><span class="s1">s)</span>

    <span class="s3">def </span><span class="s1">test_clump_masked(self):</span>
        <span class="s0"># Test clump_masked</span>
        <span class="s1">a = masked_array(np.arange(</span><span class="s4">10</span><span class="s1">))</span>
        <span class="s1">a[[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">8</span><span class="s3">, </span><span class="s4">9</span><span class="s1">]] = masked</span>
        <span class="s0">#</span>
        <span class="s1">test = clump_masked(a)</span>
        <span class="s1">control = [slice(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">3</span><span class="s1">)</span><span class="s3">, </span><span class="s1">slice(</span><span class="s4">6</span><span class="s3">, </span><span class="s4">7</span><span class="s1">)</span><span class="s3">, </span><span class="s1">slice(</span><span class="s4">8</span><span class="s3">, </span><span class="s4">10</span><span class="s1">)]</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">control)</span>

        <span class="s1">self.check_clump(clump_masked)</span>

    <span class="s3">def </span><span class="s1">test_clump_unmasked(self):</span>
        <span class="s0"># Test clump_unmasked</span>
        <span class="s1">a = masked_array(np.arange(</span><span class="s4">10</span><span class="s1">))</span>
        <span class="s1">a[[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">8</span><span class="s3">, </span><span class="s4">9</span><span class="s1">]] = masked</span>
        <span class="s1">test = clump_unmasked(a)</span>
        <span class="s1">control = [slice(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">6</span><span class="s1">)</span><span class="s3">, </span><span class="s1">slice(</span><span class="s4">7</span><span class="s3">, </span><span class="s4">8</span><span class="s1">)</span><span class="s3">, </span><span class="s1">]</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">control)</span>

        <span class="s1">self.check_clump(clump_unmasked)</span>

    <span class="s3">def </span><span class="s1">test_flatnotmasked_contiguous(self):</span>
        <span class="s0"># Test flatnotmasked_contiguous</span>
        <span class="s1">a = arange(</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s0"># No mask</span>
        <span class="s1">test = flatnotmasked_contiguous(a)</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">[slice(</span><span class="s4">0</span><span class="s3">, </span><span class="s1">a.size)])</span>
        <span class="s0"># mask of all false</span>
        <span class="s1">a.mask = np.zeros(</span><span class="s4">10</span><span class="s3">, </span><span class="s1">dtype=bool)</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">[slice(</span><span class="s4">0</span><span class="s3">, </span><span class="s1">a.size)])</span>
        <span class="s0"># Some mask</span>
        <span class="s1">a[(a &lt; </span><span class="s4">3</span><span class="s1">) | (a &gt; </span><span class="s4">8</span><span class="s1">) | (a == </span><span class="s4">5</span><span class="s1">)] = masked</span>
        <span class="s1">test = flatnotmasked_contiguous(a)</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">[slice(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">5</span><span class="s1">)</span><span class="s3">, </span><span class="s1">slice(</span><span class="s4">6</span><span class="s3">, </span><span class="s4">9</span><span class="s1">)])</span>
        <span class="s0">#</span>
        <span class="s1">a[:] = masked</span>
        <span class="s1">test = flatnotmasked_contiguous(a)</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">[])</span>


<span class="s3">class </span><span class="s1">TestAverage:</span>
    <span class="s0"># Several tests of average. Why so many ? Good point...</span>
    <span class="s3">def </span><span class="s1">test_testAverage1(self):</span>
        <span class="s0"># Test of average.</span>
        <span class="s1">ott = array([</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">, </span><span class="s4">2.</span><span class="s3">, </span><span class="s4">3.</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s3">True, False, False, False</span><span class="s1">])</span>
        <span class="s1">assert_equal(</span><span class="s4">2.0</span><span class="s3">, </span><span class="s1">average(ott</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">))</span>
        <span class="s1">assert_equal(</span><span class="s4">2.0</span><span class="s3">, </span><span class="s1">average(ott</span><span class="s3">, </span><span class="s1">weights=[</span><span class="s4">1.</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">, </span><span class="s4">2.</span><span class="s3">, </span><span class="s4">1.</span><span class="s1">]))</span>
        <span class="s1">result</span><span class="s3">, </span><span class="s1">wts = average(ott</span><span class="s3">, </span><span class="s1">weights=[</span><span class="s4">1.</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">, </span><span class="s4">2.</span><span class="s3">, </span><span class="s4">1.</span><span class="s1">]</span><span class="s3">, </span><span class="s1">returned=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(</span><span class="s4">2.0</span><span class="s3">, </span><span class="s1">result)</span>
        <span class="s1">assert_(wts == </span><span class="s4">4.0</span><span class="s1">)</span>
        <span class="s1">ott[:] = masked</span>
        <span class="s1">assert_equal(average(ott</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">).mask</span><span class="s3">, </span><span class="s1">[</span><span class="s3">True</span><span class="s1">])</span>
        <span class="s1">ott = array([</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">, </span><span class="s4">2.</span><span class="s3">, </span><span class="s4">3.</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s3">True, False, False, False</span><span class="s1">])</span>
        <span class="s1">ott = ott.reshape(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">ott[:</span><span class="s3">, </span><span class="s4">1</span><span class="s1">] = masked</span>
        <span class="s1">assert_equal(average(ott</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[</span><span class="s4">2.0</span><span class="s3">, </span><span class="s4">0.0</span><span class="s1">])</span>
        <span class="s1">assert_equal(average(ott</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">).mask[</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s3">True</span><span class="s1">])</span>
        <span class="s1">assert_equal([</span><span class="s4">2.</span><span class="s3">, </span><span class="s4">0.</span><span class="s1">]</span><span class="s3">, </span><span class="s1">average(ott</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">))</span>
        <span class="s1">result</span><span class="s3">, </span><span class="s1">wts = average(ott</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s3">, </span><span class="s1">returned=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(wts</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1.</span><span class="s3">, </span><span class="s4">0.</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_testAverage2(self):</span>
        <span class="s0"># More tests of average.</span>
        <span class="s1">w1 = [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span>
        <span class="s1">w2 = [[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]]</span>
        <span class="s1">x = arange(</span><span class="s4">6</span><span class="s3">, </span><span class="s1">dtype=np.float_)</span>
        <span class="s1">assert_equal(average(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s4">2.5</span><span class="s1">)</span>
        <span class="s1">assert_equal(average(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s3">, </span><span class="s1">weights=w1)</span><span class="s3">, </span><span class="s4">2.5</span><span class="s1">)</span>
        <span class="s1">y = array([arange(</span><span class="s4">6</span><span class="s3">, </span><span class="s1">dtype=np.float_)</span><span class="s3">, </span><span class="s4">2.0 </span><span class="s1">* arange(</span><span class="s4">6</span><span class="s1">)])</span>
        <span class="s1">assert_equal(average(y</span><span class="s3">, None</span><span class="s1">)</span><span class="s3">, </span><span class="s1">np.add.reduce(np.arange(</span><span class="s4">6</span><span class="s1">)) * </span><span class="s4">3. </span><span class="s1">/ </span><span class="s4">12.</span><span class="s1">)</span>
        <span class="s1">assert_equal(average(y</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">np.arange(</span><span class="s4">6</span><span class="s1">) * </span><span class="s4">3. </span><span class="s1">/ </span><span class="s4">2.</span><span class="s1">)</span>
        <span class="s1">assert_equal(average(y</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s3">,</span>
                     <span class="s1">[average(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">average(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">) * </span><span class="s4">2.0</span><span class="s1">])</span>
        <span class="s1">assert_equal(average(y</span><span class="s3">, None, </span><span class="s1">weights=w2)</span><span class="s3">, </span><span class="s4">20. </span><span class="s1">/ </span><span class="s4">6.</span><span class="s1">)</span>
        <span class="s1">assert_equal(average(y</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s3">, </span><span class="s1">weights=w2)</span><span class="s3">,</span>
                     <span class="s1">[</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">, </span><span class="s4">2.</span><span class="s3">, </span><span class="s4">3.</span><span class="s3">, </span><span class="s4">4.</span><span class="s3">, </span><span class="s4">10.</span><span class="s1">])</span>
        <span class="s1">assert_equal(average(y</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s3">,</span>
                     <span class="s1">[average(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">average(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">) * </span><span class="s4">2.0</span><span class="s1">])</span>
        <span class="s1">m1 = zeros(</span><span class="s4">6</span><span class="s1">)</span>
        <span class="s1">m2 = [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span>
        <span class="s1">m3 = [[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]]</span>
        <span class="s1">m4 = ones(</span><span class="s4">6</span><span class="s1">)</span>
        <span class="s1">m5 = [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">assert_equal(average(masked_array(x</span><span class="s3">, </span><span class="s1">m1)</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s4">2.5</span><span class="s1">)</span>
        <span class="s1">assert_equal(average(masked_array(x</span><span class="s3">, </span><span class="s1">m2)</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s4">2.5</span><span class="s1">)</span>
        <span class="s1">assert_equal(average(masked_array(x</span><span class="s3">, </span><span class="s1">m4)</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">).mask</span><span class="s3">, </span><span class="s1">[</span><span class="s3">True</span><span class="s1">])</span>
        <span class="s1">assert_equal(average(masked_array(x</span><span class="s3">, </span><span class="s1">m5)</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s4">0.0</span><span class="s1">)</span>
        <span class="s1">assert_equal(count(average(masked_array(x</span><span class="s3">, </span><span class="s1">m4)</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">))</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">z = masked_array(y</span><span class="s3">, </span><span class="s1">m3)</span>
        <span class="s1">assert_equal(average(z</span><span class="s3">, None</span><span class="s1">)</span><span class="s3">, </span><span class="s4">20. </span><span class="s1">/ </span><span class="s4">6.</span><span class="s1">)</span>
        <span class="s1">assert_equal(average(z</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">, </span><span class="s4">99.</span><span class="s3">, </span><span class="s4">99.</span><span class="s3">, </span><span class="s4">4.0</span><span class="s3">, </span><span class="s4">7.5</span><span class="s1">])</span>
        <span class="s1">assert_equal(average(z</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[</span><span class="s4">2.5</span><span class="s3">, </span><span class="s4">5.0</span><span class="s1">])</span>
        <span class="s1">assert_equal(average(z</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s3">, </span><span class="s1">weights=w2)</span><span class="s3">,</span>
                     <span class="s1">[</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">, </span><span class="s4">99.</span><span class="s3">, </span><span class="s4">99.</span><span class="s3">, </span><span class="s4">4.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_testAverage3(self):</span>
        <span class="s0"># Yet more tests of average!</span>
        <span class="s1">a = arange(</span><span class="s4">6</span><span class="s1">)</span>
        <span class="s1">b = arange(</span><span class="s4">6</span><span class="s1">) * </span><span class="s4">3</span>
        <span class="s1">r1</span><span class="s3">, </span><span class="s1">w1 = average([[a</span><span class="s3">, </span><span class="s1">b]</span><span class="s3">, </span><span class="s1">[b</span><span class="s3">, </span><span class="s1">a]]</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">returned=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(shape(r1)</span><span class="s3">, </span><span class="s1">shape(w1))</span>
        <span class="s1">assert_equal(r1.shape</span><span class="s3">, </span><span class="s1">w1.shape)</span>
        <span class="s1">r2</span><span class="s3">, </span><span class="s1">w2 = average(ones((</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">))</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s3">, </span><span class="s1">weights=[</span><span class="s4">3</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">returned=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(shape(w2)</span><span class="s3">, </span><span class="s1">shape(r2))</span>
        <span class="s1">r2</span><span class="s3">, </span><span class="s1">w2 = average(ones((</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">))</span><span class="s3">, </span><span class="s1">returned=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(shape(w2)</span><span class="s3">, </span><span class="s1">shape(r2))</span>
        <span class="s1">r2</span><span class="s3">, </span><span class="s1">w2 = average(ones((</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">))</span><span class="s3">, </span><span class="s1">weights=ones((</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">))</span><span class="s3">, </span><span class="s1">returned=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(shape(w2)</span><span class="s3">, </span><span class="s1">shape(r2))</span>
        <span class="s1">a2d = array([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">4</span><span class="s1">]]</span><span class="s3">, </span><span class="s1">float)</span>
        <span class="s1">a2dm = masked_array(a2d</span><span class="s3">, </span><span class="s1">[[</span><span class="s3">False, False</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s3">True, False</span><span class="s1">]])</span>
        <span class="s1">a2da = average(a2d</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_equal(a2da</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">3.0</span><span class="s1">])</span>
        <span class="s1">a2dma = average(a2dm</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_equal(a2dma</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">3.0</span><span class="s1">])</span>
        <span class="s1">a2dma = average(a2dm</span><span class="s3">, </span><span class="s1">axis=</span><span class="s3">None</span><span class="s1">)</span>
        <span class="s1">assert_equal(a2dma</span><span class="s3">, </span><span class="s4">7. </span><span class="s1">/ </span><span class="s4">3.</span><span class="s1">)</span>
        <span class="s1">a2dma = average(a2dm</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(a2dma</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1.5</span><span class="s3">, </span><span class="s4">4.0</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_onintegers_with_mask(self):</span>
        <span class="s0"># Test average on integers with mask</span>
        <span class="s1">a = average(array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]))</span>
        <span class="s1">assert_equal(a</span><span class="s3">, </span><span class="s4">1.5</span><span class="s1">)</span>
        <span class="s1">a = average(array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s3">False, False, True, True</span><span class="s1">]))</span>
        <span class="s1">assert_equal(a</span><span class="s3">, </span><span class="s4">1.5</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_complex(self):</span>
        <span class="s0"># Test with complex data.</span>
        <span class="s0"># (Regression test for https://github.com/numpy/numpy/issues/2684)</span>
        <span class="s1">mask = np.array([[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">,</span>
                         <span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]]</span><span class="s3">, </span><span class="s1">dtype=bool)</span>
        <span class="s1">a = masked_array([[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">+</span><span class="s4">2j</span><span class="s3">, </span><span class="s4">3</span><span class="s1">+</span><span class="s4">4j</span><span class="s3">, </span><span class="s4">5</span><span class="s1">+</span><span class="s4">6j</span><span class="s3">, </span><span class="s4">7</span><span class="s1">+</span><span class="s4">8j</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">9j</span><span class="s3">, </span><span class="s4">0</span><span class="s1">+</span><span class="s4">1j</span><span class="s3">, </span><span class="s4">2</span><span class="s1">+</span><span class="s4">3j</span><span class="s3">, </span><span class="s4">4</span><span class="s1">+</span><span class="s4">5j</span><span class="s3">, </span><span class="s4">7</span><span class="s1">+</span><span class="s4">7j</span><span class="s1">]]</span><span class="s3">,</span>
                         <span class="s1">mask=mask)</span>

        <span class="s1">av = average(a)</span>
        <span class="s1">expected = np.average(a.compressed())</span>
        <span class="s1">assert_almost_equal(av.real</span><span class="s3">, </span><span class="s1">expected.real)</span>
        <span class="s1">assert_almost_equal(av.imag</span><span class="s3">, </span><span class="s1">expected.imag)</span>

        <span class="s1">av0 = average(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">expected0 = average(a.real</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">) + average(a.imag</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)*</span><span class="s4">1j</span>
        <span class="s1">assert_almost_equal(av0.real</span><span class="s3">, </span><span class="s1">expected0.real)</span>
        <span class="s1">assert_almost_equal(av0.imag</span><span class="s3">, </span><span class="s1">expected0.imag)</span>

        <span class="s1">av1 = average(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">expected1 = average(a.real</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">) + average(a.imag</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)*</span><span class="s4">1j</span>
        <span class="s1">assert_almost_equal(av1.real</span><span class="s3">, </span><span class="s1">expected1.real)</span>
        <span class="s1">assert_almost_equal(av1.imag</span><span class="s3">, </span><span class="s1">expected1.imag)</span>

        <span class="s0"># Test with the 'weights' argument.</span>
        <span class="s1">wts = np.array([[</span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">2.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">0.5</span><span class="s1">]</span><span class="s3">,</span>
                        <span class="s1">[</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s1">]])</span>
        <span class="s1">wav = average(a</span><span class="s3">, </span><span class="s1">weights=wts)</span>
        <span class="s1">expected = np.average(a.compressed()</span><span class="s3">, </span><span class="s1">weights=wts[~mask])</span>
        <span class="s1">assert_almost_equal(wav.real</span><span class="s3">, </span><span class="s1">expected.real)</span>
        <span class="s1">assert_almost_equal(wav.imag</span><span class="s3">, </span><span class="s1">expected.imag)</span>

        <span class="s1">wav0 = average(a</span><span class="s3">, </span><span class="s1">weights=wts</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">expected0 = (average(a.real</span><span class="s3">, </span><span class="s1">weights=wts</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">) +</span>
                     <span class="s1">average(a.imag</span><span class="s3">, </span><span class="s1">weights=wts</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)*</span><span class="s4">1j</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(wav0.real</span><span class="s3">, </span><span class="s1">expected0.real)</span>
        <span class="s1">assert_almost_equal(wav0.imag</span><span class="s3">, </span><span class="s1">expected0.imag)</span>

        <span class="s1">wav1 = average(a</span><span class="s3">, </span><span class="s1">weights=wts</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">expected1 = (average(a.real</span><span class="s3">, </span><span class="s1">weights=wts</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">) +</span>
                     <span class="s1">average(a.imag</span><span class="s3">, </span><span class="s1">weights=wts</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)*</span><span class="s4">1j</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(wav1.real</span><span class="s3">, </span><span class="s1">expected1.real)</span>
        <span class="s1">assert_almost_equal(wav1.imag</span><span class="s3">, </span><span class="s1">expected1.imag)</span>

    <span class="s3">def </span><span class="s1">test_masked_weights(self):</span>
        <span class="s0"># Test with masked weights.</span>
        <span class="s0"># (Regression test for https://github.com/numpy/numpy/issues/10438)</span>
        <span class="s1">a = np.ma.array(np.arange(</span><span class="s4">9</span><span class="s1">).reshape(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s1">)</span><span class="s3">,</span>
                        <span class="s1">mask=[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">weights_unmasked = masked_array([</span><span class="s4">5</span><span class="s3">, </span><span class="s4">28</span><span class="s3">, </span><span class="s4">31</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=</span><span class="s3">False</span><span class="s1">)</span>
        <span class="s1">weights_masked = masked_array([</span><span class="s4">5</span><span class="s3">, </span><span class="s4">28</span><span class="s3">, </span><span class="s4">31</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>

        <span class="s1">avg_unmasked = average(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s3">,</span>
                               <span class="s1">weights=weights_unmasked</span><span class="s3">, </span><span class="s1">returned=</span><span class="s3">False</span><span class="s1">)</span>
        <span class="s1">expected_unmasked = np.array([</span><span class="s4">6.0</span><span class="s3">, </span><span class="s4">5.21875</span><span class="s3">, </span><span class="s4">6.21875</span><span class="s1">])</span>
        <span class="s1">assert_almost_equal(avg_unmasked</span><span class="s3">, </span><span class="s1">expected_unmasked)</span>

        <span class="s1">avg_masked = average(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s3">, </span><span class="s1">weights=weights_masked</span><span class="s3">, </span><span class="s1">returned=</span><span class="s3">False</span><span class="s1">)</span>
        <span class="s1">expected_masked = np.array([</span><span class="s4">6.0</span><span class="s3">, </span><span class="s4">5.576271186440678</span><span class="s3">, </span><span class="s4">6.576271186440678</span><span class="s1">])</span>
        <span class="s1">assert_almost_equal(avg_masked</span><span class="s3">, </span><span class="s1">expected_masked)</span>


<span class="s3">class </span><span class="s1">TestConcatenator:</span>
    <span class="s0"># Tests for mr_, the equivalent of r_ for masked arrays.</span>

    <span class="s3">def </span><span class="s1">test_1d(self):</span>
        <span class="s0"># Tests mr_ on 1D arrays.</span>
        <span class="s1">assert_array_equal(mr_[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">6</span><span class="s1">]</span><span class="s3">, </span><span class="s1">array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">6</span><span class="s1">]))</span>
        <span class="s1">b = ones(</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">m = [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span>
        <span class="s1">d = masked_array(b</span><span class="s3">, </span><span class="s1">mask=m)</span>
        <span class="s1">c = mr_[d</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s1">d]</span>
        <span class="s1">assert_(isinstance(c</span><span class="s3">, </span><span class="s1">MaskedArray))</span>
        <span class="s1">assert_array_equal(c</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(c.mask</span><span class="s3">, </span><span class="s1">mr_[m</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s1">m])</span>

    <span class="s3">def </span><span class="s1">test_2d(self):</span>
        <span class="s0"># Tests mr_ on 2D arrays.</span>
        <span class="s1">a_1 = np.random.rand(</span><span class="s4">5</span><span class="s3">, </span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">a_2 = np.random.rand(</span><span class="s4">5</span><span class="s3">, </span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">m_1 = np.round_(np.random.rand(</span><span class="s4">5</span><span class="s3">, </span><span class="s4">5</span><span class="s1">)</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">m_2 = np.round_(np.random.rand(</span><span class="s4">5</span><span class="s3">, </span><span class="s4">5</span><span class="s1">)</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">b_1 = masked_array(a_1</span><span class="s3">, </span><span class="s1">mask=m_1)</span>
        <span class="s1">b_2 = masked_array(a_2</span><span class="s3">, </span><span class="s1">mask=m_2)</span>
        <span class="s0"># append columns</span>
        <span class="s1">d = mr_[</span><span class="s5">'1'</span><span class="s3">, </span><span class="s1">b_1</span><span class="s3">, </span><span class="s1">b_2]</span>
        <span class="s1">assert_(d.shape == (</span><span class="s4">5</span><span class="s3">, </span><span class="s4">10</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(d[:</span><span class="s3">, </span><span class="s1">:</span><span class="s4">5</span><span class="s1">]</span><span class="s3">, </span><span class="s1">b_1)</span>
        <span class="s1">assert_array_equal(d[:</span><span class="s3">, </span><span class="s4">5</span><span class="s1">:]</span><span class="s3">, </span><span class="s1">b_2)</span>
        <span class="s1">assert_array_equal(d.mask</span><span class="s3">, </span><span class="s1">np.r_[</span><span class="s5">'1'</span><span class="s3">, </span><span class="s1">m_1</span><span class="s3">, </span><span class="s1">m_2])</span>
        <span class="s1">d = mr_[b_1</span><span class="s3">, </span><span class="s1">b_2]</span>
        <span class="s1">assert_(d.shape == (</span><span class="s4">10</span><span class="s3">, </span><span class="s4">5</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(d[:</span><span class="s4">5</span><span class="s3">,</span><span class="s1">:]</span><span class="s3">, </span><span class="s1">b_1)</span>
        <span class="s1">assert_array_equal(d[</span><span class="s4">5</span><span class="s1">:</span><span class="s3">,</span><span class="s1">:]</span><span class="s3">, </span><span class="s1">b_2)</span>
        <span class="s1">assert_array_equal(d.mask</span><span class="s3">, </span><span class="s1">np.r_[m_1</span><span class="s3">, </span><span class="s1">m_2])</span>

    <span class="s3">def </span><span class="s1">test_masked_constant(self):</span>
        <span class="s1">actual = mr_[np.ma.masked</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">assert_equal(actual.mask</span><span class="s3">, </span><span class="s1">[</span><span class="s3">True, False</span><span class="s1">])</span>
        <span class="s1">assert_equal(actual.data[</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span>

        <span class="s1">actual = mr_[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">np.ma.masked]</span>
        <span class="s1">assert_equal(actual.mask</span><span class="s3">, </span><span class="s1">[</span><span class="s3">False, False, True</span><span class="s1">])</span>
        <span class="s1">assert_equal(actual.data[:</span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s1">])</span>


<span class="s3">class </span><span class="s1">TestNotMasked:</span>
    <span class="s0"># Tests notmasked_edges and notmasked_contiguous.</span>

    <span class="s3">def </span><span class="s1">test_edges(self):</span>
        <span class="s0"># Tests unmasked_edges</span>
        <span class="s1">data = masked_array(np.arange(</span><span class="s4">25</span><span class="s1">).reshape(</span><span class="s4">5</span><span class="s3">, </span><span class="s4">5</span><span class="s1">)</span><span class="s3">,</span>
                            <span class="s1">mask=[[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">,</span>
                                  <span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">,</span>
                                  <span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">,</span>
                                  <span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">,</span>
                                  <span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]]</span><span class="s3">,</span><span class="s1">)</span>
        <span class="s1">test = notmasked_edges(data</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">24</span><span class="s1">])</span>
        <span class="s1">test = notmasked_edges(data</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_equal(test[</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)])</span>
        <span class="s1">assert_equal(test[</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)])</span>
        <span class="s1">test = notmasked_edges(data</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(test[</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">3</span><span class="s1">)])</span>
        <span class="s1">assert_equal(test[</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">4</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)])</span>
        <span class="s0">#</span>
        <span class="s1">test = notmasked_edges(data.data</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">24</span><span class="s1">])</span>
        <span class="s1">test = notmasked_edges(data.data</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_equal(test[</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)])</span>
        <span class="s1">assert_equal(test[</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[(</span><span class="s4">4</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)])</span>
        <span class="s1">test = notmasked_edges(data.data</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(test[</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)])</span>
        <span class="s1">assert_equal(test[</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">4</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)])</span>
        <span class="s0">#</span>
        <span class="s1">data[-</span><span class="s4">2</span><span class="s1">] = masked</span>
        <span class="s1">test = notmasked_edges(data</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_equal(test[</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)])</span>
        <span class="s1">assert_equal(test[</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)])</span>
        <span class="s1">test = notmasked_edges(data</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(test[</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">)])</span>
        <span class="s1">assert_equal(test[</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s4">4</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)])</span>

    <span class="s3">def </span><span class="s1">test_contiguous(self):</span>
        <span class="s0"># Tests notmasked_contiguous</span>
        <span class="s1">a = masked_array(np.arange(</span><span class="s4">24</span><span class="s1">).reshape(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">8</span><span class="s1">)</span><span class="s3">,</span>
                         <span class="s1">mask=[[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">,</span>
                               <span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">,</span>
                               <span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">tmp = notmasked_contiguous(a</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s1">assert_equal(tmp</span><span class="s3">, </span><span class="s1">[</span>
            <span class="s1">slice(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, None</span><span class="s1">)</span><span class="s3">,</span>
            <span class="s1">slice(</span><span class="s4">16</span><span class="s3">, </span><span class="s4">22</span><span class="s3">, None</span><span class="s1">)</span><span class="s3">,</span>
            <span class="s1">slice(</span><span class="s4">23</span><span class="s3">, </span><span class="s4">24</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s1">])</span>

        <span class="s1">tmp = notmasked_contiguous(a</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_equal(tmp</span><span class="s3">, </span><span class="s1">[</span>
            <span class="s1">[slice(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, None</span><span class="s1">)</span><span class="s3">, </span><span class="s1">slice(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, None</span><span class="s1">)]</span><span class="s3">,</span>
            <span class="s1">[slice(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, None</span><span class="s1">)</span><span class="s3">, </span><span class="s1">slice(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, None</span><span class="s1">)]</span><span class="s3">,</span>
            <span class="s1">[slice(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, None</span><span class="s1">)</span><span class="s3">, </span><span class="s1">slice(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, None</span><span class="s1">)]</span><span class="s3">,</span>
            <span class="s1">[slice(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, None</span><span class="s1">)</span><span class="s3">, </span><span class="s1">slice(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, None</span><span class="s1">)]</span><span class="s3">,</span>
            <span class="s1">[slice(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, None</span><span class="s1">)]</span><span class="s3">,</span>
            <span class="s1">[slice(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, None</span><span class="s1">)]</span><span class="s3">,</span>
            <span class="s1">[]</span><span class="s3">,</span>
            <span class="s1">[slice(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, None</span><span class="s1">)]</span>
        <span class="s1">])</span>
        <span class="s0">#</span>
        <span class="s1">tmp = notmasked_contiguous(a</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(tmp</span><span class="s3">, </span><span class="s1">[</span>
            <span class="s1">[slice(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, None</span><span class="s1">)]</span><span class="s3">,</span>
            <span class="s1">[]</span><span class="s3">,</span>
            <span class="s1">[slice(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, None</span><span class="s1">)</span><span class="s3">, </span><span class="s1">slice(</span><span class="s4">7</span><span class="s3">, </span><span class="s4">8</span><span class="s3">, None</span><span class="s1">)]</span>
        <span class="s1">])</span>


<span class="s3">class </span><span class="s1">TestCompressFunctions:</span>

    <span class="s3">def </span><span class="s1">test_compress_nd(self):</span>
        <span class="s0"># Tests compress_nd</span>
        <span class="s1">x = np.array(list(range(</span><span class="s4">3</span><span class="s1">*</span><span class="s4">4</span><span class="s1">*</span><span class="s4">5</span><span class="s1">))).reshape(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">m = np.zeros((</span><span class="s4">3</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">5</span><span class="s1">)).astype(bool)</span>
        <span class="s1">m[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s1">] = </span><span class="s3">True</span>
        <span class="s1">x = array(x</span><span class="s3">, </span><span class="s1">mask=m)</span>

        <span class="s0"># axis=None</span>
        <span class="s1">a = compress_nd(x)</span>
        <span class="s1">assert_equal(a</span><span class="s3">, </span><span class="s1">[[[ </span><span class="s4">0</span><span class="s3">,  </span><span class="s4">2</span><span class="s3">,  </span><span class="s4">3</span><span class="s3">,  </span><span class="s4">4</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">10</span><span class="s3">, </span><span class="s4">12</span><span class="s3">, </span><span class="s4">13</span><span class="s3">, </span><span class="s4">14</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">15</span><span class="s3">, </span><span class="s4">17</span><span class="s3">, </span><span class="s4">18</span><span class="s3">, </span><span class="s4">19</span><span class="s1">]]</span><span class="s3">,</span>
                         <span class="s1">[[</span><span class="s4">40</span><span class="s3">, </span><span class="s4">42</span><span class="s3">, </span><span class="s4">43</span><span class="s3">, </span><span class="s4">44</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">50</span><span class="s3">, </span><span class="s4">52</span><span class="s3">, </span><span class="s4">53</span><span class="s3">, </span><span class="s4">54</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">55</span><span class="s3">, </span><span class="s4">57</span><span class="s3">, </span><span class="s4">58</span><span class="s3">, </span><span class="s4">59</span><span class="s1">]]])</span>

        <span class="s0"># axis=0</span>
        <span class="s1">a = compress_nd(x</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_equal(a</span><span class="s3">, </span><span class="s1">[[[ </span><span class="s4">0</span><span class="s3">,  </span><span class="s4">1</span><span class="s3">,  </span><span class="s4">2</span><span class="s3">,  </span><span class="s4">3</span><span class="s3">,  </span><span class="s4">4</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[ </span><span class="s4">5</span><span class="s3">,  </span><span class="s4">6</span><span class="s3">,  </span><span class="s4">7</span><span class="s3">,  </span><span class="s4">8</span><span class="s3">,  </span><span class="s4">9</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">10</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">12</span><span class="s3">, </span><span class="s4">13</span><span class="s3">, </span><span class="s4">14</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">15</span><span class="s3">, </span><span class="s4">16</span><span class="s3">, </span><span class="s4">17</span><span class="s3">, </span><span class="s4">18</span><span class="s3">, </span><span class="s4">19</span><span class="s1">]]</span><span class="s3">,</span>
                         <span class="s1">[[</span><span class="s4">40</span><span class="s3">, </span><span class="s4">41</span><span class="s3">, </span><span class="s4">42</span><span class="s3">, </span><span class="s4">43</span><span class="s3">, </span><span class="s4">44</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">45</span><span class="s3">, </span><span class="s4">46</span><span class="s3">, </span><span class="s4">47</span><span class="s3">, </span><span class="s4">48</span><span class="s3">, </span><span class="s4">49</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">50</span><span class="s3">, </span><span class="s4">51</span><span class="s3">, </span><span class="s4">52</span><span class="s3">, </span><span class="s4">53</span><span class="s3">, </span><span class="s4">54</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">55</span><span class="s3">, </span><span class="s4">56</span><span class="s3">, </span><span class="s4">57</span><span class="s3">, </span><span class="s4">58</span><span class="s3">, </span><span class="s4">59</span><span class="s1">]]])</span>

        <span class="s0"># axis=1</span>
        <span class="s1">a = compress_nd(x</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(a</span><span class="s3">, </span><span class="s1">[[[ </span><span class="s4">0</span><span class="s3">,  </span><span class="s4">1</span><span class="s3">,  </span><span class="s4">2</span><span class="s3">,  </span><span class="s4">3</span><span class="s3">,  </span><span class="s4">4</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">10</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">12</span><span class="s3">, </span><span class="s4">13</span><span class="s3">, </span><span class="s4">14</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">15</span><span class="s3">, </span><span class="s4">16</span><span class="s3">, </span><span class="s4">17</span><span class="s3">, </span><span class="s4">18</span><span class="s3">, </span><span class="s4">19</span><span class="s1">]]</span><span class="s3">,</span>
                         <span class="s1">[[</span><span class="s4">20</span><span class="s3">, </span><span class="s4">21</span><span class="s3">, </span><span class="s4">22</span><span class="s3">, </span><span class="s4">23</span><span class="s3">, </span><span class="s4">24</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">30</span><span class="s3">, </span><span class="s4">31</span><span class="s3">, </span><span class="s4">32</span><span class="s3">, </span><span class="s4">33</span><span class="s3">, </span><span class="s4">34</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">35</span><span class="s3">, </span><span class="s4">36</span><span class="s3">, </span><span class="s4">37</span><span class="s3">, </span><span class="s4">38</span><span class="s3">, </span><span class="s4">39</span><span class="s1">]]</span><span class="s3">,</span>
                         <span class="s1">[[</span><span class="s4">40</span><span class="s3">, </span><span class="s4">41</span><span class="s3">, </span><span class="s4">42</span><span class="s3">, </span><span class="s4">43</span><span class="s3">, </span><span class="s4">44</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">50</span><span class="s3">, </span><span class="s4">51</span><span class="s3">, </span><span class="s4">52</span><span class="s3">, </span><span class="s4">53</span><span class="s3">, </span><span class="s4">54</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">55</span><span class="s3">, </span><span class="s4">56</span><span class="s3">, </span><span class="s4">57</span><span class="s3">, </span><span class="s4">58</span><span class="s3">, </span><span class="s4">59</span><span class="s1">]]])</span>

        <span class="s1">a2 = compress_nd(x</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">,</span><span class="s1">))</span>
        <span class="s1">a3 = compress_nd(x</span><span class="s3">, </span><span class="s1">-</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">a4 = compress_nd(x</span><span class="s3">, </span><span class="s1">(-</span><span class="s4">2</span><span class="s3">,</span><span class="s1">))</span>
        <span class="s1">assert_equal(a</span><span class="s3">, </span><span class="s1">a2)</span>
        <span class="s1">assert_equal(a</span><span class="s3">, </span><span class="s1">a3)</span>
        <span class="s1">assert_equal(a</span><span class="s3">, </span><span class="s1">a4)</span>

        <span class="s0"># axis=2</span>
        <span class="s1">a = compress_nd(x</span><span class="s3">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">assert_equal(a</span><span class="s3">, </span><span class="s1">[[[ </span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s3">,  </span><span class="s4">3</span><span class="s3">,  </span><span class="s4">4</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[ </span><span class="s4">5</span><span class="s3">, </span><span class="s4">7</span><span class="s3">,  </span><span class="s4">8</span><span class="s3">,  </span><span class="s4">9</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">10</span><span class="s3">, </span><span class="s4">12</span><span class="s3">, </span><span class="s4">13</span><span class="s3">, </span><span class="s4">14</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">15</span><span class="s3">, </span><span class="s4">17</span><span class="s3">, </span><span class="s4">18</span><span class="s3">, </span><span class="s4">19</span><span class="s1">]]</span><span class="s3">,</span>
                         <span class="s1">[[</span><span class="s4">20</span><span class="s3">, </span><span class="s4">22</span><span class="s3">, </span><span class="s4">23</span><span class="s3">, </span><span class="s4">24</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">25</span><span class="s3">, </span><span class="s4">27</span><span class="s3">, </span><span class="s4">28</span><span class="s3">, </span><span class="s4">29</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">30</span><span class="s3">, </span><span class="s4">32</span><span class="s3">, </span><span class="s4">33</span><span class="s3">, </span><span class="s4">34</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">35</span><span class="s3">, </span><span class="s4">37</span><span class="s3">, </span><span class="s4">38</span><span class="s3">, </span><span class="s4">39</span><span class="s1">]]</span><span class="s3">,</span>
                         <span class="s1">[[</span><span class="s4">40</span><span class="s3">, </span><span class="s4">42</span><span class="s3">, </span><span class="s4">43</span><span class="s3">, </span><span class="s4">44</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">45</span><span class="s3">, </span><span class="s4">47</span><span class="s3">, </span><span class="s4">48</span><span class="s3">, </span><span class="s4">49</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">50</span><span class="s3">, </span><span class="s4">52</span><span class="s3">, </span><span class="s4">53</span><span class="s3">, </span><span class="s4">54</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">55</span><span class="s3">, </span><span class="s4">57</span><span class="s3">, </span><span class="s4">58</span><span class="s3">, </span><span class="s4">59</span><span class="s1">]]])</span>

        <span class="s1">a2 = compress_nd(x</span><span class="s3">, </span><span class="s1">(</span><span class="s4">2</span><span class="s3">,</span><span class="s1">))</span>
        <span class="s1">a3 = compress_nd(x</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">a4 = compress_nd(x</span><span class="s3">, </span><span class="s1">(-</span><span class="s4">1</span><span class="s3">,</span><span class="s1">))</span>
        <span class="s1">assert_equal(a</span><span class="s3">, </span><span class="s1">a2)</span>
        <span class="s1">assert_equal(a</span><span class="s3">, </span><span class="s1">a3)</span>
        <span class="s1">assert_equal(a</span><span class="s3">, </span><span class="s1">a4)</span>

        <span class="s0"># axis=(0, 1)</span>
        <span class="s1">a = compress_nd(x</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))</span>
        <span class="s1">assert_equal(a</span><span class="s3">, </span><span class="s1">[[[ </span><span class="s4">0</span><span class="s3">,  </span><span class="s4">1</span><span class="s3">,  </span><span class="s4">2</span><span class="s3">,  </span><span class="s4">3</span><span class="s3">,  </span><span class="s4">4</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">10</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">12</span><span class="s3">, </span><span class="s4">13</span><span class="s3">, </span><span class="s4">14</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">15</span><span class="s3">, </span><span class="s4">16</span><span class="s3">, </span><span class="s4">17</span><span class="s3">, </span><span class="s4">18</span><span class="s3">, </span><span class="s4">19</span><span class="s1">]]</span><span class="s3">,</span>
                         <span class="s1">[[</span><span class="s4">40</span><span class="s3">, </span><span class="s4">41</span><span class="s3">, </span><span class="s4">42</span><span class="s3">, </span><span class="s4">43</span><span class="s3">, </span><span class="s4">44</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">50</span><span class="s3">, </span><span class="s4">51</span><span class="s3">, </span><span class="s4">52</span><span class="s3">, </span><span class="s4">53</span><span class="s3">, </span><span class="s4">54</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">55</span><span class="s3">, </span><span class="s4">56</span><span class="s3">, </span><span class="s4">57</span><span class="s3">, </span><span class="s4">58</span><span class="s3">, </span><span class="s4">59</span><span class="s1">]]])</span>
        <span class="s1">a2 = compress_nd(x</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s1">-</span><span class="s4">2</span><span class="s1">))</span>
        <span class="s1">assert_equal(a</span><span class="s3">, </span><span class="s1">a2)</span>

        <span class="s0"># axis=(1, 2)</span>
        <span class="s1">a = compress_nd(x</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s1">))</span>
        <span class="s1">assert_equal(a</span><span class="s3">, </span><span class="s1">[[[ </span><span class="s4">0</span><span class="s3">,  </span><span class="s4">2</span><span class="s3">,  </span><span class="s4">3</span><span class="s3">,  </span><span class="s4">4</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">10</span><span class="s3">, </span><span class="s4">12</span><span class="s3">, </span><span class="s4">13</span><span class="s3">, </span><span class="s4">14</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">15</span><span class="s3">, </span><span class="s4">17</span><span class="s3">, </span><span class="s4">18</span><span class="s3">, </span><span class="s4">19</span><span class="s1">]]</span><span class="s3">,</span>
                         <span class="s1">[[</span><span class="s4">20</span><span class="s3">, </span><span class="s4">22</span><span class="s3">, </span><span class="s4">23</span><span class="s3">, </span><span class="s4">24</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">30</span><span class="s3">, </span><span class="s4">32</span><span class="s3">, </span><span class="s4">33</span><span class="s3">, </span><span class="s4">34</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">35</span><span class="s3">, </span><span class="s4">37</span><span class="s3">, </span><span class="s4">38</span><span class="s3">, </span><span class="s4">39</span><span class="s1">]]</span><span class="s3">,</span>
                         <span class="s1">[[</span><span class="s4">40</span><span class="s3">, </span><span class="s4">42</span><span class="s3">, </span><span class="s4">43</span><span class="s3">, </span><span class="s4">44</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">50</span><span class="s3">, </span><span class="s4">52</span><span class="s3">, </span><span class="s4">53</span><span class="s3">, </span><span class="s4">54</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">55</span><span class="s3">, </span><span class="s4">57</span><span class="s3">, </span><span class="s4">58</span><span class="s3">, </span><span class="s4">59</span><span class="s1">]]])</span>

        <span class="s1">a2 = compress_nd(x</span><span class="s3">, </span><span class="s1">(-</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s1">))</span>
        <span class="s1">a3 = compress_nd(x</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">))</span>
        <span class="s1">a4 = compress_nd(x</span><span class="s3">, </span><span class="s1">(-</span><span class="s4">2</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">))</span>
        <span class="s1">assert_equal(a</span><span class="s3">, </span><span class="s1">a2)</span>
        <span class="s1">assert_equal(a</span><span class="s3">, </span><span class="s1">a3)</span>
        <span class="s1">assert_equal(a</span><span class="s3">, </span><span class="s1">a4)</span>

        <span class="s0"># axis=(0, 2)</span>
        <span class="s1">a = compress_nd(x</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s1">))</span>
        <span class="s1">assert_equal(a</span><span class="s3">, </span><span class="s1">[[[ </span><span class="s4">0</span><span class="s3">,  </span><span class="s4">2</span><span class="s3">,  </span><span class="s4">3</span><span class="s3">,  </span><span class="s4">4</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[ </span><span class="s4">5</span><span class="s3">,  </span><span class="s4">7</span><span class="s3">,  </span><span class="s4">8</span><span class="s3">,  </span><span class="s4">9</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">10</span><span class="s3">, </span><span class="s4">12</span><span class="s3">, </span><span class="s4">13</span><span class="s3">, </span><span class="s4">14</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">15</span><span class="s3">, </span><span class="s4">17</span><span class="s3">, </span><span class="s4">18</span><span class="s3">, </span><span class="s4">19</span><span class="s1">]]</span><span class="s3">,</span>
                         <span class="s1">[[</span><span class="s4">40</span><span class="s3">, </span><span class="s4">42</span><span class="s3">, </span><span class="s4">43</span><span class="s3">, </span><span class="s4">44</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">45</span><span class="s3">, </span><span class="s4">47</span><span class="s3">, </span><span class="s4">48</span><span class="s3">, </span><span class="s4">49</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">50</span><span class="s3">, </span><span class="s4">52</span><span class="s3">, </span><span class="s4">53</span><span class="s3">, </span><span class="s4">54</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">55</span><span class="s3">, </span><span class="s4">57</span><span class="s3">, </span><span class="s4">58</span><span class="s3">, </span><span class="s4">59</span><span class="s1">]]])</span>

        <span class="s1">a2 = compress_nd(x</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">))</span>
        <span class="s1">assert_equal(a</span><span class="s3">, </span><span class="s1">a2)</span>

    <span class="s3">def </span><span class="s1">test_compress_rowcols(self):</span>
        <span class="s0"># Tests compress_rowcols</span>
        <span class="s1">x = array(np.arange(</span><span class="s4">9</span><span class="s1">).reshape(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s1">)</span><span class="s3">,</span>
                  <span class="s1">mask=[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(compress_rowcols(x)</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">7</span><span class="s3">, </span><span class="s4">8</span><span class="s1">]])</span>
        <span class="s1">assert_equal(compress_rowcols(x</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">6</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s4">8</span><span class="s1">]])</span>
        <span class="s1">assert_equal(compress_rowcols(x</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">7</span><span class="s3">, </span><span class="s4">8</span><span class="s1">]])</span>
        <span class="s1">x = array(x._data</span><span class="s3">, </span><span class="s1">mask=[[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(compress_rowcols(x)</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">6</span><span class="s3">, </span><span class="s4">8</span><span class="s1">]])</span>
        <span class="s1">assert_equal(compress_rowcols(x</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">6</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s4">8</span><span class="s1">]])</span>
        <span class="s1">assert_equal(compress_rowcols(x</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">3</span><span class="s3">, </span><span class="s4">5</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">6</span><span class="s3">, </span><span class="s4">8</span><span class="s1">]])</span>
        <span class="s1">x = array(x._data</span><span class="s3">, </span><span class="s1">mask=[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(compress_rowcols(x)</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">8</span><span class="s1">]])</span>
        <span class="s1">assert_equal(compress_rowcols(x</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">6</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s4">8</span><span class="s1">]])</span>
        <span class="s1">assert_equal(compress_rowcols(x</span><span class="s3">, </span><span class="s4">1</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">5</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">8</span><span class="s1">]])</span>
        <span class="s1">x = array(x._data</span><span class="s3">, </span><span class="s1">mask=[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]])</span>
        <span class="s1">assert_equal(compress_rowcols(x).size</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_equal(compress_rowcols(x</span><span class="s3">, </span><span class="s4">0</span><span class="s1">).size</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_equal(compress_rowcols(x</span><span class="s3">, </span><span class="s4">1</span><span class="s1">).size</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_mask_rowcols(self):</span>
        <span class="s0"># Tests mask_rowcols.</span>
        <span class="s1">x = array(np.arange(</span><span class="s4">9</span><span class="s1">).reshape(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s1">)</span><span class="s3">,</span>
                  <span class="s1">mask=[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(mask_rowcols(x).mask</span><span class="s3">,</span>
                     <span class="s1">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(mask_rowcols(x</span><span class="s3">, </span><span class="s4">0</span><span class="s1">).mask</span><span class="s3">,</span>
                     <span class="s1">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(mask_rowcols(x</span><span class="s3">, </span><span class="s4">1</span><span class="s1">).mask</span><span class="s3">,</span>
                     <span class="s1">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">x = array(x._data</span><span class="s3">, </span><span class="s1">mask=[[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(mask_rowcols(x).mask</span><span class="s3">,</span>
                     <span class="s1">[[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(mask_rowcols(x</span><span class="s3">, </span><span class="s4">0</span><span class="s1">).mask</span><span class="s3">,</span>
                     <span class="s1">[[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(mask_rowcols(x</span><span class="s3">, </span><span class="s4">1</span><span class="s1">).mask</span><span class="s3">,</span>
                     <span class="s1">[[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">x = array(x._data</span><span class="s3">, </span><span class="s1">mask=[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(mask_rowcols(x).mask</span><span class="s3">,</span>
                     <span class="s1">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(mask_rowcols(x</span><span class="s3">, </span><span class="s4">0</span><span class="s1">).mask</span><span class="s3">,</span>
                     <span class="s1">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(mask_rowcols(x</span><span class="s3">, </span><span class="s4">1</span><span class="s3">,</span><span class="s1">).mask</span><span class="s3">,</span>
                     <span class="s1">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">x = array(x._data</span><span class="s3">, </span><span class="s1">mask=[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]])</span>
        <span class="s1">assert_(mask_rowcols(x).all() </span><span class="s3">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(mask_rowcols(x</span><span class="s3">, </span><span class="s4">0</span><span class="s1">).all() </span><span class="s3">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(mask_rowcols(x</span><span class="s3">, </span><span class="s4">1</span><span class="s1">).all() </span><span class="s3">is </span><span class="s1">masked)</span>
        <span class="s1">assert_(mask_rowcols(x).mask.all())</span>
        <span class="s1">assert_(mask_rowcols(x</span><span class="s3">, </span><span class="s4">0</span><span class="s1">).mask.all())</span>
        <span class="s1">assert_(mask_rowcols(x</span><span class="s3">, </span><span class="s4">1</span><span class="s1">).mask.all())</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s5">&quot;axis&quot;</span><span class="s3">, </span><span class="s1">[</span><span class="s3">None, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize([</span><span class="s5">&quot;func&quot;</span><span class="s3">, </span><span class="s5">&quot;rowcols_axis&quot;</span><span class="s1">]</span><span class="s3">,</span>
                             <span class="s1">[(np.ma.mask_rows</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(np.ma.mask_cols</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)])</span>
    <span class="s3">def </span><span class="s1">test_mask_row_cols_axis_deprecation(self</span><span class="s3">, </span><span class="s1">axis</span><span class="s3">, </span><span class="s1">func</span><span class="s3">, </span><span class="s1">rowcols_axis):</span>
        <span class="s0"># Test deprecation of the axis argument to `mask_rows` and `mask_cols`</span>
        <span class="s1">x = array(np.arange(</span><span class="s4">9</span><span class="s1">).reshape(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s1">)</span><span class="s3">,</span>
                  <span class="s1">mask=[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>

        <span class="s3">with </span><span class="s1">assert_warns(DeprecationWarning):</span>
            <span class="s1">res = func(x</span><span class="s3">, </span><span class="s1">axis=axis)</span>
            <span class="s1">assert_equal(res</span><span class="s3">, </span><span class="s1">mask_rowcols(x</span><span class="s3">, </span><span class="s1">rowcols_axis))</span>

    <span class="s3">def </span><span class="s1">test_dot(self):</span>
        <span class="s0"># Tests dot product</span>
        <span class="s1">n = np.arange(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">7</span><span class="s1">)</span>
        <span class="s0">#</span>
        <span class="s1">m = [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span>
        <span class="s1">a = masked_array(n</span><span class="s3">, </span><span class="s1">mask=m).reshape(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">b = masked_array(n</span><span class="s3">, </span><span class="s1">mask=m).reshape(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">c = dot(a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(c.mask</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">c = dot(b</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(c.mask</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">c = dot(a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">False</span><span class="s1">)</span>
        <span class="s1">assert_equal(c</span><span class="s3">, </span><span class="s1">np.dot(a.filled(</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">b.filled(</span><span class="s4">0</span><span class="s1">)))</span>
        <span class="s1">c = dot(b</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">False</span><span class="s1">)</span>
        <span class="s1">assert_equal(c</span><span class="s3">, </span><span class="s1">np.dot(b.filled(</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">a.filled(</span><span class="s4">0</span><span class="s1">)))</span>
        <span class="s0">#</span>
        <span class="s1">m = [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">a = masked_array(n</span><span class="s3">, </span><span class="s1">mask=m).reshape(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">b = masked_array(n</span><span class="s3">, </span><span class="s1">mask=m).reshape(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">c = dot(a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(c.mask</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]])</span>
        <span class="s1">c = dot(b</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(c.mask</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]])</span>
        <span class="s1">c = dot(a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">False</span><span class="s1">)</span>
        <span class="s1">assert_equal(c</span><span class="s3">, </span><span class="s1">np.dot(a.filled(</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">b.filled(</span><span class="s4">0</span><span class="s1">)))</span>
        <span class="s1">assert_equal(c</span><span class="s3">, </span><span class="s1">dot(a</span><span class="s3">, </span><span class="s1">b))</span>
        <span class="s1">c = dot(b</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">False</span><span class="s1">)</span>
        <span class="s1">assert_equal(c</span><span class="s3">, </span><span class="s1">np.dot(b.filled(</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">a.filled(</span><span class="s4">0</span><span class="s1">)))</span>
        <span class="s0">#</span>
        <span class="s1">m = [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span>
        <span class="s1">a = masked_array(n</span><span class="s3">, </span><span class="s1">mask=m).reshape(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">b = masked_array(n</span><span class="s3">, </span><span class="s1">mask=m).reshape(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">c = dot(a</span><span class="s3">, </span><span class="s1">b)</span>
        <span class="s1">assert_equal(c.mask</span><span class="s3">, </span><span class="s1">nomask)</span>
        <span class="s1">c = dot(b</span><span class="s3">, </span><span class="s1">a)</span>
        <span class="s1">assert_equal(c.mask</span><span class="s3">, </span><span class="s1">nomask)</span>
        <span class="s0">#</span>
        <span class="s1">a = masked_array(n</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]).reshape(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">b = masked_array(n</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]).reshape(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">c = dot(a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(c.mask</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">c = dot(a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">False</span><span class="s1">)</span>
        <span class="s1">assert_equal(c</span><span class="s3">, </span><span class="s1">np.dot(a.filled(</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">b.filled(</span><span class="s4">0</span><span class="s1">)))</span>
        <span class="s1">c = dot(b</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(c.mask</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">c = dot(b</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">False</span><span class="s1">)</span>
        <span class="s1">assert_equal(c</span><span class="s3">, </span><span class="s1">np.dot(b.filled(</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">a.filled(</span><span class="s4">0</span><span class="s1">)))</span>
        <span class="s0">#</span>
        <span class="s1">a = masked_array(n</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]).reshape(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">b = masked_array(n</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]).reshape(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">c = dot(a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(c.mask</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]])</span>
        <span class="s1">c = dot(a</span><span class="s3">, </span><span class="s1">b)</span>
        <span class="s1">assert_equal(c</span><span class="s3">, </span><span class="s1">np.dot(a.filled(</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">b.filled(</span><span class="s4">0</span><span class="s1">)))</span>
        <span class="s1">c = dot(b</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(c.mask</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]])</span>
        <span class="s1">c = dot(b</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">False</span><span class="s1">)</span>
        <span class="s1">assert_equal(c</span><span class="s3">, </span><span class="s1">np.dot(b.filled(</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">a.filled(</span><span class="s4">0</span><span class="s1">)))</span>
        <span class="s0">#</span>
        <span class="s1">a = masked_array(n</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]).reshape(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">b = masked_array(n</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]).reshape(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">c = dot(a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(c.mask</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]])</span>
        <span class="s1">c = dot(a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">False</span><span class="s1">)</span>
        <span class="s1">assert_equal(c</span><span class="s3">, </span><span class="s1">np.dot(a.filled(</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">b.filled(</span><span class="s4">0</span><span class="s1">)))</span>
        <span class="s1">c = dot(b</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(c.mask</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]])</span>
        <span class="s1">c = dot(b</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">False</span><span class="s1">)</span>
        <span class="s1">assert_equal(c</span><span class="s3">, </span><span class="s1">np.dot(b.filled(</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">a.filled(</span><span class="s4">0</span><span class="s1">)))</span>

    <span class="s3">def </span><span class="s1">test_dot_returns_maskedarray(self):</span>
        <span class="s0"># See gh-6611</span>
        <span class="s1">a = np.eye(</span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">b = array(a)</span>
        <span class="s1">assert_(type(dot(a</span><span class="s3">, </span><span class="s1">a)) </span><span class="s3">is </span><span class="s1">MaskedArray)</span>
        <span class="s1">assert_(type(dot(a</span><span class="s3">, </span><span class="s1">b)) </span><span class="s3">is </span><span class="s1">MaskedArray)</span>
        <span class="s1">assert_(type(dot(b</span><span class="s3">, </span><span class="s1">a)) </span><span class="s3">is </span><span class="s1">MaskedArray)</span>
        <span class="s1">assert_(type(dot(b</span><span class="s3">, </span><span class="s1">b)) </span><span class="s3">is </span><span class="s1">MaskedArray)</span>

    <span class="s3">def </span><span class="s1">test_dot_out(self):</span>
        <span class="s1">a = array(np.eye(</span><span class="s4">3</span><span class="s1">))</span>
        <span class="s1">out = array(np.zeros((</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s1">)))</span>
        <span class="s1">res = dot(a</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">out=out)</span>
        <span class="s1">assert_(res </span><span class="s3">is </span><span class="s1">out)</span>
        <span class="s1">assert_equal(a</span><span class="s3">, </span><span class="s1">res)</span>


<span class="s3">class </span><span class="s1">TestApplyAlongAxis:</span>
    <span class="s0"># Tests 2D functions</span>
    <span class="s3">def </span><span class="s1">test_3d(self):</span>
        <span class="s1">a = arange(</span><span class="s4">12.</span><span class="s1">).reshape(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">)</span>

        <span class="s3">def </span><span class="s1">myfunc(b):</span>
            <span class="s3">return </span><span class="s1">b[</span><span class="s4">1</span><span class="s1">]</span>

        <span class="s1">xa = apply_along_axis(myfunc</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s1">a)</span>
        <span class="s1">assert_equal(xa</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">4</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">7</span><span class="s3">, </span><span class="s4">10</span><span class="s1">]])</span>

    <span class="s0"># Tests kwargs functions</span>
    <span class="s3">def </span><span class="s1">test_3d_kwargs(self):</span>
        <span class="s1">a = arange(</span><span class="s4">12</span><span class="s1">).reshape(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">)</span>

        <span class="s3">def </span><span class="s1">myfunc(b</span><span class="s3">, </span><span class="s1">offset=</span><span class="s4">0</span><span class="s1">):</span>
            <span class="s3">return </span><span class="s1">b[</span><span class="s4">1</span><span class="s1">+offset]</span>

        <span class="s1">xa = apply_along_axis(myfunc</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">offset=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(xa</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">2</span><span class="s3">, </span><span class="s4">5</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">8</span><span class="s3">, </span><span class="s4">11</span><span class="s1">]])</span>


<span class="s3">class </span><span class="s1">TestApplyOverAxes:</span>
    <span class="s0"># Tests apply_over_axes</span>
    <span class="s3">def </span><span class="s1">test_basic(self):</span>
        <span class="s1">a = arange(</span><span class="s4">24</span><span class="s1">).reshape(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)</span>
        <span class="s1">test = apply_over_axes(np.sum</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s1">])</span>
        <span class="s1">ctrl = np.array([[[</span><span class="s4">60</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">92</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">124</span><span class="s1">]]])</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">ctrl)</span>
        <span class="s1">a[(a % </span><span class="s4">2</span><span class="s1">).astype(bool)] = masked</span>
        <span class="s1">test = apply_over_axes(np.sum</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s1">])</span>
        <span class="s1">ctrl = np.array([[[</span><span class="s4">28</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">44</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">60</span><span class="s1">]]])</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">ctrl)</span>


<span class="s3">class </span><span class="s1">TestMedian:</span>
    <span class="s3">def </span><span class="s1">test_pytype(self):</span>
        <span class="s1">r = np.ma.median([[np.inf</span><span class="s3">, </span><span class="s1">np.inf]</span><span class="s3">, </span><span class="s1">[np.inf</span><span class="s3">, </span><span class="s1">np.inf]]</span><span class="s3">, </span><span class="s1">axis=-</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(r</span><span class="s3">, </span><span class="s1">np.inf)</span>

    <span class="s3">def </span><span class="s1">test_inf(self):</span>
        <span class="s0"># test that even which computes handles inf / x = masked</span>
        <span class="s1">r = np.ma.median(np.ma.masked_array([[np.inf</span><span class="s3">, </span><span class="s1">np.inf]</span><span class="s3">,</span>
                                             <span class="s1">[np.inf</span><span class="s3">, </span><span class="s1">np.inf]])</span><span class="s3">, </span><span class="s1">axis=-</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(r</span><span class="s3">, </span><span class="s1">np.inf)</span>
        <span class="s1">r = np.ma.median(np.ma.masked_array([[np.inf</span><span class="s3">, </span><span class="s1">np.inf]</span><span class="s3">,</span>
                                             <span class="s1">[np.inf</span><span class="s3">, </span><span class="s1">np.inf]])</span><span class="s3">, </span><span class="s1">axis=</span><span class="s3">None</span><span class="s1">)</span>
        <span class="s1">assert_equal(r</span><span class="s3">, </span><span class="s1">np.inf)</span>
        <span class="s0"># all masked</span>
        <span class="s1">r = np.ma.median(np.ma.masked_array([[np.inf</span><span class="s3">, </span><span class="s1">np.inf]</span><span class="s3">,</span>
                                             <span class="s1">[np.inf</span><span class="s3">, </span><span class="s1">np.inf]]</span><span class="s3">, </span><span class="s1">mask=</span><span class="s3">True</span><span class="s1">)</span><span class="s3">,</span>
                         <span class="s1">axis=-</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(r.mask</span><span class="s3">, True</span><span class="s1">)</span>
        <span class="s1">r = np.ma.median(np.ma.masked_array([[np.inf</span><span class="s3">, </span><span class="s1">np.inf]</span><span class="s3">,</span>
                                             <span class="s1">[np.inf</span><span class="s3">, </span><span class="s1">np.inf]]</span><span class="s3">, </span><span class="s1">mask=</span><span class="s3">True</span><span class="s1">)</span><span class="s3">,</span>
                         <span class="s1">axis=</span><span class="s3">None</span><span class="s1">)</span>
        <span class="s1">assert_equal(r.mask</span><span class="s3">, True</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_non_masked(self):</span>
        <span class="s1">x = np.arange(</span><span class="s4">9</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.ma.median(x)</span><span class="s3">, </span><span class="s4">4.</span><span class="s1">)</span>
        <span class="s1">assert_(type(np.ma.median(x)) </span><span class="s3">is not </span><span class="s1">MaskedArray)</span>
        <span class="s1">x = range(</span><span class="s4">8</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.ma.median(x)</span><span class="s3">, </span><span class="s4">3.5</span><span class="s1">)</span>
        <span class="s1">assert_(type(np.ma.median(x)) </span><span class="s3">is not </span><span class="s1">MaskedArray)</span>
        <span class="s1">x = </span><span class="s4">5</span>
        <span class="s1">assert_equal(np.ma.median(x)</span><span class="s3">, </span><span class="s4">5.</span><span class="s1">)</span>
        <span class="s1">assert_(type(np.ma.median(x)) </span><span class="s3">is not </span><span class="s1">MaskedArray)</span>
        <span class="s0"># integer</span>
        <span class="s1">x = np.arange(</span><span class="s4">9 </span><span class="s1">* </span><span class="s4">8</span><span class="s1">).reshape(</span><span class="s4">9</span><span class="s3">, </span><span class="s4">8</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.ma.median(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">np.median(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">))</span>
        <span class="s1">assert_equal(np.ma.median(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">np.median(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">))</span>
        <span class="s1">assert_(np.ma.median(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">) </span><span class="s3">is not </span><span class="s1">MaskedArray)</span>
        <span class="s0"># float</span>
        <span class="s1">x = np.arange(</span><span class="s4">9 </span><span class="s1">* </span><span class="s4">8.</span><span class="s1">).reshape(</span><span class="s4">9</span><span class="s3">, </span><span class="s4">8</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.ma.median(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">np.median(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">))</span>
        <span class="s1">assert_equal(np.ma.median(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">np.median(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">))</span>
        <span class="s1">assert_(np.ma.median(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">) </span><span class="s3">is not </span><span class="s1">MaskedArray)</span>

    <span class="s3">def </span><span class="s1">test_docstring_examples(self):</span>
        <span class="s2">&quot;test the examples given in the docstring of ma.median&quot;</span>
        <span class="s1">x = array(np.arange(</span><span class="s4">8</span><span class="s1">)</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s1">]*</span><span class="s4">4 </span><span class="s1">+ [</span><span class="s4">1</span><span class="s1">]*</span><span class="s4">4</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.ma.median(x)</span><span class="s3">, </span><span class="s4">1.5</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.ma.median(x).shape</span><span class="s3">, </span><span class="s1">()</span><span class="s3">, </span><span class="s5">&quot;shape mismatch&quot;</span><span class="s1">)</span>
        <span class="s1">assert_(type(np.ma.median(x)) </span><span class="s3">is not </span><span class="s1">MaskedArray)</span>
        <span class="s1">x = array(np.arange(</span><span class="s4">10</span><span class="s1">).reshape(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">5</span><span class="s1">)</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s1">]*</span><span class="s4">6 </span><span class="s1">+ [</span><span class="s4">1</span><span class="s1">]*</span><span class="s4">4</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.ma.median(x)</span><span class="s3">, </span><span class="s4">2.5</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.ma.median(x).shape</span><span class="s3">, </span><span class="s1">()</span><span class="s3">, </span><span class="s5">&quot;shape mismatch&quot;</span><span class="s1">)</span>
        <span class="s1">assert_(type(np.ma.median(x)) </span><span class="s3">is not </span><span class="s1">MaskedArray)</span>
        <span class="s1">ma_x = np.ma.median(x</span><span class="s3">, </span><span class="s1">axis=-</span><span class="s4">1</span><span class="s3">, </span><span class="s1">overwrite_input=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(ma_x</span><span class="s3">, </span><span class="s1">[</span><span class="s4">2.</span><span class="s3">, </span><span class="s4">5.</span><span class="s1">])</span>
        <span class="s1">assert_equal(ma_x.shape</span><span class="s3">, </span><span class="s1">(</span><span class="s4">2</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s5">&quot;shape mismatch&quot;</span><span class="s1">)</span>
        <span class="s1">assert_(type(ma_x) </span><span class="s3">is </span><span class="s1">MaskedArray)</span>

    <span class="s3">def </span><span class="s1">test_axis_argument_errors(self):</span>
        <span class="s1">msg = </span><span class="s5">&quot;mask = %s, ndim = %s, axis = %s, overwrite_input = %s&quot;</span>
        <span class="s3">for </span><span class="s1">ndmin </span><span class="s3">in </span><span class="s1">range(</span><span class="s4">5</span><span class="s1">):</span>
            <span class="s3">for </span><span class="s1">mask </span><span class="s3">in </span><span class="s1">[</span><span class="s3">False, True</span><span class="s1">]:</span>
                <span class="s1">x = array(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">ndmin=ndmin</span><span class="s3">, </span><span class="s1">mask=mask)</span>

                <span class="s0"># Valid axis values should not raise exception</span>
                <span class="s1">args = itertools.product(range(-ndmin</span><span class="s3">, </span><span class="s1">ndmin)</span><span class="s3">, </span><span class="s1">[</span><span class="s3">False, True</span><span class="s1">])</span>
                <span class="s3">for </span><span class="s1">axis</span><span class="s3">, </span><span class="s1">over </span><span class="s3">in </span><span class="s1">args:</span>
                    <span class="s3">try</span><span class="s1">:</span>
                        <span class="s1">np.ma.median(x</span><span class="s3">, </span><span class="s1">axis=axis</span><span class="s3">, </span><span class="s1">overwrite_input=over)</span>
                    <span class="s3">except </span><span class="s1">Exception:</span>
                        <span class="s3">raise </span><span class="s1">AssertionError(msg % (mask</span><span class="s3">, </span><span class="s1">ndmin</span><span class="s3">, </span><span class="s1">axis</span><span class="s3">, </span><span class="s1">over))</span>

                <span class="s0"># Invalid axis values should raise exception</span>
                <span class="s1">args = itertools.product([-(ndmin + </span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">ndmin]</span><span class="s3">, </span><span class="s1">[</span><span class="s3">False, True</span><span class="s1">])</span>
                <span class="s3">for </span><span class="s1">axis</span><span class="s3">, </span><span class="s1">over </span><span class="s3">in </span><span class="s1">args:</span>
                    <span class="s3">try</span><span class="s1">:</span>
                        <span class="s1">np.ma.median(x</span><span class="s3">, </span><span class="s1">axis=axis</span><span class="s3">, </span><span class="s1">overwrite_input=over)</span>
                    <span class="s3">except </span><span class="s1">np.AxisError:</span>
                        <span class="s3">pass</span>
                    <span class="s3">else</span><span class="s1">:</span>
                        <span class="s3">raise </span><span class="s1">AssertionError(msg % (mask</span><span class="s3">, </span><span class="s1">ndmin</span><span class="s3">, </span><span class="s1">axis</span><span class="s3">, </span><span class="s1">over))</span>

    <span class="s3">def </span><span class="s1">test_masked_0d(self):</span>
        <span class="s0"># Check values</span>
        <span class="s1">x = array(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">mask=</span><span class="s3">False</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.ma.median(x)</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">x = array(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">mask=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.ma.median(x)</span><span class="s3">, </span><span class="s1">np.ma.masked)</span>

    <span class="s3">def </span><span class="s1">test_masked_1d(self):</span>
        <span class="s1">x = array(np.arange(</span><span class="s4">5</span><span class="s1">)</span><span class="s3">, </span><span class="s1">mask=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.ma.median(x)</span><span class="s3">, </span><span class="s1">np.ma.masked)</span>
        <span class="s1">assert_equal(np.ma.median(x).shape</span><span class="s3">, </span><span class="s1">()</span><span class="s3">, </span><span class="s5">&quot;shape mismatch&quot;</span><span class="s1">)</span>
        <span class="s1">assert_(type(np.ma.median(x)) </span><span class="s3">is </span><span class="s1">np.ma.core.MaskedConstant)</span>
        <span class="s1">x = array(np.arange(</span><span class="s4">5</span><span class="s1">)</span><span class="s3">, </span><span class="s1">mask=</span><span class="s3">False</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.ma.median(x)</span><span class="s3">, </span><span class="s4">2.</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.ma.median(x).shape</span><span class="s3">, </span><span class="s1">()</span><span class="s3">, </span><span class="s5">&quot;shape mismatch&quot;</span><span class="s1">)</span>
        <span class="s1">assert_(type(np.ma.median(x)) </span><span class="s3">is not </span><span class="s1">MaskedArray)</span>
        <span class="s1">x = array(np.arange(</span><span class="s4">5</span><span class="s1">)</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">assert_equal(np.ma.median(x)</span><span class="s3">, </span><span class="s4">2.5</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.ma.median(x).shape</span><span class="s3">, </span><span class="s1">()</span><span class="s3">, </span><span class="s5">&quot;shape mismatch&quot;</span><span class="s1">)</span>
        <span class="s1">assert_(type(np.ma.median(x)) </span><span class="s3">is not </span><span class="s1">MaskedArray)</span>
        <span class="s1">x = array(np.arange(</span><span class="s4">5</span><span class="s1">)</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(np.ma.median(x)</span><span class="s3">, </span><span class="s4">0.</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.ma.median(x).shape</span><span class="s3">, </span><span class="s1">()</span><span class="s3">, </span><span class="s5">&quot;shape mismatch&quot;</span><span class="s1">)</span>
        <span class="s1">assert_(type(np.ma.median(x)) </span><span class="s3">is not </span><span class="s1">MaskedArray)</span>
        <span class="s0"># integer</span>
        <span class="s1">x = array(np.arange(</span><span class="s4">5</span><span class="s1">)</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">assert_equal(np.ma.median(x)</span><span class="s3">, </span><span class="s4">3.</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.ma.median(x).shape</span><span class="s3">, </span><span class="s1">()</span><span class="s3">, </span><span class="s5">&quot;shape mismatch&quot;</span><span class="s1">)</span>
        <span class="s1">assert_(type(np.ma.median(x)) </span><span class="s3">is not </span><span class="s1">MaskedArray)</span>
        <span class="s0"># float</span>
        <span class="s1">x = array(np.arange(</span><span class="s4">5.</span><span class="s1">)</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">assert_equal(np.ma.median(x)</span><span class="s3">, </span><span class="s4">3.</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.ma.median(x).shape</span><span class="s3">, </span><span class="s1">()</span><span class="s3">, </span><span class="s5">&quot;shape mismatch&quot;</span><span class="s1">)</span>
        <span class="s1">assert_(type(np.ma.median(x)) </span><span class="s3">is not </span><span class="s1">MaskedArray)</span>
        <span class="s0"># integer</span>
        <span class="s1">x = array(np.arange(</span><span class="s4">6</span><span class="s1">)</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">assert_equal(np.ma.median(x)</span><span class="s3">, </span><span class="s4">2.5</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.ma.median(x).shape</span><span class="s3">, </span><span class="s1">()</span><span class="s3">, </span><span class="s5">&quot;shape mismatch&quot;</span><span class="s1">)</span>
        <span class="s1">assert_(type(np.ma.median(x)) </span><span class="s3">is not </span><span class="s1">MaskedArray)</span>
        <span class="s0"># float</span>
        <span class="s1">x = array(np.arange(</span><span class="s4">6.</span><span class="s1">)</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">assert_equal(np.ma.median(x)</span><span class="s3">, </span><span class="s4">2.5</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.ma.median(x).shape</span><span class="s3">, </span><span class="s1">()</span><span class="s3">, </span><span class="s5">&quot;shape mismatch&quot;</span><span class="s1">)</span>
        <span class="s1">assert_(type(np.ma.median(x)) </span><span class="s3">is not </span><span class="s1">MaskedArray)</span>

    <span class="s3">def </span><span class="s1">test_1d_shape_consistency(self):</span>
        <span class="s1">assert_equal(np.ma.median(array([</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s1">]</span><span class="s3">,</span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s1">])).shape</span><span class="s3">,</span>
                     <span class="s1">np.ma.median(array([</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s1">]</span><span class="s3">,</span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">0</span><span class="s1">])).shape )</span>

    <span class="s3">def </span><span class="s1">test_2d(self):</span>
        <span class="s0"># Tests median w/ 2D</span>
        <span class="s1">(n</span><span class="s3">, </span><span class="s1">p) = (</span><span class="s4">101</span><span class="s3">, </span><span class="s4">30</span><span class="s1">)</span>
        <span class="s1">x = masked_array(np.linspace(-</span><span class="s4">1.</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">, </span><span class="s1">n)</span><span class="s3">,</span><span class="s1">)</span>
        <span class="s1">x[:</span><span class="s4">10</span><span class="s1">] = x[-</span><span class="s4">10</span><span class="s1">:] = masked</span>
        <span class="s1">z = masked_array(np.empty((n</span><span class="s3">, </span><span class="s1">p)</span><span class="s3">, </span><span class="s1">dtype=float))</span>
        <span class="s1">z[:</span><span class="s3">, </span><span class="s4">0</span><span class="s1">] = x[:]</span>
        <span class="s1">idx = np.arange(len(x))</span>
        <span class="s3">for </span><span class="s1">i </span><span class="s3">in </span><span class="s1">range(</span><span class="s4">1</span><span class="s3">, </span><span class="s1">p):</span>
            <span class="s1">np.random.shuffle(idx)</span>
            <span class="s1">z[:</span><span class="s3">, </span><span class="s1">i] = x[idx]</span>
        <span class="s1">assert_equal(median(z[:</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_equal(median(z)</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_equal(median(z</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">np.zeros(p))</span>
        <span class="s1">assert_equal(median(z.T</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">np.zeros(p))</span>

    <span class="s3">def </span><span class="s1">test_2d_waxis(self):</span>
        <span class="s0"># Tests median w/ 2D arrays and different axis.</span>
        <span class="s1">x = masked_array(np.arange(</span><span class="s4">30</span><span class="s1">).reshape(</span><span class="s4">10</span><span class="s3">, </span><span class="s4">3</span><span class="s1">))</span>
        <span class="s1">x[:</span><span class="s4">3</span><span class="s1">] = x[-</span><span class="s4">3</span><span class="s1">:] = masked</span>
        <span class="s1">assert_equal(median(x)</span><span class="s3">, </span><span class="s4">14.5</span><span class="s1">)</span>
        <span class="s1">assert_(type(np.ma.median(x)) </span><span class="s3">is not </span><span class="s1">MaskedArray)</span>
        <span class="s1">assert_equal(median(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[</span><span class="s4">13.5</span><span class="s3">, </span><span class="s4">14.5</span><span class="s3">, </span><span class="s4">15.5</span><span class="s1">])</span>
        <span class="s1">assert_(type(np.ma.median(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)) </span><span class="s3">is </span><span class="s1">MaskedArray)</span>
        <span class="s1">assert_equal(median(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, </span><span class="s4">13</span><span class="s3">, </span><span class="s4">16</span><span class="s3">, </span><span class="s4">19</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">assert_(type(np.ma.median(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)) </span><span class="s3">is </span><span class="s1">MaskedArray)</span>
        <span class="s1">assert_equal(median(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">).mask</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_3d(self):</span>
        <span class="s0"># Tests median w/ 3D</span>
        <span class="s1">x = np.ma.arange(</span><span class="s4">24</span><span class="s1">).reshape(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">x[x % </span><span class="s4">3 </span><span class="s1">== </span><span class="s4">0</span><span class="s1">] = masked</span>
        <span class="s1">assert_equal(median(x</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">12</span><span class="s3">, </span><span class="s4">9</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">6</span><span class="s3">, </span><span class="s4">15</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">12</span><span class="s3">, </span><span class="s4">9</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">18</span><span class="s3">, </span><span class="s4">15</span><span class="s1">]])</span>
        <span class="s1">x.shape = (</span><span class="s4">4</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">assert_equal(median(x</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">99</span><span class="s3">, </span><span class="s4">10</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">11</span><span class="s3">, </span><span class="s4">99</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">13</span><span class="s3">, </span><span class="s4">14</span><span class="s1">]])</span>
        <span class="s1">x = np.ma.arange(</span><span class="s4">24</span><span class="s1">).reshape(</span><span class="s4">4</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">x[x % </span><span class="s4">5 </span><span class="s1">== </span><span class="s4">0</span><span class="s1">] = masked</span>
        <span class="s1">assert_equal(median(x</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[[</span><span class="s4">12</span><span class="s3">, </span><span class="s4">10</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">8</span><span class="s3">, </span><span class="s4">9</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">16</span><span class="s3">, </span><span class="s4">17</span><span class="s1">]])</span>

    <span class="s3">def </span><span class="s1">test_neg_axis(self):</span>
        <span class="s1">x = masked_array(np.arange(</span><span class="s4">30</span><span class="s1">).reshape(</span><span class="s4">10</span><span class="s3">, </span><span class="s4">3</span><span class="s1">))</span>
        <span class="s1">x[:</span><span class="s4">3</span><span class="s1">] = x[-</span><span class="s4">3</span><span class="s1">:] = masked</span>
        <span class="s1">assert_equal(median(x</span><span class="s3">, </span><span class="s1">axis=-</span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">median(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">))</span>

    <span class="s3">def </span><span class="s1">test_out_1d(self):</span>
        <span class="s0"># integer float even odd</span>
        <span class="s3">for </span><span class="s1">v </span><span class="s3">in </span><span class="s1">(</span><span class="s4">30</span><span class="s3">, </span><span class="s4">30.</span><span class="s3">, </span><span class="s4">31</span><span class="s3">, </span><span class="s4">31.</span><span class="s1">):</span>
            <span class="s1">x = masked_array(np.arange(v))</span>
            <span class="s1">x[:</span><span class="s4">3</span><span class="s1">] = x[-</span><span class="s4">3</span><span class="s1">:] = masked</span>
            <span class="s1">out = masked_array(np.ones(()))</span>
            <span class="s1">r = median(x</span><span class="s3">, </span><span class="s1">out=out)</span>
            <span class="s3">if </span><span class="s1">v == </span><span class="s4">30</span><span class="s1">:</span>
                <span class="s1">assert_equal(out</span><span class="s3">, </span><span class="s4">14.5</span><span class="s1">)</span>
            <span class="s3">else</span><span class="s1">:</span>
                <span class="s1">assert_equal(out</span><span class="s3">, </span><span class="s4">15.</span><span class="s1">)</span>
            <span class="s1">assert_(r </span><span class="s3">is </span><span class="s1">out)</span>
            <span class="s1">assert_(type(r) </span><span class="s3">is </span><span class="s1">MaskedArray)</span>

    <span class="s3">def </span><span class="s1">test_out(self):</span>
        <span class="s0"># integer float even odd</span>
        <span class="s3">for </span><span class="s1">v </span><span class="s3">in </span><span class="s1">(</span><span class="s4">40</span><span class="s3">, </span><span class="s4">40.</span><span class="s3">, </span><span class="s4">30</span><span class="s3">, </span><span class="s4">30.</span><span class="s1">):</span>
            <span class="s1">x = masked_array(np.arange(v).reshape(</span><span class="s4">10</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">))</span>
            <span class="s1">x[:</span><span class="s4">3</span><span class="s1">] = x[-</span><span class="s4">3</span><span class="s1">:] = masked</span>
            <span class="s1">out = masked_array(np.ones(</span><span class="s4">10</span><span class="s1">))</span>
            <span class="s1">r = median(x</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">out=out)</span>
            <span class="s3">if </span><span class="s1">v == </span><span class="s4">30</span><span class="s1">:</span>
                <span class="s1">e = masked_array([</span><span class="s4">0.</span><span class="s1">]*</span><span class="s4">3 </span><span class="s1">+ [</span><span class="s4">10</span><span class="s3">, </span><span class="s4">13</span><span class="s3">, </span><span class="s4">16</span><span class="s3">, </span><span class="s4">19</span><span class="s1">] + [</span><span class="s4">0.</span><span class="s1">]*</span><span class="s4">3</span><span class="s3">,</span>
                                 <span class="s1">mask=[</span><span class="s3">True</span><span class="s1">] * </span><span class="s4">3 </span><span class="s1">+ [</span><span class="s3">False</span><span class="s1">] * </span><span class="s4">4 </span><span class="s1">+ [</span><span class="s3">True</span><span class="s1">] * </span><span class="s4">3</span><span class="s1">)</span>
            <span class="s3">else</span><span class="s1">:</span>
                <span class="s1">e = masked_array([</span><span class="s4">0.</span><span class="s1">]*</span><span class="s4">3 </span><span class="s1">+ [</span><span class="s4">13.5</span><span class="s3">, </span><span class="s4">17.5</span><span class="s3">, </span><span class="s4">21.5</span><span class="s3">, </span><span class="s4">25.5</span><span class="s1">] + [</span><span class="s4">0.</span><span class="s1">]*</span><span class="s4">3</span><span class="s3">,</span>
                                 <span class="s1">mask=[</span><span class="s3">True</span><span class="s1">]*</span><span class="s4">3 </span><span class="s1">+ [</span><span class="s3">False</span><span class="s1">]*</span><span class="s4">4 </span><span class="s1">+ [</span><span class="s3">True</span><span class="s1">]*</span><span class="s4">3</span><span class="s1">)</span>
            <span class="s1">assert_equal(r</span><span class="s3">, </span><span class="s1">e)</span>
            <span class="s1">assert_(r </span><span class="s3">is </span><span class="s1">out)</span>
            <span class="s1">assert_(type(r) </span><span class="s3">is </span><span class="s1">MaskedArray)</span>

    <span class="s3">def </span><span class="s1">test_single_non_masked_value_on_axis(self):</span>
        <span class="s1">data = [[</span><span class="s4">1.</span><span class="s3">, </span><span class="s4">0.</span><span class="s1">]</span><span class="s3">,</span>
                <span class="s1">[</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">3.</span><span class="s1">]</span><span class="s3">,</span>
                <span class="s1">[</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s1">]]</span>
        <span class="s1">masked_arr = np.ma.masked_equal(data</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">expected = [</span><span class="s4">1.</span><span class="s3">, </span><span class="s4">3.</span><span class="s1">]</span>
        <span class="s1">assert_array_equal(np.ma.median(masked_arr</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">,</span>
                           <span class="s1">expected)</span>

    <span class="s3">def </span><span class="s1">test_nan(self):</span>
        <span class="s3">for </span><span class="s1">mask </span><span class="s3">in </span><span class="s1">(</span><span class="s3">False, </span><span class="s1">np.zeros(</span><span class="s4">6</span><span class="s3">, </span><span class="s1">dtype=bool)):</span>
            <span class="s1">dm = np.ma.array([[</span><span class="s4">1</span><span class="s3">, </span><span class="s1">np.nan</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]])</span>
            <span class="s1">dm.mask = mask</span>

            <span class="s0"># scalar result</span>
            <span class="s1">r = np.ma.median(dm</span><span class="s3">, </span><span class="s1">axis=</span><span class="s3">None</span><span class="s1">)</span>
            <span class="s1">assert_(np.isscalar(r))</span>
            <span class="s1">assert_array_equal(r</span><span class="s3">, </span><span class="s1">np.nan)</span>
            <span class="s1">r = np.ma.median(dm.ravel()</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
            <span class="s1">assert_(np.isscalar(r))</span>
            <span class="s1">assert_array_equal(r</span><span class="s3">, </span><span class="s1">np.nan)</span>

            <span class="s1">r = np.ma.median(dm</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
            <span class="s1">assert_equal(type(r)</span><span class="s3">, </span><span class="s1">MaskedArray)</span>
            <span class="s1">assert_array_equal(r</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s1">np.nan</span><span class="s3">, </span><span class="s4">3</span><span class="s1">])</span>
            <span class="s1">r = np.ma.median(dm</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
            <span class="s1">assert_equal(type(r)</span><span class="s3">, </span><span class="s1">MaskedArray)</span>
            <span class="s1">assert_array_equal(r</span><span class="s3">, </span><span class="s1">[np.nan</span><span class="s3">, </span><span class="s4">2</span><span class="s1">])</span>
            <span class="s1">r = np.ma.median(dm</span><span class="s3">, </span><span class="s1">axis=-</span><span class="s4">1</span><span class="s1">)</span>
            <span class="s1">assert_equal(type(r)</span><span class="s3">, </span><span class="s1">MaskedArray)</span>
            <span class="s1">assert_array_equal(r</span><span class="s3">, </span><span class="s1">[np.nan</span><span class="s3">, </span><span class="s4">2</span><span class="s1">])</span>

        <span class="s1">dm = np.ma.array([[</span><span class="s4">1</span><span class="s3">, </span><span class="s1">np.nan</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]])</span>
        <span class="s1">dm[:</span><span class="s3">, </span><span class="s4">2</span><span class="s1">] = np.ma.masked</span>
        <span class="s1">assert_array_equal(np.ma.median(dm</span><span class="s3">, </span><span class="s1">axis=</span><span class="s3">None</span><span class="s1">)</span><span class="s3">, </span><span class="s1">np.nan)</span>
        <span class="s1">assert_array_equal(np.ma.median(dm</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s1">np.nan</span><span class="s3">, </span><span class="s4">3</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(np.ma.median(dm</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[np.nan</span><span class="s3">, </span><span class="s4">1.5</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_out_nan(self):</span>
        <span class="s1">o = np.ma.masked_array(np.zeros((</span><span class="s4">4</span><span class="s3">,</span><span class="s1">)))</span>
        <span class="s1">d = np.ma.masked_array(np.ones((</span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)))</span>
        <span class="s1">d[</span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s1">] = np.nan</span>
        <span class="s1">d[</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s1">] = np.ma.masked</span>
        <span class="s1">assert_equal(np.ma.median(d</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s1">out=o)</span><span class="s3">, </span><span class="s1">o)</span>
        <span class="s1">o = np.ma.masked_array(np.zeros((</span><span class="s4">3</span><span class="s3">,</span><span class="s1">)))</span>
        <span class="s1">assert_equal(np.ma.median(d</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s1">out=o)</span><span class="s3">, </span><span class="s1">o)</span>
        <span class="s1">o = np.ma.masked_array(np.zeros(()))</span>
        <span class="s1">assert_equal(np.ma.median(d</span><span class="s3">, </span><span class="s1">out=o)</span><span class="s3">, </span><span class="s1">o)</span>

    <span class="s3">def </span><span class="s1">test_nan_behavior(self):</span>
        <span class="s1">a = np.ma.masked_array(np.arange(</span><span class="s4">24</span><span class="s3">, </span><span class="s1">dtype=float))</span>
        <span class="s1">a[::</span><span class="s4">3</span><span class="s1">] = np.ma.masked</span>
        <span class="s1">a[</span><span class="s4">2</span><span class="s1">] = np.nan</span>
        <span class="s1">assert_array_equal(np.ma.median(a)</span><span class="s3">, </span><span class="s1">np.nan)</span>
        <span class="s1">assert_array_equal(np.ma.median(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">np.nan)</span>

        <span class="s1">a = np.ma.masked_array(np.arange(</span><span class="s4">24</span><span class="s3">, </span><span class="s1">dtype=float).reshape(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">))</span>
        <span class="s1">a.mask = np.arange(a.size) % </span><span class="s4">2 </span><span class="s1">== </span><span class="s4">1</span>
        <span class="s1">aorig = a.copy()</span>
        <span class="s1">a[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">] = np.nan</span>
        <span class="s1">a[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s1">] = np.nan</span>

        <span class="s0"># no axis</span>
        <span class="s1">assert_array_equal(np.ma.median(a)</span><span class="s3">, </span><span class="s1">np.nan)</span>
        <span class="s1">assert_(np.isscalar(np.ma.median(a)))</span>

        <span class="s0"># axis0</span>
        <span class="s1">b = np.ma.median(aorig</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">b[</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">] = np.nan</span>
        <span class="s1">b[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s1">] = np.nan</span>
        <span class="s1">assert_equal(np.ma.median(a</span><span class="s3">, </span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">b)</span>

        <span class="s0"># axis1</span>
        <span class="s1">b = np.ma.median(aorig</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">b[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">3</span><span class="s1">] = np.nan</span>
        <span class="s1">b[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s1">] = np.nan</span>
        <span class="s1">assert_equal(np.ma.median(a</span><span class="s3">, </span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">b)</span>

        <span class="s0"># axis02</span>
        <span class="s1">b = np.ma.median(aorig</span><span class="s3">, </span><span class="s1">axis=(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s1">))</span>
        <span class="s1">b[</span><span class="s4">1</span><span class="s1">] = np.nan</span>
        <span class="s1">b[</span><span class="s4">2</span><span class="s1">] = np.nan</span>
        <span class="s1">assert_equal(np.ma.median(a</span><span class="s3">, </span><span class="s1">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s1">))</span><span class="s3">, </span><span class="s1">b)</span>

    <span class="s3">def </span><span class="s1">test_ambigous_fill(self):</span>
        <span class="s0"># 255 is max value, used as filler for sort</span>
        <span class="s1">a = np.array([[</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">255</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">255</span><span class="s1">]]</span><span class="s3">, </span><span class="s1">dtype=np.uint8)</span>
        <span class="s1">a = np.ma.masked_array(a</span><span class="s3">, </span><span class="s1">mask=a == </span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(np.ma.median(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s4">255</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(np.ma.median(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">).mask</span><span class="s3">, False</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(np.ma.median(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">a[</span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(np.ma.median(a)</span><span class="s3">, </span><span class="s4">255</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_special(self):</span>
        <span class="s3">for </span><span class="s1">inf </span><span class="s3">in </span><span class="s1">[np.inf</span><span class="s3">, </span><span class="s1">-np.inf]:</span>
            <span class="s1">a = np.array([[inf</span><span class="s3">,  </span><span class="s1">np.nan]</span><span class="s3">, </span><span class="s1">[np.nan</span><span class="s3">, </span><span class="s1">np.nan]])</span>
            <span class="s1">a = np.ma.masked_array(a</span><span class="s3">, </span><span class="s1">mask=np.isnan(a))</span>
            <span class="s1">assert_equal(np.ma.median(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[inf</span><span class="s3">,  </span><span class="s1">np.nan])</span>
            <span class="s1">assert_equal(np.ma.median(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[inf</span><span class="s3">,  </span><span class="s1">np.nan])</span>
            <span class="s1">assert_equal(np.ma.median(a)</span><span class="s3">, </span><span class="s1">inf)</span>

            <span class="s1">a = np.array([[np.nan</span><span class="s3">, </span><span class="s1">np.nan</span><span class="s3">, </span><span class="s1">inf]</span><span class="s3">, </span><span class="s1">[np.nan</span><span class="s3">, </span><span class="s1">np.nan</span><span class="s3">, </span><span class="s1">inf]])</span>
            <span class="s1">a = np.ma.masked_array(a</span><span class="s3">, </span><span class="s1">mask=np.isnan(a))</span>
            <span class="s1">assert_array_equal(np.ma.median(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">inf)</span>
            <span class="s1">assert_array_equal(np.ma.median(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">).mask</span><span class="s3">, False</span><span class="s1">)</span>
            <span class="s1">assert_array_equal(np.ma.median(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">a[</span><span class="s4">0</span><span class="s1">])</span>
            <span class="s1">assert_array_equal(np.ma.median(a)</span><span class="s3">, </span><span class="s1">inf)</span>

            <span class="s0"># no mask</span>
            <span class="s1">a = np.array([[inf</span><span class="s3">, </span><span class="s1">inf]</span><span class="s3">, </span><span class="s1">[inf</span><span class="s3">, </span><span class="s1">inf]])</span>
            <span class="s1">assert_equal(np.ma.median(a)</span><span class="s3">, </span><span class="s1">inf)</span>
            <span class="s1">assert_equal(np.ma.median(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">inf)</span>
            <span class="s1">assert_equal(np.ma.median(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">inf)</span>

            <span class="s1">a = np.array([[inf</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s1">-inf</span><span class="s3">, </span><span class="s1">-</span><span class="s4">9</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[-</span><span class="s4">10</span><span class="s3">, </span><span class="s1">np.nan</span><span class="s3">, </span><span class="s1">np.nan</span><span class="s3">, </span><span class="s4">5</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">4</span><span class="s3">, </span><span class="s1">np.nan</span><span class="s3">, </span><span class="s1">np.nan</span><span class="s3">, </span><span class="s1">inf]]</span><span class="s3">,</span>
                          <span class="s1">dtype=np.float32)</span>
            <span class="s1">a = np.ma.masked_array(a</span><span class="s3">, </span><span class="s1">mask=np.isnan(a))</span>
            <span class="s3">if </span><span class="s1">inf &gt; </span><span class="s4">0</span><span class="s1">:</span>
                <span class="s1">assert_equal(np.ma.median(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[</span><span class="s4">4.</span><span class="s3">, </span><span class="s4">7.</span><span class="s3">, </span><span class="s1">-inf</span><span class="s3">, </span><span class="s4">5.</span><span class="s1">])</span>
                <span class="s1">assert_equal(np.ma.median(a)</span><span class="s3">, </span><span class="s4">4.5</span><span class="s1">)</span>
            <span class="s3">else</span><span class="s1">:</span>
                <span class="s1">assert_equal(np.ma.median(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[-</span><span class="s4">10.</span><span class="s3">, </span><span class="s4">7.</span><span class="s3">, </span><span class="s1">-inf</span><span class="s3">, </span><span class="s1">-</span><span class="s4">9.</span><span class="s1">])</span>
                <span class="s1">assert_equal(np.ma.median(a)</span><span class="s3">, </span><span class="s1">-</span><span class="s4">2.5</span><span class="s1">)</span>
            <span class="s1">assert_equal(np.ma.median(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">[-</span><span class="s4">1.</span><span class="s3">, </span><span class="s1">-</span><span class="s4">2.5</span><span class="s3">, </span><span class="s1">inf])</span>

            <span class="s3">for </span><span class="s1">i </span><span class="s3">in </span><span class="s1">range(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">10</span><span class="s1">):</span>
                <span class="s3">for </span><span class="s1">j </span><span class="s3">in </span><span class="s1">range(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">10</span><span class="s1">):</span>
                    <span class="s1">a = np.array([([np.nan] * i) + ([inf] * j)] * </span><span class="s4">2</span><span class="s1">)</span>
                    <span class="s1">a = np.ma.masked_array(a</span><span class="s3">, </span><span class="s1">mask=np.isnan(a))</span>
                    <span class="s1">assert_equal(np.ma.median(a)</span><span class="s3">, </span><span class="s1">inf)</span>
                    <span class="s1">assert_equal(np.ma.median(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">inf)</span>
                    <span class="s1">assert_equal(np.ma.median(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">,</span>
                                 <span class="s1">([np.nan] * i) + [inf] * j)</span>

    <span class="s3">def </span><span class="s1">test_empty(self):</span>
        <span class="s0"># empty arrays</span>
        <span class="s1">a = np.ma.masked_array(np.array([]</span><span class="s3">, </span><span class="s1">dtype=float))</span>
        <span class="s3">with </span><span class="s1">suppress_warnings() </span><span class="s3">as </span><span class="s1">w:</span>
            <span class="s1">w.record(RuntimeWarning)</span>
            <span class="s1">assert_array_equal(np.ma.median(a)</span><span class="s3">, </span><span class="s1">np.nan)</span>
            <span class="s1">assert_(w.log[</span><span class="s4">0</span><span class="s1">].category </span><span class="s3">is </span><span class="s1">RuntimeWarning)</span>

        <span class="s0"># multiple dimensions</span>
        <span class="s1">a = np.ma.masked_array(np.array([]</span><span class="s3">, </span><span class="s1">dtype=float</span><span class="s3">, </span><span class="s1">ndmin=</span><span class="s4">3</span><span class="s1">))</span>
        <span class="s0"># no axis</span>
        <span class="s3">with </span><span class="s1">suppress_warnings() </span><span class="s3">as </span><span class="s1">w:</span>
            <span class="s1">w.record(RuntimeWarning)</span>
            <span class="s1">warnings.filterwarnings(</span><span class="s5">'always'</span><span class="s3">, </span><span class="s5">''</span><span class="s3">, </span><span class="s1">RuntimeWarning)</span>
            <span class="s1">assert_array_equal(np.ma.median(a)</span><span class="s3">, </span><span class="s1">np.nan)</span>
            <span class="s1">assert_(w.log[</span><span class="s4">0</span><span class="s1">].category </span><span class="s3">is </span><span class="s1">RuntimeWarning)</span>

        <span class="s0"># axis 0 and 1</span>
        <span class="s1">b = np.ma.masked_array(np.array([]</span><span class="s3">, </span><span class="s1">dtype=float</span><span class="s3">, </span><span class="s1">ndmin=</span><span class="s4">2</span><span class="s1">))</span>
        <span class="s1">assert_equal(np.ma.median(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">b)</span>
        <span class="s1">assert_equal(np.ma.median(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">b)</span>

        <span class="s0"># axis 2</span>
        <span class="s1">b = np.ma.masked_array(np.array(np.nan</span><span class="s3">, </span><span class="s1">dtype=float</span><span class="s3">, </span><span class="s1">ndmin=</span><span class="s4">2</span><span class="s1">))</span>
        <span class="s3">with </span><span class="s1">warnings.catch_warnings(record=</span><span class="s3">True</span><span class="s1">) </span><span class="s3">as </span><span class="s1">w:</span>
            <span class="s1">warnings.filterwarnings(</span><span class="s5">'always'</span><span class="s3">, </span><span class="s5">''</span><span class="s3">, </span><span class="s1">RuntimeWarning)</span>
            <span class="s1">assert_equal(np.ma.median(a</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">2</span><span class="s1">)</span><span class="s3">, </span><span class="s1">b)</span>
            <span class="s1">assert_(w[</span><span class="s4">0</span><span class="s1">].category </span><span class="s3">is </span><span class="s1">RuntimeWarning)</span>

    <span class="s3">def </span><span class="s1">test_object(self):</span>
        <span class="s1">o = np.ma.masked_array(np.arange(</span><span class="s4">7.</span><span class="s1">))</span>
        <span class="s1">assert_(type(np.ma.median(o.astype(object)))</span><span class="s3">, </span><span class="s1">float)</span>
        <span class="s1">o[</span><span class="s4">2</span><span class="s1">] = np.nan</span>
        <span class="s1">assert_(type(np.ma.median(o.astype(object)))</span><span class="s3">, </span><span class="s1">float)</span>


<span class="s3">class </span><span class="s1">TestCov:</span>

    <span class="s3">def </span><span class="s1">setup(self):</span>
        <span class="s1">self.data = array(np.random.rand(</span><span class="s4">12</span><span class="s1">))</span>

    <span class="s3">def </span><span class="s1">test_1d_without_missing(self):</span>
        <span class="s0"># Test cov on 1D variable w/o missing values</span>
        <span class="s1">x = self.data</span>
        <span class="s1">assert_almost_equal(np.cov(x)</span><span class="s3">, </span><span class="s1">cov(x))</span>
        <span class="s1">assert_almost_equal(np.cov(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False</span><span class="s1">)</span><span class="s3">, </span><span class="s1">cov(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False</span><span class="s1">))</span>
        <span class="s1">assert_almost_equal(np.cov(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False, </span><span class="s1">bias=</span><span class="s3">True</span><span class="s1">)</span><span class="s3">,</span>
                            <span class="s1">cov(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False, </span><span class="s1">bias=</span><span class="s3">True</span><span class="s1">))</span>

    <span class="s3">def </span><span class="s1">test_2d_without_missing(self):</span>
        <span class="s0"># Test cov on 1 2D variable w/o missing values</span>
        <span class="s1">x = self.data.reshape(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(np.cov(x)</span><span class="s3">, </span><span class="s1">cov(x))</span>
        <span class="s1">assert_almost_equal(np.cov(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False</span><span class="s1">)</span><span class="s3">, </span><span class="s1">cov(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False</span><span class="s1">))</span>
        <span class="s1">assert_almost_equal(np.cov(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False, </span><span class="s1">bias=</span><span class="s3">True</span><span class="s1">)</span><span class="s3">,</span>
                            <span class="s1">cov(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False, </span><span class="s1">bias=</span><span class="s3">True</span><span class="s1">))</span>

    <span class="s3">def </span><span class="s1">test_1d_with_missing(self):</span>
        <span class="s0"># Test cov 1 1D variable w/missing values</span>
        <span class="s1">x = self.data</span>
        <span class="s1">x[-</span><span class="s4">1</span><span class="s1">] = masked</span>
        <span class="s1">x -= x.mean()</span>
        <span class="s1">nx = x.compressed()</span>
        <span class="s1">assert_almost_equal(np.cov(nx)</span><span class="s3">, </span><span class="s1">cov(x))</span>
        <span class="s1">assert_almost_equal(np.cov(nx</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False</span><span class="s1">)</span><span class="s3">, </span><span class="s1">cov(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False</span><span class="s1">))</span>
        <span class="s1">assert_almost_equal(np.cov(nx</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False, </span><span class="s1">bias=</span><span class="s3">True</span><span class="s1">)</span><span class="s3">,</span>
                            <span class="s1">cov(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False, </span><span class="s1">bias=</span><span class="s3">True</span><span class="s1">))</span>
        <span class="s0">#</span>
        <span class="s3">try</span><span class="s1">:</span>
            <span class="s1">cov(x</span><span class="s3">, </span><span class="s1">allow_masked=</span><span class="s3">False</span><span class="s1">)</span>
        <span class="s3">except </span><span class="s1">ValueError:</span>
            <span class="s3">pass</span>
        <span class="s0">#</span>
        <span class="s0"># 2 1D variables w/ missing values</span>
        <span class="s1">nx = x[</span><span class="s4">1</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">assert_almost_equal(np.cov(nx</span><span class="s3">, </span><span class="s1">nx[::-</span><span class="s4">1</span><span class="s1">])</span><span class="s3">, </span><span class="s1">cov(x</span><span class="s3">, </span><span class="s1">x[::-</span><span class="s4">1</span><span class="s1">]))</span>
        <span class="s1">assert_almost_equal(np.cov(nx</span><span class="s3">, </span><span class="s1">nx[::-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False</span><span class="s1">)</span><span class="s3">,</span>
                            <span class="s1">cov(x</span><span class="s3">, </span><span class="s1">x[::-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False</span><span class="s1">))</span>
        <span class="s1">assert_almost_equal(np.cov(nx</span><span class="s3">, </span><span class="s1">nx[::-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False, </span><span class="s1">bias=</span><span class="s3">True</span><span class="s1">)</span><span class="s3">,</span>
                            <span class="s1">cov(x</span><span class="s3">, </span><span class="s1">x[::-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False, </span><span class="s1">bias=</span><span class="s3">True</span><span class="s1">))</span>

    <span class="s3">def </span><span class="s1">test_2d_with_missing(self):</span>
        <span class="s0"># Test cov on 2D variable w/ missing value</span>
        <span class="s1">x = self.data</span>
        <span class="s1">x[-</span><span class="s4">1</span><span class="s1">] = masked</span>
        <span class="s1">x = x.reshape(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)</span>
        <span class="s1">valid = np.logical_not(getmaskarray(x)).astype(int)</span>
        <span class="s1">frac = np.dot(valid</span><span class="s3">, </span><span class="s1">valid.T)</span>
        <span class="s1">xf = (x - x.mean(</span><span class="s4">1</span><span class="s1">)[:</span><span class="s3">, None</span><span class="s1">]).filled(</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(cov(x)</span><span class="s3">,</span>
                            <span class="s1">np.cov(xf) * (x.shape[</span><span class="s4">1</span><span class="s1">] - </span><span class="s4">1</span><span class="s1">) / (frac - </span><span class="s4">1.</span><span class="s1">))</span>
        <span class="s1">assert_almost_equal(cov(x</span><span class="s3">, </span><span class="s1">bias=</span><span class="s3">True</span><span class="s1">)</span><span class="s3">,</span>
                            <span class="s1">np.cov(xf</span><span class="s3">, </span><span class="s1">bias=</span><span class="s3">True</span><span class="s1">) * x.shape[</span><span class="s4">1</span><span class="s1">] / frac)</span>
        <span class="s1">frac = np.dot(valid.T</span><span class="s3">, </span><span class="s1">valid)</span>
        <span class="s1">xf = (x - x.mean(</span><span class="s4">0</span><span class="s1">)).filled(</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(cov(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False</span><span class="s1">)</span><span class="s3">,</span>
                            <span class="s1">(np.cov(xf</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False</span><span class="s1">) *</span>
                             <span class="s1">(x.shape[</span><span class="s4">0</span><span class="s1">] - </span><span class="s4">1</span><span class="s1">) / (frac - </span><span class="s4">1.</span><span class="s1">)))</span>
        <span class="s1">assert_almost_equal(cov(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False, </span><span class="s1">bias=</span><span class="s3">True</span><span class="s1">)</span><span class="s3">,</span>
                            <span class="s1">(np.cov(xf</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False, </span><span class="s1">bias=</span><span class="s3">True</span><span class="s1">) *</span>
                             <span class="s1">x.shape[</span><span class="s4">0</span><span class="s1">] / frac))</span>


<span class="s3">class </span><span class="s1">TestCorrcoef:</span>

    <span class="s3">def </span><span class="s1">setup(self):</span>
        <span class="s1">self.data = array(np.random.rand(</span><span class="s4">12</span><span class="s1">))</span>
        <span class="s1">self.data2 = array(np.random.rand(</span><span class="s4">12</span><span class="s1">))</span>

    <span class="s3">def </span><span class="s1">test_ddof(self):</span>
        <span class="s0"># ddof raises DeprecationWarning</span>
        <span class="s1">x</span><span class="s3">, </span><span class="s1">y = self.data</span><span class="s3">, </span><span class="s1">self.data2</span>
        <span class="s1">expected = np.corrcoef(x)</span>
        <span class="s1">expected2 = np.corrcoef(x</span><span class="s3">, </span><span class="s1">y)</span>
        <span class="s3">with </span><span class="s1">suppress_warnings() </span><span class="s3">as </span><span class="s1">sup:</span>
            <span class="s1">warnings.simplefilter(</span><span class="s5">&quot;always&quot;</span><span class="s1">)</span>
            <span class="s1">assert_warns(DeprecationWarning</span><span class="s3">, </span><span class="s1">corrcoef</span><span class="s3">, </span><span class="s1">x</span><span class="s3">, </span><span class="s1">ddof=-</span><span class="s4">1</span><span class="s1">)</span>
            <span class="s1">sup.filter(DeprecationWarning</span><span class="s3">, </span><span class="s5">&quot;bias and ddof have no effect&quot;</span><span class="s1">)</span>
            <span class="s0"># ddof has no or negligible effect on the function</span>
            <span class="s1">assert_almost_equal(np.corrcoef(x</span><span class="s3">, </span><span class="s1">ddof=</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">corrcoef(x</span><span class="s3">, </span><span class="s1">ddof=</span><span class="s4">0</span><span class="s1">))</span>
            <span class="s1">assert_almost_equal(corrcoef(x</span><span class="s3">, </span><span class="s1">ddof=-</span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">expected)</span>
            <span class="s1">assert_almost_equal(corrcoef(x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">ddof=-</span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">expected2)</span>
            <span class="s1">assert_almost_equal(corrcoef(x</span><span class="s3">, </span><span class="s1">ddof=</span><span class="s4">3</span><span class="s1">)</span><span class="s3">, </span><span class="s1">expected)</span>
            <span class="s1">assert_almost_equal(corrcoef(x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">ddof=</span><span class="s4">3</span><span class="s1">)</span><span class="s3">, </span><span class="s1">expected2)</span>

    <span class="s3">def </span><span class="s1">test_bias(self):</span>
        <span class="s1">x</span><span class="s3">, </span><span class="s1">y = self.data</span><span class="s3">, </span><span class="s1">self.data2</span>
        <span class="s1">expected = np.corrcoef(x)</span>
        <span class="s0"># bias raises DeprecationWarning</span>
        <span class="s3">with </span><span class="s1">suppress_warnings() </span><span class="s3">as </span><span class="s1">sup:</span>
            <span class="s1">warnings.simplefilter(</span><span class="s5">&quot;always&quot;</span><span class="s1">)</span>
            <span class="s1">assert_warns(DeprecationWarning</span><span class="s3">, </span><span class="s1">corrcoef</span><span class="s3">, </span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, True, False</span><span class="s1">)</span>
            <span class="s1">assert_warns(DeprecationWarning</span><span class="s3">, </span><span class="s1">corrcoef</span><span class="s3">, </span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, True, True</span><span class="s1">)</span>
            <span class="s1">assert_warns(DeprecationWarning</span><span class="s3">, </span><span class="s1">corrcoef</span><span class="s3">, </span><span class="s1">x</span><span class="s3">, </span><span class="s1">bias=</span><span class="s3">False</span><span class="s1">)</span>
            <span class="s1">sup.filter(DeprecationWarning</span><span class="s3">, </span><span class="s5">&quot;bias and ddof have no effect&quot;</span><span class="s1">)</span>
            <span class="s0"># bias has no or negligible effect on the function</span>
            <span class="s1">assert_almost_equal(corrcoef(x</span><span class="s3">, </span><span class="s1">bias=</span><span class="s4">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">expected)</span>

    <span class="s3">def </span><span class="s1">test_1d_without_missing(self):</span>
        <span class="s0"># Test cov on 1D variable w/o missing values</span>
        <span class="s1">x = self.data</span>
        <span class="s1">assert_almost_equal(np.corrcoef(x)</span><span class="s3">, </span><span class="s1">corrcoef(x))</span>
        <span class="s1">assert_almost_equal(np.corrcoef(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False</span><span class="s1">)</span><span class="s3">,</span>
                            <span class="s1">corrcoef(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False</span><span class="s1">))</span>
        <span class="s3">with </span><span class="s1">suppress_warnings() </span><span class="s3">as </span><span class="s1">sup:</span>
            <span class="s1">sup.filter(DeprecationWarning</span><span class="s3">, </span><span class="s5">&quot;bias and ddof have no effect&quot;</span><span class="s1">)</span>
            <span class="s1">assert_almost_equal(np.corrcoef(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False, </span><span class="s1">bias=</span><span class="s3">True</span><span class="s1">)</span><span class="s3">,</span>
                                <span class="s1">corrcoef(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False, </span><span class="s1">bias=</span><span class="s3">True</span><span class="s1">))</span>

    <span class="s3">def </span><span class="s1">test_2d_without_missing(self):</span>
        <span class="s0"># Test corrcoef on 1 2D variable w/o missing values</span>
        <span class="s1">x = self.data.reshape(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(np.corrcoef(x)</span><span class="s3">, </span><span class="s1">corrcoef(x))</span>
        <span class="s1">assert_almost_equal(np.corrcoef(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False</span><span class="s1">)</span><span class="s3">,</span>
                            <span class="s1">corrcoef(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False</span><span class="s1">))</span>
        <span class="s3">with </span><span class="s1">suppress_warnings() </span><span class="s3">as </span><span class="s1">sup:</span>
            <span class="s1">sup.filter(DeprecationWarning</span><span class="s3">, </span><span class="s5">&quot;bias and ddof have no effect&quot;</span><span class="s1">)</span>
            <span class="s1">assert_almost_equal(np.corrcoef(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False, </span><span class="s1">bias=</span><span class="s3">True</span><span class="s1">)</span><span class="s3">,</span>
                                <span class="s1">corrcoef(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False, </span><span class="s1">bias=</span><span class="s3">True</span><span class="s1">))</span>

    <span class="s3">def </span><span class="s1">test_1d_with_missing(self):</span>
        <span class="s0"># Test corrcoef 1 1D variable w/missing values</span>
        <span class="s1">x = self.data</span>
        <span class="s1">x[-</span><span class="s4">1</span><span class="s1">] = masked</span>
        <span class="s1">x -= x.mean()</span>
        <span class="s1">nx = x.compressed()</span>
        <span class="s1">assert_almost_equal(np.corrcoef(nx)</span><span class="s3">, </span><span class="s1">corrcoef(x))</span>
        <span class="s1">assert_almost_equal(np.corrcoef(nx</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False</span><span class="s1">)</span><span class="s3">,</span>
                            <span class="s1">corrcoef(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False</span><span class="s1">))</span>
        <span class="s3">with </span><span class="s1">suppress_warnings() </span><span class="s3">as </span><span class="s1">sup:</span>
            <span class="s1">sup.filter(DeprecationWarning</span><span class="s3">, </span><span class="s5">&quot;bias and ddof have no effect&quot;</span><span class="s1">)</span>
            <span class="s1">assert_almost_equal(np.corrcoef(nx</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False, </span><span class="s1">bias=</span><span class="s3">True</span><span class="s1">)</span><span class="s3">,</span>
                                <span class="s1">corrcoef(x</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False, </span><span class="s1">bias=</span><span class="s3">True</span><span class="s1">))</span>
        <span class="s3">try</span><span class="s1">:</span>
            <span class="s1">corrcoef(x</span><span class="s3">, </span><span class="s1">allow_masked=</span><span class="s3">False</span><span class="s1">)</span>
        <span class="s3">except </span><span class="s1">ValueError:</span>
            <span class="s3">pass</span>
        <span class="s0"># 2 1D variables w/ missing values</span>
        <span class="s1">nx = x[</span><span class="s4">1</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">assert_almost_equal(np.corrcoef(nx</span><span class="s3">, </span><span class="s1">nx[::-</span><span class="s4">1</span><span class="s1">])</span><span class="s3">, </span><span class="s1">corrcoef(x</span><span class="s3">, </span><span class="s1">x[::-</span><span class="s4">1</span><span class="s1">]))</span>
        <span class="s1">assert_almost_equal(np.corrcoef(nx</span><span class="s3">, </span><span class="s1">nx[::-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False</span><span class="s1">)</span><span class="s3">,</span>
                            <span class="s1">corrcoef(x</span><span class="s3">, </span><span class="s1">x[::-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">rowvar=</span><span class="s3">False</span><span class="s1">))</span>
        <span class="s3">with </span><span class="s1">suppress_warnings() </span><span class="s3">as </span><span class="s1">sup:</span>
            <span class="s1">sup.filter(DeprecationWarning</span><span class="s3">, </span><span class="s5">&quot;bias and ddof have no effect&quot;</span><span class="s1">)</span>
            <span class="s0"># ddof and bias have no or negligible effect on the function</span>
            <span class="s1">assert_almost_equal(np.corrcoef(nx</span><span class="s3">, </span><span class="s1">nx[::-</span><span class="s4">1</span><span class="s1">])</span><span class="s3">,</span>
                                <span class="s1">corrcoef(x</span><span class="s3">, </span><span class="s1">x[::-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">bias=</span><span class="s4">1</span><span class="s1">))</span>
            <span class="s1">assert_almost_equal(np.corrcoef(nx</span><span class="s3">, </span><span class="s1">nx[::-</span><span class="s4">1</span><span class="s1">])</span><span class="s3">,</span>
                                <span class="s1">corrcoef(x</span><span class="s3">, </span><span class="s1">x[::-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">ddof=</span><span class="s4">2</span><span class="s1">))</span>

    <span class="s3">def </span><span class="s1">test_2d_with_missing(self):</span>
        <span class="s0"># Test corrcoef on 2D variable w/ missing value</span>
        <span class="s1">x = self.data</span>
        <span class="s1">x[-</span><span class="s4">1</span><span class="s1">] = masked</span>
        <span class="s1">x = x.reshape(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)</span>

        <span class="s1">test = corrcoef(x)</span>
        <span class="s1">control = np.corrcoef(x)</span>
        <span class="s1">assert_almost_equal(test[:-</span><span class="s4">1</span><span class="s3">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">control[:-</span><span class="s4">1</span><span class="s3">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>
        <span class="s3">with </span><span class="s1">suppress_warnings() </span><span class="s3">as </span><span class="s1">sup:</span>
            <span class="s1">sup.filter(DeprecationWarning</span><span class="s3">, </span><span class="s5">&quot;bias and ddof have no effect&quot;</span><span class="s1">)</span>
            <span class="s0"># ddof and bias have no or negligible effect on the function</span>
            <span class="s1">assert_almost_equal(corrcoef(x</span><span class="s3">, </span><span class="s1">ddof=-</span><span class="s4">2</span><span class="s1">)[:-</span><span class="s4">1</span><span class="s3">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">,</span>
                                <span class="s1">control[:-</span><span class="s4">1</span><span class="s3">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>
            <span class="s1">assert_almost_equal(corrcoef(x</span><span class="s3">, </span><span class="s1">ddof=</span><span class="s4">3</span><span class="s1">)[:-</span><span class="s4">1</span><span class="s3">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">,</span>
                                <span class="s1">control[:-</span><span class="s4">1</span><span class="s3">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>
            <span class="s1">assert_almost_equal(corrcoef(x</span><span class="s3">, </span><span class="s1">bias=</span><span class="s4">1</span><span class="s1">)[:-</span><span class="s4">1</span><span class="s3">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">,</span>
                                <span class="s1">control[:-</span><span class="s4">1</span><span class="s3">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>


<span class="s3">class </span><span class="s1">TestPolynomial:</span>
    <span class="s0">#</span>
    <span class="s3">def </span><span class="s1">test_polyfit(self):</span>
        <span class="s0"># Tests polyfit</span>
        <span class="s0"># On ndarrays</span>
        <span class="s1">x = np.random.rand(</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">y = np.random.rand(</span><span class="s4">20</span><span class="s1">).reshape(-</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(polyfit(x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s4">3</span><span class="s1">)</span><span class="s3">, </span><span class="s1">np.polyfit(x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s4">3</span><span class="s1">))</span>
        <span class="s0"># ON 1D maskedarrays</span>
        <span class="s1">x = x.view(MaskedArray)</span>
        <span class="s1">x[</span><span class="s4">0</span><span class="s1">] = masked</span>
        <span class="s1">y = y.view(MaskedArray)</span>
        <span class="s1">y[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">] = y[-</span><span class="s4">1</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">] = masked</span>
        <span class="s0">#</span>
        <span class="s1">(C</span><span class="s3">, </span><span class="s1">R</span><span class="s3">, </span><span class="s1">K</span><span class="s3">, </span><span class="s1">S</span><span class="s3">, </span><span class="s1">D) = polyfit(x</span><span class="s3">, </span><span class="s1">y[:</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s1">full=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">(c</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, </span><span class="s1">k</span><span class="s3">, </span><span class="s1">s</span><span class="s3">, </span><span class="s1">d) = np.polyfit(x[</span><span class="s4">1</span><span class="s1">:]</span><span class="s3">, </span><span class="s1">y[</span><span class="s4">1</span><span class="s1">:</span><span class="s3">, </span><span class="s4">0</span><span class="s1">].compressed()</span><span class="s3">, </span><span class="s4">3</span><span class="s3">,</span>
                                     <span class="s1">full=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s3">for </span><span class="s1">(a</span><span class="s3">, </span><span class="s1">a_) </span><span class="s3">in </span><span class="s1">zip((C</span><span class="s3">, </span><span class="s1">R</span><span class="s3">, </span><span class="s1">K</span><span class="s3">, </span><span class="s1">S</span><span class="s3">, </span><span class="s1">D)</span><span class="s3">, </span><span class="s1">(c</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, </span><span class="s1">k</span><span class="s3">, </span><span class="s1">s</span><span class="s3">, </span><span class="s1">d)):</span>
            <span class="s1">assert_almost_equal(a</span><span class="s3">, </span><span class="s1">a_)</span>
        <span class="s0">#</span>
        <span class="s1">(C</span><span class="s3">, </span><span class="s1">R</span><span class="s3">, </span><span class="s1">K</span><span class="s3">, </span><span class="s1">S</span><span class="s3">, </span><span class="s1">D) = polyfit(x</span><span class="s3">, </span><span class="s1">y[:</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s1">full=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">(c</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, </span><span class="s1">k</span><span class="s3">, </span><span class="s1">s</span><span class="s3">, </span><span class="s1">d) = np.polyfit(x[</span><span class="s4">1</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">y[</span><span class="s4">1</span><span class="s1">:-</span><span class="s4">1</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s1">full=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s3">for </span><span class="s1">(a</span><span class="s3">, </span><span class="s1">a_) </span><span class="s3">in </span><span class="s1">zip((C</span><span class="s3">, </span><span class="s1">R</span><span class="s3">, </span><span class="s1">K</span><span class="s3">, </span><span class="s1">S</span><span class="s3">, </span><span class="s1">D)</span><span class="s3">, </span><span class="s1">(c</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, </span><span class="s1">k</span><span class="s3">, </span><span class="s1">s</span><span class="s3">, </span><span class="s1">d)):</span>
            <span class="s1">assert_almost_equal(a</span><span class="s3">, </span><span class="s1">a_)</span>
        <span class="s0">#</span>
        <span class="s1">(C</span><span class="s3">, </span><span class="s1">R</span><span class="s3">, </span><span class="s1">K</span><span class="s3">, </span><span class="s1">S</span><span class="s3">, </span><span class="s1">D) = polyfit(x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s1">full=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">(c</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, </span><span class="s1">k</span><span class="s3">, </span><span class="s1">s</span><span class="s3">, </span><span class="s1">d) = np.polyfit(x[</span><span class="s4">1</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">y[</span><span class="s4">1</span><span class="s1">:-</span><span class="s4">1</span><span class="s3">,</span><span class="s1">:]</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s1">full=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s3">for </span><span class="s1">(a</span><span class="s3">, </span><span class="s1">a_) </span><span class="s3">in </span><span class="s1">zip((C</span><span class="s3">, </span><span class="s1">R</span><span class="s3">, </span><span class="s1">K</span><span class="s3">, </span><span class="s1">S</span><span class="s3">, </span><span class="s1">D)</span><span class="s3">, </span><span class="s1">(c</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, </span><span class="s1">k</span><span class="s3">, </span><span class="s1">s</span><span class="s3">, </span><span class="s1">d)):</span>
            <span class="s1">assert_almost_equal(a</span><span class="s3">, </span><span class="s1">a_)</span>
        <span class="s0">#</span>
        <span class="s1">w = np.random.rand(</span><span class="s4">10</span><span class="s1">) + </span><span class="s4">1</span>
        <span class="s1">wo = w.copy()</span>
        <span class="s1">xs = x[</span><span class="s4">1</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">ys = y[</span><span class="s4">1</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">ws = w[</span><span class="s4">1</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">(C</span><span class="s3">, </span><span class="s1">R</span><span class="s3">, </span><span class="s1">K</span><span class="s3">, </span><span class="s1">S</span><span class="s3">, </span><span class="s1">D) = polyfit(x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s1">full=</span><span class="s3">True, </span><span class="s1">w=w)</span>
        <span class="s1">(c</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, </span><span class="s1">k</span><span class="s3">, </span><span class="s1">s</span><span class="s3">, </span><span class="s1">d) = np.polyfit(xs</span><span class="s3">, </span><span class="s1">ys</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s1">full=</span><span class="s3">True, </span><span class="s1">w=ws)</span>
        <span class="s1">assert_equal(w</span><span class="s3">, </span><span class="s1">wo)</span>
        <span class="s3">for </span><span class="s1">(a</span><span class="s3">, </span><span class="s1">a_) </span><span class="s3">in </span><span class="s1">zip((C</span><span class="s3">, </span><span class="s1">R</span><span class="s3">, </span><span class="s1">K</span><span class="s3">, </span><span class="s1">S</span><span class="s3">, </span><span class="s1">D)</span><span class="s3">, </span><span class="s1">(c</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, </span><span class="s1">k</span><span class="s3">, </span><span class="s1">s</span><span class="s3">, </span><span class="s1">d)):</span>
            <span class="s1">assert_almost_equal(a</span><span class="s3">, </span><span class="s1">a_)</span>

    <span class="s3">def </span><span class="s1">test_polyfit_with_masked_NaNs(self):</span>
        <span class="s1">x = np.random.rand(</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">y = np.random.rand(</span><span class="s4">20</span><span class="s1">).reshape(-</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s1">)</span>

        <span class="s1">x[</span><span class="s4">0</span><span class="s1">] = np.nan</span>
        <span class="s1">y[-</span><span class="s4">1</span><span class="s3">,</span><span class="s1">-</span><span class="s4">1</span><span class="s1">] = np.nan</span>
        <span class="s1">x = x.view(MaskedArray)</span>
        <span class="s1">y = y.view(MaskedArray)</span>
        <span class="s1">x[</span><span class="s4">0</span><span class="s1">] = masked</span>
        <span class="s1">y[-</span><span class="s4">1</span><span class="s3">,</span><span class="s1">-</span><span class="s4">1</span><span class="s1">] = masked</span>

        <span class="s1">(C</span><span class="s3">, </span><span class="s1">R</span><span class="s3">, </span><span class="s1">K</span><span class="s3">, </span><span class="s1">S</span><span class="s3">, </span><span class="s1">D) = polyfit(x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s1">full=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">(c</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, </span><span class="s1">k</span><span class="s3">, </span><span class="s1">s</span><span class="s3">, </span><span class="s1">d) = np.polyfit(x[</span><span class="s4">1</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">y[</span><span class="s4">1</span><span class="s1">:-</span><span class="s4">1</span><span class="s3">,</span><span class="s1">:]</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s1">full=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s3">for </span><span class="s1">(a</span><span class="s3">, </span><span class="s1">a_) </span><span class="s3">in </span><span class="s1">zip((C</span><span class="s3">, </span><span class="s1">R</span><span class="s3">, </span><span class="s1">K</span><span class="s3">, </span><span class="s1">S</span><span class="s3">, </span><span class="s1">D)</span><span class="s3">, </span><span class="s1">(c</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, </span><span class="s1">k</span><span class="s3">, </span><span class="s1">s</span><span class="s3">, </span><span class="s1">d)):</span>
            <span class="s1">assert_almost_equal(a</span><span class="s3">, </span><span class="s1">a_)</span>


<span class="s3">class </span><span class="s1">TestArraySetOps:</span>

    <span class="s3">def </span><span class="s1">test_unique_onlist(self):</span>
        <span class="s0"># Test unique on list</span>
        <span class="s1">data = [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span>
        <span class="s1">test = unique(data</span><span class="s3">, </span><span class="s1">return_index=</span><span class="s3">True, </span><span class="s1">return_inverse=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_(isinstance(test[</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">MaskedArray))</span>
        <span class="s1">assert_equal(test[</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">masked_array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]))</span>
        <span class="s1">assert_equal(test[</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">5</span><span class="s1">])</span>
        <span class="s1">assert_equal(test[</span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_unique_onmaskedarray(self):</span>
        <span class="s0"># Test unique on masked data w/use_mask=True</span>
        <span class="s1">data = masked_array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">test = unique(data</span><span class="s3">, </span><span class="s1">return_index=</span><span class="s3">True, </span><span class="s1">return_inverse=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(test[</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">masked_array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]))</span>
        <span class="s1">assert_equal(test[</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">2</span><span class="s1">])</span>
        <span class="s1">assert_equal(test[</span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s1">])</span>
        <span class="s0">#</span>
        <span class="s1">data.fill_value = </span><span class="s4">3</span>
        <span class="s1">data = masked_array(data=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span><span class="s3">,</span>
                            <span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">fill_value=</span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">test = unique(data</span><span class="s3">, </span><span class="s1">return_index=</span><span class="s3">True, </span><span class="s1">return_inverse=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(test[</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">masked_array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]))</span>
        <span class="s1">assert_equal(test[</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">2</span><span class="s1">])</span>
        <span class="s1">assert_equal(test[</span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_unique_allmasked(self):</span>
        <span class="s0"># Test all masked</span>
        <span class="s1">data = masked_array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">test = unique(data</span><span class="s3">, </span><span class="s1">return_index=</span><span class="s3">True, </span><span class="s1">return_inverse=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(test[</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">masked_array([</span><span class="s4">1</span><span class="s3">, </span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s3">True</span><span class="s1">]))</span>
        <span class="s1">assert_equal(test[</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">assert_equal(test[</span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s0">#</span>
        <span class="s0"># Test masked</span>
        <span class="s1">data = masked</span>
        <span class="s1">test = unique(data</span><span class="s3">, </span><span class="s1">return_index=</span><span class="s3">True, </span><span class="s1">return_inverse=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(test[</span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">masked_array(masked))</span>
        <span class="s1">assert_equal(test[</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">assert_equal(test[</span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_ediff1d(self):</span>
        <span class="s0"># Tests mediff1d</span>
        <span class="s1">x = masked_array(np.arange(</span><span class="s4">5</span><span class="s1">)</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">control = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">4</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">test = ediff1d(x)</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">control)</span>
        <span class="s1">assert_equal(test.filled(</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">control.filled(</span><span class="s4">0</span><span class="s1">))</span>
        <span class="s1">assert_equal(test.mask</span><span class="s3">, </span><span class="s1">control.mask)</span>

    <span class="s3">def </span><span class="s1">test_ediff1d_tobegin(self):</span>
        <span class="s0"># Test ediff1d w/ to_begin</span>
        <span class="s1">x = masked_array(np.arange(</span><span class="s4">5</span><span class="s1">)</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">test = ediff1d(x</span><span class="s3">, </span><span class="s1">to_begin=masked)</span>
        <span class="s1">control = array([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">4</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">control)</span>
        <span class="s1">assert_equal(test.filled(</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">control.filled(</span><span class="s4">0</span><span class="s1">))</span>
        <span class="s1">assert_equal(test.mask</span><span class="s3">, </span><span class="s1">control.mask)</span>
        <span class="s0">#</span>
        <span class="s1">test = ediff1d(x</span><span class="s3">, </span><span class="s1">to_begin=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">])</span>
        <span class="s1">control = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">4</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">control)</span>
        <span class="s1">assert_equal(test.filled(</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">control.filled(</span><span class="s4">0</span><span class="s1">))</span>
        <span class="s1">assert_equal(test.mask</span><span class="s3">, </span><span class="s1">control.mask)</span>

    <span class="s3">def </span><span class="s1">test_ediff1d_toend(self):</span>
        <span class="s0"># Test ediff1d w/ to_end</span>
        <span class="s1">x = masked_array(np.arange(</span><span class="s4">5</span><span class="s1">)</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">test = ediff1d(x</span><span class="s3">, </span><span class="s1">to_end=masked)</span>
        <span class="s1">control = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">control)</span>
        <span class="s1">assert_equal(test.filled(</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">control.filled(</span><span class="s4">0</span><span class="s1">))</span>
        <span class="s1">assert_equal(test.mask</span><span class="s3">, </span><span class="s1">control.mask)</span>
        <span class="s0">#</span>
        <span class="s1">test = ediff1d(x</span><span class="s3">, </span><span class="s1">to_end=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">])</span>
        <span class="s1">control = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">control)</span>
        <span class="s1">assert_equal(test.filled(</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">control.filled(</span><span class="s4">0</span><span class="s1">))</span>
        <span class="s1">assert_equal(test.mask</span><span class="s3">, </span><span class="s1">control.mask)</span>

    <span class="s3">def </span><span class="s1">test_ediff1d_tobegin_toend(self):</span>
        <span class="s0"># Test ediff1d w/ to_begin and to_end</span>
        <span class="s1">x = masked_array(np.arange(</span><span class="s4">5</span><span class="s1">)</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">test = ediff1d(x</span><span class="s3">, </span><span class="s1">to_end=masked</span><span class="s3">, </span><span class="s1">to_begin=masked)</span>
        <span class="s1">control = array([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">control)</span>
        <span class="s1">assert_equal(test.filled(</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">control.filled(</span><span class="s4">0</span><span class="s1">))</span>
        <span class="s1">assert_equal(test.mask</span><span class="s3">, </span><span class="s1">control.mask)</span>
        <span class="s0">#</span>
        <span class="s1">test = ediff1d(x</span><span class="s3">, </span><span class="s1">to_end=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">to_begin=masked)</span>
        <span class="s1">control = array([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span><span class="s3">,</span>
                        <span class="s1">mask=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">control)</span>
        <span class="s1">assert_equal(test.filled(</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">control.filled(</span><span class="s4">0</span><span class="s1">))</span>
        <span class="s1">assert_equal(test.mask</span><span class="s3">, </span><span class="s1">control.mask)</span>

    <span class="s3">def </span><span class="s1">test_ediff1d_ndarray(self):</span>
        <span class="s0"># Test ediff1d w/ a ndarray</span>
        <span class="s1">x = np.arange(</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">test = ediff1d(x)</span>
        <span class="s1">control = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">control)</span>
        <span class="s1">assert_(isinstance(test</span><span class="s3">, </span><span class="s1">MaskedArray))</span>
        <span class="s1">assert_equal(test.filled(</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">control.filled(</span><span class="s4">0</span><span class="s1">))</span>
        <span class="s1">assert_equal(test.mask</span><span class="s3">, </span><span class="s1">control.mask)</span>
        <span class="s0">#</span>
        <span class="s1">test = ediff1d(x</span><span class="s3">, </span><span class="s1">to_end=masked</span><span class="s3">, </span><span class="s1">to_begin=masked)</span>
        <span class="s1">control = array([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_(isinstance(test</span><span class="s3">, </span><span class="s1">MaskedArray))</span>
        <span class="s1">assert_equal(test.filled(</span><span class="s4">0</span><span class="s1">)</span><span class="s3">, </span><span class="s1">control.filled(</span><span class="s4">0</span><span class="s1">))</span>
        <span class="s1">assert_equal(test.mask</span><span class="s3">, </span><span class="s1">control.mask)</span>

    <span class="s3">def </span><span class="s1">test_intersect1d(self):</span>
        <span class="s0"># Test intersect1d</span>
        <span class="s1">x = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">y = array([</span><span class="s4">3</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">test = intersect1d(x</span><span class="s3">, </span><span class="s1">y)</span>
        <span class="s1">control = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">control)</span>

    <span class="s3">def </span><span class="s1">test_setxor1d(self):</span>
        <span class="s0"># Test setxor1d</span>
        <span class="s1">a = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">b = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">test = setxor1d(a</span><span class="s3">, </span><span class="s1">b)</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">array([</span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">7</span><span class="s1">]))</span>
        <span class="s0">#</span>
        <span class="s1">a = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">b = [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s1">]</span>
        <span class="s1">test = setxor1d(a</span><span class="s3">, </span><span class="s1">b)</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">array([</span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]))</span>
        <span class="s0">#</span>
        <span class="s1">a = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">])</span>
        <span class="s1">b = array([</span><span class="s4">6</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">4</span><span class="s1">])</span>
        <span class="s1">test = setxor1d(a</span><span class="s3">, </span><span class="s1">b)</span>
        <span class="s1">assert_(isinstance(test</span><span class="s3">, </span><span class="s1">MaskedArray))</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">6</span><span class="s1">])</span>
        <span class="s0">#</span>
        <span class="s1">a = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">8</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">b = array([</span><span class="s4">6</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">8</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">test = setxor1d(a</span><span class="s3">, </span><span class="s1">b)</span>
        <span class="s1">assert_(isinstance(test</span><span class="s3">, </span><span class="s1">MaskedArray))</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">6</span><span class="s1">])</span>
        <span class="s0">#</span>
        <span class="s1">assert_array_equal([]</span><span class="s3">, </span><span class="s1">setxor1d([]</span><span class="s3">, </span><span class="s1">[]))</span>

    <span class="s3">def </span><span class="s1">test_isin(self):</span>
        <span class="s0"># the tests for in1d cover most of isin's behavior</span>
        <span class="s0"># if in1d is removed, would need to change those tests to test</span>
        <span class="s0"># isin instead.</span>
        <span class="s1">a = np.arange(</span><span class="s4">24</span><span class="s1">).reshape([</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">])</span>
        <span class="s1">mask = np.zeros([</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">])</span>
        <span class="s1">mask[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">0</span><span class="s1">] = </span><span class="s4">1</span>
        <span class="s1">a = array(a</span><span class="s3">, </span><span class="s1">mask=mask)</span>
        <span class="s1">b = array(data=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, </span><span class="s4">20</span><span class="s3">, </span><span class="s4">30</span><span class="s3">,  </span><span class="s4">1</span><span class="s3">,  </span><span class="s4">3</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">22</span><span class="s3">, </span><span class="s4">33</span><span class="s1">]</span><span class="s3">,</span>
                  <span class="s1">mask=[</span><span class="s4">0</span><span class="s3">,  </span><span class="s4">1</span><span class="s3">,  </span><span class="s4">0</span><span class="s3">,  </span><span class="s4">1</span><span class="s3">,  </span><span class="s4">0</span><span class="s3">,  </span><span class="s4">1</span><span class="s3">,  </span><span class="s4">0</span><span class="s3">,  </span><span class="s4">1</span><span class="s3">,  </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">ec = zeros((</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">)</span><span class="s3">, </span><span class="s1">dtype=bool)</span>
        <span class="s1">ec[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">] = </span><span class="s3">True</span>
        <span class="s1">ec[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">] = </span><span class="s3">True</span>
        <span class="s1">ec[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">] = </span><span class="s3">True</span>
        <span class="s1">c = isin(a</span><span class="s3">, </span><span class="s1">b)</span>
        <span class="s1">assert_(isinstance(c</span><span class="s3">, </span><span class="s1">MaskedArray))</span>
        <span class="s1">assert_array_equal(c</span><span class="s3">, </span><span class="s1">ec)</span>
        <span class="s0">#compare results of np.isin to ma.isin</span>
        <span class="s1">d = np.isin(a</span><span class="s3">, </span><span class="s1">b[~b.mask]) &amp; ~a.mask</span>
        <span class="s1">assert_array_equal(c</span><span class="s3">, </span><span class="s1">d)</span>

    <span class="s3">def </span><span class="s1">test_in1d(self):</span>
        <span class="s0"># Test in1d</span>
        <span class="s1">a = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">b = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">test = in1d(a</span><span class="s3">, </span><span class="s1">b)</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">[</span><span class="s3">True, True, True, False, True</span><span class="s1">])</span>
        <span class="s0">#</span>
        <span class="s1">a = array([</span><span class="s4">5</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">b = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">test = in1d(a</span><span class="s3">, </span><span class="s1">b)</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">[</span><span class="s3">True, True, False, True, True</span><span class="s1">])</span>
        <span class="s0">#</span>
        <span class="s1">assert_array_equal([]</span><span class="s3">, </span><span class="s1">in1d([]</span><span class="s3">, </span><span class="s1">[]))</span>

    <span class="s3">def </span><span class="s1">test_in1d_invert(self):</span>
        <span class="s0"># Test in1d's invert parameter</span>
        <span class="s1">a = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">b = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(np.invert(in1d(a</span><span class="s3">, </span><span class="s1">b))</span><span class="s3">, </span><span class="s1">in1d(a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">invert=</span><span class="s3">True</span><span class="s1">))</span>

        <span class="s1">a = array([</span><span class="s4">5</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">b = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(np.invert(in1d(a</span><span class="s3">, </span><span class="s1">b))</span><span class="s3">, </span><span class="s1">in1d(a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">invert=</span><span class="s3">True</span><span class="s1">))</span>

        <span class="s1">assert_array_equal([]</span><span class="s3">, </span><span class="s1">in1d([]</span><span class="s3">, </span><span class="s1">[]</span><span class="s3">, </span><span class="s1">invert=</span><span class="s3">True</span><span class="s1">))</span>

    <span class="s3">def </span><span class="s1">test_union1d(self):</span>
        <span class="s0"># Test union1d</span>
        <span class="s1">a = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">b = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">test = union1d(a</span><span class="s3">, </span><span class="s1">b)</span>
        <span class="s1">control = array([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">control)</span>

        <span class="s0"># Tests gh-10340, arguments to union1d should be</span>
        <span class="s0"># flattened if they are not already 1D</span>
        <span class="s1">x = array([[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s1">]]</span><span class="s3">, </span><span class="s1">mask=[[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]])</span>
        <span class="s1">y = array([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">ez = array([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">z = union1d(x</span><span class="s3">, </span><span class="s1">y)</span>
        <span class="s1">assert_equal(z</span><span class="s3">, </span><span class="s1">ez)</span>
        <span class="s0">#</span>
        <span class="s1">assert_array_equal([]</span><span class="s3">, </span><span class="s1">union1d([]</span><span class="s3">, </span><span class="s1">[]))</span>

    <span class="s3">def </span><span class="s1">test_setdiff1d(self):</span>
        <span class="s0"># Test setdiff1d</span>
        <span class="s1">a = array([</span><span class="s4">6</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">b = array([</span><span class="s4">2</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">5</span><span class="s1">])</span>
        <span class="s1">test = setdiff1d(a</span><span class="s3">, </span><span class="s1">b)</span>
        <span class="s1">assert_equal(test</span><span class="s3">, </span><span class="s1">array([</span><span class="s4">6</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s1">]))</span>
        <span class="s0">#</span>
        <span class="s1">a = arange(</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">b = arange(</span><span class="s4">8</span><span class="s1">)</span>
        <span class="s1">assert_equal(setdiff1d(a</span><span class="s3">, </span><span class="s1">b)</span><span class="s3">, </span><span class="s1">array([</span><span class="s4">8</span><span class="s3">, </span><span class="s4">9</span><span class="s1">]))</span>
        <span class="s1">a = array([]</span><span class="s3">, </span><span class="s1">np.uint32</span><span class="s3">, </span><span class="s1">mask=[])</span>
        <span class="s1">assert_equal(setdiff1d(a</span><span class="s3">, </span><span class="s1">[]).dtype</span><span class="s3">, </span><span class="s1">np.uint32)</span>

    <span class="s3">def </span><span class="s1">test_setdiff1d_char_array(self):</span>
        <span class="s0"># Test setdiff1d_charray</span>
        <span class="s1">a = np.array([</span><span class="s5">'a'</span><span class="s3">, </span><span class="s5">'b'</span><span class="s3">, </span><span class="s5">'c'</span><span class="s1">])</span>
        <span class="s1">b = np.array([</span><span class="s5">'a'</span><span class="s3">, </span><span class="s5">'b'</span><span class="s3">, </span><span class="s5">'s'</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(setdiff1d(a</span><span class="s3">, </span><span class="s1">b)</span><span class="s3">, </span><span class="s1">np.array([</span><span class="s5">'c'</span><span class="s1">]))</span>


<span class="s3">class </span><span class="s1">TestShapeBase:</span>

    <span class="s3">def </span><span class="s1">test_atleast_2d(self):</span>
        <span class="s0"># Test atleast_2d</span>
        <span class="s1">a = masked_array([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">b = atleast_2d(a)</span>
        <span class="s1">assert_equal(b.shape</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">3</span><span class="s1">))</span>
        <span class="s1">assert_equal(b.mask.shape</span><span class="s3">, </span><span class="s1">b.data.shape)</span>
        <span class="s1">assert_equal(a.shape</span><span class="s3">, </span><span class="s1">(</span><span class="s4">3</span><span class="s3">,</span><span class="s1">))</span>
        <span class="s1">assert_equal(a.mask.shape</span><span class="s3">, </span><span class="s1">a.data.shape)</span>
        <span class="s1">assert_equal(b.mask.shape</span><span class="s3">, </span><span class="s1">b.data.shape)</span>

    <span class="s3">def </span><span class="s1">test_shape_scalar(self):</span>
        <span class="s0"># the atleast and diagflat function should work with scalars</span>
        <span class="s0"># GitHub issue #3367</span>
        <span class="s0"># Additionally, the atleast functions should accept multiple scalars</span>
        <span class="s0"># correctly</span>
        <span class="s1">b = atleast_1d(</span><span class="s4">1.0</span><span class="s1">)</span>
        <span class="s1">assert_equal(b.shape</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">,</span><span class="s1">))</span>
        <span class="s1">assert_equal(b.mask.shape</span><span class="s3">, </span><span class="s1">b.shape)</span>
        <span class="s1">assert_equal(b.data.shape</span><span class="s3">, </span><span class="s1">b.shape)</span>

        <span class="s1">b = atleast_1d(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">2.0</span><span class="s1">)</span>
        <span class="s3">for </span><span class="s1">a </span><span class="s3">in </span><span class="s1">b:</span>
            <span class="s1">assert_equal(a.shape</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">,</span><span class="s1">))</span>
            <span class="s1">assert_equal(a.mask.shape</span><span class="s3">, </span><span class="s1">a.shape)</span>
            <span class="s1">assert_equal(a.data.shape</span><span class="s3">, </span><span class="s1">a.shape)</span>

        <span class="s1">b = atleast_2d(</span><span class="s4">1.0</span><span class="s1">)</span>
        <span class="s1">assert_equal(b.shape</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))</span>
        <span class="s1">assert_equal(b.mask.shape</span><span class="s3">, </span><span class="s1">b.shape)</span>
        <span class="s1">assert_equal(b.data.shape</span><span class="s3">, </span><span class="s1">b.shape)</span>

        <span class="s1">b = atleast_2d(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">2.0</span><span class="s1">)</span>
        <span class="s3">for </span><span class="s1">a </span><span class="s3">in </span><span class="s1">b:</span>
            <span class="s1">assert_equal(a.shape</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))</span>
            <span class="s1">assert_equal(a.mask.shape</span><span class="s3">, </span><span class="s1">a.shape)</span>
            <span class="s1">assert_equal(a.data.shape</span><span class="s3">, </span><span class="s1">a.shape)</span>

        <span class="s1">b = atleast_3d(</span><span class="s4">1.0</span><span class="s1">)</span>
        <span class="s1">assert_equal(b.shape</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))</span>
        <span class="s1">assert_equal(b.mask.shape</span><span class="s3">, </span><span class="s1">b.shape)</span>
        <span class="s1">assert_equal(b.data.shape</span><span class="s3">, </span><span class="s1">b.shape)</span>

        <span class="s1">b = atleast_3d(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">2.0</span><span class="s1">)</span>
        <span class="s3">for </span><span class="s1">a </span><span class="s3">in </span><span class="s1">b:</span>
            <span class="s1">assert_equal(a.shape</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))</span>
            <span class="s1">assert_equal(a.mask.shape</span><span class="s3">, </span><span class="s1">a.shape)</span>
            <span class="s1">assert_equal(a.data.shape</span><span class="s3">, </span><span class="s1">a.shape)</span>


        <span class="s1">b = diagflat(</span><span class="s4">1.0</span><span class="s1">)</span>
        <span class="s1">assert_equal(b.shape</span><span class="s3">, </span><span class="s1">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s1">))</span>
        <span class="s1">assert_equal(b.mask.shape</span><span class="s3">, </span><span class="s1">b.data.shape)</span>


<span class="s3">class </span><span class="s1">TestStack:</span>

    <span class="s3">def </span><span class="s1">test_stack_1d(self):</span>
        <span class="s1">a = masked_array([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">b = masked_array([</span><span class="s4">9</span><span class="s3">, </span><span class="s4">8</span><span class="s3">, </span><span class="s4">7</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s1">])</span>

        <span class="s1">c = stack([a</span><span class="s3">, </span><span class="s1">b]</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_equal(c.shape</span><span class="s3">, </span><span class="s1">(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(a.mask</span><span class="s3">, </span><span class="s1">c[</span><span class="s4">0</span><span class="s1">].mask)</span>
        <span class="s1">assert_array_equal(b.mask</span><span class="s3">, </span><span class="s1">c[</span><span class="s4">1</span><span class="s1">].mask)</span>

        <span class="s1">d = vstack([a</span><span class="s3">, </span><span class="s1">b])</span>
        <span class="s1">assert_array_equal(c.data</span><span class="s3">, </span><span class="s1">d.data)</span>
        <span class="s1">assert_array_equal(c.mask</span><span class="s3">, </span><span class="s1">d.mask)</span>

        <span class="s1">c = stack([a</span><span class="s3">, </span><span class="s1">b]</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(c.shape</span><span class="s3">, </span><span class="s1">(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(a.mask</span><span class="s3">, </span><span class="s1">c[:</span><span class="s3">, </span><span class="s4">0</span><span class="s1">].mask)</span>
        <span class="s1">assert_array_equal(b.mask</span><span class="s3">, </span><span class="s1">c[:</span><span class="s3">, </span><span class="s4">1</span><span class="s1">].mask)</span>

    <span class="s3">def </span><span class="s1">test_stack_masks(self):</span>
        <span class="s1">a = masked_array([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">b = masked_array([</span><span class="s4">9</span><span class="s3">, </span><span class="s4">8</span><span class="s3">, </span><span class="s4">7</span><span class="s1">]</span><span class="s3">, </span><span class="s1">mask=</span><span class="s3">False</span><span class="s1">)</span>

        <span class="s1">c = stack([a</span><span class="s3">, </span><span class="s1">b]</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">assert_equal(c.shape</span><span class="s3">, </span><span class="s1">(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(a.mask</span><span class="s3">, </span><span class="s1">c[</span><span class="s4">0</span><span class="s1">].mask)</span>
        <span class="s1">assert_array_equal(b.mask</span><span class="s3">, </span><span class="s1">c[</span><span class="s4">1</span><span class="s1">].mask)</span>

        <span class="s1">d = vstack([a</span><span class="s3">, </span><span class="s1">b])</span>
        <span class="s1">assert_array_equal(c.data</span><span class="s3">, </span><span class="s1">d.data)</span>
        <span class="s1">assert_array_equal(c.mask</span><span class="s3">, </span><span class="s1">d.mask)</span>

        <span class="s1">c = stack([a</span><span class="s3">, </span><span class="s1">b]</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(c.shape</span><span class="s3">, </span><span class="s1">(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(a.mask</span><span class="s3">, </span><span class="s1">c[:</span><span class="s3">, </span><span class="s4">0</span><span class="s1">].mask)</span>
        <span class="s1">assert_array_equal(b.mask</span><span class="s3">, </span><span class="s1">c[:</span><span class="s3">, </span><span class="s4">1</span><span class="s1">].mask)</span>

    <span class="s3">def </span><span class="s1">test_stack_nd(self):</span>
        <span class="s0"># 2D</span>
        <span class="s1">shp = (</span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">d1 = np.random.randint(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, </span><span class="s1">shp)</span>
        <span class="s1">d2 = np.random.randint(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, </span><span class="s1">shp)</span>
        <span class="s1">m1 = np.random.randint(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s1">shp).astype(bool)</span>
        <span class="s1">m2 = np.random.randint(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s1">shp).astype(bool)</span>
        <span class="s1">a1 = masked_array(d1</span><span class="s3">, </span><span class="s1">mask=m1)</span>
        <span class="s1">a2 = masked_array(d2</span><span class="s3">, </span><span class="s1">mask=m2)</span>

        <span class="s1">c = stack([a1</span><span class="s3">, </span><span class="s1">a2]</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">c_shp = (</span><span class="s4">2</span><span class="s3">,</span><span class="s1">) + shp</span>
        <span class="s1">assert_equal(c.shape</span><span class="s3">, </span><span class="s1">c_shp)</span>
        <span class="s1">assert_array_equal(a1.mask</span><span class="s3">, </span><span class="s1">c[</span><span class="s4">0</span><span class="s1">].mask)</span>
        <span class="s1">assert_array_equal(a2.mask</span><span class="s3">, </span><span class="s1">c[</span><span class="s4">1</span><span class="s1">].mask)</span>

        <span class="s1">c = stack([a1</span><span class="s3">, </span><span class="s1">a2]</span><span class="s3">, </span><span class="s1">axis=-</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">c_shp = shp + (</span><span class="s4">2</span><span class="s3">,</span><span class="s1">)</span>
        <span class="s1">assert_equal(c.shape</span><span class="s3">, </span><span class="s1">c_shp)</span>
        <span class="s1">assert_array_equal(a1.mask</span><span class="s3">, </span><span class="s1">c[...</span><span class="s3">, </span><span class="s4">0</span><span class="s1">].mask)</span>
        <span class="s1">assert_array_equal(a2.mask</span><span class="s3">, </span><span class="s1">c[...</span><span class="s3">, </span><span class="s4">1</span><span class="s1">].mask)</span>

        <span class="s0"># 4D</span>
        <span class="s1">shp = (</span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">,</span><span class="s1">)</span>
        <span class="s1">d1 = np.random.randint(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, </span><span class="s1">shp)</span>
        <span class="s1">d2 = np.random.randint(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, </span><span class="s1">shp)</span>
        <span class="s1">m1 = np.random.randint(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s1">shp).astype(bool)</span>
        <span class="s1">m2 = np.random.randint(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s1">shp).astype(bool)</span>
        <span class="s1">a1 = masked_array(d1</span><span class="s3">, </span><span class="s1">mask=m1)</span>
        <span class="s1">a2 = masked_array(d2</span><span class="s3">, </span><span class="s1">mask=m2)</span>

        <span class="s1">c = stack([a1</span><span class="s3">, </span><span class="s1">a2]</span><span class="s3">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">c_shp = (</span><span class="s4">2</span><span class="s3">,</span><span class="s1">) + shp</span>
        <span class="s1">assert_equal(c.shape</span><span class="s3">, </span><span class="s1">c_shp)</span>
        <span class="s1">assert_array_equal(a1.mask</span><span class="s3">, </span><span class="s1">c[</span><span class="s4">0</span><span class="s1">].mask)</span>
        <span class="s1">assert_array_equal(a2.mask</span><span class="s3">, </span><span class="s1">c[</span><span class="s4">1</span><span class="s1">].mask)</span>

        <span class="s1">c = stack([a1</span><span class="s3">, </span><span class="s1">a2]</span><span class="s3">, </span><span class="s1">axis=-</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">c_shp = shp + (</span><span class="s4">2</span><span class="s3">,</span><span class="s1">)</span>
        <span class="s1">assert_equal(c.shape</span><span class="s3">, </span><span class="s1">c_shp)</span>
        <span class="s1">assert_array_equal(a1.mask</span><span class="s3">, </span><span class="s1">c[...</span><span class="s3">, </span><span class="s4">0</span><span class="s1">].mask)</span>
        <span class="s1">assert_array_equal(a2.mask</span><span class="s3">, </span><span class="s1">c[...</span><span class="s3">, </span><span class="s4">1</span><span class="s1">].mask)</span>
</pre>
</body>
</html>