<html>
<head>
<title>test_json_table_schema.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
.s5 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_json_table_schema.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;Tests for Table Schema integration.&quot;&quot;&quot;</span>
<span class="s2">from </span><span class="s1">collections </span><span class="s2">import </span><span class="s1">OrderedDict</span>
<span class="s2">import </span><span class="s1">json</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">import </span><span class="s1">pytest</span>

<span class="s2">from </span><span class="s1">pandas.core.dtypes.dtypes </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">CategoricalDtype</span><span class="s2">,</span>
    <span class="s1">DatetimeTZDtype</span><span class="s2">,</span>
    <span class="s1">PeriodDtype</span><span class="s2">,</span>
<span class="s1">)</span>

<span class="s2">import </span><span class="s1">pandas </span><span class="s2">as </span><span class="s1">pd</span>
<span class="s2">from </span><span class="s1">pandas </span><span class="s2">import </span><span class="s1">DataFrame</span>
<span class="s2">import </span><span class="s1">pandas._testing </span><span class="s2">as </span><span class="s1">tm</span>

<span class="s2">from </span><span class="s1">pandas.io.json._table_schema </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">as_json_table_type</span><span class="s2">,</span>
    <span class="s1">build_table_schema</span><span class="s2">,</span>
    <span class="s1">convert_json_field_to_pandas_type</span><span class="s2">,</span>
    <span class="s1">convert_pandas_type_to_json_field</span><span class="s2">,</span>
    <span class="s1">set_default_names</span><span class="s2">,</span>
<span class="s1">)</span>


<span class="s2">class </span><span class="s1">TestBuildSchema:</span>
    <span class="s2">def </span><span class="s1">setup_method(self</span><span class="s2">, </span><span class="s1">method):</span>
        <span class="s1">self.df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s3">&quot;A&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]</span><span class="s2">,</span>
                <span class="s3">&quot;B&quot;</span><span class="s1">: [</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s2">,</span>
                <span class="s3">&quot;C&quot;</span><span class="s1">: pd.date_range(</span><span class="s3">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;d&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s3">&quot;D&quot;</span><span class="s1">: pd.timedelta_range(</span><span class="s3">&quot;1H&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;T&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">}</span><span class="s2">,</span>
            <span class="s1">index=pd.Index(range(</span><span class="s4">4</span><span class="s1">)</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_build_table_schema(self):</span>
        <span class="s1">result = build_table_schema(self.df</span><span class="s2">, </span><span class="s1">version=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">expected = {</span>
            <span class="s3">&quot;fields&quot;</span><span class="s1">: [</span>
                <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;idx&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;integer&quot;</span><span class="s1">}</span><span class="s2">,</span>
                <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;integer&quot;</span><span class="s1">}</span><span class="s2">,</span>
                <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;string&quot;</span><span class="s1">}</span><span class="s2">,</span>
                <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;C&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;datetime&quot;</span><span class="s1">}</span><span class="s2">,</span>
                <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;duration&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">,</span>
            <span class="s3">&quot;primaryKey&quot;</span><span class="s1">: [</span><span class="s3">&quot;idx&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">}</span>
        <span class="s2">assert </span><span class="s1">result == expected</span>
        <span class="s1">result = build_table_schema(self.df)</span>
        <span class="s2">assert </span><span class="s3">&quot;pandas_version&quot; </span><span class="s2">in </span><span class="s1">result</span>

    <span class="s2">def </span><span class="s1">test_series(self):</span>
        <span class="s1">s = pd.Series([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;foo&quot;</span><span class="s1">)</span>
        <span class="s1">result = build_table_schema(s</span><span class="s2">, </span><span class="s1">version=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">expected = {</span>
            <span class="s3">&quot;fields&quot;</span><span class="s1">: [</span>
                <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;index&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;integer&quot;</span><span class="s1">}</span><span class="s2">,</span>
                <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;foo&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;integer&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">,</span>
            <span class="s3">&quot;primaryKey&quot;</span><span class="s1">: [</span><span class="s3">&quot;index&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">}</span>
        <span class="s2">assert </span><span class="s1">result == expected</span>
        <span class="s1">result = build_table_schema(s)</span>
        <span class="s2">assert </span><span class="s3">&quot;pandas_version&quot; </span><span class="s2">in </span><span class="s1">result</span>

    <span class="s2">def </span><span class="s1">test_series_unnamed(self):</span>
        <span class="s1">result = build_table_schema(pd.Series([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">])</span><span class="s2">, </span><span class="s1">version=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">expected = {</span>
            <span class="s3">&quot;fields&quot;</span><span class="s1">: [</span>
                <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;index&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;integer&quot;</span><span class="s1">}</span><span class="s2">,</span>
                <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;values&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;integer&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">,</span>
            <span class="s3">&quot;primaryKey&quot;</span><span class="s1">: [</span><span class="s3">&quot;index&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">}</span>
        <span class="s2">assert </span><span class="s1">result == expected</span>

    <span class="s2">def </span><span class="s1">test_multiindex(self):</span>
        <span class="s1">df = self.df.copy()</span>
        <span class="s1">idx = pd.MultiIndex.from_product([(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)])</span>
        <span class="s1">df.index = idx</span>

        <span class="s1">result = build_table_schema(df</span><span class="s2">, </span><span class="s1">version=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">expected = {</span>
            <span class="s3">&quot;fields&quot;</span><span class="s1">: [</span>
                <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;level_0&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;string&quot;</span><span class="s1">}</span><span class="s2">,</span>
                <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;level_1&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;integer&quot;</span><span class="s1">}</span><span class="s2">,</span>
                <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;integer&quot;</span><span class="s1">}</span><span class="s2">,</span>
                <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;string&quot;</span><span class="s1">}</span><span class="s2">,</span>
                <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;C&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;datetime&quot;</span><span class="s1">}</span><span class="s2">,</span>
                <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;duration&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">,</span>
            <span class="s3">&quot;primaryKey&quot;</span><span class="s1">: [</span><span class="s3">&quot;level_0&quot;</span><span class="s2">, </span><span class="s3">&quot;level_1&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">}</span>
        <span class="s2">assert </span><span class="s1">result == expected</span>

        <span class="s1">df.index.names = [</span><span class="s3">&quot;idx0&quot;</span><span class="s2">, None</span><span class="s1">]</span>
        <span class="s1">expected[</span><span class="s3">&quot;fields&quot;</span><span class="s1">][</span><span class="s4">0</span><span class="s1">][</span><span class="s3">&quot;name&quot;</span><span class="s1">] = </span><span class="s3">&quot;idx0&quot;</span>
        <span class="s1">expected[</span><span class="s3">&quot;primaryKey&quot;</span><span class="s1">] = [</span><span class="s3">&quot;idx0&quot;</span><span class="s2">, </span><span class="s3">&quot;level_1&quot;</span><span class="s1">]</span>
        <span class="s1">result = build_table_schema(df</span><span class="s2">, </span><span class="s1">version=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">result == expected</span>


<span class="s2">class </span><span class="s1">TestTableSchemaType:</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;int_type&quot;</span><span class="s2">, </span><span class="s1">[int</span><span class="s2">, </span><span class="s1">np.int16</span><span class="s2">, </span><span class="s1">np.int32</span><span class="s2">, </span><span class="s1">np.int64])</span>
    <span class="s2">def </span><span class="s1">test_as_json_table_type_int_data(self</span><span class="s2">, </span><span class="s1">int_type):</span>
        <span class="s1">int_data = [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span>
        <span class="s2">assert </span><span class="s1">as_json_table_type(np.array(int_data</span><span class="s2">, </span><span class="s1">dtype=int_type).dtype) == </span><span class="s3">&quot;integer&quot;</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;float_type&quot;</span><span class="s2">, </span><span class="s1">[float</span><span class="s2">, </span><span class="s1">np.float16</span><span class="s2">, </span><span class="s1">np.float32</span><span class="s2">, </span><span class="s1">np.float64])</span>
    <span class="s2">def </span><span class="s1">test_as_json_table_type_float_data(self</span><span class="s2">, </span><span class="s1">float_type):</span>
        <span class="s1">float_data = [</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">3.0</span><span class="s1">]</span>
        <span class="s2">assert </span><span class="s1">(</span>
            <span class="s1">as_json_table_type(np.array(float_data</span><span class="s2">, </span><span class="s1">dtype=float_type).dtype) == </span><span class="s3">&quot;number&quot;</span>
        <span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;bool_type&quot;</span><span class="s2">, </span><span class="s1">[bool</span><span class="s2">, </span><span class="s1">np.bool_])</span>
    <span class="s2">def </span><span class="s1">test_as_json_table_type_bool_data(self</span><span class="s2">, </span><span class="s1">bool_type):</span>
        <span class="s1">bool_data = [</span><span class="s2">True, False</span><span class="s1">]</span>
        <span class="s2">assert </span><span class="s1">(</span>
            <span class="s1">as_json_table_type(np.array(bool_data</span><span class="s2">, </span><span class="s1">dtype=bool_type).dtype) == </span><span class="s3">&quot;boolean&quot;</span>
        <span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;date_data&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">pd.to_datetime([</span><span class="s3">&quot;2016&quot;</span><span class="s1">])</span><span class="s2">,</span>
            <span class="s1">pd.to_datetime([</span><span class="s3">&quot;2016&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">utc=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">pd.Series(pd.to_datetime([</span><span class="s3">&quot;2016&quot;</span><span class="s1">]))</span><span class="s2">,</span>
            <span class="s1">pd.Series(pd.to_datetime([</span><span class="s3">&quot;2016&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">utc=</span><span class="s2">True</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">pd.period_range(</span><span class="s3">&quot;2016&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">3</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_as_json_table_type_date_data(self</span><span class="s2">, </span><span class="s1">date_data):</span>
        <span class="s2">assert </span><span class="s1">as_json_table_type(date_data.dtype) == </span><span class="s3">&quot;datetime&quot;</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;str_data&quot;</span><span class="s2">, </span><span class="s1">[pd.Series([</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s1">])</span><span class="s2">, </span><span class="s1">pd.Index([</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s1">])])</span>
    <span class="s2">def </span><span class="s1">test_as_json_table_type_string_data(self</span><span class="s2">, </span><span class="s1">str_data):</span>
        <span class="s2">assert </span><span class="s1">as_json_table_type(str_data.dtype) == </span><span class="s3">&quot;string&quot;</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;cat_data&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">pd.Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s1">])</span><span class="s2">,</span>
            <span class="s1">pd.Categorical([</span><span class="s4">1</span><span class="s1">])</span><span class="s2">,</span>
            <span class="s1">pd.Series(pd.Categorical([</span><span class="s4">1</span><span class="s1">]))</span><span class="s2">,</span>
            <span class="s1">pd.CategoricalIndex([</span><span class="s4">1</span><span class="s1">])</span><span class="s2">,</span>
            <span class="s1">pd.Categorical([</span><span class="s4">1</span><span class="s1">])</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_as_json_table_type_categorical_data(self</span><span class="s2">, </span><span class="s1">cat_data):</span>
        <span class="s2">assert </span><span class="s1">as_json_table_type(cat_data.dtype) == </span><span class="s3">&quot;any&quot;</span>

    <span class="s5"># ------</span>
    <span class="s5"># dtypes</span>
    <span class="s5"># ------</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;int_dtype&quot;</span><span class="s2">, </span><span class="s1">[int</span><span class="s2">, </span><span class="s1">np.int16</span><span class="s2">, </span><span class="s1">np.int32</span><span class="s2">, </span><span class="s1">np.int64])</span>
    <span class="s2">def </span><span class="s1">test_as_json_table_type_int_dtypes(self</span><span class="s2">, </span><span class="s1">int_dtype):</span>
        <span class="s2">assert </span><span class="s1">as_json_table_type(int_dtype) == </span><span class="s3">&quot;integer&quot;</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;float_dtype&quot;</span><span class="s2">, </span><span class="s1">[float</span><span class="s2">, </span><span class="s1">np.float16</span><span class="s2">, </span><span class="s1">np.float32</span><span class="s2">, </span><span class="s1">np.float64])</span>
    <span class="s2">def </span><span class="s1">test_as_json_table_type_float_dtypes(self</span><span class="s2">, </span><span class="s1">float_dtype):</span>
        <span class="s2">assert </span><span class="s1">as_json_table_type(float_dtype) == </span><span class="s3">&quot;number&quot;</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;bool_dtype&quot;</span><span class="s2">, </span><span class="s1">[bool</span><span class="s2">, </span><span class="s1">np.bool_])</span>
    <span class="s2">def </span><span class="s1">test_as_json_table_type_bool_dtypes(self</span><span class="s2">, </span><span class="s1">bool_dtype):</span>
        <span class="s2">assert </span><span class="s1">as_json_table_type(bool_dtype) == </span><span class="s3">&quot;boolean&quot;</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;date_dtype&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">np.datetime64</span><span class="s2">,</span>
            <span class="s1">np.dtype(</span><span class="s3">&quot;&lt;M8[ns]&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">PeriodDtype(</span><span class="s3">&quot;D&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">DatetimeTZDtype(</span><span class="s3">&quot;ns&quot;</span><span class="s2">, </span><span class="s3">&quot;US/Central&quot;</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_as_json_table_type_date_dtypes(self</span><span class="s2">, </span><span class="s1">date_dtype):</span>
        <span class="s5"># TODO: datedate.date? datetime.time?</span>
        <span class="s2">assert </span><span class="s1">as_json_table_type(date_dtype) == </span><span class="s3">&quot;datetime&quot;</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;td_dtype&quot;</span><span class="s2">, </span><span class="s1">[np.timedelta64</span><span class="s2">, </span><span class="s1">np.dtype(</span><span class="s3">&quot;&lt;m8[ns]&quot;</span><span class="s1">)])</span>
    <span class="s2">def </span><span class="s1">test_as_json_table_type_timedelta_dtypes(self</span><span class="s2">, </span><span class="s1">td_dtype):</span>
        <span class="s2">assert </span><span class="s1">as_json_table_type(td_dtype) == </span><span class="s3">&quot;duration&quot;</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;str_dtype&quot;</span><span class="s2">, </span><span class="s1">[object])  </span><span class="s5"># TODO(GH#14904) flesh out dtypes?</span>
    <span class="s2">def </span><span class="s1">test_as_json_table_type_string_dtypes(self</span><span class="s2">, </span><span class="s1">str_dtype):</span>
        <span class="s2">assert </span><span class="s1">as_json_table_type(str_dtype) == </span><span class="s3">&quot;string&quot;</span>

    <span class="s2">def </span><span class="s1">test_as_json_table_type_categorical_dtypes(self):</span>
        <span class="s2">assert </span><span class="s1">as_json_table_type(pd.Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s1">]).dtype) == </span><span class="s3">&quot;any&quot;</span>
        <span class="s2">assert </span><span class="s1">as_json_table_type(CategoricalDtype()) == </span><span class="s3">&quot;any&quot;</span>


<span class="s2">class </span><span class="s1">TestTableOrient:</span>
    <span class="s2">def </span><span class="s1">setup_method(self</span><span class="s2">, </span><span class="s1">method):</span>
        <span class="s1">self.df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s3">&quot;A&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]</span><span class="s2">,</span>
                <span class="s3">&quot;B&quot;</span><span class="s1">: [</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s2">,</span>
                <span class="s3">&quot;C&quot;</span><span class="s1">: pd.date_range(</span><span class="s3">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;d&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s3">&quot;D&quot;</span><span class="s1">: pd.timedelta_range(</span><span class="s3">&quot;1H&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;T&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s3">&quot;E&quot;</span><span class="s1">: pd.Series(pd.Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]))</span><span class="s2">,</span>
                <span class="s3">&quot;F&quot;</span><span class="s1">: pd.Series(pd.Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ordered=</span><span class="s2">True</span><span class="s1">))</span><span class="s2">,</span>
                <span class="s3">&quot;G&quot;</span><span class="s1">: [</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4.0</span><span class="s1">]</span><span class="s2">,</span>
                <span class="s3">&quot;H&quot;</span><span class="s1">: pd.date_range(</span><span class="s3">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;d&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s2">, </span><span class="s1">tz=</span><span class="s3">&quot;US/Central&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">}</span><span class="s2">,</span>
            <span class="s1">index=pd.Index(range(</span><span class="s4">4</span><span class="s1">)</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_build_series(self):</span>
        <span class="s1">s = pd.Series([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;a&quot;</span><span class="s1">)</span>
        <span class="s1">s.index.name = </span><span class="s3">&quot;id&quot;</span>
        <span class="s1">result = s.to_json(orient=</span><span class="s3">&quot;table&quot;</span><span class="s2">, </span><span class="s1">date_format=</span><span class="s3">&quot;iso&quot;</span><span class="s1">)</span>
        <span class="s1">result = json.loads(result</span><span class="s2">, </span><span class="s1">object_pairs_hook=OrderedDict)</span>

        <span class="s2">assert </span><span class="s3">&quot;pandas_version&quot; </span><span class="s2">in </span><span class="s1">result[</span><span class="s3">&quot;schema&quot;</span><span class="s1">]</span>
        <span class="s1">result[</span><span class="s3">&quot;schema&quot;</span><span class="s1">].pop(</span><span class="s3">&quot;pandas_version&quot;</span><span class="s1">)</span>

        <span class="s1">fields = [{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;id&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;integer&quot;</span><span class="s1">}</span><span class="s2">, </span><span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;integer&quot;</span><span class="s1">}]</span>

        <span class="s1">schema = {</span><span class="s3">&quot;fields&quot;</span><span class="s1">: fields</span><span class="s2">, </span><span class="s3">&quot;primaryKey&quot;</span><span class="s1">: [</span><span class="s3">&quot;id&quot;</span><span class="s1">]}</span>

        <span class="s1">expected = OrderedDict(</span>
            <span class="s1">[</span>
                <span class="s1">(</span><span class="s3">&quot;schema&quot;</span><span class="s2">, </span><span class="s1">schema)</span><span class="s2">,</span>
                <span class="s1">(</span>
                    <span class="s3">&quot;data&quot;</span><span class="s2">,</span>
                    <span class="s1">[</span>
                        <span class="s1">OrderedDict([(</span><span class="s3">&quot;id&quot;</span><span class="s2">, </span><span class="s4">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)])</span><span class="s2">,</span>
                        <span class="s1">OrderedDict([(</span><span class="s3">&quot;id&quot;</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)])</span><span class="s2">,</span>
                    <span class="s1">]</span><span class="s2">,</span>
                <span class="s1">)</span><span class="s2">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>

        <span class="s2">assert </span><span class="s1">result == expected</span>

    <span class="s2">def </span><span class="s1">test_read_json_from_to_json_results(self):</span>
        <span class="s5"># GH32383</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s3">&quot;_id&quot;</span><span class="s1">: {</span><span class="s3">&quot;row_0&quot;</span><span class="s1">: </span><span class="s4">0</span><span class="s1">}</span><span class="s2">,</span>
                <span class="s3">&quot;category&quot;</span><span class="s1">: {</span><span class="s3">&quot;row_0&quot;</span><span class="s1">: </span><span class="s3">&quot;Goods&quot;</span><span class="s1">}</span><span class="s2">,</span>
                <span class="s3">&quot;recommender_id&quot;</span><span class="s1">: {</span><span class="s3">&quot;row_0&quot;</span><span class="s1">: </span><span class="s4">3</span><span class="s1">}</span><span class="s2">,</span>
                <span class="s3">&quot;recommender_name_jp&quot;</span><span class="s1">: {</span><span class="s3">&quot;row_0&quot;</span><span class="s1">: </span><span class="s3">&quot;浦田&quot;</span><span class="s1">}</span><span class="s2">,</span>
                <span class="s3">&quot;recommender_name_en&quot;</span><span class="s1">: {</span><span class="s3">&quot;row_0&quot;</span><span class="s1">: </span><span class="s3">&quot;Urata&quot;</span><span class="s1">}</span><span class="s2">,</span>
                <span class="s3">&quot;name_jp&quot;</span><span class="s1">: {</span><span class="s3">&quot;row_0&quot;</span><span class="s1">: </span><span class="s3">&quot;博多人形（松尾吉将まつお よしまさ）&quot;</span><span class="s1">}</span><span class="s2">,</span>
                <span class="s3">&quot;name_en&quot;</span><span class="s1">: {</span><span class="s3">&quot;row_0&quot;</span><span class="s1">: </span><span class="s3">&quot;Hakata Dolls Matsuo&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
        <span class="s1">result1 = pd.read_json(df.to_json())</span>
        <span class="s1">result2 = DataFrame.from_dict(json.loads(df.to_json()))</span>
        <span class="s1">tm.assert_frame_equal(result1</span><span class="s2">, </span><span class="s1">df)</span>
        <span class="s1">tm.assert_frame_equal(result2</span><span class="s2">, </span><span class="s1">df)</span>

    <span class="s1">@pytest.mark.filterwarnings(</span>
        <span class="s3">&quot;ignore:an integer is required (got type float)*:DeprecationWarning&quot;</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_to_json(self):</span>
        <span class="s1">df = self.df.copy()</span>
        <span class="s1">df.index.name = </span><span class="s3">&quot;idx&quot;</span>
        <span class="s1">result = df.to_json(orient=</span><span class="s3">&quot;table&quot;</span><span class="s2">, </span><span class="s1">date_format=</span><span class="s3">&quot;iso&quot;</span><span class="s1">)</span>
        <span class="s1">result = json.loads(result</span><span class="s2">, </span><span class="s1">object_pairs_hook=OrderedDict)</span>

        <span class="s2">assert </span><span class="s3">&quot;pandas_version&quot; </span><span class="s2">in </span><span class="s1">result[</span><span class="s3">&quot;schema&quot;</span><span class="s1">]</span>
        <span class="s1">result[</span><span class="s3">&quot;schema&quot;</span><span class="s1">].pop(</span><span class="s3">&quot;pandas_version&quot;</span><span class="s1">)</span>

        <span class="s1">fields = [</span>
            <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;idx&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;integer&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;integer&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;string&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;C&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;datetime&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;duration&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span>
                <span class="s3">&quot;constraints&quot;</span><span class="s1">: {</span><span class="s3">&quot;enum&quot;</span><span class="s1">: [</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]}</span><span class="s2">,</span>
                <span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;E&quot;</span><span class="s2">,</span>
                <span class="s3">&quot;ordered&quot;</span><span class="s1">: </span><span class="s2">False,</span>
                <span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;any&quot;</span><span class="s2">,</span>
            <span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span>
                <span class="s3">&quot;constraints&quot;</span><span class="s1">: {</span><span class="s3">&quot;enum&quot;</span><span class="s1">: [</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]}</span><span class="s2">,</span>
                <span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;F&quot;</span><span class="s2">,</span>
                <span class="s3">&quot;ordered&quot;</span><span class="s1">: </span><span class="s2">True,</span>
                <span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;any&quot;</span><span class="s2">,</span>
            <span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;G&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;number&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;H&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;datetime&quot;</span><span class="s2">, </span><span class="s3">&quot;tz&quot;</span><span class="s1">: </span><span class="s3">&quot;US/Central&quot;</span><span class="s1">}</span><span class="s2">,</span>
        <span class="s1">]</span>

        <span class="s1">schema = {</span><span class="s3">&quot;fields&quot;</span><span class="s1">: fields</span><span class="s2">, </span><span class="s3">&quot;primaryKey&quot;</span><span class="s1">: [</span><span class="s3">&quot;idx&quot;</span><span class="s1">]}</span>
        <span class="s1">data = [</span>
            <span class="s1">OrderedDict(</span>
                <span class="s1">[</span>
                    <span class="s1">(</span><span class="s3">&quot;idx&quot;</span><span class="s2">, </span><span class="s4">0</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;C&quot;</span><span class="s2">, </span><span class="s3">&quot;2016-01-01T00:00:00.000Z&quot;</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;P0DT1H0M0S&quot;</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;E&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;F&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;G&quot;</span><span class="s2">, </span><span class="s4">1.0</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;H&quot;</span><span class="s2">, </span><span class="s3">&quot;2016-01-01T06:00:00.000Z&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">]</span>
            <span class="s1">)</span><span class="s2">,</span>
            <span class="s1">OrderedDict(</span>
                <span class="s1">[</span>
                    <span class="s1">(</span><span class="s3">&quot;idx&quot;</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;C&quot;</span><span class="s2">, </span><span class="s3">&quot;2016-01-02T00:00:00.000Z&quot;</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;P0DT1H1M0S&quot;</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;E&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;F&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;G&quot;</span><span class="s2">, </span><span class="s4">2.0</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;H&quot;</span><span class="s2">, </span><span class="s3">&quot;2016-01-02T06:00:00.000Z&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">]</span>
            <span class="s1">)</span><span class="s2">,</span>
            <span class="s1">OrderedDict(</span>
                <span class="s1">[</span>
                    <span class="s1">(</span><span class="s3">&quot;idx&quot;</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;C&quot;</span><span class="s2">, </span><span class="s3">&quot;2016-01-03T00:00:00.000Z&quot;</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;P0DT1H2M0S&quot;</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;E&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;F&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;G&quot;</span><span class="s2">, </span><span class="s4">3.0</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;H&quot;</span><span class="s2">, </span><span class="s3">&quot;2016-01-03T06:00:00.000Z&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">]</span>
            <span class="s1">)</span><span class="s2">,</span>
            <span class="s1">OrderedDict(</span>
                <span class="s1">[</span>
                    <span class="s1">(</span><span class="s3">&quot;idx&quot;</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;C&quot;</span><span class="s2">, </span><span class="s3">&quot;2016-01-04T00:00:00.000Z&quot;</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;P0DT1H3M0S&quot;</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;E&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;F&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;G&quot;</span><span class="s2">, </span><span class="s4">4.0</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">(</span><span class="s3">&quot;H&quot;</span><span class="s2">, </span><span class="s3">&quot;2016-01-04T06:00:00.000Z&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">]</span>
            <span class="s1">)</span><span class="s2">,</span>
        <span class="s1">]</span>
        <span class="s1">expected = OrderedDict([(</span><span class="s3">&quot;schema&quot;</span><span class="s2">, </span><span class="s1">schema)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;data&quot;</span><span class="s2">, </span><span class="s1">data)])</span>

        <span class="s2">assert </span><span class="s1">result == expected</span>

    <span class="s2">def </span><span class="s1">test_to_json_float_index(self):</span>
        <span class="s1">data = pd.Series(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">index=[</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s1">])</span>
        <span class="s1">result = data.to_json(orient=</span><span class="s3">&quot;table&quot;</span><span class="s2">, </span><span class="s1">date_format=</span><span class="s3">&quot;iso&quot;</span><span class="s1">)</span>
        <span class="s1">result = json.loads(result</span><span class="s2">, </span><span class="s1">object_pairs_hook=OrderedDict)</span>
        <span class="s1">result[</span><span class="s3">&quot;schema&quot;</span><span class="s1">].pop(</span><span class="s3">&quot;pandas_version&quot;</span><span class="s1">)</span>

        <span class="s1">expected = OrderedDict(</span>
            <span class="s1">[</span>
                <span class="s1">(</span>
                    <span class="s3">&quot;schema&quot;</span><span class="s2">,</span>
                    <span class="s1">{</span>
                        <span class="s3">&quot;fields&quot;</span><span class="s1">: [</span>
                            <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;index&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;number&quot;</span><span class="s1">}</span><span class="s2">,</span>
                            <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;values&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;integer&quot;</span><span class="s1">}</span><span class="s2">,</span>
                        <span class="s1">]</span><span class="s2">,</span>
                        <span class="s3">&quot;primaryKey&quot;</span><span class="s1">: [</span><span class="s3">&quot;index&quot;</span><span class="s1">]</span><span class="s2">,</span>
                    <span class="s1">}</span><span class="s2">,</span>
                <span class="s1">)</span><span class="s2">,</span>
                <span class="s1">(</span>
                    <span class="s3">&quot;data&quot;</span><span class="s2">,</span>
                    <span class="s1">[</span>
                        <span class="s1">OrderedDict([(</span><span class="s3">&quot;index&quot;</span><span class="s2">, </span><span class="s4">1.0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;values&quot;</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)])</span><span class="s2">,</span>
                        <span class="s1">OrderedDict([(</span><span class="s3">&quot;index&quot;</span><span class="s2">, </span><span class="s4">2.0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;values&quot;</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)])</span><span class="s2">,</span>
                    <span class="s1">]</span><span class="s2">,</span>
                <span class="s1">)</span><span class="s2">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>

        <span class="s2">assert </span><span class="s1">result == expected</span>

    <span class="s2">def </span><span class="s1">test_to_json_period_index(self):</span>
        <span class="s1">idx = pd.period_range(</span><span class="s3">&quot;2016&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;Q-JAN&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">data = pd.Series(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">idx)</span>
        <span class="s1">result = data.to_json(orient=</span><span class="s3">&quot;table&quot;</span><span class="s2">, </span><span class="s1">date_format=</span><span class="s3">&quot;iso&quot;</span><span class="s1">)</span>
        <span class="s1">result = json.loads(result</span><span class="s2">, </span><span class="s1">object_pairs_hook=OrderedDict)</span>
        <span class="s1">result[</span><span class="s3">&quot;schema&quot;</span><span class="s1">].pop(</span><span class="s3">&quot;pandas_version&quot;</span><span class="s1">)</span>

        <span class="s1">fields = [</span>
            <span class="s1">{</span><span class="s3">&quot;freq&quot;</span><span class="s1">: </span><span class="s3">&quot;Q-JAN&quot;</span><span class="s2">, </span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;index&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;datetime&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;values&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;integer&quot;</span><span class="s1">}</span><span class="s2">,</span>
        <span class="s1">]</span>

        <span class="s1">schema = {</span><span class="s3">&quot;fields&quot;</span><span class="s1">: fields</span><span class="s2">, </span><span class="s3">&quot;primaryKey&quot;</span><span class="s1">: [</span><span class="s3">&quot;index&quot;</span><span class="s1">]}</span>
        <span class="s1">data = [</span>
            <span class="s1">OrderedDict([(</span><span class="s3">&quot;index&quot;</span><span class="s2">, </span><span class="s3">&quot;2015-11-01T00:00:00.000Z&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;values&quot;</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)])</span><span class="s2">,</span>
            <span class="s1">OrderedDict([(</span><span class="s3">&quot;index&quot;</span><span class="s2">, </span><span class="s3">&quot;2016-02-01T00:00:00.000Z&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;values&quot;</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)])</span><span class="s2">,</span>
        <span class="s1">]</span>
        <span class="s1">expected = OrderedDict([(</span><span class="s3">&quot;schema&quot;</span><span class="s2">, </span><span class="s1">schema)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;data&quot;</span><span class="s2">, </span><span class="s1">data)])</span>

        <span class="s2">assert </span><span class="s1">result == expected</span>

    <span class="s2">def </span><span class="s1">test_to_json_categorical_index(self):</span>
        <span class="s1">data = pd.Series(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">pd.CategoricalIndex([</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s1">]))</span>
        <span class="s1">result = data.to_json(orient=</span><span class="s3">&quot;table&quot;</span><span class="s2">, </span><span class="s1">date_format=</span><span class="s3">&quot;iso&quot;</span><span class="s1">)</span>
        <span class="s1">result = json.loads(result</span><span class="s2">, </span><span class="s1">object_pairs_hook=OrderedDict)</span>
        <span class="s1">result[</span><span class="s3">&quot;schema&quot;</span><span class="s1">].pop(</span><span class="s3">&quot;pandas_version&quot;</span><span class="s1">)</span>

        <span class="s1">expected = OrderedDict(</span>
            <span class="s1">[</span>
                <span class="s1">(</span>
                    <span class="s3">&quot;schema&quot;</span><span class="s2">,</span>
                    <span class="s1">{</span>
                        <span class="s3">&quot;fields&quot;</span><span class="s1">: [</span>
                            <span class="s1">{</span>
                                <span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;index&quot;</span><span class="s2">,</span>
                                <span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;any&quot;</span><span class="s2">,</span>
                                <span class="s3">&quot;constraints&quot;</span><span class="s1">: {</span><span class="s3">&quot;enum&quot;</span><span class="s1">: [</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s1">]}</span><span class="s2">,</span>
                                <span class="s3">&quot;ordered&quot;</span><span class="s1">: </span><span class="s2">False,</span>
                            <span class="s1">}</span><span class="s2">,</span>
                            <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;values&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;integer&quot;</span><span class="s1">}</span><span class="s2">,</span>
                        <span class="s1">]</span><span class="s2">,</span>
                        <span class="s3">&quot;primaryKey&quot;</span><span class="s1">: [</span><span class="s3">&quot;index&quot;</span><span class="s1">]</span><span class="s2">,</span>
                    <span class="s1">}</span><span class="s2">,</span>
                <span class="s1">)</span><span class="s2">,</span>
                <span class="s1">(</span>
                    <span class="s3">&quot;data&quot;</span><span class="s2">,</span>
                    <span class="s1">[</span>
                        <span class="s1">OrderedDict([(</span><span class="s3">&quot;index&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;values&quot;</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)])</span><span class="s2">,</span>
                        <span class="s1">OrderedDict([(</span><span class="s3">&quot;index&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;values&quot;</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)])</span><span class="s2">,</span>
                    <span class="s1">]</span><span class="s2">,</span>
                <span class="s1">)</span><span class="s2">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>

        <span class="s2">assert </span><span class="s1">result == expected</span>

    <span class="s1">@pytest.mark.filterwarnings(</span>
        <span class="s3">&quot;ignore:an integer is required (got type float)*:DeprecationWarning&quot;</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_date_format_raises(self):</span>
        <span class="s1">msg = (</span>
            <span class="s3">&quot;Trying to write with `orient='table'` and `date_format='epoch'`. Table &quot;</span>
            <span class="s3">&quot;Schema requires dates to be formatted with `date_format='iso'`&quot;</span>
        <span class="s1">)</span>
        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">self.df.to_json(orient=</span><span class="s3">&quot;table&quot;</span><span class="s2">, </span><span class="s1">date_format=</span><span class="s3">&quot;epoch&quot;</span><span class="s1">)</span>

        <span class="s5"># others work</span>
        <span class="s1">self.df.to_json(orient=</span><span class="s3">&quot;table&quot;</span><span class="s2">, </span><span class="s1">date_format=</span><span class="s3">&quot;iso&quot;</span><span class="s1">)</span>
        <span class="s1">self.df.to_json(orient=</span><span class="s3">&quot;table&quot;</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_convert_pandas_type_to_json_field_int(self</span><span class="s2">, </span><span class="s1">index_or_series):</span>
        <span class="s1">kind = index_or_series</span>
        <span class="s1">data = [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span>
        <span class="s1">result = convert_pandas_type_to_json_field(kind(data</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;name&quot;</span><span class="s1">))</span>
        <span class="s1">expected = {</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;name&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;integer&quot;</span><span class="s1">}</span>
        <span class="s2">assert </span><span class="s1">result == expected</span>

    <span class="s2">def </span><span class="s1">test_convert_pandas_type_to_json_field_float(self</span><span class="s2">, </span><span class="s1">index_or_series):</span>
        <span class="s1">kind = index_or_series</span>
        <span class="s1">data = [</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">3.0</span><span class="s1">]</span>
        <span class="s1">result = convert_pandas_type_to_json_field(kind(data</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;name&quot;</span><span class="s1">))</span>
        <span class="s1">expected = {</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;name&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;number&quot;</span><span class="s1">}</span>
        <span class="s2">assert </span><span class="s1">result == expected</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;dt_args,extra_exp&quot;</span><span class="s2">, </span><span class="s1">[({}</span><span class="s2">, </span><span class="s1">{})</span><span class="s2">, </span><span class="s1">({</span><span class="s3">&quot;utc&quot;</span><span class="s1">: </span><span class="s2">True</span><span class="s1">}</span><span class="s2">, </span><span class="s1">{</span><span class="s3">&quot;tz&quot;</span><span class="s1">: </span><span class="s3">&quot;UTC&quot;</span><span class="s1">})]</span>
    <span class="s1">)</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;wrapper&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s2">None, </span><span class="s1">pd.Series])</span>
    <span class="s2">def </span><span class="s1">test_convert_pandas_type_to_json_field_datetime(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">dt_args</span><span class="s2">, </span><span class="s1">extra_exp</span><span class="s2">, </span><span class="s1">wrapper</span>
    <span class="s1">):</span>
        <span class="s1">data = [</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">3.0</span><span class="s1">]</span>
        <span class="s1">data = pd.to_datetime(data</span><span class="s2">, </span><span class="s1">**dt_args)</span>
        <span class="s2">if </span><span class="s1">wrapper </span><span class="s2">is </span><span class="s1">pd.Series:</span>
            <span class="s1">data = pd.Series(data</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;values&quot;</span><span class="s1">)</span>
        <span class="s1">result = convert_pandas_type_to_json_field(data)</span>
        <span class="s1">expected = {</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;values&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;datetime&quot;</span><span class="s1">}</span>
        <span class="s1">expected.update(extra_exp)</span>
        <span class="s2">assert </span><span class="s1">result == expected</span>

    <span class="s2">def </span><span class="s1">test_convert_pandas_type_to_json_period_range(self):</span>
        <span class="s1">arr = pd.period_range(</span><span class="s3">&quot;2016&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;A-DEC&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s1">)</span>
        <span class="s1">result = convert_pandas_type_to_json_field(arr)</span>
        <span class="s1">expected = {</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;values&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;datetime&quot;</span><span class="s2">, </span><span class="s3">&quot;freq&quot;</span><span class="s1">: </span><span class="s3">&quot;A-DEC&quot;</span><span class="s1">}</span>
        <span class="s2">assert </span><span class="s1">result == expected</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;kind&quot;</span><span class="s2">, </span><span class="s1">[pd.Categorical</span><span class="s2">, </span><span class="s1">pd.CategoricalIndex])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;ordered&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s2">True, False</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_convert_pandas_type_to_json_field_categorical(self</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">, </span><span class="s1">ordered):</span>
        <span class="s1">data = [</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span>
        <span class="s2">if </span><span class="s1">kind </span><span class="s2">is </span><span class="s1">pd.Categorical:</span>
            <span class="s1">arr = pd.Series(kind(data</span><span class="s2">, </span><span class="s1">ordered=ordered)</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;cats&quot;</span><span class="s1">)</span>
        <span class="s2">elif </span><span class="s1">kind </span><span class="s2">is </span><span class="s1">pd.CategoricalIndex:</span>
            <span class="s1">arr = kind(data</span><span class="s2">, </span><span class="s1">ordered=ordered</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;cats&quot;</span><span class="s1">)</span>

        <span class="s1">result = convert_pandas_type_to_json_field(arr)</span>
        <span class="s1">expected = {</span>
            <span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;cats&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;any&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;constraints&quot;</span><span class="s1">: {</span><span class="s3">&quot;enum&quot;</span><span class="s1">: data}</span><span class="s2">,</span>
            <span class="s3">&quot;ordered&quot;</span><span class="s1">: ordered</span><span class="s2">,</span>
        <span class="s1">}</span>
        <span class="s2">assert </span><span class="s1">result == expected</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;inp,exp&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">({</span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;integer&quot;</span><span class="s1">}</span><span class="s2">, </span><span class="s3">&quot;int64&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">({</span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;number&quot;</span><span class="s1">}</span><span class="s2">, </span><span class="s3">&quot;float64&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">({</span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;boolean&quot;</span><span class="s1">}</span><span class="s2">, </span><span class="s3">&quot;bool&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">({</span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;duration&quot;</span><span class="s1">}</span><span class="s2">, </span><span class="s3">&quot;timedelta64&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">({</span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;datetime&quot;</span><span class="s1">}</span><span class="s2">, </span><span class="s3">&quot;datetime64[ns]&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">({</span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;datetime&quot;</span><span class="s2">, </span><span class="s3">&quot;tz&quot;</span><span class="s1">: </span><span class="s3">&quot;US/Hawaii&quot;</span><span class="s1">}</span><span class="s2">, </span><span class="s3">&quot;datetime64[ns, US/Hawaii]&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">({</span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;any&quot;</span><span class="s1">}</span><span class="s2">, </span><span class="s3">&quot;object&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">(</span>
                <span class="s1">{</span>
                    <span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;any&quot;</span><span class="s2">,</span>
                    <span class="s3">&quot;constraints&quot;</span><span class="s1">: {</span><span class="s3">&quot;enum&quot;</span><span class="s1">: [</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]}</span><span class="s2">,</span>
                    <span class="s3">&quot;ordered&quot;</span><span class="s1">: </span><span class="s2">False,</span>
                <span class="s1">}</span><span class="s2">,</span>
                <span class="s1">CategoricalDtype(categories=[</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ordered=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">)</span><span class="s2">,</span>
            <span class="s1">(</span>
                <span class="s1">{</span>
                    <span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;any&quot;</span><span class="s2">,</span>
                    <span class="s3">&quot;constraints&quot;</span><span class="s1">: {</span><span class="s3">&quot;enum&quot;</span><span class="s1">: [</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]}</span><span class="s2">,</span>
                    <span class="s3">&quot;ordered&quot;</span><span class="s1">: </span><span class="s2">True,</span>
                <span class="s1">}</span><span class="s2">,</span>
                <span class="s1">CategoricalDtype(categories=[</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ordered=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">)</span><span class="s2">,</span>
            <span class="s1">({</span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;string&quot;</span><span class="s1">}</span><span class="s2">, </span><span class="s3">&quot;object&quot;</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_convert_json_field_to_pandas_type(self</span><span class="s2">, </span><span class="s1">inp</span><span class="s2">, </span><span class="s1">exp):</span>
        <span class="s1">field = {</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;foo&quot;</span><span class="s1">}</span>
        <span class="s1">field.update(inp)</span>
        <span class="s2">assert </span><span class="s1">convert_json_field_to_pandas_type(field) == exp</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;inp&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;geopoint&quot;</span><span class="s2">, </span><span class="s3">&quot;geojson&quot;</span><span class="s2">, </span><span class="s3">&quot;fake_type&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_convert_json_field_to_pandas_type_raises(self</span><span class="s2">, </span><span class="s1">inp):</span>
        <span class="s1">field = {</span><span class="s3">&quot;type&quot;</span><span class="s1">: inp}</span>
        <span class="s2">with </span><span class="s1">pytest.raises(</span>
            <span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s3">f&quot;Unsupported or invalid field type: </span><span class="s2">{</span><span class="s1">inp</span><span class="s2">}</span><span class="s3">&quot;</span>
        <span class="s1">):</span>
            <span class="s1">convert_json_field_to_pandas_type(field)</span>

    <span class="s2">def </span><span class="s1">test_categorical(self):</span>
        <span class="s1">s = pd.Series(pd.Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s1">]))</span>
        <span class="s1">s.index.name = </span><span class="s3">&quot;idx&quot;</span>
        <span class="s1">result = s.to_json(orient=</span><span class="s3">&quot;table&quot;</span><span class="s2">, </span><span class="s1">date_format=</span><span class="s3">&quot;iso&quot;</span><span class="s1">)</span>
        <span class="s1">result = json.loads(result</span><span class="s2">, </span><span class="s1">object_pairs_hook=OrderedDict)</span>
        <span class="s1">result[</span><span class="s3">&quot;schema&quot;</span><span class="s1">].pop(</span><span class="s3">&quot;pandas_version&quot;</span><span class="s1">)</span>

        <span class="s1">fields = [</span>
            <span class="s1">{</span><span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;idx&quot;</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;integer&quot;</span><span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span>
                <span class="s3">&quot;constraints&quot;</span><span class="s1">: {</span><span class="s3">&quot;enum&quot;</span><span class="s1">: [</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s1">]}</span><span class="s2">,</span>
                <span class="s3">&quot;name&quot;</span><span class="s1">: </span><span class="s3">&quot;values&quot;</span><span class="s2">,</span>
                <span class="s3">&quot;ordered&quot;</span><span class="s1">: </span><span class="s2">False,</span>
                <span class="s3">&quot;type&quot;</span><span class="s1">: </span><span class="s3">&quot;any&quot;</span><span class="s2">,</span>
            <span class="s1">}</span><span class="s2">,</span>
        <span class="s1">]</span>

        <span class="s1">expected = OrderedDict(</span>
            <span class="s1">[</span>
                <span class="s1">(</span><span class="s3">&quot;schema&quot;</span><span class="s2">, </span><span class="s1">{</span><span class="s3">&quot;fields&quot;</span><span class="s1">: fields</span><span class="s2">, </span><span class="s3">&quot;primaryKey&quot;</span><span class="s1">: [</span><span class="s3">&quot;idx&quot;</span><span class="s1">]})</span><span class="s2">,</span>
                <span class="s1">(</span>
                    <span class="s3">&quot;data&quot;</span><span class="s2">,</span>
                    <span class="s1">[</span>
                        <span class="s1">OrderedDict([(</span><span class="s3">&quot;idx&quot;</span><span class="s2">, </span><span class="s4">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;values&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s1">)])</span><span class="s2">,</span>
                        <span class="s1">OrderedDict([(</span><span class="s3">&quot;idx&quot;</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;values&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s1">)])</span><span class="s2">,</span>
                        <span class="s1">OrderedDict([(</span><span class="s3">&quot;idx&quot;</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;values&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s1">)])</span><span class="s2">,</span>
                    <span class="s1">]</span><span class="s2">,</span>
                <span class="s1">)</span><span class="s2">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>

        <span class="s2">assert </span><span class="s1">result == expected</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;idx,nm,prop&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">(pd.Index([</span><span class="s4">1</span><span class="s1">])</span><span class="s2">, </span><span class="s3">&quot;index&quot;</span><span class="s2">, </span><span class="s3">&quot;name&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">(pd.Index([</span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;myname&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s3">&quot;myname&quot;</span><span class="s2">, </span><span class="s3">&quot;name&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">(</span>
                <span class="s1">pd.MultiIndex.from_product([(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s3">&quot;d&quot;</span><span class="s1">)])</span><span class="s2">,</span>
                <span class="s1">[</span><span class="s3">&quot;level_0&quot;</span><span class="s2">, </span><span class="s3">&quot;level_1&quot;</span><span class="s1">]</span><span class="s2">,</span>
                <span class="s3">&quot;names&quot;</span><span class="s2">,</span>
            <span class="s1">)</span><span class="s2">,</span>
            <span class="s1">(</span>
                <span class="s1">pd.MultiIndex.from_product(</span>
                    <span class="s1">[(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s3">&quot;d&quot;</span><span class="s1">)]</span><span class="s2">, </span><span class="s1">names=[</span><span class="s3">&quot;n1&quot;</span><span class="s2">, </span><span class="s3">&quot;n2&quot;</span><span class="s1">]</span>
                <span class="s1">)</span><span class="s2">,</span>
                <span class="s1">[</span><span class="s3">&quot;n1&quot;</span><span class="s2">, </span><span class="s3">&quot;n2&quot;</span><span class="s1">]</span><span class="s2">,</span>
                <span class="s3">&quot;names&quot;</span><span class="s2">,</span>
            <span class="s1">)</span><span class="s2">,</span>
            <span class="s1">(</span>
                <span class="s1">pd.MultiIndex.from_product(</span>
                    <span class="s1">[(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s3">&quot;d&quot;</span><span class="s1">)]</span><span class="s2">, </span><span class="s1">names=[</span><span class="s3">&quot;n1&quot;</span><span class="s2">, None</span><span class="s1">]</span>
                <span class="s1">)</span><span class="s2">,</span>
                <span class="s1">[</span><span class="s3">&quot;n1&quot;</span><span class="s2">, </span><span class="s3">&quot;level_1&quot;</span><span class="s1">]</span><span class="s2">,</span>
                <span class="s3">&quot;names&quot;</span><span class="s2">,</span>
            <span class="s1">)</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_set_names_unset(self</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">nm</span><span class="s2">, </span><span class="s1">prop):</span>
        <span class="s1">data = pd.Series(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">idx)</span>
        <span class="s1">result = set_default_names(data)</span>
        <span class="s2">assert </span><span class="s1">getattr(result.index</span><span class="s2">, </span><span class="s1">prop) == nm</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;idx&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">pd.Index([]</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;index&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">pd.MultiIndex.from_arrays([[</span><span class="s3">&quot;foo&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;bar&quot;</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">names=(</span><span class="s3">&quot;level_0&quot;</span><span class="s2">, </span><span class="s3">&quot;level_1&quot;</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">pd.MultiIndex.from_arrays([[</span><span class="s3">&quot;foo&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;bar&quot;</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">names=(</span><span class="s3">&quot;foo&quot;</span><span class="s2">, </span><span class="s3">&quot;level_1&quot;</span><span class="s1">))</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_warns_non_roundtrippable_names(self</span><span class="s2">, </span><span class="s1">idx):</span>
        <span class="s5"># GH 19130</span>
        <span class="s1">df = DataFrame(index=idx)</span>
        <span class="s1">df.index.name = </span><span class="s3">&quot;index&quot;</span>
        <span class="s2">with </span><span class="s1">tm.assert_produces_warning():</span>
            <span class="s1">set_default_names(df)</span>

    <span class="s2">def </span><span class="s1">test_timestamp_in_columns(self):</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">[[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">columns=[pd.Timestamp(</span><span class="s3">&quot;2016&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">pd.Timedelta(</span><span class="s4">10</span><span class="s2">, </span><span class="s1">unit=</span><span class="s3">&quot;s&quot;</span><span class="s1">)]</span>
        <span class="s1">)</span>
        <span class="s1">result = df.to_json(orient=</span><span class="s3">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">js = json.loads(result)</span>
        <span class="s2">assert </span><span class="s1">js[</span><span class="s3">&quot;schema&quot;</span><span class="s1">][</span><span class="s3">&quot;fields&quot;</span><span class="s1">][</span><span class="s4">1</span><span class="s1">][</span><span class="s3">&quot;name&quot;</span><span class="s1">] == </span><span class="s3">&quot;2016-01-01T00:00:00.000Z&quot;</span>
        <span class="s2">assert </span><span class="s1">js[</span><span class="s3">&quot;schema&quot;</span><span class="s1">][</span><span class="s3">&quot;fields&quot;</span><span class="s1">][</span><span class="s4">2</span><span class="s1">][</span><span class="s3">&quot;name&quot;</span><span class="s1">] == </span><span class="s3">&quot;P0DT0H0M10S&quot;</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;case&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">pd.Series([</span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">index=pd.Index([</span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;a&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;a&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">DataFrame({</span><span class="s3">&quot;A&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s1">]}</span><span class="s2">, </span><span class="s1">index=pd.Index([</span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;A&quot;</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">DataFrame(</span>
                <span class="s1">{</span><span class="s3">&quot;A&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s1">]}</span><span class="s2">,</span>
                <span class="s1">index=pd.MultiIndex.from_arrays([[</span><span class="s3">&quot;a&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">names=[</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s1">])</span><span class="s2">,</span>
            <span class="s1">)</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_overlapping_names(self</span><span class="s2">, </span><span class="s1">case):</span>
        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s3">&quot;Overlapping&quot;</span><span class="s1">):</span>
            <span class="s1">case.to_json(orient=</span><span class="s3">&quot;table&quot;</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_mi_falsey_name(self):</span>
        <span class="s5"># GH 16203</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">np.random.randn(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">index=pd.MultiIndex.from_product([(</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;B&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s1">)])</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">result = [x[</span><span class="s3">&quot;name&quot;</span><span class="s1">] </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">build_table_schema(df)[</span><span class="s3">&quot;fields&quot;</span><span class="s1">]]</span>
        <span class="s2">assert </span><span class="s1">result == [</span><span class="s3">&quot;level_0&quot;</span><span class="s2">, </span><span class="s3">&quot;level_1&quot;</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span>


<span class="s2">class </span><span class="s1">TestTableOrientReader:</span>
    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;index_nm&quot;</span><span class="s2">,</span>
        <span class="s1">[</span><span class="s2">None, </span><span class="s3">&quot;idx&quot;</span><span class="s2">, </span><span class="s1">pytest.param(</span><span class="s3">&quot;index&quot;</span><span class="s2">, </span><span class="s1">marks=pytest.mark.xfail)</span><span class="s2">, </span><span class="s3">&quot;level_0&quot;</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;vals&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">{</span><span class="s3">&quot;ints&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;objects&quot;</span><span class="s1">: [</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s3">&quot;d&quot;</span><span class="s1">]}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;objects&quot;</span><span class="s1">: [</span><span class="s3">&quot;1&quot;</span><span class="s2">, </span><span class="s3">&quot;2&quot;</span><span class="s2">, </span><span class="s3">&quot;3&quot;</span><span class="s2">, </span><span class="s3">&quot;4&quot;</span><span class="s1">]}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;date_ranges&quot;</span><span class="s1">: pd.date_range(</span><span class="s3">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;d&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s1">)}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;categoricals&quot;</span><span class="s1">: pd.Series(pd.Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]))}</span><span class="s2">,</span>
            <span class="s1">{</span>
                <span class="s3">&quot;ordered_cats&quot;</span><span class="s1">: pd.Series(</span>
                    <span class="s1">pd.Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ordered=</span><span class="s2">True</span><span class="s1">)</span>
                <span class="s1">)</span>
            <span class="s1">}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;floats&quot;</span><span class="s1">: [</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">3.0</span><span class="s2">, </span><span class="s4">4.0</span><span class="s1">]}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;floats&quot;</span><span class="s1">: [</span><span class="s4">1.1</span><span class="s2">, </span><span class="s4">2.2</span><span class="s2">, </span><span class="s4">3.3</span><span class="s2">, </span><span class="s4">4.4</span><span class="s1">]}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;bools&quot;</span><span class="s1">: [</span><span class="s2">True, False, False, True</span><span class="s1">]}</span><span class="s2">,</span>
            <span class="s1">{</span>
                <span class="s3">&quot;timezones&quot;</span><span class="s1">: pd.date_range(</span>
                    <span class="s3">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;d&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s2">, </span><span class="s1">tz=</span><span class="s3">&quot;US/Central&quot;</span>
                <span class="s1">)  </span><span class="s5"># added in # GH 35973</span>
            <span class="s1">}</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_read_json_table_orient(self</span><span class="s2">, </span><span class="s1">index_nm</span><span class="s2">, </span><span class="s1">vals</span><span class="s2">, </span><span class="s1">recwarn):</span>
        <span class="s1">df = DataFrame(vals</span><span class="s2">, </span><span class="s1">index=pd.Index(range(</span><span class="s4">4</span><span class="s1">)</span><span class="s2">, </span><span class="s1">name=index_nm))</span>
        <span class="s1">out = df.to_json(orient=</span><span class="s3">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">result = pd.read_json(out</span><span class="s2">, </span><span class="s1">orient=</span><span class="s3">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s2">, </span><span class="s1">result)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;index_nm&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s2">None, </span><span class="s3">&quot;idx&quot;</span><span class="s2">, </span><span class="s3">&quot;index&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;vals&quot;</span><span class="s2">,</span>
        <span class="s1">[{</span><span class="s3">&quot;timedeltas&quot;</span><span class="s1">: pd.timedelta_range(</span><span class="s3">&quot;1H&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;T&quot;</span><span class="s1">)}]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_read_json_table_orient_raises(self</span><span class="s2">, </span><span class="s1">index_nm</span><span class="s2">, </span><span class="s1">vals</span><span class="s2">, </span><span class="s1">recwarn):</span>
        <span class="s1">df = DataFrame(vals</span><span class="s2">, </span><span class="s1">index=pd.Index(range(</span><span class="s4">4</span><span class="s1">)</span><span class="s2">, </span><span class="s1">name=index_nm))</span>
        <span class="s1">out = df.to_json(orient=</span><span class="s3">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s2">with </span><span class="s1">pytest.raises(NotImplementedError</span><span class="s2">, </span><span class="s1">match=</span><span class="s3">&quot;can not yet read &quot;</span><span class="s1">):</span>
            <span class="s1">pd.read_json(out</span><span class="s2">, </span><span class="s1">orient=</span><span class="s3">&quot;table&quot;</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;idx&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">pd.Index(range(</span><span class="s4">4</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">pd.date_range(</span>
                <span class="s3">&quot;2020-08-30&quot;</span><span class="s2">,</span>
                <span class="s1">freq=</span><span class="s3">&quot;d&quot;</span><span class="s2">,</span>
                <span class="s1">periods=</span><span class="s4">4</span><span class="s2">,</span>
            <span class="s1">)._with_freq(</span><span class="s2">None</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">pd.date_range(</span>
                <span class="s3">&quot;2020-08-30&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;d&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s2">, </span><span class="s1">tz=</span><span class="s3">&quot;US/Central&quot;</span>
            <span class="s1">)._with_freq(</span><span class="s2">None</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">pd.MultiIndex.from_product(</span>
                <span class="s1">[</span>
                    <span class="s1">pd.date_range(</span><span class="s3">&quot;2020-08-30&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;d&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">2</span><span class="s2">, </span><span class="s1">tz=</span><span class="s3">&quot;US/Central&quot;</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">[</span><span class="s3">&quot;x&quot;</span><span class="s2">, </span><span class="s3">&quot;y&quot;</span><span class="s1">]</span><span class="s2">,</span>
                <span class="s1">]</span><span class="s2">,</span>
            <span class="s1">)</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;vals&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">{</span><span class="s3">&quot;floats&quot;</span><span class="s1">: [</span><span class="s4">1.1</span><span class="s2">, </span><span class="s4">2.2</span><span class="s2">, </span><span class="s4">3.3</span><span class="s2">, </span><span class="s4">4.4</span><span class="s1">]}</span><span class="s2">,</span>
            <span class="s1">{</span><span class="s3">&quot;dates&quot;</span><span class="s1">: pd.date_range(</span><span class="s3">&quot;2020-08-30&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;d&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s1">)}</span><span class="s2">,</span>
            <span class="s1">{</span>
                <span class="s3">&quot;timezones&quot;</span><span class="s1">: pd.date_range(</span>
                    <span class="s3">&quot;2020-08-30&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;d&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s2">, </span><span class="s1">tz=</span><span class="s3">&quot;Europe/London&quot;</span>
                <span class="s1">)</span>
            <span class="s1">}</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_read_json_table_timezones_orient(self</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">vals</span><span class="s2">, </span><span class="s1">recwarn):</span>
        <span class="s5"># GH 35973</span>
        <span class="s1">df = DataFrame(vals</span><span class="s2">, </span><span class="s1">index=idx)</span>
        <span class="s1">out = df.to_json(orient=</span><span class="s3">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">result = pd.read_json(out</span><span class="s2">, </span><span class="s1">orient=</span><span class="s3">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s2">, </span><span class="s1">result)</span>

    <span class="s1">@pytest.mark.filterwarnings(</span>
        <span class="s3">&quot;ignore:an integer is required (got type float)*:DeprecationWarning&quot;</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_comprehensive(self):</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s3">&quot;A&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]</span><span class="s2">,</span>
                <span class="s3">&quot;B&quot;</span><span class="s1">: [</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s2">,</span>
                <span class="s3">&quot;C&quot;</span><span class="s1">: pd.date_range(</span><span class="s3">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;d&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s5"># 'D': pd.timedelta_range('1H', periods=4, freq='T'),</span>
                <span class="s3">&quot;E&quot;</span><span class="s1">: pd.Series(pd.Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]))</span><span class="s2">,</span>
                <span class="s3">&quot;F&quot;</span><span class="s1">: pd.Series(pd.Categorical([</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ordered=</span><span class="s2">True</span><span class="s1">))</span><span class="s2">,</span>
                <span class="s3">&quot;G&quot;</span><span class="s1">: [</span><span class="s4">1.1</span><span class="s2">, </span><span class="s4">2.2</span><span class="s2">, </span><span class="s4">3.3</span><span class="s2">, </span><span class="s4">4.4</span><span class="s1">]</span><span class="s2">,</span>
                <span class="s3">&quot;H&quot;</span><span class="s1">: pd.date_range(</span><span class="s3">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">freq=</span><span class="s3">&quot;d&quot;</span><span class="s2">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s2">, </span><span class="s1">tz=</span><span class="s3">&quot;US/Central&quot;</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s3">&quot;I&quot;</span><span class="s1">: [</span><span class="s2">True, False, False, True</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">}</span><span class="s2">,</span>
            <span class="s1">index=pd.Index(range(</span><span class="s4">4</span><span class="s1">)</span><span class="s2">, </span><span class="s1">name=</span><span class="s3">&quot;idx&quot;</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">)</span>

        <span class="s1">out = df.to_json(orient=</span><span class="s3">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">result = pd.read_json(out</span><span class="s2">, </span><span class="s1">orient=</span><span class="s3">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s2">, </span><span class="s1">result)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;index_names&quot;</span><span class="s2">,</span>
        <span class="s1">[[</span><span class="s2">None, None</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;foo&quot;</span><span class="s2">, </span><span class="s3">&quot;bar&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;foo&quot;</span><span class="s2">, None</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s2">None, </span><span class="s3">&quot;foo&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;index&quot;</span><span class="s2">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">]]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_multiindex(self</span><span class="s2">, </span><span class="s1">index_names):</span>
        <span class="s5"># GH 18912</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">[[</span><span class="s3">&quot;Arr&quot;</span><span class="s2">, </span><span class="s3">&quot;alpha&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;Bee&quot;</span><span class="s2">, </span><span class="s3">&quot;Beta&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s4">40</span><span class="s1">]]]</span><span class="s2">,</span>
            <span class="s1">index=[[</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;B&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;Null&quot;</span><span class="s2">, </span><span class="s3">&quot;Eins&quot;</span><span class="s1">]]</span><span class="s2">,</span>
            <span class="s1">columns=[</span><span class="s3">&quot;Aussprache&quot;</span><span class="s2">, </span><span class="s3">&quot;Griechisch&quot;</span><span class="s2">, </span><span class="s3">&quot;Args&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">)</span>
        <span class="s1">df.index.names = index_names</span>
        <span class="s1">out = df.to_json(orient=</span><span class="s3">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">result = pd.read_json(out</span><span class="s2">, </span><span class="s1">orient=</span><span class="s3">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s2">, </span><span class="s1">result)</span>

    <span class="s2">def </span><span class="s1">test_empty_frame_roundtrip(self):</span>
        <span class="s5"># GH 21287</span>
        <span class="s1">df = DataFrame(columns=[</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">expected = df.copy()</span>
        <span class="s1">out = df.to_json(orient=</span><span class="s3">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">result = pd.read_json(out</span><span class="s2">, </span><span class="s1">orient=</span><span class="s3">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(expected</span><span class="s2">, </span><span class="s1">result)</span>

    <span class="s2">def </span><span class="s1">test_read_json_orient_table_old_schema_version(self):</span>
        <span class="s1">df_json = </span><span class="s3">&quot;&quot;&quot; 
        { 
            &quot;schema&quot;:{ 
                &quot;fields&quot;:[ 
                    {&quot;name&quot;:&quot;index&quot;,&quot;type&quot;:&quot;integer&quot;}, 
                    {&quot;name&quot;:&quot;a&quot;,&quot;type&quot;:&quot;string&quot;} 
                ], 
                &quot;primaryKey&quot;:[&quot;index&quot;], 
                &quot;pandas_version&quot;:&quot;0.20.0&quot; 
            }, 
            &quot;data&quot;:[ 
                {&quot;index&quot;:0,&quot;a&quot;:1}, 
                {&quot;index&quot;:1,&quot;a&quot;:2.0}, 
                {&quot;index&quot;:2,&quot;a&quot;:&quot;s&quot;} 
            ] 
        } 
        &quot;&quot;&quot;</span>
        <span class="s1">expected = DataFrame({</span><span class="s3">&quot;a&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">, </span><span class="s3">&quot;s&quot;</span><span class="s1">]})</span>
        <span class="s1">result = pd.read_json(df_json</span><span class="s2">, </span><span class="s1">orient=</span><span class="s3">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(expected</span><span class="s2">, </span><span class="s1">result)</span>
</pre>
</body>
</html>