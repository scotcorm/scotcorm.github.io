<html>
<head>
<title>test_datetime_index.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_datetime_index.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">datetime</span>
<span class="s0">from </span><span class="s1">functools </span><span class="s0">import </span><span class="s1">partial</span>
<span class="s0">from </span><span class="s1">io </span><span class="s0">import </span><span class="s1">StringIO</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">import </span><span class="s1">pytz</span>

<span class="s0">from </span><span class="s1">pandas._libs </span><span class="s0">import </span><span class="s1">lib</span>
<span class="s0">from </span><span class="s1">pandas.errors </span><span class="s0">import </span><span class="s1">UnsupportedFunctionCall</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">DataFrame</span><span class="s0">,</span>
    <span class="s1">Series</span><span class="s0">,</span>
    <span class="s1">Timedelta</span><span class="s0">,</span>
    <span class="s1">Timestamp</span><span class="s0">,</span>
    <span class="s1">isna</span><span class="s0">,</span>
    <span class="s1">notna</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">pandas._testing </span><span class="s0">as </span><span class="s1">tm</span>
<span class="s0">from </span><span class="s1">pandas.core.groupby.grouper </span><span class="s0">import </span><span class="s1">Grouper</span>
<span class="s0">from </span><span class="s1">pandas.core.indexes.datetimes </span><span class="s0">import </span><span class="s1">date_range</span>
<span class="s0">from </span><span class="s1">pandas.core.indexes.period </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">Period</span><span class="s0">,</span>
    <span class="s1">period_range</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">from </span><span class="s1">pandas.core.resample </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">DatetimeIndex</span><span class="s0">,</span>
    <span class="s1">_get_timestamp_range_edges</span><span class="s0">,</span>
<span class="s1">)</span>

<span class="s0">import </span><span class="s1">pandas.tseries.offsets </span><span class="s0">as </span><span class="s1">offsets</span>
<span class="s0">from </span><span class="s1">pandas.tseries.offsets </span><span class="s0">import </span><span class="s1">Minute</span>


<span class="s1">@pytest.fixture()</span>
<span class="s0">def </span><span class="s1">_index_factory():</span>
    <span class="s0">return </span><span class="s1">date_range</span>


<span class="s1">@pytest.fixture</span>
<span class="s0">def </span><span class="s1">_index_freq():</span>
    <span class="s0">return </span><span class="s2">&quot;Min&quot;</span>


<span class="s1">@pytest.fixture</span>
<span class="s0">def </span><span class="s1">_static_values(index):</span>
    <span class="s0">return </span><span class="s1">np.random.rand(len(index))</span>


<span class="s0">def </span><span class="s1">test_custom_grouper(index):</span>

    <span class="s1">dti = index</span>
    <span class="s1">s = Series(np.array([</span><span class="s3">1</span><span class="s1">] * len(dti))</span><span class="s0">, </span><span class="s1">index=dti</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;int64&quot;</span><span class="s1">)</span>

    <span class="s1">b = Grouper(freq=Minute(</span><span class="s3">5</span><span class="s1">))</span>
    <span class="s1">g = s.groupby(b)</span>

    <span class="s4"># check all cython functions work</span>
    <span class="s1">g.ohlc()  </span><span class="s4"># doesn't use _cython_agg_general</span>
    <span class="s1">funcs = [</span><span class="s2">&quot;add&quot;</span><span class="s0">, </span><span class="s2">&quot;mean&quot;</span><span class="s0">, </span><span class="s2">&quot;prod&quot;</span><span class="s0">, </span><span class="s2">&quot;min&quot;</span><span class="s0">, </span><span class="s2">&quot;max&quot;</span><span class="s0">, </span><span class="s2">&quot;var&quot;</span><span class="s1">]</span>
    <span class="s0">for </span><span class="s1">f </span><span class="s0">in </span><span class="s1">funcs:</span>
        <span class="s1">g._cython_agg_general(f</span><span class="s0">, </span><span class="s1">alt=</span><span class="s0">None, </span><span class="s1">numeric_only=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s1">b = Grouper(freq=Minute(</span><span class="s3">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;right&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;right&quot;</span><span class="s1">)</span>
    <span class="s1">g = s.groupby(b)</span>
    <span class="s4"># check all cython functions work</span>
    <span class="s1">g.ohlc()  </span><span class="s4"># doesn't use _cython_agg_general</span>
    <span class="s1">funcs = [</span><span class="s2">&quot;add&quot;</span><span class="s0">, </span><span class="s2">&quot;mean&quot;</span><span class="s0">, </span><span class="s2">&quot;prod&quot;</span><span class="s0">, </span><span class="s2">&quot;min&quot;</span><span class="s0">, </span><span class="s2">&quot;max&quot;</span><span class="s0">, </span><span class="s2">&quot;var&quot;</span><span class="s1">]</span>
    <span class="s0">for </span><span class="s1">f </span><span class="s0">in </span><span class="s1">funcs:</span>
        <span class="s1">g._cython_agg_general(f</span><span class="s0">, </span><span class="s1">alt=</span><span class="s0">None, </span><span class="s1">numeric_only=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">g.ngroups == </span><span class="s3">2593</span>
    <span class="s0">assert </span><span class="s1">notna(g.mean()).all()</span>

    <span class="s4"># construct expected val</span>
    <span class="s1">arr = [</span><span class="s3">1</span><span class="s1">] + [</span><span class="s3">5</span><span class="s1">] * </span><span class="s3">2592</span>
    <span class="s1">idx = dti[</span><span class="s3">0</span><span class="s1">:-</span><span class="s3">1</span><span class="s1">:</span><span class="s3">5</span><span class="s1">]</span>
    <span class="s1">idx = idx.append(dti[-</span><span class="s3">1</span><span class="s1">:])</span>
    <span class="s1">idx = DatetimeIndex(idx</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;5T&quot;</span><span class="s1">)</span>
    <span class="s1">expect = Series(arr</span><span class="s0">, </span><span class="s1">index=idx)</span>

    <span class="s4"># GH2763 - return input dtype if we can</span>
    <span class="s1">result = g.agg(np.sum)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expect)</span>

    <span class="s1">df = DataFrame(np.random.rand(len(dti)</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=dti</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;float64&quot;</span><span class="s1">)</span>
    <span class="s1">r = df.groupby(b).agg(np.sum)</span>

    <span class="s0">assert </span><span class="s1">len(r.columns) == </span><span class="s3">10</span>
    <span class="s0">assert </span><span class="s1">len(r.index) == </span><span class="s3">2593</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;_index_start,_index_end,_index_name&quot;</span><span class="s0">,</span>
    <span class="s1">[(</span><span class="s2">&quot;1/1/2000 00:00:00&quot;</span><span class="s0">, </span><span class="s2">&quot;1/1/2000 00:13:00&quot;</span><span class="s0">, </span><span class="s2">&quot;index&quot;</span><span class="s1">)]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;closed, expected&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span>
            <span class="s2">&quot;right&quot;</span><span class="s0">,</span>
            <span class="s0">lambda </span><span class="s1">s: Series(</span>
                <span class="s1">[s[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">s[</span><span class="s3">1</span><span class="s1">:</span><span class="s3">6</span><span class="s1">].mean()</span><span class="s0">, </span><span class="s1">s[</span><span class="s3">6</span><span class="s1">:</span><span class="s3">11</span><span class="s1">].mean()</span><span class="s0">, </span><span class="s1">s[</span><span class="s3">11</span><span class="s1">:].mean()]</span><span class="s0">,</span>
                <span class="s1">index=date_range(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;index&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s2">&quot;left&quot;</span><span class="s0">,</span>
            <span class="s0">lambda </span><span class="s1">s: Series(</span>
                <span class="s1">[s[:</span><span class="s3">5</span><span class="s1">].mean()</span><span class="s0">, </span><span class="s1">s[</span><span class="s3">5</span><span class="s1">:</span><span class="s3">10</span><span class="s1">].mean()</span><span class="s0">, </span><span class="s1">s[</span><span class="s3">10</span><span class="s1">:].mean()]</span><span class="s0">,</span>
                <span class="s1">index=date_range(</span>
                    <span class="s2">&quot;1/1/2000 00:05&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;index&quot;</span>
                <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_resample_basic(series</span><span class="s0">, </span><span class="s1">closed</span><span class="s0">, </span><span class="s1">expected):</span>
    <span class="s1">s = series</span>
    <span class="s1">expected = expected(s)</span>
    <span class="s1">result = s.resample(</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">closed=closed</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;right&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_resample_integerarray():</span>
    <span class="s4"># GH 25580, resample on IntegerArray</span>
    <span class="s1">ts = Series(</span>
        <span class="s1">range(</span><span class="s3">9</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=date_range(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">9</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;T&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;Int64&quot;</span>
    <span class="s1">)</span>
    <span class="s1">result = ts.resample(</span><span class="s2">&quot;3T&quot;</span><span class="s1">).sum()</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">[</span><span class="s3">3</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">21</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">index=date_range(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;3T&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">dtype=</span><span class="s2">&quot;Int64&quot;</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ts.resample(</span><span class="s2">&quot;3T&quot;</span><span class="s1">).mean()</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">7</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">index=date_range(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;3T&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">dtype=</span><span class="s2">&quot;Float64&quot;</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_resample_basic_grouper(series):</span>
    <span class="s1">s = series</span>
    <span class="s1">result = s.resample(</span><span class="s2">&quot;5Min&quot;</span><span class="s1">).last()</span>
    <span class="s1">grouper = Grouper(freq=Minute(</span><span class="s3">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;left&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;left&quot;</span><span class="s1">)</span>
    <span class="s1">expected = s.groupby(grouper).agg(</span><span class="s0">lambda </span><span class="s1">x: x[-</span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;_index_start,_index_end,_index_name&quot;</span><span class="s0">,</span>
    <span class="s1">[(</span><span class="s2">&quot;1/1/2000 00:00:00&quot;</span><span class="s0">, </span><span class="s2">&quot;1/1/2000 00:13:00&quot;</span><span class="s0">, </span><span class="s2">&quot;index&quot;</span><span class="s1">)]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;keyword,value&quot;</span><span class="s0">,</span>
    <span class="s1">[(</span><span class="s2">&quot;label&quot;</span><span class="s0">, </span><span class="s2">&quot;righttt&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;closed&quot;</span><span class="s0">, </span><span class="s2">&quot;righttt&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;convention&quot;</span><span class="s0">, </span><span class="s2">&quot;starttt&quot;</span><span class="s1">)]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_resample_string_kwargs(series</span><span class="s0">, </span><span class="s1">keyword</span><span class="s0">, </span><span class="s1">value):</span>
    <span class="s4"># see gh-19303</span>
    <span class="s4"># Check that wrong keyword argument strings raise an error</span>
    <span class="s1">msg = </span><span class="s2">f&quot;Unsupported value </span><span class="s0">{</span><span class="s1">value</span><span class="s0">} </span><span class="s2">for `</span><span class="s0">{</span><span class="s1">keyword</span><span class="s0">}</span><span class="s2">`&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">series.resample(</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">**({keyword: value}))</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;_index_start,_index_end,_index_name&quot;</span><span class="s0">,</span>
    <span class="s1">[(</span><span class="s2">&quot;1/1/2000 00:00:00&quot;</span><span class="s0">, </span><span class="s2">&quot;1/1/2000 00:13:00&quot;</span><span class="s0">, </span><span class="s2">&quot;index&quot;</span><span class="s1">)]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_resample_how(series</span><span class="s0">, </span><span class="s1">downsample_method):</span>
    <span class="s0">if </span><span class="s1">downsample_method == </span><span class="s2">&quot;ohlc&quot;</span><span class="s1">:</span>
        <span class="s1">pytest.skip(</span><span class="s2">&quot;covered by test_resample_how_ohlc&quot;</span><span class="s1">)</span>

    <span class="s1">s = series</span>
    <span class="s1">grouplist = np.ones_like(s)</span>
    <span class="s1">grouplist[</span><span class="s3">0</span><span class="s1">] = </span><span class="s3">0</span>
    <span class="s1">grouplist[</span><span class="s3">1</span><span class="s1">:</span><span class="s3">6</span><span class="s1">] = </span><span class="s3">1</span>
    <span class="s1">grouplist[</span><span class="s3">6</span><span class="s1">:</span><span class="s3">11</span><span class="s1">] = </span><span class="s3">2</span>
    <span class="s1">grouplist[</span><span class="s3">11</span><span class="s1">:] = </span><span class="s3">3</span>
    <span class="s1">expected = s.groupby(grouplist).agg(downsample_method)</span>
    <span class="s1">expected.index = date_range(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;index&quot;</span><span class="s1">)</span>

    <span class="s1">result = getattr(</span>
        <span class="s1">s.resample(</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;right&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;right&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">downsample_method</span>
    <span class="s1">)()</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;_index_start,_index_end,_index_name&quot;</span><span class="s0">,</span>
    <span class="s1">[(</span><span class="s2">&quot;1/1/2000 00:00:00&quot;</span><span class="s0">, </span><span class="s2">&quot;1/1/2000 00:13:00&quot;</span><span class="s0">, </span><span class="s2">&quot;index&quot;</span><span class="s1">)]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_resample_how_ohlc(series):</span>
    <span class="s1">s = series</span>
    <span class="s1">grouplist = np.ones_like(s)</span>
    <span class="s1">grouplist[</span><span class="s3">0</span><span class="s1">] = </span><span class="s3">0</span>
    <span class="s1">grouplist[</span><span class="s3">1</span><span class="s1">:</span><span class="s3">6</span><span class="s1">] = </span><span class="s3">1</span>
    <span class="s1">grouplist[</span><span class="s3">6</span><span class="s1">:</span><span class="s3">11</span><span class="s1">] = </span><span class="s3">2</span>
    <span class="s1">grouplist[</span><span class="s3">11</span><span class="s1">:] = </span><span class="s3">3</span>

    <span class="s0">def </span><span class="s1">_ohlc(group):</span>
        <span class="s0">if </span><span class="s1">isna(group).all():</span>
            <span class="s0">return </span><span class="s1">np.repeat(np.nan</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>
        <span class="s0">return </span><span class="s1">[group[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">group.max()</span><span class="s0">, </span><span class="s1">group.min()</span><span class="s0">, </span><span class="s1">group[-</span><span class="s3">1</span><span class="s1">]]</span>

    <span class="s1">expected = DataFrame(</span>
        <span class="s1">s.groupby(grouplist).agg(_ohlc).values.tolist()</span><span class="s0">,</span>
        <span class="s1">index=date_range(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;index&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">columns=[</span><span class="s2">&quot;open&quot;</span><span class="s0">, </span><span class="s2">&quot;high&quot;</span><span class="s0">, </span><span class="s2">&quot;low&quot;</span><span class="s0">, </span><span class="s2">&quot;close&quot;</span><span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s1">result = s.resample(</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;right&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;right&quot;</span><span class="s1">).ohlc()</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;func&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;min&quot;</span><span class="s0">, </span><span class="s2">&quot;max&quot;</span><span class="s0">, </span><span class="s2">&quot;sum&quot;</span><span class="s0">, </span><span class="s2">&quot;prod&quot;</span><span class="s0">, </span><span class="s2">&quot;mean&quot;</span><span class="s0">, </span><span class="s2">&quot;var&quot;</span><span class="s0">, </span><span class="s2">&quot;std&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_numpy_compat(func):</span>
    <span class="s4"># see gh-12811</span>
    <span class="s1">s = Series([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">5</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;s&quot;</span><span class="s1">))</span>
    <span class="s1">r = s.resample(</span><span class="s2">&quot;2s&quot;</span><span class="s1">)</span>

    <span class="s1">msg = </span><span class="s2">&quot;numpy operations are not valid with resample&quot;</span>

    <span class="s0">with </span><span class="s1">pytest.raises(UnsupportedFunctionCall</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">getattr(r</span><span class="s0">, </span><span class="s1">func)(func</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(UnsupportedFunctionCall</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">getattr(r</span><span class="s0">, </span><span class="s1">func)(axis=</span><span class="s3">1</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_resample_how_callables():</span>
    <span class="s4"># GH#7929</span>
    <span class="s1">data = np.arange(</span><span class="s3">5</span><span class="s0">, </span><span class="s1">dtype=np.int64)</span>
    <span class="s1">ind = date_range(start=</span><span class="s2">&quot;2014-01-01&quot;</span><span class="s0">, </span><span class="s1">periods=len(data)</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;d&quot;</span><span class="s1">)</span>
    <span class="s1">df = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: data</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: data}</span><span class="s0">, </span><span class="s1">index=ind)</span>

    <span class="s0">def </span><span class="s1">fn(x</span><span class="s0">, </span><span class="s1">a=</span><span class="s3">1</span><span class="s1">):</span>
        <span class="s0">return </span><span class="s1">str(type(x))</span>

    <span class="s0">class </span><span class="s1">FnClass:</span>
        <span class="s0">def </span><span class="s1">__call__(self</span><span class="s0">, </span><span class="s1">x):</span>
            <span class="s0">return </span><span class="s1">str(type(x))</span>

    <span class="s1">df_standard = df.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).apply(fn)</span>
    <span class="s1">df_lambda = df.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).apply(</span><span class="s0">lambda </span><span class="s1">x: str(type(x)))</span>
    <span class="s1">df_partial = df.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).apply(partial(fn))</span>
    <span class="s1">df_partial2 = df.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).apply(partial(fn</span><span class="s0">, </span><span class="s1">a=</span><span class="s3">2</span><span class="s1">))</span>
    <span class="s1">df_class = df.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).apply(FnClass())</span>

    <span class="s1">tm.assert_frame_equal(df_standard</span><span class="s0">, </span><span class="s1">df_lambda)</span>
    <span class="s1">tm.assert_frame_equal(df_standard</span><span class="s0">, </span><span class="s1">df_partial)</span>
    <span class="s1">tm.assert_frame_equal(df_standard</span><span class="s0">, </span><span class="s1">df_partial2)</span>
    <span class="s1">tm.assert_frame_equal(df_standard</span><span class="s0">, </span><span class="s1">df_class)</span>


<span class="s0">def </span><span class="s1">test_resample_rounding():</span>
    <span class="s4"># GH 8371</span>
    <span class="s4"># odd results when rounding is needed</span>

    <span class="s1">data = </span><span class="s2">&quot;&quot;&quot;date,time,value 
11-08-2014,00:00:01.093,1 
11-08-2014,00:00:02.159,1 
11-08-2014,00:00:02.667,1 
11-08-2014,00:00:03.175,1 
11-08-2014,00:00:07.058,1 
11-08-2014,00:00:07.362,1 
11-08-2014,00:00:08.324,1 
11-08-2014,00:00:08.830,1 
11-08-2014,00:00:08.982,1 
11-08-2014,00:00:09.815,1 
11-08-2014,00:00:10.540,1 
11-08-2014,00:00:11.061,1 
11-08-2014,00:00:11.617,1 
11-08-2014,00:00:13.607,1 
11-08-2014,00:00:14.535,1 
11-08-2014,00:00:15.525,1 
11-08-2014,00:00:17.960,1 
11-08-2014,00:00:20.674,1 
11-08-2014,00:00:21.191,1&quot;&quot;&quot;</span>

    <span class="s1">df = pd.read_csv(</span>
        <span class="s1">StringIO(data)</span><span class="s0">,</span>
        <span class="s1">parse_dates={</span><span class="s2">&quot;timestamp&quot;</span><span class="s1">: [</span><span class="s2">&quot;date&quot;</span><span class="s0">, </span><span class="s2">&quot;time&quot;</span><span class="s1">]}</span><span class="s0">,</span>
        <span class="s1">index_col=</span><span class="s2">&quot;timestamp&quot;</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">df.index.name = </span><span class="s0">None</span>
    <span class="s1">result = df.resample(</span><span class="s2">&quot;6s&quot;</span><span class="s1">).sum()</span>
    <span class="s1">expected = DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;value&quot;</span><span class="s1">: [</span><span class="s3">4</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=date_range(</span><span class="s2">&quot;2014-11-08&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;6s&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = df.resample(</span><span class="s2">&quot;7s&quot;</span><span class="s1">).sum()</span>
    <span class="s1">expected = DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;value&quot;</span><span class="s1">: [</span><span class="s3">4</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=date_range(</span><span class="s2">&quot;2014-11-08&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;7s&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = df.resample(</span><span class="s2">&quot;11s&quot;</span><span class="s1">).sum()</span>
    <span class="s1">expected = DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;value&quot;</span><span class="s1">: [</span><span class="s3">11</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=date_range(</span><span class="s2">&quot;2014-11-08&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;11s&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = df.resample(</span><span class="s2">&quot;13s&quot;</span><span class="s1">).sum()</span>
    <span class="s1">expected = DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;value&quot;</span><span class="s1">: [</span><span class="s3">13</span><span class="s0">, </span><span class="s3">6</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=date_range(</span><span class="s2">&quot;2014-11-08&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;13s&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = df.resample(</span><span class="s2">&quot;17s&quot;</span><span class="s1">).sum()</span>
    <span class="s1">expected = DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;value&quot;</span><span class="s1">: [</span><span class="s3">16</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=date_range(</span><span class="s2">&quot;2014-11-08&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;17s&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_resample_basic_from_daily():</span>
    <span class="s4"># from daily</span>
    <span class="s1">dti = date_range(</span>
        <span class="s1">start=datetime(</span><span class="s3">2005</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=datetime(</span><span class="s3">2005</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;index&quot;</span>
    <span class="s1">)</span>

    <span class="s1">s = Series(np.random.rand(len(dti))</span><span class="s0">, </span><span class="s1">dti)</span>

    <span class="s4"># to weekly</span>
    <span class="s1">result = s.resample(</span><span class="s2">&quot;w-sun&quot;</span><span class="s1">).last()</span>

    <span class="s0">assert </span><span class="s1">len(result) == </span><span class="s3">3</span>
    <span class="s0">assert </span><span class="s1">(result.index.dayofweek == [</span><span class="s3">6</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">6</span><span class="s1">]).all()</span>
    <span class="s0">assert </span><span class="s1">result.iloc[</span><span class="s3">0</span><span class="s1">] == s[</span><span class="s2">&quot;1/2/2005&quot;</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">result.iloc[</span><span class="s3">1</span><span class="s1">] == s[</span><span class="s2">&quot;1/9/2005&quot;</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">result.iloc[</span><span class="s3">2</span><span class="s1">] == s.iloc[-</span><span class="s3">1</span><span class="s1">]</span>

    <span class="s1">result = s.resample(</span><span class="s2">&quot;W-MON&quot;</span><span class="s1">).last()</span>
    <span class="s0">assert </span><span class="s1">len(result) == </span><span class="s3">2</span>
    <span class="s0">assert </span><span class="s1">(result.index.dayofweek == [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]).all()</span>
    <span class="s0">assert </span><span class="s1">result.iloc[</span><span class="s3">0</span><span class="s1">] == s[</span><span class="s2">&quot;1/3/2005&quot;</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">result.iloc[</span><span class="s3">1</span><span class="s1">] == s[</span><span class="s2">&quot;1/10/2005&quot;</span><span class="s1">]</span>

    <span class="s1">result = s.resample(</span><span class="s2">&quot;W-TUE&quot;</span><span class="s1">).last()</span>
    <span class="s0">assert </span><span class="s1">len(result) == </span><span class="s3">2</span>
    <span class="s0">assert </span><span class="s1">(result.index.dayofweek == [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]).all()</span>
    <span class="s0">assert </span><span class="s1">result.iloc[</span><span class="s3">0</span><span class="s1">] == s[</span><span class="s2">&quot;1/4/2005&quot;</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">result.iloc[</span><span class="s3">1</span><span class="s1">] == s[</span><span class="s2">&quot;1/10/2005&quot;</span><span class="s1">]</span>

    <span class="s1">result = s.resample(</span><span class="s2">&quot;W-WED&quot;</span><span class="s1">).last()</span>
    <span class="s0">assert </span><span class="s1">len(result) == </span><span class="s3">2</span>
    <span class="s0">assert </span><span class="s1">(result.index.dayofweek == [</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]).all()</span>
    <span class="s0">assert </span><span class="s1">result.iloc[</span><span class="s3">0</span><span class="s1">] == s[</span><span class="s2">&quot;1/5/2005&quot;</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">result.iloc[</span><span class="s3">1</span><span class="s1">] == s[</span><span class="s2">&quot;1/10/2005&quot;</span><span class="s1">]</span>

    <span class="s1">result = s.resample(</span><span class="s2">&quot;W-THU&quot;</span><span class="s1">).last()</span>
    <span class="s0">assert </span><span class="s1">len(result) == </span><span class="s3">2</span>
    <span class="s0">assert </span><span class="s1">(result.index.dayofweek == [</span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]).all()</span>
    <span class="s0">assert </span><span class="s1">result.iloc[</span><span class="s3">0</span><span class="s1">] == s[</span><span class="s2">&quot;1/6/2005&quot;</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">result.iloc[</span><span class="s3">1</span><span class="s1">] == s[</span><span class="s2">&quot;1/10/2005&quot;</span><span class="s1">]</span>

    <span class="s1">result = s.resample(</span><span class="s2">&quot;W-FRI&quot;</span><span class="s1">).last()</span>
    <span class="s0">assert </span><span class="s1">len(result) == </span><span class="s3">2</span>
    <span class="s0">assert </span><span class="s1">(result.index.dayofweek == [</span><span class="s3">4</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]).all()</span>
    <span class="s0">assert </span><span class="s1">result.iloc[</span><span class="s3">0</span><span class="s1">] == s[</span><span class="s2">&quot;1/7/2005&quot;</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">result.iloc[</span><span class="s3">1</span><span class="s1">] == s[</span><span class="s2">&quot;1/10/2005&quot;</span><span class="s1">]</span>

    <span class="s4"># to biz day</span>
    <span class="s1">result = s.resample(</span><span class="s2">&quot;B&quot;</span><span class="s1">).last()</span>
    <span class="s0">assert </span><span class="s1">len(result) == </span><span class="s3">7</span>
    <span class="s0">assert </span><span class="s1">(result.index.dayofweek == [</span><span class="s3">4</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]).all()</span>

    <span class="s0">assert </span><span class="s1">result.iloc[</span><span class="s3">0</span><span class="s1">] == s[</span><span class="s2">&quot;1/2/2005&quot;</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">result.iloc[</span><span class="s3">1</span><span class="s1">] == s[</span><span class="s2">&quot;1/3/2005&quot;</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">result.iloc[</span><span class="s3">5</span><span class="s1">] == s[</span><span class="s2">&quot;1/9/2005&quot;</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">result.index.name == </span><span class="s2">&quot;index&quot;</span>


<span class="s0">def </span><span class="s1">test_resample_upsampling_picked_but_not_correct():</span>

    <span class="s4"># Test for issue #3020</span>
    <span class="s1">dates = date_range(</span><span class="s2">&quot;01-Jan-2014&quot;</span><span class="s0">, </span><span class="s2">&quot;05-Jan-2014&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">)</span>
    <span class="s1">series = Series(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">index=dates)</span>

    <span class="s1">result = series.resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).mean()</span>
    <span class="s0">assert </span><span class="s1">result.index[</span><span class="s3">0</span><span class="s1">] == dates[</span><span class="s3">0</span><span class="s1">]</span>

    <span class="s4"># GH 5955</span>
    <span class="s4"># incorrect deciding to upsample when the axis frequency matches the</span>
    <span class="s4"># resample frequency</span>

    <span class="s1">s = Series(</span>
        <span class="s1">np.arange(</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=[datetime(</span><span class="s3">1975</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">i</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">0</span><span class="s1">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">6</span><span class="s1">)]</span>
    <span class="s1">)</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">np.arange(</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=date_range(</span><span class="s2">&quot;19750101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">5</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">)</span>
    <span class="s1">)</span>

    <span class="s1">result = s.resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).count()</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">Series(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">index=expected.index))</span>

    <span class="s1">result1 = s.resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).sum()</span>
    <span class="s1">result2 = s.resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_series_equal(result1</span><span class="s0">, </span><span class="s1">expected)</span>
    <span class="s1">tm.assert_series_equal(result2</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_resample_frame_basic():</span>
    <span class="s1">df = tm.makeTimeDataFrame()</span>

    <span class="s1">b = Grouper(freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span>
    <span class="s1">g = df.groupby(b)</span>

    <span class="s4"># check all cython functions work</span>
    <span class="s1">funcs = [</span><span class="s2">&quot;add&quot;</span><span class="s0">, </span><span class="s2">&quot;mean&quot;</span><span class="s0">, </span><span class="s2">&quot;prod&quot;</span><span class="s0">, </span><span class="s2">&quot;min&quot;</span><span class="s0">, </span><span class="s2">&quot;max&quot;</span><span class="s0">, </span><span class="s2">&quot;var&quot;</span><span class="s1">]</span>
    <span class="s0">for </span><span class="s1">f </span><span class="s0">in </span><span class="s1">funcs:</span>
        <span class="s1">g._cython_agg_general(f</span><span class="s0">, </span><span class="s1">alt=</span><span class="s0">None, </span><span class="s1">numeric_only=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s1">result = df.resample(</span><span class="s2">&quot;A&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_series_equal(result[</span><span class="s2">&quot;A&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">df[</span><span class="s2">&quot;A&quot;</span><span class="s1">].resample(</span><span class="s2">&quot;A&quot;</span><span class="s1">).mean())</span>

    <span class="s1">result = df.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_series_equal(result[</span><span class="s2">&quot;A&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">df[</span><span class="s2">&quot;A&quot;</span><span class="s1">].resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).mean())</span>

    <span class="s1">df.resample(</span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;period&quot;</span><span class="s1">).mean()</span>
    <span class="s1">df.resample(</span><span class="s2">&quot;W-WED&quot;</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;period&quot;</span><span class="s1">).mean()</span>


<span class="s0">def </span><span class="s1">test_resample_upsample():</span>
    <span class="s4"># from daily</span>
    <span class="s1">dti = date_range(</span>
        <span class="s1">start=datetime(</span><span class="s3">2005</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=datetime(</span><span class="s3">2005</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;index&quot;</span>
    <span class="s1">)</span>

    <span class="s1">s = Series(np.random.rand(len(dti))</span><span class="s0">, </span><span class="s1">dti)</span>

    <span class="s4"># to minutely, by padding</span>
    <span class="s1">result = s.resample(</span><span class="s2">&quot;Min&quot;</span><span class="s1">).ffill()</span>
    <span class="s0">assert </span><span class="s1">len(result) == </span><span class="s3">12961</span>
    <span class="s0">assert </span><span class="s1">result[</span><span class="s3">0</span><span class="s1">] == s[</span><span class="s3">0</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">result[-</span><span class="s3">1</span><span class="s1">] == s[-</span><span class="s3">1</span><span class="s1">]</span>

    <span class="s0">assert </span><span class="s1">result.index.name == </span><span class="s2">&quot;index&quot;</span>


<span class="s0">def </span><span class="s1">test_resample_how_method():</span>
    <span class="s4"># GH9915</span>
    <span class="s1">s = Series(</span>
        <span class="s1">[</span><span class="s3">11</span><span class="s0">, </span><span class="s3">22</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">index=[</span>
            <span class="s1">Timestamp(</span><span class="s2">&quot;2015-03-31 21:48:52.672000&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">Timestamp(</span><span class="s2">&quot;2015-03-31 21:49:52.739000&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">[</span><span class="s3">11</span><span class="s0">, </span><span class="s1">np.NaN</span><span class="s0">, </span><span class="s1">np.NaN</span><span class="s0">, </span><span class="s1">np.NaN</span><span class="s0">, </span><span class="s1">np.NaN</span><span class="s0">, </span><span class="s1">np.NaN</span><span class="s0">, </span><span class="s3">22</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">index=DatetimeIndex(</span>
            <span class="s1">[</span>
                <span class="s1">Timestamp(</span><span class="s2">&quot;2015-03-31 21:48:50&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">Timestamp(</span><span class="s2">&quot;2015-03-31 21:49:00&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">Timestamp(</span><span class="s2">&quot;2015-03-31 21:49:10&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">Timestamp(</span><span class="s2">&quot;2015-03-31 21:49:20&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">Timestamp(</span><span class="s2">&quot;2015-03-31 21:49:30&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">Timestamp(</span><span class="s2">&quot;2015-03-31 21:49:40&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">Timestamp(</span><span class="s2">&quot;2015-03-31 21:49:50&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">freq=</span><span class="s2">&quot;10s&quot;</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(s.resample(</span><span class="s2">&quot;10S&quot;</span><span class="s1">).mean()</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_resample_extra_index_point():</span>
    <span class="s4"># GH#9756</span>
    <span class="s1">index = date_range(start=</span><span class="s2">&quot;20150101&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;20150331&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;BM&quot;</span><span class="s1">)</span>
    <span class="s1">expected = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: Series([</span><span class="s3">21</span><span class="s0">, </span><span class="s3">41</span><span class="s0">, </span><span class="s3">63</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=index)})</span>

    <span class="s1">index = date_range(start=</span><span class="s2">&quot;20150101&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;20150331&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;B&quot;</span><span class="s1">)</span>
    <span class="s1">df = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: Series(range(len(index))</span><span class="s0">, </span><span class="s1">index=index)}</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;int64&quot;</span><span class="s1">)</span>
    <span class="s1">result = df.resample(</span><span class="s2">&quot;BM&quot;</span><span class="s1">).last()</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_upsample_with_limit():</span>
    <span class="s1">rng = date_range(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;5t&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">rng)</span>

    <span class="s1">result = ts.resample(</span><span class="s2">&quot;t&quot;</span><span class="s1">).ffill(limit=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">expected = ts.reindex(result.index</span><span class="s0">, </span><span class="s1">method=</span><span class="s2">&quot;ffill&quot;</span><span class="s0">, </span><span class="s1">limit=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;freq&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;5D&quot;</span><span class="s0">, </span><span class="s2">&quot;10H&quot;</span><span class="s0">, </span><span class="s2">&quot;5Min&quot;</span><span class="s0">, </span><span class="s2">&quot;10S&quot;</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;rule&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;Y&quot;</span><span class="s0">, </span><span class="s2">&quot;3M&quot;</span><span class="s0">, </span><span class="s2">&quot;15D&quot;</span><span class="s0">, </span><span class="s2">&quot;30H&quot;</span><span class="s0">, </span><span class="s2">&quot;15Min&quot;</span><span class="s0">, </span><span class="s2">&quot;30S&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_nearest_upsample_with_limit(tz_aware_fixture</span><span class="s0">, </span><span class="s1">freq</span><span class="s0">, </span><span class="s1">rule):</span>
    <span class="s4"># GH 33939</span>
    <span class="s1">rng = date_range(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">freq=freq</span><span class="s0">, </span><span class="s1">tz=tz_aware_fixture)</span>
    <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">rng)</span>

    <span class="s1">result = ts.resample(rule).nearest(limit=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">expected = ts.reindex(result.index</span><span class="s0">, </span><span class="s1">method=</span><span class="s2">&quot;nearest&quot;</span><span class="s0">, </span><span class="s1">limit=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_resample_ohlc(series):</span>
    <span class="s1">s = series</span>

    <span class="s1">grouper = Grouper(freq=Minute(</span><span class="s3">5</span><span class="s1">))</span>
    <span class="s1">expect = s.groupby(grouper).agg(</span><span class="s0">lambda </span><span class="s1">x: x[-</span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">result = s.resample(</span><span class="s2">&quot;5Min&quot;</span><span class="s1">).ohlc()</span>

    <span class="s0">assert </span><span class="s1">len(result) == len(expect)</span>
    <span class="s0">assert </span><span class="s1">len(result.columns) == </span><span class="s3">4</span>

    <span class="s1">xs = result.iloc[-</span><span class="s3">2</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">xs[</span><span class="s2">&quot;open&quot;</span><span class="s1">] == s[-</span><span class="s3">6</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">xs[</span><span class="s2">&quot;high&quot;</span><span class="s1">] == s[-</span><span class="s3">6</span><span class="s1">:-</span><span class="s3">1</span><span class="s1">].max()</span>
    <span class="s0">assert </span><span class="s1">xs[</span><span class="s2">&quot;low&quot;</span><span class="s1">] == s[-</span><span class="s3">6</span><span class="s1">:-</span><span class="s3">1</span><span class="s1">].min()</span>
    <span class="s0">assert </span><span class="s1">xs[</span><span class="s2">&quot;close&quot;</span><span class="s1">] == s[-</span><span class="s3">2</span><span class="s1">]</span>

    <span class="s1">xs = result.iloc[</span><span class="s3">0</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">xs[</span><span class="s2">&quot;open&quot;</span><span class="s1">] == s[</span><span class="s3">0</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">xs[</span><span class="s2">&quot;high&quot;</span><span class="s1">] == s[:</span><span class="s3">5</span><span class="s1">].max()</span>
    <span class="s0">assert </span><span class="s1">xs[</span><span class="s2">&quot;low&quot;</span><span class="s1">] == s[:</span><span class="s3">5</span><span class="s1">].min()</span>
    <span class="s0">assert </span><span class="s1">xs[</span><span class="s2">&quot;close&quot;</span><span class="s1">] == s[</span><span class="s3">4</span><span class="s1">]</span>


<span class="s0">def </span><span class="s1">test_resample_ohlc_result():</span>

    <span class="s4"># GH 12332</span>
    <span class="s1">index = date_range(</span><span class="s2">&quot;1-1-2000&quot;</span><span class="s0">, </span><span class="s2">&quot;2-15-2000&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;h&quot;</span><span class="s1">)</span>
    <span class="s1">index = index.union(date_range(</span><span class="s2">&quot;4-15-2000&quot;</span><span class="s0">, </span><span class="s2">&quot;5-15-2000&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;h&quot;</span><span class="s1">))</span>
    <span class="s1">s = Series(range(len(index))</span><span class="s0">, </span><span class="s1">index=index)</span>

    <span class="s1">a = s.loc[:</span><span class="s2">&quot;4-15-2000&quot;</span><span class="s1">].resample(</span><span class="s2">&quot;30T&quot;</span><span class="s1">).ohlc()</span>
    <span class="s0">assert </span><span class="s1">isinstance(a</span><span class="s0">, </span><span class="s1">DataFrame)</span>

    <span class="s1">b = s.loc[:</span><span class="s2">&quot;4-14-2000&quot;</span><span class="s1">].resample(</span><span class="s2">&quot;30T&quot;</span><span class="s1">).ohlc()</span>
    <span class="s0">assert </span><span class="s1">isinstance(b</span><span class="s0">, </span><span class="s1">DataFrame)</span>

    <span class="s4"># GH12348</span>
    <span class="s4"># raising on odd period</span>
    <span class="s1">rng = date_range(</span><span class="s2">&quot;2013-12-30&quot;</span><span class="s0">, </span><span class="s2">&quot;2014-01-07&quot;</span><span class="s1">)</span>
    <span class="s1">index = rng.drop(</span>
        <span class="s1">[</span>
            <span class="s1">Timestamp(</span><span class="s2">&quot;2014-01-01&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">Timestamp(</span><span class="s2">&quot;2013-12-31&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">Timestamp(</span><span class="s2">&quot;2014-01-04&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">Timestamp(</span><span class="s2">&quot;2014-01-05&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">df = DataFrame(data=np.arange(len(index))</span><span class="s0">, </span><span class="s1">index=index)</span>
    <span class="s1">result = df.resample(</span><span class="s2">&quot;B&quot;</span><span class="s1">).mean()</span>
    <span class="s1">expected = df.reindex(index=date_range(rng[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">rng[-</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;B&quot;</span><span class="s1">))</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_resample_ohlc_dataframe():</span>
    <span class="s1">df = (</span>
        <span class="s1">DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;PRICE&quot;</span><span class="s1">: {</span>
                    <span class="s1">Timestamp(</span><span class="s2">&quot;2011-01-06 10:59:05&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s0">None</span><span class="s1">): </span><span class="s3">24990</span><span class="s0">,</span>
                    <span class="s1">Timestamp(</span><span class="s2">&quot;2011-01-06 12:43:33&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s0">None</span><span class="s1">): </span><span class="s3">25499</span><span class="s0">,</span>
                    <span class="s1">Timestamp(</span><span class="s2">&quot;2011-01-06 12:54:09&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s0">None</span><span class="s1">): </span><span class="s3">25499</span><span class="s0">,</span>
                <span class="s1">}</span><span class="s0">,</span>
                <span class="s2">&quot;VOLUME&quot;</span><span class="s1">: {</span>
                    <span class="s1">Timestamp(</span><span class="s2">&quot;2011-01-06 10:59:05&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s0">None</span><span class="s1">): </span><span class="s3">1500000000</span><span class="s0">,</span>
                    <span class="s1">Timestamp(</span><span class="s2">&quot;2011-01-06 12:43:33&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s0">None</span><span class="s1">): </span><span class="s3">5000000000</span><span class="s0">,</span>
                    <span class="s1">Timestamp(</span><span class="s2">&quot;2011-01-06 12:54:09&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s0">None</span><span class="s1">): </span><span class="s3">100000000</span><span class="s0">,</span>
                <span class="s1">}</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
    <span class="s1">).reindex([</span><span class="s2">&quot;VOLUME&quot;</span><span class="s0">, </span><span class="s2">&quot;PRICE&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">df.columns.name = </span><span class="s2">&quot;Cols&quot;</span>
    <span class="s1">res = df.resample(</span><span class="s2">&quot;H&quot;</span><span class="s1">).ohlc()</span>
    <span class="s1">exp = pd.concat(</span>
        <span class="s1">[df[</span><span class="s2">&quot;VOLUME&quot;</span><span class="s1">].resample(</span><span class="s2">&quot;H&quot;</span><span class="s1">).ohlc()</span><span class="s0">, </span><span class="s1">df[</span><span class="s2">&quot;PRICE&quot;</span><span class="s1">].resample(</span><span class="s2">&quot;H&quot;</span><span class="s1">).ohlc()]</span><span class="s0">,</span>
        <span class="s1">axis=</span><span class="s3">1</span><span class="s0">,</span>
        <span class="s1">keys=df.columns</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">exp.columns.names[</span><span class="s3">0</span><span class="s1">] == </span><span class="s2">&quot;Cols&quot;</span>
    <span class="s1">tm.assert_frame_equal(exp</span><span class="s0">, </span><span class="s1">res)</span>

    <span class="s1">df.columns = [[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s1">]]</span>
    <span class="s1">res = df.resample(</span><span class="s2">&quot;H&quot;</span><span class="s1">).ohlc()</span>
    <span class="s1">exp.columns = pd.MultiIndex.from_tuples(</span>
        <span class="s1">[</span>
            <span class="s1">(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;open&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;high&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;low&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;close&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s2">&quot;open&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s2">&quot;high&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s2">&quot;low&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s2">&quot;close&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(exp</span><span class="s0">, </span><span class="s1">res)</span>

    <span class="s4"># dupe columns fail atm</span>
    <span class="s4"># df.columns = ['PRICE', 'PRICE']</span>


<span class="s0">def </span><span class="s1">test_resample_dup_index():</span>

    <span class="s4"># GH 4812</span>
    <span class="s4"># dup columns with resample raising</span>
    <span class="s1">df = DataFrame(</span>
        <span class="s1">np.random.randn(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">12</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">index=[</span><span class="s3">2000</span><span class="s0">, </span><span class="s3">2000</span><span class="s0">, </span><span class="s3">2000</span><span class="s0">, </span><span class="s3">2000</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">columns=[Period(year=</span><span class="s3">2000</span><span class="s0">, </span><span class="s1">month=i + </span><span class="s3">1</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">12</span><span class="s1">)]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">df.iloc[</span><span class="s3">3</span><span class="s0">, </span><span class="s1">:] = np.nan</span>
    <span class="s1">result = df.resample(</span><span class="s2">&quot;Q&quot;</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">).mean()</span>
    <span class="s1">expected = df.groupby(</span><span class="s0">lambda </span><span class="s1">x: int((x.month - </span><span class="s3">1</span><span class="s1">) / </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">).mean()</span>
    <span class="s1">expected.columns = [Period(year=</span><span class="s3">2000</span><span class="s0">, </span><span class="s1">quarter=i + </span><span class="s3">1</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;Q&quot;</span><span class="s1">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">4</span><span class="s1">)]</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_resample_reresample():</span>
    <span class="s1">dti = date_range(start=datetime(</span><span class="s3">2005</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=datetime(</span><span class="s3">2005</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">)</span>
    <span class="s1">s = Series(np.random.rand(len(dti))</span><span class="s0">, </span><span class="s1">dti)</span>
    <span class="s1">bs = s.resample(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;right&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;right&quot;</span><span class="s1">).mean()</span>
    <span class="s1">result = bs.resample(</span><span class="s2">&quot;8H&quot;</span><span class="s1">).mean()</span>
    <span class="s0">assert </span><span class="s1">len(result) == </span><span class="s3">22</span>
    <span class="s0">assert </span><span class="s1">isinstance(result.index.freq</span><span class="s0">, </span><span class="s1">offsets.DateOffset)</span>
    <span class="s0">assert </span><span class="s1">result.index.freq == offsets.Hour(</span><span class="s3">8</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_resample_timestamp_to_period(simple_date_range_series):</span>
    <span class="s1">ts = simple_date_range_series(</span><span class="s2">&quot;1/1/1990&quot;</span><span class="s0">, </span><span class="s2">&quot;1/1/2000&quot;</span><span class="s1">)</span>

    <span class="s1">result = ts.resample(</span><span class="s2">&quot;A-DEC&quot;</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;period&quot;</span><span class="s1">).mean()</span>
    <span class="s1">expected = ts.resample(</span><span class="s2">&quot;A-DEC&quot;</span><span class="s1">).mean()</span>
    <span class="s1">expected.index = period_range(</span><span class="s2">&quot;1990&quot;</span><span class="s0">, </span><span class="s2">&quot;2000&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;a-dec&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ts.resample(</span><span class="s2">&quot;A-JUN&quot;</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;period&quot;</span><span class="s1">).mean()</span>
    <span class="s1">expected = ts.resample(</span><span class="s2">&quot;A-JUN&quot;</span><span class="s1">).mean()</span>
    <span class="s1">expected.index = period_range(</span><span class="s2">&quot;1990&quot;</span><span class="s0">, </span><span class="s2">&quot;2000&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;a-jun&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ts.resample(</span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;period&quot;</span><span class="s1">).mean()</span>
    <span class="s1">expected = ts.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).mean()</span>
    <span class="s1">expected.index = period_range(</span><span class="s2">&quot;1990-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2000-01&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ts.resample(</span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;period&quot;</span><span class="s1">).mean()</span>
    <span class="s1">expected = ts.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).mean()</span>
    <span class="s1">expected.index = period_range(</span><span class="s2">&quot;1990-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2000-01&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_ohlc_5min():</span>
    <span class="s0">def </span><span class="s1">_ohlc(group):</span>
        <span class="s0">if </span><span class="s1">isna(group).all():</span>
            <span class="s0">return </span><span class="s1">np.repeat(np.nan</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>
        <span class="s0">return </span><span class="s1">[group[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">group.max()</span><span class="s0">, </span><span class="s1">group.min()</span><span class="s0">, </span><span class="s1">group[-</span><span class="s3">1</span><span class="s1">]]</span>

    <span class="s1">rng = date_range(</span><span class="s2">&quot;1/1/2000 00:00:00&quot;</span><span class="s0">, </span><span class="s2">&quot;1/1/2000 5:59:50&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;10s&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">index=rng)</span>

    <span class="s1">resampled = ts.resample(</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;right&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;right&quot;</span><span class="s1">).ohlc()</span>

    <span class="s0">assert </span><span class="s1">(resampled.loc[</span><span class="s2">&quot;1/1/2000 00:00&quot;</span><span class="s1">] == ts[</span><span class="s3">0</span><span class="s1">]).all()</span>

    <span class="s1">exp = _ohlc(ts[</span><span class="s3">1</span><span class="s1">:</span><span class="s3">31</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">(resampled.loc[</span><span class="s2">&quot;1/1/2000 00:05&quot;</span><span class="s1">] == exp).all()</span>

    <span class="s1">exp = _ohlc(ts[</span><span class="s2">&quot;1/1/2000 5:55:01&quot;</span><span class="s1">:])</span>
    <span class="s0">assert </span><span class="s1">(resampled.loc[</span><span class="s2">&quot;1/1/2000 6:00:00&quot;</span><span class="s1">] == exp).all()</span>


<span class="s0">def </span><span class="s1">test_downsample_non_unique():</span>
    <span class="s1">rng = date_range(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s2">&quot;2/29/2000&quot;</span><span class="s1">)</span>
    <span class="s1">rng2 = rng.repeat(</span><span class="s3">5</span><span class="s1">).values</span>
    <span class="s1">ts = Series(np.random.randn(len(rng2))</span><span class="s0">, </span><span class="s1">index=rng2)</span>

    <span class="s1">result = ts.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).mean()</span>

    <span class="s1">expected = ts.groupby(</span><span class="s0">lambda </span><span class="s1">x: x.month).mean()</span>
    <span class="s0">assert </span><span class="s1">len(result) == </span><span class="s3">2</span>
    <span class="s1">tm.assert_almost_equal(result[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected[</span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">tm.assert_almost_equal(result[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected[</span><span class="s3">2</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_asfreq_non_unique():</span>
    <span class="s4"># GH #1077</span>
    <span class="s1">rng = date_range(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s2">&quot;2/29/2000&quot;</span><span class="s1">)</span>
    <span class="s1">rng2 = rng.repeat(</span><span class="s3">2</span><span class="s1">).values</span>
    <span class="s1">ts = Series(np.random.randn(len(rng2))</span><span class="s0">, </span><span class="s1">index=rng2)</span>

    <span class="s1">msg = </span><span class="s2">&quot;cannot reindex on an axis with duplicate labels&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s0">with </span><span class="s1">tm.assert_produces_warning(FutureWarning</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;non-unique&quot;</span><span class="s1">):</span>
            <span class="s1">ts.asfreq(</span><span class="s2">&quot;B&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_resample_axis1():</span>
    <span class="s1">rng = date_range(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s2">&quot;2/29/2000&quot;</span><span class="s1">)</span>
    <span class="s1">df = DataFrame(np.random.randn(</span><span class="s3">3</span><span class="s0">, </span><span class="s1">len(rng))</span><span class="s0">, </span><span class="s1">columns=rng</span><span class="s0">, </span><span class="s1">index=[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">])</span>

    <span class="s1">result = df.resample(</span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">).mean()</span>
    <span class="s1">expected = df.T.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).mean().T</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_resample_anchored_ticks():</span>
    <span class="s4"># If a fixed delta (5 minute, 4 hour) evenly divides a day, we should</span>
    <span class="s4"># &quot;anchor&quot; the origin at midnight so we get regular intervals rather</span>
    <span class="s4"># than starting from the first timestamp which might start in the</span>
    <span class="s4"># middle of a desired interval</span>

    <span class="s1">rng = date_range(</span><span class="s2">&quot;1/1/2000 04:00:00&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">86400</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;s&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">index=rng)</span>
    <span class="s1">ts[:</span><span class="s3">2</span><span class="s1">] = np.nan  </span><span class="s4"># so results are the same</span>

    <span class="s1">freqs = [</span><span class="s2">&quot;t&quot;</span><span class="s0">, </span><span class="s2">&quot;5t&quot;</span><span class="s0">, </span><span class="s2">&quot;15t&quot;</span><span class="s0">, </span><span class="s2">&quot;30t&quot;</span><span class="s0">, </span><span class="s2">&quot;4h&quot;</span><span class="s0">, </span><span class="s2">&quot;12h&quot;</span><span class="s1">]</span>
    <span class="s0">for </span><span class="s1">freq </span><span class="s0">in </span><span class="s1">freqs:</span>
        <span class="s1">result = ts[</span><span class="s3">2</span><span class="s1">:].resample(freq</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;left&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;left&quot;</span><span class="s1">).mean()</span>
        <span class="s1">expected = ts.resample(freq</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;left&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;left&quot;</span><span class="s1">).mean()</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_resample_single_group():</span>
    <span class="s1">mysum = </span><span class="s0">lambda </span><span class="s1">x: x.sum()</span>

    <span class="s1">rng = date_range(</span><span class="s2">&quot;2000-1-1&quot;</span><span class="s0">, </span><span class="s2">&quot;2000-2-10&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">index=rng)</span>
    <span class="s1">tm.assert_series_equal(ts.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).sum()</span><span class="s0">, </span><span class="s1">ts.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).apply(mysum))</span>

    <span class="s1">rng = date_range(</span><span class="s2">&quot;2000-1-1&quot;</span><span class="s0">, </span><span class="s2">&quot;2000-1-10&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">index=rng)</span>
    <span class="s1">tm.assert_series_equal(ts.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).sum()</span><span class="s0">, </span><span class="s1">ts.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).apply(mysum))</span>

    <span class="s4"># GH 3849</span>
    <span class="s1">s = Series(</span>
        <span class="s1">[</span><span class="s3">30.1</span><span class="s0">, </span><span class="s3">31.6</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">index=[Timestamp(</span><span class="s2">&quot;20070915 15:30:00&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">Timestamp(</span><span class="s2">&quot;20070915 15:40:00&quot;</span><span class="s1">)]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s3">0.75</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=DatetimeIndex([Timestamp(</span><span class="s2">&quot;20070915&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">))</span>
    <span class="s1">result = s.resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).apply(</span><span class="s0">lambda </span><span class="s1">x: np.std(x))</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_resample_offset():</span>
    <span class="s4"># GH 31809</span>

    <span class="s1">rng = date_range(</span><span class="s2">&quot;1/1/2000 00:00:00&quot;</span><span class="s0">, </span><span class="s2">&quot;1/1/2000 02:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;s&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">index=rng)</span>

    <span class="s1">resampled = ts.resample(</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">offset=</span><span class="s2">&quot;2min&quot;</span><span class="s1">).mean()</span>
    <span class="s1">exp_rng = date_range(</span><span class="s2">&quot;12/31/1999 23:57:00&quot;</span><span class="s0">, </span><span class="s2">&quot;1/1/2000 01:57&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;5min&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_index_equal(resampled.index</span><span class="s0">, </span><span class="s1">exp_rng)</span>


<span class="s0">def </span><span class="s1">test_resample_origin():</span>
    <span class="s4"># GH 31809</span>
    <span class="s1">rng = date_range(</span><span class="s2">&quot;2000-01-01 00:00:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2000-01-01 02:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;s&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">index=rng)</span>

    <span class="s1">exp_rng = date_range(</span><span class="s2">&quot;1999-12-31 23:57:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2000-01-01 01:57&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;5min&quot;</span><span class="s1">)</span>

    <span class="s1">resampled = ts.resample(</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;1999-12-31 23:57:00&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_index_equal(resampled.index</span><span class="s0">, </span><span class="s1">exp_rng)</span>

    <span class="s1">offset_timestamp = Timestamp(</span><span class="s3">0</span><span class="s1">) + Timedelta(</span><span class="s2">&quot;2min&quot;</span><span class="s1">)</span>
    <span class="s1">resampled = ts.resample(</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">origin=offset_timestamp).mean()</span>
    <span class="s1">tm.assert_index_equal(resampled.index</span><span class="s0">, </span><span class="s1">exp_rng)</span>

    <span class="s1">resampled = ts.resample(</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;epoch&quot;</span><span class="s0">, </span><span class="s1">offset=</span><span class="s2">&quot;2m&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_index_equal(resampled.index</span><span class="s0">, </span><span class="s1">exp_rng)</span>

    <span class="s4"># origin of '1999-31-12 12:02:00' should be equivalent for this case</span>
    <span class="s1">resampled = ts.resample(</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;1999-12-31 12:02:00&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_index_equal(resampled.index</span><span class="s0">, </span><span class="s1">exp_rng)</span>

    <span class="s1">resampled = ts.resample(</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">offset=</span><span class="s2">&quot;-3m&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_index_equal(resampled.index</span><span class="s0">, </span><span class="s1">exp_rng)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;origin&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;invalid_value&quot;</span><span class="s0">, </span><span class="s2">&quot;epch&quot;</span><span class="s0">, </span><span class="s2">&quot;startday&quot;</span><span class="s0">, </span><span class="s2">&quot;startt&quot;</span><span class="s0">, </span><span class="s2">&quot;2000-30-30&quot;</span><span class="s0">, </span><span class="s1">object()]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_resample_bad_origin(origin):</span>
    <span class="s1">rng = date_range(</span><span class="s2">&quot;2000-01-01 00:00:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2000-01-01 02:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;s&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">index=rng)</span>
    <span class="s1">msg = (</span>
        <span class="s2">&quot;'origin' should be equal to 'epoch', 'start', 'start_day', &quot;</span>
        <span class="s2">&quot;'end', 'end_day' or should be a Timestamp convertible type. Got &quot;</span>
        <span class="s2">f&quot;'</span><span class="s0">{</span><span class="s1">origin</span><span class="s0">}</span><span class="s2">' instead.&quot;</span>
    <span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">ts.resample(</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">origin=origin)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;offset&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;invalid_value&quot;</span><span class="s0">, </span><span class="s2">&quot;12dayys&quot;</span><span class="s0">, </span><span class="s2">&quot;2000-30-30&quot;</span><span class="s0">, </span><span class="s1">object()])</span>
<span class="s0">def </span><span class="s1">test_resample_bad_offset(offset):</span>
    <span class="s1">rng = date_range(</span><span class="s2">&quot;2000-01-01 00:00:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2000-01-01 02:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;s&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">index=rng)</span>
    <span class="s1">msg = </span><span class="s2">f&quot;'offset' should be a Timedelta convertible type. Got '</span><span class="s0">{</span><span class="s1">offset</span><span class="s0">}</span><span class="s2">' instead.&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">ts.resample(</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">offset=offset)</span>


<span class="s0">def </span><span class="s1">test_resample_origin_prime_freq():</span>
    <span class="s4"># GH 31809</span>
    <span class="s1">start</span><span class="s0">, </span><span class="s1">end = </span><span class="s2">&quot;2000-10-01 23:30:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2000-10-02 00:30:00&quot;</span>
    <span class="s1">rng = date_range(start</span><span class="s0">, </span><span class="s1">end</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;7min&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">index=rng)</span>

    <span class="s1">exp_rng = date_range(</span><span class="s2">&quot;2000-10-01 23:14:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2000-10-02 00:22:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;17min&quot;</span><span class="s1">)</span>
    <span class="s1">resampled = ts.resample(</span><span class="s2">&quot;17min&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_index_equal(resampled.index</span><span class="s0">, </span><span class="s1">exp_rng)</span>
    <span class="s1">resampled = ts.resample(</span><span class="s2">&quot;17min&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;start_day&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_index_equal(resampled.index</span><span class="s0">, </span><span class="s1">exp_rng)</span>

    <span class="s1">exp_rng = date_range(</span><span class="s2">&quot;2000-10-01 23:30:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2000-10-02 00:21:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;17min&quot;</span><span class="s1">)</span>
    <span class="s1">resampled = ts.resample(</span><span class="s2">&quot;17min&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;start&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_index_equal(resampled.index</span><span class="s0">, </span><span class="s1">exp_rng)</span>
    <span class="s1">resampled = ts.resample(</span><span class="s2">&quot;17min&quot;</span><span class="s0">, </span><span class="s1">offset=</span><span class="s2">&quot;23h30min&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_index_equal(resampled.index</span><span class="s0">, </span><span class="s1">exp_rng)</span>
    <span class="s1">resampled = ts.resample(</span><span class="s2">&quot;17min&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;start_day&quot;</span><span class="s0">, </span><span class="s1">offset=</span><span class="s2">&quot;23h30min&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_index_equal(resampled.index</span><span class="s0">, </span><span class="s1">exp_rng)</span>

    <span class="s1">exp_rng = date_range(</span><span class="s2">&quot;2000-10-01 23:18:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2000-10-02 00:26:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;17min&quot;</span><span class="s1">)</span>
    <span class="s1">resampled = ts.resample(</span><span class="s2">&quot;17min&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;epoch&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_index_equal(resampled.index</span><span class="s0">, </span><span class="s1">exp_rng)</span>

    <span class="s1">exp_rng = date_range(</span><span class="s2">&quot;2000-10-01 23:24:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2000-10-02 00:15:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;17min&quot;</span><span class="s1">)</span>
    <span class="s1">resampled = ts.resample(</span><span class="s2">&quot;17min&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;2000-01-01&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_index_equal(resampled.index</span><span class="s0">, </span><span class="s1">exp_rng)</span>


<span class="s0">def </span><span class="s1">test_resample_origin_with_tz():</span>
    <span class="s4"># GH 31809</span>
    <span class="s1">msg = </span><span class="s2">&quot;The origin must have the same timezone as the index.&quot;</span>

    <span class="s1">tz = </span><span class="s2">&quot;Europe/Paris&quot;</span>
    <span class="s1">rng = date_range(</span><span class="s2">&quot;2000-01-01 00:00:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2000-01-01 02:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;s&quot;</span><span class="s0">, </span><span class="s1">tz=tz)</span>
    <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">index=rng)</span>

    <span class="s1">exp_rng = date_range(</span><span class="s2">&quot;1999-12-31 23:57:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2000-01-01 01:57&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">tz=tz)</span>
    <span class="s1">resampled = ts.resample(</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;1999-12-31 23:57:00+00:00&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_index_equal(resampled.index</span><span class="s0">, </span><span class="s1">exp_rng)</span>

    <span class="s4"># origin of '1999-31-12 12:02:00+03:00' should be equivalent for this case</span>
    <span class="s1">resampled = ts.resample(</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;1999-12-31 12:02:00+03:00&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_index_equal(resampled.index</span><span class="s0">, </span><span class="s1">exp_rng)</span>

    <span class="s1">resampled = ts.resample(</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;epoch&quot;</span><span class="s0">, </span><span class="s1">offset=</span><span class="s2">&quot;2m&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_index_equal(resampled.index</span><span class="s0">, </span><span class="s1">exp_rng)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">ts.resample(</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;12/31/1999 23:57:00&quot;</span><span class="s1">).mean()</span>

    <span class="s4"># if the series is not tz aware, origin should not be tz aware</span>
    <span class="s1">rng = date_range(</span><span class="s2">&quot;2000-01-01 00:00:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2000-01-01 02:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;s&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">index=rng)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">ts.resample(</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;12/31/1999 23:57:00+03:00&quot;</span><span class="s1">).mean()</span>


<span class="s0">def </span><span class="s1">test_resample_origin_epoch_with_tz_day_vs_24h():</span>
    <span class="s4"># GH 34474</span>
    <span class="s1">start</span><span class="s0">, </span><span class="s1">end = </span><span class="s2">&quot;2000-10-01 23:30:00+0500&quot;</span><span class="s0">, </span><span class="s2">&quot;2000-12-02 00:30:00+0500&quot;</span>
    <span class="s1">rng = date_range(start</span><span class="s0">, </span><span class="s1">end</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;7min&quot;</span><span class="s1">)</span>
    <span class="s1">random_values = np.random.randn(len(rng))</span>
    <span class="s1">ts_1 = Series(random_values</span><span class="s0">, </span><span class="s1">index=rng)</span>

    <span class="s1">result_1 = ts_1.resample(</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;epoch&quot;</span><span class="s1">).mean()</span>
    <span class="s1">result_2 = ts_1.resample(</span><span class="s2">&quot;24H&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;epoch&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_series_equal(result_1</span><span class="s0">, </span><span class="s1">result_2)</span>

    <span class="s4"># check that we have the same behavior with epoch even if we are not timezone aware</span>
    <span class="s1">ts_no_tz = ts_1.tz_localize(</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s1">result_3 = ts_no_tz.resample(</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;epoch&quot;</span><span class="s1">).mean()</span>
    <span class="s1">result_4 = ts_no_tz.resample(</span><span class="s2">&quot;24H&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;epoch&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_series_equal(result_1</span><span class="s0">, </span><span class="s1">result_3.tz_localize(rng.tz)</span><span class="s0">, </span><span class="s1">check_freq=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result_1</span><span class="s0">, </span><span class="s1">result_4.tz_localize(rng.tz)</span><span class="s0">, </span><span class="s1">check_freq=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s4"># check that we have the similar results with two different timezones (+2H and +5H)</span>
    <span class="s1">start</span><span class="s0">, </span><span class="s1">end = </span><span class="s2">&quot;2000-10-01 23:30:00+0200&quot;</span><span class="s0">, </span><span class="s2">&quot;2000-12-02 00:30:00+0200&quot;</span>
    <span class="s1">rng = date_range(start</span><span class="s0">, </span><span class="s1">end</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;7min&quot;</span><span class="s1">)</span>
    <span class="s1">ts_2 = Series(random_values</span><span class="s0">, </span><span class="s1">index=rng)</span>
    <span class="s1">result_5 = ts_2.resample(</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;epoch&quot;</span><span class="s1">).mean()</span>
    <span class="s1">result_6 = ts_2.resample(</span><span class="s2">&quot;24H&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;epoch&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_series_equal(result_1.tz_localize(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">result_5.tz_localize(</span><span class="s0">None</span><span class="s1">))</span>
    <span class="s1">tm.assert_series_equal(result_1.tz_localize(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">result_6.tz_localize(</span><span class="s0">None</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_resample_origin_with_day_freq_on_dst():</span>
    <span class="s4"># GH 31809</span>
    <span class="s1">tz = </span><span class="s2">&quot;America/Chicago&quot;</span>

    <span class="s0">def </span><span class="s1">_create_series(values</span><span class="s0">, </span><span class="s1">timestamps</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">):</span>
        <span class="s0">return </span><span class="s1">Series(</span>
            <span class="s1">values</span><span class="s0">,</span>
            <span class="s1">index=DatetimeIndex(</span>
                <span class="s1">[Timestamp(t</span><span class="s0">, </span><span class="s1">tz=tz) </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">timestamps]</span><span class="s0">, </span><span class="s1">freq=freq</span><span class="s0">, </span><span class="s1">ambiguous=</span><span class="s0">True</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>

    <span class="s4"># test classical behavior of origin in a DST context</span>
    <span class="s1">start = Timestamp(</span><span class="s2">&quot;2013-11-02&quot;</span><span class="s0">, </span><span class="s1">tz=tz)</span>
    <span class="s1">end = Timestamp(</span><span class="s2">&quot;2013-11-03 23:59&quot;</span><span class="s0">, </span><span class="s1">tz=tz)</span>
    <span class="s1">rng = date_range(start</span><span class="s0">, </span><span class="s1">end</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;1h&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.ones(len(rng))</span><span class="s0">, </span><span class="s1">index=rng)</span>

    <span class="s1">expected = _create_series([</span><span class="s3">24.0</span><span class="s0">, </span><span class="s3">25.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;2013-11-02&quot;</span><span class="s0">, </span><span class="s2">&quot;2013-11-03&quot;</span><span class="s1">])</span>
    <span class="s0">for </span><span class="s1">origin </span><span class="s0">in </span><span class="s1">[</span><span class="s2">&quot;epoch&quot;</span><span class="s0">, </span><span class="s2">&quot;start&quot;</span><span class="s0">, </span><span class="s2">&quot;start_day&quot;</span><span class="s0">, </span><span class="s1">start</span><span class="s0">, None</span><span class="s1">]:</span>
        <span class="s1">result = ts.resample(</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">origin=origin).sum()</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s4"># test complex behavior of origin/offset in a DST context</span>
    <span class="s1">start = Timestamp(</span><span class="s2">&quot;2013-11-03&quot;</span><span class="s0">, </span><span class="s1">tz=tz)</span>
    <span class="s1">end = Timestamp(</span><span class="s2">&quot;2013-11-03 23:59&quot;</span><span class="s0">, </span><span class="s1">tz=tz)</span>
    <span class="s1">rng = date_range(start</span><span class="s0">, </span><span class="s1">end</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;1h&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.ones(len(rng))</span><span class="s0">, </span><span class="s1">index=rng)</span>

    <span class="s1">expected_ts = [</span><span class="s2">&quot;2013-11-02 22:00-05:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2013-11-03 22:00-06:00&quot;</span><span class="s1">]</span>
    <span class="s1">expected = _create_series([</span><span class="s3">23.0</span><span class="s0">, </span><span class="s3">2.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected_ts)</span>
    <span class="s1">result = ts.resample(</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;start&quot;</span><span class="s0">, </span><span class="s1">offset=</span><span class="s2">&quot;-2H&quot;</span><span class="s1">).sum()</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">expected_ts = [</span><span class="s2">&quot;2013-11-02 22:00-05:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2013-11-03 21:00-06:00&quot;</span><span class="s1">]</span>
    <span class="s1">expected = _create_series([</span><span class="s3">22.0</span><span class="s0">, </span><span class="s3">3.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected_ts</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;24H&quot;</span><span class="s1">)</span>
    <span class="s1">result = ts.resample(</span><span class="s2">&quot;24H&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;start&quot;</span><span class="s0">, </span><span class="s1">offset=</span><span class="s2">&quot;-2H&quot;</span><span class="s1">).sum()</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">expected_ts = [</span><span class="s2">&quot;2013-11-02 02:00-05:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2013-11-03 02:00-06:00&quot;</span><span class="s1">]</span>
    <span class="s1">expected = _create_series([</span><span class="s3">3.0</span><span class="s0">, </span><span class="s3">22.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected_ts)</span>
    <span class="s1">result = ts.resample(</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;start&quot;</span><span class="s0">, </span><span class="s1">offset=</span><span class="s2">&quot;2H&quot;</span><span class="s1">).sum()</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">expected_ts = [</span><span class="s2">&quot;2013-11-02 23:00-05:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2013-11-03 23:00-06:00&quot;</span><span class="s1">]</span>
    <span class="s1">expected = _create_series([</span><span class="s3">24.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected_ts)</span>
    <span class="s1">result = ts.resample(</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;start&quot;</span><span class="s0">, </span><span class="s1">offset=</span><span class="s2">&quot;-1H&quot;</span><span class="s1">).sum()</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">expected_ts = [</span><span class="s2">&quot;2013-11-02 01:00-05:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2013-11-03 01:00:00-0500&quot;</span><span class="s1">]</span>
    <span class="s1">expected = _create_series([</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">24.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected_ts)</span>
    <span class="s1">result = ts.resample(</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;start&quot;</span><span class="s0">, </span><span class="s1">offset=</span><span class="s2">&quot;1H&quot;</span><span class="s1">).sum()</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_resample_daily_anchored():</span>
    <span class="s1">rng = date_range(</span><span class="s2">&quot;1/1/2000 0:00:00&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">10000</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;T&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">index=rng)</span>
    <span class="s1">ts[:</span><span class="s3">2</span><span class="s1">] = np.nan  </span><span class="s4"># so results are the same</span>

    <span class="s1">result = ts[</span><span class="s3">2</span><span class="s1">:].resample(</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;left&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;left&quot;</span><span class="s1">).mean()</span>
    <span class="s1">expected = ts.resample(</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;left&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;left&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_resample_to_period_monthly_buglet():</span>
    <span class="s4"># GH #1259</span>

    <span class="s1">rng = date_range(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s2">&quot;12/31/2000&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">index=rng)</span>

    <span class="s1">result = ts.resample(</span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;period&quot;</span><span class="s1">).mean()</span>
    <span class="s1">exp_index = period_range(</span><span class="s2">&quot;Jan-2000&quot;</span><span class="s0">, </span><span class="s2">&quot;Dec-2000&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_index_equal(result.index</span><span class="s0">, </span><span class="s1">exp_index)</span>


<span class="s0">def </span><span class="s1">test_period_with_agg():</span>

    <span class="s4"># aggregate a period resampler with a lambda</span>
    <span class="s1">s2 = Series(</span>
        <span class="s1">np.random.randint(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">index=period_range(</span><span class="s2">&quot;2012-01-01&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">dtype=</span><span class="s2">&quot;float64&quot;</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s1">expected = s2.to_timestamp().resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).mean().to_period()</span>
    <span class="s1">result = s2.resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).agg(</span><span class="s0">lambda </span><span class="s1">x: x.mean())</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_resample_segfault():</span>
    <span class="s4"># GH 8573</span>
    <span class="s4"># segfaulting in older versions</span>
    <span class="s1">all_wins_and_wagers = [</span>
        <span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">datetime(</span><span class="s3">2013</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">16</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s1">datetime(</span><span class="s3">2013</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">16</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s1">datetime(</span><span class="s3">2013</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">18</span><span class="s0">, </span><span class="s3">15</span><span class="s1">)</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s1">datetime(</span><span class="s3">2013</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">16</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">31</span><span class="s1">)</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span>

    <span class="s1">df = DataFrame.from_records(</span>
        <span class="s1">all_wins_and_wagers</span><span class="s0">, </span><span class="s1">columns=(</span><span class="s2">&quot;ID&quot;</span><span class="s0">, </span><span class="s2">&quot;timestamp&quot;</span><span class="s0">, </span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">)</span>
    <span class="s1">).set_index(</span><span class="s2">&quot;timestamp&quot;</span><span class="s1">)</span>
    <span class="s1">result = df.groupby(</span><span class="s2">&quot;ID&quot;</span><span class="s1">).resample(</span><span class="s2">&quot;5min&quot;</span><span class="s1">).sum()</span>
    <span class="s1">expected = df.groupby(</span><span class="s2">&quot;ID&quot;</span><span class="s1">).apply(</span><span class="s0">lambda </span><span class="s1">x: x.resample(</span><span class="s2">&quot;5min&quot;</span><span class="s1">).sum())</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_resample_dtype_preservation():</span>

    <span class="s4"># GH 12202</span>
    <span class="s4"># validation tests for dtype preservation</span>

    <span class="s1">df = DataFrame(</span>
        <span class="s1">{</span>
            <span class="s2">&quot;date&quot;</span><span class="s1">: date_range(start=</span><span class="s2">&quot;2016-01-01&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;W&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s2">&quot;group&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s2">&quot;val&quot;</span><span class="s1">: Series([</span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;int32&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">}</span>
    <span class="s1">).set_index(</span><span class="s2">&quot;date&quot;</span><span class="s1">)</span>

    <span class="s1">result = df.resample(</span><span class="s2">&quot;1D&quot;</span><span class="s1">).ffill()</span>
    <span class="s0">assert </span><span class="s1">result.val.dtype == np.int32</span>

    <span class="s1">result = df.groupby(</span><span class="s2">&quot;group&quot;</span><span class="s1">).resample(</span><span class="s2">&quot;1D&quot;</span><span class="s1">).ffill()</span>
    <span class="s0">assert </span><span class="s1">result.val.dtype == np.int32</span>


<span class="s0">def </span><span class="s1">test_resample_dtype_coercion():</span>

    <span class="s1">pytest.importorskip(</span><span class="s2">&quot;scipy.interpolate&quot;</span><span class="s1">)</span>

    <span class="s4"># GH 16361</span>
    <span class="s1">df = {</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]}</span>
    <span class="s1">df = DataFrame(df</span><span class="s0">, </span><span class="s1">index=date_range(</span><span class="s2">&quot;2017-01-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2017-01-04&quot;</span><span class="s1">))</span>

    <span class="s1">expected = df.astype(</span><span class="s2">&quot;float64&quot;</span><span class="s1">).resample(</span><span class="s2">&quot;H&quot;</span><span class="s1">).mean()[</span><span class="s2">&quot;a&quot;</span><span class="s1">].interpolate(</span><span class="s2">&quot;cubic&quot;</span><span class="s1">)</span>

    <span class="s1">result = df.resample(</span><span class="s2">&quot;H&quot;</span><span class="s1">)[</span><span class="s2">&quot;a&quot;</span><span class="s1">].mean().interpolate(</span><span class="s2">&quot;cubic&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = df.resample(</span><span class="s2">&quot;H&quot;</span><span class="s1">).mean()[</span><span class="s2">&quot;a&quot;</span><span class="s1">].interpolate(</span><span class="s2">&quot;cubic&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_weekly_resample_buglet():</span>
    <span class="s4"># #1327</span>
    <span class="s1">rng = date_range(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">20</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">index=rng)</span>

    <span class="s1">resampled = ts.resample(</span><span class="s2">&quot;W&quot;</span><span class="s1">).mean()</span>
    <span class="s1">expected = ts.resample(</span><span class="s2">&quot;W-SUN&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_series_equal(resampled</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_monthly_resample_error():</span>
    <span class="s4"># #1451</span>
    <span class="s1">dates = date_range(</span><span class="s2">&quot;4/16/2012 20:00&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">5000</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;h&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.random.randn(len(dates))</span><span class="s0">, </span><span class="s1">index=dates)</span>
    <span class="s4"># it works!</span>
    <span class="s1">ts.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_nanosecond_resample_error():</span>
    <span class="s4"># GH 12307 - Values falls after last bin when</span>
    <span class="s4"># Resampling using pd.tseries.offsets.Nano as period</span>
    <span class="s1">start = </span><span class="s3">1443707890427</span>
    <span class="s1">exp_start = </span><span class="s3">1443707890400</span>
    <span class="s1">indx = date_range(start=pd.to_datetime(start)</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">10</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;100n&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(range(len(indx))</span><span class="s0">, </span><span class="s1">index=indx)</span>
    <span class="s1">r = ts.resample(pd.tseries.offsets.Nano(</span><span class="s3">100</span><span class="s1">))</span>
    <span class="s1">result = r.agg(</span><span class="s2">&quot;mean&quot;</span><span class="s1">)</span>

    <span class="s1">exp_indx = date_range(start=pd.to_datetime(exp_start)</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">10</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;100n&quot;</span><span class="s1">)</span>
    <span class="s1">exp = Series(range(len(exp_indx))</span><span class="s0">, </span><span class="s1">index=exp_indx</span><span class="s0">, </span><span class="s1">dtype=float)</span>

    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">exp)</span>


<span class="s0">def </span><span class="s1">test_resample_anchored_intraday(simple_date_range_series):</span>
    <span class="s4"># #1471, #1458</span>

    <span class="s1">rng = date_range(</span><span class="s2">&quot;1/1/2012&quot;</span><span class="s0">, </span><span class="s2">&quot;4/1/2012&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;100min&quot;</span><span class="s1">)</span>
    <span class="s1">df = DataFrame(rng.month</span><span class="s0">, </span><span class="s1">index=rng)</span>

    <span class="s1">result = df.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).mean()</span>
    <span class="s1">expected = df.resample(</span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;period&quot;</span><span class="s1">).mean().to_timestamp(how=</span><span class="s2">&quot;end&quot;</span><span class="s1">)</span>
    <span class="s1">expected.index += Timedelta(</span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;ns&quot;</span><span class="s1">) - Timedelta(</span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s1">)</span>
    <span class="s1">expected.index = expected.index._with_freq(</span><span class="s2">&quot;infer&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">expected.index.freq == </span><span class="s2">&quot;M&quot;</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = df.resample(</span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;left&quot;</span><span class="s1">).mean()</span>
    <span class="s1">exp = df.shift(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">).resample(</span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;period&quot;</span><span class="s1">).mean()</span>
    <span class="s1">exp = exp.to_timestamp(how=</span><span class="s2">&quot;end&quot;</span><span class="s1">)</span>

    <span class="s1">exp.index = exp.index + Timedelta(</span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;ns&quot;</span><span class="s1">) - Timedelta(</span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s1">)</span>
    <span class="s1">exp.index = exp.index._with_freq(</span><span class="s2">&quot;infer&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">exp.index.freq == </span><span class="s2">&quot;M&quot;</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">exp)</span>

    <span class="s1">rng = date_range(</span><span class="s2">&quot;1/1/2012&quot;</span><span class="s0">, </span><span class="s2">&quot;4/1/2012&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;100min&quot;</span><span class="s1">)</span>
    <span class="s1">df = DataFrame(rng.month</span><span class="s0">, </span><span class="s1">index=rng)</span>

    <span class="s1">result = df.resample(</span><span class="s2">&quot;Q&quot;</span><span class="s1">).mean()</span>
    <span class="s1">expected = df.resample(</span><span class="s2">&quot;Q&quot;</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;period&quot;</span><span class="s1">).mean().to_timestamp(how=</span><span class="s2">&quot;end&quot;</span><span class="s1">)</span>
    <span class="s1">expected.index += Timedelta(</span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;ns&quot;</span><span class="s1">) - Timedelta(</span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s1">)</span>
    <span class="s1">expected.index._data.freq = </span><span class="s2">&quot;Q&quot;</span>
    <span class="s1">expected.index._freq = lib.no_default</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = df.resample(</span><span class="s2">&quot;Q&quot;</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;left&quot;</span><span class="s1">).mean()</span>
    <span class="s1">expected = df.shift(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">).resample(</span><span class="s2">&quot;Q&quot;</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;period&quot;</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;left&quot;</span><span class="s1">).mean()</span>
    <span class="s1">expected = expected.to_timestamp(how=</span><span class="s2">&quot;end&quot;</span><span class="s1">)</span>
    <span class="s1">expected.index += Timedelta(</span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;ns&quot;</span><span class="s1">) - Timedelta(</span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s1">)</span>
    <span class="s1">expected.index._data.freq = </span><span class="s2">&quot;Q&quot;</span>
    <span class="s1">expected.index._freq = lib.no_default</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">ts = simple_date_range_series(</span><span class="s2">&quot;2012-04-29 23:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2012-04-30 5:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;h&quot;</span><span class="s1">)</span>
    <span class="s1">resampled = ts.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).mean()</span>
    <span class="s0">assert </span><span class="s1">len(resampled) == </span><span class="s3">1</span>


<span class="s0">def </span><span class="s1">test_resample_anchored_monthstart(simple_date_range_series):</span>
    <span class="s1">ts = simple_date_range_series(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s2">&quot;12/31/2002&quot;</span><span class="s1">)</span>

    <span class="s1">freqs = [</span><span class="s2">&quot;MS&quot;</span><span class="s0">, </span><span class="s2">&quot;BMS&quot;</span><span class="s0">, </span><span class="s2">&quot;QS-MAR&quot;</span><span class="s0">, </span><span class="s2">&quot;AS-DEC&quot;</span><span class="s0">, </span><span class="s2">&quot;AS-JUN&quot;</span><span class="s1">]</span>

    <span class="s0">for </span><span class="s1">freq </span><span class="s0">in </span><span class="s1">freqs:</span>
        <span class="s1">ts.resample(freq).mean()</span>


<span class="s0">def </span><span class="s1">test_resample_anchored_multiday():</span>
    <span class="s4"># When resampling a range spanning multiple days, ensure that the</span>
    <span class="s4"># start date gets used to determine the offset.  Fixes issue where</span>
    <span class="s4"># a one day period is not a multiple of the frequency.</span>
    <span class="s4">#</span>
    <span class="s4"># See: https://github.com/pandas-dev/pandas/issues/8683</span>

    <span class="s1">index1 = date_range(</span><span class="s2">&quot;2014-10-14 23:06:23.206&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;400L&quot;</span><span class="s1">)</span>
    <span class="s1">index2 = date_range(</span><span class="s2">&quot;2014-10-15 23:00:00&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">2</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;2200L&quot;</span><span class="s1">)</span>
    <span class="s1">index = index1.union(index2)</span>

    <span class="s1">s = Series(np.random.randn(</span><span class="s3">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=index)</span>

    <span class="s4"># Ensure left closing works</span>
    <span class="s1">result = s.resample(</span><span class="s2">&quot;2200L&quot;</span><span class="s1">).mean()</span>
    <span class="s0">assert </span><span class="s1">result.index[-</span><span class="s3">1</span><span class="s1">] == Timestamp(</span><span class="s2">&quot;2014-10-15 23:00:02.000&quot;</span><span class="s1">)</span>

    <span class="s4"># Ensure right closing works</span>
    <span class="s1">result = s.resample(</span><span class="s2">&quot;2200L&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;right&quot;</span><span class="s1">).mean()</span>
    <span class="s0">assert </span><span class="s1">result.index[-</span><span class="s3">1</span><span class="s1">] == Timestamp(</span><span class="s2">&quot;2014-10-15 23:00:04.200&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_corner_cases(simple_period_range_series</span><span class="s0">, </span><span class="s1">simple_date_range_series):</span>
    <span class="s4"># miscellaneous test coverage</span>

    <span class="s1">rng = date_range(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">12</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;t&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">index=rng)</span>

    <span class="s1">result = ts.resample(</span><span class="s2">&quot;5t&quot;</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;right&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;left&quot;</span><span class="s1">).mean()</span>
    <span class="s1">ex_index = date_range(</span><span class="s2">&quot;1999-12-31 23:55&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;5t&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_index_equal(result.index</span><span class="s0">, </span><span class="s1">ex_index)</span>

    <span class="s1">len0pts = simple_period_range_series(</span><span class="s2">&quot;2007-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2010-05&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)[:</span><span class="s3">0</span><span class="s1">]</span>
    <span class="s4"># it works</span>
    <span class="s1">result = len0pts.resample(</span><span class="s2">&quot;A-DEC&quot;</span><span class="s1">).mean()</span>
    <span class="s0">assert </span><span class="s1">len(result) == </span><span class="s3">0</span>

    <span class="s4"># resample to periods</span>
    <span class="s1">ts = simple_date_range_series(</span><span class="s2">&quot;2000-04-28&quot;</span><span class="s0">, </span><span class="s2">&quot;2000-04-30 11:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;h&quot;</span><span class="s1">)</span>
    <span class="s1">result = ts.resample(</span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;period&quot;</span><span class="s1">).mean()</span>
    <span class="s0">assert </span><span class="s1">len(result) == </span><span class="s3">1</span>
    <span class="s0">assert </span><span class="s1">result.index[</span><span class="s3">0</span><span class="s1">] == Period(</span><span class="s2">&quot;2000-04&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_anchored_lowercase_buglet():</span>
    <span class="s1">dates = date_range(</span><span class="s2">&quot;4/16/2012 20:00&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">50000</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;s&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.random.randn(len(dates))</span><span class="s0">, </span><span class="s1">index=dates)</span>
    <span class="s4"># it works!</span>
    <span class="s1">ts.resample(</span><span class="s2">&quot;d&quot;</span><span class="s1">).mean()</span>


<span class="s0">def </span><span class="s1">test_upsample_apply_functions():</span>
    <span class="s4"># #1596</span>
    <span class="s1">rng = date_range(</span><span class="s2">&quot;2012-06-12&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;h&quot;</span><span class="s1">)</span>

    <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">index=rng)</span>

    <span class="s1">result = ts.resample(</span><span class="s2">&quot;20min&quot;</span><span class="s1">).aggregate([</span><span class="s2">&quot;mean&quot;</span><span class="s0">, </span><span class="s2">&quot;sum&quot;</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">isinstance(result</span><span class="s0">, </span><span class="s1">DataFrame)</span>


<span class="s0">def </span><span class="s1">test_resample_not_monotonic():</span>
    <span class="s1">rng = date_range(</span><span class="s2">&quot;2012-06-12&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">200</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;h&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">index=rng)</span>

    <span class="s1">ts = ts.take(np.random.permutation(len(ts)))</span>

    <span class="s1">result = ts.resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).sum()</span>
    <span class="s1">exp = ts.sort_index().resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).sum()</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">exp)</span>


<span class="s0">def </span><span class="s1">test_resample_median_bug_1688():</span>

    <span class="s0">for </span><span class="s1">dtype </span><span class="s0">in </span><span class="s1">[</span><span class="s2">&quot;int64&quot;</span><span class="s0">, </span><span class="s2">&quot;int32&quot;</span><span class="s0">, </span><span class="s2">&quot;float64&quot;</span><span class="s0">, </span><span class="s2">&quot;float32&quot;</span><span class="s1">]:</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">index=[datetime(</span><span class="s3">2012</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">datetime(</span><span class="s3">2012</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">dtype=dtype</span><span class="s0">,</span>
        <span class="s1">)</span>

        <span class="s1">result = df.resample(</span><span class="s2">&quot;T&quot;</span><span class="s1">).apply(</span><span class="s0">lambda </span><span class="s1">x: x.mean())</span>
        <span class="s1">exp = df.asfreq(</span><span class="s2">&quot;T&quot;</span><span class="s1">)</span>
        <span class="s0">if </span><span class="s1">dtype == </span><span class="s2">&quot;float32&quot;</span><span class="s1">:</span>
            <span class="s4"># TODO: Empty groups cause x.mean() to return float64</span>
            <span class="s1">exp = exp.astype(</span><span class="s2">&quot;float64&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s1">result = df.resample(</span><span class="s2">&quot;T&quot;</span><span class="s1">).median()</span>
        <span class="s1">exp = df.asfreq(</span><span class="s2">&quot;T&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">exp)</span>


<span class="s0">def </span><span class="s1">test_how_lambda_functions(simple_date_range_series):</span>

    <span class="s1">ts = simple_date_range_series(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s2">&quot;4/1/2000&quot;</span><span class="s1">)</span>

    <span class="s1">result = ts.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).apply(</span><span class="s0">lambda </span><span class="s1">x: x.mean())</span>
    <span class="s1">exp = ts.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).mean()</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">exp)</span>

    <span class="s1">foo_exp = ts.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).mean()</span>
    <span class="s1">foo_exp.name = </span><span class="s2">&quot;foo&quot;</span>
    <span class="s1">bar_exp = ts.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).std()</span>
    <span class="s1">bar_exp.name = </span><span class="s2">&quot;bar&quot;</span>

    <span class="s1">result = ts.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).apply([</span><span class="s0">lambda </span><span class="s1">x: x.mean()</span><span class="s0">, lambda </span><span class="s1">x: x.std(ddof=</span><span class="s3">1</span><span class="s1">)])</span>
    <span class="s1">result.columns = [</span><span class="s2">&quot;foo&quot;</span><span class="s0">, </span><span class="s2">&quot;bar&quot;</span><span class="s1">]</span>
    <span class="s1">tm.assert_series_equal(result[</span><span class="s2">&quot;foo&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">foo_exp)</span>
    <span class="s1">tm.assert_series_equal(result[</span><span class="s2">&quot;bar&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">bar_exp)</span>

    <span class="s4"># this is a MI Series, so comparing the names of the results</span>
    <span class="s4"># doesn't make sense</span>
    <span class="s1">result = ts.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).aggregate(</span>
        <span class="s1">{</span><span class="s2">&quot;foo&quot;</span><span class="s1">: </span><span class="s0">lambda </span><span class="s1">x: x.mean()</span><span class="s0">, </span><span class="s2">&quot;bar&quot;</span><span class="s1">: </span><span class="s0">lambda </span><span class="s1">x: x.std(ddof=</span><span class="s3">1</span><span class="s1">)}</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result[</span><span class="s2">&quot;foo&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">foo_exp</span><span class="s0">, </span><span class="s1">check_names=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result[</span><span class="s2">&quot;bar&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">bar_exp</span><span class="s0">, </span><span class="s1">check_names=</span><span class="s0">False</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_resample_unequal_times():</span>
    <span class="s4"># #1772</span>
    <span class="s1">start = datetime(</span><span class="s3">1999</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span>
    <span class="s4"># end hour is less than start</span>
    <span class="s1">end = datetime(</span><span class="s3">2012</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">31</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">bad_ind = date_range(start</span><span class="s0">, </span><span class="s1">end</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;30min&quot;</span><span class="s1">)</span>
    <span class="s1">df = DataFrame({</span><span class="s2">&quot;close&quot;</span><span class="s1">: </span><span class="s3">1</span><span class="s1">}</span><span class="s0">, </span><span class="s1">index=bad_ind)</span>

    <span class="s4"># it works!</span>
    <span class="s1">df.resample(</span><span class="s2">&quot;AS&quot;</span><span class="s1">).sum()</span>


<span class="s0">def </span><span class="s1">test_resample_consistency():</span>

    <span class="s4"># GH 6418</span>
    <span class="s4"># resample with bfill / limit / reindex consistency</span>

    <span class="s1">i30 = date_range(</span><span class="s2">&quot;2002-02-02&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;30T&quot;</span><span class="s1">)</span>
    <span class="s1">s = Series(np.arange(</span><span class="s3">4.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=i30)</span>
    <span class="s1">s[</span><span class="s3">2</span><span class="s1">] = np.NaN</span>

    <span class="s4"># Upsample by factor 3 with reindex() and resample() methods:</span>
    <span class="s1">i10 = date_range(i30[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">i30[-</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;10T&quot;</span><span class="s1">)</span>

    <span class="s1">s10 = s.reindex(index=i10</span><span class="s0">, </span><span class="s1">method=</span><span class="s2">&quot;bfill&quot;</span><span class="s1">)</span>
    <span class="s1">s10_2 = s.reindex(index=i10</span><span class="s0">, </span><span class="s1">method=</span><span class="s2">&quot;bfill&quot;</span><span class="s0">, </span><span class="s1">limit=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">rl = s.reindex_like(s10</span><span class="s0">, </span><span class="s1">method=</span><span class="s2">&quot;bfill&quot;</span><span class="s0">, </span><span class="s1">limit=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">r10_2 = s.resample(</span><span class="s2">&quot;10Min&quot;</span><span class="s1">).bfill(limit=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">r10 = s.resample(</span><span class="s2">&quot;10Min&quot;</span><span class="s1">).bfill()</span>

    <span class="s4"># s10_2, r10, r10_2, rl should all be equal</span>
    <span class="s1">tm.assert_series_equal(s10_2</span><span class="s0">, </span><span class="s1">r10)</span>
    <span class="s1">tm.assert_series_equal(s10_2</span><span class="s0">, </span><span class="s1">r10_2)</span>
    <span class="s1">tm.assert_series_equal(s10_2</span><span class="s0">, </span><span class="s1">rl)</span>


<span class="s0">def </span><span class="s1">test_resample_timegrouper():</span>
    <span class="s4"># GH 7227</span>
    <span class="s1">dates1 = [</span>
        <span class="s1">datetime(</span><span class="s3">2014</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">datetime(</span><span class="s3">2014</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">datetime(</span><span class="s3">2014</span><span class="s0">, </span><span class="s3">11</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">datetime(</span><span class="s3">2014</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">datetime(</span><span class="s3">2014</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">8</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">datetime(</span><span class="s3">2014</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">15</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span>

    <span class="s1">dates2 = dates1[:</span><span class="s3">2</span><span class="s1">] + [pd.NaT] + dates1[</span><span class="s3">2</span><span class="s1">:</span><span class="s3">4</span><span class="s1">] + [pd.NaT] + dates1[</span><span class="s3">4</span><span class="s1">:]</span>
    <span class="s1">dates3 = [pd.NaT] + dates1 + [pd.NaT]</span>

    <span class="s0">for </span><span class="s1">dates </span><span class="s0">in </span><span class="s1">[dates1</span><span class="s0">, </span><span class="s1">dates2</span><span class="s0">, </span><span class="s1">dates3]:</span>
        <span class="s1">df = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: dates</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: np.arange(len(dates))})</span>
        <span class="s1">result = df.set_index(</span><span class="s2">&quot;A&quot;</span><span class="s1">).resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).count()</span>
        <span class="s1">exp_idx = DatetimeIndex(</span>
            <span class="s1">[</span><span class="s2">&quot;2014-07-31&quot;</span><span class="s0">, </span><span class="s2">&quot;2014-08-31&quot;</span><span class="s0">, </span><span class="s2">&quot;2014-09-30&quot;</span><span class="s0">, </span><span class="s2">&quot;2014-10-31&quot;</span><span class="s0">, </span><span class="s2">&quot;2014-11-30&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s0">,</span>
            <span class="s1">name=</span><span class="s2">&quot;A&quot;</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">expected = DataFrame({</span><span class="s2">&quot;B&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=exp_idx)</span>
        <span class="s0">if </span><span class="s1">df[</span><span class="s2">&quot;A&quot;</span><span class="s1">].isna().any():</span>
            <span class="s1">expected.index = expected.index._with_freq(</span><span class="s0">None</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">result = df.groupby(Grouper(freq=</span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s1">key=</span><span class="s2">&quot;A&quot;</span><span class="s1">)).count()</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span><span class="s2">&quot;A&quot;</span><span class="s1">: dates</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: np.arange(len(dates))</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s1">: np.arange(len(dates))}</span>
        <span class="s1">)</span>
        <span class="s1">result = df.set_index(</span><span class="s2">&quot;A&quot;</span><span class="s1">).resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).count()</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">{</span><span class="s2">&quot;B&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]}</span><span class="s0">,</span>
            <span class="s1">index=exp_idx</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s0">if </span><span class="s1">df[</span><span class="s2">&quot;A&quot;</span><span class="s1">].isna().any():</span>
            <span class="s1">expected.index = expected.index._with_freq(</span><span class="s0">None</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">result = df.groupby(Grouper(freq=</span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s1">key=</span><span class="s2">&quot;A&quot;</span><span class="s1">)).count()</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_resample_nunique():</span>

    <span class="s4"># GH 12352</span>
    <span class="s1">df = DataFrame(</span>
        <span class="s1">{</span>
            <span class="s2">&quot;ID&quot;</span><span class="s1">: {</span>
                <span class="s1">Timestamp(</span><span class="s2">&quot;2015-06-05 00:00:00&quot;</span><span class="s1">): </span><span class="s2">&quot;0010100903&quot;</span><span class="s0">,</span>
                <span class="s1">Timestamp(</span><span class="s2">&quot;2015-06-08 00:00:00&quot;</span><span class="s1">): </span><span class="s2">&quot;0010150847&quot;</span><span class="s0">,</span>
            <span class="s1">}</span><span class="s0">,</span>
            <span class="s2">&quot;DATE&quot;</span><span class="s1">: {</span>
                <span class="s1">Timestamp(</span><span class="s2">&quot;2015-06-05 00:00:00&quot;</span><span class="s1">): </span><span class="s2">&quot;2015-06-05&quot;</span><span class="s0">,</span>
                <span class="s1">Timestamp(</span><span class="s2">&quot;2015-06-08 00:00:00&quot;</span><span class="s1">): </span><span class="s2">&quot;2015-06-08&quot;</span><span class="s0">,</span>
            <span class="s1">}</span><span class="s0">,</span>
        <span class="s1">}</span>
    <span class="s1">)</span>
    <span class="s1">r = df.resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">)</span>
    <span class="s1">g = df.groupby(Grouper(freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">))</span>
    <span class="s1">expected = df.groupby(Grouper(freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">)).ID.apply(</span><span class="s0">lambda </span><span class="s1">x: x.nunique())</span>
    <span class="s0">assert </span><span class="s1">expected.name == </span><span class="s2">&quot;ID&quot;</span>

    <span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">[r</span><span class="s0">, </span><span class="s1">g]:</span>
        <span class="s1">result = t.ID.nunique()</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = df.ID.resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).nunique()</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = df.ID.groupby(Grouper(freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">)).nunique()</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_resample_nunique_preserves_column_level_names():</span>
    <span class="s4"># see gh-23222</span>
    <span class="s1">df = tm.makeTimeDataFrame(freq=</span><span class="s2">&quot;1D&quot;</span><span class="s1">).abs()</span>
    <span class="s1">df.columns = pd.MultiIndex.from_arrays(</span>
        <span class="s1">[df.columns.tolist()] * </span><span class="s3">2</span><span class="s0">, </span><span class="s1">names=[</span><span class="s2">&quot;lev0&quot;</span><span class="s0">, </span><span class="s2">&quot;lev1&quot;</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">result = df.resample(</span><span class="s2">&quot;1h&quot;</span><span class="s1">).nunique()</span>
    <span class="s1">tm.assert_index_equal(df.columns</span><span class="s0">, </span><span class="s1">result.columns)</span>


<span class="s0">def </span><span class="s1">test_resample_nunique_with_date_gap():</span>
    <span class="s4"># GH 13453</span>
    <span class="s1">index = date_range(</span><span class="s2">&quot;1-1-2000&quot;</span><span class="s0">, </span><span class="s2">&quot;2-15-2000&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;h&quot;</span><span class="s1">)</span>
    <span class="s1">index2 = date_range(</span><span class="s2">&quot;4-15-2000&quot;</span><span class="s0">, </span><span class="s2">&quot;5-15-2000&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;h&quot;</span><span class="s1">)</span>
    <span class="s1">index3 = index.append(index2)</span>
    <span class="s1">s = Series(range(len(index3))</span><span class="s0">, </span><span class="s1">index=index3</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;int64&quot;</span><span class="s1">)</span>
    <span class="s1">r = s.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span>

    <span class="s4"># Since all elements are unique, these should all be the same</span>
    <span class="s1">results = [r.count()</span><span class="s0">, </span><span class="s1">r.nunique()</span><span class="s0">, </span><span class="s1">r.agg(Series.nunique)</span><span class="s0">, </span><span class="s1">r.agg(</span><span class="s2">&quot;nunique&quot;</span><span class="s1">)]</span>

    <span class="s1">tm.assert_series_equal(results[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">results[</span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">tm.assert_series_equal(results[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">results[</span><span class="s3">2</span><span class="s1">])</span>
    <span class="s1">tm.assert_series_equal(results[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">results[</span><span class="s3">3</span><span class="s1">])</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;n&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">10000</span><span class="s0">, </span><span class="s3">100000</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;k&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">10</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s3">1000</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_resample_group_info(n</span><span class="s0">, </span><span class="s1">k):</span>
    <span class="s4"># GH10914</span>

    <span class="s4"># use a fixed seed to always have the same uniques</span>
    <span class="s1">prng = np.random.RandomState(</span><span class="s3">1234</span><span class="s1">)</span>

    <span class="s1">dr = date_range(start=</span><span class="s2">&quot;2015-08-27&quot;</span><span class="s0">, </span><span class="s1">periods=n // </span><span class="s3">10</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;T&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(prng.randint(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">n // k</span><span class="s0">, </span><span class="s1">n).astype(</span><span class="s2">&quot;int64&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=prng.choice(dr</span><span class="s0">, </span><span class="s1">n))</span>

    <span class="s1">left = ts.resample(</span><span class="s2">&quot;30T&quot;</span><span class="s1">).nunique()</span>
    <span class="s1">ix = date_range(start=ts.index.min()</span><span class="s0">, </span><span class="s1">end=ts.index.max()</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;30T&quot;</span><span class="s1">)</span>

    <span class="s1">vals = ts.values</span>
    <span class="s1">bins = np.searchsorted(ix.values</span><span class="s0">, </span><span class="s1">ts.index</span><span class="s0">, </span><span class="s1">side=</span><span class="s2">&quot;right&quot;</span><span class="s1">)</span>

    <span class="s1">sorter = np.lexsort((vals</span><span class="s0">, </span><span class="s1">bins))</span>
    <span class="s1">vals</span><span class="s0">, </span><span class="s1">bins = vals[sorter]</span><span class="s0">, </span><span class="s1">bins[sorter]</span>

    <span class="s1">mask = np.r_[</span><span class="s0">True, </span><span class="s1">vals[</span><span class="s3">1</span><span class="s1">:] != vals[:-</span><span class="s3">1</span><span class="s1">]]</span>
    <span class="s1">mask |= np.r_[</span><span class="s0">True, </span><span class="s1">bins[</span><span class="s3">1</span><span class="s1">:] != bins[:-</span><span class="s3">1</span><span class="s1">]]</span>

    <span class="s1">arr = np.bincount(bins[mask] - </span><span class="s3">1</span><span class="s0">, </span><span class="s1">minlength=len(ix)).astype(</span><span class="s2">&quot;int64&quot;</span><span class="s0">, </span><span class="s1">copy=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">right = Series(arr</span><span class="s0">, </span><span class="s1">index=ix)</span>

    <span class="s1">tm.assert_series_equal(left</span><span class="s0">, </span><span class="s1">right)</span>


<span class="s0">def </span><span class="s1">test_resample_size():</span>
    <span class="s1">n = </span><span class="s3">10000</span>
    <span class="s1">dr = date_range(</span><span class="s2">&quot;2015-09-19&quot;</span><span class="s0">, </span><span class="s1">periods=n</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;T&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.random.randn(n)</span><span class="s0">, </span><span class="s1">index=np.random.choice(dr</span><span class="s0">, </span><span class="s1">n))</span>

    <span class="s1">left = ts.resample(</span><span class="s2">&quot;7T&quot;</span><span class="s1">).size()</span>
    <span class="s1">ix = date_range(start=left.index.min()</span><span class="s0">, </span><span class="s1">end=ts.index.max()</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;7T&quot;</span><span class="s1">)</span>

    <span class="s1">bins = np.searchsorted(ix.values</span><span class="s0">, </span><span class="s1">ts.index.values</span><span class="s0">, </span><span class="s1">side=</span><span class="s2">&quot;right&quot;</span><span class="s1">)</span>
    <span class="s1">val = np.bincount(bins</span><span class="s0">, </span><span class="s1">minlength=len(ix) + </span><span class="s3">1</span><span class="s1">)[</span><span class="s3">1</span><span class="s1">:].astype(</span><span class="s2">&quot;int64&quot;</span><span class="s0">, </span><span class="s1">copy=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s1">right = Series(val</span><span class="s0">, </span><span class="s1">index=ix)</span>
    <span class="s1">tm.assert_series_equal(left</span><span class="s0">, </span><span class="s1">right)</span>


<span class="s0">def </span><span class="s1">test_resample_across_dst():</span>
    <span class="s4"># The test resamples a DatetimeIndex with values before and after a</span>
    <span class="s4"># DST change</span>
    <span class="s4"># Issue: 14682</span>

    <span class="s4"># The DatetimeIndex we will start with</span>
    <span class="s4"># (note that DST happens at 03:00+02:00 -&gt; 02:00+01:00)</span>
    <span class="s4"># 2016-10-30 02:23:00+02:00, 2016-10-30 02:23:00+01:00</span>
    <span class="s1">df1 = DataFrame([</span><span class="s3">1477786980</span><span class="s0">, </span><span class="s3">1477790580</span><span class="s1">]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s2">&quot;ts&quot;</span><span class="s1">])</span>
    <span class="s1">dti1 = DatetimeIndex(</span>
        <span class="s1">pd.to_datetime(df1.ts</span><span class="s0">, </span><span class="s1">unit=</span><span class="s2">&quot;s&quot;</span><span class="s1">)</span>
        <span class="s1">.dt.tz_localize(</span><span class="s2">&quot;UTC&quot;</span><span class="s1">)</span>
        <span class="s1">.dt.tz_convert(</span><span class="s2">&quot;Europe/Madrid&quot;</span><span class="s1">)</span>
    <span class="s1">)</span>

    <span class="s4"># The expected DatetimeIndex after resampling.</span>
    <span class="s4"># 2016-10-30 02:00:00+02:00, 2016-10-30 02:00:00+01:00</span>
    <span class="s1">df2 = DataFrame([</span><span class="s3">1477785600</span><span class="s0">, </span><span class="s3">1477789200</span><span class="s1">]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s2">&quot;ts&quot;</span><span class="s1">])</span>
    <span class="s1">dti2 = DatetimeIndex(</span>
        <span class="s1">pd.to_datetime(df2.ts</span><span class="s0">, </span><span class="s1">unit=</span><span class="s2">&quot;s&quot;</span><span class="s1">)</span>
        <span class="s1">.dt.tz_localize(</span><span class="s2">&quot;UTC&quot;</span><span class="s1">)</span>
        <span class="s1">.dt.tz_convert(</span><span class="s2">&quot;Europe/Madrid&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">freq=</span><span class="s2">&quot;H&quot;</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">df = DataFrame([</span><span class="s3">5</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=dti1)</span>

    <span class="s1">result = df.resample(rule=</span><span class="s2">&quot;H&quot;</span><span class="s1">).sum()</span>
    <span class="s1">expected = DataFrame([</span><span class="s3">5</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=dti2)</span>

    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_groupby_with_dst_time_change():</span>
    <span class="s4"># GH 24972</span>
    <span class="s1">index = DatetimeIndex(</span>
        <span class="s1">[</span><span class="s3">1478064900001000000</span><span class="s0">, </span><span class="s3">1480037118776792000</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;UTC&quot;</span>
    <span class="s1">).tz_convert(</span><span class="s2">&quot;America/Chicago&quot;</span><span class="s1">)</span>

    <span class="s1">df = DataFrame([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=index)</span>
    <span class="s1">result = df.groupby(Grouper(freq=</span><span class="s2">&quot;1d&quot;</span><span class="s1">)).last()</span>
    <span class="s1">expected_index_values = date_range(</span>
        <span class="s2">&quot;2016-11-02&quot;</span><span class="s0">, </span><span class="s2">&quot;2016-11-24&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;America/Chicago&quot;</span>
    <span class="s1">)</span>

    <span class="s1">index = DatetimeIndex(expected_index_values)</span>
    <span class="s1">expected = DataFrame([</span><span class="s3">1.0</span><span class="s1">] + ([np.nan] * </span><span class="s3">21</span><span class="s1">) + [</span><span class="s3">2.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=index)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_resample_dst_anchor():</span>
    <span class="s4"># 5172</span>
    <span class="s1">dti = DatetimeIndex([datetime(</span><span class="s3">2012</span><span class="s0">, </span><span class="s3">11</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">23</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">)</span>
    <span class="s1">df = DataFrame([</span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=dti)</span>

    <span class="s1">dti = DatetimeIndex(df.index.normalize()</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">)</span>
    <span class="s1">expected = DataFrame([</span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=dti)</span>
    <span class="s1">tm.assert_frame_equal(df.resample(rule=</span><span class="s2">&quot;D&quot;</span><span class="s1">).sum()</span><span class="s0">, </span><span class="s1">expected)</span>
    <span class="s1">df.resample(rule=</span><span class="s2">&quot;MS&quot;</span><span class="s1">).sum()</span>
    <span class="s1">tm.assert_frame_equal(</span>
        <span class="s1">df.resample(rule=</span><span class="s2">&quot;MS&quot;</span><span class="s1">).sum()</span><span class="s0">,</span>
        <span class="s1">DataFrame(</span>
            <span class="s1">[</span><span class="s3">5</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">index=DatetimeIndex([datetime(</span><span class="s3">2012</span><span class="s0">, </span><span class="s3">11</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;MS&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s1">dti = date_range(</span><span class="s2">&quot;2013-09-30&quot;</span><span class="s0">, </span><span class="s2">&quot;2013-11-02&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;30Min&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;Europe/Paris&quot;</span><span class="s1">)</span>
    <span class="s1">values = range(dti.size)</span>
    <span class="s1">df = DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: values</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: values</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">: values}</span><span class="s0">, </span><span class="s1">index=dti</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;int64&quot;</span><span class="s1">)</span>
    <span class="s1">how = {</span><span class="s2">&quot;a&quot;</span><span class="s1">: </span><span class="s2">&quot;min&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: </span><span class="s2">&quot;max&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">: </span><span class="s2">&quot;count&quot;</span><span class="s1">}</span>

    <span class="s1">tm.assert_frame_equal(</span>
        <span class="s1">df.resample(</span><span class="s2">&quot;W-MON&quot;</span><span class="s1">).agg(how)[[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">48</span><span class="s0">, </span><span class="s3">384</span><span class="s0">, </span><span class="s3">720</span><span class="s0">, </span><span class="s3">1056</span><span class="s0">, </span><span class="s3">1394</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">47</span><span class="s0">, </span><span class="s3">383</span><span class="s0">, </span><span class="s3">719</span><span class="s0">, </span><span class="s3">1055</span><span class="s0">, </span><span class="s3">1393</span><span class="s0">, </span><span class="s3">1586</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;c&quot;</span><span class="s1">: [</span><span class="s3">48</span><span class="s0">, </span><span class="s3">336</span><span class="s0">, </span><span class="s3">336</span><span class="s0">, </span><span class="s3">336</span><span class="s0">, </span><span class="s3">338</span><span class="s0">, </span><span class="s3">193</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">}</span><span class="s0">,</span>
            <span class="s1">index=date_range(</span><span class="s2">&quot;9/30/2013&quot;</span><span class="s0">, </span><span class="s2">&quot;11/4/2013&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;W-MON&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;Europe/Paris&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s2">&quot;W-MON Frequency&quot;</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s1">tm.assert_frame_equal(</span>
        <span class="s1">df.resample(</span><span class="s2">&quot;2W-MON&quot;</span><span class="s1">).agg(how)[[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">48</span><span class="s0">, </span><span class="s3">720</span><span class="s0">, </span><span class="s3">1394</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">47</span><span class="s0">, </span><span class="s3">719</span><span class="s0">, </span><span class="s3">1393</span><span class="s0">, </span><span class="s3">1586</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;c&quot;</span><span class="s1">: [</span><span class="s3">48</span><span class="s0">, </span><span class="s3">672</span><span class="s0">, </span><span class="s3">674</span><span class="s0">, </span><span class="s3">193</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">}</span><span class="s0">,</span>
            <span class="s1">index=date_range(</span>
                <span class="s2">&quot;9/30/2013&quot;</span><span class="s0">, </span><span class="s2">&quot;11/11/2013&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;2W-MON&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;Europe/Paris&quot;</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s2">&quot;2W-MON Frequency&quot;</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s1">tm.assert_frame_equal(</span>
        <span class="s1">df.resample(</span><span class="s2">&quot;MS&quot;</span><span class="s1">).agg(how)[[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">DataFrame(</span>
            <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">48</span><span class="s0">, </span><span class="s3">1538</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">47</span><span class="s0">, </span><span class="s3">1537</span><span class="s0">, </span><span class="s3">1586</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">: [</span><span class="s3">48</span><span class="s0">, </span><span class="s3">1490</span><span class="s0">, </span><span class="s3">49</span><span class="s1">]}</span><span class="s0">,</span>
            <span class="s1">index=date_range(</span><span class="s2">&quot;9/1/2013&quot;</span><span class="s0">, </span><span class="s2">&quot;11/1/2013&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;MS&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;Europe/Paris&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s2">&quot;MS Frequency&quot;</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s1">tm.assert_frame_equal(</span>
        <span class="s1">df.resample(</span><span class="s2">&quot;2MS&quot;</span><span class="s1">).agg(how)[[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">DataFrame(</span>
            <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1538</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">1537</span><span class="s0">, </span><span class="s3">1586</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">: [</span><span class="s3">1538</span><span class="s0">, </span><span class="s3">49</span><span class="s1">]}</span><span class="s0">,</span>
            <span class="s1">index=date_range(</span><span class="s2">&quot;9/1/2013&quot;</span><span class="s0">, </span><span class="s2">&quot;11/1/2013&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;2MS&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;Europe/Paris&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s2">&quot;2MS Frequency&quot;</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s1">df_daily = df[</span><span class="s2">&quot;10/26/2013&quot;</span><span class="s1">:</span><span class="s2">&quot;10/29/2013&quot;</span><span class="s1">]</span>
    <span class="s1">tm.assert_frame_equal(</span>
        <span class="s1">df_daily.resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).agg({</span><span class="s2">&quot;a&quot;</span><span class="s1">: </span><span class="s2">&quot;min&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: </span><span class="s2">&quot;max&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">: </span><span class="s2">&quot;count&quot;</span><span class="s1">})[</span>
            <span class="s1">[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">]</span>
        <span class="s1">]</span><span class="s0">,</span>
        <span class="s1">DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1248</span><span class="s0">, </span><span class="s3">1296</span><span class="s0">, </span><span class="s3">1346</span><span class="s0">, </span><span class="s3">1394</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">1295</span><span class="s0">, </span><span class="s3">1345</span><span class="s0">, </span><span class="s3">1393</span><span class="s0">, </span><span class="s3">1441</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;c&quot;</span><span class="s1">: [</span><span class="s3">48</span><span class="s0">, </span><span class="s3">50</span><span class="s0">, </span><span class="s3">48</span><span class="s0">, </span><span class="s3">48</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">}</span><span class="s0">,</span>
            <span class="s1">index=date_range(</span><span class="s2">&quot;10/26/2013&quot;</span><span class="s0">, </span><span class="s2">&quot;10/29/2013&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;Europe/Paris&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s2">&quot;D Frequency&quot;</span><span class="s0">,</span>
    <span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_downsample_across_dst():</span>
    <span class="s4"># GH 8531</span>
    <span class="s1">tz = pytz.timezone(</span><span class="s2">&quot;Europe/Berlin&quot;</span><span class="s1">)</span>
    <span class="s1">dt = datetime(</span><span class="s3">2014</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">26</span><span class="s1">)</span>
    <span class="s1">dates = date_range(tz.localize(dt)</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;2H&quot;</span><span class="s1">)</span>
    <span class="s1">result = Series(</span><span class="s3">5</span><span class="s0">, </span><span class="s1">index=dates).resample(</span><span class="s2">&quot;H&quot;</span><span class="s1">).mean()</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">[</span><span class="s3">5.0</span><span class="s0">, </span><span class="s1">np.nan] * </span><span class="s3">3 </span><span class="s1">+ [</span><span class="s3">5.0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">index=date_range(tz.localize(dt)</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">7</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;H&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_downsample_across_dst_weekly():</span>
    <span class="s4"># GH 9119, GH 21459</span>
    <span class="s1">df = DataFrame(</span>
        <span class="s1">index=DatetimeIndex(</span>
            <span class="s1">[</span><span class="s2">&quot;2017-03-25&quot;</span><span class="s0">, </span><span class="s2">&quot;2017-03-26&quot;</span><span class="s0">, </span><span class="s2">&quot;2017-03-27&quot;</span><span class="s0">, </span><span class="s2">&quot;2017-03-28&quot;</span><span class="s0">, </span><span class="s2">&quot;2017-03-29&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">tz=</span><span class="s2">&quot;Europe/Amsterdam&quot;</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">data=[</span><span class="s3">11</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">13</span><span class="s0">, </span><span class="s3">14</span><span class="s0">, </span><span class="s3">15</span><span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">result = df.resample(</span><span class="s2">&quot;1W&quot;</span><span class="s1">).sum()</span>
    <span class="s1">expected = DataFrame(</span>
        <span class="s1">[</span><span class="s3">23</span><span class="s0">, </span><span class="s3">42</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">index=DatetimeIndex(</span>
            <span class="s1">[</span><span class="s2">&quot;2017-03-26&quot;</span><span class="s0">, </span><span class="s2">&quot;2017-04-02&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;Europe/Amsterdam&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;W&quot;</span>
        <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">idx = date_range(</span><span class="s2">&quot;2013-04-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2013-05-01&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;Europe/London&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;H&quot;</span><span class="s1">)</span>
    <span class="s1">s = Series(index=idx</span><span class="s0">, </span><span class="s1">dtype=np.float64)</span>
    <span class="s1">result = s.resample(</span><span class="s2">&quot;W&quot;</span><span class="s1">).mean()</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">index=date_range(</span><span class="s2">&quot;2013-04-07&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;W&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">5</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;Europe/London&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">dtype=np.float64</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_downsample_dst_at_midnight():</span>
    <span class="s4"># GH 25758</span>
    <span class="s1">start = datetime(</span><span class="s3">2018</span><span class="s0">, </span><span class="s3">11</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">12</span><span class="s1">)</span>
    <span class="s1">end = datetime(</span><span class="s3">2018</span><span class="s0">, </span><span class="s3">11</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">12</span><span class="s1">)</span>
    <span class="s1">index = date_range(start</span><span class="s0">, </span><span class="s1">end</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;1H&quot;</span><span class="s1">)</span>
    <span class="s1">index = index.tz_localize(</span><span class="s2">&quot;UTC&quot;</span><span class="s1">).tz_convert(</span><span class="s2">&quot;America/Havana&quot;</span><span class="s1">)</span>
    <span class="s1">data = list(range(len(index)))</span>
    <span class="s1">dataframe = DataFrame(data</span><span class="s0">, </span><span class="s1">index=index)</span>
    <span class="s1">result = dataframe.groupby(Grouper(freq=</span><span class="s2">&quot;1D&quot;</span><span class="s1">)).mean()</span>

    <span class="s1">dti = date_range(</span><span class="s2">&quot;2018-11-03&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">).tz_localize(</span>
        <span class="s2">&quot;America/Havana&quot;</span><span class="s0">, </span><span class="s1">ambiguous=</span><span class="s0">True</span>
    <span class="s1">)</span>
    <span class="s1">dti = DatetimeIndex(dti</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">)</span>
    <span class="s1">expected = DataFrame([</span><span class="s3">7.5</span><span class="s0">, </span><span class="s3">28.0</span><span class="s0">, </span><span class="s3">44.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=dti)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_resample_with_nat():</span>
    <span class="s4"># GH 13020</span>
    <span class="s1">index = DatetimeIndex(</span>
        <span class="s1">[</span>
            <span class="s1">pd.NaT</span><span class="s0">,</span>
            <span class="s2">&quot;1970-01-01 00:00:00&quot;</span><span class="s0">,</span>
            <span class="s1">pd.NaT</span><span class="s0">,</span>
            <span class="s2">&quot;1970-01-01 00:00:01&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;1970-01-01 00:00:02&quot;</span><span class="s0">,</span>
        <span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">frame = DataFrame([</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">11</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=index)</span>

    <span class="s1">index_1s = DatetimeIndex(</span>
        <span class="s1">[</span><span class="s2">&quot;1970-01-01 00:00:00&quot;</span><span class="s0">, </span><span class="s2">&quot;1970-01-01 00:00:01&quot;</span><span class="s0">, </span><span class="s2">&quot;1970-01-01 00:00:02&quot;</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">frame_1s = DataFrame([</span><span class="s3">3.0</span><span class="s0">, </span><span class="s3">7.0</span><span class="s0">, </span><span class="s3">11.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=index_1s)</span>
    <span class="s1">tm.assert_frame_equal(frame.resample(</span><span class="s2">&quot;1s&quot;</span><span class="s1">).mean()</span><span class="s0">, </span><span class="s1">frame_1s)</span>

    <span class="s1">index_2s = DatetimeIndex([</span><span class="s2">&quot;1970-01-01 00:00:00&quot;</span><span class="s0">, </span><span class="s2">&quot;1970-01-01 00:00:02&quot;</span><span class="s1">])</span>
    <span class="s1">frame_2s = DataFrame([</span><span class="s3">5.0</span><span class="s0">, </span><span class="s3">11.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=index_2s)</span>
    <span class="s1">tm.assert_frame_equal(frame.resample(</span><span class="s2">&quot;2s&quot;</span><span class="s1">).mean()</span><span class="s0">, </span><span class="s1">frame_2s)</span>

    <span class="s1">index_3s = DatetimeIndex([</span><span class="s2">&quot;1970-01-01 00:00:00&quot;</span><span class="s1">])</span>
    <span class="s1">frame_3s = DataFrame([</span><span class="s3">7.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=index_3s)</span>
    <span class="s1">tm.assert_frame_equal(frame.resample(</span><span class="s2">&quot;3s&quot;</span><span class="s1">).mean()</span><span class="s0">, </span><span class="s1">frame_3s)</span>

    <span class="s1">tm.assert_frame_equal(frame.resample(</span><span class="s2">&quot;60s&quot;</span><span class="s1">).mean()</span><span class="s0">, </span><span class="s1">frame_3s)</span>


<span class="s0">def </span><span class="s1">test_resample_datetime_values():</span>
    <span class="s4"># GH 13119</span>
    <span class="s4"># check that datetime dtype is preserved when NaT values are</span>
    <span class="s4"># introduced by the resampling</span>

    <span class="s1">dates = [datetime(</span><span class="s3">2016</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">15</span><span class="s1">)</span><span class="s0">, </span><span class="s1">datetime(</span><span class="s3">2016</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">19</span><span class="s1">)]</span>
    <span class="s1">df = DataFrame({</span><span class="s2">&quot;timestamp&quot;</span><span class="s1">: dates}</span><span class="s0">, </span><span class="s1">index=dates)</span>

    <span class="s1">exp = Series(</span>
        <span class="s1">[datetime(</span><span class="s3">2016</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">15</span><span class="s1">)</span><span class="s0">, </span><span class="s1">pd.NaT</span><span class="s0">, </span><span class="s1">datetime(</span><span class="s3">2016</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">19</span><span class="s1">)]</span><span class="s0">,</span>
        <span class="s1">index=date_range(</span><span class="s2">&quot;2016-01-15&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;2D&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">name=</span><span class="s2">&quot;timestamp&quot;</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s1">res = df.resample(</span><span class="s2">&quot;2D&quot;</span><span class="s1">).first()[</span><span class="s2">&quot;timestamp&quot;</span><span class="s1">]</span>
    <span class="s1">tm.assert_series_equal(res</span><span class="s0">, </span><span class="s1">exp)</span>
    <span class="s1">res = df[</span><span class="s2">&quot;timestamp&quot;</span><span class="s1">].resample(</span><span class="s2">&quot;2D&quot;</span><span class="s1">).first()</span>
    <span class="s1">tm.assert_series_equal(res</span><span class="s0">, </span><span class="s1">exp)</span>


<span class="s0">def </span><span class="s1">test_resample_apply_with_additional_args(series):</span>
    <span class="s4"># GH 14615</span>
    <span class="s0">def </span><span class="s1">f(data</span><span class="s0">, </span><span class="s1">add_arg):</span>
        <span class="s0">return </span><span class="s1">np.mean(data) * add_arg</span>

    <span class="s1">multiplier = </span><span class="s3">10</span>
    <span class="s1">result = series.resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).apply(f</span><span class="s0">, </span><span class="s1">multiplier)</span>
    <span class="s1">expected = series.resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).mean().multiply(multiplier)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s4"># Testing as kwarg</span>
    <span class="s1">result = series.resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).apply(f</span><span class="s0">, </span><span class="s1">add_arg=multiplier)</span>
    <span class="s1">expected = series.resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).mean().multiply(multiplier)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s4"># Testing dataframe</span>
    <span class="s1">df = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: </span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: </span><span class="s3">2</span><span class="s1">}</span><span class="s0">, </span><span class="s1">index=date_range(</span><span class="s2">&quot;2017&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">10</span><span class="s1">))</span>
    <span class="s1">result = df.groupby(</span><span class="s2">&quot;A&quot;</span><span class="s1">).resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).agg(f</span><span class="s0">, </span><span class="s1">multiplier).astype(float)</span>
    <span class="s1">expected = df.groupby(</span><span class="s2">&quot;A&quot;</span><span class="s1">).resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).mean().multiply(multiplier)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;k&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;n1, freq1, n2, freq2&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s3">30</span><span class="s0">, </span><span class="s2">&quot;S&quot;</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s2">&quot;Min&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">60</span><span class="s0">, </span><span class="s2">&quot;S&quot;</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;Min&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">3600</span><span class="s0">, </span><span class="s2">&quot;S&quot;</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;H&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">60</span><span class="s0">, </span><span class="s2">&quot;Min&quot;</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;H&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">21600</span><span class="s0">, </span><span class="s2">&quot;S&quot;</span><span class="s0">, </span><span class="s3">0.25</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">86400</span><span class="s0">, </span><span class="s2">&quot;S&quot;</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">43200</span><span class="s0">, </span><span class="s2">&quot;S&quot;</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">1440</span><span class="s0">, </span><span class="s2">&quot;Min&quot;</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">12</span><span class="s0">, </span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">24</span><span class="s0">, </span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_resample_equivalent_offsets(n1</span><span class="s0">, </span><span class="s1">freq1</span><span class="s0">, </span><span class="s1">n2</span><span class="s0">, </span><span class="s1">freq2</span><span class="s0">, </span><span class="s1">k):</span>
    <span class="s4"># GH 24127</span>
    <span class="s1">n1_ = n1 * k</span>
    <span class="s1">n2_ = n2 * k</span>
    <span class="s1">s = Series(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">index=date_range(</span><span class="s2">&quot;19910905 13:00&quot;</span><span class="s0">, </span><span class="s2">&quot;19911005 07:00&quot;</span><span class="s0">, </span><span class="s1">freq=freq1))</span>
    <span class="s1">s = s + range(len(s))</span>

    <span class="s1">result1 = s.resample(str(n1_) + freq1).mean()</span>
    <span class="s1">result2 = s.resample(str(n2_) + freq2).mean()</span>
    <span class="s1">tm.assert_series_equal(result1</span><span class="s0">, </span><span class="s1">result2)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;first,last,freq,exp_first,exp_last&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s2">&quot;19910905&quot;</span><span class="s0">, </span><span class="s2">&quot;19920406&quot;</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;19910905&quot;</span><span class="s0">, </span><span class="s2">&quot;19920407&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;19910905 00:00&quot;</span><span class="s0">, </span><span class="s2">&quot;19920406 06:00&quot;</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;19910905&quot;</span><span class="s0">, </span><span class="s2">&quot;19920407&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;19910905 06:00&quot;</span><span class="s0">, </span><span class="s2">&quot;19920406 06:00&quot;</span><span class="s0">, </span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s2">&quot;19910905 06:00&quot;</span><span class="s0">, </span><span class="s2">&quot;19920406 07:00&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;19910906&quot;</span><span class="s0">, </span><span class="s2">&quot;19920406&quot;</span><span class="s0">, </span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s2">&quot;19910831&quot;</span><span class="s0">, </span><span class="s2">&quot;19920430&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;19910831&quot;</span><span class="s0">, </span><span class="s2">&quot;19920430&quot;</span><span class="s0">, </span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s2">&quot;19910831&quot;</span><span class="s0">, </span><span class="s2">&quot;19920531&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;1991-08&quot;</span><span class="s0">, </span><span class="s2">&quot;1992-04&quot;</span><span class="s0">, </span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s2">&quot;19910831&quot;</span><span class="s0">, </span><span class="s2">&quot;19920531&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_get_timestamp_range_edges(first</span><span class="s0">, </span><span class="s1">last</span><span class="s0">, </span><span class="s1">freq</span><span class="s0">, </span><span class="s1">exp_first</span><span class="s0">, </span><span class="s1">exp_last):</span>
    <span class="s1">first = Period(first)</span>
    <span class="s1">first = first.to_timestamp(first.freq)</span>
    <span class="s1">last = Period(last)</span>
    <span class="s1">last = last.to_timestamp(last.freq)</span>

    <span class="s1">exp_first = Timestamp(exp_first)</span>
    <span class="s1">exp_last = Timestamp(exp_last)</span>

    <span class="s1">freq = pd.tseries.frequencies.to_offset(freq)</span>
    <span class="s1">result = _get_timestamp_range_edges(first</span><span class="s0">, </span><span class="s1">last</span><span class="s0">, </span><span class="s1">freq)</span>
    <span class="s1">expected = (exp_first</span><span class="s0">, </span><span class="s1">exp_last)</span>
    <span class="s0">assert </span><span class="s1">result == expected</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;duplicates&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_resample_apply_product(duplicates):</span>
    <span class="s4"># GH 5586</span>
    <span class="s1">index = date_range(start=</span><span class="s2">&quot;2012-01-31&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">12</span><span class="s1">)</span>

    <span class="s1">ts = Series(range(</span><span class="s3">12</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=index)</span>
    <span class="s1">df = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: ts</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: ts + </span><span class="s3">2</span><span class="s1">})</span>
    <span class="s0">if </span><span class="s1">duplicates:</span>
        <span class="s1">df.columns = [</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;A&quot;</span><span class="s1">]</span>

    <span class="s1">result = df.resample(</span><span class="s2">&quot;Q&quot;</span><span class="s1">).apply(np.product)</span>
    <span class="s1">expected = DataFrame(</span>
        <span class="s1">np.array([[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">24</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">60</span><span class="s0">, </span><span class="s3">210</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">336</span><span class="s0">, </span><span class="s3">720</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">990</span><span class="s0">, </span><span class="s3">1716</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=np.int64)</span><span class="s0">,</span>
        <span class="s1">index=DatetimeIndex(</span>
            <span class="s1">[</span><span class="s2">&quot;2012-03-31&quot;</span><span class="s0">, </span><span class="s2">&quot;2012-06-30&quot;</span><span class="s0">, </span><span class="s2">&quot;2012-09-30&quot;</span><span class="s0">, </span><span class="s2">&quot;2012-12-31&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;Q-DEC&quot;</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">columns=df.columns</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;first,last,freq_in,freq_out,exp_last&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span>
            <span class="s2">&quot;2020-03-28&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;2020-03-31&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;D&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;24H&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;2020-03-30 01:00&quot;</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,  </span><span class="s4"># includes transition into DST</span>
        <span class="s1">(</span>
            <span class="s2">&quot;2020-03-28&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;2020-10-27&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;D&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;24H&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;2020-10-27 00:00&quot;</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,  </span><span class="s4"># includes transition into and out of DST</span>
        <span class="s1">(</span>
            <span class="s2">&quot;2020-10-25&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;2020-10-27&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;D&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;24H&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;2020-10-26 23:00&quot;</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,  </span><span class="s4"># includes transition out of DST</span>
        <span class="s1">(</span>
            <span class="s2">&quot;2020-03-28&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;2020-03-31&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;24H&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;D&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;2020-03-30 00:00&quot;</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,  </span><span class="s4"># same as above, but from 24H to D</span>
        <span class="s1">(</span><span class="s2">&quot;2020-03-28&quot;</span><span class="s0">, </span><span class="s2">&quot;2020-10-27&quot;</span><span class="s0">, </span><span class="s2">&quot;24H&quot;</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;2020-10-27 00:00&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;2020-10-25&quot;</span><span class="s0">, </span><span class="s2">&quot;2020-10-27&quot;</span><span class="s0">, </span><span class="s2">&quot;24H&quot;</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;2020-10-26 00:00&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_resample_calendar_day_with_dst(</span>
    <span class="s1">first: str</span><span class="s0">, </span><span class="s1">last: str</span><span class="s0">, </span><span class="s1">freq_in: str</span><span class="s0">, </span><span class="s1">freq_out: str</span><span class="s0">, </span><span class="s1">exp_last: str</span>
<span class="s1">):</span>
    <span class="s4"># GH 35219</span>
    <span class="s1">ts = Series(</span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">date_range(first</span><span class="s0">, </span><span class="s1">last</span><span class="s0">, </span><span class="s1">freq=freq_in</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;Europe/Amsterdam&quot;</span><span class="s1">))</span>
    <span class="s1">result = ts.resample(freq_out).ffill()</span>
    <span class="s1">expected = Series(</span>
        <span class="s3">1.0</span><span class="s0">, </span><span class="s1">date_range(first</span><span class="s0">, </span><span class="s1">exp_last</span><span class="s0">, </span><span class="s1">freq=freq_out</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;Europe/Amsterdam&quot;</span><span class="s1">)</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;func&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;min&quot;</span><span class="s0">, </span><span class="s2">&quot;max&quot;</span><span class="s0">, </span><span class="s2">&quot;first&quot;</span><span class="s0">, </span><span class="s2">&quot;last&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_resample_aggregate_functions_min_count(func):</span>
    <span class="s4"># GH#37768</span>
    <span class="s1">index = date_range(start=</span><span class="s2">&quot;2020&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">ser = Series([</span><span class="s3">1</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">index)</span>
    <span class="s1">result = getattr(ser.resample(</span><span class="s2">&quot;Q&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">func)(min_count=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">[np.nan]</span><span class="s0">,</span>
        <span class="s1">index=DatetimeIndex([</span><span class="s2">&quot;2020-03-31&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;Q-DEC&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_resample_unsigned_int(any_unsigned_int_numpy_dtype):</span>
    <span class="s4"># gh-43329</span>
    <span class="s1">df = DataFrame(</span>
        <span class="s1">index=date_range(start=</span><span class="s2">&quot;2000-01-01&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;2000-01-03 23&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;12H&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">columns=[</span><span class="s2">&quot;x&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">data=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">] * </span><span class="s3">2</span><span class="s0">,</span>
        <span class="s1">dtype=any_unsigned_int_numpy_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">df = df.loc[(df.index &lt; </span><span class="s2">&quot;2000-01-02&quot;</span><span class="s1">) | (df.index &gt; </span><span class="s2">&quot;2000-01-03&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">:]</span>

    <span class="s0">if </span><span class="s1">any_unsigned_int_numpy_dtype == </span><span class="s2">&quot;uint64&quot;</span><span class="s1">:</span>
        <span class="s0">with </span><span class="s1">pytest.raises(RuntimeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;empty group with uint64_t&quot;</span><span class="s1">):</span>
            <span class="s1">result = df.resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).max()</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">result = df.resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).max()</span>

        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s2">&quot;x&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">index=date_range(start=</span><span class="s2">&quot;2000-01-01&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;2000-01-03 23&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
</pre>
</body>
</html>