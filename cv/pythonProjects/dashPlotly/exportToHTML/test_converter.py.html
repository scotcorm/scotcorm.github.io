<html>
<head>
<title>test_converter.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_converter.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">date</span><span class="s0">,</span>
    <span class="s1">datetime</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">subprocess</span>
<span class="s0">import </span><span class="s1">sys</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">pandas._config.config </span><span class="s0">as </span><span class="s1">cf</span>

<span class="s0">import </span><span class="s1">pandas.util._test_decorators </span><span class="s0">as </span><span class="s1">td</span>

<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">Index</span><span class="s0">,</span>
    <span class="s1">Period</span><span class="s0">,</span>
    <span class="s1">Series</span><span class="s0">,</span>
    <span class="s1">Timestamp</span><span class="s0">,</span>
    <span class="s1">date_range</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">pandas._testing </span><span class="s0">as </span><span class="s1">tm</span>

<span class="s0">from </span><span class="s1">pandas.plotting </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">deregister_matplotlib_converters</span><span class="s0">,</span>
    <span class="s1">register_matplotlib_converters</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">from </span><span class="s1">pandas.tseries.offsets </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">Day</span><span class="s0">,</span>
    <span class="s1">Micro</span><span class="s0">,</span>
    <span class="s1">Milli</span><span class="s0">,</span>
    <span class="s1">Second</span><span class="s0">,</span>
<span class="s1">)</span>

<span class="s0">try</span><span class="s1">:</span>
    <span class="s0">from </span><span class="s1">pandas.plotting._matplotlib </span><span class="s0">import </span><span class="s1">converter</span>
<span class="s0">except </span><span class="s1">ImportError:</span>
    <span class="s2"># try / except, rather than skip, to avoid internal refactoring</span>
    <span class="s2"># causing an improper skip</span>
    <span class="s0">pass</span>

<span class="s1">pytest.importorskip(</span><span class="s3">&quot;matplotlib.pyplot&quot;</span><span class="s1">)</span>
<span class="s1">dates = pytest.importorskip(</span><span class="s3">&quot;matplotlib.dates&quot;</span><span class="s1">)</span>


<span class="s1">pytestmark = pytest.mark.slow</span>


<span class="s0">def </span><span class="s1">test_registry_mpl_resets():</span>
    <span class="s2"># Check that Matplotlib converters are properly reset (see issue #27481)</span>
    <span class="s1">code = (</span>
        <span class="s3">&quot;import matplotlib.units as units; &quot;</span>
        <span class="s3">&quot;import matplotlib.dates as mdates; &quot;</span>
        <span class="s3">&quot;n_conv = len(units.registry); &quot;</span>
        <span class="s3">&quot;import pandas as pd; &quot;</span>
        <span class="s3">&quot;pd.plotting.register_matplotlib_converters(); &quot;</span>
        <span class="s3">&quot;pd.plotting.deregister_matplotlib_converters(); &quot;</span>
        <span class="s3">&quot;assert len(units.registry) == n_conv&quot;</span>
    <span class="s1">)</span>
    <span class="s1">call = [sys.executable</span><span class="s0">, </span><span class="s3">&quot;-c&quot;</span><span class="s0">, </span><span class="s1">code]</span>
    <span class="s1">subprocess.check_output(call)</span>


<span class="s0">def </span><span class="s1">test_timtetonum_accepts_unicode():</span>
    <span class="s0">assert </span><span class="s1">converter.time2num(</span><span class="s3">&quot;00:01&quot;</span><span class="s1">) == converter.time2num(</span><span class="s3">&quot;00:01&quot;</span><span class="s1">)</span>


<span class="s0">class </span><span class="s1">TestRegistration:</span>
    <span class="s0">def </span><span class="s1">test_dont_register_by_default(self):</span>
        <span class="s2"># Run in subprocess to ensure a clean state</span>
        <span class="s1">code = (</span>
            <span class="s3">&quot;import matplotlib.units; &quot;</span>
            <span class="s3">&quot;import pandas as pd; &quot;</span>
            <span class="s3">&quot;units = dict(matplotlib.units.registry); &quot;</span>
            <span class="s3">&quot;assert pd.Timestamp not in units&quot;</span>
        <span class="s1">)</span>
        <span class="s1">call = [sys.executable</span><span class="s0">, </span><span class="s3">&quot;-c&quot;</span><span class="s0">, </span><span class="s1">code]</span>
        <span class="s0">assert </span><span class="s1">subprocess.check_call(call) == </span><span class="s4">0</span>

    <span class="s1">@td.skip_if_no(</span><span class="s3">&quot;matplotlib&quot;</span><span class="s0">, </span><span class="s1">min_version=</span><span class="s3">&quot;3.1.3&quot;</span><span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_registering_no_warning(self):</span>
        <span class="s1">plt = pytest.importorskip(</span><span class="s3">&quot;matplotlib.pyplot&quot;</span><span class="s1">)</span>
        <span class="s1">s = Series(range(</span><span class="s4">12</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=date_range(</span><span class="s3">&quot;2017&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">12</span><span class="s1">))</span>
        <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

        <span class="s2"># Set to the &quot;warn&quot; state, in case this isn't the first test run</span>
        <span class="s1">register_matplotlib_converters()</span>
        <span class="s1">ax.plot(s.index</span><span class="s0">, </span><span class="s1">s.values)</span>
        <span class="s1">plt.close()</span>

    <span class="s0">def </span><span class="s1">test_pandas_plots_register(self):</span>
        <span class="s1">plt = pytest.importorskip(</span><span class="s3">&quot;matplotlib.pyplot&quot;</span><span class="s1">)</span>
        <span class="s1">s = Series(range(</span><span class="s4">12</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=date_range(</span><span class="s3">&quot;2017&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">12</span><span class="s1">))</span>
        <span class="s2"># Set to the &quot;warn&quot; state, in case this isn't the first test run</span>
        <span class="s0">with </span><span class="s1">tm.assert_produces_warning(</span><span class="s0">None</span><span class="s1">) </span><span class="s0">as </span><span class="s1">w:</span>
            <span class="s1">s.plot()</span>

        <span class="s0">try</span><span class="s1">:</span>
            <span class="s0">assert </span><span class="s1">len(w) == </span><span class="s4">0</span>
        <span class="s0">finally</span><span class="s1">:</span>
            <span class="s1">plt.close()</span>

    <span class="s0">def </span><span class="s1">test_matplotlib_formatters(self):</span>
        <span class="s1">units = pytest.importorskip(</span><span class="s3">&quot;matplotlib.units&quot;</span><span class="s1">)</span>

        <span class="s2"># Can't make any assertion about the start state.</span>
        <span class="s2"># We we check that toggling converters off removes it, and toggling it</span>
        <span class="s2"># on restores it.</span>

        <span class="s0">with </span><span class="s1">cf.option_context(</span><span class="s3">&quot;plotting.matplotlib.register_converters&quot;</span><span class="s0">, True</span><span class="s1">):</span>
            <span class="s0">with </span><span class="s1">cf.option_context(</span><span class="s3">&quot;plotting.matplotlib.register_converters&quot;</span><span class="s0">, False</span><span class="s1">):</span>
                <span class="s0">assert </span><span class="s1">Timestamp </span><span class="s0">not in </span><span class="s1">units.registry</span>
            <span class="s0">assert </span><span class="s1">Timestamp </span><span class="s0">in </span><span class="s1">units.registry</span>

    <span class="s1">@td.skip_if_no(</span><span class="s3">&quot;matplotlib&quot;</span><span class="s0">, </span><span class="s1">min_version=</span><span class="s3">&quot;3.1.3&quot;</span><span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_option_no_warning(self):</span>
        <span class="s1">pytest.importorskip(</span><span class="s3">&quot;matplotlib.pyplot&quot;</span><span class="s1">)</span>
        <span class="s1">ctx = cf.option_context(</span><span class="s3">&quot;plotting.matplotlib.register_converters&quot;</span><span class="s0">, False</span><span class="s1">)</span>
        <span class="s1">plt = pytest.importorskip(</span><span class="s3">&quot;matplotlib.pyplot&quot;</span><span class="s1">)</span>
        <span class="s1">s = Series(range(</span><span class="s4">12</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=date_range(</span><span class="s3">&quot;2017&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">12</span><span class="s1">))</span>
        <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

        <span class="s2"># Test without registering first, no warning</span>
        <span class="s0">with </span><span class="s1">ctx:</span>
            <span class="s1">ax.plot(s.index</span><span class="s0">, </span><span class="s1">s.values)</span>

        <span class="s2"># Now test with registering</span>
        <span class="s1">register_matplotlib_converters()</span>
        <span class="s0">with </span><span class="s1">ctx:</span>
            <span class="s1">ax.plot(s.index</span><span class="s0">, </span><span class="s1">s.values)</span>
        <span class="s1">plt.close()</span>

    <span class="s0">def </span><span class="s1">test_registry_resets(self):</span>
        <span class="s1">units = pytest.importorskip(</span><span class="s3">&quot;matplotlib.units&quot;</span><span class="s1">)</span>
        <span class="s1">dates = pytest.importorskip(</span><span class="s3">&quot;matplotlib.dates&quot;</span><span class="s1">)</span>

        <span class="s2"># make a copy, to reset to</span>
        <span class="s1">original = dict(units.registry)</span>

        <span class="s0">try</span><span class="s1">:</span>
            <span class="s2"># get to a known state</span>
            <span class="s1">units.registry.clear()</span>
            <span class="s1">date_converter = dates.DateConverter()</span>
            <span class="s1">units.registry[datetime] = date_converter</span>
            <span class="s1">units.registry[date] = date_converter</span>

            <span class="s1">register_matplotlib_converters()</span>
            <span class="s0">assert </span><span class="s1">units.registry[date] </span><span class="s0">is not </span><span class="s1">date_converter</span>
            <span class="s1">deregister_matplotlib_converters()</span>
            <span class="s0">assert </span><span class="s1">units.registry[date] </span><span class="s0">is </span><span class="s1">date_converter</span>

        <span class="s0">finally</span><span class="s1">:</span>
            <span class="s2"># restore original stater</span>
            <span class="s1">units.registry.clear()</span>
            <span class="s0">for </span><span class="s1">k</span><span class="s0">, </span><span class="s1">v </span><span class="s0">in </span><span class="s1">original.items():</span>
                <span class="s1">units.registry[k] = v</span>


<span class="s0">class </span><span class="s1">TestDateTimeConverter:</span>
    <span class="s0">def </span><span class="s1">setup_method(self</span><span class="s0">, </span><span class="s1">method):</span>
        <span class="s1">self.dtc = converter.DatetimeConverter()</span>
        <span class="s1">self.tc = converter.TimeFormatter(</span><span class="s0">None</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_convert_accepts_unicode(self):</span>
        <span class="s1">r1 = self.dtc.convert(</span><span class="s3">&quot;12:22&quot;</span><span class="s0">, None, None</span><span class="s1">)</span>
        <span class="s1">r2 = self.dtc.convert(</span><span class="s3">&quot;12:22&quot;</span><span class="s0">, None, None</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">r1 == r2</span><span class="s0">, </span><span class="s3">&quot;DatetimeConverter.convert should accept unicode&quot;</span>

    <span class="s0">def </span><span class="s1">test_conversion(self):</span>
        <span class="s1">rs = self.dtc.convert([</span><span class="s3">&quot;2012-1-1&quot;</span><span class="s1">]</span><span class="s0">, None, None</span><span class="s1">)[</span><span class="s4">0</span><span class="s1">]</span>
        <span class="s1">xp = dates.date2num(datetime(</span><span class="s4">2012</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>
        <span class="s0">assert </span><span class="s1">rs == xp</span>

        <span class="s1">rs = self.dtc.convert(</span><span class="s3">&quot;2012-1-1&quot;</span><span class="s0">, None, None</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">rs == xp</span>

        <span class="s1">rs = self.dtc.convert(date(</span><span class="s4">2012</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, None, None</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">rs == xp</span>

        <span class="s1">rs = self.dtc.convert(</span><span class="s3">&quot;2012-1-1&quot;</span><span class="s0">, None, None</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">rs == xp</span>

        <span class="s1">rs = self.dtc.convert(Timestamp(</span><span class="s3">&quot;2012-1-1&quot;</span><span class="s1">)</span><span class="s0">, None, None</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">rs == xp</span>

        <span class="s2"># also testing datetime64 dtype (GH8614)</span>
        <span class="s1">rs = self.dtc.convert(</span><span class="s3">&quot;2012-01-01&quot;</span><span class="s0">, None, None</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">rs == xp</span>

        <span class="s1">rs = self.dtc.convert(</span><span class="s3">&quot;2012-01-01 00:00:00+0000&quot;</span><span class="s0">, None, None</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">rs == xp</span>

        <span class="s1">rs = self.dtc.convert(</span>
            <span class="s1">np.array([</span><span class="s3">&quot;2012-01-01 00:00:00+0000&quot;</span><span class="s0">, </span><span class="s3">&quot;2012-01-02 00:00:00+0000&quot;</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s0">None,</span>
            <span class="s0">None,</span>
        <span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">rs[</span><span class="s4">0</span><span class="s1">] == xp</span>

        <span class="s2"># we have a tz-aware date (constructed to that when we turn to utc it</span>
        <span class="s2"># is the same as our sample)</span>
        <span class="s1">ts = Timestamp(</span><span class="s3">&quot;2012-01-01&quot;</span><span class="s1">).tz_localize(</span><span class="s3">&quot;UTC&quot;</span><span class="s1">).tz_convert(</span><span class="s3">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s1">rs = self.dtc.convert(ts</span><span class="s0">, None, None</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">rs == xp</span>

        <span class="s1">rs = self.dtc.convert(ts.to_pydatetime()</span><span class="s0">, None, None</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">rs == xp</span>

        <span class="s1">rs = self.dtc.convert(Index([ts - Day(</span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ts])</span><span class="s0">, None, None</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">rs[</span><span class="s4">1</span><span class="s1">] == xp</span>

        <span class="s1">rs = self.dtc.convert(Index([ts - Day(</span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ts]).to_pydatetime()</span><span class="s0">, None, None</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">rs[</span><span class="s4">1</span><span class="s1">] == xp</span>

    <span class="s0">def </span><span class="s1">test_conversion_float(self):</span>
        <span class="s1">rtol = </span><span class="s4">0.5 </span><span class="s1">* </span><span class="s4">10 </span><span class="s1">** -</span><span class="s4">9</span>

        <span class="s1">rs = self.dtc.convert(Timestamp(</span><span class="s3">&quot;2012-1-1 01:02:03&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">&quot;UTC&quot;</span><span class="s1">)</span><span class="s0">, None, None</span><span class="s1">)</span>
        <span class="s1">xp = converter.dates.date2num(Timestamp(</span><span class="s3">&quot;2012-1-1 01:02:03&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">&quot;UTC&quot;</span><span class="s1">))</span>
        <span class="s1">tm.assert_almost_equal(rs</span><span class="s0">, </span><span class="s1">xp</span><span class="s0">, </span><span class="s1">rtol=rtol)</span>

        <span class="s1">rs = self.dtc.convert(</span>
            <span class="s1">Timestamp(</span><span class="s3">&quot;2012-1-1 09:02:03&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">&quot;Asia/Hong_Kong&quot;</span><span class="s1">)</span><span class="s0">, None, None</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_almost_equal(rs</span><span class="s0">, </span><span class="s1">xp</span><span class="s0">, </span><span class="s1">rtol=rtol)</span>

        <span class="s1">rs = self.dtc.convert(datetime(</span><span class="s4">2012</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, None, None</span><span class="s1">)</span>
        <span class="s1">tm.assert_almost_equal(rs</span><span class="s0">, </span><span class="s1">xp</span><span class="s0">, </span><span class="s1">rtol=rtol)</span>

    <span class="s0">def </span><span class="s1">test_conversion_outofbounds_datetime(self):</span>
        <span class="s2"># 2579</span>
        <span class="s1">values = [date(</span><span class="s4">1677</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">date(</span><span class="s4">1677</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)]</span>
        <span class="s1">rs = self.dtc.convert(values</span><span class="s0">, None, None</span><span class="s1">)</span>
        <span class="s1">xp = converter.dates.date2num(values)</span>
        <span class="s1">tm.assert_numpy_array_equal(rs</span><span class="s0">, </span><span class="s1">xp)</span>
        <span class="s1">rs = self.dtc.convert(values[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, None, None</span><span class="s1">)</span>
        <span class="s1">xp = converter.dates.date2num(values[</span><span class="s4">0</span><span class="s1">])</span>
        <span class="s0">assert </span><span class="s1">rs == xp</span>

        <span class="s1">values = [datetime(</span><span class="s4">1677</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">12</span><span class="s1">)</span><span class="s0">, </span><span class="s1">datetime(</span><span class="s4">1677</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">12</span><span class="s1">)]</span>
        <span class="s1">rs = self.dtc.convert(values</span><span class="s0">, None, None</span><span class="s1">)</span>
        <span class="s1">xp = converter.dates.date2num(values)</span>
        <span class="s1">tm.assert_numpy_array_equal(rs</span><span class="s0">, </span><span class="s1">xp)</span>
        <span class="s1">rs = self.dtc.convert(values[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, None, None</span><span class="s1">)</span>
        <span class="s1">xp = converter.dates.date2num(values[</span><span class="s4">0</span><span class="s1">])</span>
        <span class="s0">assert </span><span class="s1">rs == xp</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;time,format_expected&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">(</span><span class="s4">0</span><span class="s0">, </span><span class="s3">&quot;00:00&quot;</span><span class="s1">)</span><span class="s0">,  </span><span class="s2"># time2num(datetime.time.min)</span>
            <span class="s1">(</span><span class="s4">86399.999999</span><span class="s0">, </span><span class="s3">&quot;23:59:59.999999&quot;</span><span class="s1">)</span><span class="s0">,  </span><span class="s2"># time2num(datetime.time.max)</span>
            <span class="s1">(</span><span class="s4">90000</span><span class="s0">, </span><span class="s3">&quot;01:00&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s4">3723</span><span class="s0">, </span><span class="s3">&quot;01:02:03&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s4">39723.2</span><span class="s0">, </span><span class="s3">&quot;11:02:03.200&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_time_formatter(self</span><span class="s0">, </span><span class="s1">time</span><span class="s0">, </span><span class="s1">format_expected):</span>
        <span class="s2"># issue 18478</span>
        <span class="s1">result = self.tc(time)</span>
        <span class="s0">assert </span><span class="s1">result == format_expected</span>

    <span class="s0">def </span><span class="s1">test_dateindex_conversion(self):</span>
        <span class="s1">rtol = </span><span class="s4">10 </span><span class="s1">** -</span><span class="s4">9</span>

        <span class="s0">for </span><span class="s1">freq </span><span class="s0">in </span><span class="s1">(</span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s3">&quot;L&quot;</span><span class="s0">, </span><span class="s3">&quot;S&quot;</span><span class="s1">):</span>
            <span class="s1">dateindex = tm.makeDateIndex(k=</span><span class="s4">10</span><span class="s0">, </span><span class="s1">freq=freq)</span>
            <span class="s1">rs = self.dtc.convert(dateindex</span><span class="s0">, None, None</span><span class="s1">)</span>
            <span class="s1">xp = converter.dates.date2num(dateindex._mpl_repr())</span>
            <span class="s1">tm.assert_almost_equal(rs</span><span class="s0">, </span><span class="s1">xp</span><span class="s0">, </span><span class="s1">rtol=rtol)</span>

    <span class="s0">def </span><span class="s1">test_resolution(self):</span>
        <span class="s0">def </span><span class="s1">_assert_less(ts1</span><span class="s0">, </span><span class="s1">ts2):</span>
            <span class="s1">val1 = self.dtc.convert(ts1</span><span class="s0">, None, None</span><span class="s1">)</span>
            <span class="s1">val2 = self.dtc.convert(ts2</span><span class="s0">, None, None</span><span class="s1">)</span>
            <span class="s0">if not </span><span class="s1">val1 &lt; val2:</span>
                <span class="s0">raise </span><span class="s1">AssertionError(</span><span class="s3">f&quot;</span><span class="s0">{</span><span class="s1">val1</span><span class="s0">} </span><span class="s3">is not less than </span><span class="s0">{</span><span class="s1">val2</span><span class="s0">}</span><span class="s3">.&quot;</span><span class="s1">)</span>

        <span class="s2"># Matplotlib's time representation using floats cannot distinguish</span>
        <span class="s2"># intervals smaller than ~10 microsecond in the common range of years.</span>
        <span class="s1">ts = Timestamp(</span><span class="s3">&quot;2012-1-1&quot;</span><span class="s1">)</span>
        <span class="s1">_assert_less(ts</span><span class="s0">, </span><span class="s1">ts + Second())</span>
        <span class="s1">_assert_less(ts</span><span class="s0">, </span><span class="s1">ts + Milli())</span>
        <span class="s1">_assert_less(ts</span><span class="s0">, </span><span class="s1">ts + Micro(</span><span class="s4">50</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_convert_nested(self):</span>
        <span class="s1">inner = [Timestamp(</span><span class="s3">&quot;2017-01-01&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">Timestamp(</span><span class="s3">&quot;2017-01-02&quot;</span><span class="s1">)]</span>
        <span class="s1">data = [inner</span><span class="s0">, </span><span class="s1">inner]</span>
        <span class="s1">result = self.dtc.convert(data</span><span class="s0">, None, None</span><span class="s1">)</span>
        <span class="s1">expected = [self.dtc.convert(x</span><span class="s0">, None, None</span><span class="s1">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">data]</span>
        <span class="s0">assert </span><span class="s1">(np.array(result) == expected).all()</span>


<span class="s0">class </span><span class="s1">TestPeriodConverter:</span>
    <span class="s0">def </span><span class="s1">setup_method(self</span><span class="s0">, </span><span class="s1">method):</span>
        <span class="s1">self.pc = converter.PeriodConverter()</span>

        <span class="s0">class </span><span class="s1">Axis:</span>
            <span class="s0">pass</span>

        <span class="s1">self.axis = Axis()</span>
        <span class="s1">self.axis.freq = </span><span class="s3">&quot;D&quot;</span>

    <span class="s0">def </span><span class="s1">test_convert_accepts_unicode(self):</span>
        <span class="s1">r1 = self.pc.convert(</span><span class="s3">&quot;2012-1-1&quot;</span><span class="s0">, None, </span><span class="s1">self.axis)</span>
        <span class="s1">r2 = self.pc.convert(</span><span class="s3">&quot;2012-1-1&quot;</span><span class="s0">, None, </span><span class="s1">self.axis)</span>
        <span class="s0">assert </span><span class="s1">r1 == r2</span>

    <span class="s0">def </span><span class="s1">test_conversion(self):</span>
        <span class="s1">rs = self.pc.convert([</span><span class="s3">&quot;2012-1-1&quot;</span><span class="s1">]</span><span class="s0">, None, </span><span class="s1">self.axis)[</span><span class="s4">0</span><span class="s1">]</span>
        <span class="s1">xp = Period(</span><span class="s3">&quot;2012-1-1&quot;</span><span class="s1">).ordinal</span>
        <span class="s0">assert </span><span class="s1">rs == xp</span>

        <span class="s1">rs = self.pc.convert(</span><span class="s3">&quot;2012-1-1&quot;</span><span class="s0">, None, </span><span class="s1">self.axis)</span>
        <span class="s0">assert </span><span class="s1">rs == xp</span>

        <span class="s1">rs = self.pc.convert([date(</span><span class="s4">2012</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)]</span><span class="s0">, None, </span><span class="s1">self.axis)[</span><span class="s4">0</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">rs == xp</span>

        <span class="s1">rs = self.pc.convert(date(</span><span class="s4">2012</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, None, </span><span class="s1">self.axis)</span>
        <span class="s0">assert </span><span class="s1">rs == xp</span>

        <span class="s1">rs = self.pc.convert([Timestamp(</span><span class="s3">&quot;2012-1-1&quot;</span><span class="s1">)]</span><span class="s0">, None, </span><span class="s1">self.axis)[</span><span class="s4">0</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">rs == xp</span>

        <span class="s1">rs = self.pc.convert(Timestamp(</span><span class="s3">&quot;2012-1-1&quot;</span><span class="s1">)</span><span class="s0">, None, </span><span class="s1">self.axis)</span>
        <span class="s0">assert </span><span class="s1">rs == xp</span>

        <span class="s1">rs = self.pc.convert(</span><span class="s3">&quot;2012-01-01&quot;</span><span class="s0">, None, </span><span class="s1">self.axis)</span>
        <span class="s0">assert </span><span class="s1">rs == xp</span>

        <span class="s1">rs = self.pc.convert(</span><span class="s3">&quot;2012-01-01 00:00:00+0000&quot;</span><span class="s0">, None, </span><span class="s1">self.axis)</span>
        <span class="s0">assert </span><span class="s1">rs == xp</span>

        <span class="s1">rs = self.pc.convert(</span>
            <span class="s1">np.array(</span>
                <span class="s1">[</span><span class="s3">&quot;2012-01-01 00:00:00+0000&quot;</span><span class="s0">, </span><span class="s3">&quot;2012-01-02 00:00:00+0000&quot;</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">dtype=</span><span class="s3">&quot;datetime64[ns]&quot;</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s0">None,</span>
            <span class="s1">self.axis</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">rs[</span><span class="s4">0</span><span class="s1">] == xp</span>

    <span class="s0">def </span><span class="s1">test_integer_passthrough(self):</span>
        <span class="s2"># GH9012</span>
        <span class="s1">rs = self.pc.convert([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, None, </span><span class="s1">self.axis)</span>
        <span class="s1">xp = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">rs == xp</span>

    <span class="s0">def </span><span class="s1">test_convert_nested(self):</span>
        <span class="s1">data = [</span><span class="s3">&quot;2012-1-1&quot;</span><span class="s0">, </span><span class="s3">&quot;2012-1-2&quot;</span><span class="s1">]</span>
        <span class="s1">r1 = self.pc.convert([data</span><span class="s0">, </span><span class="s1">data]</span><span class="s0">, None, </span><span class="s1">self.axis)</span>
        <span class="s1">r2 = [self.pc.convert(data</span><span class="s0">, None, </span><span class="s1">self.axis) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">2</span><span class="s1">)]</span>
        <span class="s0">assert </span><span class="s1">r1 == r2</span>


<span class="s0">class </span><span class="s1">TestTimeDeltaConverter:</span>
    <span class="s5">&quot;&quot;&quot;Test timedelta converter&quot;&quot;&quot;</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s3">&quot;x, decimal, format_expected&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s3">&quot;00:00:00&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s4">3972320000000</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s3">&quot;01:06:12.3&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s4">713233432000000</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s3">&quot;8 days 06:07:13.43&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s4">32423432000000</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s3">&quot;09:00:23.4320&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_format_timedelta_ticks(self</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">decimal</span><span class="s0">, </span><span class="s1">format_expected):</span>
        <span class="s1">tdc = converter.TimeSeries_TimedeltaFormatter</span>
        <span class="s1">result = tdc.format_timedelta_ticks(x</span><span class="s0">, </span><span class="s1">pos=</span><span class="s0">None, </span><span class="s1">n_decimals=decimal)</span>
        <span class="s0">assert </span><span class="s1">result == format_expected</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;view_interval&quot;</span><span class="s0">, </span><span class="s1">[(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)])</span>
    <span class="s0">def </span><span class="s1">test_call_w_different_view_intervals(self</span><span class="s0">, </span><span class="s1">view_interval</span><span class="s0">, </span><span class="s1">monkeypatch):</span>
        <span class="s2"># previously broke on reversed xlmits; see GH37454</span>
        <span class="s0">class </span><span class="s1">mock_axis:</span>
            <span class="s0">def </span><span class="s1">get_view_interval(self):</span>
                <span class="s0">return </span><span class="s1">view_interval</span>

        <span class="s1">tdc = converter.TimeSeries_TimedeltaFormatter()</span>
        <span class="s1">monkeypatch.setattr(tdc</span><span class="s0">, </span><span class="s3">&quot;axis&quot;</span><span class="s0">, </span><span class="s1">mock_axis())</span>
        <span class="s1">tdc(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span>
</pre>
</body>
</html>