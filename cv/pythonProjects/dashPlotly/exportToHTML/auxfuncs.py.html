<html>
<head>
<title>auxfuncs.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #629755; font-style: italic;}
.s3 { color: #cc7832;}
.s4 { color: #6a8759;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
auxfuncs.py</font>
</center></td></tr></table>
<pre><span class="s0">#!/usr/bin/env python3</span>
<span class="s2">&quot;&quot;&quot; 
 
Auxiliary functions for f2py2e. 
 
Copyright 1999,2000 Pearu Peterson all rights reserved, 
Pearu Peterson &lt;pearu@ioc.ee&gt; 
Permission to use, modify, and distribute this software is given under the 
terms of the NumPy (BSD style) LICENSE. 
 
 
NO WARRANTY IS EXPRESSED OR IMPLIED.  USE AT YOUR OWN RISK. 
$Date: 2005/07/24 19:01:55 $ 
Pearu Peterson 
 
&quot;&quot;&quot;</span>
<span class="s3">import </span><span class="s1">pprint</span>
<span class="s3">import </span><span class="s1">sys</span>
<span class="s3">import </span><span class="s1">types</span>
<span class="s3">from </span><span class="s1">functools </span><span class="s3">import </span><span class="s1">reduce</span>

<span class="s3">from </span><span class="s1">. </span><span class="s3">import </span><span class="s1">__version__</span>
<span class="s3">from </span><span class="s1">. </span><span class="s3">import </span><span class="s1">cfuncs</span>

<span class="s1">__all__ = [</span>
    <span class="s4">'applyrules'</span><span class="s3">, </span><span class="s4">'debugcapi'</span><span class="s3">, </span><span class="s4">'dictappend'</span><span class="s3">, </span><span class="s4">'errmess'</span><span class="s3">, </span><span class="s4">'gentitle'</span><span class="s3">,</span>
    <span class="s4">'getargs2'</span><span class="s3">, </span><span class="s4">'getcallprotoargument'</span><span class="s3">, </span><span class="s4">'getcallstatement'</span><span class="s3">,</span>
    <span class="s4">'getfortranname'</span><span class="s3">, </span><span class="s4">'getpymethoddef'</span><span class="s3">, </span><span class="s4">'getrestdoc'</span><span class="s3">, </span><span class="s4">'getusercode'</span><span class="s3">,</span>
    <span class="s4">'getusercode1'</span><span class="s3">, </span><span class="s4">'hasbody'</span><span class="s3">, </span><span class="s4">'hascallstatement'</span><span class="s3">, </span><span class="s4">'hascommon'</span><span class="s3">,</span>
    <span class="s4">'hasexternals'</span><span class="s3">, </span><span class="s4">'hasinitvalue'</span><span class="s3">, </span><span class="s4">'hasnote'</span><span class="s3">, </span><span class="s4">'hasresultnote'</span><span class="s3">,</span>
    <span class="s4">'isallocatable'</span><span class="s3">, </span><span class="s4">'isarray'</span><span class="s3">, </span><span class="s4">'isarrayofstrings'</span><span class="s3">, </span><span class="s4">'iscomplex'</span><span class="s3">,</span>
    <span class="s4">'iscomplexarray'</span><span class="s3">, </span><span class="s4">'iscomplexfunction'</span><span class="s3">, </span><span class="s4">'iscomplexfunction_warn'</span><span class="s3">,</span>
    <span class="s4">'isdouble'</span><span class="s3">, </span><span class="s4">'isdummyroutine'</span><span class="s3">, </span><span class="s4">'isexternal'</span><span class="s3">, </span><span class="s4">'isfunction'</span><span class="s3">,</span>
    <span class="s4">'isfunction_wrap'</span><span class="s3">, </span><span class="s4">'isint1array'</span><span class="s3">, </span><span class="s4">'isinteger'</span><span class="s3">, </span><span class="s4">'isintent_aux'</span><span class="s3">,</span>
    <span class="s4">'isintent_c'</span><span class="s3">, </span><span class="s4">'isintent_callback'</span><span class="s3">, </span><span class="s4">'isintent_copy'</span><span class="s3">, </span><span class="s4">'isintent_dict'</span><span class="s3">,</span>
    <span class="s4">'isintent_hide'</span><span class="s3">, </span><span class="s4">'isintent_in'</span><span class="s3">, </span><span class="s4">'isintent_inout'</span><span class="s3">, </span><span class="s4">'isintent_inplace'</span><span class="s3">,</span>
    <span class="s4">'isintent_nothide'</span><span class="s3">, </span><span class="s4">'isintent_out'</span><span class="s3">, </span><span class="s4">'isintent_overwrite'</span><span class="s3">, </span><span class="s4">'islogical'</span><span class="s3">,</span>
    <span class="s4">'islogicalfunction'</span><span class="s3">, </span><span class="s4">'islong_complex'</span><span class="s3">, </span><span class="s4">'islong_double'</span><span class="s3">,</span>
    <span class="s4">'islong_doublefunction'</span><span class="s3">, </span><span class="s4">'islong_long'</span><span class="s3">, </span><span class="s4">'islong_longfunction'</span><span class="s3">,</span>
    <span class="s4">'ismodule'</span><span class="s3">, </span><span class="s4">'ismoduleroutine'</span><span class="s3">, </span><span class="s4">'isoptional'</span><span class="s3">, </span><span class="s4">'isprivate'</span><span class="s3">, </span><span class="s4">'isrequired'</span><span class="s3">,</span>
    <span class="s4">'isroutine'</span><span class="s3">, </span><span class="s4">'isscalar'</span><span class="s3">, </span><span class="s4">'issigned_long_longarray'</span><span class="s3">, </span><span class="s4">'isstring'</span><span class="s3">,</span>
    <span class="s4">'isstringarray'</span><span class="s3">, </span><span class="s4">'isstringfunction'</span><span class="s3">, </span><span class="s4">'issubroutine'</span><span class="s3">,</span>
    <span class="s4">'issubroutine_wrap'</span><span class="s3">, </span><span class="s4">'isthreadsafe'</span><span class="s3">, </span><span class="s4">'isunsigned'</span><span class="s3">, </span><span class="s4">'isunsigned_char'</span><span class="s3">,</span>
    <span class="s4">'isunsigned_chararray'</span><span class="s3">, </span><span class="s4">'isunsigned_long_long'</span><span class="s3">,</span>
    <span class="s4">'isunsigned_long_longarray'</span><span class="s3">, </span><span class="s4">'isunsigned_short'</span><span class="s3">,</span>
    <span class="s4">'isunsigned_shortarray'</span><span class="s3">, </span><span class="s4">'l_and'</span><span class="s3">, </span><span class="s4">'l_not'</span><span class="s3">, </span><span class="s4">'l_or'</span><span class="s3">, </span><span class="s4">'outmess'</span><span class="s3">,</span>
    <span class="s4">'replace'</span><span class="s3">, </span><span class="s4">'show'</span><span class="s3">, </span><span class="s4">'stripcomma'</span><span class="s3">, </span><span class="s4">'throw_error'</span><span class="s3">,</span>
<span class="s1">]</span>


<span class="s1">f2py_version = __version__.version</span>


<span class="s1">errmess = sys.stderr.write</span>
<span class="s1">show = pprint.pprint</span>

<span class="s1">options = {}</span>
<span class="s1">debugoptions = []</span>
<span class="s1">wrapfuncs = </span><span class="s5">1</span>


<span class="s3">def </span><span class="s1">outmess(t):</span>
    <span class="s3">if </span><span class="s1">options.get(</span><span class="s4">'verbose'</span><span class="s3">, </span><span class="s5">1</span><span class="s1">):</span>
        <span class="s1">sys.stdout.write(t)</span>


<span class="s3">def </span><span class="s1">debugcapi(var):</span>
    <span class="s3">return </span><span class="s4">'capi' </span><span class="s3">in </span><span class="s1">debugoptions</span>


<span class="s3">def </span><span class="s1">_isstring(var):</span>
    <span class="s3">return </span><span class="s4">'typespec' </span><span class="s3">in </span><span class="s1">var </span><span class="s3">and </span><span class="s1">var[</span><span class="s4">'typespec'</span><span class="s1">] == </span><span class="s4">'character' </span><span class="s3">and </span><span class="s1">\</span>
           <span class="s3">not </span><span class="s1">isexternal(var)</span>


<span class="s3">def </span><span class="s1">isstring(var):</span>
    <span class="s3">return </span><span class="s1">_isstring(var) </span><span class="s3">and not </span><span class="s1">isarray(var)</span>


<span class="s3">def </span><span class="s1">ischaracter(var):</span>
    <span class="s3">return </span><span class="s1">isstring(var) </span><span class="s3">and </span><span class="s4">'charselector' </span><span class="s3">not in </span><span class="s1">var</span>


<span class="s3">def </span><span class="s1">isstringarray(var):</span>
    <span class="s3">return </span><span class="s1">isarray(var) </span><span class="s3">and </span><span class="s1">_isstring(var)</span>


<span class="s3">def </span><span class="s1">isarrayofstrings(var):</span>
    <span class="s0"># leaving out '*' for now so that `character*(*) a(m)` and `character</span>
    <span class="s0"># a(m,*)` are treated differently. Luckily `character**` is illegal.</span>
    <span class="s3">return </span><span class="s1">isstringarray(var) </span><span class="s3">and </span><span class="s1">var[</span><span class="s4">'dimension'</span><span class="s1">][-</span><span class="s5">1</span><span class="s1">] == </span><span class="s4">'(*)'</span>


<span class="s3">def </span><span class="s1">isarray(var):</span>
    <span class="s3">return </span><span class="s4">'dimension' </span><span class="s3">in </span><span class="s1">var </span><span class="s3">and not </span><span class="s1">isexternal(var)</span>


<span class="s3">def </span><span class="s1">isscalar(var):</span>
    <span class="s3">return not </span><span class="s1">(isarray(var) </span><span class="s3">or </span><span class="s1">isstring(var) </span><span class="s3">or </span><span class="s1">isexternal(var))</span>


<span class="s3">def </span><span class="s1">iscomplex(var):</span>
    <span class="s3">return </span><span class="s1">isscalar(var) </span><span class="s3">and </span><span class="s1">\</span>
           <span class="s1">var.get(</span><span class="s4">'typespec'</span><span class="s1">) </span><span class="s3">in </span><span class="s1">[</span><span class="s4">'complex'</span><span class="s3">, </span><span class="s4">'double complex'</span><span class="s1">]</span>


<span class="s3">def </span><span class="s1">islogical(var):</span>
    <span class="s3">return </span><span class="s1">isscalar(var) </span><span class="s3">and </span><span class="s1">var.get(</span><span class="s4">'typespec'</span><span class="s1">) == </span><span class="s4">'logical'</span>


<span class="s3">def </span><span class="s1">isinteger(var):</span>
    <span class="s3">return </span><span class="s1">isscalar(var) </span><span class="s3">and </span><span class="s1">var.get(</span><span class="s4">'typespec'</span><span class="s1">) == </span><span class="s4">'integer'</span>


<span class="s3">def </span><span class="s1">isreal(var):</span>
    <span class="s3">return </span><span class="s1">isscalar(var) </span><span class="s3">and </span><span class="s1">var.get(</span><span class="s4">'typespec'</span><span class="s1">) == </span><span class="s4">'real'</span>


<span class="s3">def </span><span class="s1">get_kind(var):</span>
    <span class="s3">try</span><span class="s1">:</span>
        <span class="s3">return </span><span class="s1">var[</span><span class="s4">'kindselector'</span><span class="s1">][</span><span class="s4">'*'</span><span class="s1">]</span>
    <span class="s3">except </span><span class="s1">KeyError:</span>
        <span class="s3">try</span><span class="s1">:</span>
            <span class="s3">return </span><span class="s1">var[</span><span class="s4">'kindselector'</span><span class="s1">][</span><span class="s4">'kind'</span><span class="s1">]</span>
        <span class="s3">except </span><span class="s1">KeyError:</span>
            <span class="s3">pass</span>


<span class="s3">def </span><span class="s1">islong_long(var):</span>
    <span class="s3">if not </span><span class="s1">isscalar(var):</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">if </span><span class="s1">var.get(</span><span class="s4">'typespec'</span><span class="s1">) </span><span class="s3">not in </span><span class="s1">[</span><span class="s4">'integer'</span><span class="s3">, </span><span class="s4">'logical'</span><span class="s1">]:</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">return </span><span class="s1">get_kind(var) == </span><span class="s4">'8'</span>


<span class="s3">def </span><span class="s1">isunsigned_char(var):</span>
    <span class="s3">if not </span><span class="s1">isscalar(var):</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">if </span><span class="s1">var.get(</span><span class="s4">'typespec'</span><span class="s1">) != </span><span class="s4">'integer'</span><span class="s1">:</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">return </span><span class="s1">get_kind(var) == </span><span class="s4">'-1'</span>


<span class="s3">def </span><span class="s1">isunsigned_short(var):</span>
    <span class="s3">if not </span><span class="s1">isscalar(var):</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">if </span><span class="s1">var.get(</span><span class="s4">'typespec'</span><span class="s1">) != </span><span class="s4">'integer'</span><span class="s1">:</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">return </span><span class="s1">get_kind(var) == </span><span class="s4">'-2'</span>


<span class="s3">def </span><span class="s1">isunsigned(var):</span>
    <span class="s3">if not </span><span class="s1">isscalar(var):</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">if </span><span class="s1">var.get(</span><span class="s4">'typespec'</span><span class="s1">) != </span><span class="s4">'integer'</span><span class="s1">:</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">return </span><span class="s1">get_kind(var) == </span><span class="s4">'-4'</span>


<span class="s3">def </span><span class="s1">isunsigned_long_long(var):</span>
    <span class="s3">if not </span><span class="s1">isscalar(var):</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">if </span><span class="s1">var.get(</span><span class="s4">'typespec'</span><span class="s1">) != </span><span class="s4">'integer'</span><span class="s1">:</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">return </span><span class="s1">get_kind(var) == </span><span class="s4">'-8'</span>


<span class="s3">def </span><span class="s1">isdouble(var):</span>
    <span class="s3">if not </span><span class="s1">isscalar(var):</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">if not </span><span class="s1">var.get(</span><span class="s4">'typespec'</span><span class="s1">) == </span><span class="s4">'real'</span><span class="s1">:</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">return </span><span class="s1">get_kind(var) == </span><span class="s4">'8'</span>


<span class="s3">def </span><span class="s1">islong_double(var):</span>
    <span class="s3">if not </span><span class="s1">isscalar(var):</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">if not </span><span class="s1">var.get(</span><span class="s4">'typespec'</span><span class="s1">) == </span><span class="s4">'real'</span><span class="s1">:</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">return </span><span class="s1">get_kind(var) == </span><span class="s4">'16'</span>


<span class="s3">def </span><span class="s1">islong_complex(var):</span>
    <span class="s3">if not </span><span class="s1">iscomplex(var):</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">return </span><span class="s1">get_kind(var) == </span><span class="s4">'32'</span>


<span class="s3">def </span><span class="s1">iscomplexarray(var):</span>
    <span class="s3">return </span><span class="s1">isarray(var) </span><span class="s3">and </span><span class="s1">\</span>
           <span class="s1">var.get(</span><span class="s4">'typespec'</span><span class="s1">) </span><span class="s3">in </span><span class="s1">[</span><span class="s4">'complex'</span><span class="s3">, </span><span class="s4">'double complex'</span><span class="s1">]</span>


<span class="s3">def </span><span class="s1">isint1array(var):</span>
    <span class="s3">return </span><span class="s1">isarray(var) </span><span class="s3">and </span><span class="s1">var.get(</span><span class="s4">'typespec'</span><span class="s1">) == </span><span class="s4">'integer' </span><span class="s1">\</span>
        <span class="s3">and </span><span class="s1">get_kind(var) == </span><span class="s4">'1'</span>


<span class="s3">def </span><span class="s1">isunsigned_chararray(var):</span>
    <span class="s3">return </span><span class="s1">isarray(var) </span><span class="s3">and </span><span class="s1">var.get(</span><span class="s4">'typespec'</span><span class="s1">) </span><span class="s3">in </span><span class="s1">[</span><span class="s4">'integer'</span><span class="s3">, </span><span class="s4">'logical'</span><span class="s1">]\</span>
        <span class="s3">and </span><span class="s1">get_kind(var) == </span><span class="s4">'-1'</span>


<span class="s3">def </span><span class="s1">isunsigned_shortarray(var):</span>
    <span class="s3">return </span><span class="s1">isarray(var) </span><span class="s3">and </span><span class="s1">var.get(</span><span class="s4">'typespec'</span><span class="s1">) </span><span class="s3">in </span><span class="s1">[</span><span class="s4">'integer'</span><span class="s3">, </span><span class="s4">'logical'</span><span class="s1">]\</span>
        <span class="s3">and </span><span class="s1">get_kind(var) == </span><span class="s4">'-2'</span>


<span class="s3">def </span><span class="s1">isunsignedarray(var):</span>
    <span class="s3">return </span><span class="s1">isarray(var) </span><span class="s3">and </span><span class="s1">var.get(</span><span class="s4">'typespec'</span><span class="s1">) </span><span class="s3">in </span><span class="s1">[</span><span class="s4">'integer'</span><span class="s3">, </span><span class="s4">'logical'</span><span class="s1">]\</span>
        <span class="s3">and </span><span class="s1">get_kind(var) == </span><span class="s4">'-4'</span>


<span class="s3">def </span><span class="s1">isunsigned_long_longarray(var):</span>
    <span class="s3">return </span><span class="s1">isarray(var) </span><span class="s3">and </span><span class="s1">var.get(</span><span class="s4">'typespec'</span><span class="s1">) </span><span class="s3">in </span><span class="s1">[</span><span class="s4">'integer'</span><span class="s3">, </span><span class="s4">'logical'</span><span class="s1">]\</span>
        <span class="s3">and </span><span class="s1">get_kind(var) == </span><span class="s4">'-8'</span>


<span class="s3">def </span><span class="s1">issigned_chararray(var):</span>
    <span class="s3">return </span><span class="s1">isarray(var) </span><span class="s3">and </span><span class="s1">var.get(</span><span class="s4">'typespec'</span><span class="s1">) </span><span class="s3">in </span><span class="s1">[</span><span class="s4">'integer'</span><span class="s3">, </span><span class="s4">'logical'</span><span class="s1">]\</span>
        <span class="s3">and </span><span class="s1">get_kind(var) == </span><span class="s4">'1'</span>


<span class="s3">def </span><span class="s1">issigned_shortarray(var):</span>
    <span class="s3">return </span><span class="s1">isarray(var) </span><span class="s3">and </span><span class="s1">var.get(</span><span class="s4">'typespec'</span><span class="s1">) </span><span class="s3">in </span><span class="s1">[</span><span class="s4">'integer'</span><span class="s3">, </span><span class="s4">'logical'</span><span class="s1">]\</span>
        <span class="s3">and </span><span class="s1">get_kind(var) == </span><span class="s4">'2'</span>


<span class="s3">def </span><span class="s1">issigned_array(var):</span>
    <span class="s3">return </span><span class="s1">isarray(var) </span><span class="s3">and </span><span class="s1">var.get(</span><span class="s4">'typespec'</span><span class="s1">) </span><span class="s3">in </span><span class="s1">[</span><span class="s4">'integer'</span><span class="s3">, </span><span class="s4">'logical'</span><span class="s1">]\</span>
        <span class="s3">and </span><span class="s1">get_kind(var) == </span><span class="s4">'4'</span>


<span class="s3">def </span><span class="s1">issigned_long_longarray(var):</span>
    <span class="s3">return </span><span class="s1">isarray(var) </span><span class="s3">and </span><span class="s1">var.get(</span><span class="s4">'typespec'</span><span class="s1">) </span><span class="s3">in </span><span class="s1">[</span><span class="s4">'integer'</span><span class="s3">, </span><span class="s4">'logical'</span><span class="s1">]\</span>
        <span class="s3">and </span><span class="s1">get_kind(var) == </span><span class="s4">'8'</span>


<span class="s3">def </span><span class="s1">isallocatable(var):</span>
    <span class="s3">return </span><span class="s4">'attrspec' </span><span class="s3">in </span><span class="s1">var </span><span class="s3">and </span><span class="s4">'allocatable' </span><span class="s3">in </span><span class="s1">var[</span><span class="s4">'attrspec'</span><span class="s1">]</span>


<span class="s3">def </span><span class="s1">ismutable(var):</span>
    <span class="s3">return not </span><span class="s1">(</span><span class="s4">'dimension' </span><span class="s3">not in </span><span class="s1">var </span><span class="s3">or </span><span class="s1">isstring(var))</span>


<span class="s3">def </span><span class="s1">ismoduleroutine(rout):</span>
    <span class="s3">return </span><span class="s4">'modulename' </span><span class="s3">in </span><span class="s1">rout</span>


<span class="s3">def </span><span class="s1">ismodule(rout):</span>
    <span class="s3">return </span><span class="s4">'block' </span><span class="s3">in </span><span class="s1">rout </span><span class="s3">and </span><span class="s4">'module' </span><span class="s1">== rout[</span><span class="s4">'block'</span><span class="s1">]</span>


<span class="s3">def </span><span class="s1">isfunction(rout):</span>
    <span class="s3">return </span><span class="s4">'block' </span><span class="s3">in </span><span class="s1">rout </span><span class="s3">and </span><span class="s4">'function' </span><span class="s1">== rout[</span><span class="s4">'block'</span><span class="s1">]</span>


<span class="s3">def </span><span class="s1">isfunction_wrap(rout):</span>
    <span class="s3">if </span><span class="s1">isintent_c(rout):</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">return </span><span class="s1">wrapfuncs </span><span class="s3">and </span><span class="s1">isfunction(rout) </span><span class="s3">and </span><span class="s1">(</span><span class="s3">not </span><span class="s1">isexternal(rout))</span>


<span class="s3">def </span><span class="s1">issubroutine(rout):</span>
    <span class="s3">return </span><span class="s4">'block' </span><span class="s3">in </span><span class="s1">rout </span><span class="s3">and </span><span class="s4">'subroutine' </span><span class="s1">== rout[</span><span class="s4">'block'</span><span class="s1">]</span>


<span class="s3">def </span><span class="s1">issubroutine_wrap(rout):</span>
    <span class="s3">if </span><span class="s1">isintent_c(rout):</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">return </span><span class="s1">issubroutine(rout) </span><span class="s3">and </span><span class="s1">hasassumedshape(rout)</span>


<span class="s3">def </span><span class="s1">hasassumedshape(rout):</span>
    <span class="s3">if </span><span class="s1">rout.get(</span><span class="s4">'hasassumedshape'</span><span class="s1">):</span>
        <span class="s3">return True</span>
    <span class="s3">for </span><span class="s1">a </span><span class="s3">in </span><span class="s1">rout[</span><span class="s4">'args'</span><span class="s1">]:</span>
        <span class="s3">for </span><span class="s1">d </span><span class="s3">in </span><span class="s1">rout[</span><span class="s4">'vars'</span><span class="s1">].get(a</span><span class="s3">, </span><span class="s1">{}).get(</span><span class="s4">'dimension'</span><span class="s3">, </span><span class="s1">[]):</span>
            <span class="s3">if </span><span class="s1">d == </span><span class="s4">':'</span><span class="s1">:</span>
                <span class="s1">rout[</span><span class="s4">'hasassumedshape'</span><span class="s1">] = </span><span class="s3">True</span>
                <span class="s3">return True</span>
    <span class="s3">return False</span>


<span class="s3">def </span><span class="s1">requiresf90wrapper(rout):</span>
    <span class="s3">return </span><span class="s1">ismoduleroutine(rout) </span><span class="s3">or </span><span class="s1">hasassumedshape(rout)</span>


<span class="s3">def </span><span class="s1">isroutine(rout):</span>
    <span class="s3">return </span><span class="s1">isfunction(rout) </span><span class="s3">or </span><span class="s1">issubroutine(rout)</span>


<span class="s3">def </span><span class="s1">islogicalfunction(rout):</span>
    <span class="s3">if not </span><span class="s1">isfunction(rout):</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">if </span><span class="s4">'result' </span><span class="s3">in </span><span class="s1">rout:</span>
        <span class="s1">a = rout[</span><span class="s4">'result'</span><span class="s1">]</span>
    <span class="s3">else</span><span class="s1">:</span>
        <span class="s1">a = rout[</span><span class="s4">'name'</span><span class="s1">]</span>
    <span class="s3">if </span><span class="s1">a </span><span class="s3">in </span><span class="s1">rout[</span><span class="s4">'vars'</span><span class="s1">]:</span>
        <span class="s3">return </span><span class="s1">islogical(rout[</span><span class="s4">'vars'</span><span class="s1">][a])</span>
    <span class="s3">return </span><span class="s5">0</span>


<span class="s3">def </span><span class="s1">islong_longfunction(rout):</span>
    <span class="s3">if not </span><span class="s1">isfunction(rout):</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">if </span><span class="s4">'result' </span><span class="s3">in </span><span class="s1">rout:</span>
        <span class="s1">a = rout[</span><span class="s4">'result'</span><span class="s1">]</span>
    <span class="s3">else</span><span class="s1">:</span>
        <span class="s1">a = rout[</span><span class="s4">'name'</span><span class="s1">]</span>
    <span class="s3">if </span><span class="s1">a </span><span class="s3">in </span><span class="s1">rout[</span><span class="s4">'vars'</span><span class="s1">]:</span>
        <span class="s3">return </span><span class="s1">islong_long(rout[</span><span class="s4">'vars'</span><span class="s1">][a])</span>
    <span class="s3">return </span><span class="s5">0</span>


<span class="s3">def </span><span class="s1">islong_doublefunction(rout):</span>
    <span class="s3">if not </span><span class="s1">isfunction(rout):</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">if </span><span class="s4">'result' </span><span class="s3">in </span><span class="s1">rout:</span>
        <span class="s1">a = rout[</span><span class="s4">'result'</span><span class="s1">]</span>
    <span class="s3">else</span><span class="s1">:</span>
        <span class="s1">a = rout[</span><span class="s4">'name'</span><span class="s1">]</span>
    <span class="s3">if </span><span class="s1">a </span><span class="s3">in </span><span class="s1">rout[</span><span class="s4">'vars'</span><span class="s1">]:</span>
        <span class="s3">return </span><span class="s1">islong_double(rout[</span><span class="s4">'vars'</span><span class="s1">][a])</span>
    <span class="s3">return </span><span class="s5">0</span>


<span class="s3">def </span><span class="s1">iscomplexfunction(rout):</span>
    <span class="s3">if not </span><span class="s1">isfunction(rout):</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">if </span><span class="s4">'result' </span><span class="s3">in </span><span class="s1">rout:</span>
        <span class="s1">a = rout[</span><span class="s4">'result'</span><span class="s1">]</span>
    <span class="s3">else</span><span class="s1">:</span>
        <span class="s1">a = rout[</span><span class="s4">'name'</span><span class="s1">]</span>
    <span class="s3">if </span><span class="s1">a </span><span class="s3">in </span><span class="s1">rout[</span><span class="s4">'vars'</span><span class="s1">]:</span>
        <span class="s3">return </span><span class="s1">iscomplex(rout[</span><span class="s4">'vars'</span><span class="s1">][a])</span>
    <span class="s3">return </span><span class="s5">0</span>


<span class="s3">def </span><span class="s1">iscomplexfunction_warn(rout):</span>
    <span class="s3">if </span><span class="s1">iscomplexfunction(rout):</span>
        <span class="s1">outmess(</span><span class="s4">&quot;&quot;&quot;</span><span class="s3">\ 
    </span><span class="s4">************************************************************** 
        Warning: code with a function returning complex value 
        may not work correctly with your Fortran compiler. 
        When using GNU gcc/g77 compilers, codes should work 
        correctly for callbacks with: 
        f2py -c -DF2PY_CB_RETURNCOMPLEX 
    **************************************************************</span><span class="s3">\n</span><span class="s4">&quot;&quot;&quot;</span><span class="s1">)</span>
        <span class="s3">return </span><span class="s5">1</span>
    <span class="s3">return </span><span class="s5">0</span>


<span class="s3">def </span><span class="s1">isstringfunction(rout):</span>
    <span class="s3">if not </span><span class="s1">isfunction(rout):</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">if </span><span class="s4">'result' </span><span class="s3">in </span><span class="s1">rout:</span>
        <span class="s1">a = rout[</span><span class="s4">'result'</span><span class="s1">]</span>
    <span class="s3">else</span><span class="s1">:</span>
        <span class="s1">a = rout[</span><span class="s4">'name'</span><span class="s1">]</span>
    <span class="s3">if </span><span class="s1">a </span><span class="s3">in </span><span class="s1">rout[</span><span class="s4">'vars'</span><span class="s1">]:</span>
        <span class="s3">return </span><span class="s1">isstring(rout[</span><span class="s4">'vars'</span><span class="s1">][a])</span>
    <span class="s3">return </span><span class="s5">0</span>


<span class="s3">def </span><span class="s1">hasexternals(rout):</span>
    <span class="s3">return </span><span class="s4">'externals' </span><span class="s3">in </span><span class="s1">rout </span><span class="s3">and </span><span class="s1">rout[</span><span class="s4">'externals'</span><span class="s1">]</span>


<span class="s3">def </span><span class="s1">isthreadsafe(rout):</span>
    <span class="s3">return </span><span class="s4">'f2pyenhancements' </span><span class="s3">in </span><span class="s1">rout </span><span class="s3">and </span><span class="s1">\</span>
           <span class="s4">'threadsafe' </span><span class="s3">in </span><span class="s1">rout[</span><span class="s4">'f2pyenhancements'</span><span class="s1">]</span>


<span class="s3">def </span><span class="s1">hasvariables(rout):</span>
    <span class="s3">return </span><span class="s4">'vars' </span><span class="s3">in </span><span class="s1">rout </span><span class="s3">and </span><span class="s1">rout[</span><span class="s4">'vars'</span><span class="s1">]</span>


<span class="s3">def </span><span class="s1">isoptional(var):</span>
    <span class="s3">return </span><span class="s1">(</span><span class="s4">'attrspec' </span><span class="s3">in </span><span class="s1">var </span><span class="s3">and </span><span class="s4">'optional' </span><span class="s3">in </span><span class="s1">var[</span><span class="s4">'attrspec'</span><span class="s1">] </span><span class="s3">and</span>
            <span class="s4">'required' </span><span class="s3">not in </span><span class="s1">var[</span><span class="s4">'attrspec'</span><span class="s1">]) </span><span class="s3">and </span><span class="s1">isintent_nothide(var)</span>


<span class="s3">def </span><span class="s1">isexternal(var):</span>
    <span class="s3">return </span><span class="s4">'attrspec' </span><span class="s3">in </span><span class="s1">var </span><span class="s3">and </span><span class="s4">'external' </span><span class="s3">in </span><span class="s1">var[</span><span class="s4">'attrspec'</span><span class="s1">]</span>


<span class="s3">def </span><span class="s1">isrequired(var):</span>
    <span class="s3">return not </span><span class="s1">isoptional(var) </span><span class="s3">and </span><span class="s1">isintent_nothide(var)</span>


<span class="s3">def </span><span class="s1">isintent_in(var):</span>
    <span class="s3">if </span><span class="s4">'intent' </span><span class="s3">not in </span><span class="s1">var:</span>
        <span class="s3">return </span><span class="s5">1</span>
    <span class="s3">if </span><span class="s4">'hide' </span><span class="s3">in </span><span class="s1">var[</span><span class="s4">'intent'</span><span class="s1">]:</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">if </span><span class="s4">'inplace' </span><span class="s3">in </span><span class="s1">var[</span><span class="s4">'intent'</span><span class="s1">]:</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">if </span><span class="s4">'in' </span><span class="s3">in </span><span class="s1">var[</span><span class="s4">'intent'</span><span class="s1">]:</span>
        <span class="s3">return </span><span class="s5">1</span>
    <span class="s3">if </span><span class="s4">'out' </span><span class="s3">in </span><span class="s1">var[</span><span class="s4">'intent'</span><span class="s1">]:</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">if </span><span class="s4">'inout' </span><span class="s3">in </span><span class="s1">var[</span><span class="s4">'intent'</span><span class="s1">]:</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">if </span><span class="s4">'outin' </span><span class="s3">in </span><span class="s1">var[</span><span class="s4">'intent'</span><span class="s1">]:</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">return </span><span class="s5">1</span>


<span class="s3">def </span><span class="s1">isintent_inout(var):</span>
    <span class="s3">return </span><span class="s1">(</span><span class="s4">'intent' </span><span class="s3">in </span><span class="s1">var </span><span class="s3">and </span><span class="s1">(</span><span class="s4">'inout' </span><span class="s3">in </span><span class="s1">var[</span><span class="s4">'intent'</span><span class="s1">] </span><span class="s3">or</span>
            <span class="s4">'outin' </span><span class="s3">in </span><span class="s1">var[</span><span class="s4">'intent'</span><span class="s1">]) </span><span class="s3">and </span><span class="s4">'in' </span><span class="s3">not in </span><span class="s1">var[</span><span class="s4">'intent'</span><span class="s1">] </span><span class="s3">and</span>
            <span class="s4">'hide' </span><span class="s3">not in </span><span class="s1">var[</span><span class="s4">'intent'</span><span class="s1">] </span><span class="s3">and </span><span class="s4">'inplace' </span><span class="s3">not in </span><span class="s1">var[</span><span class="s4">'intent'</span><span class="s1">])</span>


<span class="s3">def </span><span class="s1">isintent_out(var):</span>
    <span class="s3">return </span><span class="s4">'out' </span><span class="s3">in </span><span class="s1">var.get(</span><span class="s4">'intent'</span><span class="s3">, </span><span class="s1">[])</span>


<span class="s3">def </span><span class="s1">isintent_hide(var):</span>
    <span class="s3">return </span><span class="s1">(</span><span class="s4">'intent' </span><span class="s3">in </span><span class="s1">var </span><span class="s3">and </span><span class="s1">(</span><span class="s4">'hide' </span><span class="s3">in </span><span class="s1">var[</span><span class="s4">'intent'</span><span class="s1">] </span><span class="s3">or</span>
            <span class="s1">(</span><span class="s4">'out' </span><span class="s3">in </span><span class="s1">var[</span><span class="s4">'intent'</span><span class="s1">] </span><span class="s3">and </span><span class="s4">'in' </span><span class="s3">not in </span><span class="s1">var[</span><span class="s4">'intent'</span><span class="s1">] </span><span class="s3">and</span>
                <span class="s1">(</span><span class="s3">not </span><span class="s1">l_or(isintent_inout</span><span class="s3">, </span><span class="s1">isintent_inplace)(var)))))</span>

<span class="s3">def </span><span class="s1">isintent_nothide(var):</span>
    <span class="s3">return not </span><span class="s1">isintent_hide(var)</span>


<span class="s3">def </span><span class="s1">isintent_c(var):</span>
    <span class="s3">return </span><span class="s4">'c' </span><span class="s3">in </span><span class="s1">var.get(</span><span class="s4">'intent'</span><span class="s3">, </span><span class="s1">[])</span>


<span class="s3">def </span><span class="s1">isintent_cache(var):</span>
    <span class="s3">return </span><span class="s4">'cache' </span><span class="s3">in </span><span class="s1">var.get(</span><span class="s4">'intent'</span><span class="s3">, </span><span class="s1">[])</span>


<span class="s3">def </span><span class="s1">isintent_copy(var):</span>
    <span class="s3">return </span><span class="s4">'copy' </span><span class="s3">in </span><span class="s1">var.get(</span><span class="s4">'intent'</span><span class="s3">, </span><span class="s1">[])</span>


<span class="s3">def </span><span class="s1">isintent_overwrite(var):</span>
    <span class="s3">return </span><span class="s4">'overwrite' </span><span class="s3">in </span><span class="s1">var.get(</span><span class="s4">'intent'</span><span class="s3">, </span><span class="s1">[])</span>


<span class="s3">def </span><span class="s1">isintent_callback(var):</span>
    <span class="s3">return </span><span class="s4">'callback' </span><span class="s3">in </span><span class="s1">var.get(</span><span class="s4">'intent'</span><span class="s3">, </span><span class="s1">[])</span>


<span class="s3">def </span><span class="s1">isintent_inplace(var):</span>
    <span class="s3">return </span><span class="s4">'inplace' </span><span class="s3">in </span><span class="s1">var.get(</span><span class="s4">'intent'</span><span class="s3">, </span><span class="s1">[])</span>


<span class="s3">def </span><span class="s1">isintent_aux(var):</span>
    <span class="s3">return </span><span class="s4">'aux' </span><span class="s3">in </span><span class="s1">var.get(</span><span class="s4">'intent'</span><span class="s3">, </span><span class="s1">[])</span>


<span class="s3">def </span><span class="s1">isintent_aligned4(var):</span>
    <span class="s3">return </span><span class="s4">'aligned4' </span><span class="s3">in </span><span class="s1">var.get(</span><span class="s4">'intent'</span><span class="s3">, </span><span class="s1">[])</span>


<span class="s3">def </span><span class="s1">isintent_aligned8(var):</span>
    <span class="s3">return </span><span class="s4">'aligned8' </span><span class="s3">in </span><span class="s1">var.get(</span><span class="s4">'intent'</span><span class="s3">, </span><span class="s1">[])</span>


<span class="s3">def </span><span class="s1">isintent_aligned16(var):</span>
    <span class="s3">return </span><span class="s4">'aligned16' </span><span class="s3">in </span><span class="s1">var.get(</span><span class="s4">'intent'</span><span class="s3">, </span><span class="s1">[])</span>

<span class="s1">isintent_dict = {isintent_in: </span><span class="s4">'INTENT_IN'</span><span class="s3">, </span><span class="s1">isintent_inout: </span><span class="s4">'INTENT_INOUT'</span><span class="s3">,</span>
                 <span class="s1">isintent_out: </span><span class="s4">'INTENT_OUT'</span><span class="s3">, </span><span class="s1">isintent_hide: </span><span class="s4">'INTENT_HIDE'</span><span class="s3">,</span>
                 <span class="s1">isintent_cache: </span><span class="s4">'INTENT_CACHE'</span><span class="s3">,</span>
                 <span class="s1">isintent_c: </span><span class="s4">'INTENT_C'</span><span class="s3">, </span><span class="s1">isoptional: </span><span class="s4">'OPTIONAL'</span><span class="s3">,</span>
                 <span class="s1">isintent_inplace: </span><span class="s4">'INTENT_INPLACE'</span><span class="s3">,</span>
                 <span class="s1">isintent_aligned4: </span><span class="s4">'INTENT_ALIGNED4'</span><span class="s3">,</span>
                 <span class="s1">isintent_aligned8: </span><span class="s4">'INTENT_ALIGNED8'</span><span class="s3">,</span>
                 <span class="s1">isintent_aligned16: </span><span class="s4">'INTENT_ALIGNED16'</span><span class="s3">,</span>
                 <span class="s1">}</span>


<span class="s3">def </span><span class="s1">isprivate(var):</span>
    <span class="s3">return </span><span class="s4">'attrspec' </span><span class="s3">in </span><span class="s1">var </span><span class="s3">and </span><span class="s4">'private' </span><span class="s3">in </span><span class="s1">var[</span><span class="s4">'attrspec'</span><span class="s1">]</span>


<span class="s3">def </span><span class="s1">hasinitvalue(var):</span>
    <span class="s3">return </span><span class="s4">'=' </span><span class="s3">in </span><span class="s1">var</span>


<span class="s3">def </span><span class="s1">hasinitvalueasstring(var):</span>
    <span class="s3">if not </span><span class="s1">hasinitvalue(var):</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">return </span><span class="s1">var[</span><span class="s4">'='</span><span class="s1">][</span><span class="s5">0</span><span class="s1">] </span><span class="s3">in </span><span class="s1">[</span><span class="s4">'&quot;'</span><span class="s3">, </span><span class="s4">&quot;'&quot;</span><span class="s1">]</span>


<span class="s3">def </span><span class="s1">hasnote(var):</span>
    <span class="s3">return </span><span class="s4">'note' </span><span class="s3">in </span><span class="s1">var</span>


<span class="s3">def </span><span class="s1">hasresultnote(rout):</span>
    <span class="s3">if not </span><span class="s1">isfunction(rout):</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">if </span><span class="s4">'result' </span><span class="s3">in </span><span class="s1">rout:</span>
        <span class="s1">a = rout[</span><span class="s4">'result'</span><span class="s1">]</span>
    <span class="s3">else</span><span class="s1">:</span>
        <span class="s1">a = rout[</span><span class="s4">'name'</span><span class="s1">]</span>
    <span class="s3">if </span><span class="s1">a </span><span class="s3">in </span><span class="s1">rout[</span><span class="s4">'vars'</span><span class="s1">]:</span>
        <span class="s3">return </span><span class="s1">hasnote(rout[</span><span class="s4">'vars'</span><span class="s1">][a])</span>
    <span class="s3">return </span><span class="s5">0</span>


<span class="s3">def </span><span class="s1">hascommon(rout):</span>
    <span class="s3">return </span><span class="s4">'common' </span><span class="s3">in </span><span class="s1">rout</span>


<span class="s3">def </span><span class="s1">containscommon(rout):</span>
    <span class="s3">if </span><span class="s1">hascommon(rout):</span>
        <span class="s3">return </span><span class="s5">1</span>
    <span class="s3">if </span><span class="s1">hasbody(rout):</span>
        <span class="s3">for </span><span class="s1">b </span><span class="s3">in </span><span class="s1">rout[</span><span class="s4">'body'</span><span class="s1">]:</span>
            <span class="s3">if </span><span class="s1">containscommon(b):</span>
                <span class="s3">return </span><span class="s5">1</span>
    <span class="s3">return </span><span class="s5">0</span>


<span class="s3">def </span><span class="s1">containsmodule(block):</span>
    <span class="s3">if </span><span class="s1">ismodule(block):</span>
        <span class="s3">return </span><span class="s5">1</span>
    <span class="s3">if not </span><span class="s1">hasbody(block):</span>
        <span class="s3">return </span><span class="s5">0</span>
    <span class="s3">for </span><span class="s1">b </span><span class="s3">in </span><span class="s1">block[</span><span class="s4">'body'</span><span class="s1">]:</span>
        <span class="s3">if </span><span class="s1">containsmodule(b):</span>
            <span class="s3">return </span><span class="s5">1</span>
    <span class="s3">return </span><span class="s5">0</span>


<span class="s3">def </span><span class="s1">hasbody(rout):</span>
    <span class="s3">return </span><span class="s4">'body' </span><span class="s3">in </span><span class="s1">rout</span>


<span class="s3">def </span><span class="s1">hascallstatement(rout):</span>
    <span class="s3">return </span><span class="s1">getcallstatement(rout) </span><span class="s3">is not None</span>


<span class="s3">def </span><span class="s1">istrue(var):</span>
    <span class="s3">return </span><span class="s5">1</span>


<span class="s3">def </span><span class="s1">isfalse(var):</span>
    <span class="s3">return </span><span class="s5">0</span>


<span class="s3">class </span><span class="s1">F2PYError(Exception):</span>
    <span class="s3">pass</span>


<span class="s3">class </span><span class="s1">throw_error:</span>

    <span class="s3">def </span><span class="s1">__init__(self</span><span class="s3">, </span><span class="s1">mess):</span>
        <span class="s1">self.mess = mess</span>

    <span class="s3">def </span><span class="s1">__call__(self</span><span class="s3">, </span><span class="s1">var):</span>
        <span class="s1">mess = </span><span class="s4">'</span><span class="s3">\n\n  </span><span class="s4">var = %s</span><span class="s3">\n  </span><span class="s4">Message: %s</span><span class="s3">\n</span><span class="s4">' </span><span class="s1">% (var</span><span class="s3">, </span><span class="s1">self.mess)</span>
        <span class="s3">raise </span><span class="s1">F2PYError(mess)</span>


<span class="s3">def </span><span class="s1">l_and(*f):</span>
    <span class="s1">l</span><span class="s3">, </span><span class="s1">l2 = </span><span class="s4">'lambda v'</span><span class="s3">, </span><span class="s1">[]</span>
    <span class="s3">for </span><span class="s1">i </span><span class="s3">in </span><span class="s1">range(len(f)):</span>
        <span class="s1">l = </span><span class="s4">'%s,f%d=f[%d]' </span><span class="s1">% (l</span><span class="s3">, </span><span class="s1">i</span><span class="s3">, </span><span class="s1">i)</span>
        <span class="s1">l2.append(</span><span class="s4">'f%d(v)' </span><span class="s1">% (i))</span>
    <span class="s3">return </span><span class="s1">eval(</span><span class="s4">'%s:%s' </span><span class="s1">% (l</span><span class="s3">, </span><span class="s4">' and '</span><span class="s1">.join(l2)))</span>


<span class="s3">def </span><span class="s1">l_or(*f):</span>
    <span class="s1">l</span><span class="s3">, </span><span class="s1">l2 = </span><span class="s4">'lambda v'</span><span class="s3">, </span><span class="s1">[]</span>
    <span class="s3">for </span><span class="s1">i </span><span class="s3">in </span><span class="s1">range(len(f)):</span>
        <span class="s1">l = </span><span class="s4">'%s,f%d=f[%d]' </span><span class="s1">% (l</span><span class="s3">, </span><span class="s1">i</span><span class="s3">, </span><span class="s1">i)</span>
        <span class="s1">l2.append(</span><span class="s4">'f%d(v)' </span><span class="s1">% (i))</span>
    <span class="s3">return </span><span class="s1">eval(</span><span class="s4">'%s:%s' </span><span class="s1">% (l</span><span class="s3">, </span><span class="s4">' or '</span><span class="s1">.join(l2)))</span>


<span class="s3">def </span><span class="s1">l_not(f):</span>
    <span class="s3">return </span><span class="s1">eval(</span><span class="s4">'lambda v,f=f:not f(v)'</span><span class="s1">)</span>


<span class="s3">def </span><span class="s1">isdummyroutine(rout):</span>
    <span class="s3">try</span><span class="s1">:</span>
        <span class="s3">return </span><span class="s1">rout[</span><span class="s4">'f2pyenhancements'</span><span class="s1">][</span><span class="s4">'fortranname'</span><span class="s1">] == </span><span class="s4">''</span>
    <span class="s3">except </span><span class="s1">KeyError:</span>
        <span class="s3">return </span><span class="s5">0</span>


<span class="s3">def </span><span class="s1">getfortranname(rout):</span>
    <span class="s3">try</span><span class="s1">:</span>
        <span class="s1">name = rout[</span><span class="s4">'f2pyenhancements'</span><span class="s1">][</span><span class="s4">'fortranname'</span><span class="s1">]</span>
        <span class="s3">if </span><span class="s1">name == </span><span class="s4">''</span><span class="s1">:</span>
            <span class="s3">raise </span><span class="s1">KeyError</span>
        <span class="s3">if not </span><span class="s1">name:</span>
            <span class="s1">errmess(</span><span class="s4">'Failed to use fortranname from %s</span><span class="s3">\n</span><span class="s4">' </span><span class="s1">%</span>
                    <span class="s1">(rout[</span><span class="s4">'f2pyenhancements'</span><span class="s1">]))</span>
            <span class="s3">raise </span><span class="s1">KeyError</span>
    <span class="s3">except </span><span class="s1">KeyError:</span>
        <span class="s1">name = rout[</span><span class="s4">'name'</span><span class="s1">]</span>
    <span class="s3">return </span><span class="s1">name</span>


<span class="s3">def </span><span class="s1">getmultilineblock(rout</span><span class="s3">, </span><span class="s1">blockname</span><span class="s3">, </span><span class="s1">comment=</span><span class="s5">1</span><span class="s3">, </span><span class="s1">counter=</span><span class="s5">0</span><span class="s1">):</span>
    <span class="s3">try</span><span class="s1">:</span>
        <span class="s1">r = rout[</span><span class="s4">'f2pyenhancements'</span><span class="s1">].get(blockname)</span>
    <span class="s3">except </span><span class="s1">KeyError:</span>
        <span class="s3">return</span>
    <span class="s3">if not </span><span class="s1">r:</span>
        <span class="s3">return</span>
    <span class="s3">if </span><span class="s1">counter &gt; </span><span class="s5">0 </span><span class="s3">and </span><span class="s1">isinstance(r</span><span class="s3">, </span><span class="s1">str):</span>
        <span class="s3">return</span>
    <span class="s3">if </span><span class="s1">isinstance(r</span><span class="s3">, </span><span class="s1">list):</span>
        <span class="s3">if </span><span class="s1">counter &gt;= len(r):</span>
            <span class="s3">return</span>
        <span class="s1">r = r[counter]</span>
    <span class="s3">if </span><span class="s1">r[:</span><span class="s5">3</span><span class="s1">] == </span><span class="s4">&quot;'''&quot;</span><span class="s1">:</span>
        <span class="s3">if </span><span class="s1">comment:</span>
            <span class="s1">r = </span><span class="s4">'</span><span class="s3">\t</span><span class="s4">/* start ' </span><span class="s1">+ blockname + \</span>
                <span class="s4">' multiline (' </span><span class="s1">+ repr(counter) + </span><span class="s4">') */</span><span class="s3">\n</span><span class="s4">' </span><span class="s1">+ r[</span><span class="s5">3</span><span class="s1">:]</span>
        <span class="s3">else</span><span class="s1">:</span>
            <span class="s1">r = r[</span><span class="s5">3</span><span class="s1">:]</span>
        <span class="s3">if </span><span class="s1">r[-</span><span class="s5">3</span><span class="s1">:] == </span><span class="s4">&quot;'''&quot;</span><span class="s1">:</span>
            <span class="s3">if </span><span class="s1">comment:</span>
                <span class="s1">r = r[:-</span><span class="s5">3</span><span class="s1">] + </span><span class="s4">'</span><span class="s3">\n\t</span><span class="s4">/* end multiline (' </span><span class="s1">+ repr(counter) + </span><span class="s4">')*/'</span>
            <span class="s3">else</span><span class="s1">:</span>
                <span class="s1">r = r[:-</span><span class="s5">3</span><span class="s1">]</span>
        <span class="s3">else</span><span class="s1">:</span>
            <span class="s1">errmess(</span><span class="s4">&quot;%s multiline block should end with `'''`: %s</span><span class="s3">\n</span><span class="s4">&quot;</span>
                    <span class="s1">% (blockname</span><span class="s3">, </span><span class="s1">repr(r)))</span>
    <span class="s3">return </span><span class="s1">r</span>


<span class="s3">def </span><span class="s1">getcallstatement(rout):</span>
    <span class="s3">return </span><span class="s1">getmultilineblock(rout</span><span class="s3">, </span><span class="s4">'callstatement'</span><span class="s1">)</span>


<span class="s3">def </span><span class="s1">getcallprotoargument(rout</span><span class="s3">, </span><span class="s1">cb_map={}):</span>
    <span class="s1">r = getmultilineblock(rout</span><span class="s3">, </span><span class="s4">'callprotoargument'</span><span class="s3">, </span><span class="s1">comment=</span><span class="s5">0</span><span class="s1">)</span>
    <span class="s3">if </span><span class="s1">r:</span>
        <span class="s3">return </span><span class="s1">r</span>
    <span class="s3">if </span><span class="s1">hascallstatement(rout):</span>
        <span class="s1">outmess(</span>
            <span class="s4">'warning: callstatement is defined without callprotoargument</span><span class="s3">\n</span><span class="s4">'</span><span class="s1">)</span>
        <span class="s3">return</span>
    <span class="s3">from </span><span class="s1">.capi_maps </span><span class="s3">import </span><span class="s1">getctype</span>
    <span class="s1">arg_types</span><span class="s3">, </span><span class="s1">arg_types2 = []</span><span class="s3">, </span><span class="s1">[]</span>
    <span class="s3">if </span><span class="s1">l_and(isstringfunction</span><span class="s3">, </span><span class="s1">l_not(isfunction_wrap))(rout):</span>
        <span class="s1">arg_types.extend([</span><span class="s4">'char*'</span><span class="s3">, </span><span class="s4">'size_t'</span><span class="s1">])</span>
    <span class="s3">for </span><span class="s1">n </span><span class="s3">in </span><span class="s1">rout[</span><span class="s4">'args'</span><span class="s1">]:</span>
        <span class="s1">var = rout[</span><span class="s4">'vars'</span><span class="s1">][n]</span>
        <span class="s3">if </span><span class="s1">isintent_callback(var):</span>
            <span class="s3">continue</span>
        <span class="s3">if </span><span class="s1">n </span><span class="s3">in </span><span class="s1">cb_map:</span>
            <span class="s1">ctype = cb_map[n] + </span><span class="s4">'_typedef'</span>
        <span class="s3">else</span><span class="s1">:</span>
            <span class="s1">ctype = getctype(var)</span>
            <span class="s3">if </span><span class="s1">l_and(isintent_c</span><span class="s3">, </span><span class="s1">l_or(isscalar</span><span class="s3">, </span><span class="s1">iscomplex))(var):</span>
                <span class="s3">pass</span>
            <span class="s3">elif </span><span class="s1">isstring(var):</span>
                <span class="s3">pass</span>
            <span class="s3">else</span><span class="s1">:</span>
                <span class="s1">ctype = ctype + </span><span class="s4">'*'</span>
            <span class="s3">if </span><span class="s1">isstring(var) </span><span class="s3">or </span><span class="s1">isarrayofstrings(var):</span>
                <span class="s1">arg_types2.append(</span><span class="s4">'size_t'</span><span class="s1">)</span>
        <span class="s1">arg_types.append(ctype)</span>

    <span class="s1">proto_args = </span><span class="s4">','</span><span class="s1">.join(arg_types + arg_types2)</span>
    <span class="s3">if not </span><span class="s1">proto_args:</span>
        <span class="s1">proto_args = </span><span class="s4">'void'</span>
    <span class="s3">return </span><span class="s1">proto_args</span>


<span class="s3">def </span><span class="s1">getusercode(rout):</span>
    <span class="s3">return </span><span class="s1">getmultilineblock(rout</span><span class="s3">, </span><span class="s4">'usercode'</span><span class="s1">)</span>


<span class="s3">def </span><span class="s1">getusercode1(rout):</span>
    <span class="s3">return </span><span class="s1">getmultilineblock(rout</span><span class="s3">, </span><span class="s4">'usercode'</span><span class="s3">, </span><span class="s1">counter=</span><span class="s5">1</span><span class="s1">)</span>


<span class="s3">def </span><span class="s1">getpymethoddef(rout):</span>
    <span class="s3">return </span><span class="s1">getmultilineblock(rout</span><span class="s3">, </span><span class="s4">'pymethoddef'</span><span class="s1">)</span>


<span class="s3">def </span><span class="s1">getargs(rout):</span>
    <span class="s1">sortargs</span><span class="s3">, </span><span class="s1">args = []</span><span class="s3">, </span><span class="s1">[]</span>
    <span class="s3">if </span><span class="s4">'args' </span><span class="s3">in </span><span class="s1">rout:</span>
        <span class="s1">args = rout[</span><span class="s4">'args'</span><span class="s1">]</span>
        <span class="s3">if </span><span class="s4">'sortvars' </span><span class="s3">in </span><span class="s1">rout:</span>
            <span class="s3">for </span><span class="s1">a </span><span class="s3">in </span><span class="s1">rout[</span><span class="s4">'sortvars'</span><span class="s1">]:</span>
                <span class="s3">if </span><span class="s1">a </span><span class="s3">in </span><span class="s1">args:</span>
                    <span class="s1">sortargs.append(a)</span>
            <span class="s3">for </span><span class="s1">a </span><span class="s3">in </span><span class="s1">args:</span>
                <span class="s3">if </span><span class="s1">a </span><span class="s3">not in </span><span class="s1">sortargs:</span>
                    <span class="s1">sortargs.append(a)</span>
        <span class="s3">else</span><span class="s1">:</span>
            <span class="s1">sortargs = rout[</span><span class="s4">'args'</span><span class="s1">]</span>
    <span class="s3">return </span><span class="s1">args</span><span class="s3">, </span><span class="s1">sortargs</span>


<span class="s3">def </span><span class="s1">getargs2(rout):</span>
    <span class="s1">sortargs</span><span class="s3">, </span><span class="s1">args = []</span><span class="s3">, </span><span class="s1">rout.get(</span><span class="s4">'args'</span><span class="s3">, </span><span class="s1">[])</span>
    <span class="s1">auxvars = [a </span><span class="s3">for </span><span class="s1">a </span><span class="s3">in </span><span class="s1">rout[</span><span class="s4">'vars'</span><span class="s1">].keys() </span><span class="s3">if </span><span class="s1">isintent_aux(rout[</span><span class="s4">'vars'</span><span class="s1">][a])</span>
               <span class="s3">and </span><span class="s1">a </span><span class="s3">not in </span><span class="s1">args]</span>
    <span class="s1">args = auxvars + args</span>
    <span class="s3">if </span><span class="s4">'sortvars' </span><span class="s3">in </span><span class="s1">rout:</span>
        <span class="s3">for </span><span class="s1">a </span><span class="s3">in </span><span class="s1">rout[</span><span class="s4">'sortvars'</span><span class="s1">]:</span>
            <span class="s3">if </span><span class="s1">a </span><span class="s3">in </span><span class="s1">args:</span>
                <span class="s1">sortargs.append(a)</span>
        <span class="s3">for </span><span class="s1">a </span><span class="s3">in </span><span class="s1">args:</span>
            <span class="s3">if </span><span class="s1">a </span><span class="s3">not in </span><span class="s1">sortargs:</span>
                <span class="s1">sortargs.append(a)</span>
    <span class="s3">else</span><span class="s1">:</span>
        <span class="s1">sortargs = auxvars + rout[</span><span class="s4">'args'</span><span class="s1">]</span>
    <span class="s3">return </span><span class="s1">args</span><span class="s3">, </span><span class="s1">sortargs</span>


<span class="s3">def </span><span class="s1">getrestdoc(rout):</span>
    <span class="s3">if </span><span class="s4">'f2pymultilines' </span><span class="s3">not in </span><span class="s1">rout:</span>
        <span class="s3">return None</span>
    <span class="s1">k = </span><span class="s3">None</span>
    <span class="s3">if </span><span class="s1">rout[</span><span class="s4">'block'</span><span class="s1">] == </span><span class="s4">'python module'</span><span class="s1">:</span>
        <span class="s1">k = rout[</span><span class="s4">'block'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">rout[</span><span class="s4">'name'</span><span class="s1">]</span>
    <span class="s3">return </span><span class="s1">rout[</span><span class="s4">'f2pymultilines'</span><span class="s1">].get(k</span><span class="s3">, None</span><span class="s1">)</span>


<span class="s3">def </span><span class="s1">gentitle(name):</span>
    <span class="s1">l = (</span><span class="s5">80 </span><span class="s1">- len(name) - </span><span class="s5">6</span><span class="s1">) // </span><span class="s5">2</span>
    <span class="s3">return </span><span class="s4">'/*%s %s %s*/' </span><span class="s1">% (l * </span><span class="s4">'*'</span><span class="s3">, </span><span class="s1">name</span><span class="s3">, </span><span class="s1">l * </span><span class="s4">'*'</span><span class="s1">)</span>


<span class="s3">def </span><span class="s1">flatlist(l):</span>
    <span class="s3">if </span><span class="s1">isinstance(l</span><span class="s3">, </span><span class="s1">list):</span>
        <span class="s3">return </span><span class="s1">reduce(</span><span class="s3">lambda </span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">f=flatlist: x + f(y)</span><span class="s3">, </span><span class="s1">l</span><span class="s3">, </span><span class="s1">[])</span>
    <span class="s3">return </span><span class="s1">[l]</span>


<span class="s3">def </span><span class="s1">stripcomma(s):</span>
    <span class="s3">if </span><span class="s1">s </span><span class="s3">and </span><span class="s1">s[-</span><span class="s5">1</span><span class="s1">] == </span><span class="s4">','</span><span class="s1">:</span>
        <span class="s3">return </span><span class="s1">s[:-</span><span class="s5">1</span><span class="s1">]</span>
    <span class="s3">return </span><span class="s1">s</span>


<span class="s3">def </span><span class="s1">replace(str</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s1">defaultsep=</span><span class="s4">''</span><span class="s1">):</span>
    <span class="s3">if </span><span class="s1">isinstance(d</span><span class="s3">, </span><span class="s1">list):</span>
        <span class="s3">return </span><span class="s1">[replace(str</span><span class="s3">, </span><span class="s1">_m</span><span class="s3">, </span><span class="s1">defaultsep) </span><span class="s3">for </span><span class="s1">_m </span><span class="s3">in </span><span class="s1">d]</span>
    <span class="s3">if </span><span class="s1">isinstance(str</span><span class="s3">, </span><span class="s1">list):</span>
        <span class="s3">return </span><span class="s1">[replace(_m</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s1">defaultsep) </span><span class="s3">for </span><span class="s1">_m </span><span class="s3">in </span><span class="s1">str]</span>
    <span class="s3">for </span><span class="s1">k </span><span class="s3">in </span><span class="s5">2 </span><span class="s1">* list(d.keys()):</span>
        <span class="s3">if </span><span class="s1">k == </span><span class="s4">'separatorsfor'</span><span class="s1">:</span>
            <span class="s3">continue</span>
        <span class="s3">if </span><span class="s4">'separatorsfor' </span><span class="s3">in </span><span class="s1">d </span><span class="s3">and </span><span class="s1">k </span><span class="s3">in </span><span class="s1">d[</span><span class="s4">'separatorsfor'</span><span class="s1">]:</span>
            <span class="s1">sep = d[</span><span class="s4">'separatorsfor'</span><span class="s1">][k]</span>
        <span class="s3">else</span><span class="s1">:</span>
            <span class="s1">sep = defaultsep</span>
        <span class="s3">if </span><span class="s1">isinstance(d[k]</span><span class="s3">, </span><span class="s1">list):</span>
            <span class="s1">str = str.replace(</span><span class="s4">'#%s#' </span><span class="s1">% (k)</span><span class="s3">, </span><span class="s1">sep.join(flatlist(d[k])))</span>
        <span class="s3">else</span><span class="s1">:</span>
            <span class="s1">str = str.replace(</span><span class="s4">'#%s#' </span><span class="s1">% (k)</span><span class="s3">, </span><span class="s1">d[k])</span>
    <span class="s3">return </span><span class="s1">str</span>


<span class="s3">def </span><span class="s1">dictappend(rd</span><span class="s3">, </span><span class="s1">ar):</span>
    <span class="s3">if </span><span class="s1">isinstance(ar</span><span class="s3">, </span><span class="s1">list):</span>
        <span class="s3">for </span><span class="s1">a </span><span class="s3">in </span><span class="s1">ar:</span>
            <span class="s1">rd = dictappend(rd</span><span class="s3">, </span><span class="s1">a)</span>
        <span class="s3">return </span><span class="s1">rd</span>
    <span class="s3">for </span><span class="s1">k </span><span class="s3">in </span><span class="s1">ar.keys():</span>
        <span class="s3">if </span><span class="s1">k[</span><span class="s5">0</span><span class="s1">] == </span><span class="s4">'_'</span><span class="s1">:</span>
            <span class="s3">continue</span>
        <span class="s3">if </span><span class="s1">k </span><span class="s3">in </span><span class="s1">rd:</span>
            <span class="s3">if </span><span class="s1">isinstance(rd[k]</span><span class="s3">, </span><span class="s1">str):</span>
                <span class="s1">rd[k] = [rd[k]]</span>
            <span class="s3">if </span><span class="s1">isinstance(rd[k]</span><span class="s3">, </span><span class="s1">list):</span>
                <span class="s3">if </span><span class="s1">isinstance(ar[k]</span><span class="s3">, </span><span class="s1">list):</span>
                    <span class="s1">rd[k] = rd[k] + ar[k]</span>
                <span class="s3">else</span><span class="s1">:</span>
                    <span class="s1">rd[k].append(ar[k])</span>
            <span class="s3">elif </span><span class="s1">isinstance(rd[k]</span><span class="s3">, </span><span class="s1">dict):</span>
                <span class="s3">if </span><span class="s1">isinstance(ar[k]</span><span class="s3">, </span><span class="s1">dict):</span>
                    <span class="s3">if </span><span class="s1">k == </span><span class="s4">'separatorsfor'</span><span class="s1">:</span>
                        <span class="s3">for </span><span class="s1">k1 </span><span class="s3">in </span><span class="s1">ar[k].keys():</span>
                            <span class="s3">if </span><span class="s1">k1 </span><span class="s3">not in </span><span class="s1">rd[k]:</span>
                                <span class="s1">rd[k][k1] = ar[k][k1]</span>
                    <span class="s3">else</span><span class="s1">:</span>
                        <span class="s1">rd[k] = dictappend(rd[k]</span><span class="s3">, </span><span class="s1">ar[k])</span>
        <span class="s3">else</span><span class="s1">:</span>
            <span class="s1">rd[k] = ar[k]</span>
    <span class="s3">return </span><span class="s1">rd</span>


<span class="s3">def </span><span class="s1">applyrules(rules</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s1">var={}):</span>
    <span class="s1">ret = {}</span>
    <span class="s3">if </span><span class="s1">isinstance(rules</span><span class="s3">, </span><span class="s1">list):</span>
        <span class="s3">for </span><span class="s1">r </span><span class="s3">in </span><span class="s1">rules:</span>
            <span class="s1">rr = applyrules(r</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s1">var)</span>
            <span class="s1">ret = dictappend(ret</span><span class="s3">, </span><span class="s1">rr)</span>
            <span class="s3">if </span><span class="s4">'_break' </span><span class="s3">in </span><span class="s1">rr:</span>
                <span class="s3">break</span>
        <span class="s3">return </span><span class="s1">ret</span>
    <span class="s3">if </span><span class="s4">'_check' </span><span class="s3">in </span><span class="s1">rules </span><span class="s3">and </span><span class="s1">(</span><span class="s3">not </span><span class="s1">rules[</span><span class="s4">'_check'</span><span class="s1">](var)):</span>
        <span class="s3">return </span><span class="s1">ret</span>
    <span class="s3">if </span><span class="s4">'need' </span><span class="s3">in </span><span class="s1">rules:</span>
        <span class="s1">res = applyrules({</span><span class="s4">'needs'</span><span class="s1">: rules[</span><span class="s4">'need'</span><span class="s1">]}</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s1">var)</span>
        <span class="s3">if </span><span class="s4">'needs' </span><span class="s3">in </span><span class="s1">res:</span>
            <span class="s1">cfuncs.append_needs(res[</span><span class="s4">'needs'</span><span class="s1">])</span>

    <span class="s3">for </span><span class="s1">k </span><span class="s3">in </span><span class="s1">rules.keys():</span>
        <span class="s3">if </span><span class="s1">k == </span><span class="s4">'separatorsfor'</span><span class="s1">:</span>
            <span class="s1">ret[k] = rules[k]</span>
            <span class="s3">continue</span>
        <span class="s3">if </span><span class="s1">isinstance(rules[k]</span><span class="s3">, </span><span class="s1">str):</span>
            <span class="s1">ret[k] = replace(rules[k]</span><span class="s3">, </span><span class="s1">d)</span>
        <span class="s3">elif </span><span class="s1">isinstance(rules[k]</span><span class="s3">, </span><span class="s1">list):</span>
            <span class="s1">ret[k] = []</span>
            <span class="s3">for </span><span class="s1">i </span><span class="s3">in </span><span class="s1">rules[k]:</span>
                <span class="s1">ar = applyrules({k: i}</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s1">var)</span>
                <span class="s3">if </span><span class="s1">k </span><span class="s3">in </span><span class="s1">ar:</span>
                    <span class="s1">ret[k].append(ar[k])</span>
        <span class="s3">elif </span><span class="s1">k[</span><span class="s5">0</span><span class="s1">] == </span><span class="s4">'_'</span><span class="s1">:</span>
            <span class="s3">continue</span>
        <span class="s3">elif </span><span class="s1">isinstance(rules[k]</span><span class="s3">, </span><span class="s1">dict):</span>
            <span class="s1">ret[k] = []</span>
            <span class="s3">for </span><span class="s1">k1 </span><span class="s3">in </span><span class="s1">rules[k].keys():</span>
                <span class="s3">if </span><span class="s1">isinstance(k1</span><span class="s3">, </span><span class="s1">types.FunctionType) </span><span class="s3">and </span><span class="s1">k1(var):</span>
                    <span class="s3">if </span><span class="s1">isinstance(rules[k][k1]</span><span class="s3">, </span><span class="s1">list):</span>
                        <span class="s3">for </span><span class="s1">i </span><span class="s3">in </span><span class="s1">rules[k][k1]:</span>
                            <span class="s3">if </span><span class="s1">isinstance(i</span><span class="s3">, </span><span class="s1">dict):</span>
                                <span class="s1">res = applyrules({</span><span class="s4">'supertext'</span><span class="s1">: i}</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s1">var)</span>
                                <span class="s3">if </span><span class="s4">'supertext' </span><span class="s3">in </span><span class="s1">res:</span>
                                    <span class="s1">i = res[</span><span class="s4">'supertext'</span><span class="s1">]</span>
                                <span class="s3">else</span><span class="s1">:</span>
                                    <span class="s1">i = </span><span class="s4">''</span>
                            <span class="s1">ret[k].append(replace(i</span><span class="s3">, </span><span class="s1">d))</span>
                    <span class="s3">else</span><span class="s1">:</span>
                        <span class="s1">i = rules[k][k1]</span>
                        <span class="s3">if </span><span class="s1">isinstance(i</span><span class="s3">, </span><span class="s1">dict):</span>
                            <span class="s1">res = applyrules({</span><span class="s4">'supertext'</span><span class="s1">: i}</span><span class="s3">, </span><span class="s1">d)</span>
                            <span class="s3">if </span><span class="s4">'supertext' </span><span class="s3">in </span><span class="s1">res:</span>
                                <span class="s1">i = res[</span><span class="s4">'supertext'</span><span class="s1">]</span>
                            <span class="s3">else</span><span class="s1">:</span>
                                <span class="s1">i = </span><span class="s4">''</span>
                        <span class="s1">ret[k].append(replace(i</span><span class="s3">, </span><span class="s1">d))</span>
        <span class="s3">else</span><span class="s1">:</span>
            <span class="s1">errmess(</span><span class="s4">'applyrules: ignoring rule %s.</span><span class="s3">\n</span><span class="s4">' </span><span class="s1">% repr(rules[k]))</span>
        <span class="s3">if </span><span class="s1">isinstance(ret[k]</span><span class="s3">, </span><span class="s1">list):</span>
            <span class="s3">if </span><span class="s1">len(ret[k]) == </span><span class="s5">1</span><span class="s1">:</span>
                <span class="s1">ret[k] = ret[k][</span><span class="s5">0</span><span class="s1">]</span>
            <span class="s3">if </span><span class="s1">ret[k] == []:</span>
                <span class="s3">del </span><span class="s1">ret[k]</span>
    <span class="s3">return </span><span class="s1">ret</span>
</pre>
</body>
</html>