<html>
<head>
<title>test_clipboard.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
.s4 { color: #629755; font-style: italic;}
.s5 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_clipboard.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">textwrap </span><span class="s0">import </span><span class="s1">dedent</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">DataFrame</span><span class="s0">,</span>
    <span class="s1">get_option</span><span class="s0">,</span>
    <span class="s1">read_clipboard</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">pandas._testing </span><span class="s0">as </span><span class="s1">tm</span>

<span class="s0">from </span><span class="s1">pandas.io.clipboard </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">clipboard_get</span><span class="s0">,</span>
    <span class="s1">clipboard_set</span><span class="s0">,</span>
<span class="s1">)</span>


<span class="s0">def </span><span class="s1">build_kwargs(sep</span><span class="s0">, </span><span class="s1">excel):</span>
    <span class="s1">kwargs = {}</span>
    <span class="s0">if </span><span class="s1">excel != </span><span class="s2">&quot;default&quot;</span><span class="s1">:</span>
        <span class="s1">kwargs[</span><span class="s2">&quot;excel&quot;</span><span class="s1">] = excel</span>
    <span class="s0">if </span><span class="s1">sep != </span><span class="s2">&quot;default&quot;</span><span class="s1">:</span>
        <span class="s1">kwargs[</span><span class="s2">&quot;sep&quot;</span><span class="s1">] = sep</span>
    <span class="s0">return </span><span class="s1">kwargs</span>


<span class="s1">@pytest.fixture(</span>
    <span class="s1">params=[</span>
        <span class="s2">&quot;delims&quot;</span><span class="s0">,</span>
        <span class="s2">&quot;utf8&quot;</span><span class="s0">,</span>
        <span class="s2">&quot;utf16&quot;</span><span class="s0">,</span>
        <span class="s2">&quot;string&quot;</span><span class="s0">,</span>
        <span class="s2">&quot;long&quot;</span><span class="s0">,</span>
        <span class="s2">&quot;nonascii&quot;</span><span class="s0">,</span>
        <span class="s2">&quot;colwidth&quot;</span><span class="s0">,</span>
        <span class="s2">&quot;mixed&quot;</span><span class="s0">,</span>
        <span class="s2">&quot;float&quot;</span><span class="s0">,</span>
        <span class="s2">&quot;int&quot;</span><span class="s0">,</span>
    <span class="s1">]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">df(request):</span>
    <span class="s1">data_type = request.param</span>

    <span class="s0">if </span><span class="s1">data_type == </span><span class="s2">&quot;delims&quot;</span><span class="s1">:</span>
        <span class="s0">return </span><span class="s1">DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s2">'&quot;a,</span><span class="s0">\t</span><span class="s2">&quot;b|c'</span><span class="s0">, </span><span class="s2">&quot;d</span><span class="s0">\t</span><span class="s2">ef´&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s2">&quot;hi'j&quot;</span><span class="s0">, </span><span class="s2">&quot;k''lm&quot;</span><span class="s1">]})</span>
    <span class="s0">elif </span><span class="s1">data_type == </span><span class="s2">&quot;utf8&quot;</span><span class="s1">:</span>
        <span class="s0">return </span><span class="s1">DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s2">&quot;µasd&quot;</span><span class="s0">, </span><span class="s2">&quot;Ωœ∑´&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s2">&quot;øπ∆˚¬&quot;</span><span class="s0">, </span><span class="s2">&quot;œ∑´®&quot;</span><span class="s1">]})</span>
    <span class="s0">elif </span><span class="s1">data_type == </span><span class="s2">&quot;utf16&quot;</span><span class="s1">:</span>
        <span class="s0">return </span><span class="s1">DataFrame(</span>
            <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s2">&quot;</span><span class="s0">\U0001f44d\U0001f44d</span><span class="s2">&quot;</span><span class="s0">, </span><span class="s2">&quot;</span><span class="s0">\U0001f44d\U0001f44d</span><span class="s2">&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s2">&quot;abc&quot;</span><span class="s0">, </span><span class="s2">&quot;def&quot;</span><span class="s1">]}</span>
        <span class="s1">)</span>
    <span class="s0">elif </span><span class="s1">data_type == </span><span class="s2">&quot;string&quot;</span><span class="s1">:</span>
        <span class="s0">return </span><span class="s1">tm.makeCustomDataframe(</span>
            <span class="s3">5</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s1">c_idx_type=</span><span class="s2">&quot;s&quot;</span><span class="s0">, </span><span class="s1">r_idx_type=</span><span class="s2">&quot;i&quot;</span><span class="s0">, </span><span class="s1">c_idx_names=[</span><span class="s0">None</span><span class="s1">]</span><span class="s0">, </span><span class="s1">r_idx_names=[</span><span class="s0">None</span><span class="s1">]</span>
        <span class="s1">)</span>
    <span class="s0">elif </span><span class="s1">data_type == </span><span class="s2">&quot;long&quot;</span><span class="s1">:</span>
        <span class="s1">max_rows = get_option(</span><span class="s2">&quot;display.max_rows&quot;</span><span class="s1">)</span>
        <span class="s0">return </span><span class="s1">tm.makeCustomDataframe(</span>
            <span class="s1">max_rows + </span><span class="s3">1</span><span class="s0">,</span>
            <span class="s3">3</span><span class="s0">,</span>
            <span class="s1">data_gen_f=</span><span class="s0">lambda </span><span class="s1">*args: np.random.randint(</span><span class="s3">2</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">c_idx_type=</span><span class="s2">&quot;s&quot;</span><span class="s0">,</span>
            <span class="s1">r_idx_type=</span><span class="s2">&quot;i&quot;</span><span class="s0">,</span>
            <span class="s1">c_idx_names=[</span><span class="s0">None</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">r_idx_names=[</span><span class="s0">None</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
    <span class="s0">elif </span><span class="s1">data_type == </span><span class="s2">&quot;nonascii&quot;</span><span class="s1">:</span>
        <span class="s0">return </span><span class="s1">DataFrame({</span><span class="s2">&quot;en&quot;</span><span class="s1">: </span><span class="s2">&quot;in English&quot;</span><span class="s1">.split()</span><span class="s0">, </span><span class="s2">&quot;es&quot;</span><span class="s1">: </span><span class="s2">&quot;en español&quot;</span><span class="s1">.split()})</span>
    <span class="s0">elif </span><span class="s1">data_type == </span><span class="s2">&quot;colwidth&quot;</span><span class="s1">:</span>
        <span class="s1">_cw = get_option(</span><span class="s2">&quot;display.max_colwidth&quot;</span><span class="s1">) + </span><span class="s3">1</span>
        <span class="s0">return </span><span class="s1">tm.makeCustomDataframe(</span>
            <span class="s3">5</span><span class="s0">,</span>
            <span class="s3">3</span><span class="s0">,</span>
            <span class="s1">data_gen_f=</span><span class="s0">lambda </span><span class="s1">*args: </span><span class="s2">&quot;x&quot; </span><span class="s1">* _cw</span><span class="s0">,</span>
            <span class="s1">c_idx_type=</span><span class="s2">&quot;s&quot;</span><span class="s0">,</span>
            <span class="s1">r_idx_type=</span><span class="s2">&quot;i&quot;</span><span class="s0">,</span>
            <span class="s1">c_idx_names=[</span><span class="s0">None</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">r_idx_names=[</span><span class="s0">None</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
    <span class="s0">elif </span><span class="s1">data_type == </span><span class="s2">&quot;mixed&quot;</span><span class="s1">:</span>
        <span class="s0">return </span><span class="s1">DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;a&quot;</span><span class="s1">: np.arange(</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">6.0</span><span class="s1">) + </span><span class="s3">0.01</span><span class="s0">,</span>
                <span class="s2">&quot;b&quot;</span><span class="s1">: np.arange(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">6</span><span class="s1">).astype(np.int64)</span><span class="s0">,</span>
                <span class="s2">&quot;c&quot;</span><span class="s1">: list(</span><span class="s2">&quot;abcde&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
    <span class="s0">elif </span><span class="s1">data_type == </span><span class="s2">&quot;float&quot;</span><span class="s1">:</span>
        <span class="s0">return </span><span class="s1">tm.makeCustomDataframe(</span>
            <span class="s3">5</span><span class="s0">,</span>
            <span class="s3">3</span><span class="s0">,</span>
            <span class="s1">data_gen_f=</span><span class="s0">lambda </span><span class="s1">r</span><span class="s0">, </span><span class="s1">c: float(r) + </span><span class="s3">0.01</span><span class="s0">,</span>
            <span class="s1">c_idx_type=</span><span class="s2">&quot;s&quot;</span><span class="s0">,</span>
            <span class="s1">r_idx_type=</span><span class="s2">&quot;i&quot;</span><span class="s0">,</span>
            <span class="s1">c_idx_names=[</span><span class="s0">None</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">r_idx_names=[</span><span class="s0">None</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
    <span class="s0">elif </span><span class="s1">data_type == </span><span class="s2">&quot;int&quot;</span><span class="s1">:</span>
        <span class="s0">return </span><span class="s1">tm.makeCustomDataframe(</span>
            <span class="s3">5</span><span class="s0">,</span>
            <span class="s3">3</span><span class="s0">,</span>
            <span class="s1">data_gen_f=</span><span class="s0">lambda </span><span class="s1">*args: np.random.randint(</span><span class="s3">2</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">c_idx_type=</span><span class="s2">&quot;s&quot;</span><span class="s0">,</span>
            <span class="s1">r_idx_type=</span><span class="s2">&quot;i&quot;</span><span class="s0">,</span>
            <span class="s1">c_idx_names=[</span><span class="s0">None</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">r_idx_names=[</span><span class="s0">None</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s0">raise </span><span class="s1">ValueError</span>


<span class="s1">@pytest.fixture</span>
<span class="s0">def </span><span class="s1">mock_clipboard(monkeypatch</span><span class="s0">, </span><span class="s1">request):</span>
    <span class="s4">&quot;&quot;&quot;Fixture mocking clipboard IO. 
 
    This mocks pandas.io.clipboard.clipboard_get and 
    pandas.io.clipboard.clipboard_set. 
 
    This uses a local dict for storing data. The dictionary 
    key used is the test ID, available with ``request.node.name``. 
 
    This returns the local dictionary, for direct manipulation by 
    tests. 
    &quot;&quot;&quot;</span>
    <span class="s5"># our local clipboard for tests</span>
    <span class="s1">_mock_data = {}</span>

    <span class="s0">def </span><span class="s1">_mock_set(data):</span>
        <span class="s1">_mock_data[request.node.name] = data</span>

    <span class="s0">def </span><span class="s1">_mock_get():</span>
        <span class="s0">return </span><span class="s1">_mock_data[request.node.name]</span>

    <span class="s1">monkeypatch.setattr(</span><span class="s2">&quot;pandas.io.clipboard.clipboard_set&quot;</span><span class="s0">, </span><span class="s1">_mock_set)</span>
    <span class="s1">monkeypatch.setattr(</span><span class="s2">&quot;pandas.io.clipboard.clipboard_get&quot;</span><span class="s0">, </span><span class="s1">_mock_get)</span>

    <span class="s0">yield </span><span class="s1">_mock_data</span>


<span class="s1">@pytest.mark.clipboard</span>
<span class="s0">def </span><span class="s1">test_mock_clipboard(mock_clipboard):</span>
    <span class="s0">import </span><span class="s1">pandas.io.clipboard</span>

    <span class="s1">pandas.io.clipboard.clipboard_set(</span><span class="s2">&quot;abc&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s2">&quot;abc&quot; </span><span class="s0">in </span><span class="s1">set(mock_clipboard.values())</span>
    <span class="s1">result = pandas.io.clipboard.clipboard_get()</span>
    <span class="s0">assert </span><span class="s1">result == </span><span class="s2">&quot;abc&quot;</span>


<span class="s1">@pytest.mark.single</span>
<span class="s1">@pytest.mark.clipboard</span>
<span class="s1">@pytest.mark.usefixtures(</span><span class="s2">&quot;mock_clipboard&quot;</span><span class="s1">)</span>
<span class="s0">class </span><span class="s1">TestClipboard:</span>
    <span class="s0">def </span><span class="s1">check_round_trip_frame(self</span><span class="s0">, </span><span class="s1">data</span><span class="s0">, </span><span class="s1">excel=</span><span class="s0">None, </span><span class="s1">sep=</span><span class="s0">None, </span><span class="s1">encoding=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">data.to_clipboard(excel=excel</span><span class="s0">, </span><span class="s1">sep=sep</span><span class="s0">, </span><span class="s1">encoding=encoding)</span>
        <span class="s1">result = read_clipboard(sep=sep </span><span class="s0">or </span><span class="s2">&quot;</span><span class="s0">\t</span><span class="s2">&quot;</span><span class="s0">, </span><span class="s1">index_col=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">encoding=encoding)</span>
        <span class="s1">tm.assert_frame_equal(data</span><span class="s0">, </span><span class="s1">result)</span>

    <span class="s5"># Test that default arguments copy as tab delimited</span>
    <span class="s0">def </span><span class="s1">test_round_trip_frame(self</span><span class="s0">, </span><span class="s1">df):</span>
        <span class="s1">self.check_round_trip_frame(df)</span>

    <span class="s5"># Test that explicit delimiters are respected</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;sep&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;</span><span class="s0">\t</span><span class="s2">&quot;</span><span class="s0">, </span><span class="s2">&quot;,&quot;</span><span class="s0">, </span><span class="s2">&quot;|&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_round_trip_frame_sep(self</span><span class="s0">, </span><span class="s1">df</span><span class="s0">, </span><span class="s1">sep):</span>
        <span class="s1">self.check_round_trip_frame(df</span><span class="s0">, </span><span class="s1">sep=sep)</span>

    <span class="s5"># Test white space separator</span>
    <span class="s0">def </span><span class="s1">test_round_trip_frame_string(self</span><span class="s0">, </span><span class="s1">df):</span>
        <span class="s1">df.to_clipboard(excel=</span><span class="s0">False, </span><span class="s1">sep=</span><span class="s0">None</span><span class="s1">)</span>
        <span class="s1">result = read_clipboard()</span>
        <span class="s0">assert </span><span class="s1">df.to_string() == result.to_string()</span>
        <span class="s0">assert </span><span class="s1">df.shape == result.shape</span>

    <span class="s5"># Two character separator is not supported in to_clipboard</span>
    <span class="s5"># Test that multi-character separators are not silently passed</span>
    <span class="s0">def </span><span class="s1">test_excel_sep_warning(self</span><span class="s0">, </span><span class="s1">df):</span>
        <span class="s0">with </span><span class="s1">tm.assert_produces_warning():</span>
            <span class="s1">df.to_clipboard(excel=</span><span class="s0">True, </span><span class="s1">sep=</span><span class="s2">r&quot;\t&quot;</span><span class="s1">)</span>

    <span class="s5"># Separator is ignored when excel=False and should produce a warning</span>
    <span class="s0">def </span><span class="s1">test_copy_delim_warning(self</span><span class="s0">, </span><span class="s1">df):</span>
        <span class="s0">with </span><span class="s1">tm.assert_produces_warning():</span>
            <span class="s1">df.to_clipboard(excel=</span><span class="s0">False, </span><span class="s1">sep=</span><span class="s2">&quot;</span><span class="s0">\t</span><span class="s2">&quot;</span><span class="s1">)</span>

    <span class="s5"># Tests that the default behavior of to_clipboard is tab</span>
    <span class="s5"># delimited and excel=&quot;True&quot;</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;sep&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;</span><span class="s0">\t</span><span class="s2">&quot;</span><span class="s0">, None, </span><span class="s2">&quot;default&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;excel&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, None, </span><span class="s2">&quot;default&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_clipboard_copy_tabs_default(self</span><span class="s0">, </span><span class="s1">sep</span><span class="s0">, </span><span class="s1">excel</span><span class="s0">, </span><span class="s1">df</span><span class="s0">, </span><span class="s1">request</span><span class="s0">, </span><span class="s1">mock_clipboard):</span>
        <span class="s1">kwargs = build_kwargs(sep</span><span class="s0">, </span><span class="s1">excel)</span>
        <span class="s1">df.to_clipboard(**kwargs)</span>
        <span class="s0">assert </span><span class="s1">mock_clipboard[request.node.name] == df.to_csv(sep=</span><span class="s2">&quot;</span><span class="s0">\t</span><span class="s2">&quot;</span><span class="s1">)</span>

    <span class="s5"># Tests reading of white space separated tables</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;sep&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s2">&quot;default&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;excel&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_clipboard_copy_strings(self</span><span class="s0">, </span><span class="s1">sep</span><span class="s0">, </span><span class="s1">excel</span><span class="s0">, </span><span class="s1">df):</span>
        <span class="s1">kwargs = build_kwargs(sep</span><span class="s0">, </span><span class="s1">excel)</span>
        <span class="s1">df.to_clipboard(**kwargs)</span>
        <span class="s1">result = read_clipboard(sep=</span><span class="s2">r&quot;\s+&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result.to_string() == df.to_string()</span>
        <span class="s0">assert </span><span class="s1">df.shape == result.shape</span>

    <span class="s0">def </span><span class="s1">test_read_clipboard_infer_excel(self</span><span class="s0">, </span><span class="s1">request</span><span class="s0">, </span><span class="s1">mock_clipboard):</span>
        <span class="s5"># gh-19010: avoid warnings</span>
        <span class="s1">clip_kwargs = {</span><span class="s2">&quot;engine&quot;</span><span class="s1">: </span><span class="s2">&quot;python&quot;</span><span class="s1">}</span>

        <span class="s1">text = dedent(</span>
            <span class="s2">&quot;&quot;&quot; 
            John James  Charlie Mingus 
            1   2 
            4   Harry Carney 
            &quot;&quot;&quot;</span><span class="s1">.strip()</span>
        <span class="s1">)</span>
        <span class="s1">mock_clipboard[request.node.name] = text</span>
        <span class="s1">df = read_clipboard(**clip_kwargs)</span>

        <span class="s5"># excel data is parsed correctly</span>
        <span class="s0">assert </span><span class="s1">df.iloc[</span><span class="s3">1</span><span class="s1">][</span><span class="s3">1</span><span class="s1">] == </span><span class="s2">&quot;Harry Carney&quot;</span>

        <span class="s5"># having diff tab counts doesn't trigger it</span>
        <span class="s1">text = dedent(</span>
            <span class="s2">&quot;&quot;&quot; 
            a</span><span class="s0">\t </span><span class="s2">b 
            1  2 
            3  4 
            &quot;&quot;&quot;</span><span class="s1">.strip()</span>
        <span class="s1">)</span>
        <span class="s1">mock_clipboard[request.node.name] = text</span>
        <span class="s1">res = read_clipboard(**clip_kwargs)</span>

        <span class="s1">text = dedent(</span>
            <span class="s2">&quot;&quot;&quot; 
            a  b 
            1  2 
            3  4 
            &quot;&quot;&quot;</span><span class="s1">.strip()</span>
        <span class="s1">)</span>
        <span class="s1">mock_clipboard[request.node.name] = text</span>
        <span class="s1">exp = read_clipboard(**clip_kwargs)</span>

        <span class="s1">tm.assert_frame_equal(res</span><span class="s0">, </span><span class="s1">exp)</span>

    <span class="s0">def </span><span class="s1">test_infer_excel_with_nulls(self</span><span class="s0">, </span><span class="s1">request</span><span class="s0">, </span><span class="s1">mock_clipboard):</span>
        <span class="s5"># GH41108</span>
        <span class="s1">text = </span><span class="s2">&quot;col1</span><span class="s0">\t</span><span class="s2">col2</span><span class="s0">\n</span><span class="s2">1</span><span class="s0">\t</span><span class="s2">red</span><span class="s0">\n\t</span><span class="s2">blue</span><span class="s0">\n</span><span class="s2">2</span><span class="s0">\t</span><span class="s2">green&quot;</span>

        <span class="s1">mock_clipboard[request.node.name] = text</span>
        <span class="s1">df = read_clipboard()</span>
        <span class="s1">df_expected = DataFrame(</span>
            <span class="s1">data={</span><span class="s2">&quot;col1&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, None, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;col2&quot;</span><span class="s1">: [</span><span class="s2">&quot;red&quot;</span><span class="s0">, </span><span class="s2">&quot;blue&quot;</span><span class="s0">, </span><span class="s2">&quot;green&quot;</span><span class="s1">]}</span>
        <span class="s1">)</span>

        <span class="s5"># excel data is parsed correctly</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">df_expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;multiindex&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">(  </span><span class="s5"># Can't use `dedent` here as it will remove the leading `\t`</span>
                <span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot;</span><span class="s1">.join(</span>
                    <span class="s1">[</span>
                        <span class="s2">&quot;</span><span class="s0">\t\t\t</span><span class="s2">col1</span><span class="s0">\t</span><span class="s2">col2&quot;</span><span class="s0">,</span>
                        <span class="s2">&quot;A</span><span class="s0">\t</span><span class="s2">0</span><span class="s0">\t</span><span class="s2">True</span><span class="s0">\t</span><span class="s2">1</span><span class="s0">\t</span><span class="s2">red&quot;</span><span class="s0">,</span>
                        <span class="s2">&quot;A</span><span class="s0">\t</span><span class="s2">1</span><span class="s0">\t</span><span class="s2">True</span><span class="s0">\t\t</span><span class="s2">blue&quot;</span><span class="s0">,</span>
                        <span class="s2">&quot;B</span><span class="s0">\t</span><span class="s2">0</span><span class="s0">\t</span><span class="s2">False</span><span class="s0">\t</span><span class="s2">2</span><span class="s0">\t</span><span class="s2">green&quot;</span><span class="s0">,</span>
                    <span class="s1">]</span>
                <span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[[</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, True, False</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span>
                <span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot;</span><span class="s1">.join(</span>
                    <span class="s1">[</span><span class="s2">&quot;</span><span class="s0">\t\t</span><span class="s2">col1</span><span class="s0">\t</span><span class="s2">col2&quot;</span><span class="s0">, </span><span class="s2">&quot;A</span><span class="s0">\t</span><span class="s2">0</span><span class="s0">\t</span><span class="s2">1</span><span class="s0">\t</span><span class="s2">red&quot;</span><span class="s0">, </span><span class="s2">&quot;A</span><span class="s0">\t</span><span class="s2">1</span><span class="s0">\t\t</span><span class="s2">blue&quot;</span><span class="s0">, </span><span class="s2">&quot;B</span><span class="s0">\t</span><span class="s2">0</span><span class="s0">\t</span><span class="s2">2</span><span class="s0">\t</span><span class="s2">green&quot;</span><span class="s1">]</span>
                <span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[[</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_infer_excel_with_multiindex(self</span><span class="s0">, </span><span class="s1">request</span><span class="s0">, </span><span class="s1">mock_clipboard</span><span class="s0">, </span><span class="s1">multiindex):</span>
        <span class="s5"># GH41108</span>

        <span class="s1">mock_clipboard[request.node.name] = multiindex[</span><span class="s3">0</span><span class="s1">]</span>
        <span class="s1">df = read_clipboard()</span>
        <span class="s1">df_expected = DataFrame(</span>
            <span class="s1">data={</span><span class="s2">&quot;col1&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, None, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;col2&quot;</span><span class="s1">: [</span><span class="s2">&quot;red&quot;</span><span class="s0">, </span><span class="s2">&quot;blue&quot;</span><span class="s0">, </span><span class="s2">&quot;green&quot;</span><span class="s1">]}</span><span class="s0">,</span>
            <span class="s1">index=multiindex[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>

        <span class="s5"># excel data is parsed correctly</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">df_expected)</span>

    <span class="s0">def </span><span class="s1">test_invalid_encoding(self</span><span class="s0">, </span><span class="s1">df):</span>
        <span class="s1">msg = </span><span class="s2">&quot;clipboard only supports utf-8 encoding&quot;</span>
        <span class="s5"># test case for testing invalid encoding</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">df.to_clipboard(encoding=</span><span class="s2">&quot;ascii&quot;</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(NotImplementedError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">read_clipboard(encoding=</span><span class="s2">&quot;ascii&quot;</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;enc&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;UTF-8&quot;</span><span class="s0">, </span><span class="s2">&quot;utf-8&quot;</span><span class="s0">, </span><span class="s2">&quot;utf8&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_round_trip_valid_encodings(self</span><span class="s0">, </span><span class="s1">enc</span><span class="s0">, </span><span class="s1">df):</span>
        <span class="s1">self.check_round_trip_frame(df</span><span class="s0">, </span><span class="s1">encoding=enc)</span>


<span class="s1">@pytest.mark.single</span>
<span class="s1">@pytest.mark.clipboard</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;</span><span class="s0">\U0001f44d</span><span class="s2">...&quot;</span><span class="s0">, </span><span class="s2">&quot;Ωœ∑´...&quot;</span><span class="s0">, </span><span class="s2">&quot;abcd...&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_raw_roundtrip(data):</span>
    <span class="s5"># PR #25040 wide unicode wasn't copied correctly on PY3 on windows</span>
    <span class="s1">clipboard_set(data)</span>
    <span class="s0">assert </span><span class="s1">data == clipboard_get()</span>
</pre>
</body>
</html>