<html>
<head>
<title>test_cat.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #808080;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_cat.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">DataFrame</span><span class="s0">,</span>
    <span class="s1">Index</span><span class="s0">,</span>
    <span class="s1">MultiIndex</span><span class="s0">,</span>
    <span class="s1">Series</span><span class="s0">,</span>
    <span class="s1">_testing </span><span class="s0">as </span><span class="s1">tm</span><span class="s0">,</span>
    <span class="s1">concat</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">from </span><span class="s1">pandas.tests.strings.test_strings </span><span class="s0">import </span><span class="s1">assert_series_or_index_equal</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;other&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s1">Series</span><span class="s0">, </span><span class="s1">Index])</span>
<span class="s0">def </span><span class="s1">test_str_cat_name(index_or_series</span><span class="s0">, </span><span class="s1">other):</span>
    <span class="s3"># GH 21053</span>
    <span class="s1">box = index_or_series</span>
    <span class="s1">values = [</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">]</span>
    <span class="s0">if </span><span class="s1">other:</span>
        <span class="s1">other = other(values)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">other = values</span>
    <span class="s1">result = box(values</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;name&quot;</span><span class="s1">).str.cat(other</span><span class="s0">, </span><span class="s1">sep=</span><span class="s2">&quot;,&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">result.name == </span><span class="s2">&quot;name&quot;</span>


<span class="s0">def </span><span class="s1">test_str_cat(index_or_series):</span>
    <span class="s1">box = index_or_series</span>
    <span class="s3"># test_cat above tests &quot;str_cat&quot; from ndarray;</span>
    <span class="s3"># here testing &quot;str.cat&quot; from Series/Index to ndarray/list</span>
    <span class="s1">s = box([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s1">np.nan])</span>

    <span class="s3"># single array</span>
    <span class="s1">result = s.str.cat()</span>
    <span class="s1">expected = </span><span class="s2">&quot;aabbc&quot;</span>
    <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s1">result = s.str.cat(na_rep=</span><span class="s2">&quot;-&quot;</span><span class="s1">)</span>
    <span class="s1">expected = </span><span class="s2">&quot;aabbc-&quot;</span>
    <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s1">result = s.str.cat(sep=</span><span class="s2">&quot;_&quot;</span><span class="s0">, </span><span class="s1">na_rep=</span><span class="s2">&quot;NA&quot;</span><span class="s1">)</span>
    <span class="s1">expected = </span><span class="s2">&quot;a_a_b_b_c_NA&quot;</span>
    <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s1">t = np.array([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s2">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=object)</span>
    <span class="s1">expected = box([</span><span class="s2">&quot;aa&quot;</span><span class="s0">, </span><span class="s2">&quot;a-&quot;</span><span class="s0">, </span><span class="s2">&quot;bb&quot;</span><span class="s0">, </span><span class="s2">&quot;bd&quot;</span><span class="s0">, </span><span class="s2">&quot;cfoo&quot;</span><span class="s0">, </span><span class="s2">&quot;--&quot;</span><span class="s1">])</span>

    <span class="s3"># Series/Index with array</span>
    <span class="s1">result = s.str.cat(t</span><span class="s0">, </span><span class="s1">na_rep=</span><span class="s2">&quot;-&quot;</span><span class="s1">)</span>
    <span class="s1">assert_series_or_index_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s3"># Series/Index with list</span>
    <span class="s1">result = s.str.cat(list(t)</span><span class="s0">, </span><span class="s1">na_rep=</span><span class="s2">&quot;-&quot;</span><span class="s1">)</span>
    <span class="s1">assert_series_or_index_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s3"># errors for incorrect lengths</span>
    <span class="s1">rgx = </span><span class="s2">r&quot;If `others` contains arrays or lists \(or other list-likes.*&quot;</span>
    <span class="s1">z = Series([</span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s2">&quot;2&quot;</span><span class="s0">, </span><span class="s2">&quot;3&quot;</span><span class="s1">])</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=rgx):</span>
        <span class="s1">s.str.cat(z.values)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=rgx):</span>
        <span class="s1">s.str.cat(list(z))</span>


<span class="s0">def </span><span class="s1">test_str_cat_raises_intuitive_error(index_or_series):</span>
    <span class="s3"># GH 11334</span>
    <span class="s1">box = index_or_series</span>
    <span class="s1">s = box([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s1">])</span>
    <span class="s1">message = </span><span class="s2">&quot;Did you mean to supply a `sep` keyword?&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=message):</span>
        <span class="s1">s.str.cat(</span><span class="s2">&quot;|&quot;</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=message):</span>
        <span class="s1">s.str.cat(</span><span class="s2">&quot;    &quot;</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;sep&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;&quot;</span><span class="s0">, None</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;dtype_target&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;object&quot;</span><span class="s0">, </span><span class="s2">&quot;category&quot;</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;dtype_caller&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;object&quot;</span><span class="s0">, </span><span class="s2">&quot;category&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_str_cat_categorical(index_or_series</span><span class="s0">, </span><span class="s1">dtype_caller</span><span class="s0">, </span><span class="s1">dtype_target</span><span class="s0">, </span><span class="s1">sep):</span>
    <span class="s1">box = index_or_series</span>

    <span class="s1">s = Index([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=dtype_caller)</span>
    <span class="s1">s = s </span><span class="s0">if </span><span class="s1">box == Index </span><span class="s0">else </span><span class="s1">Series(s</span><span class="s0">, </span><span class="s1">index=s)</span>
    <span class="s1">t = Index([</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=dtype_target)</span>

    <span class="s1">expected = Index([</span><span class="s2">&quot;ab&quot;</span><span class="s0">, </span><span class="s2">&quot;aa&quot;</span><span class="s0">, </span><span class="s2">&quot;bb&quot;</span><span class="s0">, </span><span class="s2">&quot;ac&quot;</span><span class="s1">])</span>
    <span class="s1">expected = expected </span><span class="s0">if </span><span class="s1">box == Index </span><span class="s0">else </span><span class="s1">Series(expected</span><span class="s0">, </span><span class="s1">index=s)</span>

    <span class="s3"># Series/Index with unaligned Index -&gt; t.values</span>
    <span class="s1">result = s.str.cat(t.values</span><span class="s0">, </span><span class="s1">sep=sep)</span>
    <span class="s1">assert_series_or_index_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s3"># Series/Index with Series having matching Index</span>
    <span class="s1">t = Series(t.values</span><span class="s0">, </span><span class="s1">index=s)</span>
    <span class="s1">result = s.str.cat(t</span><span class="s0">, </span><span class="s1">sep=sep)</span>
    <span class="s1">assert_series_or_index_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s3"># Series/Index with Series.values</span>
    <span class="s1">result = s.str.cat(t.values</span><span class="s0">, </span><span class="s1">sep=sep)</span>
    <span class="s1">assert_series_or_index_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s3"># Series/Index with Series having different Index</span>
    <span class="s1">t = Series(t.values</span><span class="s0">, </span><span class="s1">index=t.values)</span>
    <span class="s1">expected = Index([</span><span class="s2">&quot;aa&quot;</span><span class="s0">, </span><span class="s2">&quot;aa&quot;</span><span class="s0">, </span><span class="s2">&quot;aa&quot;</span><span class="s0">, </span><span class="s2">&quot;bb&quot;</span><span class="s0">, </span><span class="s2">&quot;bb&quot;</span><span class="s1">])</span>
    <span class="s1">expected = expected </span><span class="s0">if </span><span class="s1">box == Index </span><span class="s0">else </span><span class="s1">Series(expected</span><span class="s0">, </span><span class="s1">index=expected.str[:</span><span class="s4">1</span><span class="s1">])</span>

    <span class="s1">result = s.str.cat(t</span><span class="s0">, </span><span class="s1">sep=sep)</span>
    <span class="s1">assert_series_or_index_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;data&quot;</span><span class="s0">,</span>
    <span class="s1">[[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">]]</span><span class="s0">,</span>
    <span class="s1">ids=[</span><span class="s2">&quot;integers&quot;</span><span class="s0">, </span><span class="s2">&quot;floats&quot;</span><span class="s0">, </span><span class="s2">&quot;mixed&quot;</span><span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s3"># without dtype=object, np.array would cast [1, 2, 'b'] to ['1', '2', 'b']</span>
<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;box&quot;</span><span class="s0">,</span>
    <span class="s1">[Series</span><span class="s0">, </span><span class="s1">Index</span><span class="s0">, </span><span class="s1">list</span><span class="s0">, lambda </span><span class="s1">x: np.array(x</span><span class="s0">, </span><span class="s1">dtype=object)]</span><span class="s0">,</span>
    <span class="s1">ids=[</span><span class="s2">&quot;Series&quot;</span><span class="s0">, </span><span class="s2">&quot;Index&quot;</span><span class="s0">, </span><span class="s2">&quot;list&quot;</span><span class="s0">, </span><span class="s2">&quot;np.array&quot;</span><span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_str_cat_wrong_dtype_raises(box</span><span class="s0">, </span><span class="s1">data):</span>
    <span class="s3"># GH 22722</span>
    <span class="s1">s = Series([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">])</span>
    <span class="s1">t = box(data)</span>

    <span class="s1">msg = </span><span class="s2">&quot;Concatenation requires list-likes containing only strings.*&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s3"># need to use outer and na_rep, as otherwise Index would not raise</span>
        <span class="s1">s.str.cat(t</span><span class="s0">, </span><span class="s1">join=</span><span class="s2">&quot;outer&quot;</span><span class="s0">, </span><span class="s1">na_rep=</span><span class="s2">&quot;-&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_str_cat_mixed_inputs(index_or_series):</span>
    <span class="s1">box = index_or_series</span>
    <span class="s1">s = Index([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s1">])</span>
    <span class="s1">s = s </span><span class="s0">if </span><span class="s1">box == Index </span><span class="s0">else </span><span class="s1">Series(s</span><span class="s0">, </span><span class="s1">index=s)</span>

    <span class="s1">t = Series([</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=s.values)</span>
    <span class="s1">d = concat([t</span><span class="s0">, </span><span class="s1">Series(s</span><span class="s0">, </span><span class="s1">index=s)]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>

    <span class="s1">expected = Index([</span><span class="s2">&quot;aAa&quot;</span><span class="s0">, </span><span class="s2">&quot;bBb&quot;</span><span class="s0">, </span><span class="s2">&quot;cCc&quot;</span><span class="s0">, </span><span class="s2">&quot;dDd&quot;</span><span class="s1">])</span>
    <span class="s1">expected = expected </span><span class="s0">if </span><span class="s1">box == Index </span><span class="s0">else </span><span class="s1">Series(expected.values</span><span class="s0">, </span><span class="s1">index=s.values)</span>

    <span class="s3"># Series/Index with DataFrame</span>
    <span class="s1">result = s.str.cat(d)</span>
    <span class="s1">assert_series_or_index_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s3"># Series/Index with two-dimensional ndarray</span>
    <span class="s1">result = s.str.cat(d.values)</span>
    <span class="s1">assert_series_or_index_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s3"># Series/Index with list of Series</span>
    <span class="s1">result = s.str.cat([t</span><span class="s0">, </span><span class="s1">s])</span>
    <span class="s1">assert_series_or_index_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s3"># Series/Index with mixed list of Series/array</span>
    <span class="s1">result = s.str.cat([t</span><span class="s0">, </span><span class="s1">s.values])</span>
    <span class="s1">assert_series_or_index_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s3"># Series/Index with list of Series; different indexes</span>
    <span class="s1">t.index = [</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">]</span>
    <span class="s1">expected = box([</span><span class="s2">&quot;aDa&quot;</span><span class="s0">, </span><span class="s2">&quot;bAb&quot;</span><span class="s0">, </span><span class="s2">&quot;cBc&quot;</span><span class="s0">, </span><span class="s2">&quot;dCd&quot;</span><span class="s1">])</span>
    <span class="s1">expected = expected </span><span class="s0">if </span><span class="s1">box == Index </span><span class="s0">else </span><span class="s1">Series(expected.values</span><span class="s0">, </span><span class="s1">index=s.values)</span>
    <span class="s1">result = s.str.cat([t</span><span class="s0">, </span><span class="s1">s])</span>
    <span class="s1">assert_series_or_index_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s3"># Series/Index with mixed list; different index</span>
    <span class="s1">result = s.str.cat([t</span><span class="s0">, </span><span class="s1">s.values])</span>
    <span class="s1">assert_series_or_index_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s3"># Series/Index with DataFrame; different indexes</span>
    <span class="s1">d.index = [</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">]</span>
    <span class="s1">expected = box([</span><span class="s2">&quot;aDd&quot;</span><span class="s0">, </span><span class="s2">&quot;bAa&quot;</span><span class="s0">, </span><span class="s2">&quot;cBb&quot;</span><span class="s0">, </span><span class="s2">&quot;dCc&quot;</span><span class="s1">])</span>
    <span class="s1">expected = expected </span><span class="s0">if </span><span class="s1">box == Index </span><span class="s0">else </span><span class="s1">Series(expected.values</span><span class="s0">, </span><span class="s1">index=s.values)</span>
    <span class="s1">result = s.str.cat(d)</span>
    <span class="s1">assert_series_or_index_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s3"># errors for incorrect lengths</span>
    <span class="s1">rgx = </span><span class="s2">r&quot;If `others` contains arrays or lists \(or other list-likes.*&quot;</span>
    <span class="s1">z = Series([</span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s2">&quot;2&quot;</span><span class="s0">, </span><span class="s2">&quot;3&quot;</span><span class="s1">])</span>
    <span class="s1">e = concat([z</span><span class="s0">, </span><span class="s1">z]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>

    <span class="s3"># two-dimensional ndarray</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=rgx):</span>
        <span class="s1">s.str.cat(e.values)</span>

    <span class="s3"># list of list-likes</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=rgx):</span>
        <span class="s1">s.str.cat([z.values</span><span class="s0">, </span><span class="s1">s.values])</span>

    <span class="s3"># mixed list of Series/list-like</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=rgx):</span>
        <span class="s1">s.str.cat([z.values</span><span class="s0">, </span><span class="s1">s])</span>

    <span class="s3"># errors for incorrect arguments in list-like</span>
    <span class="s1">rgx = </span><span class="s2">&quot;others must be Series, Index, DataFrame,.*&quot;</span>
    <span class="s3"># make sure None/NaN do not crash checks in _get_series_list</span>
    <span class="s1">u = Series([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, None</span><span class="s1">])</span>

    <span class="s3"># mix of string and Series</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=rgx):</span>
        <span class="s1">s.str.cat([u</span><span class="s0">, </span><span class="s2">&quot;u&quot;</span><span class="s1">])</span>

    <span class="s3"># DataFrame in list</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=rgx):</span>
        <span class="s1">s.str.cat([u</span><span class="s0">, </span><span class="s1">d])</span>

    <span class="s3"># 2-dim ndarray in list</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=rgx):</span>
        <span class="s1">s.str.cat([u</span><span class="s0">, </span><span class="s1">d.values])</span>

    <span class="s3"># nested lists</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=rgx):</span>
        <span class="s1">s.str.cat([u</span><span class="s0">, </span><span class="s1">[u</span><span class="s0">, </span><span class="s1">d]])</span>

    <span class="s3"># forbidden input type: set</span>
    <span class="s3"># GH 23009</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=rgx):</span>
        <span class="s1">s.str.cat(set(u))</span>

    <span class="s3"># forbidden input type: set in list</span>
    <span class="s3"># GH 23009</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=rgx):</span>
        <span class="s1">s.str.cat([u</span><span class="s0">, </span><span class="s1">set(u)])</span>

    <span class="s3"># other forbidden input type, e.g. int</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=rgx):</span>
        <span class="s1">s.str.cat(</span><span class="s4">1</span><span class="s1">)</span>

    <span class="s3"># nested list-likes</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=rgx):</span>
        <span class="s1">s.str.cat(iter([t.values</span><span class="s0">, </span><span class="s1">list(s)]))</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;join&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;left&quot;</span><span class="s0">, </span><span class="s2">&quot;outer&quot;</span><span class="s0">, </span><span class="s2">&quot;inner&quot;</span><span class="s0">, </span><span class="s2">&quot;right&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_str_cat_align_indexed(index_or_series</span><span class="s0">, </span><span class="s1">join):</span>
    <span class="s3"># https://github.com/pandas-dev/pandas/issues/18657</span>
    <span class="s1">box = index_or_series</span>

    <span class="s1">s = Series([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s1">])</span>
    <span class="s1">t = Series([</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;E&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;e&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">])</span>
    <span class="s1">sa</span><span class="s0">, </span><span class="s1">ta = s.align(t</span><span class="s0">, </span><span class="s1">join=join)</span>
    <span class="s3"># result after manual alignment of inputs</span>
    <span class="s1">expected = sa.str.cat(ta</span><span class="s0">, </span><span class="s1">na_rep=</span><span class="s2">&quot;-&quot;</span><span class="s1">)</span>

    <span class="s0">if </span><span class="s1">box == Index:</span>
        <span class="s1">s = Index(s)</span>
        <span class="s1">sa = Index(sa)</span>
        <span class="s1">expected = Index(expected)</span>

    <span class="s1">result = s.str.cat(t</span><span class="s0">, </span><span class="s1">join=join</span><span class="s0">, </span><span class="s1">na_rep=</span><span class="s2">&quot;-&quot;</span><span class="s1">)</span>
    <span class="s1">assert_series_or_index_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;join&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;left&quot;</span><span class="s0">, </span><span class="s2">&quot;outer&quot;</span><span class="s0">, </span><span class="s2">&quot;inner&quot;</span><span class="s0">, </span><span class="s2">&quot;right&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_str_cat_align_mixed_inputs(join):</span>
    <span class="s1">s = Series([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s1">])</span>
    <span class="s1">t = Series([</span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;e&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">d = concat([t</span><span class="s0">, </span><span class="s1">t]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>

    <span class="s1">expected_outer = Series([</span><span class="s2">&quot;aaa&quot;</span><span class="s0">, </span><span class="s2">&quot;bbb&quot;</span><span class="s0">, </span><span class="s2">&quot;c--&quot;</span><span class="s0">, </span><span class="s2">&quot;ddd&quot;</span><span class="s0">, </span><span class="s2">&quot;-ee&quot;</span><span class="s1">])</span>
    <span class="s1">expected = expected_outer.loc[s.index.join(t.index</span><span class="s0">, </span><span class="s1">how=join)]</span>

    <span class="s3"># list of Series</span>
    <span class="s1">result = s.str.cat([t</span><span class="s0">, </span><span class="s1">t]</span><span class="s0">, </span><span class="s1">join=join</span><span class="s0">, </span><span class="s1">na_rep=</span><span class="s2">&quot;-&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s3"># DataFrame</span>
    <span class="s1">result = s.str.cat(d</span><span class="s0">, </span><span class="s1">join=join</span><span class="s0">, </span><span class="s1">na_rep=</span><span class="s2">&quot;-&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s3"># mixed list of indexed/unindexed</span>
    <span class="s1">u = np.array([</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s1">])</span>
    <span class="s1">expected_outer = Series([</span><span class="s2">&quot;aaA&quot;</span><span class="s0">, </span><span class="s2">&quot;bbB&quot;</span><span class="s0">, </span><span class="s2">&quot;c-C&quot;</span><span class="s0">, </span><span class="s2">&quot;ddD&quot;</span><span class="s0">, </span><span class="s2">&quot;-e-&quot;</span><span class="s1">])</span>
    <span class="s3"># joint index of rhs [t, u]; u will be forced have index of s</span>
    <span class="s1">rhs_idx = (</span>
        <span class="s1">t.index.intersection(s.index)</span>
        <span class="s0">if </span><span class="s1">join == </span><span class="s2">&quot;inner&quot;</span>
        <span class="s0">else </span><span class="s1">t.index.union(s.index)</span>
        <span class="s0">if </span><span class="s1">join == </span><span class="s2">&quot;outer&quot;</span>
        <span class="s0">else </span><span class="s1">t.index.append(s.index.difference(t.index))</span>
    <span class="s1">)</span>

    <span class="s1">expected = expected_outer.loc[s.index.join(rhs_idx</span><span class="s0">, </span><span class="s1">how=join)]</span>
    <span class="s1">result = s.str.cat([t</span><span class="s0">, </span><span class="s1">u]</span><span class="s0">, </span><span class="s1">join=join</span><span class="s0">, </span><span class="s1">na_rep=</span><span class="s2">&quot;-&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;others must be Series,.*&quot;</span><span class="s1">):</span>
        <span class="s3"># nested lists are forbidden</span>
        <span class="s1">s.str.cat([t</span><span class="s0">, </span><span class="s1">list(u)]</span><span class="s0">, </span><span class="s1">join=join)</span>

    <span class="s3"># errors for incorrect lengths</span>
    <span class="s1">rgx = </span><span class="s2">r&quot;If `others` contains arrays or lists \(or other list-likes.*&quot;</span>
    <span class="s1">z = Series([</span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s2">&quot;2&quot;</span><span class="s0">, </span><span class="s2">&quot;3&quot;</span><span class="s1">]).values</span>

    <span class="s3"># unindexed object of wrong length</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=rgx):</span>
        <span class="s1">s.str.cat(z</span><span class="s0">, </span><span class="s1">join=join)</span>

    <span class="s3"># unindexed object of wrong length in list</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=rgx):</span>
        <span class="s1">s.str.cat([t</span><span class="s0">, </span><span class="s1">z]</span><span class="s0">, </span><span class="s1">join=join)</span>


<span class="s0">def </span><span class="s1">test_str_cat_all_na(index_or_series</span><span class="s0">, </span><span class="s1">index_or_series2):</span>
    <span class="s3"># GH 24044</span>
    <span class="s1">box = index_or_series</span>
    <span class="s1">other = index_or_series2</span>

    <span class="s3"># check that all NaNs in caller / target work</span>
    <span class="s1">s = Index([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s1">])</span>
    <span class="s1">s = s </span><span class="s0">if </span><span class="s1">box == Index </span><span class="s0">else </span><span class="s1">Series(s</span><span class="s0">, </span><span class="s1">index=s)</span>
    <span class="s1">t = other([np.nan] * </span><span class="s4">4</span><span class="s0">, </span><span class="s1">dtype=object)</span>
    <span class="s3"># add index of s for alignment</span>
    <span class="s1">t = t </span><span class="s0">if </span><span class="s1">other == Index </span><span class="s0">else </span><span class="s1">Series(t</span><span class="s0">, </span><span class="s1">index=s)</span>

    <span class="s3"># all-NA target</span>
    <span class="s0">if </span><span class="s1">box == Series:</span>
        <span class="s1">expected = Series([np.nan] * </span><span class="s4">4</span><span class="s0">, </span><span class="s1">index=s.index</span><span class="s0">, </span><span class="s1">dtype=object)</span>
    <span class="s0">else</span><span class="s1">:  </span><span class="s3"># box == Index</span>
        <span class="s1">expected = Index([np.nan] * </span><span class="s4">4</span><span class="s0">, </span><span class="s1">dtype=object)</span>
    <span class="s1">result = s.str.cat(t</span><span class="s0">, </span><span class="s1">join=</span><span class="s2">&quot;left&quot;</span><span class="s1">)</span>
    <span class="s1">assert_series_or_index_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s3"># all-NA caller (only for Series)</span>
    <span class="s0">if </span><span class="s1">other == Series:</span>
        <span class="s1">expected = Series([np.nan] * </span><span class="s4">4</span><span class="s0">, </span><span class="s1">dtype=object</span><span class="s0">, </span><span class="s1">index=t.index)</span>
        <span class="s1">result = t.str.cat(s</span><span class="s0">, </span><span class="s1">join=</span><span class="s2">&quot;left&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_str_cat_special_cases():</span>
    <span class="s1">s = Series([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s1">])</span>
    <span class="s1">t = Series([</span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;e&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>

    <span class="s3"># iterator of elements with different types</span>
    <span class="s1">expected = Series([</span><span class="s2">&quot;aaa&quot;</span><span class="s0">, </span><span class="s2">&quot;bbb&quot;</span><span class="s0">, </span><span class="s2">&quot;c-c&quot;</span><span class="s0">, </span><span class="s2">&quot;ddd&quot;</span><span class="s0">, </span><span class="s2">&quot;-e-&quot;</span><span class="s1">])</span>
    <span class="s1">result = s.str.cat(iter([t</span><span class="s0">, </span><span class="s1">s.values])</span><span class="s0">, </span><span class="s1">join=</span><span class="s2">&quot;outer&quot;</span><span class="s0">, </span><span class="s1">na_rep=</span><span class="s2">&quot;-&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s3"># right-align with different indexes in others</span>
    <span class="s1">expected = Series([</span><span class="s2">&quot;aa-&quot;</span><span class="s0">, </span><span class="s2">&quot;d-d&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span>
    <span class="s1">result = s.str.cat([t.loc[[</span><span class="s4">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">t.loc[[</span><span class="s4">3</span><span class="s1">]]]</span><span class="s0">, </span><span class="s1">join=</span><span class="s2">&quot;right&quot;</span><span class="s0">, </span><span class="s1">na_rep=</span><span class="s2">&quot;-&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_cat_on_filtered_index():</span>
    <span class="s1">df = DataFrame(</span>
        <span class="s1">index=MultiIndex.from_product(</span>
            <span class="s1">[[</span><span class="s4">2011</span><span class="s0">, </span><span class="s4">2012</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">names=[</span><span class="s2">&quot;year&quot;</span><span class="s0">, </span><span class="s2">&quot;month&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>
    <span class="s1">)</span>

    <span class="s1">df = df.reset_index()</span>
    <span class="s1">df = df[df.month &gt; </span><span class="s4">1</span><span class="s1">]</span>

    <span class="s1">str_year = df.year.astype(</span><span class="s2">&quot;str&quot;</span><span class="s1">)</span>
    <span class="s1">str_month = df.month.astype(</span><span class="s2">&quot;str&quot;</span><span class="s1">)</span>
    <span class="s1">str_both = str_year.str.cat(str_month</span><span class="s0">, </span><span class="s1">sep=</span><span class="s2">&quot; &quot;</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">str_both.loc[</span><span class="s4">1</span><span class="s1">] == </span><span class="s2">&quot;2011 2&quot;</span>

    <span class="s1">str_multiple = str_year.str.cat([str_month</span><span class="s0">, </span><span class="s1">str_month]</span><span class="s0">, </span><span class="s1">sep=</span><span class="s2">&quot; &quot;</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">str_multiple.loc[</span><span class="s4">1</span><span class="s1">] == </span><span class="s2">&quot;2011 2 2&quot;</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;klass&quot;</span><span class="s0">, </span><span class="s1">[tuple</span><span class="s0">, </span><span class="s1">list</span><span class="s0">, </span><span class="s1">np.array</span><span class="s0">, </span><span class="s1">Series</span><span class="s0">, </span><span class="s1">Index])</span>
<span class="s0">def </span><span class="s1">test_cat_different_classes(klass):</span>
    <span class="s3"># https://github.com/pandas-dev/pandas/issues/33425</span>
    <span class="s1">s = Series([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">])</span>
    <span class="s1">result = s.str.cat(klass([</span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s2">&quot;y&quot;</span><span class="s0">, </span><span class="s2">&quot;z&quot;</span><span class="s1">]))</span>
    <span class="s1">expected = Series([</span><span class="s2">&quot;ax&quot;</span><span class="s0">, </span><span class="s2">&quot;by&quot;</span><span class="s0">, </span><span class="s2">&quot;cz&quot;</span><span class="s1">])</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
</pre>
</body>
</html>