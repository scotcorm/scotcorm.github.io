<html>
<head>
<title>test_dt_accessor.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #808080;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_dt_accessor.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">calendar</span>
<span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">date</span><span class="s0">,</span>
    <span class="s1">datetime</span><span class="s0">,</span>
    <span class="s1">time</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">locale</span>
<span class="s0">import </span><span class="s1">unicodedata</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">import </span><span class="s1">pytz</span>

<span class="s0">from </span><span class="s1">pandas._libs.tslibs.timezones </span><span class="s0">import </span><span class="s1">maybe_get_tz</span>

<span class="s0">from </span><span class="s1">pandas.core.dtypes.common </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">is_integer_dtype</span><span class="s0">,</span>
    <span class="s1">is_list_like</span><span class="s0">,</span>
<span class="s1">)</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">DataFrame</span><span class="s0">,</span>
    <span class="s1">DatetimeIndex</span><span class="s0">,</span>
    <span class="s1">Index</span><span class="s0">,</span>
    <span class="s1">Period</span><span class="s0">,</span>
    <span class="s1">PeriodIndex</span><span class="s0">,</span>
    <span class="s1">Series</span><span class="s0">,</span>
    <span class="s1">TimedeltaIndex</span><span class="s0">,</span>
    <span class="s1">date_range</span><span class="s0">,</span>
    <span class="s1">period_range</span><span class="s0">,</span>
    <span class="s1">timedelta_range</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">pandas._testing </span><span class="s0">as </span><span class="s1">tm</span>
<span class="s0">from </span><span class="s1">pandas.core.arrays </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">DatetimeArray</span><span class="s0">,</span>
    <span class="s1">PeriodArray</span><span class="s0">,</span>
    <span class="s1">TimedeltaArray</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">pandas.core.common </span><span class="s0">as </span><span class="s1">com</span>

<span class="s1">ok_for_period = PeriodArray._datetimelike_ops</span>
<span class="s1">ok_for_period_methods = [</span><span class="s2">&quot;strftime&quot;</span><span class="s0">, </span><span class="s2">&quot;to_timestamp&quot;</span><span class="s0">, </span><span class="s2">&quot;asfreq&quot;</span><span class="s1">]</span>
<span class="s1">ok_for_dt = DatetimeArray._datetimelike_ops</span>
<span class="s1">ok_for_dt_methods = [</span>
    <span class="s2">&quot;to_period&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;to_pydatetime&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;tz_localize&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;tz_convert&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;normalize&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;strftime&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;round&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;floor&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;ceil&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;day_name&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;month_name&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;isocalendar&quot;</span><span class="s0">,</span>
<span class="s1">]</span>
<span class="s1">ok_for_td = TimedeltaArray._datetimelike_ops</span>
<span class="s1">ok_for_td_methods = [</span>
    <span class="s2">&quot;components&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;to_pytimedelta&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;total_seconds&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;round&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;floor&quot;</span><span class="s0">,</span>
    <span class="s2">&quot;ceil&quot;</span><span class="s0">,</span>
<span class="s1">]</span>


<span class="s0">def </span><span class="s1">get_dir(ser):</span>
    <span class="s3"># check limited display api</span>
    <span class="s1">results = [r </span><span class="s0">for </span><span class="s1">r </span><span class="s0">in </span><span class="s1">ser.dt.__dir__() </span><span class="s0">if not </span><span class="s1">r.startswith(</span><span class="s2">&quot;_&quot;</span><span class="s1">)]</span>
    <span class="s0">return </span><span class="s1">sorted(set(results))</span>


<span class="s0">class </span><span class="s1">TestSeriesDatetimeValues:</span>
    <span class="s0">def </span><span class="s1">_compare(self</span><span class="s0">, </span><span class="s1">ser</span><span class="s0">, </span><span class="s1">name):</span>
        <span class="s3"># GH 7207, 11128</span>
        <span class="s3"># test .dt namespace accessor</span>

        <span class="s0">def </span><span class="s1">get_expected(ser</span><span class="s0">, </span><span class="s1">prop):</span>
            <span class="s1">result = getattr(Index(ser._values)</span><span class="s0">, </span><span class="s1">prop)</span>
            <span class="s0">if </span><span class="s1">isinstance(result</span><span class="s0">, </span><span class="s1">np.ndarray):</span>
                <span class="s0">if </span><span class="s1">is_integer_dtype(result):</span>
                    <span class="s1">result = result.astype(</span><span class="s2">&quot;int64&quot;</span><span class="s1">)</span>
            <span class="s0">elif not </span><span class="s1">is_list_like(result) </span><span class="s0">or </span><span class="s1">isinstance(result</span><span class="s0">, </span><span class="s1">DataFrame):</span>
                <span class="s0">return </span><span class="s1">result</span>
            <span class="s0">return </span><span class="s1">Series(result</span><span class="s0">, </span><span class="s1">index=ser.index</span><span class="s0">, </span><span class="s1">name=ser.name)</span>

        <span class="s1">left = getattr(ser.dt</span><span class="s0">, </span><span class="s1">name)</span>
        <span class="s1">right = get_expected(ser</span><span class="s0">, </span><span class="s1">name)</span>
        <span class="s0">if not </span><span class="s1">(is_list_like(left) </span><span class="s0">and </span><span class="s1">is_list_like(right)):</span>
            <span class="s0">assert </span><span class="s1">left == right</span>
        <span class="s0">elif </span><span class="s1">isinstance(left</span><span class="s0">, </span><span class="s1">DataFrame):</span>
            <span class="s1">tm.assert_frame_equal(left</span><span class="s0">, </span><span class="s1">right)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">tm.assert_series_equal(left</span><span class="s0">, </span><span class="s1">right)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;freq&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;s&quot;</span><span class="s0">, </span><span class="s2">&quot;ms&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_dt_namespace_accessor_datetime64(self</span><span class="s0">, </span><span class="s1">freq):</span>
        <span class="s3"># GH#7207, GH#11128</span>
        <span class="s3"># test .dt namespace accessor</span>

        <span class="s3"># datetimeindex</span>
        <span class="s1">dti = date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">freq=freq)</span>
        <span class="s1">ser = Series(dti</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s1">)</span>

        <span class="s0">for </span><span class="s1">prop </span><span class="s0">in </span><span class="s1">ok_for_dt:</span>
            <span class="s3"># we test freq below</span>
            <span class="s3"># we ignore week and weekofyear because they are deprecated</span>
            <span class="s0">if </span><span class="s1">prop </span><span class="s0">not in </span><span class="s1">[</span><span class="s2">&quot;freq&quot;</span><span class="s0">, </span><span class="s2">&quot;week&quot;</span><span class="s0">, </span><span class="s2">&quot;weekofyear&quot;</span><span class="s1">]:</span>
                <span class="s1">self._compare(ser</span><span class="s0">, </span><span class="s1">prop)</span>

        <span class="s0">for </span><span class="s1">prop </span><span class="s0">in </span><span class="s1">ok_for_dt_methods:</span>
            <span class="s1">getattr(ser.dt</span><span class="s0">, </span><span class="s1">prop)</span>

        <span class="s1">result = ser.dt.to_pydatetime()</span>
        <span class="s0">assert </span><span class="s1">isinstance(result</span><span class="s0">, </span><span class="s1">np.ndarray)</span>
        <span class="s0">assert </span><span class="s1">result.dtype == object</span>

        <span class="s1">result = ser.dt.tz_localize(</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s1">exp_values = DatetimeIndex(ser.values).tz_localize(</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Series(exp_values</span><span class="s0">, </span><span class="s1">index=ser.index</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">tz_result = result.dt.tz</span>
        <span class="s0">assert </span><span class="s1">str(tz_result) == </span><span class="s2">&quot;US/Eastern&quot;</span>
        <span class="s1">freq_result = ser.dt.freq</span>
        <span class="s0">assert </span><span class="s1">freq_result == DatetimeIndex(ser.values</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;infer&quot;</span><span class="s1">).freq</span>

        <span class="s3"># let's localize, then convert</span>
        <span class="s1">result = ser.dt.tz_localize(</span><span class="s2">&quot;UTC&quot;</span><span class="s1">).dt.tz_convert(</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s1">exp_values = (</span>
            <span class="s1">DatetimeIndex(ser.values).tz_localize(</span><span class="s2">&quot;UTC&quot;</span><span class="s1">).tz_convert(</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>
        <span class="s1">expected = Series(exp_values</span><span class="s0">, </span><span class="s1">index=ser.index</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_dt_namespace_accessor_datetime64tz(self):</span>
        <span class="s3"># GH#7207, GH#11128</span>
        <span class="s3"># test .dt namespace accessor</span>

        <span class="s3"># datetimeindex with tz</span>
        <span class="s1">dti = date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s1">ser = Series(dti</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">prop </span><span class="s0">in </span><span class="s1">ok_for_dt:</span>

            <span class="s3"># we test freq below</span>
            <span class="s3"># we ignore week and weekofyear because they are deprecated</span>
            <span class="s0">if </span><span class="s1">prop </span><span class="s0">not in </span><span class="s1">[</span><span class="s2">&quot;freq&quot;</span><span class="s0">, </span><span class="s2">&quot;week&quot;</span><span class="s0">, </span><span class="s2">&quot;weekofyear&quot;</span><span class="s1">]:</span>
                <span class="s1">self._compare(ser</span><span class="s0">, </span><span class="s1">prop)</span>

        <span class="s0">for </span><span class="s1">prop </span><span class="s0">in </span><span class="s1">ok_for_dt_methods:</span>
            <span class="s1">getattr(ser.dt</span><span class="s0">, </span><span class="s1">prop)</span>

        <span class="s1">result = ser.dt.to_pydatetime()</span>
        <span class="s0">assert </span><span class="s1">isinstance(result</span><span class="s0">, </span><span class="s1">np.ndarray)</span>
        <span class="s0">assert </span><span class="s1">result.dtype == object</span>

        <span class="s1">result = ser.dt.tz_convert(</span><span class="s2">&quot;CET&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Series(ser._values.tz_convert(</span><span class="s2">&quot;CET&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=ser.index</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">tz_result = result.dt.tz</span>
        <span class="s0">assert </span><span class="s1">str(tz_result) == </span><span class="s2">&quot;CET&quot;</span>
        <span class="s1">freq_result = ser.dt.freq</span>
        <span class="s0">assert </span><span class="s1">freq_result == DatetimeIndex(ser.values</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;infer&quot;</span><span class="s1">).freq</span>

    <span class="s0">def </span><span class="s1">test_dt_namespace_accessor_timedelta(self):</span>
        <span class="s3"># GH#7207, GH#11128</span>
        <span class="s3"># test .dt namespace accessor</span>

        <span class="s3"># timedelta index</span>
        <span class="s1">cases = [</span>
            <span class="s1">Series(</span>
                <span class="s1">timedelta_range(</span><span class="s2">&quot;1 day&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=list(</span><span class="s2">&quot;abcde&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">Series(timedelta_range(</span><span class="s2">&quot;1 day 01:23:45&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;s&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">Series(</span>
                <span class="s1">timedelta_range(</span><span class="s2">&quot;2 days 01:23:45.012345&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;ms&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span>
        <span class="s0">for </span><span class="s1">ser </span><span class="s0">in </span><span class="s1">cases:</span>
            <span class="s0">for </span><span class="s1">prop </span><span class="s0">in </span><span class="s1">ok_for_td:</span>
                <span class="s3"># we test freq below</span>
                <span class="s0">if </span><span class="s1">prop != </span><span class="s2">&quot;freq&quot;</span><span class="s1">:</span>
                    <span class="s1">self._compare(ser</span><span class="s0">, </span><span class="s1">prop)</span>

            <span class="s0">for </span><span class="s1">prop </span><span class="s0">in </span><span class="s1">ok_for_td_methods:</span>
                <span class="s1">getattr(ser.dt</span><span class="s0">, </span><span class="s1">prop)</span>

            <span class="s1">result = ser.dt.components</span>
            <span class="s0">assert </span><span class="s1">isinstance(result</span><span class="s0">, </span><span class="s1">DataFrame)</span>
            <span class="s1">tm.assert_index_equal(result.index</span><span class="s0">, </span><span class="s1">ser.index)</span>

            <span class="s1">result = ser.dt.to_pytimedelta()</span>
            <span class="s0">assert </span><span class="s1">isinstance(result</span><span class="s0">, </span><span class="s1">np.ndarray)</span>
            <span class="s0">assert </span><span class="s1">result.dtype == object</span>

            <span class="s1">result = ser.dt.total_seconds()</span>
            <span class="s0">assert </span><span class="s1">isinstance(result</span><span class="s0">, </span><span class="s1">Series)</span>
            <span class="s0">assert </span><span class="s1">result.dtype == </span><span class="s2">&quot;float64&quot;</span>

            <span class="s1">freq_result = ser.dt.freq</span>
            <span class="s0">assert </span><span class="s1">freq_result == TimedeltaIndex(ser.values</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;infer&quot;</span><span class="s1">).freq</span>

    <span class="s0">def </span><span class="s1">test_dt_namespace_accessor_period(self):</span>
        <span class="s3"># GH#7207, GH#11128</span>
        <span class="s3"># test .dt namespace accessor</span>

        <span class="s3"># periodindex</span>
        <span class="s1">pi = period_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s1">ser = Series(pi</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s1">)</span>

        <span class="s0">for </span><span class="s1">prop </span><span class="s0">in </span><span class="s1">ok_for_period:</span>
            <span class="s3"># we test freq below</span>
            <span class="s0">if </span><span class="s1">prop != </span><span class="s2">&quot;freq&quot;</span><span class="s1">:</span>
                <span class="s1">self._compare(ser</span><span class="s0">, </span><span class="s1">prop)</span>

        <span class="s0">for </span><span class="s1">prop </span><span class="s0">in </span><span class="s1">ok_for_period_methods:</span>
            <span class="s1">getattr(ser.dt</span><span class="s0">, </span><span class="s1">prop)</span>

        <span class="s1">freq_result = ser.dt.freq</span>
        <span class="s0">assert </span><span class="s1">freq_result == PeriodIndex(ser.values).freq</span>

    <span class="s0">def </span><span class="s1">test_dt_namespace_accessor_index_and_values(self):</span>

        <span class="s3"># both</span>
        <span class="s1">index = date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">3</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s1">dti = date_range(</span><span class="s2">&quot;20140204&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">3</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;s&quot;</span><span class="s1">)</span>
        <span class="s1">ser = Series(dti</span><span class="s0">, </span><span class="s1">index=index</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s1">)</span>
        <span class="s1">exp = Series(</span>
            <span class="s1">np.array([</span><span class="s4">2014</span><span class="s0">, </span><span class="s4">2014</span><span class="s0">, </span><span class="s4">2014</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;int64&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=index</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(ser.dt.year</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s1">exp = Series(np.array([</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;int64&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=index</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(ser.dt.month</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s1">exp = Series(np.array([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;int64&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=index</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(ser.dt.second</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s1">exp = Series([ser[</span><span class="s4">0</span><span class="s1">]] * </span><span class="s4">3</span><span class="s0">, </span><span class="s1">index=index</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(ser.dt.normalize()</span><span class="s0">, </span><span class="s1">exp)</span>

    <span class="s0">def </span><span class="s1">test_dt_accessor_limited_display_api(self):</span>
        <span class="s3"># tznaive</span>
        <span class="s1">ser = Series(date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s1">)</span>
        <span class="s1">results = get_dir(ser)</span>
        <span class="s1">tm.assert_almost_equal(results</span><span class="s0">, </span><span class="s1">sorted(set(ok_for_dt + ok_for_dt_methods)))</span>

        <span class="s3"># tzaware</span>
        <span class="s1">ser = Series(date_range(</span><span class="s2">&quot;2015-01-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2016-01-01&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;T&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s1">)</span>
        <span class="s1">ser = ser.dt.tz_localize(</span><span class="s2">&quot;UTC&quot;</span><span class="s1">).dt.tz_convert(</span><span class="s2">&quot;America/Chicago&quot;</span><span class="s1">)</span>
        <span class="s1">results = get_dir(ser)</span>
        <span class="s1">tm.assert_almost_equal(results</span><span class="s0">, </span><span class="s1">sorted(set(ok_for_dt + ok_for_dt_methods)))</span>

        <span class="s3"># Period</span>
        <span class="s1">ser = Series(</span>
            <span class="s1">period_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s1">).astype(object)</span>
        <span class="s1">)</span>
        <span class="s1">results = get_dir(ser)</span>
        <span class="s1">tm.assert_almost_equal(</span>
            <span class="s1">results</span><span class="s0">, </span><span class="s1">sorted(set(ok_for_period + ok_for_period_methods))</span>
        <span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_dt_accessor_ambiguous_freq_conversions(self):</span>
        <span class="s3"># GH#11295</span>
        <span class="s3"># ambiguous time error on the conversions</span>
        <span class="s1">ser = Series(date_range(</span><span class="s2">&quot;2015-01-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2016-01-01&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;T&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s1">)</span>
        <span class="s1">ser = ser.dt.tz_localize(</span><span class="s2">&quot;UTC&quot;</span><span class="s1">).dt.tz_convert(</span><span class="s2">&quot;America/Chicago&quot;</span><span class="s1">)</span>

        <span class="s1">exp_values = date_range(</span>
            <span class="s2">&quot;2015-01-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2016-01-01&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;T&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;UTC&quot;</span>
        <span class="s1">).tz_convert(</span><span class="s2">&quot;America/Chicago&quot;</span><span class="s1">)</span>
        <span class="s3"># freq not preserved by tz_localize above</span>
        <span class="s1">exp_values = exp_values._with_freq(</span><span class="s0">None</span><span class="s1">)</span>
        <span class="s1">expected = Series(exp_values</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(ser</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_dt_accessor_not_writeable(self):</span>
        <span class="s3"># no setting allowed</span>
        <span class="s1">ser = Series(date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;modifications&quot;</span><span class="s1">):</span>
            <span class="s1">ser.dt.hour = </span><span class="s4">5</span>

        <span class="s3"># trying to set a copy</span>
        <span class="s1">msg = </span><span class="s2">&quot;modifications to a property of a datetimelike.+not supported&quot;</span>
        <span class="s0">with </span><span class="s1">pd.option_context(</span><span class="s2">&quot;chained_assignment&quot;</span><span class="s0">, </span><span class="s2">&quot;raise&quot;</span><span class="s1">):</span>
            <span class="s0">with </span><span class="s1">pytest.raises(com.SettingWithCopyError</span><span class="s0">, </span><span class="s1">match=msg):</span>
                <span class="s1">ser.dt.hour[</span><span class="s4">0</span><span class="s1">] = </span><span class="s4">5</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;method, dates&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">[</span><span class="s2">&quot;round&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;2012-01-02&quot;</span><span class="s0">, </span><span class="s2">&quot;2012-01-02&quot;</span><span class="s0">, </span><span class="s2">&quot;2012-01-01&quot;</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s2">&quot;floor&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;2012-01-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2012-01-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2012-01-01&quot;</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s2">&quot;ceil&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;2012-01-02&quot;</span><span class="s0">, </span><span class="s2">&quot;2012-01-02&quot;</span><span class="s0">, </span><span class="s2">&quot;2012-01-02&quot;</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_dt_round(self</span><span class="s0">, </span><span class="s1">method</span><span class="s0">, </span><span class="s1">dates):</span>
        <span class="s3"># round</span>
        <span class="s1">ser = Series(</span>
            <span class="s1">pd.to_datetime(</span>
                <span class="s1">[</span><span class="s2">&quot;2012-01-01 13:00:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2012-01-01 12:01:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2012-01-01 08:00:00&quot;</span><span class="s1">]</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">result = getattr(ser.dt</span><span class="s0">, </span><span class="s1">method)(</span><span class="s2">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Series(pd.to_datetime(dates)</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_dt_round_tz(self):</span>
        <span class="s1">ser = Series(</span>
            <span class="s1">pd.to_datetime(</span>
                <span class="s1">[</span><span class="s2">&quot;2012-01-01 13:00:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2012-01-01 12:01:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2012-01-01 08:00:00&quot;</span><span class="s1">]</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">result = ser.dt.tz_localize(</span><span class="s2">&quot;UTC&quot;</span><span class="s1">).dt.tz_convert(</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">).dt.round(</span><span class="s2">&quot;D&quot;</span><span class="s1">)</span>

        <span class="s1">exp_values = pd.to_datetime(</span>
            <span class="s1">[</span><span class="s2">&quot;2012-01-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2012-01-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2012-01-01&quot;</span><span class="s1">]</span>
        <span class="s1">).tz_localize(</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Series(exp_values</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;xxx&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;method&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;ceil&quot;</span><span class="s0">, </span><span class="s2">&quot;round&quot;</span><span class="s0">, </span><span class="s2">&quot;floor&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_dt_round_tz_ambiguous(self</span><span class="s0">, </span><span class="s1">method):</span>
        <span class="s3"># GH 18946 round near &quot;fall back&quot; DST</span>
        <span class="s1">df1 = DataFrame(</span>
            <span class="s1">[</span>
                <span class="s1">pd.to_datetime(</span><span class="s2">&quot;2017-10-29 02:00:00+02:00&quot;</span><span class="s0">, </span><span class="s1">utc=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">pd.to_datetime(</span><span class="s2">&quot;2017-10-29 02:00:00+01:00&quot;</span><span class="s0">, </span><span class="s1">utc=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">pd.to_datetime(</span><span class="s2">&quot;2017-10-29 03:00:00+01:00&quot;</span><span class="s0">, </span><span class="s1">utc=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s2">&quot;date&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">df1[</span><span class="s2">&quot;date&quot;</span><span class="s1">] = df1[</span><span class="s2">&quot;date&quot;</span><span class="s1">].dt.tz_convert(</span><span class="s2">&quot;Europe/Madrid&quot;</span><span class="s1">)</span>
        <span class="s3"># infer</span>
        <span class="s1">result = getattr(df1.date.dt</span><span class="s0">, </span><span class="s1">method)(</span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s1">ambiguous=</span><span class="s2">&quot;infer&quot;</span><span class="s1">)</span>
        <span class="s1">expected = df1[</span><span class="s2">&quot;date&quot;</span><span class="s1">]</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s3"># bool-array</span>
        <span class="s1">result = getattr(df1.date.dt</span><span class="s0">, </span><span class="s1">method)(</span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s1">ambiguous=[</span><span class="s0">True, False, False</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s3"># NaT</span>
        <span class="s1">result = getattr(df1.date.dt</span><span class="s0">, </span><span class="s1">method)(</span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s1">ambiguous=</span><span class="s2">&quot;NaT&quot;</span><span class="s1">)</span>
        <span class="s1">expected = df1[</span><span class="s2">&quot;date&quot;</span><span class="s1">].copy()</span>
        <span class="s1">expected.iloc[</span><span class="s4">0</span><span class="s1">:</span><span class="s4">2</span><span class="s1">] = pd.NaT</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s3"># raise</span>
        <span class="s0">with </span><span class="s1">tm.external_error_raised(pytz.AmbiguousTimeError):</span>
            <span class="s1">getattr(df1.date.dt</span><span class="s0">, </span><span class="s1">method)(</span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s1">ambiguous=</span><span class="s2">&quot;raise&quot;</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;method, ts_str, freq&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">[</span><span class="s2">&quot;ceil&quot;</span><span class="s0">, </span><span class="s2">&quot;2018-03-11 01:59:00-0600&quot;</span><span class="s0">, </span><span class="s2">&quot;5min&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s2">&quot;round&quot;</span><span class="s0">, </span><span class="s2">&quot;2018-03-11 01:59:00-0600&quot;</span><span class="s0">, </span><span class="s2">&quot;5min&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s2">&quot;floor&quot;</span><span class="s0">, </span><span class="s2">&quot;2018-03-11 03:01:00-0500&quot;</span><span class="s0">, </span><span class="s2">&quot;2H&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_dt_round_tz_nonexistent(self</span><span class="s0">, </span><span class="s1">method</span><span class="s0">, </span><span class="s1">ts_str</span><span class="s0">, </span><span class="s1">freq):</span>
        <span class="s3"># GH 23324 round near &quot;spring forward&quot; DST</span>
        <span class="s1">ser = Series([pd.Timestamp(ts_str</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;America/Chicago&quot;</span><span class="s1">)])</span>
        <span class="s1">result = getattr(ser.dt</span><span class="s0">, </span><span class="s1">method)(freq</span><span class="s0">, </span><span class="s1">nonexistent=</span><span class="s2">&quot;shift_forward&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Series([pd.Timestamp(</span><span class="s2">&quot;2018-03-11 03:00:00&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;America/Chicago&quot;</span><span class="s1">)])</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">result = getattr(ser.dt</span><span class="s0">, </span><span class="s1">method)(freq</span><span class="s0">, </span><span class="s1">nonexistent=</span><span class="s2">&quot;NaT&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Series([pd.NaT]).dt.tz_localize(result.dt.tz)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s0">with </span><span class="s1">pytest.raises(pytz.NonExistentTimeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;2018-03-11 02:00:00&quot;</span><span class="s1">):</span>
            <span class="s1">getattr(ser.dt</span><span class="s0">, </span><span class="s1">method)(freq</span><span class="s0">, </span><span class="s1">nonexistent=</span><span class="s2">&quot;raise&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_dt_namespace_accessor_categorical(self):</span>
        <span class="s3"># GH 19468</span>
        <span class="s1">dti = DatetimeIndex([</span><span class="s2">&quot;20171111&quot;</span><span class="s0">, </span><span class="s2">&quot;20181212&quot;</span><span class="s1">]).repeat(</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">ser = Series(pd.Categorical(dti)</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;foo&quot;</span><span class="s1">)</span>
        <span class="s1">result = ser.dt.year</span>
        <span class="s1">expected = Series([</span><span class="s4">2017</span><span class="s0">, </span><span class="s4">2017</span><span class="s0">, </span><span class="s4">2018</span><span class="s0">, </span><span class="s4">2018</span><span class="s1">]</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;foo&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_dt_tz_localize_categorical(self</span><span class="s0">, </span><span class="s1">tz_aware_fixture):</span>
        <span class="s3"># GH 27952</span>
        <span class="s1">tz = tz_aware_fixture</span>
        <span class="s1">datetimes = Series(</span>
            <span class="s1">[</span><span class="s2">&quot;2019-01-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2019-01-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2019-01-02&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;datetime64[ns]&quot;</span>
        <span class="s1">)</span>
        <span class="s1">categorical = datetimes.astype(</span><span class="s2">&quot;category&quot;</span><span class="s1">)</span>
        <span class="s1">result = categorical.dt.tz_localize(tz)</span>
        <span class="s1">expected = datetimes.dt.tz_localize(tz)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_dt_tz_convert_categorical(self</span><span class="s0">, </span><span class="s1">tz_aware_fixture):</span>
        <span class="s3"># GH 27952</span>
        <span class="s1">tz = tz_aware_fixture</span>
        <span class="s1">datetimes = Series(</span>
            <span class="s1">[</span><span class="s2">&quot;2019-01-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2019-01-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2019-01-02&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;datetime64[ns, MET]&quot;</span>
        <span class="s1">)</span>
        <span class="s1">categorical = datetimes.astype(</span><span class="s2">&quot;category&quot;</span><span class="s1">)</span>
        <span class="s1">result = categorical.dt.tz_convert(tz)</span>
        <span class="s1">expected = datetimes.dt.tz_convert(tz)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;accessor&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;year&quot;</span><span class="s0">, </span><span class="s2">&quot;month&quot;</span><span class="s0">, </span><span class="s2">&quot;day&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_dt_other_accessors_categorical(self</span><span class="s0">, </span><span class="s1">accessor):</span>
        <span class="s3"># GH 27952</span>
        <span class="s1">datetimes = Series(</span>
            <span class="s1">[</span><span class="s2">&quot;2018-01-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2018-01-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2019-01-02&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;datetime64[ns]&quot;</span>
        <span class="s1">)</span>
        <span class="s1">categorical = datetimes.astype(</span><span class="s2">&quot;category&quot;</span><span class="s1">)</span>
        <span class="s1">result = getattr(categorical.dt</span><span class="s0">, </span><span class="s1">accessor)</span>
        <span class="s1">expected = getattr(datetimes.dt</span><span class="s0">, </span><span class="s1">accessor)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_dt_accessor_no_new_attributes(self):</span>
        <span class="s3"># https://github.com/pandas-dev/pandas/issues/10673</span>
        <span class="s1">ser = Series(date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">))</span>
        <span class="s0">with </span><span class="s1">pytest.raises(AttributeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;You cannot add any new attribute&quot;</span><span class="s1">):</span>
            <span class="s1">ser.dt.xlabel = </span><span class="s2">&quot;a&quot;</span>

    <span class="s3"># error: Unsupported operand types for + (&quot;List[None]&quot; and &quot;List[str]&quot;)</span>
    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;time_locale&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None</span><span class="s1">] + (tm.get_locales() </span><span class="s0">or </span><span class="s1">[])  </span><span class="s3"># type: ignore[operator]</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_dt_accessor_datetime_name_accessors(self</span><span class="s0">, </span><span class="s1">time_locale):</span>
        <span class="s3"># Test Monday -&gt; Sunday and January -&gt; December, in that sequence</span>
        <span class="s0">if </span><span class="s1">time_locale </span><span class="s0">is None</span><span class="s1">:</span>
            <span class="s3"># If the time_locale is None, day-name and month_name should</span>
            <span class="s3"># return the english attributes</span>
            <span class="s1">expected_days = [</span>
                <span class="s2">&quot;Monday&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;Tuesday&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;Wednesday&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;Thursday&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;Friday&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;Saturday&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;Sunday&quot;</span><span class="s0">,</span>
            <span class="s1">]</span>
            <span class="s1">expected_months = [</span>
                <span class="s2">&quot;January&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;February&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;March&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;April&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;May&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;June&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;July&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;August&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;September&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;October&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;November&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;December&quot;</span><span class="s0">,</span>
            <span class="s1">]</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">with </span><span class="s1">tm.set_locale(time_locale</span><span class="s0">, </span><span class="s1">locale.LC_TIME):</span>
                <span class="s1">expected_days = calendar.day_name[:]</span>
                <span class="s1">expected_months = calendar.month_name[</span><span class="s4">1</span><span class="s1">:]</span>

        <span class="s1">ser = Series(date_range(freq=</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">start=datetime(</span><span class="s4">1998</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">365</span><span class="s1">))</span>
        <span class="s1">english_days = [</span>
            <span class="s2">&quot;Monday&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;Tuesday&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;Wednesday&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;Thursday&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;Friday&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;Saturday&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;Sunday&quot;</span><span class="s0">,</span>
        <span class="s1">]</span>
        <span class="s0">for </span><span class="s1">day</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">eng_name </span><span class="s0">in </span><span class="s1">zip(range(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">11</span><span class="s1">)</span><span class="s0">, </span><span class="s1">expected_days</span><span class="s0">, </span><span class="s1">english_days):</span>
            <span class="s1">name = name.capitalize()</span>
            <span class="s0">assert </span><span class="s1">ser.dt.day_name(locale=time_locale)[day] == name</span>
            <span class="s0">assert </span><span class="s1">ser.dt.day_name(locale=</span><span class="s0">None</span><span class="s1">)[day] == eng_name</span>
        <span class="s1">ser = pd.concat([ser</span><span class="s0">, </span><span class="s1">Series([pd.NaT])])</span>
        <span class="s0">assert </span><span class="s1">np.isnan(ser.dt.day_name(locale=time_locale).iloc[-</span><span class="s4">1</span><span class="s1">])</span>

        <span class="s1">ser = Series(date_range(freq=</span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s1">start=</span><span class="s2">&quot;2012&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;2013&quot;</span><span class="s1">))</span>
        <span class="s1">result = ser.dt.month_name(locale=time_locale)</span>
        <span class="s1">expected = Series([month.capitalize() </span><span class="s0">for </span><span class="s1">month </span><span class="s0">in </span><span class="s1">expected_months])</span>

        <span class="s3"># work around https://github.com/pandas-dev/pandas/issues/22342</span>
        <span class="s1">result = result.str.normalize(</span><span class="s2">&quot;NFD&quot;</span><span class="s1">)</span>
        <span class="s1">expected = expected.str.normalize(</span><span class="s2">&quot;NFD&quot;</span><span class="s1">)</span>

        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s0">for </span><span class="s1">s_date</span><span class="s0">, </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">zip(ser</span><span class="s0">, </span><span class="s1">expected_months):</span>
            <span class="s1">result = s_date.month_name(locale=time_locale)</span>
            <span class="s1">expected = expected.capitalize()</span>

            <span class="s1">result = unicodedata.normalize(</span><span class="s2">&quot;NFD&quot;</span><span class="s0">, </span><span class="s1">result)</span>
            <span class="s1">expected = unicodedata.normalize(</span><span class="s2">&quot;NFD&quot;</span><span class="s0">, </span><span class="s1">expected)</span>

            <span class="s0">assert </span><span class="s1">result == expected</span>

        <span class="s1">ser = pd.concat([ser</span><span class="s0">, </span><span class="s1">Series([pd.NaT])])</span>
        <span class="s0">assert </span><span class="s1">np.isnan(ser.dt.month_name(locale=time_locale).iloc[-</span><span class="s4">1</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_strftime(self):</span>
        <span class="s3"># GH 10086</span>
        <span class="s1">ser = Series(date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s1">))</span>
        <span class="s1">result = ser.dt.strftime(</span><span class="s2">&quot;%Y/%m/%d&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Series(</span>
            <span class="s1">[</span><span class="s2">&quot;2013/01/01&quot;</span><span class="s0">, </span><span class="s2">&quot;2013/01/02&quot;</span><span class="s0">, </span><span class="s2">&quot;2013/01/03&quot;</span><span class="s0">, </span><span class="s2">&quot;2013/01/04&quot;</span><span class="s0">, </span><span class="s2">&quot;2013/01/05&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">ser = Series(date_range(</span><span class="s2">&quot;2015-02-03 11:22:33.4567&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s1">))</span>
        <span class="s1">result = ser.dt.strftime(</span><span class="s2">&quot;%Y/%m/%d %H-%M-%S&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Series(</span>
            <span class="s1">[</span>
                <span class="s2">&quot;2015/02/03 11-22-33&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;2015/02/04 11-22-33&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;2015/02/05 11-22-33&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;2015/02/06 11-22-33&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;2015/02/07 11-22-33&quot;</span><span class="s0">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">ser = Series(period_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s1">))</span>
        <span class="s1">result = ser.dt.strftime(</span><span class="s2">&quot;%Y/%m/%d&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Series(</span>
            <span class="s1">[</span><span class="s2">&quot;2013/01/01&quot;</span><span class="s0">, </span><span class="s2">&quot;2013/01/02&quot;</span><span class="s0">, </span><span class="s2">&quot;2013/01/03&quot;</span><span class="s0">, </span><span class="s2">&quot;2013/01/04&quot;</span><span class="s0">, </span><span class="s2">&quot;2013/01/05&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">ser = Series(period_range(</span><span class="s2">&quot;2015-02-03 11:22:33.4567&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;s&quot;</span><span class="s1">))</span>
        <span class="s1">result = ser.dt.strftime(</span><span class="s2">&quot;%Y/%m/%d %H-%M-%S&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Series(</span>
            <span class="s1">[</span>
                <span class="s2">&quot;2015/02/03 11-22-33&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;2015/02/03 11-22-34&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;2015/02/03 11-22-35&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;2015/02/03 11-22-36&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;2015/02/03 11-22-37&quot;</span><span class="s0">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_strftime_dt64_days(self):</span>
        <span class="s1">ser = Series(date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s1">))</span>
        <span class="s1">ser.iloc[</span><span class="s4">0</span><span class="s1">] = pd.NaT</span>
        <span class="s1">result = ser.dt.strftime(</span><span class="s2">&quot;%Y/%m/%d&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Series(</span>
            <span class="s1">[np.nan</span><span class="s0">, </span><span class="s2">&quot;2013/01/02&quot;</span><span class="s0">, </span><span class="s2">&quot;2013/01/03&quot;</span><span class="s0">, </span><span class="s2">&quot;2013/01/04&quot;</span><span class="s0">, </span><span class="s2">&quot;2013/01/05&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">datetime_index = date_range(</span><span class="s2">&quot;20150301&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">result = datetime_index.strftime(</span><span class="s2">&quot;%Y/%m/%d&quot;</span><span class="s1">)</span>

        <span class="s1">expected = Index(</span>
            <span class="s1">[</span><span class="s2">&quot;2015/03/01&quot;</span><span class="s0">, </span><span class="s2">&quot;2015/03/02&quot;</span><span class="s0">, </span><span class="s2">&quot;2015/03/03&quot;</span><span class="s0">, </span><span class="s2">&quot;2015/03/04&quot;</span><span class="s0">, </span><span class="s2">&quot;2015/03/05&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">dtype=np.object_</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s3"># dtype may be S10 or U10 depending on python version</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_strftime_period_days(self):</span>
        <span class="s1">period_index = period_range(</span><span class="s2">&quot;20150301&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">result = period_index.strftime(</span><span class="s2">&quot;%Y/%m/%d&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Index(</span>
            <span class="s1">[</span><span class="s2">&quot;2015/03/01&quot;</span><span class="s0">, </span><span class="s2">&quot;2015/03/02&quot;</span><span class="s0">, </span><span class="s2">&quot;2015/03/03&quot;</span><span class="s0">, </span><span class="s2">&quot;2015/03/04&quot;</span><span class="s0">, </span><span class="s2">&quot;2015/03/05&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">dtype=</span><span class="s2">&quot;=U10&quot;</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_strftime_dt64_microsecond_resolution(self):</span>
        <span class="s1">ser = Series([datetime(</span><span class="s4">2013</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">32</span><span class="s0">, </span><span class="s4">59</span><span class="s1">)</span><span class="s0">, </span><span class="s1">datetime(</span><span class="s4">2013</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">14</span><span class="s0">, </span><span class="s4">32</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)])</span>
        <span class="s1">result = ser.dt.strftime(</span><span class="s2">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Series([</span><span class="s2">&quot;2013-01-01 02:32:59&quot;</span><span class="s0">, </span><span class="s2">&quot;2013-01-02 14:32:01&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_strftime_period_hours(self):</span>
        <span class="s1">ser = Series(period_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;H&quot;</span><span class="s1">))</span>
        <span class="s1">result = ser.dt.strftime(</span><span class="s2">&quot;%Y/%m/%d %H:%M:%S&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Series(</span>
            <span class="s1">[</span>
                <span class="s2">&quot;2013/01/01 00:00:00&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;2013/01/01 01:00:00&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;2013/01/01 02:00:00&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;2013/01/01 03:00:00&quot;</span><span class="s0">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_strftime_period_minutes(self):</span>
        <span class="s1">ser = Series(period_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;L&quot;</span><span class="s1">))</span>
        <span class="s1">result = ser.dt.strftime(</span><span class="s2">&quot;%Y/%m/%d %H:%M:%S.%l&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Series(</span>
            <span class="s1">[</span>
                <span class="s2">&quot;2013/01/01 00:00:00.000&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;2013/01/01 00:00:00.001&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;2013/01/01 00:00:00.002&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;2013/01/01 00:00:00.003&quot;</span><span class="s0">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;data&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">DatetimeIndex([</span><span class="s2">&quot;2019-01-01&quot;</span><span class="s0">, </span><span class="s1">pd.NaT])</span><span class="s0">,</span>
            <span class="s1">PeriodIndex([</span><span class="s2">&quot;2019-01-01&quot;</span><span class="s0">, </span><span class="s1">pd.NaT]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;period[D]&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_strftime_nat(self</span><span class="s0">, </span><span class="s1">data):</span>
        <span class="s3"># GH 29578</span>
        <span class="s1">ser = Series(data)</span>
        <span class="s1">result = ser.dt.strftime(</span><span class="s2">&quot;%Y-%m-%d&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Series([</span><span class="s2">&quot;2019-01-01&quot;</span><span class="s0">, </span><span class="s1">np.nan])</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_valid_dt_with_missing_values(self):</span>

        <span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">(</span>
            <span class="s1">date</span><span class="s0">,</span>
            <span class="s1">time</span><span class="s0">,</span>
        <span class="s1">)</span>

        <span class="s3"># GH 8689</span>
        <span class="s1">ser = Series(date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">))</span>
        <span class="s1">ser.iloc[</span><span class="s4">2</span><span class="s1">] = pd.NaT</span>

        <span class="s0">for </span><span class="s1">attr </span><span class="s0">in </span><span class="s1">[</span><span class="s2">&quot;microsecond&quot;</span><span class="s0">, </span><span class="s2">&quot;nanosecond&quot;</span><span class="s0">, </span><span class="s2">&quot;second&quot;</span><span class="s0">, </span><span class="s2">&quot;minute&quot;</span><span class="s0">, </span><span class="s2">&quot;hour&quot;</span><span class="s0">, </span><span class="s2">&quot;day&quot;</span><span class="s1">]:</span>
            <span class="s1">expected = getattr(ser.dt</span><span class="s0">, </span><span class="s1">attr).copy()</span>
            <span class="s1">expected.iloc[</span><span class="s4">2</span><span class="s1">] = np.nan</span>
            <span class="s1">result = getattr(ser.dt</span><span class="s0">, </span><span class="s1">attr)</span>
            <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">result = ser.dt.date</span>
        <span class="s1">expected = Series(</span>
            <span class="s1">[</span>
                <span class="s1">date(</span><span class="s4">2013</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">date(</span><span class="s4">2013</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">np.nan</span><span class="s0">,</span>
                <span class="s1">date(</span><span class="s4">2013</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">date(</span><span class="s4">2013</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">dtype=</span><span class="s2">&quot;object&quot;</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">result = ser.dt.time</span>
        <span class="s1">expected = Series([time(</span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">time(</span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">time(</span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">time(</span><span class="s4">0</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;object&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_dt_accessor_api(self):</span>
        <span class="s3"># GH 9322</span>
        <span class="s0">from </span><span class="s1">pandas.core.indexes.accessors </span><span class="s0">import </span><span class="s1">(</span>
            <span class="s1">CombinedDatetimelikeProperties</span><span class="s0">,</span>
            <span class="s1">DatetimeProperties</span><span class="s0">,</span>
        <span class="s1">)</span>

        <span class="s0">assert </span><span class="s1">Series.dt </span><span class="s0">is </span><span class="s1">CombinedDatetimelikeProperties</span>

        <span class="s1">ser = Series(date_range(</span><span class="s2">&quot;2000-01-01&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">3</span><span class="s1">))</span>
        <span class="s0">assert </span><span class="s1">isinstance(ser.dt</span><span class="s0">, </span><span class="s1">DatetimeProperties)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;ser&quot;</span><span class="s0">, </span><span class="s1">[Series(np.arange(</span><span class="s4">5</span><span class="s1">))</span><span class="s0">, </span><span class="s1">Series(list(</span><span class="s2">&quot;abcde&quot;</span><span class="s1">))</span><span class="s0">, </span><span class="s1">Series(np.random.randn(</span><span class="s4">5</span><span class="s1">))]</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_dt_accessor_invalid(self</span><span class="s0">, </span><span class="s1">ser):</span>
        <span class="s3"># GH#9322 check that series with incorrect dtypes don't have attr</span>
        <span class="s0">with </span><span class="s1">pytest.raises(AttributeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;only use .dt accessor&quot;</span><span class="s1">):</span>
            <span class="s1">ser.dt</span>
        <span class="s0">assert not </span><span class="s1">hasattr(ser</span><span class="s0">, </span><span class="s2">&quot;dt&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_dt_accessor_updates_on_inplace(self):</span>
        <span class="s1">ser = Series(date_range(</span><span class="s2">&quot;2018-01-01&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">10</span><span class="s1">))</span>
        <span class="s1">ser[</span><span class="s4">2</span><span class="s1">] = </span><span class="s0">None</span>
        <span class="s1">return_value = ser.fillna(pd.Timestamp(</span><span class="s2">&quot;2018-01-01&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">inplace=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">return_value </span><span class="s0">is None</span>
        <span class="s1">result = ser.dt.date</span>
        <span class="s0">assert </span><span class="s1">result[</span><span class="s4">0</span><span class="s1">] == result[</span><span class="s4">2</span><span class="s1">]</span>

    <span class="s0">def </span><span class="s1">test_date_tz(self):</span>
        <span class="s3"># GH11757</span>
        <span class="s1">rng = DatetimeIndex(</span>
            <span class="s1">[</span><span class="s2">&quot;2014-04-04 23:56&quot;</span><span class="s0">, </span><span class="s2">&quot;2014-07-18 21:24&quot;</span><span class="s0">, </span><span class="s2">&quot;2015-11-22 22:14&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">tz=</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">ser = Series(rng)</span>
        <span class="s1">expected = Series([date(</span><span class="s4">2014</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">date(</span><span class="s4">2014</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">18</span><span class="s1">)</span><span class="s0">, </span><span class="s1">date(</span><span class="s4">2015</span><span class="s0">, </span><span class="s4">11</span><span class="s0">, </span><span class="s4">22</span><span class="s1">)])</span>
        <span class="s1">tm.assert_series_equal(ser.dt.date</span><span class="s0">, </span><span class="s1">expected)</span>
        <span class="s1">tm.assert_series_equal(ser.apply(</span><span class="s0">lambda </span><span class="s1">x: x.date())</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_dt_timetz_accessor(self</span><span class="s0">, </span><span class="s1">tz_naive_fixture):</span>
        <span class="s3"># GH21358</span>
        <span class="s1">tz = maybe_get_tz(tz_naive_fixture)</span>

        <span class="s1">dtindex = DatetimeIndex(</span>
            <span class="s1">[</span><span class="s2">&quot;2014-04-04 23:56&quot;</span><span class="s0">, </span><span class="s2">&quot;2014-07-18 21:24&quot;</span><span class="s0">, </span><span class="s2">&quot;2015-11-22 22:14&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tz=tz</span>
        <span class="s1">)</span>
        <span class="s1">ser = Series(dtindex)</span>
        <span class="s1">expected = Series(</span>
            <span class="s1">[time(</span><span class="s4">23</span><span class="s0">, </span><span class="s4">56</span><span class="s0">, </span><span class="s1">tzinfo=tz)</span><span class="s0">, </span><span class="s1">time(</span><span class="s4">21</span><span class="s0">, </span><span class="s4">24</span><span class="s0">, </span><span class="s1">tzinfo=tz)</span><span class="s0">, </span><span class="s1">time(</span><span class="s4">22</span><span class="s0">, </span><span class="s4">14</span><span class="s0">, </span><span class="s1">tzinfo=tz)]</span>
        <span class="s1">)</span>
        <span class="s1">result = ser.dt.timetz</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;input_series, expected_output&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">[[</span><span class="s2">&quot;2020-01-01&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">2020</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]]]</span><span class="s0">,</span>
            <span class="s1">[[pd.NaT]</span><span class="s0">, </span><span class="s1">[[np.NaN</span><span class="s0">, </span><span class="s1">np.NaN</span><span class="s0">, </span><span class="s1">np.NaN]]]</span><span class="s0">,</span>
            <span class="s1">[[</span><span class="s2">&quot;2019-12-31&quot;</span><span class="s0">, </span><span class="s2">&quot;2019-12-29&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">2020</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2019</span><span class="s0">, </span><span class="s4">52</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]]]</span><span class="s0">,</span>
            <span class="s1">[[</span><span class="s2">&quot;2010-01-01&quot;</span><span class="s0">, </span><span class="s1">pd.NaT]</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">2009</span><span class="s0">, </span><span class="s4">53</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[np.NaN</span><span class="s0">, </span><span class="s1">np.NaN</span><span class="s0">, </span><span class="s1">np.NaN]]]</span><span class="s0">,</span>
            <span class="s3"># see GH#36032</span>
            <span class="s1">[[</span><span class="s2">&quot;2016-01-08&quot;</span><span class="s0">, </span><span class="s2">&quot;2016-01-04&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">2016</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2016</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]]]</span><span class="s0">,</span>
            <span class="s1">[[</span><span class="s2">&quot;2016-01-07&quot;</span><span class="s0">, </span><span class="s2">&quot;2016-01-01&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">2016</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2015</span><span class="s0">, </span><span class="s4">53</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]]]</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">@pytest.mark.filterwarnings(</span><span class="s2">&quot;ignore:Inferring datetime64:FutureWarning&quot;</span><span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_isocalendar(self</span><span class="s0">, </span><span class="s1">input_series</span><span class="s0">, </span><span class="s1">expected_output):</span>
        <span class="s1">result = pd.to_datetime(Series(input_series)).dt.isocalendar()</span>
        <span class="s1">expected_frame = DataFrame(</span>
            <span class="s1">expected_output</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s2">&quot;year&quot;</span><span class="s0">, </span><span class="s2">&quot;week&quot;</span><span class="s0">, </span><span class="s2">&quot;day&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;UInt32&quot;</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected_frame)</span>

    <span class="s0">def </span><span class="s1">test_hour_index(self):</span>
        <span class="s1">dt_series = Series(</span>
            <span class="s1">date_range(start=</span><span class="s2">&quot;2021-01-01&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;h&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">index=[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">11</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">dtype=</span><span class="s2">&quot;category&quot;</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">result = dt_series.dt.hour</span>
        <span class="s1">expected = Series(</span>
            <span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">index=[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">11</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">class </span><span class="s1">TestSeriesPeriodValuesDtAccessor:</span>
    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;input_vals&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">[Period(</span><span class="s2">&quot;2016-01&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">Period(</span><span class="s2">&quot;2016-02&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">[Period(</span><span class="s2">&quot;2016-01-01&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">Period(</span><span class="s2">&quot;2016-01-02&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">[</span>
                <span class="s1">Period(</span><span class="s2">&quot;2016-01-01 00:00:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;H&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">Period(</span><span class="s2">&quot;2016-01-01 01:00:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;H&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span>
                <span class="s1">Period(</span><span class="s2">&quot;2016-01-01 00:00:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">Period(</span><span class="s2">&quot;2016-01-01 00:01:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span>
                <span class="s1">Period(</span><span class="s2">&quot;2016-01-01 00:00:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;S&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">Period(</span><span class="s2">&quot;2016-01-01 00:00:01&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;S&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_end_time_timevalues(self</span><span class="s0">, </span><span class="s1">input_vals):</span>
        <span class="s3"># GH#17157</span>
        <span class="s3"># Check that the time part of the Period is adjusted by end_time</span>
        <span class="s3"># when using the dt accessor on a Series</span>
        <span class="s1">input_vals = PeriodArray._from_sequence(np.asarray(input_vals))</span>

        <span class="s1">ser = Series(input_vals)</span>
        <span class="s1">result = ser.dt.end_time</span>
        <span class="s1">expected = ser.apply(</span><span class="s0">lambda </span><span class="s1">x: x.end_time)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;input_vals&quot;</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">&quot;2001&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;NaT&quot;</span><span class="s1">)])</span>
    <span class="s0">def </span><span class="s1">test_to_period(self</span><span class="s0">, </span><span class="s1">input_vals):</span>
        <span class="s3"># GH#21205</span>
        <span class="s1">expected = Series([input_vals]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;Period[D]&quot;</span><span class="s1">)</span>
        <span class="s1">result = Series([input_vals]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="s1">).dt.to_period(</span><span class="s2">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_week_and_weekofyear_are_deprecated():</span>
    <span class="s3"># GH#33595 Deprecate week and weekofyear</span>
    <span class="s1">series = pd.to_datetime(Series([</span><span class="s2">&quot;2020-01-01&quot;</span><span class="s1">]))</span>
    <span class="s0">with </span><span class="s1">tm.assert_produces_warning(FutureWarning):</span>
        <span class="s1">series.dt.week</span>
    <span class="s0">with </span><span class="s1">tm.assert_produces_warning(FutureWarning):</span>
        <span class="s1">series.dt.weekofyear</span>


<span class="s0">def </span><span class="s1">test_normalize_pre_epoch_dates():</span>
    <span class="s3"># GH: 36294</span>
    <span class="s1">ser = pd.to_datetime(Series([</span><span class="s2">&quot;1969-01-01 09:00:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2016-01-01 09:00:00&quot;</span><span class="s1">]))</span>
    <span class="s1">result = ser.dt.normalize()</span>
    <span class="s1">expected = pd.to_datetime(Series([</span><span class="s2">&quot;1969-01-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2016-01-01&quot;</span><span class="s1">]))</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
</pre>
</body>
</html>