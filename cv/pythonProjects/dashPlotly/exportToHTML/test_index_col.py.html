<html>
<head>
<title>test_index_col.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #808080;}
.s4 { color: #6a8759;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_index_col.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Tests that the specified index column (a.k.a &quot;index_col&quot;) 
is properly handled or inferred during parsing for all of 
the parsers defined in parsers.py 
&quot;&quot;&quot;</span>
<span class="s2">from </span><span class="s1">io </span><span class="s2">import </span><span class="s1">StringIO</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">import </span><span class="s1">pytest</span>

<span class="s2">from </span><span class="s1">pandas </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">DataFrame</span><span class="s2">,</span>
    <span class="s1">Index</span><span class="s2">,</span>
    <span class="s1">MultiIndex</span><span class="s2">,</span>
<span class="s1">)</span>
<span class="s2">import </span><span class="s1">pandas._testing </span><span class="s2">as </span><span class="s1">tm</span>

<span class="s3"># TODO(1.4): Change me to xfails at release time</span>
<span class="s1">skip_pyarrow = pytest.mark.usefixtures(</span><span class="s4">&quot;pyarrow_skip&quot;</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;with_header&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s2">True, False</span><span class="s1">])</span>
<span class="s2">def </span><span class="s1">test_index_col_named(all_parsers</span><span class="s2">, </span><span class="s1">with_header):</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">no_header = </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
</span><span class="s4">KORD1,19990127, 19:00:00, 18:56:00, 0.8100, 2.8100, 7.2000, 0.0000, 280.0000 
KORD2,19990127, 20:00:00, 19:56:00, 0.0100, 2.2100, 7.2000, 0.0000, 260.0000 
KORD3,19990127, 21:00:00, 20:56:00, -0.5900, 2.2100, 5.7000, 0.0000, 280.0000 
KORD4,19990127, 21:00:00, 21:18:00, -0.9900, 2.0100, 3.6000, 0.0000, 270.0000 
KORD5,19990127, 22:00:00, 21:56:00, -0.5900, 1.7100, 5.1000, 0.0000, 290.0000 
KORD6,19990127, 23:00:00, 22:56:00, -0.5900, 1.7100, 4.6000, 0.0000, 280.0000&quot;&quot;&quot;</span>
    <span class="s1">header = </span><span class="s4">&quot;ID,date,NominalTime,ActualTime,TDew,TAir,Windspeed,Precip,WindDir</span><span class="s2">\n</span><span class="s4">&quot;</span>

    <span class="s2">if </span><span class="s1">with_header:</span>
        <span class="s1">data = header + no_header</span>

        <span class="s1">result = parser.read_csv(StringIO(data)</span><span class="s2">, </span><span class="s1">index_col=</span><span class="s4">&quot;ID&quot;</span><span class="s1">)</span>
        <span class="s1">expected = parser.read_csv(StringIO(data)</span><span class="s2">, </span><span class="s1">header=</span><span class="s5">0</span><span class="s1">).set_index(</span><span class="s4">&quot;ID&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
    <span class="s2">else</span><span class="s1">:</span>
        <span class="s1">data = no_header</span>
        <span class="s1">msg = </span><span class="s4">&quot;Index ID invalid&quot;</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
            <span class="s1">parser.read_csv(StringIO(data)</span><span class="s2">, </span><span class="s1">index_col=</span><span class="s4">&quot;ID&quot;</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_index_col_named2(all_parsers):</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">data = </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
</span><span class="s4">1,2,3,4,hello 
5,6,7,8,world 
9,10,11,12,foo 
&quot;&quot;&quot;</span>

    <span class="s1">expected = DataFrame(</span>
        <span class="s1">{</span><span class="s4">&quot;a&quot;</span><span class="s1">: [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">9</span><span class="s1">]</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s1">: [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">10</span><span class="s1">]</span><span class="s2">, </span><span class="s4">&quot;c&quot;</span><span class="s1">: [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">11</span><span class="s1">]</span><span class="s2">, </span><span class="s4">&quot;d&quot;</span><span class="s1">: [</span><span class="s5">4</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">12</span><span class="s1">]}</span><span class="s2">,</span>
        <span class="s1">index=Index([</span><span class="s4">&quot;hello&quot;</span><span class="s2">, </span><span class="s4">&quot;world&quot;</span><span class="s2">, </span><span class="s4">&quot;foo&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">name=</span><span class="s4">&quot;message&quot;</span><span class="s1">)</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s1">names = [</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;c&quot;</span><span class="s2">, </span><span class="s4">&quot;d&quot;</span><span class="s2">, </span><span class="s4">&quot;message&quot;</span><span class="s1">]</span>

    <span class="s1">result = parser.read_csv(StringIO(data)</span><span class="s2">, </span><span class="s1">names=names</span><span class="s2">, </span><span class="s1">index_col=[</span><span class="s4">&quot;message&quot;</span><span class="s1">])</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s2">def </span><span class="s1">test_index_col_is_true(all_parsers):</span>
    <span class="s3"># see gh-9798</span>
    <span class="s1">data = </span><span class="s4">&quot;a,b</span><span class="s2">\n</span><span class="s4">1,2&quot;</span>
    <span class="s1">parser = all_parsers</span>

    <span class="s1">msg = </span><span class="s4">&quot;The value of index_col couldn't be 'True'&quot;</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
        <span class="s1">parser.read_csv(StringIO(data)</span><span class="s2">, </span><span class="s1">index_col=</span><span class="s2">True</span><span class="s1">)</span>


<span class="s1">@skip_pyarrow</span>
<span class="s2">def </span><span class="s1">test_infer_index_col(all_parsers):</span>
    <span class="s1">data = </span><span class="s4">&quot;&quot;&quot;A,B,C 
foo,1,2,3 
bar,4,5,6 
baz,7,8,9 
&quot;&quot;&quot;</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">result = parser.read_csv(StringIO(data))</span>

    <span class="s1">expected = DataFrame(</span>
        <span class="s1">[[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">7</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">9</span><span class="s1">]]</span><span class="s2">,</span>
        <span class="s1">index=[</span><span class="s4">&quot;foo&quot;</span><span class="s2">, </span><span class="s4">&quot;bar&quot;</span><span class="s2">, </span><span class="s4">&quot;baz&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">columns=[</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s4">&quot;C&quot;</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s1">@skip_pyarrow</span>
<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s4">&quot;index_col,kwargs&quot;</span><span class="s2">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s2">None, </span><span class="s1">{</span><span class="s4">&quot;columns&quot;</span><span class="s1">: [</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">, </span><span class="s4">&quot;z&quot;</span><span class="s1">]})</span><span class="s2">,</span>
        <span class="s1">(</span><span class="s2">False, </span><span class="s1">{</span><span class="s4">&quot;columns&quot;</span><span class="s1">: [</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">, </span><span class="s4">&quot;z&quot;</span><span class="s1">]})</span><span class="s2">,</span>
        <span class="s1">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">{</span><span class="s4">&quot;columns&quot;</span><span class="s1">: [</span><span class="s4">&quot;y&quot;</span><span class="s2">, </span><span class="s4">&quot;z&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s4">&quot;index&quot;</span><span class="s1">: Index([]</span><span class="s2">, </span><span class="s1">name=</span><span class="s4">&quot;x&quot;</span><span class="s1">)})</span><span class="s2">,</span>
        <span class="s1">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">{</span><span class="s4">&quot;columns&quot;</span><span class="s1">: [</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;z&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s4">&quot;index&quot;</span><span class="s1">: Index([]</span><span class="s2">, </span><span class="s1">name=</span><span class="s4">&quot;y&quot;</span><span class="s1">)})</span><span class="s2">,</span>
        <span class="s1">(</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s1">{</span><span class="s4">&quot;columns&quot;</span><span class="s1">: [</span><span class="s4">&quot;y&quot;</span><span class="s2">, </span><span class="s4">&quot;z&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s4">&quot;index&quot;</span><span class="s1">: Index([]</span><span class="s2">, </span><span class="s1">name=</span><span class="s4">&quot;x&quot;</span><span class="s1">)})</span><span class="s2">,</span>
        <span class="s1">(</span><span class="s4">&quot;y&quot;</span><span class="s2">, </span><span class="s1">{</span><span class="s4">&quot;columns&quot;</span><span class="s1">: [</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;z&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s4">&quot;index&quot;</span><span class="s1">: Index([]</span><span class="s2">, </span><span class="s1">name=</span><span class="s4">&quot;y&quot;</span><span class="s1">)})</span><span class="s2">,</span>
        <span class="s1">(</span>
            <span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">{</span>
                <span class="s4">&quot;columns&quot;</span><span class="s1">: [</span><span class="s4">&quot;z&quot;</span><span class="s1">]</span><span class="s2">,</span>
                <span class="s4">&quot;index&quot;</span><span class="s1">: MultiIndex.from_arrays([[]] * </span><span class="s5">2</span><span class="s2">, </span><span class="s1">names=[</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s1">])</span><span class="s2">,</span>
            <span class="s1">}</span><span class="s2">,</span>
        <span class="s1">)</span><span class="s2">,</span>
        <span class="s1">(</span>
            <span class="s1">[</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">{</span>
                <span class="s4">&quot;columns&quot;</span><span class="s1">: [</span><span class="s4">&quot;z&quot;</span><span class="s1">]</span><span class="s2">,</span>
                <span class="s4">&quot;index&quot;</span><span class="s1">: MultiIndex.from_arrays([[]] * </span><span class="s5">2</span><span class="s2">, </span><span class="s1">names=[</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s1">])</span><span class="s2">,</span>
            <span class="s1">}</span><span class="s2">,</span>
        <span class="s1">)</span><span class="s2">,</span>
        <span class="s1">(</span>
            <span class="s1">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">{</span>
                <span class="s4">&quot;columns&quot;</span><span class="s1">: [</span><span class="s4">&quot;z&quot;</span><span class="s1">]</span><span class="s2">,</span>
                <span class="s4">&quot;index&quot;</span><span class="s1">: MultiIndex.from_arrays([[]] * </span><span class="s5">2</span><span class="s2">, </span><span class="s1">names=[</span><span class="s4">&quot;y&quot;</span><span class="s2">, </span><span class="s4">&quot;x&quot;</span><span class="s1">])</span><span class="s2">,</span>
            <span class="s1">}</span><span class="s2">,</span>
        <span class="s1">)</span><span class="s2">,</span>
        <span class="s1">(</span>
            <span class="s1">[</span><span class="s4">&quot;y&quot;</span><span class="s2">, </span><span class="s4">&quot;x&quot;</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">{</span>
                <span class="s4">&quot;columns&quot;</span><span class="s1">: [</span><span class="s4">&quot;z&quot;</span><span class="s1">]</span><span class="s2">,</span>
                <span class="s4">&quot;index&quot;</span><span class="s1">: MultiIndex.from_arrays([[]] * </span><span class="s5">2</span><span class="s2">, </span><span class="s1">names=[</span><span class="s4">&quot;y&quot;</span><span class="s2">, </span><span class="s4">&quot;x&quot;</span><span class="s1">])</span><span class="s2">,</span>
            <span class="s1">}</span><span class="s2">,</span>
        <span class="s1">)</span><span class="s2">,</span>
    <span class="s1">]</span><span class="s2">,</span>
<span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_index_col_empty_data(all_parsers</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">, </span><span class="s1">kwargs):</span>
    <span class="s1">data = </span><span class="s4">&quot;x,y,z&quot;</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">result = parser.read_csv(StringIO(data)</span><span class="s2">, </span><span class="s1">index_col=index_col)</span>

    <span class="s1">expected = DataFrame(**kwargs)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s1">@skip_pyarrow</span>
<span class="s2">def </span><span class="s1">test_empty_with_index_col_false(all_parsers):</span>
    <span class="s3"># see gh-10413</span>
    <span class="s1">data = </span><span class="s4">&quot;x,y&quot;</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">result = parser.read_csv(StringIO(data)</span><span class="s2">, </span><span class="s1">index_col=</span><span class="s2">False</span><span class="s1">)</span>

    <span class="s1">expected = DataFrame(columns=[</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s1">])</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s1">@skip_pyarrow</span>
<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s4">&quot;index_names&quot;</span><span class="s2">,</span>
    <span class="s1">[</span>
        <span class="s1">[</span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">[</span><span class="s4">&quot;foo&quot;</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">[</span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s4">&quot;bar&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">[</span><span class="s4">&quot;foo&quot;</span><span class="s2">, </span><span class="s4">&quot;bar&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">[</span><span class="s4">&quot;NotReallyUnnamed&quot;</span><span class="s2">, </span><span class="s4">&quot;Unnamed: 0&quot;</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">]</span><span class="s2">,</span>
<span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_multi_index_naming(all_parsers</span><span class="s2">, </span><span class="s1">index_names):</span>
    <span class="s1">parser = all_parsers</span>

    <span class="s3"># We don't want empty index names being replaced with &quot;Unnamed: 0&quot;</span>
    <span class="s1">data = </span><span class="s4">&quot;,&quot;</span><span class="s1">.join(index_names + [</span><span class="s4">&quot;col</span><span class="s2">\n</span><span class="s4">a,c,1</span><span class="s2">\n</span><span class="s4">a,d,2</span><span class="s2">\n</span><span class="s4">b,c,3</span><span class="s2">\n</span><span class="s4">b,d,4&quot;</span><span class="s1">])</span>
    <span class="s1">result = parser.read_csv(StringIO(data)</span><span class="s2">, </span><span class="s1">index_col=[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s1">])</span>

    <span class="s1">expected = DataFrame(</span>
        <span class="s1">{</span><span class="s4">&quot;col&quot;</span><span class="s1">: [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s1">]}</span><span class="s2">, </span><span class="s1">index=MultiIndex.from_product([[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">&quot;c&quot;</span><span class="s2">, </span><span class="s4">&quot;d&quot;</span><span class="s1">]])</span>
    <span class="s1">)</span>
    <span class="s1">expected.index.names = [name </span><span class="s2">if </span><span class="s1">name </span><span class="s2">else None for </span><span class="s1">name </span><span class="s2">in </span><span class="s1">index_names]</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s1">@skip_pyarrow</span>
<span class="s2">def </span><span class="s1">test_multi_index_naming_not_all_at_beginning(all_parsers):</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">data = </span><span class="s4">&quot;,Unnamed: 2,</span><span class="s2">\n</span><span class="s4">a,c,1</span><span class="s2">\n</span><span class="s4">a,d,2</span><span class="s2">\n</span><span class="s4">b,c,3</span><span class="s2">\n</span><span class="s4">b,d,4&quot;</span>
    <span class="s1">result = parser.read_csv(StringIO(data)</span><span class="s2">, </span><span class="s1">index_col=[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s1">])</span>

    <span class="s1">expected = DataFrame(</span>
        <span class="s1">{</span><span class="s4">&quot;Unnamed: 2&quot;</span><span class="s1">: [</span><span class="s4">&quot;c&quot;</span><span class="s2">, </span><span class="s4">&quot;d&quot;</span><span class="s2">, </span><span class="s4">&quot;c&quot;</span><span class="s2">, </span><span class="s4">&quot;d&quot;</span><span class="s1">]}</span><span class="s2">,</span>
        <span class="s1">index=MultiIndex(</span>
            <span class="s1">levels=[[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">codes=[[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s1">]]</span>
        <span class="s1">)</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s1">@skip_pyarrow</span>
<span class="s2">def </span><span class="s1">test_no_multi_index_level_names_empty(all_parsers):</span>
    <span class="s3"># GH 10984</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">midx = MultiIndex.from_tuples([(</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)])</span>
    <span class="s1">expected = DataFrame(np.random.randn(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">index=midx</span><span class="s2">, </span><span class="s1">columns=[</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">, </span><span class="s4">&quot;z&quot;</span><span class="s1">])</span>
    <span class="s2">with </span><span class="s1">tm.ensure_clean() </span><span class="s2">as </span><span class="s1">path:</span>
        <span class="s1">expected.to_csv(path)</span>
        <span class="s1">result = parser.read_csv(path</span><span class="s2">, </span><span class="s1">index_col=[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s1">])</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s1">@skip_pyarrow</span>
<span class="s2">def </span><span class="s1">test_header_with_index_col(all_parsers):</span>
    <span class="s3"># GH 33476</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">data = </span><span class="s4">&quot;&quot;&quot; 
I11,A,A 
I12,B,B 
I2,1,3 
&quot;&quot;&quot;</span>
    <span class="s1">midx = MultiIndex.from_tuples([(</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B.1&quot;</span><span class="s1">)]</span><span class="s2">, </span><span class="s1">names=[</span><span class="s4">&quot;I11&quot;</span><span class="s2">, </span><span class="s4">&quot;I12&quot;</span><span class="s1">])</span>
    <span class="s1">idx = Index([</span><span class="s4">&quot;I2&quot;</span><span class="s1">])</span>
    <span class="s1">expected = DataFrame([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">index=idx</span><span class="s2">, </span><span class="s1">columns=midx)</span>

    <span class="s1">result = parser.read_csv(StringIO(data)</span><span class="s2">, </span><span class="s1">index_col=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">header=[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s1">])</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s1">col_idx = Index([</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;A.1&quot;</span><span class="s1">])</span>
    <span class="s1">idx = Index([</span><span class="s4">&quot;I12&quot;</span><span class="s2">, </span><span class="s4">&quot;I2&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">name=</span><span class="s4">&quot;I11&quot;</span><span class="s1">)</span>
    <span class="s1">expected = DataFrame([[</span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">&quot;1&quot;</span><span class="s2">, </span><span class="s4">&quot;3&quot;</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">index=idx</span><span class="s2">, </span><span class="s1">columns=col_idx)</span>

    <span class="s1">result = parser.read_csv(StringIO(data)</span><span class="s2">, </span><span class="s1">index_col=</span><span class="s4">&quot;I11&quot;</span><span class="s2">, </span><span class="s1">header=</span><span class="s5">0</span><span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.slow</span>
<span class="s2">def </span><span class="s1">test_index_col_large_csv(all_parsers):</span>
    <span class="s3"># https://github.com/pandas-dev/pandas/issues/37094</span>
    <span class="s1">parser = all_parsers</span>

    <span class="s1">N = </span><span class="s5">1_000_001</span>
    <span class="s1">df = DataFrame({</span><span class="s4">&quot;a&quot;</span><span class="s1">: range(N)</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s1">: np.random.randn(N)})</span>

    <span class="s2">with </span><span class="s1">tm.ensure_clean() </span><span class="s2">as </span><span class="s1">path:</span>
        <span class="s1">df.to_csv(path</span><span class="s2">, </span><span class="s1">index=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">result = parser.read_csv(path</span><span class="s2">, </span><span class="s1">index_col=[</span><span class="s5">0</span><span class="s1">])</span>

    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">df.set_index(</span><span class="s4">&quot;a&quot;</span><span class="s1">))</span>


<span class="s1">@skip_pyarrow</span>
<span class="s2">def </span><span class="s1">test_index_col_multiindex_columns_no_data(all_parsers):</span>
    <span class="s3"># GH#38292</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">result = parser.read_csv(</span>
        <span class="s1">StringIO(</span><span class="s4">&quot;a0,a1,a2</span><span class="s2">\n</span><span class="s4">b0,b1,b2</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">header=[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">index_col=</span><span class="s5">0</span>
    <span class="s1">)</span>
    <span class="s1">expected = DataFrame(</span>
        <span class="s1">[]</span><span class="s2">,</span>
        <span class="s1">columns=MultiIndex.from_arrays(</span>
            <span class="s1">[[</span><span class="s4">&quot;a1&quot;</span><span class="s2">, </span><span class="s4">&quot;a2&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">&quot;b1&quot;</span><span class="s2">, </span><span class="s4">&quot;b2&quot;</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">names=[</span><span class="s4">&quot;a0&quot;</span><span class="s2">, </span><span class="s4">&quot;b0&quot;</span><span class="s1">]</span>
        <span class="s1">)</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s1">@skip_pyarrow</span>
<span class="s2">def </span><span class="s1">test_index_col_header_no_data(all_parsers):</span>
    <span class="s3"># GH#38292</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">result = parser.read_csv(StringIO(</span><span class="s4">&quot;a0,a1,a2</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">header=[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">index_col=</span><span class="s5">0</span><span class="s1">)</span>
    <span class="s1">expected = DataFrame(</span>
        <span class="s1">[]</span><span class="s2">,</span>
        <span class="s1">columns=[</span><span class="s4">&quot;a1&quot;</span><span class="s2">, </span><span class="s4">&quot;a2&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">index=Index([]</span><span class="s2">, </span><span class="s1">name=</span><span class="s4">&quot;a0&quot;</span><span class="s1">)</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s1">@skip_pyarrow</span>
<span class="s2">def </span><span class="s1">test_multiindex_columns_no_data(all_parsers):</span>
    <span class="s3"># GH#38292</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">result = parser.read_csv(StringIO(</span><span class="s4">&quot;a0,a1,a2</span><span class="s2">\n</span><span class="s4">b0,b1,b2</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">header=[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s1">])</span>
    <span class="s1">expected = DataFrame(</span>
        <span class="s1">[]</span><span class="s2">, </span><span class="s1">columns=MultiIndex.from_arrays([[</span><span class="s4">&quot;a0&quot;</span><span class="s2">, </span><span class="s4">&quot;a1&quot;</span><span class="s2">, </span><span class="s4">&quot;a2&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">&quot;b0&quot;</span><span class="s2">, </span><span class="s4">&quot;b1&quot;</span><span class="s2">, </span><span class="s4">&quot;b2&quot;</span><span class="s1">]])</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s1">@skip_pyarrow</span>
<span class="s2">def </span><span class="s1">test_multiindex_columns_index_col_with_data(all_parsers):</span>
    <span class="s3"># GH#38292</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">result = parser.read_csv(</span>
        <span class="s1">StringIO(</span><span class="s4">&quot;a0,a1,a2</span><span class="s2">\n</span><span class="s4">b0,b1,b2</span><span class="s2">\n</span><span class="s4">data,data,data&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">header=[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">index_col=</span><span class="s5">0</span>
    <span class="s1">)</span>
    <span class="s1">expected = DataFrame(</span>
        <span class="s1">[[</span><span class="s4">&quot;data&quot;</span><span class="s2">, </span><span class="s4">&quot;data&quot;</span><span class="s1">]]</span><span class="s2">,</span>
        <span class="s1">columns=MultiIndex.from_arrays(</span>
            <span class="s1">[[</span><span class="s4">&quot;a1&quot;</span><span class="s2">, </span><span class="s4">&quot;a2&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">&quot;b1&quot;</span><span class="s2">, </span><span class="s4">&quot;b2&quot;</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">names=[</span><span class="s4">&quot;a0&quot;</span><span class="s2">, </span><span class="s4">&quot;b0&quot;</span><span class="s1">]</span>
        <span class="s1">)</span><span class="s2">,</span>
        <span class="s1">index=Index([</span><span class="s4">&quot;data&quot;</span><span class="s1">])</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s1">@skip_pyarrow</span>
<span class="s2">def </span><span class="s1">test_infer_types_boolean_sum(all_parsers):</span>
    <span class="s3"># GH#44079</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">result = parser.read_csv(</span>
        <span class="s1">StringIO(</span><span class="s4">&quot;0,1&quot;</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">names=[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">index_col=[</span><span class="s4">&quot;a&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">dtype={</span><span class="s4">&quot;a&quot;</span><span class="s1">: </span><span class="s4">&quot;UInt8&quot;</span><span class="s1">}</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s1">expected = DataFrame(</span>
        <span class="s1">data={</span>
            <span class="s4">&quot;a&quot;</span><span class="s1">: [</span>
                <span class="s5">0</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">,</span>
            <span class="s4">&quot;b&quot;</span><span class="s1">: [</span><span class="s5">1</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">}</span>
    <span class="s1">).set_index(</span><span class="s4">&quot;a&quot;</span><span class="s1">)</span>
    <span class="s3"># Not checking index type now, because the C parser will return a</span>
    <span class="s3"># index column of dtype 'object', and the Python parser will return a</span>
    <span class="s3"># index column of dtype 'int64'.</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">check_index_type=</span><span class="s2">False</span><span class="s1">)</span>


<span class="s1">@skip_pyarrow</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;dtype, val&quot;</span><span class="s2">, </span><span class="s1">[(object</span><span class="s2">, </span><span class="s4">&quot;01&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">&quot;int64&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)])</span>
<span class="s2">def </span><span class="s1">test_specify_dtype_for_index_col(all_parsers</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">val):</span>
    <span class="s3"># GH#9435</span>
    <span class="s1">data = </span><span class="s4">&quot;a,b</span><span class="s2">\n</span><span class="s4">01,2&quot;</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">result = parser.read_csv(StringIO(data)</span><span class="s2">, </span><span class="s1">index_col=</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s1">dtype={</span><span class="s4">&quot;a&quot;</span><span class="s1">: dtype})</span>
    <span class="s1">expected = DataFrame({</span><span class="s4">&quot;b&quot;</span><span class="s1">: [</span><span class="s5">2</span><span class="s1">]}</span><span class="s2">, </span><span class="s1">index=Index([val]</span><span class="s2">, </span><span class="s1">name=</span><span class="s4">&quot;a&quot;</span><span class="s1">))</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s1">@skip_pyarrow</span>
<span class="s2">def </span><span class="s1">test_multiindex_columns_not_leading_index_col(all_parsers):</span>
    <span class="s3"># GH#38549</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">data = </span><span class="s4">&quot;&quot;&quot;a,b,c,d 
e,f,g,h 
x,y,1,2 
&quot;&quot;&quot;</span>
    <span class="s1">result = parser.read_csv(</span>
        <span class="s1">StringIO(data)</span><span class="s2">,</span>
        <span class="s1">header=[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">index_col=</span><span class="s5">1</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s1">cols = MultiIndex.from_tuples(</span>
        <span class="s1">[(</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;e&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">&quot;c&quot;</span><span class="s2">, </span><span class="s4">&quot;g&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">&quot;d&quot;</span><span class="s2">, </span><span class="s4">&quot;h&quot;</span><span class="s1">)]</span><span class="s2">, </span><span class="s1">names=[</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;f&quot;</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">expected = DataFrame([[</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">columns=cols</span><span class="s2">, </span><span class="s1">index=[</span><span class="s4">&quot;y&quot;</span><span class="s1">])</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
</pre>
</body>
</html>