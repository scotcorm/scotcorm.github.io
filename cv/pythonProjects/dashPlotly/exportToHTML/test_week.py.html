<html>
<head>
<title>test_week.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
.s5 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_week.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Tests for the following offsets: 
- Week 
- WeekOfMonth 
- LastWeekOfMonth 
&quot;&quot;&quot;</span>
<span class="s2">from </span><span class="s1">datetime </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">datetime</span><span class="s2">,</span>
    <span class="s1">timedelta</span><span class="s2">,</span>
<span class="s1">)</span>

<span class="s2">import </span><span class="s1">pytest</span>

<span class="s2">from </span><span class="s1">pandas._libs.tslibs </span><span class="s2">import </span><span class="s1">Timestamp</span>
<span class="s2">from </span><span class="s1">pandas._libs.tslibs.offsets </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">Day</span><span class="s2">,</span>
    <span class="s1">LastWeekOfMonth</span><span class="s2">,</span>
    <span class="s1">Week</span><span class="s2">,</span>
    <span class="s1">WeekOfMonth</span><span class="s2">,</span>
<span class="s1">)</span>

<span class="s2">from </span><span class="s1">pandas.tests.tseries.offsets.common </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">Base</span><span class="s2">,</span>
    <span class="s1">WeekDay</span><span class="s2">,</span>
    <span class="s1">assert_is_on_offset</span><span class="s2">,</span>
    <span class="s1">assert_offset_equal</span><span class="s2">,</span>
<span class="s1">)</span>


<span class="s2">class </span><span class="s1">TestWeek(Base):</span>
    <span class="s1">_offset = Week</span>
    <span class="s1">d = Timestamp(datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">))</span>
    <span class="s1">offset1 = _offset()</span>
    <span class="s1">offset2 = _offset(</span><span class="s3">2</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_repr(self):</span>
        <span class="s2">assert </span><span class="s1">repr(Week(weekday=</span><span class="s3">0</span><span class="s1">)) == </span><span class="s4">&quot;&lt;Week: weekday=0&gt;&quot;</span>
        <span class="s2">assert </span><span class="s1">repr(Week(n=-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">weekday=</span><span class="s3">0</span><span class="s1">)) == </span><span class="s4">&quot;&lt;-1 * Week: weekday=0&gt;&quot;</span>
        <span class="s2">assert </span><span class="s1">repr(Week(n=-</span><span class="s3">2</span><span class="s2">, </span><span class="s1">weekday=</span><span class="s3">0</span><span class="s1">)) == </span><span class="s4">&quot;&lt;-2 * Weeks: weekday=0&gt;&quot;</span>

    <span class="s2">def </span><span class="s1">test_corner(self):</span>
        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s4">&quot;Day must be&quot;</span><span class="s1">):</span>
            <span class="s1">Week(weekday=</span><span class="s3">7</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s4">&quot;Day must be&quot;</span><span class="s1">):</span>
            <span class="s1">Week(weekday=-</span><span class="s3">1</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_is_anchored(self):</span>
        <span class="s2">assert </span><span class="s1">Week(weekday=</span><span class="s3">0</span><span class="s1">).is_anchored()</span>
        <span class="s2">assert not </span><span class="s1">Week().is_anchored()</span>
        <span class="s2">assert not </span><span class="s1">Week(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">weekday=</span><span class="s3">2</span><span class="s1">).is_anchored()</span>
        <span class="s2">assert not </span><span class="s1">Week(</span><span class="s3">2</span><span class="s1">).is_anchored()</span>

    <span class="s1">offset_cases = []</span>
    <span class="s5"># not business week</span>
    <span class="s1">offset_cases.append(</span>
        <span class="s1">(</span>
            <span class="s1">Week()</span><span class="s2">,</span>
            <span class="s1">{</span>
                <span class="s1">datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">): datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">8</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">4</span><span class="s1">): datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">11</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">5</span><span class="s1">): datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">12</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">6</span><span class="s1">): datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">13</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">7</span><span class="s1">): datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">14</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">}</span><span class="s2">,</span>
        <span class="s1">)</span>
    <span class="s1">)</span>

    <span class="s5"># Mon</span>
    <span class="s1">offset_cases.append(</span>
        <span class="s1">(</span>
            <span class="s1">Week(weekday=</span><span class="s3">0</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">{</span>
                <span class="s1">datetime(</span><span class="s3">2007</span><span class="s2">, </span><span class="s3">12</span><span class="s2">, </span><span class="s3">31</span><span class="s1">): datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">4</span><span class="s1">): datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">5</span><span class="s1">): datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">6</span><span class="s1">): datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">7</span><span class="s1">): datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">14</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">}</span><span class="s2">,</span>
        <span class="s1">)</span>
    <span class="s1">)</span>

    <span class="s5"># n=0 -&gt; roll forward. Mon</span>
    <span class="s1">offset_cases.append(</span>
        <span class="s1">(</span>
            <span class="s1">Week(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">weekday=</span><span class="s3">0</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">{</span>
                <span class="s1">datetime(</span><span class="s3">2007</span><span class="s2">, </span><span class="s3">12</span><span class="s2">, </span><span class="s3">31</span><span class="s1">): datetime(</span><span class="s3">2007</span><span class="s2">, </span><span class="s3">12</span><span class="s2">, </span><span class="s3">31</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">4</span><span class="s1">): datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">5</span><span class="s1">): datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">6</span><span class="s1">): datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">7</span><span class="s1">): datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">}</span><span class="s2">,</span>
        <span class="s1">)</span>
    <span class="s1">)</span>

    <span class="s5"># n=0 -&gt; roll forward. Mon</span>
    <span class="s1">offset_cases.append(</span>
        <span class="s1">(</span>
            <span class="s1">Week(-</span><span class="s3">2</span><span class="s2">, </span><span class="s1">weekday=</span><span class="s3">1</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">{</span>
                <span class="s1">datetime(</span><span class="s3">2010</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">6</span><span class="s1">): datetime(</span><span class="s3">2010</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">23</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">datetime(</span><span class="s3">2010</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s1">): datetime(</span><span class="s3">2010</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">30</span><span class="s1">)</span><span class="s2">,</span>
                <span class="s1">datetime(</span><span class="s3">2010</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">): datetime(</span><span class="s3">2010</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">23</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">}</span><span class="s2">,</span>
        <span class="s1">)</span>
    <span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;case&quot;</span><span class="s2">, </span><span class="s1">offset_cases)</span>
    <span class="s2">def </span><span class="s1">test_offset(self</span><span class="s2">, </span><span class="s1">case):</span>
        <span class="s1">offset</span><span class="s2">, </span><span class="s1">cases = case</span>
        <span class="s2">for </span><span class="s1">base</span><span class="s2">, </span><span class="s1">expected </span><span class="s2">in </span><span class="s1">cases.items():</span>
            <span class="s1">assert_offset_equal(offset</span><span class="s2">, </span><span class="s1">base</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;weekday&quot;</span><span class="s2">, </span><span class="s1">range(</span><span class="s3">7</span><span class="s1">))</span>
    <span class="s2">def </span><span class="s1">test_is_on_offset(self</span><span class="s2">, </span><span class="s1">weekday):</span>
        <span class="s1">offset = Week(weekday=weekday)</span>

        <span class="s2">for </span><span class="s1">day </span><span class="s2">in </span><span class="s1">range(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">8</span><span class="s1">):</span>
            <span class="s1">date = datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">day)</span>

            <span class="s2">if </span><span class="s1">day % </span><span class="s3">7 </span><span class="s1">== weekday:</span>
                <span class="s1">expected = </span><span class="s2">True</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s1">expected = </span><span class="s2">False</span>
        <span class="s1">assert_is_on_offset(offset</span><span class="s2">, </span><span class="s1">date</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s4">&quot;n,date&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">(</span><span class="s3">2</span><span class="s2">, </span><span class="s4">&quot;1862-01-13 09:03:34.873477378+0210&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">(-</span><span class="s3">2</span><span class="s2">, </span><span class="s4">&quot;1856-10-24 16:18:36.556360110-0717&quot;</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_is_on_offset_weekday_none(self</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">date):</span>
        <span class="s5"># GH 18510 Week with weekday = None, normalize = False</span>
        <span class="s5"># should always be is_on_offset</span>
        <span class="s1">offset = Week(n=n</span><span class="s2">, </span><span class="s1">weekday=</span><span class="s2">None</span><span class="s1">)</span>
        <span class="s1">ts = Timestamp(date</span><span class="s2">, </span><span class="s1">tz=</span><span class="s4">&quot;Africa/Lusaka&quot;</span><span class="s1">)</span>
        <span class="s1">fast = offset.is_on_offset(ts)</span>
        <span class="s1">slow = (ts + offset) - offset == ts</span>
        <span class="s2">assert </span><span class="s1">fast == slow</span>

    <span class="s2">def </span><span class="s1">test_week_add_invalid(self):</span>
        <span class="s5"># Week with weekday should raise TypeError and _not_ AttributeError</span>
        <span class="s5">#  when adding invalid offset</span>
        <span class="s1">offset = Week(weekday=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">other = Day()</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=</span><span class="s4">&quot;Cannot add&quot;</span><span class="s1">):</span>
            <span class="s1">offset + other</span>


<span class="s2">class </span><span class="s1">TestWeekOfMonth(Base):</span>
    <span class="s1">_offset = WeekOfMonth</span>
    <span class="s1">offset1 = _offset()</span>
    <span class="s1">offset2 = _offset(</span><span class="s3">2</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_constructor(self):</span>
        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s4">&quot;^Week&quot;</span><span class="s1">):</span>
            <span class="s1">WeekOfMonth(n=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">week=</span><span class="s3">4</span><span class="s2">, </span><span class="s1">weekday=</span><span class="s3">0</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s4">&quot;^Week&quot;</span><span class="s1">):</span>
            <span class="s1">WeekOfMonth(n=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">week=-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">weekday=</span><span class="s3">0</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s4">&quot;^Day&quot;</span><span class="s1">):</span>
            <span class="s1">WeekOfMonth(n=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">week=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">weekday=-</span><span class="s3">1</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s4">&quot;^Day&quot;</span><span class="s1">):</span>
            <span class="s1">WeekOfMonth(n=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">week=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">weekday=-</span><span class="s3">7</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_repr(self):</span>
        <span class="s2">assert </span><span class="s1">(</span>
            <span class="s1">repr(WeekOfMonth(weekday=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">week=</span><span class="s3">2</span><span class="s1">)) == </span><span class="s4">&quot;&lt;WeekOfMonth: week=2, weekday=1&gt;&quot;</span>
        <span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_offset(self):</span>
        <span class="s1">date1 = datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">4</span><span class="s1">)  </span><span class="s5"># 1st Tuesday of Month</span>
        <span class="s1">date2 = datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">11</span><span class="s1">)  </span><span class="s5"># 2nd Tuesday of Month</span>
        <span class="s1">date3 = datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">18</span><span class="s1">)  </span><span class="s5"># 3rd Tuesday of Month</span>
        <span class="s1">date4 = datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">25</span><span class="s1">)  </span><span class="s5"># 4th Tuesday of Month</span>

        <span class="s5"># see for loop for structure</span>
        <span class="s1">test_cases = [</span>
            <span class="s1">(-</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date1</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2010</span><span class="s2">, </span><span class="s3">11</span><span class="s2">, </span><span class="s3">16</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(-</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2010</span><span class="s2">, </span><span class="s3">11</span><span class="s2">, </span><span class="s3">16</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(-</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date3</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2010</span><span class="s2">, </span><span class="s3">11</span><span class="s2">, </span><span class="s3">16</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(-</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date4</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2010</span><span class="s2">, </span><span class="s3">12</span><span class="s2">, </span><span class="s3">21</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date1</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2010</span><span class="s2">, </span><span class="s3">12</span><span class="s2">, </span><span class="s3">21</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2010</span><span class="s2">, </span><span class="s3">12</span><span class="s2">, </span><span class="s3">21</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date3</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2010</span><span class="s2">, </span><span class="s3">12</span><span class="s2">, </span><span class="s3">21</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date4</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">18</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date1</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">4</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date3</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date4</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date1</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">11</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">11</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date3</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">8</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date4</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">8</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date1</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">4</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">11</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date3</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">18</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date4</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">25</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">date1</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">7</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">7</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">date3</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">7</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">date4</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">7</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date1</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date3</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date4</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s1">date1</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">5</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s1">date3</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s1">date4</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date1</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">18</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">18</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date3</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">15</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date4</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">15</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date1</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">15</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">15</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date3</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">15</span><span class="s1">))</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">date4</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">15</span><span class="s1">))</span><span class="s2">,</span>
        <span class="s1">]</span>

        <span class="s2">for </span><span class="s1">n</span><span class="s2">, </span><span class="s1">week</span><span class="s2">, </span><span class="s1">weekday</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">, </span><span class="s1">expected </span><span class="s2">in </span><span class="s1">test_cases:</span>
            <span class="s1">offset = WeekOfMonth(n</span><span class="s2">, </span><span class="s1">week=week</span><span class="s2">, </span><span class="s1">weekday=weekday)</span>
            <span class="s1">assert_offset_equal(offset</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s5"># try subtracting</span>
        <span class="s1">result = datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">) - WeekOfMonth(week=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">weekday=</span><span class="s3">2</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">result == datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">12</span><span class="s1">)</span>

        <span class="s1">result = datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s1">) - WeekOfMonth(week=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">weekday=</span><span class="s3">2</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">result == datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">on_offset_cases = [</span>
        <span class="s1">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">7</span><span class="s1">)</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">6</span><span class="s1">)</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">14</span><span class="s1">)</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">14</span><span class="s1">)</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">8</span><span class="s1">)</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">,</span>
    <span class="s1">]</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;case&quot;</span><span class="s2">, </span><span class="s1">on_offset_cases)</span>
    <span class="s2">def </span><span class="s1">test_is_on_offset(self</span><span class="s2">, </span><span class="s1">case):</span>
        <span class="s1">week</span><span class="s2">, </span><span class="s1">weekday</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">, </span><span class="s1">expected = case</span>
        <span class="s1">offset = WeekOfMonth(week=week</span><span class="s2">, </span><span class="s1">weekday=weekday)</span>
        <span class="s2">assert </span><span class="s1">offset.is_on_offset(dt) == expected</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s4">&quot;n,week,date,tz&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s4">&quot;1916-05-15 01:14:49.583410462+0422&quot;</span><span class="s2">, </span><span class="s4">&quot;Asia/Qyzylorda&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">(-</span><span class="s3">3</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s4">&quot;1980-12-08 03:38:52.878321185+0500&quot;</span><span class="s2">, </span><span class="s4">&quot;Asia/Oral&quot;</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_is_on_offset_nanoseconds(self</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">week</span><span class="s2">, </span><span class="s1">date</span><span class="s2">, </span><span class="s1">tz):</span>
        <span class="s5"># GH 18864</span>
        <span class="s5"># Make sure that nanoseconds don't trip up is_on_offset (and with it apply)</span>
        <span class="s1">offset = WeekOfMonth(n=n</span><span class="s2">, </span><span class="s1">week=week</span><span class="s2">, </span><span class="s1">weekday=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">ts = Timestamp(date</span><span class="s2">, </span><span class="s1">tz=tz)</span>
        <span class="s1">fast = offset.is_on_offset(ts)</span>
        <span class="s1">slow = (ts + offset) - offset == ts</span>
        <span class="s2">assert </span><span class="s1">fast == slow</span>


<span class="s2">class </span><span class="s1">TestLastWeekOfMonth(Base):</span>
    <span class="s1">_offset = LastWeekOfMonth</span>
    <span class="s1">offset1 = _offset()</span>
    <span class="s1">offset2 = _offset(</span><span class="s3">2</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_constructor(self):</span>
        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s4">&quot;^N cannot be 0&quot;</span><span class="s1">):</span>
            <span class="s1">LastWeekOfMonth(n=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">weekday=</span><span class="s3">1</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s4">&quot;^Day&quot;</span><span class="s1">):</span>
            <span class="s1">LastWeekOfMonth(n=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">weekday=-</span><span class="s3">1</span><span class="s1">)</span>

        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=</span><span class="s4">&quot;^Day&quot;</span><span class="s1">):</span>
            <span class="s1">LastWeekOfMonth(n=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">weekday=</span><span class="s3">7</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_offset(self):</span>
        <span class="s5"># Saturday</span>
        <span class="s1">last_sat = datetime(</span><span class="s3">2013</span><span class="s2">, </span><span class="s3">8</span><span class="s2">, </span><span class="s3">31</span><span class="s1">)</span>
        <span class="s1">next_sat = datetime(</span><span class="s3">2013</span><span class="s2">, </span><span class="s3">9</span><span class="s2">, </span><span class="s3">28</span><span class="s1">)</span>
        <span class="s1">offset_sat = LastWeekOfMonth(n=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">weekday=</span><span class="s3">5</span><span class="s1">)</span>

        <span class="s1">one_day_before = last_sat + timedelta(days=-</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">one_day_before + offset_sat == last_sat</span>

        <span class="s1">one_day_after = last_sat + timedelta(days=+</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">one_day_after + offset_sat == next_sat</span>

        <span class="s5"># Test On that day</span>
        <span class="s2">assert </span><span class="s1">last_sat + offset_sat == next_sat</span>

        <span class="s5"># Thursday</span>

        <span class="s1">offset_thur = LastWeekOfMonth(n=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">weekday=</span><span class="s3">3</span><span class="s1">)</span>
        <span class="s1">last_thurs = datetime(</span><span class="s3">2013</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">31</span><span class="s1">)</span>
        <span class="s1">next_thurs = datetime(</span><span class="s3">2013</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">28</span><span class="s1">)</span>

        <span class="s1">one_day_before = last_thurs + timedelta(days=-</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">one_day_before + offset_thur == last_thurs</span>

        <span class="s1">one_day_after = last_thurs + timedelta(days=+</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">one_day_after + offset_thur == next_thurs</span>

        <span class="s5"># Test on that day</span>
        <span class="s2">assert </span><span class="s1">last_thurs + offset_thur == next_thurs</span>

        <span class="s1">three_before = last_thurs + timedelta(days=-</span><span class="s3">3</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">three_before + offset_thur == last_thurs</span>

        <span class="s1">two_after = last_thurs + timedelta(days=+</span><span class="s3">2</span><span class="s1">)</span>
        <span class="s2">assert </span><span class="s1">two_after + offset_thur == next_thurs</span>

        <span class="s1">offset_sunday = LastWeekOfMonth(n=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">weekday=WeekDay.SUN)</span>
        <span class="s2">assert </span><span class="s1">datetime(</span><span class="s3">2013</span><span class="s2">, </span><span class="s3">7</span><span class="s2">, </span><span class="s3">31</span><span class="s1">) + offset_sunday == datetime(</span><span class="s3">2013</span><span class="s2">, </span><span class="s3">8</span><span class="s2">, </span><span class="s3">25</span><span class="s1">)</span>

    <span class="s1">on_offset_cases = [</span>
        <span class="s1">(WeekDay.SUN</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2013</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">27</span><span class="s1">)</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">(WeekDay.SAT</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2013</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">30</span><span class="s1">)</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">(WeekDay.MON</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2013</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">18</span><span class="s1">)</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">,  </span><span class="s5"># Not the last Mon</span>
        <span class="s1">(WeekDay.SUN</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2013</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">25</span><span class="s1">)</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">,  </span><span class="s5"># Not a SUN</span>
        <span class="s1">(WeekDay.MON</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2013</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">25</span><span class="s1">)</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">(WeekDay.SAT</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2013</span><span class="s2">, </span><span class="s3">11</span><span class="s2">, </span><span class="s3">30</span><span class="s1">)</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">(WeekDay.SAT</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2006</span><span class="s2">, </span><span class="s3">8</span><span class="s2">, </span><span class="s3">26</span><span class="s1">)</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">(WeekDay.SAT</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2007</span><span class="s2">, </span><span class="s3">8</span><span class="s2">, </span><span class="s3">25</span><span class="s1">)</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">(WeekDay.SAT</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2008</span><span class="s2">, </span><span class="s3">8</span><span class="s2">, </span><span class="s3">30</span><span class="s1">)</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">(WeekDay.SAT</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2009</span><span class="s2">, </span><span class="s3">8</span><span class="s2">, </span><span class="s3">29</span><span class="s1">)</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">(WeekDay.SAT</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2010</span><span class="s2">, </span><span class="s3">8</span><span class="s2">, </span><span class="s3">28</span><span class="s1">)</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">(WeekDay.SAT</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">8</span><span class="s2">, </span><span class="s3">27</span><span class="s1">)</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">(WeekDay.SAT</span><span class="s2">, </span><span class="s1">datetime(</span><span class="s3">2019</span><span class="s2">, </span><span class="s3">8</span><span class="s2">, </span><span class="s3">31</span><span class="s1">)</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">,</span>
    <span class="s1">]</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;case&quot;</span><span class="s2">, </span><span class="s1">on_offset_cases)</span>
    <span class="s2">def </span><span class="s1">test_is_on_offset(self</span><span class="s2">, </span><span class="s1">case):</span>
        <span class="s1">weekday</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">, </span><span class="s1">expected = case</span>
        <span class="s1">offset = LastWeekOfMonth(weekday=weekday)</span>
        <span class="s2">assert </span><span class="s1">offset.is_on_offset(dt) == expected</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s4">&quot;n,weekday,date,tz&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
            <span class="s1">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s4">&quot;1917-05-27 20:55:27.084284178+0200&quot;</span><span class="s2">, </span><span class="s4">&quot;Europe/Warsaw&quot;</span><span class="s1">)</span><span class="s2">,</span>
            <span class="s1">(-</span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s4">&quot;2005-08-27 05:01:42.799392561-0500&quot;</span><span class="s2">, </span><span class="s4">&quot;America/Rainy_River&quot;</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_last_week_of_month_on_offset(self</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">weekday</span><span class="s2">, </span><span class="s1">date</span><span class="s2">, </span><span class="s1">tz):</span>
        <span class="s5"># GH 19036, GH 18977 _adjust_dst was incorrect for LastWeekOfMonth</span>
        <span class="s1">offset = LastWeekOfMonth(n=n</span><span class="s2">, </span><span class="s1">weekday=weekday)</span>
        <span class="s1">ts = Timestamp(date</span><span class="s2">, </span><span class="s1">tz=tz)</span>
        <span class="s1">slow = (ts + offset) - offset == ts</span>
        <span class="s1">fast = offset.is_on_offset(ts)</span>
        <span class="s2">assert </span><span class="s1">fast == slow</span>

    <span class="s2">def </span><span class="s1">test_repr(self):</span>
        <span class="s2">assert </span><span class="s1">(</span>
            <span class="s1">repr(LastWeekOfMonth(n=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">weekday=</span><span class="s3">1</span><span class="s1">)) == </span><span class="s4">&quot;&lt;2 * LastWeekOfMonths: weekday=1&gt;&quot;</span>
        <span class="s1">)</span>
</pre>
</body>
</html>