<html>
<head>
<title>test_arraysetops.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #808080;}
.s4 { color: #6897bb;}
.s5 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_arraysetops.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;Test functions for 1D array set operations. 
 
&quot;&quot;&quot;</span>
<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>

<span class="s2">from </span><span class="s1">numpy.testing </span><span class="s2">import </span><span class="s1">(assert_array_equal</span><span class="s2">, </span><span class="s1">assert_equal</span><span class="s2">,</span>
                           <span class="s1">assert_raises</span><span class="s2">, </span><span class="s1">assert_raises_regex)</span>
<span class="s2">from </span><span class="s1">numpy.lib.arraysetops </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">ediff1d</span><span class="s2">, </span><span class="s1">intersect1d</span><span class="s2">, </span><span class="s1">setxor1d</span><span class="s2">, </span><span class="s1">union1d</span><span class="s2">, </span><span class="s1">setdiff1d</span><span class="s2">, </span><span class="s1">unique</span><span class="s2">, </span><span class="s1">in1d</span><span class="s2">, </span><span class="s1">isin</span>
    <span class="s1">)</span>
<span class="s2">import </span><span class="s1">pytest</span>


<span class="s2">class </span><span class="s1">TestSetOps:</span>

    <span class="s2">def </span><span class="s1">test_intersect1d(self):</span>
        <span class="s3"># unique inputs</span>
        <span class="s1">a = np.array([</span><span class="s4">5</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">])</span>
        <span class="s1">b = np.array([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">5</span><span class="s1">])</span>

        <span class="s1">ec = np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s1">])</span>
        <span class="s1">c = intersect1d(a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">assume_unique=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(c</span><span class="s2">, </span><span class="s1">ec)</span>

        <span class="s3"># non-unique inputs</span>
        <span class="s1">a = np.array([</span><span class="s4">5</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">])</span>
        <span class="s1">b = np.array([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">5</span><span class="s1">])</span>

        <span class="s1">ed = np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s1">])</span>
        <span class="s1">c = intersect1d(a</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s1">assert_array_equal(c</span><span class="s2">, </span><span class="s1">ed)</span>
        <span class="s1">assert_array_equal([]</span><span class="s2">, </span><span class="s1">intersect1d([]</span><span class="s2">, </span><span class="s1">[]))</span>

    <span class="s2">def </span><span class="s1">test_intersect1d_array_like(self):</span>
        <span class="s3"># See gh-11772</span>
        <span class="s2">class </span><span class="s1">Test:</span>
            <span class="s2">def </span><span class="s1">__array__(self):</span>
                <span class="s2">return </span><span class="s1">np.arange(</span><span class="s4">3</span><span class="s1">)</span>

        <span class="s1">a = Test()</span>
        <span class="s1">res = intersect1d(a</span><span class="s2">, </span><span class="s1">a)</span>
        <span class="s1">assert_array_equal(res</span><span class="s2">, </span><span class="s1">a)</span>
        <span class="s1">res = intersect1d([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(res</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">])</span>

    <span class="s2">def </span><span class="s1">test_intersect1d_indices(self):</span>
        <span class="s3"># unique inputs</span>
        <span class="s1">a = np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">])</span>
        <span class="s1">b = np.array([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">6</span><span class="s1">])</span>
        <span class="s1">c</span><span class="s2">, </span><span class="s1">i1</span><span class="s2">, </span><span class="s1">i2 = intersect1d(a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">assume_unique=</span><span class="s2">True, </span><span class="s1">return_indices=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">ee = np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(c</span><span class="s2">, </span><span class="s1">ee)</span>
        <span class="s1">assert_array_equal(a[i1]</span><span class="s2">, </span><span class="s1">ee)</span>
        <span class="s1">assert_array_equal(b[i2]</span><span class="s2">, </span><span class="s1">ee)</span>

        <span class="s3"># non-unique inputs</span>
        <span class="s1">a = np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s1">])</span>
        <span class="s1">b = np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">])</span>
        <span class="s1">c</span><span class="s2">, </span><span class="s1">i1</span><span class="s2">, </span><span class="s1">i2 = intersect1d(a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">return_indices=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">ef = np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(c</span><span class="s2">, </span><span class="s1">ef)</span>
        <span class="s1">assert_array_equal(a[i1]</span><span class="s2">, </span><span class="s1">ef)</span>
        <span class="s1">assert_array_equal(b[i2]</span><span class="s2">, </span><span class="s1">ef)</span>

        <span class="s3"># non1d, unique inputs</span>
        <span class="s1">a = np.array([[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">7</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">15</span><span class="s1">]])</span>
        <span class="s1">b = np.array([[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">6</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">10</span><span class="s2">, </span><span class="s4">12</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">9</span><span class="s1">]])</span>
        <span class="s1">c</span><span class="s2">, </span><span class="s1">i1</span><span class="s2">, </span><span class="s1">i2 = intersect1d(a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">assume_unique=</span><span class="s2">True, </span><span class="s1">return_indices=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">ui1 = np.unravel_index(i1</span><span class="s2">, </span><span class="s1">a.shape)</span>
        <span class="s1">ui2 = np.unravel_index(i2</span><span class="s2">, </span><span class="s1">b.shape)</span>
        <span class="s1">ea = np.array([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">8</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(ea</span><span class="s2">, </span><span class="s1">a[ui1])</span>
        <span class="s1">assert_array_equal(ea</span><span class="s2">, </span><span class="s1">b[ui2])</span>

        <span class="s3"># non1d, not assumed to be uniqueinputs</span>
        <span class="s1">a = np.array([[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">6</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">4</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]])</span>
        <span class="s1">b = np.array([[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">7</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">10</span><span class="s2">, </span><span class="s4">12</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">7</span><span class="s1">]])</span>
        <span class="s1">c</span><span class="s2">, </span><span class="s1">i1</span><span class="s2">, </span><span class="s1">i2 = intersect1d(a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">return_indices=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">ui1 = np.unravel_index(i1</span><span class="s2">, </span><span class="s1">a.shape)</span>
        <span class="s1">ui2 = np.unravel_index(i2</span><span class="s2">, </span><span class="s1">b.shape)</span>
        <span class="s1">ea = np.array([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">8</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(ea</span><span class="s2">, </span><span class="s1">a[ui1])</span>
        <span class="s1">assert_array_equal(ea</span><span class="s2">, </span><span class="s1">b[ui2])</span>

    <span class="s2">def </span><span class="s1">test_setxor1d(self):</span>
        <span class="s1">a = np.array([</span><span class="s4">5</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">])</span>
        <span class="s1">b = np.array([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">5</span><span class="s1">])</span>

        <span class="s1">ec = np.array([</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">7</span><span class="s1">])</span>
        <span class="s1">c = setxor1d(a</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s1">assert_array_equal(c</span><span class="s2">, </span><span class="s1">ec)</span>

        <span class="s1">a = np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">])</span>
        <span class="s1">b = np.array([</span><span class="s4">6</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">4</span><span class="s1">])</span>

        <span class="s1">ec = np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s1">])</span>
        <span class="s1">c = setxor1d(a</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s1">assert_array_equal(c</span><span class="s2">, </span><span class="s1">ec)</span>

        <span class="s1">a = np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">])</span>
        <span class="s1">b = np.array([</span><span class="s4">6</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">8</span><span class="s1">])</span>

        <span class="s1">ec = np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s1">])</span>
        <span class="s1">c = setxor1d(a</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s1">assert_array_equal(c</span><span class="s2">, </span><span class="s1">ec)</span>

        <span class="s1">assert_array_equal([]</span><span class="s2">, </span><span class="s1">setxor1d([]</span><span class="s2">, </span><span class="s1">[]))</span>

    <span class="s2">def </span><span class="s1">test_ediff1d(self):</span>
        <span class="s1">zero_elem = np.array([])</span>
        <span class="s1">one_elem = np.array([</span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">two_elem = np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">])</span>

        <span class="s1">assert_array_equal([]</span><span class="s2">, </span><span class="s1">ediff1d(zero_elem))</span>
        <span class="s1">assert_array_equal([</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ediff1d(zero_elem</span><span class="s2">, </span><span class="s1">to_begin=</span><span class="s4">0</span><span class="s1">))</span>
        <span class="s1">assert_array_equal([</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ediff1d(zero_elem</span><span class="s2">, </span><span class="s1">to_end=</span><span class="s4">0</span><span class="s1">))</span>
        <span class="s1">assert_array_equal([-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ediff1d(zero_elem</span><span class="s2">, </span><span class="s1">to_begin=-</span><span class="s4">1</span><span class="s2">, </span><span class="s1">to_end=</span><span class="s4">0</span><span class="s1">))</span>
        <span class="s1">assert_array_equal([]</span><span class="s2">, </span><span class="s1">ediff1d(one_elem))</span>
        <span class="s1">assert_array_equal([</span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ediff1d(two_elem))</span>
        <span class="s1">assert_array_equal([</span><span class="s4">7</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">9</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ediff1d(two_elem</span><span class="s2">, </span><span class="s1">to_begin=</span><span class="s4">7</span><span class="s2">, </span><span class="s1">to_end=</span><span class="s4">9</span><span class="s1">))</span>
        <span class="s1">assert_array_equal([</span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">8</span><span class="s1">]</span><span class="s2">,</span>
                           <span class="s1">ediff1d(two_elem</span><span class="s2">, </span><span class="s1">to_begin=[</span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s1">]</span><span class="s2">, </span><span class="s1">to_end=[</span><span class="s4">7</span><span class="s2">, </span><span class="s4">8</span><span class="s1">]))</span>
        <span class="s1">assert_array_equal([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">9</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ediff1d(two_elem</span><span class="s2">, </span><span class="s1">to_end=</span><span class="s4">9</span><span class="s1">))</span>
        <span class="s1">assert_array_equal([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">8</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ediff1d(two_elem</span><span class="s2">, </span><span class="s1">to_end=[</span><span class="s4">7</span><span class="s2">, </span><span class="s4">8</span><span class="s1">]))</span>
        <span class="s1">assert_array_equal([</span><span class="s4">7</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ediff1d(two_elem</span><span class="s2">, </span><span class="s1">to_begin=</span><span class="s4">7</span><span class="s1">))</span>
        <span class="s1">assert_array_equal([</span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ediff1d(two_elem</span><span class="s2">, </span><span class="s1">to_begin=[</span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s1">]))</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s5">&quot;ary, prepend, append, expected&quot;</span><span class="s2">, </span><span class="s1">[</span>
        <span class="s3"># should fail because trying to cast</span>
        <span class="s3"># np.nan standard floating point value</span>
        <span class="s3"># into an integer array:</span>
        <span class="s1">(np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.int64)</span><span class="s2">,</span>
         <span class="s2">None,</span>
         <span class="s1">np.nan</span><span class="s2">,</span>
         <span class="s5">'to_end'</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s3"># should fail because attempting</span>
        <span class="s3"># to downcast to int type:</span>
        <span class="s1">(np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.int64)</span><span class="s2">,</span>
         <span class="s1">np.array([</span><span class="s4">5</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.float32)</span><span class="s2">,</span>
         <span class="s2">None,</span>
         <span class="s5">'to_begin'</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s3"># should fail because attempting to cast</span>
        <span class="s3"># two special floating point values</span>
        <span class="s3"># to integers (on both sides of ary),</span>
        <span class="s3"># `to_begin` is in the error message as the impl checks this first:</span>
        <span class="s1">(np.array([</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">3.</span><span class="s2">, </span><span class="s4">9.</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.int8)</span><span class="s2">,</span>
         <span class="s1">np.nan</span><span class="s2">,</span>
         <span class="s1">np.nan</span><span class="s2">,</span>
         <span class="s5">'to_begin'</span><span class="s1">)</span><span class="s2">,</span>
         <span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_ediff1d_forbidden_type_casts(self</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">prepend</span><span class="s2">, </span><span class="s1">append</span><span class="s2">, </span><span class="s1">expected):</span>
        <span class="s3"># verify resolution of gh-11490</span>

        <span class="s3"># specifically, raise an appropriate</span>
        <span class="s3"># Exception when attempting to append or</span>
        <span class="s3"># prepend with an incompatible type</span>
        <span class="s1">msg = </span><span class="s5">'dtype of `{}` must be compatible'</span><span class="s1">.format(expected)</span>
        <span class="s2">with </span><span class="s1">assert_raises_regex(TypeError</span><span class="s2">, </span><span class="s1">msg):</span>
            <span class="s1">ediff1d(ary=ary</span><span class="s2">,</span>
                    <span class="s1">to_end=append</span><span class="s2">,</span>
                    <span class="s1">to_begin=prepend)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s5">&quot;ary,prepend,append,expected&quot;</span><span class="s2">,</span>
        <span class="s1">[</span>
         <span class="s1">(np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.int16)</span><span class="s2">,</span>
          <span class="s4">2</span><span class="s1">**</span><span class="s4">16</span><span class="s2">,  </span><span class="s3"># will be cast to int16 under same kind rule.</span>
          <span class="s4">2</span><span class="s1">**</span><span class="s4">16 </span><span class="s1">+ </span><span class="s4">4</span><span class="s2">,</span>
          <span class="s1">np.array([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.int16))</span><span class="s2">,</span>
         <span class="s1">(np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.float32)</span><span class="s2">,</span>
          <span class="s1">np.array([</span><span class="s4">5</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.float64)</span><span class="s2">,</span>
          <span class="s2">None,</span>
          <span class="s1">np.array([</span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.float32))</span><span class="s2">,</span>
         <span class="s1">(np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.int32)</span><span class="s2">,</span>
          <span class="s4">0</span><span class="s2">,</span>
          <span class="s4">0</span><span class="s2">,</span>
          <span class="s1">np.array([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.int32))</span><span class="s2">,</span>
         <span class="s1">(np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.int64)</span><span class="s2">,</span>
          <span class="s4">3</span><span class="s2">,</span>
          <span class="s1">-</span><span class="s4">9</span><span class="s2">,</span>
          <span class="s1">np.array([</span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">-</span><span class="s4">9</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.int64))</span><span class="s2">,</span>
        <span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_ediff1d_scalar_handling(self</span><span class="s2">,</span>
                                     <span class="s1">ary</span><span class="s2">,</span>
                                     <span class="s1">prepend</span><span class="s2">,</span>
                                     <span class="s1">append</span><span class="s2">,</span>
                                     <span class="s1">expected):</span>
        <span class="s3"># maintain backwards-compatibility</span>
        <span class="s3"># of scalar prepend / append behavior</span>
        <span class="s3"># in ediff1d following fix for gh-11490</span>
        <span class="s1">actual = np.ediff1d(ary=ary</span><span class="s2">,</span>
                            <span class="s1">to_end=append</span><span class="s2">,</span>
                            <span class="s1">to_begin=prepend)</span>
        <span class="s1">assert_equal(actual</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s2">assert </span><span class="s1">actual.dtype == expected.dtype</span>

    <span class="s2">def </span><span class="s1">test_isin(self):</span>
        <span class="s3"># the tests for in1d cover most of isin's behavior</span>
        <span class="s3"># if in1d is removed, would need to change those tests to test</span>
        <span class="s3"># isin instead.</span>
        <span class="s2">def </span><span class="s1">_isin_slow(a</span><span class="s2">, </span><span class="s1">b):</span>
            <span class="s1">b = np.asarray(b).flatten().tolist()</span>
            <span class="s2">return </span><span class="s1">a </span><span class="s2">in </span><span class="s1">b</span>
        <span class="s1">isin_slow = np.vectorize(_isin_slow</span><span class="s2">, </span><span class="s1">otypes=[bool]</span><span class="s2">, </span><span class="s1">excluded={</span><span class="s4">1</span><span class="s1">})</span>

        <span class="s2">def </span><span class="s1">assert_isin_equal(a</span><span class="s2">, </span><span class="s1">b):</span>
            <span class="s1">x = isin(a</span><span class="s2">, </span><span class="s1">b)</span>
            <span class="s1">y = isin_slow(a</span><span class="s2">, </span><span class="s1">b)</span>
            <span class="s1">assert_array_equal(x</span><span class="s2">, </span><span class="s1">y)</span>

        <span class="s3"># multidimensional arrays in both arguments</span>
        <span class="s1">a = np.arange(</span><span class="s4">24</span><span class="s1">).reshape([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">])</span>
        <span class="s1">b = np.array([[</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s4">30</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">11</span><span class="s2">, </span><span class="s4">22</span><span class="s2">, </span><span class="s4">33</span><span class="s1">]])</span>
        <span class="s1">assert_isin_equal(a</span><span class="s2">, </span><span class="s1">b)</span>

        <span class="s3"># array-likes as both arguments</span>
        <span class="s1">c = [(</span><span class="s4">9</span><span class="s2">, </span><span class="s4">8</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">7</span><span class="s2">, </span><span class="s4">6</span><span class="s1">)]</span>
        <span class="s1">d = (</span><span class="s4">9</span><span class="s2">, </span><span class="s4">7</span><span class="s1">)</span>
        <span class="s1">assert_isin_equal(c</span><span class="s2">, </span><span class="s1">d)</span>

        <span class="s3"># zero-d array:</span>
        <span class="s1">f = np.array(</span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">assert_isin_equal(f</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s1">assert_isin_equal(a</span><span class="s2">, </span><span class="s1">f)</span>
        <span class="s1">assert_isin_equal(f</span><span class="s2">, </span><span class="s1">f)</span>

        <span class="s3"># scalar:</span>
        <span class="s1">assert_isin_equal(</span><span class="s4">5</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s1">assert_isin_equal(a</span><span class="s2">, </span><span class="s4">6</span><span class="s1">)</span>
        <span class="s1">assert_isin_equal(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s1">)</span>

        <span class="s3"># empty array-like:</span>
        <span class="s1">x = []</span>
        <span class="s1">assert_isin_equal(x</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s1">assert_isin_equal(a</span><span class="s2">, </span><span class="s1">x)</span>
        <span class="s1">assert_isin_equal(x</span><span class="s2">, </span><span class="s1">x)</span>

    <span class="s2">def </span><span class="s1">test_in1d(self):</span>
        <span class="s3"># we use two different sizes for the b array here to test the</span>
        <span class="s3"># two different paths in in1d().</span>
        <span class="s2">for </span><span class="s1">mult </span><span class="s2">in </span><span class="s1">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s1">):</span>
            <span class="s3"># One check without np.array to make sure lists are handled correct</span>
            <span class="s1">a = [</span><span class="s4">5</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span>
            <span class="s1">b = [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">5</span><span class="s1">] * mult</span>
            <span class="s1">ec = np.array([</span><span class="s2">True, False, True, True</span><span class="s1">])</span>
            <span class="s1">c = in1d(a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">assume_unique=</span><span class="s2">True</span><span class="s1">)</span>
            <span class="s1">assert_array_equal(c</span><span class="s2">, </span><span class="s1">ec)</span>

            <span class="s1">a[</span><span class="s4">0</span><span class="s1">] = </span><span class="s4">8</span>
            <span class="s1">ec = np.array([</span><span class="s2">False, False, True, True</span><span class="s1">])</span>
            <span class="s1">c = in1d(a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">assume_unique=</span><span class="s2">True</span><span class="s1">)</span>
            <span class="s1">assert_array_equal(c</span><span class="s2">, </span><span class="s1">ec)</span>

            <span class="s1">a[</span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">a[</span><span class="s4">3</span><span class="s1">] = </span><span class="s4">4</span><span class="s2">, </span><span class="s4">8</span>
            <span class="s1">ec = np.array([</span><span class="s2">True, False, True, False</span><span class="s1">])</span>
            <span class="s1">c = in1d(a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">assume_unique=</span><span class="s2">True</span><span class="s1">)</span>
            <span class="s1">assert_array_equal(c</span><span class="s2">, </span><span class="s1">ec)</span>

            <span class="s1">a = np.array([</span><span class="s4">5</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">5</span><span class="s1">])</span>
            <span class="s1">b = [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">] * mult</span>
            <span class="s1">ec = [</span><span class="s2">False, True, False, True, True, True, True, True, True,</span>
                  <span class="s2">False, True, False, False, False</span><span class="s1">]</span>
            <span class="s1">c = in1d(a</span><span class="s2">, </span><span class="s1">b)</span>
            <span class="s1">assert_array_equal(c</span><span class="s2">, </span><span class="s1">ec)</span>

            <span class="s1">b = b + [</span><span class="s4">5</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">4</span><span class="s1">] * mult</span>
            <span class="s1">ec = [</span><span class="s2">True, True, True, True, True, True, True, True, True, True,</span>
                  <span class="s2">True, False, True, True</span><span class="s1">]</span>
            <span class="s1">c = in1d(a</span><span class="s2">, </span><span class="s1">b)</span>
            <span class="s1">assert_array_equal(c</span><span class="s2">, </span><span class="s1">ec)</span>

            <span class="s1">a = np.array([</span><span class="s4">5</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">])</span>
            <span class="s1">b = np.array([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">5</span><span class="s1">] * mult)</span>
            <span class="s1">ec = np.array([</span><span class="s2">True, False, True, True</span><span class="s1">])</span>
            <span class="s1">c = in1d(a</span><span class="s2">, </span><span class="s1">b)</span>
            <span class="s1">assert_array_equal(c</span><span class="s2">, </span><span class="s1">ec)</span>

            <span class="s1">a = np.array([</span><span class="s4">5</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">])</span>
            <span class="s1">b = np.array([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">5</span><span class="s1">] * mult)</span>
            <span class="s1">ec = np.array([</span><span class="s2">True, False, True, True, True</span><span class="s1">])</span>
            <span class="s1">c = in1d(a</span><span class="s2">, </span><span class="s1">b)</span>
            <span class="s1">assert_array_equal(c</span><span class="s2">, </span><span class="s1">ec)</span>

            <span class="s1">a = np.array([</span><span class="s4">5</span><span class="s2">, </span><span class="s4">5</span><span class="s1">])</span>
            <span class="s1">b = np.array([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">] * mult)</span>
            <span class="s1">ec = np.array([</span><span class="s2">False, False</span><span class="s1">])</span>
            <span class="s1">c = in1d(a</span><span class="s2">, </span><span class="s1">b)</span>
            <span class="s1">assert_array_equal(c</span><span class="s2">, </span><span class="s1">ec)</span>

        <span class="s1">a = np.array([</span><span class="s4">5</span><span class="s1">])</span>
        <span class="s1">b = np.array([</span><span class="s4">2</span><span class="s1">])</span>
        <span class="s1">ec = np.array([</span><span class="s2">False</span><span class="s1">])</span>
        <span class="s1">c = in1d(a</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s1">assert_array_equal(c</span><span class="s2">, </span><span class="s1">ec)</span>

        <span class="s1">assert_array_equal(in1d([]</span><span class="s2">, </span><span class="s1">[])</span><span class="s2">, </span><span class="s1">[])</span>

    <span class="s2">def </span><span class="s1">test_in1d_char_array(self):</span>
        <span class="s1">a = np.array([</span><span class="s5">'a'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">, </span><span class="s5">'c'</span><span class="s2">, </span><span class="s5">'d'</span><span class="s2">, </span><span class="s5">'e'</span><span class="s2">, </span><span class="s5">'c'</span><span class="s2">, </span><span class="s5">'e'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s1">])</span>
        <span class="s1">b = np.array([</span><span class="s5">'a'</span><span class="s2">, </span><span class="s5">'c'</span><span class="s1">])</span>

        <span class="s1">ec = np.array([</span><span class="s2">True, False, True, False, False, True, False, False</span><span class="s1">])</span>
        <span class="s1">c = in1d(a</span><span class="s2">, </span><span class="s1">b)</span>

        <span class="s1">assert_array_equal(c</span><span class="s2">, </span><span class="s1">ec)</span>

    <span class="s2">def </span><span class="s1">test_in1d_invert(self):</span>
        <span class="s0">&quot;Test in1d's invert parameter&quot;</span>
        <span class="s3"># We use two different sizes for the b array here to test the</span>
        <span class="s3"># two different paths in in1d().</span>
        <span class="s2">for </span><span class="s1">mult </span><span class="s2">in </span><span class="s1">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s1">):</span>
            <span class="s1">a = np.array([</span><span class="s4">5</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">5</span><span class="s1">])</span>
            <span class="s1">b = [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">] * mult</span>
            <span class="s1">assert_array_equal(np.invert(in1d(a</span><span class="s2">, </span><span class="s1">b))</span><span class="s2">, </span><span class="s1">in1d(a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">invert=</span><span class="s2">True</span><span class="s1">))</span>

    <span class="s2">def </span><span class="s1">test_in1d_ravel(self):</span>
        <span class="s3"># Test that in1d ravels its input arrays. This is not documented</span>
        <span class="s3"># behavior however. The test is to ensure consistentency.</span>
        <span class="s1">a = np.arange(</span><span class="s4">6</span><span class="s1">).reshape(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">b = np.arange(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">9</span><span class="s1">).reshape(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">long_b = np.arange(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">63</span><span class="s1">).reshape(</span><span class="s4">30</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">ec = np.array([</span><span class="s2">False, False, False, True, True, True</span><span class="s1">])</span>

        <span class="s1">assert_array_equal(in1d(a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">assume_unique=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">ec)</span>
        <span class="s1">assert_array_equal(in1d(a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">assume_unique=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">ec)</span>
        <span class="s1">assert_array_equal(in1d(a</span><span class="s2">, </span><span class="s1">long_b</span><span class="s2">, </span><span class="s1">assume_unique=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">ec)</span>
        <span class="s1">assert_array_equal(in1d(a</span><span class="s2">, </span><span class="s1">long_b</span><span class="s2">, </span><span class="s1">assume_unique=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">ec)</span>

    <span class="s2">def </span><span class="s1">test_in1d_first_array_is_object(self):</span>
        <span class="s1">ar1 = [</span><span class="s2">None</span><span class="s1">]</span>
        <span class="s1">ar2 = np.array([</span><span class="s4">1</span><span class="s1">]*</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">expected = np.array([</span><span class="s2">False</span><span class="s1">])</span>
        <span class="s1">result = np.in1d(ar1</span><span class="s2">, </span><span class="s1">ar2)</span>
        <span class="s1">assert_array_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_in1d_second_array_is_object(self):</span>
        <span class="s1">ar1 = </span><span class="s4">1</span>
        <span class="s1">ar2 = np.array([</span><span class="s2">None</span><span class="s1">]*</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">expected = np.array([</span><span class="s2">False</span><span class="s1">])</span>
        <span class="s1">result = np.in1d(ar1</span><span class="s2">, </span><span class="s1">ar2)</span>
        <span class="s1">assert_array_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_in1d_both_arrays_are_object(self):</span>
        <span class="s1">ar1 = [</span><span class="s2">None</span><span class="s1">]</span>
        <span class="s1">ar2 = np.array([</span><span class="s2">None</span><span class="s1">]*</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">expected = np.array([</span><span class="s2">True</span><span class="s1">])</span>
        <span class="s1">result = np.in1d(ar1</span><span class="s2">, </span><span class="s1">ar2)</span>
        <span class="s1">assert_array_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_in1d_both_arrays_have_structured_dtype(self):</span>
        <span class="s3"># Test arrays of a structured data type containing an integer field</span>
        <span class="s3"># and a field of dtype `object` allowing for arbitrary Python objects</span>
        <span class="s1">dt = np.dtype([(</span><span class="s5">'field1'</span><span class="s2">, </span><span class="s1">int)</span><span class="s2">, </span><span class="s1">(</span><span class="s5">'field2'</span><span class="s2">, </span><span class="s1">object)])</span>
        <span class="s1">ar1 = np.array([(</span><span class="s4">1</span><span class="s2">, None</span><span class="s1">)]</span><span class="s2">, </span><span class="s1">dtype=dt)</span>
        <span class="s1">ar2 = np.array([(</span><span class="s4">1</span><span class="s2">, None</span><span class="s1">)]*</span><span class="s4">10</span><span class="s2">, </span><span class="s1">dtype=dt)</span>
        <span class="s1">expected = np.array([</span><span class="s2">True</span><span class="s1">])</span>
        <span class="s1">result = np.in1d(ar1</span><span class="s2">, </span><span class="s1">ar2)</span>
        <span class="s1">assert_array_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_in1d_with_arrays_containing_tuples(self):</span>
        <span class="s1">ar1 = np.array([(</span><span class="s4">1</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=object)</span>
        <span class="s1">ar2 = np.array([(</span><span class="s4">1</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=object)</span>
        <span class="s1">expected = np.array([</span><span class="s2">True, True</span><span class="s1">])</span>
        <span class="s1">result = np.in1d(ar1</span><span class="s2">, </span><span class="s1">ar2)</span>
        <span class="s1">assert_array_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">result = np.in1d(ar1</span><span class="s2">, </span><span class="s1">ar2</span><span class="s2">, </span><span class="s1">invert=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(result</span><span class="s2">, </span><span class="s1">np.invert(expected))</span>

        <span class="s3"># An integer is added at the end of the array to make sure</span>
        <span class="s3"># that the array builder will create the array with tuples</span>
        <span class="s3"># and after it's created the integer is removed.</span>
        <span class="s3"># There's a bug in the array constructor that doesn't handle</span>
        <span class="s3"># tuples properly and adding the integer fixes that.</span>
        <span class="s1">ar1 = np.array([(</span><span class="s4">1</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=object)</span>
        <span class="s1">ar1 = ar1[:-</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">ar2 = np.array([(</span><span class="s4">1</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=object)</span>
        <span class="s1">ar2 = ar2[:-</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">expected = np.array([</span><span class="s2">True, True</span><span class="s1">])</span>
        <span class="s1">result = np.in1d(ar1</span><span class="s2">, </span><span class="s1">ar2)</span>
        <span class="s1">assert_array_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">result = np.in1d(ar1</span><span class="s2">, </span><span class="s1">ar2</span><span class="s2">, </span><span class="s1">invert=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(result</span><span class="s2">, </span><span class="s1">np.invert(expected))</span>

        <span class="s1">ar1 = np.array([(</span><span class="s4">1</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=object)</span>
        <span class="s1">ar1 = ar1[:-</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">ar2 = np.array([(</span><span class="s4">1</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=object)</span>
        <span class="s1">expected = np.array([</span><span class="s2">True, False</span><span class="s1">])</span>
        <span class="s1">result = np.in1d(ar1</span><span class="s2">, </span><span class="s1">ar2)</span>
        <span class="s1">assert_array_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>
        <span class="s1">result = np.in1d(ar1</span><span class="s2">, </span><span class="s1">ar2</span><span class="s2">, </span><span class="s1">invert=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(result</span><span class="s2">, </span><span class="s1">np.invert(expected))</span>

    <span class="s2">def </span><span class="s1">test_union1d(self):</span>
        <span class="s1">a = np.array([</span><span class="s4">5</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">])</span>
        <span class="s1">b = np.array([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">5</span><span class="s1">])</span>

        <span class="s1">ec = np.array([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">7</span><span class="s1">])</span>
        <span class="s1">c = union1d(a</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s1">assert_array_equal(c</span><span class="s2">, </span><span class="s1">ec)</span>

        <span class="s3"># Tests gh-10340, arguments to union1d should be</span>
        <span class="s3"># flattened if they are not already 1D</span>
        <span class="s1">x = np.array([[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s1">]])</span>
        <span class="s1">y = np.array([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">])</span>
        <span class="s1">ez = np.array([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s1">])</span>
        <span class="s1">z = union1d(x</span><span class="s2">, </span><span class="s1">y)</span>
        <span class="s1">assert_array_equal(z</span><span class="s2">, </span><span class="s1">ez)</span>

        <span class="s1">assert_array_equal([]</span><span class="s2">, </span><span class="s1">union1d([]</span><span class="s2">, </span><span class="s1">[]))</span>

    <span class="s2">def </span><span class="s1">test_setdiff1d(self):</span>
        <span class="s1">a = np.array([</span><span class="s4">6</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">4</span><span class="s1">])</span>
        <span class="s1">b = np.array([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">5</span><span class="s1">])</span>

        <span class="s1">ec = np.array([</span><span class="s4">6</span><span class="s2">, </span><span class="s4">7</span><span class="s1">])</span>
        <span class="s1">c = setdiff1d(a</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s1">assert_array_equal(c</span><span class="s2">, </span><span class="s1">ec)</span>

        <span class="s1">a = np.arange(</span><span class="s4">21</span><span class="s1">)</span>
        <span class="s1">b = np.arange(</span><span class="s4">19</span><span class="s1">)</span>
        <span class="s1">ec = np.array([</span><span class="s4">19</span><span class="s2">, </span><span class="s4">20</span><span class="s1">])</span>
        <span class="s1">c = setdiff1d(a</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s1">assert_array_equal(c</span><span class="s2">, </span><span class="s1">ec)</span>

        <span class="s1">assert_array_equal([]</span><span class="s2">, </span><span class="s1">setdiff1d([]</span><span class="s2">, </span><span class="s1">[]))</span>
        <span class="s1">a = np.array(()</span><span class="s2">, </span><span class="s1">np.uint32)</span>
        <span class="s1">assert_equal(setdiff1d(a</span><span class="s2">, </span><span class="s1">[]).dtype</span><span class="s2">, </span><span class="s1">np.uint32)</span>

    <span class="s2">def </span><span class="s1">test_setdiff1d_unique(self):</span>
        <span class="s1">a = np.array([</span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">b = np.array([</span><span class="s4">7</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">2</span><span class="s1">])</span>
        <span class="s1">expected = np.array([</span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">actual = setdiff1d(a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">assume_unique=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(actual</span><span class="s2">, </span><span class="s1">expected)</span>

    <span class="s2">def </span><span class="s1">test_setdiff1d_char_array(self):</span>
        <span class="s1">a = np.array([</span><span class="s5">'a'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">, </span><span class="s5">'c'</span><span class="s1">])</span>
        <span class="s1">b = np.array([</span><span class="s5">'a'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">, </span><span class="s5">'s'</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(setdiff1d(a</span><span class="s2">, </span><span class="s1">b)</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s5">'c'</span><span class="s1">]))</span>

    <span class="s2">def </span><span class="s1">test_manyways(self):</span>
        <span class="s1">a = np.array([</span><span class="s4">5</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">8</span><span class="s1">])</span>
        <span class="s1">b = np.array([</span><span class="s4">9</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">5</span><span class="s1">])</span>

        <span class="s1">c1 = setxor1d(a</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s1">aux1 = intersect1d(a</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s1">aux2 = union1d(a</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s1">c2 = setdiff1d(aux2</span><span class="s2">, </span><span class="s1">aux1)</span>
        <span class="s1">assert_array_equal(c1</span><span class="s2">, </span><span class="s1">c2)</span>


<span class="s2">class </span><span class="s1">TestUnique:</span>

    <span class="s2">def </span><span class="s1">test_unique_1d(self):</span>

        <span class="s2">def </span><span class="s1">check_all(a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">i1</span><span class="s2">, </span><span class="s1">i2</span><span class="s2">, </span><span class="s1">c</span><span class="s2">, </span><span class="s1">dt):</span>
            <span class="s1">base_msg = </span><span class="s5">'check {0} failed for type {1}'</span>

            <span class="s1">msg = base_msg.format(</span><span class="s5">'values'</span><span class="s2">, </span><span class="s1">dt)</span>
            <span class="s1">v = unique(a)</span>
            <span class="s1">assert_array_equal(v</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">msg)</span>

            <span class="s1">msg = base_msg.format(</span><span class="s5">'return_index'</span><span class="s2">, </span><span class="s1">dt)</span>
            <span class="s1">v</span><span class="s2">, </span><span class="s1">j = unique(a</span><span class="s2">, True, False, False</span><span class="s1">)</span>
            <span class="s1">assert_array_equal(v</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">msg)</span>
            <span class="s1">assert_array_equal(j</span><span class="s2">, </span><span class="s1">i1</span><span class="s2">, </span><span class="s1">msg)</span>

            <span class="s1">msg = base_msg.format(</span><span class="s5">'return_inverse'</span><span class="s2">, </span><span class="s1">dt)</span>
            <span class="s1">v</span><span class="s2">, </span><span class="s1">j = unique(a</span><span class="s2">, False, True, False</span><span class="s1">)</span>
            <span class="s1">assert_array_equal(v</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">msg)</span>
            <span class="s1">assert_array_equal(j</span><span class="s2">, </span><span class="s1">i2</span><span class="s2">, </span><span class="s1">msg)</span>

            <span class="s1">msg = base_msg.format(</span><span class="s5">'return_counts'</span><span class="s2">, </span><span class="s1">dt)</span>
            <span class="s1">v</span><span class="s2">, </span><span class="s1">j = unique(a</span><span class="s2">, False, False, True</span><span class="s1">)</span>
            <span class="s1">assert_array_equal(v</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">msg)</span>
            <span class="s1">assert_array_equal(j</span><span class="s2">, </span><span class="s1">c</span><span class="s2">, </span><span class="s1">msg)</span>

            <span class="s1">msg = base_msg.format(</span><span class="s5">'return_index and return_inverse'</span><span class="s2">, </span><span class="s1">dt)</span>
            <span class="s1">v</span><span class="s2">, </span><span class="s1">j1</span><span class="s2">, </span><span class="s1">j2 = unique(a</span><span class="s2">, True, True, False</span><span class="s1">)</span>
            <span class="s1">assert_array_equal(v</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">msg)</span>
            <span class="s1">assert_array_equal(j1</span><span class="s2">, </span><span class="s1">i1</span><span class="s2">, </span><span class="s1">msg)</span>
            <span class="s1">assert_array_equal(j2</span><span class="s2">, </span><span class="s1">i2</span><span class="s2">, </span><span class="s1">msg)</span>

            <span class="s1">msg = base_msg.format(</span><span class="s5">'return_index and return_counts'</span><span class="s2">, </span><span class="s1">dt)</span>
            <span class="s1">v</span><span class="s2">, </span><span class="s1">j1</span><span class="s2">, </span><span class="s1">j2 = unique(a</span><span class="s2">, True, False, True</span><span class="s1">)</span>
            <span class="s1">assert_array_equal(v</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">msg)</span>
            <span class="s1">assert_array_equal(j1</span><span class="s2">, </span><span class="s1">i1</span><span class="s2">, </span><span class="s1">msg)</span>
            <span class="s1">assert_array_equal(j2</span><span class="s2">, </span><span class="s1">c</span><span class="s2">, </span><span class="s1">msg)</span>

            <span class="s1">msg = base_msg.format(</span><span class="s5">'return_inverse and return_counts'</span><span class="s2">, </span><span class="s1">dt)</span>
            <span class="s1">v</span><span class="s2">, </span><span class="s1">j1</span><span class="s2">, </span><span class="s1">j2 = unique(a</span><span class="s2">, False, True, True</span><span class="s1">)</span>
            <span class="s1">assert_array_equal(v</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">msg)</span>
            <span class="s1">assert_array_equal(j1</span><span class="s2">, </span><span class="s1">i2</span><span class="s2">, </span><span class="s1">msg)</span>
            <span class="s1">assert_array_equal(j2</span><span class="s2">, </span><span class="s1">c</span><span class="s2">, </span><span class="s1">msg)</span>

            <span class="s1">msg = base_msg.format((</span><span class="s5">'return_index, return_inverse '</span>
                                   <span class="s5">'and return_counts'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">dt)</span>
            <span class="s1">v</span><span class="s2">, </span><span class="s1">j1</span><span class="s2">, </span><span class="s1">j2</span><span class="s2">, </span><span class="s1">j3 = unique(a</span><span class="s2">, True, True, True</span><span class="s1">)</span>
            <span class="s1">assert_array_equal(v</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">msg)</span>
            <span class="s1">assert_array_equal(j1</span><span class="s2">, </span><span class="s1">i1</span><span class="s2">, </span><span class="s1">msg)</span>
            <span class="s1">assert_array_equal(j2</span><span class="s2">, </span><span class="s1">i2</span><span class="s2">, </span><span class="s1">msg)</span>
            <span class="s1">assert_array_equal(j3</span><span class="s2">, </span><span class="s1">c</span><span class="s2">, </span><span class="s1">msg)</span>

        <span class="s1">a = [</span><span class="s4">5</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">7</span><span class="s1">]*</span><span class="s4">10</span>
        <span class="s1">b = [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">7</span><span class="s1">]</span>
        <span class="s1">i1 = [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">i2 = [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]*</span><span class="s4">10</span>
        <span class="s1">c = np.multiply([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span><span class="s2">, </span><span class="s4">10</span><span class="s1">)</span>

        <span class="s3"># test for numeric arrays</span>
        <span class="s1">types = []</span>
        <span class="s1">types.extend(np.typecodes[</span><span class="s5">'AllInteger'</span><span class="s1">])</span>
        <span class="s1">types.extend(np.typecodes[</span><span class="s5">'AllFloat'</span><span class="s1">])</span>
        <span class="s1">types.append(</span><span class="s5">'datetime64[D]'</span><span class="s1">)</span>
        <span class="s1">types.append(</span><span class="s5">'timedelta64[D]'</span><span class="s1">)</span>
        <span class="s2">for </span><span class="s1">dt </span><span class="s2">in </span><span class="s1">types:</span>
            <span class="s1">aa = np.array(a</span><span class="s2">, </span><span class="s1">dt)</span>
            <span class="s1">bb = np.array(b</span><span class="s2">, </span><span class="s1">dt)</span>
            <span class="s1">check_all(aa</span><span class="s2">, </span><span class="s1">bb</span><span class="s2">, </span><span class="s1">i1</span><span class="s2">, </span><span class="s1">i2</span><span class="s2">, </span><span class="s1">c</span><span class="s2">, </span><span class="s1">dt)</span>

        <span class="s3"># test for object arrays</span>
        <span class="s1">dt = </span><span class="s5">'O'</span>
        <span class="s1">aa = np.empty(len(a)</span><span class="s2">, </span><span class="s1">dt)</span>
        <span class="s1">aa[:] = a</span>
        <span class="s1">bb = np.empty(len(b)</span><span class="s2">, </span><span class="s1">dt)</span>
        <span class="s1">bb[:] = b</span>
        <span class="s1">check_all(aa</span><span class="s2">, </span><span class="s1">bb</span><span class="s2">, </span><span class="s1">i1</span><span class="s2">, </span><span class="s1">i2</span><span class="s2">, </span><span class="s1">c</span><span class="s2">, </span><span class="s1">dt)</span>

        <span class="s3"># test for structured arrays</span>
        <span class="s1">dt = [(</span><span class="s5">''</span><span class="s2">, </span><span class="s5">'i'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s5">''</span><span class="s2">, </span><span class="s5">'i'</span><span class="s1">)]</span>
        <span class="s1">aa = np.array(list(zip(a</span><span class="s2">, </span><span class="s1">a))</span><span class="s2">, </span><span class="s1">dt)</span>
        <span class="s1">bb = np.array(list(zip(b</span><span class="s2">, </span><span class="s1">b))</span><span class="s2">, </span><span class="s1">dt)</span>
        <span class="s1">check_all(aa</span><span class="s2">, </span><span class="s1">bb</span><span class="s2">, </span><span class="s1">i1</span><span class="s2">, </span><span class="s1">i2</span><span class="s2">, </span><span class="s1">c</span><span class="s2">, </span><span class="s1">dt)</span>

        <span class="s3"># test for ticket #2799</span>
        <span class="s1">aa = [</span><span class="s4">1. </span><span class="s1">+ </span><span class="s4">0.j</span><span class="s2">, </span><span class="s4">1 </span><span class="s1">- </span><span class="s4">1.j</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">assert_array_equal(np.unique(aa)</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1. </span><span class="s1">- </span><span class="s4">1.j</span><span class="s2">, </span><span class="s4">1. </span><span class="s1">+ </span><span class="s4">0.j</span><span class="s1">])</span>

        <span class="s3"># test for ticket #4785</span>
        <span class="s1">a = [(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)]</span>
        <span class="s1">unq = [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span>
        <span class="s1">inv = [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span>
        <span class="s1">a1 = unique(a)</span>
        <span class="s1">assert_array_equal(a1</span><span class="s2">, </span><span class="s1">unq)</span>
        <span class="s1">a2</span><span class="s2">, </span><span class="s1">a2_inv = unique(a</span><span class="s2">, </span><span class="s1">return_inverse=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(a2</span><span class="s2">, </span><span class="s1">unq)</span>
        <span class="s1">assert_array_equal(a2_inv</span><span class="s2">, </span><span class="s1">inv)</span>

        <span class="s3"># test for chararrays with return_inverse (gh-5099)</span>
        <span class="s1">a = np.chararray(</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">a[...] = </span><span class="s5">''</span>
        <span class="s1">a2</span><span class="s2">, </span><span class="s1">a2_inv = np.unique(a</span><span class="s2">, </span><span class="s1">return_inverse=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(a2_inv</span><span class="s2">, </span><span class="s1">np.zeros(</span><span class="s4">5</span><span class="s1">))</span>

        <span class="s3"># test for ticket #9137</span>
        <span class="s1">a = []</span>
        <span class="s1">a1_idx = np.unique(a</span><span class="s2">, </span><span class="s1">return_index=</span><span class="s2">True</span><span class="s1">)[</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">a2_inv = np.unique(a</span><span class="s2">, </span><span class="s1">return_inverse=</span><span class="s2">True</span><span class="s1">)[</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">a3_idx</span><span class="s2">, </span><span class="s1">a3_inv = np.unique(a</span><span class="s2">, </span><span class="s1">return_index=</span><span class="s2">True,</span>
                                   <span class="s1">return_inverse=</span><span class="s2">True</span><span class="s1">)[</span><span class="s4">1</span><span class="s1">:]</span>
        <span class="s1">assert_equal(a1_idx.dtype</span><span class="s2">, </span><span class="s1">np.intp)</span>
        <span class="s1">assert_equal(a2_inv.dtype</span><span class="s2">, </span><span class="s1">np.intp)</span>
        <span class="s1">assert_equal(a3_idx.dtype</span><span class="s2">, </span><span class="s1">np.intp)</span>
        <span class="s1">assert_equal(a3_inv.dtype</span><span class="s2">, </span><span class="s1">np.intp)</span>

        <span class="s3"># test for ticket 2111 - float</span>
        <span class="s1">a = [</span><span class="s4">2.0</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s1">np.nan]</span>
        <span class="s1">ua = [</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">, </span><span class="s1">np.nan]</span>
        <span class="s1">ua_idx = [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">ua_inv = [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span>
        <span class="s1">ua_cnt = [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span>
        <span class="s1">assert_equal(np.unique(a)</span><span class="s2">, </span><span class="s1">ua)</span>
        <span class="s1">assert_equal(np.unique(a</span><span class="s2">, </span><span class="s1">return_index=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(ua</span><span class="s2">, </span><span class="s1">ua_idx))</span>
        <span class="s1">assert_equal(np.unique(a</span><span class="s2">, </span><span class="s1">return_inverse=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(ua</span><span class="s2">, </span><span class="s1">ua_inv))</span>
        <span class="s1">assert_equal(np.unique(a</span><span class="s2">, </span><span class="s1">return_counts=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(ua</span><span class="s2">, </span><span class="s1">ua_cnt))</span>

        <span class="s3"># test for ticket 2111 - complex</span>
        <span class="s1">a = [</span><span class="s4">2.0</span><span class="s1">-</span><span class="s4">1j</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">, </span><span class="s4">1.0</span><span class="s1">+</span><span class="s4">1j</span><span class="s2">, </span><span class="s1">complex(</span><span class="s4">0.0</span><span class="s2">, </span><span class="s1">np.nan)</span><span class="s2">, </span><span class="s1">complex(</span><span class="s4">1.0</span><span class="s2">, </span><span class="s1">np.nan)]</span>
        <span class="s1">ua = [</span><span class="s4">1.0</span><span class="s1">+</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">2.0</span><span class="s1">-</span><span class="s4">1j</span><span class="s2">, </span><span class="s1">complex(</span><span class="s4">0.0</span><span class="s2">, </span><span class="s1">np.nan)]</span>
        <span class="s1">ua_idx = [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span>
        <span class="s1">ua_inv = [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span>
        <span class="s1">ua_cnt = [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span>
        <span class="s1">assert_equal(np.unique(a)</span><span class="s2">, </span><span class="s1">ua)</span>
        <span class="s1">assert_equal(np.unique(a</span><span class="s2">, </span><span class="s1">return_index=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(ua</span><span class="s2">, </span><span class="s1">ua_idx))</span>
        <span class="s1">assert_equal(np.unique(a</span><span class="s2">, </span><span class="s1">return_inverse=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(ua</span><span class="s2">, </span><span class="s1">ua_inv))</span>
        <span class="s1">assert_equal(np.unique(a</span><span class="s2">, </span><span class="s1">return_counts=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(ua</span><span class="s2">, </span><span class="s1">ua_cnt))</span>

        <span class="s3"># test for ticket 2111 - datetime64</span>
        <span class="s1">nat = np.datetime64(</span><span class="s5">'nat'</span><span class="s1">)</span>
        <span class="s1">a = [np.datetime64(</span><span class="s5">'2020-12-26'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">nat</span><span class="s2">, </span><span class="s1">np.datetime64(</span><span class="s5">'2020-12-24'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">nat]</span>
        <span class="s1">ua = [np.datetime64(</span><span class="s5">'2020-12-24'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">np.datetime64(</span><span class="s5">'2020-12-26'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">nat]</span>
        <span class="s1">ua_idx = [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">ua_inv = [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span>
        <span class="s1">ua_cnt = [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span>
        <span class="s1">assert_equal(np.unique(a)</span><span class="s2">, </span><span class="s1">ua)</span>
        <span class="s1">assert_equal(np.unique(a</span><span class="s2">, </span><span class="s1">return_index=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(ua</span><span class="s2">, </span><span class="s1">ua_idx))</span>
        <span class="s1">assert_equal(np.unique(a</span><span class="s2">, </span><span class="s1">return_inverse=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(ua</span><span class="s2">, </span><span class="s1">ua_inv))</span>
        <span class="s1">assert_equal(np.unique(a</span><span class="s2">, </span><span class="s1">return_counts=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(ua</span><span class="s2">, </span><span class="s1">ua_cnt))</span>

        <span class="s3"># test for ticket 2111 - timedelta</span>
        <span class="s1">nat = np.timedelta64(</span><span class="s5">'nat'</span><span class="s1">)</span>
        <span class="s1">a = [np.timedelta64(</span><span class="s4">1</span><span class="s2">, </span><span class="s5">'D'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">nat</span><span class="s2">, </span><span class="s1">np.timedelta64(</span><span class="s4">1</span><span class="s2">, </span><span class="s5">'h'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">nat]</span>
        <span class="s1">ua = [np.timedelta64(</span><span class="s4">1</span><span class="s2">, </span><span class="s5">'h'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">np.timedelta64(</span><span class="s4">1</span><span class="s2">, </span><span class="s5">'D'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">nat]</span>
        <span class="s1">ua_idx = [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">ua_inv = [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span>
        <span class="s1">ua_cnt = [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">]</span>
        <span class="s1">assert_equal(np.unique(a)</span><span class="s2">, </span><span class="s1">ua)</span>
        <span class="s1">assert_equal(np.unique(a</span><span class="s2">, </span><span class="s1">return_index=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(ua</span><span class="s2">, </span><span class="s1">ua_idx))</span>
        <span class="s1">assert_equal(np.unique(a</span><span class="s2">, </span><span class="s1">return_inverse=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(ua</span><span class="s2">, </span><span class="s1">ua_inv))</span>
        <span class="s1">assert_equal(np.unique(a</span><span class="s2">, </span><span class="s1">return_counts=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(ua</span><span class="s2">, </span><span class="s1">ua_cnt))</span>

        <span class="s3"># test for gh-19300</span>
        <span class="s1">all_nans = [np.nan] * </span><span class="s4">4</span>
        <span class="s1">ua = [np.nan]</span>
        <span class="s1">ua_idx = [</span><span class="s4">0</span><span class="s1">]</span>
        <span class="s1">ua_inv = [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span>
        <span class="s1">ua_cnt = [</span><span class="s4">4</span><span class="s1">]</span>
        <span class="s1">assert_equal(np.unique(all_nans)</span><span class="s2">, </span><span class="s1">ua)</span>
        <span class="s1">assert_equal(np.unique(all_nans</span><span class="s2">, </span><span class="s1">return_index=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(ua</span><span class="s2">, </span><span class="s1">ua_idx))</span>
        <span class="s1">assert_equal(np.unique(all_nans</span><span class="s2">, </span><span class="s1">return_inverse=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(ua</span><span class="s2">, </span><span class="s1">ua_inv))</span>
        <span class="s1">assert_equal(np.unique(all_nans</span><span class="s2">, </span><span class="s1">return_counts=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(ua</span><span class="s2">, </span><span class="s1">ua_cnt))</span>

    <span class="s2">def </span><span class="s1">test_unique_axis_errors(self):</span>
        <span class="s1">assert_raises(TypeError</span><span class="s2">, </span><span class="s1">self._run_axis_tests</span><span class="s2">, </span><span class="s1">object)</span>
        <span class="s1">assert_raises(TypeError</span><span class="s2">, </span><span class="s1">self._run_axis_tests</span><span class="s2">,</span>
                      <span class="s1">[(</span><span class="s5">'a'</span><span class="s2">, </span><span class="s1">int)</span><span class="s2">, </span><span class="s1">(</span><span class="s5">'b'</span><span class="s2">, </span><span class="s1">object)])</span>

        <span class="s1">assert_raises(np.AxisError</span><span class="s2">, </span><span class="s1">unique</span><span class="s2">, </span><span class="s1">np.arange(</span><span class="s4">10</span><span class="s1">)</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">assert_raises(np.AxisError</span><span class="s2">, </span><span class="s1">unique</span><span class="s2">, </span><span class="s1">np.arange(</span><span class="s4">10</span><span class="s1">)</span><span class="s2">, </span><span class="s1">axis=-</span><span class="s4">2</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_unique_axis_list(self):</span>
        <span class="s1">msg = </span><span class="s5">&quot;Unique failed on list of lists&quot;</span>
        <span class="s1">inp = [[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]]</span>
        <span class="s1">inp_arr = np.asarray(inp)</span>
        <span class="s1">assert_array_equal(unique(inp</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">unique(inp_arr</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">msg)</span>
        <span class="s1">assert_array_equal(unique(inp</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">unique(inp_arr</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">msg)</span>

    <span class="s2">def </span><span class="s1">test_unique_axis(self):</span>
        <span class="s1">types = []</span>
        <span class="s1">types.extend(np.typecodes[</span><span class="s5">'AllInteger'</span><span class="s1">])</span>
        <span class="s1">types.extend(np.typecodes[</span><span class="s5">'AllFloat'</span><span class="s1">])</span>
        <span class="s1">types.append(</span><span class="s5">'datetime64[D]'</span><span class="s1">)</span>
        <span class="s1">types.append(</span><span class="s5">'timedelta64[D]'</span><span class="s1">)</span>
        <span class="s1">types.append([(</span><span class="s5">'a'</span><span class="s2">, </span><span class="s1">int)</span><span class="s2">, </span><span class="s1">(</span><span class="s5">'b'</span><span class="s2">, </span><span class="s1">int)])</span>
        <span class="s1">types.append([(</span><span class="s5">'a'</span><span class="s2">, </span><span class="s1">int)</span><span class="s2">, </span><span class="s1">(</span><span class="s5">'b'</span><span class="s2">, </span><span class="s1">float)])</span>

        <span class="s2">for </span><span class="s1">dtype </span><span class="s2">in </span><span class="s1">types:</span>
            <span class="s1">self._run_axis_tests(dtype)</span>

        <span class="s1">msg = </span><span class="s5">'Non-bitwise-equal booleans test failed'</span>
        <span class="s1">data = np.arange(</span><span class="s4">10</span><span class="s2">, </span><span class="s1">dtype=np.uint8).reshape(-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">).view(bool)</span>
        <span class="s1">result = np.array([[</span><span class="s2">False, True</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s2">True, True</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">dtype=bool)</span>
        <span class="s1">assert_array_equal(unique(data</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">result</span><span class="s2">, </span><span class="s1">msg)</span>

        <span class="s1">msg = </span><span class="s5">'Negative zero equality test failed'</span>
        <span class="s1">data = np.array([[-</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0.0</span><span class="s2">, </span><span class="s1">-</span><span class="s4">0.0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[-</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0.0</span><span class="s2">, </span><span class="s1">-</span><span class="s4">0.0</span><span class="s1">]])</span>
        <span class="s1">result = np.array([[-</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s1">]])</span>
        <span class="s1">assert_array_equal(unique(data</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">result</span><span class="s2">, </span><span class="s1">msg)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s5">&quot;axis&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_unique_1d_with_axis(self</span><span class="s2">, </span><span class="s1">axis):</span>
        <span class="s1">x = np.array([</span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">])</span>
        <span class="s1">uniq = unique(x</span><span class="s2">, </span><span class="s1">axis=axis)</span>
        <span class="s1">assert_array_equal(uniq</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">])</span>

    <span class="s2">def </span><span class="s1">test_unique_axis_zeros(self):</span>
        <span class="s3"># issue 15559</span>
        <span class="s1">single_zero = np.empty(shape=(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">dtype=np.int8)</span>
        <span class="s1">uniq</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">inv</span><span class="s2">, </span><span class="s1">cnt = unique(single_zero</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">return_index=</span><span class="s2">True,</span>
                                     <span class="s1">return_inverse=</span><span class="s2">True, </span><span class="s1">return_counts=</span><span class="s2">True</span><span class="s1">)</span>

        <span class="s3"># there's 1 element of shape (0,) along axis 0</span>
        <span class="s1">assert_equal(uniq.dtype</span><span class="s2">, </span><span class="s1">single_zero.dtype)</span>
        <span class="s1">assert_array_equal(uniq</span><span class="s2">, </span><span class="s1">np.empty(shape=(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">)))</span>
        <span class="s1">assert_array_equal(idx</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s4">0</span><span class="s1">]))</span>
        <span class="s1">assert_array_equal(inv</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]))</span>
        <span class="s1">assert_array_equal(cnt</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s4">2</span><span class="s1">]))</span>

        <span class="s3"># there's 0 elements of shape (2,) along axis 1</span>
        <span class="s1">uniq</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">inv</span><span class="s2">, </span><span class="s1">cnt = unique(single_zero</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">return_index=</span><span class="s2">True,</span>
                                     <span class="s1">return_inverse=</span><span class="s2">True, </span><span class="s1">return_counts=</span><span class="s2">True</span><span class="s1">)</span>

        <span class="s1">assert_equal(uniq.dtype</span><span class="s2">, </span><span class="s1">single_zero.dtype)</span>
        <span class="s1">assert_array_equal(uniq</span><span class="s2">, </span><span class="s1">np.empty(shape=(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s1">)))</span>
        <span class="s1">assert_array_equal(idx</span><span class="s2">, </span><span class="s1">np.array([]))</span>
        <span class="s1">assert_array_equal(inv</span><span class="s2">, </span><span class="s1">np.array([]))</span>
        <span class="s1">assert_array_equal(cnt</span><span class="s2">, </span><span class="s1">np.array([]))</span>

        <span class="s3"># test a &quot;complicated&quot; shape</span>
        <span class="s1">shape = (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">multiple_zeros = np.empty(shape=shape)</span>
        <span class="s2">for </span><span class="s1">axis </span><span class="s2">in </span><span class="s1">range(len(shape)):</span>
            <span class="s1">expected_shape = list(shape)</span>
            <span class="s2">if </span><span class="s1">shape[axis] == </span><span class="s4">0</span><span class="s1">:</span>
                <span class="s1">expected_shape[axis] = </span><span class="s4">0</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s1">expected_shape[axis] = </span><span class="s4">1</span>

            <span class="s1">assert_array_equal(unique(multiple_zeros</span><span class="s2">, </span><span class="s1">axis=axis)</span><span class="s2">,</span>
                               <span class="s1">np.empty(shape=expected_shape))</span>

    <span class="s2">def </span><span class="s1">test_unique_masked(self):</span>
        <span class="s3"># issue 8664</span>
        <span class="s1">x = np.array([</span><span class="s4">64</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">63</span><span class="s2">, </span><span class="s4">63</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">63</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">,</span>
                     <span class="s1">dtype=</span><span class="s5">'uint8'</span><span class="s1">)</span>
        <span class="s1">y = np.ma.masked_equal(x</span><span class="s2">, </span><span class="s4">0</span><span class="s1">)</span>

        <span class="s1">v = np.unique(y)</span>
        <span class="s1">v2</span><span class="s2">, </span><span class="s1">i</span><span class="s2">, </span><span class="s1">c = np.unique(y</span><span class="s2">, </span><span class="s1">return_index=</span><span class="s2">True, </span><span class="s1">return_counts=</span><span class="s2">True</span><span class="s1">)</span>

        <span class="s1">msg = </span><span class="s5">'Unique returned different results when asked for index'</span>
        <span class="s1">assert_array_equal(v.data</span><span class="s2">, </span><span class="s1">v2.data</span><span class="s2">, </span><span class="s1">msg)</span>
        <span class="s1">assert_array_equal(v.mask</span><span class="s2">, </span><span class="s1">v2.mask</span><span class="s2">, </span><span class="s1">msg)</span>

    <span class="s2">def </span><span class="s1">test_unique_sort_order_with_axis(self):</span>
        <span class="s3"># These tests fail if sorting along axis is done by treating subarrays</span>
        <span class="s3"># as unsigned byte strings.  See gh-10495.</span>
        <span class="s1">fmt = </span><span class="s5">&quot;sort order incorrect for integer type '%s'&quot;</span>
        <span class="s2">for </span><span class="s1">dt </span><span class="s2">in </span><span class="s5">'bhilq'</span><span class="s1">:</span>
            <span class="s1">a = np.array([[-</span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">dt)</span>
            <span class="s1">b = np.unique(a</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
            <span class="s1">assert_array_equal(a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">fmt % dt)</span>

    <span class="s2">def </span><span class="s1">_run_axis_tests(self</span><span class="s2">, </span><span class="s1">dtype):</span>
        <span class="s1">data = np.array([[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">,</span>
                         <span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">,</span>
                         <span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">,</span>
                         <span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]]).astype(dtype)</span>

        <span class="s1">msg = </span><span class="s5">'Unique with 1d array and axis=0 failed'</span>
        <span class="s1">result = np.array([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(unique(data)</span><span class="s2">, </span><span class="s1">result.astype(dtype)</span><span class="s2">, </span><span class="s1">msg)</span>

        <span class="s1">msg = </span><span class="s5">'Unique with 2d array and axis=0 failed'</span>
        <span class="s1">result = np.array([[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">assert_array_equal(unique(data</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">result.astype(dtype)</span><span class="s2">, </span><span class="s1">msg)</span>

        <span class="s1">msg = </span><span class="s5">'Unique with 2d array and axis=1 failed'</span>
        <span class="s1">result = np.array([[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]])</span>
        <span class="s1">assert_array_equal(unique(data</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">result.astype(dtype)</span><span class="s2">, </span><span class="s1">msg)</span>

        <span class="s1">msg = </span><span class="s5">'Unique with 3d array and axis=2 failed'</span>
        <span class="s1">data3d = np.array([[[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]]</span><span class="s2">,</span>
                           <span class="s1">[[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]]]).astype(dtype)</span>
        <span class="s1">result = np.take(data3d</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(unique(data3d</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">result</span><span class="s2">, </span><span class="s1">msg)</span>

        <span class="s1">uniq</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">inv</span><span class="s2">, </span><span class="s1">cnt = unique(data</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">return_index=</span><span class="s2">True,</span>
                                     <span class="s1">return_inverse=</span><span class="s2">True, </span><span class="s1">return_counts=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">msg = </span><span class="s5">&quot;Unique's return_index=True failed with axis=0&quot;</span>
        <span class="s1">assert_array_equal(data[idx]</span><span class="s2">, </span><span class="s1">uniq</span><span class="s2">, </span><span class="s1">msg)</span>
        <span class="s1">msg = </span><span class="s5">&quot;Unique's return_inverse=True failed with axis=0&quot;</span>
        <span class="s1">assert_array_equal(uniq[inv]</span><span class="s2">, </span><span class="s1">data)</span>
        <span class="s1">msg = </span><span class="s5">&quot;Unique's return_counts=True failed with axis=0&quot;</span>
        <span class="s1">assert_array_equal(cnt</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s1">])</span><span class="s2">, </span><span class="s1">msg)</span>

        <span class="s1">uniq</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">inv</span><span class="s2">, </span><span class="s1">cnt = unique(data</span><span class="s2">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">return_index=</span><span class="s2">True,</span>
                                     <span class="s1">return_inverse=</span><span class="s2">True, </span><span class="s1">return_counts=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">msg = </span><span class="s5">&quot;Unique's return_index=True failed with axis=1&quot;</span>
        <span class="s1">assert_array_equal(data[:</span><span class="s2">, </span><span class="s1">idx]</span><span class="s2">, </span><span class="s1">uniq)</span>
        <span class="s1">msg = </span><span class="s5">&quot;Unique's return_inverse=True failed with axis=1&quot;</span>
        <span class="s1">assert_array_equal(uniq[:</span><span class="s2">, </span><span class="s1">inv]</span><span class="s2">, </span><span class="s1">data)</span>
        <span class="s1">msg = </span><span class="s5">&quot;Unique's return_counts=True failed with axis=1&quot;</span>
        <span class="s1">assert_array_equal(cnt</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span><span class="s2">, </span><span class="s1">msg)</span>
</pre>
</body>
</html>