<html>
<head>
<title>test_dtypes_basic.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #808080;}
.s4 { color: #6a8759;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_dtypes_basic.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Tests dtype specification during parsing 
for all of the parsers defined in parsers.py 
&quot;&quot;&quot;</span>
<span class="s2">from </span><span class="s1">io </span><span class="s2">import </span><span class="s1">StringIO</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">import </span><span class="s1">pytest</span>

<span class="s2">from </span><span class="s1">pandas.errors </span><span class="s2">import </span><span class="s1">ParserWarning</span>

<span class="s2">import </span><span class="s1">pandas </span><span class="s2">as </span><span class="s1">pd</span>
<span class="s2">from </span><span class="s1">pandas </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">DataFrame</span><span class="s2">,</span>
    <span class="s1">Timestamp</span><span class="s2">,</span>
<span class="s1">)</span>
<span class="s2">import </span><span class="s1">pandas._testing </span><span class="s2">as </span><span class="s1">tm</span>

<span class="s3"># TODO(1.4): Change me into xfail at release time</span>
<span class="s3"># and xfail individual tests</span>
<span class="s1">pytestmark = pytest.mark.usefixtures(</span><span class="s4">&quot;pyarrow_skip&quot;</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;dtype&quot;</span><span class="s2">, </span><span class="s1">[str</span><span class="s2">, </span><span class="s1">object])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;check_orig&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s2">True, False</span><span class="s1">])</span>
<span class="s2">def </span><span class="s1">test_dtype_all_columns(all_parsers</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">check_orig):</span>
    <span class="s3"># see gh-3795, gh-6607</span>
    <span class="s1">parser = all_parsers</span>

    <span class="s1">df = DataFrame(</span>
        <span class="s1">np.random.rand(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">2</span><span class="s1">).round(</span><span class="s5">4</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">columns=list(</span><span class="s4">&quot;AB&quot;</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">index=[</span><span class="s4">&quot;1A&quot;</span><span class="s2">, </span><span class="s4">&quot;1B&quot;</span><span class="s2">, </span><span class="s4">&quot;1C&quot;</span><span class="s2">, </span><span class="s4">&quot;1D&quot;</span><span class="s2">, </span><span class="s4">&quot;1E&quot;</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s1">)</span>

    <span class="s2">with </span><span class="s1">tm.ensure_clean(</span><span class="s4">&quot;__passing_str_as_dtype__.csv&quot;</span><span class="s1">) </span><span class="s2">as </span><span class="s1">path:</span>
        <span class="s1">df.to_csv(path)</span>

        <span class="s1">result = parser.read_csv(path</span><span class="s2">, </span><span class="s1">dtype=dtype</span><span class="s2">, </span><span class="s1">index_col=</span><span class="s5">0</span><span class="s1">)</span>

        <span class="s2">if </span><span class="s1">check_orig:</span>
            <span class="s1">expected = df.copy()</span>
            <span class="s1">result = result.astype(float)</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">expected = df.astype(str)</span>

        <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s2">def </span><span class="s1">test_dtype_per_column(all_parsers):</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">data = </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
</span><span class="s4">one,two 
1,2.5 
2,3.5 
3,4.5 
4,5.5&quot;&quot;&quot;</span>
    <span class="s1">expected = DataFrame(</span>
        <span class="s1">[[</span><span class="s5">1</span><span class="s2">, </span><span class="s4">&quot;2.5&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">2</span><span class="s2">, </span><span class="s4">&quot;3.5&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">3</span><span class="s2">, </span><span class="s4">&quot;4.5&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">4</span><span class="s2">, </span><span class="s4">&quot;5.5&quot;</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">columns=[</span><span class="s4">&quot;one&quot;</span><span class="s2">, </span><span class="s4">&quot;two&quot;</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">expected[</span><span class="s4">&quot;one&quot;</span><span class="s1">] = expected[</span><span class="s4">&quot;one&quot;</span><span class="s1">].astype(np.float64)</span>
    <span class="s1">expected[</span><span class="s4">&quot;two&quot;</span><span class="s1">] = expected[</span><span class="s4">&quot;two&quot;</span><span class="s1">].astype(object)</span>

    <span class="s1">result = parser.read_csv(StringIO(data)</span><span class="s2">, </span><span class="s1">dtype={</span><span class="s4">&quot;one&quot;</span><span class="s1">: np.float64</span><span class="s2">, </span><span class="s5">1</span><span class="s1">: str})</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s2">def </span><span class="s1">test_invalid_dtype_per_column(all_parsers):</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">data = </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
</span><span class="s4">one,two 
1,2.5 
2,3.5 
3,4.5 
4,5.5&quot;&quot;&quot;</span>

    <span class="s2">with </span><span class="s1">pytest.raises(TypeError</span><span class="s2">, </span><span class="s1">match=</span><span class="s4">&quot;data type [</span><span class="s2">\&quot;</span><span class="s4">']foo[</span><span class="s2">\&quot;</span><span class="s4">'] not understood&quot;</span><span class="s1">):</span>
        <span class="s1">parser.read_csv(StringIO(data)</span><span class="s2">, </span><span class="s1">dtype={</span><span class="s4">&quot;one&quot;</span><span class="s1">: </span><span class="s4">&quot;foo&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s1">: </span><span class="s4">&quot;int&quot;</span><span class="s1">})</span>


<span class="s2">def </span><span class="s1">test_raise_on_passed_int_dtype_with_nas(all_parsers):</span>
    <span class="s3"># see gh-2631</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">data = </span><span class="s4">&quot;&quot;&quot;YEAR, DOY, a 
2001,106380451,10 
2001,,11 
2001,106380451,67&quot;&quot;&quot;</span>

    <span class="s1">msg = (</span>
        <span class="s4">&quot;Integer column has NA values&quot;</span>
        <span class="s2">if </span><span class="s1">parser.engine == </span><span class="s4">&quot;c&quot;</span>
        <span class="s2">else </span><span class="s4">&quot;Unable to convert column DOY&quot;</span>
    <span class="s1">)</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">, </span><span class="s1">match=msg):</span>
        <span class="s1">parser.read_csv(StringIO(data)</span><span class="s2">, </span><span class="s1">dtype={</span><span class="s4">&quot;DOY&quot;</span><span class="s1">: np.int64}</span><span class="s2">, </span><span class="s1">skipinitialspace=</span><span class="s2">True</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_dtype_with_converters(all_parsers):</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">data = </span><span class="s4">&quot;&quot;&quot;a,b 
1.1,2.2 
1.2,2.3&quot;&quot;&quot;</span>

    <span class="s3"># Dtype spec ignored if converted specified.</span>
    <span class="s2">with </span><span class="s1">tm.assert_produces_warning(ParserWarning):</span>
        <span class="s1">result = parser.read_csv(</span>
            <span class="s1">StringIO(data)</span><span class="s2">, </span><span class="s1">dtype={</span><span class="s4">&quot;a&quot;</span><span class="s1">: </span><span class="s4">&quot;i8&quot;</span><span class="s1">}</span><span class="s2">, </span><span class="s1">converters={</span><span class="s4">&quot;a&quot;</span><span class="s1">: </span><span class="s2">lambda </span><span class="s1">x: str(x)}</span>
        <span class="s1">)</span>
    <span class="s1">expected = DataFrame({</span><span class="s4">&quot;a&quot;</span><span class="s1">: [</span><span class="s4">&quot;1.1&quot;</span><span class="s2">, </span><span class="s4">&quot;1.2&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s1">: [</span><span class="s5">2.2</span><span class="s2">, </span><span class="s5">2.3</span><span class="s1">]})</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s4">&quot;dtype&quot;</span><span class="s2">, </span><span class="s1">list(np.typecodes[</span><span class="s4">&quot;AllInteger&quot;</span><span class="s1">] + np.typecodes[</span><span class="s4">&quot;Float&quot;</span><span class="s1">])</span>
<span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_numeric_dtype(all_parsers</span><span class="s2">, </span><span class="s1">dtype):</span>
    <span class="s1">data = </span><span class="s4">&quot;0</span><span class="s2">\n</span><span class="s4">1&quot;</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">expected = DataFrame([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=dtype)</span>

    <span class="s1">result = parser.read_csv(StringIO(data)</span><span class="s2">, </span><span class="s1">header=</span><span class="s2">None, </span><span class="s1">dtype=dtype)</span>
    <span class="s1">tm.assert_frame_equal(expected</span><span class="s2">, </span><span class="s1">result)</span>


<span class="s2">def </span><span class="s1">test_boolean_dtype(all_parsers):</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">data = </span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s1">.join(</span>
        <span class="s1">[</span>
            <span class="s4">&quot;a&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;True&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;TRUE&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;true&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.0&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;False&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;FALSE&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;false&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;0&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;0.0&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;NaN&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;nan&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;NA&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;null&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;NULL&quot;</span><span class="s2">,</span>
        <span class="s1">]</span>
    <span class="s1">)</span>

    <span class="s1">result = parser.read_csv(StringIO(data)</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s4">&quot;boolean&quot;</span><span class="s1">)</span>
    <span class="s1">expected = DataFrame(</span>
        <span class="s1">{</span>
            <span class="s4">&quot;a&quot;</span><span class="s1">: pd.array(</span>
                <span class="s1">[</span>
                    <span class="s2">True,</span>
                    <span class="s2">True,</span>
                    <span class="s2">True,</span>
                    <span class="s2">True,</span>
                    <span class="s2">True,</span>
                    <span class="s2">False,</span>
                    <span class="s2">False,</span>
                    <span class="s2">False,</span>
                    <span class="s2">False,</span>
                    <span class="s2">False,</span>
                    <span class="s2">None,</span>
                    <span class="s2">None,</span>
                    <span class="s2">None,</span>
                    <span class="s2">None,</span>
                    <span class="s2">None,</span>
                <span class="s1">]</span><span class="s2">,</span>
                <span class="s1">dtype=</span><span class="s4">&quot;boolean&quot;</span><span class="s2">,</span>
            <span class="s1">)</span>
        <span class="s1">}</span>
    <span class="s1">)</span>

    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s2">def </span><span class="s1">test_delimiter_with_usecols_and_parse_dates(all_parsers):</span>
    <span class="s3"># GH#35873</span>
    <span class="s1">result = all_parsers.read_csv(</span>
        <span class="s1">StringIO(</span><span class="s4">'&quot;dump&quot;,&quot;-9,1&quot;,&quot;-9,1&quot;,20101010'</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">engine=</span><span class="s4">&quot;python&quot;</span><span class="s2">,</span>
        <span class="s1">names=[</span><span class="s4">&quot;col&quot;</span><span class="s2">, </span><span class="s4">&quot;col1&quot;</span><span class="s2">, </span><span class="s4">&quot;col2&quot;</span><span class="s2">, </span><span class="s4">&quot;col3&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">usecols=[</span><span class="s4">&quot;col1&quot;</span><span class="s2">, </span><span class="s4">&quot;col2&quot;</span><span class="s2">, </span><span class="s4">&quot;col3&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">parse_dates=[</span><span class="s4">&quot;col3&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">decimal=</span><span class="s4">&quot;,&quot;</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s1">expected = DataFrame(</span>
        <span class="s1">{</span><span class="s4">&quot;col1&quot;</span><span class="s1">: [-</span><span class="s5">9.1</span><span class="s1">]</span><span class="s2">, </span><span class="s4">&quot;col2&quot;</span><span class="s1">: [-</span><span class="s5">9.1</span><span class="s1">]</span><span class="s2">, </span><span class="s4">&quot;col3&quot;</span><span class="s1">: [Timestamp(</span><span class="s4">&quot;2010-10-10&quot;</span><span class="s1">)]}</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;thousands&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">&quot;_&quot;</span><span class="s2">, None</span><span class="s1">])</span>
<span class="s2">def </span><span class="s1">test_decimal_and_exponential(python_parser_only</span><span class="s2">, </span><span class="s1">numeric_decimal</span><span class="s2">, </span><span class="s1">thousands):</span>
    <span class="s3"># GH#31920</span>
    <span class="s1">decimal_number_check(python_parser_only</span><span class="s2">, </span><span class="s1">numeric_decimal</span><span class="s2">, </span><span class="s1">thousands</span><span class="s2">, None</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;thousands&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">&quot;_&quot;</span><span class="s2">, None</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;float_precision&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s2">None, </span><span class="s4">&quot;legacy&quot;</span><span class="s2">, </span><span class="s4">&quot;high&quot;</span><span class="s2">, </span><span class="s4">&quot;round_trip&quot;</span><span class="s1">])</span>
<span class="s2">def </span><span class="s1">test_1000_sep_decimal_float_precision(</span>
    <span class="s1">c_parser_only</span><span class="s2">, </span><span class="s1">numeric_decimal</span><span class="s2">, </span><span class="s1">float_precision</span><span class="s2">, </span><span class="s1">thousands</span>
<span class="s1">):</span>
    <span class="s3"># test decimal and thousand sep handling in across 'float_precision'</span>
    <span class="s3"># parsers</span>
    <span class="s1">decimal_number_check(c_parser_only</span><span class="s2">, </span><span class="s1">numeric_decimal</span><span class="s2">, </span><span class="s1">thousands</span><span class="s2">, </span><span class="s1">float_precision)</span>
    <span class="s1">text</span><span class="s2">, </span><span class="s1">value = numeric_decimal</span>
    <span class="s1">text = </span><span class="s4">&quot; &quot; </span><span class="s1">+ text + </span><span class="s4">&quot; &quot;</span>
    <span class="s2">if </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">str):  </span><span class="s3"># the negative cases (parse as text)</span>
        <span class="s1">value = </span><span class="s4">&quot; &quot; </span><span class="s1">+ value + </span><span class="s4">&quot; &quot;</span>
    <span class="s1">decimal_number_check(c_parser_only</span><span class="s2">, </span><span class="s1">(text</span><span class="s2">, </span><span class="s1">value)</span><span class="s2">, </span><span class="s1">thousands</span><span class="s2">, </span><span class="s1">float_precision)</span>


<span class="s2">def </span><span class="s1">decimal_number_check(parser</span><span class="s2">, </span><span class="s1">numeric_decimal</span><span class="s2">, </span><span class="s1">thousands</span><span class="s2">, </span><span class="s1">float_precision):</span>
    <span class="s3"># GH#31920</span>
    <span class="s1">value = numeric_decimal[</span><span class="s5">0</span><span class="s1">]</span>
    <span class="s2">if </span><span class="s1">thousands </span><span class="s2">is None and </span><span class="s4">&quot;_&quot; </span><span class="s2">in </span><span class="s1">value:</span>
        <span class="s1">pytest.skip(</span><span class="s4">&quot;Skip test if no thousands sep is defined and sep is in value&quot;</span><span class="s1">)</span>
    <span class="s1">df = parser.read_csv(</span>
        <span class="s1">StringIO(value)</span><span class="s2">,</span>
        <span class="s1">sep=</span><span class="s4">&quot;|&quot;</span><span class="s2">,</span>
        <span class="s1">thousands=thousands</span><span class="s2">,</span>
        <span class="s1">decimal=</span><span class="s4">&quot;,&quot;</span><span class="s2">,</span>
        <span class="s1">header=</span><span class="s2">None,</span>
    <span class="s1">)</span>
    <span class="s1">val = df.iloc[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">]</span>
    <span class="s2">assert </span><span class="s1">val == numeric_decimal[</span><span class="s5">1</span><span class="s1">]</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;float_precision&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s2">None, </span><span class="s4">&quot;legacy&quot;</span><span class="s2">, </span><span class="s4">&quot;high&quot;</span><span class="s2">, </span><span class="s4">&quot;round_trip&quot;</span><span class="s1">])</span>
<span class="s2">def </span><span class="s1">test_skip_whitespace(c_parser_only</span><span class="s2">, </span><span class="s1">float_precision):</span>
    <span class="s1">DATA = </span><span class="s4">&quot;&quot;&quot;id</span><span class="s2">\t</span><span class="s4">num</span><span class="s2">\t</span>
<span class="s4">1</span><span class="s2">\t</span><span class="s4">1.2 </span><span class="s2">\t</span>
<span class="s4">1</span><span class="s2">\t </span><span class="s4">2.1</span><span class="s2">\t</span>
<span class="s4">2</span><span class="s2">\t </span><span class="s4">1</span><span class="s2">\t</span>
<span class="s4">2</span><span class="s2">\t </span><span class="s4">1.2 </span><span class="s2">\t</span>
<span class="s4">&quot;&quot;&quot;</span>
    <span class="s1">df = c_parser_only.read_csv(</span>
        <span class="s1">StringIO(DATA)</span><span class="s2">,</span>
        <span class="s1">float_precision=float_precision</span><span class="s2">,</span>
        <span class="s1">sep=</span><span class="s4">&quot;</span><span class="s2">\t</span><span class="s4">&quot;</span><span class="s2">,</span>
        <span class="s1">header=</span><span class="s5">0</span><span class="s2">,</span>
        <span class="s1">dtype={</span><span class="s5">1</span><span class="s1">: np.float64}</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(df.iloc[:</span><span class="s2">, </span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">pd.Series([</span><span class="s5">1.2</span><span class="s2">, </span><span class="s5">2.1</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">1.2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">name=</span><span class="s4">&quot;num&quot;</span><span class="s1">))</span>


<span class="s2">def </span><span class="s1">test_true_values_cast_to_bool(all_parsers):</span>
    <span class="s3"># GH#34655</span>
    <span class="s1">text = </span><span class="s4">&quot;&quot;&quot;a,b 
yes,xxx 
no,yyy 
1,zzz 
0,aaa 
    &quot;&quot;&quot;</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">result = parser.read_csv(</span>
        <span class="s1">StringIO(text)</span><span class="s2">,</span>
        <span class="s1">true_values=[</span><span class="s4">&quot;yes&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">false_values=[</span><span class="s4">&quot;no&quot;</span><span class="s1">]</span><span class="s2">,</span>
        <span class="s1">dtype={</span><span class="s4">&quot;a&quot;</span><span class="s1">: </span><span class="s4">&quot;boolean&quot;</span><span class="s1">}</span><span class="s2">,</span>
    <span class="s1">)</span>
    <span class="s1">expected = DataFrame(</span>
        <span class="s1">{</span><span class="s4">&quot;a&quot;</span><span class="s1">: [</span><span class="s2">True, False, True, False</span><span class="s1">]</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s1">: [</span><span class="s4">&quot;xxx&quot;</span><span class="s2">, </span><span class="s4">&quot;yyy&quot;</span><span class="s2">, </span><span class="s4">&quot;zzz&quot;</span><span class="s2">, </span><span class="s4">&quot;aaa&quot;</span><span class="s1">]}</span>
    <span class="s1">)</span>
    <span class="s1">expected[</span><span class="s4">&quot;a&quot;</span><span class="s1">] = expected[</span><span class="s4">&quot;a&quot;</span><span class="s1">].astype(</span><span class="s4">&quot;boolean&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;dtypes, exp_value&quot;</span><span class="s2">, </span><span class="s1">[({}</span><span class="s2">, </span><span class="s4">&quot;1&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">({</span><span class="s4">&quot;a.1&quot;</span><span class="s1">: </span><span class="s4">&quot;int64&quot;</span><span class="s1">}</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)])</span>
<span class="s2">def </span><span class="s1">test_dtype_mangle_dup_cols(all_parsers</span><span class="s2">, </span><span class="s1">dtypes</span><span class="s2">, </span><span class="s1">exp_value):</span>
    <span class="s3"># GH#35211</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">data = </span><span class="s4">&quot;&quot;&quot;a,a</span><span class="s2">\n</span><span class="s4">1,1&quot;&quot;&quot;</span>
    <span class="s1">dtype_dict = {</span><span class="s4">&quot;a&quot;</span><span class="s1">: str</span><span class="s2">, </span><span class="s1">**dtypes}</span>
    <span class="s3"># GH#42462</span>
    <span class="s1">dtype_dict_copy = dtype_dict.copy()</span>
    <span class="s1">result = parser.read_csv(StringIO(data)</span><span class="s2">, </span><span class="s1">dtype=dtype_dict)</span>
    <span class="s1">expected = DataFrame({</span><span class="s4">&quot;a&quot;</span><span class="s1">: [</span><span class="s4">&quot;1&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s4">&quot;a.1&quot;</span><span class="s1">: [exp_value]})</span>
    <span class="s2">assert </span><span class="s1">dtype_dict == dtype_dict_copy</span><span class="s2">, </span><span class="s4">&quot;dtype dict changed&quot;</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s2">def </span><span class="s1">test_dtype_mangle_dup_cols_single_dtype(all_parsers):</span>
    <span class="s3"># GH#42022</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">data = </span><span class="s4">&quot;&quot;&quot;a,a</span><span class="s2">\n</span><span class="s4">1,1&quot;&quot;&quot;</span>
    <span class="s1">result = parser.read_csv(StringIO(data)</span><span class="s2">, </span><span class="s1">dtype=str)</span>
    <span class="s1">expected = DataFrame({</span><span class="s4">&quot;a&quot;</span><span class="s1">: [</span><span class="s4">&quot;1&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s4">&quot;a.1&quot;</span><span class="s1">: [</span><span class="s4">&quot;1&quot;</span><span class="s1">]})</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s2">def </span><span class="s1">test_dtype_multi_index(all_parsers):</span>
    <span class="s3"># GH 42446</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">data = </span><span class="s4">&quot;A,B,B</span><span class="s2">\n</span><span class="s4">X,Y,Z</span><span class="s2">\n</span><span class="s4">1,2,3&quot;</span>

    <span class="s1">result = parser.read_csv(</span>
        <span class="s1">StringIO(data)</span><span class="s2">,</span>
        <span class="s1">header=list(range(</span><span class="s5">2</span><span class="s1">))</span><span class="s2">,</span>
        <span class="s1">dtype={</span>
            <span class="s1">(</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;X&quot;</span><span class="s1">): np.int32</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s4">&quot;Y&quot;</span><span class="s1">): np.int32</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s4">&quot;Z&quot;</span><span class="s1">): np.float32</span><span class="s2">,</span>
        <span class="s1">}</span><span class="s2">,</span>
    <span class="s1">)</span>

    <span class="s1">expected = DataFrame(</span>
        <span class="s1">{</span>
            <span class="s1">(</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;X&quot;</span><span class="s1">): np.int32([</span><span class="s5">1</span><span class="s1">])</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s4">&quot;Y&quot;</span><span class="s1">): np.int32([</span><span class="s5">2</span><span class="s1">])</span><span class="s2">,</span>
            <span class="s1">(</span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s4">&quot;Z&quot;</span><span class="s1">): np.float32([</span><span class="s5">3</span><span class="s1">])</span><span class="s2">,</span>
        <span class="s1">}</span>
    <span class="s1">)</span>

    <span class="s1">tm.assert_frame_equal(result</span><span class="s2">, </span><span class="s1">expected)</span>


<span class="s2">def </span><span class="s1">test_nullable_int_dtype(all_parsers</span><span class="s2">, </span><span class="s1">any_int_ea_dtype):</span>
    <span class="s3"># GH 25472</span>
    <span class="s1">parser = all_parsers</span>
    <span class="s1">dtype = any_int_ea_dtype</span>

    <span class="s1">data = </span><span class="s4">&quot;&quot;&quot;a,b,c 
,3,5 
1,,6 
2,4,&quot;&quot;&quot;</span>
    <span class="s1">expected = DataFrame(</span>
        <span class="s1">{</span>
            <span class="s4">&quot;a&quot;</span><span class="s1">: pd.array([pd.NA</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=dtype)</span><span class="s2">,</span>
            <span class="s4">&quot;b&quot;</span><span class="s1">: pd.array([</span><span class="s5">3</span><span class="s2">, </span><span class="s1">pd.NA</span><span class="s2">, </span><span class="s5">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=dtype)</span><span class="s2">,</span>
            <span class="s4">&quot;c&quot;</span><span class="s1">: pd.array([</span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s1">pd.NA]</span><span class="s2">, </span><span class="s1">dtype=dtype)</span><span class="s2">,</span>
        <span class="s1">}</span>
    <span class="s1">)</span>
    <span class="s1">actual = parser.read_csv(StringIO(data)</span><span class="s2">, </span><span class="s1">dtype=dtype)</span>
    <span class="s1">tm.assert_frame_equal(actual</span><span class="s2">, </span><span class="s1">expected)</span>
</pre>
</body>
</html>