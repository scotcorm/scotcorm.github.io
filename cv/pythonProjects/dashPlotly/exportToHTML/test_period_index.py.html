<html>
<head>
<title>test_period_index.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #808080;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_period_index.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">datetime</span>

<span class="s0">import </span><span class="s1">dateutil</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">import </span><span class="s1">pytz</span>

<span class="s0">from </span><span class="s1">pandas._libs.tslibs.ccalendar </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">DAYS</span><span class="s0">,</span>
    <span class="s1">MONTHS</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">from </span><span class="s1">pandas._libs.tslibs.period </span><span class="s0">import </span><span class="s1">IncompatibleFrequency</span>
<span class="s0">from </span><span class="s1">pandas.errors </span><span class="s0">import </span><span class="s1">InvalidIndexError</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">DataFrame</span><span class="s0">,</span>
    <span class="s1">Series</span><span class="s0">,</span>
    <span class="s1">Timestamp</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">pandas._testing </span><span class="s0">as </span><span class="s1">tm</span>
<span class="s0">from </span><span class="s1">pandas.core.indexes.datetimes </span><span class="s0">import </span><span class="s1">date_range</span>
<span class="s0">from </span><span class="s1">pandas.core.indexes.period </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">Period</span><span class="s0">,</span>
    <span class="s1">PeriodIndex</span><span class="s0">,</span>
    <span class="s1">period_range</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">from </span><span class="s1">pandas.core.resample </span><span class="s0">import </span><span class="s1">_get_period_range_edges</span>

<span class="s0">import </span><span class="s1">pandas.tseries.offsets </span><span class="s0">as </span><span class="s1">offsets</span>


<span class="s1">@pytest.fixture()</span>
<span class="s0">def </span><span class="s1">_index_factory():</span>
    <span class="s0">return </span><span class="s1">period_range</span>


<span class="s1">@pytest.fixture</span>
<span class="s0">def </span><span class="s1">_series_name():</span>
    <span class="s0">return </span><span class="s2">&quot;pi&quot;</span>


<span class="s0">class </span><span class="s1">TestPeriodIndex:</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;freq&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;2D&quot;</span><span class="s0">, </span><span class="s2">&quot;1H&quot;</span><span class="s0">, </span><span class="s2">&quot;2H&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;kind&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;period&quot;</span><span class="s0">, None, </span><span class="s2">&quot;timestamp&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_asfreq(self</span><span class="s0">, </span><span class="s1">series_and_frame</span><span class="s0">, </span><span class="s1">freq</span><span class="s0">, </span><span class="s1">kind):</span>
        <span class="s3"># GH 12884, 15944</span>
        <span class="s3"># make sure .asfreq() returns PeriodIndex (except kind='timestamp')</span>

        <span class="s1">obj = series_and_frame</span>
        <span class="s0">if </span><span class="s1">kind == </span><span class="s2">&quot;timestamp&quot;</span><span class="s1">:</span>
            <span class="s1">expected = obj.to_timestamp().resample(freq).asfreq()</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">start = obj.index[</span><span class="s4">0</span><span class="s1">].to_timestamp(how=</span><span class="s2">&quot;start&quot;</span><span class="s1">)</span>
            <span class="s1">end = (obj.index[-</span><span class="s4">1</span><span class="s1">] + obj.index.freq).to_timestamp(how=</span><span class="s2">&quot;start&quot;</span><span class="s1">)</span>
            <span class="s1">new_index = date_range(start=start</span><span class="s0">, </span><span class="s1">end=end</span><span class="s0">, </span><span class="s1">freq=freq</span><span class="s0">, </span><span class="s1">inclusive=</span><span class="s2">&quot;left&quot;</span><span class="s1">)</span>
            <span class="s1">expected = obj.to_timestamp().reindex(new_index).to_period(freq)</span>
        <span class="s1">result = obj.resample(freq</span><span class="s0">, </span><span class="s1">kind=kind).asfreq()</span>
        <span class="s1">tm.assert_almost_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_asfreq_fill_value(self</span><span class="s0">, </span><span class="s1">series):</span>
        <span class="s3"># test for fill value during resampling, issue 3715</span>

        <span class="s1">s = series</span>
        <span class="s1">new_index = date_range(</span>
            <span class="s1">s.index[</span><span class="s4">0</span><span class="s1">].to_timestamp(how=</span><span class="s2">&quot;start&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(s.index[-</span><span class="s4">1</span><span class="s1">]).to_timestamp(how=</span><span class="s2">&quot;start&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">freq=</span><span class="s2">&quot;1H&quot;</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">expected = s.to_timestamp().reindex(new_index</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s4">4.0</span><span class="s1">)</span>
        <span class="s1">result = s.resample(</span><span class="s2">&quot;1H&quot;</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;timestamp&quot;</span><span class="s1">).asfreq(fill_value=</span><span class="s4">4.0</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">frame = s.to_frame(</span><span class="s2">&quot;value&quot;</span><span class="s1">)</span>
        <span class="s1">new_index = date_range(</span>
            <span class="s1">frame.index[</span><span class="s4">0</span><span class="s1">].to_timestamp(how=</span><span class="s2">&quot;start&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(frame.index[-</span><span class="s4">1</span><span class="s1">]).to_timestamp(how=</span><span class="s2">&quot;start&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">freq=</span><span class="s2">&quot;1H&quot;</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">expected = frame.to_timestamp().reindex(new_index</span><span class="s0">, </span><span class="s1">fill_value=</span><span class="s4">3.0</span><span class="s1">)</span>
        <span class="s1">result = frame.resample(</span><span class="s2">&quot;1H&quot;</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;timestamp&quot;</span><span class="s1">).asfreq(fill_value=</span><span class="s4">3.0</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;freq&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s2">&quot;12H&quot;</span><span class="s0">, </span><span class="s2">&quot;2D&quot;</span><span class="s0">, </span><span class="s2">&quot;W&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;kind&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s2">&quot;period&quot;</span><span class="s0">, </span><span class="s2">&quot;timestamp&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;kwargs&quot;</span><span class="s0">, </span><span class="s1">[{</span><span class="s2">&quot;on&quot;</span><span class="s1">: </span><span class="s2">&quot;date&quot;</span><span class="s1">}</span><span class="s0">, </span><span class="s1">{</span><span class="s2">&quot;level&quot;</span><span class="s1">: </span><span class="s2">&quot;d&quot;</span><span class="s1">}])</span>
    <span class="s0">def </span><span class="s1">test_selection(self</span><span class="s0">, </span><span class="s1">index</span><span class="s0">, </span><span class="s1">freq</span><span class="s0">, </span><span class="s1">kind</span><span class="s0">, </span><span class="s1">kwargs):</span>
        <span class="s3"># This is a bug, these should be implemented</span>
        <span class="s3"># GH 14008</span>
        <span class="s1">rng = np.arange(len(index)</span><span class="s0">, </span><span class="s1">dtype=np.int64)</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span><span class="s2">&quot;date&quot;</span><span class="s1">: index</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">: rng}</span><span class="s0">,</span>
            <span class="s1">index=pd.MultiIndex.from_arrays([rng</span><span class="s0">, </span><span class="s1">index]</span><span class="s0">, </span><span class="s1">names=[</span><span class="s2">&quot;v&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">msg = (</span>
            <span class="s2">&quot;Resampling from level= or on= selection with a PeriodIndex is &quot;</span>
            <span class="s2">r&quot;not currently supported, use \.set_index\(\.\.\.\) to &quot;</span>
            <span class="s2">&quot;explicitly set index&quot;</span>
        <span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(NotImplementedError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">df.resample(freq</span><span class="s0">, </span><span class="s1">kind=kind</span><span class="s0">, </span><span class="s1">**kwargs)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;month&quot;</span><span class="s0">, </span><span class="s1">MONTHS)</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;meth&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;ffill&quot;</span><span class="s0">, </span><span class="s2">&quot;bfill&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;conv&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;start&quot;</span><span class="s0">, </span><span class="s2">&quot;end&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;targ&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;M&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_annual_upsample_cases(</span>
        <span class="s1">self</span><span class="s0">, </span><span class="s1">targ</span><span class="s0">, </span><span class="s1">conv</span><span class="s0">, </span><span class="s1">meth</span><span class="s0">, </span><span class="s1">month</span><span class="s0">, </span><span class="s1">simple_period_range_series</span>
    <span class="s1">):</span>
        <span class="s1">ts = simple_period_range_series(</span><span class="s2">&quot;1/1/1990&quot;</span><span class="s0">, </span><span class="s2">&quot;12/31/1991&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">f&quot;A-</span><span class="s0">{</span><span class="s1">month</span><span class="s0">}</span><span class="s2">&quot;</span><span class="s1">)</span>

        <span class="s1">result = getattr(ts.resample(targ</span><span class="s0">, </span><span class="s1">convention=conv)</span><span class="s0">, </span><span class="s1">meth)()</span>
        <span class="s1">expected = result.to_timestamp(targ</span><span class="s0">, </span><span class="s1">how=conv)</span>
        <span class="s1">expected = expected.asfreq(targ</span><span class="s0">, </span><span class="s1">meth).to_period()</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_basic_downsample(self</span><span class="s0">, </span><span class="s1">simple_period_range_series):</span>
        <span class="s1">ts = simple_period_range_series(</span><span class="s2">&quot;1/1/1990&quot;</span><span class="s0">, </span><span class="s2">&quot;6/30/1995&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span>
        <span class="s1">result = ts.resample(</span><span class="s2">&quot;a-dec&quot;</span><span class="s1">).mean()</span>

        <span class="s1">expected = ts.groupby(ts.index.year).mean()</span>
        <span class="s1">expected.index = period_range(</span><span class="s2">&quot;1/1/1990&quot;</span><span class="s0">, </span><span class="s2">&quot;6/30/1995&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;a-dec&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s3"># this is ok</span>
        <span class="s1">tm.assert_series_equal(ts.resample(</span><span class="s2">&quot;a-dec&quot;</span><span class="s1">).mean()</span><span class="s0">, </span><span class="s1">result)</span>
        <span class="s1">tm.assert_series_equal(ts.resample(</span><span class="s2">&quot;a&quot;</span><span class="s1">).mean()</span><span class="s0">, </span><span class="s1">result)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;rule,expected_error_msg&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">(</span><span class="s2">&quot;a-dec&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;YearEnd: month=12&gt;&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;q-mar&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;QuarterEnd: startingMonth=3&gt;&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;MonthEnd&gt;&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;w-thu&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;Week: weekday=3&gt;&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_not_subperiod(self</span><span class="s0">, </span><span class="s1">simple_period_range_series</span><span class="s0">, </span><span class="s1">rule</span><span class="s0">, </span><span class="s1">expected_error_msg):</span>
        <span class="s3"># These are incompatible period rules for resampling</span>
        <span class="s1">ts = simple_period_range_series(</span><span class="s2">&quot;1/1/1990&quot;</span><span class="s0">, </span><span class="s2">&quot;6/30/1995&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;w-wed&quot;</span><span class="s1">)</span>
        <span class="s1">msg = (</span>
            <span class="s2">&quot;Frequency &lt;Week: weekday=2&gt; cannot be resampled to &quot;</span>
            <span class="s2">f&quot;</span><span class="s0">{</span><span class="s1">expected_error_msg</span><span class="s0">}</span><span class="s2">, as they are not sub or super periods&quot;</span>
        <span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">ts.resample(rule).mean()</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;freq&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;2D&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_basic_upsample(self</span><span class="s0">, </span><span class="s1">freq</span><span class="s0">, </span><span class="s1">simple_period_range_series):</span>
        <span class="s1">ts = simple_period_range_series(</span><span class="s2">&quot;1/1/1990&quot;</span><span class="s0">, </span><span class="s2">&quot;6/30/1995&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span>
        <span class="s1">result = ts.resample(</span><span class="s2">&quot;a-dec&quot;</span><span class="s1">).mean()</span>

        <span class="s1">resampled = result.resample(freq</span><span class="s0">, </span><span class="s1">convention=</span><span class="s2">&quot;end&quot;</span><span class="s1">).ffill()</span>
        <span class="s1">expected = result.to_timestamp(freq</span><span class="s0">, </span><span class="s1">how=</span><span class="s2">&quot;end&quot;</span><span class="s1">)</span>
        <span class="s1">expected = expected.asfreq(freq</span><span class="s0">, </span><span class="s2">&quot;ffill&quot;</span><span class="s1">).to_period(freq)</span>
        <span class="s1">tm.assert_series_equal(resampled</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_upsample_with_limit(self):</span>
        <span class="s1">rng = period_range(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;A&quot;</span><span class="s1">)</span>
        <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">rng)</span>

        <span class="s1">result = ts.resample(</span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s1">convention=</span><span class="s2">&quot;end&quot;</span><span class="s1">).ffill(limit=</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">expected = ts.asfreq(</span><span class="s2">&quot;M&quot;</span><span class="s1">).reindex(result.index</span><span class="s0">, </span><span class="s1">method=</span><span class="s2">&quot;ffill&quot;</span><span class="s0">, </span><span class="s1">limit=</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_annual_upsample(self</span><span class="s0">, </span><span class="s1">simple_period_range_series):</span>
        <span class="s1">ts = simple_period_range_series(</span><span class="s2">&quot;1/1/1990&quot;</span><span class="s0">, </span><span class="s2">&quot;12/31/1995&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;A-DEC&quot;</span><span class="s1">)</span>
        <span class="s1">df = DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: ts})</span>
        <span class="s1">rdf = df.resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).ffill()</span>
        <span class="s1">exp = df[</span><span class="s2">&quot;a&quot;</span><span class="s1">].resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).ffill()</span>
        <span class="s1">tm.assert_series_equal(rdf[</span><span class="s2">&quot;a&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s1">rng = period_range(</span><span class="s2">&quot;2000&quot;</span><span class="s0">, </span><span class="s2">&quot;2003&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;A-DEC&quot;</span><span class="s1">)</span>
        <span class="s1">ts = Series([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=rng)</span>

        <span class="s1">result = ts.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).ffill()</span>
        <span class="s1">ex_index = period_range(</span><span class="s2">&quot;2000-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2003-12&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span>

        <span class="s1">expected = ts.asfreq(</span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s1">how=</span><span class="s2">&quot;start&quot;</span><span class="s1">).reindex(ex_index</span><span class="s0">, </span><span class="s1">method=</span><span class="s2">&quot;ffill&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;month&quot;</span><span class="s0">, </span><span class="s1">MONTHS)</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;target&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;M&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;convention&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;start&quot;</span><span class="s0">, </span><span class="s2">&quot;end&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_quarterly_upsample(</span>
        <span class="s1">self</span><span class="s0">, </span><span class="s1">month</span><span class="s0">, </span><span class="s1">target</span><span class="s0">, </span><span class="s1">convention</span><span class="s0">, </span><span class="s1">simple_period_range_series</span>
    <span class="s1">):</span>
        <span class="s1">freq = </span><span class="s2">f&quot;Q-</span><span class="s0">{</span><span class="s1">month</span><span class="s0">}</span><span class="s2">&quot;</span>
        <span class="s1">ts = simple_period_range_series(</span><span class="s2">&quot;1/1/1990&quot;</span><span class="s0">, </span><span class="s2">&quot;12/31/1995&quot;</span><span class="s0">, </span><span class="s1">freq=freq)</span>
        <span class="s1">result = ts.resample(target</span><span class="s0">, </span><span class="s1">convention=convention).ffill()</span>
        <span class="s1">expected = result.to_timestamp(target</span><span class="s0">, </span><span class="s1">how=convention)</span>
        <span class="s1">expected = expected.asfreq(target</span><span class="s0">, </span><span class="s2">&quot;ffill&quot;</span><span class="s1">).to_period()</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;target&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;convention&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;start&quot;</span><span class="s0">, </span><span class="s2">&quot;end&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_monthly_upsample(self</span><span class="s0">, </span><span class="s1">target</span><span class="s0">, </span><span class="s1">convention</span><span class="s0">, </span><span class="s1">simple_period_range_series):</span>
        <span class="s1">ts = simple_period_range_series(</span><span class="s2">&quot;1/1/1990&quot;</span><span class="s0">, </span><span class="s2">&quot;12/31/1995&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span>
        <span class="s1">result = ts.resample(target</span><span class="s0">, </span><span class="s1">convention=convention).ffill()</span>
        <span class="s1">expected = result.to_timestamp(target</span><span class="s0">, </span><span class="s1">how=convention)</span>
        <span class="s1">expected = expected.asfreq(target</span><span class="s0">, </span><span class="s2">&quot;ffill&quot;</span><span class="s1">).to_period()</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_resample_basic(self):</span>
        <span class="s3"># GH3609</span>
        <span class="s1">s = Series(</span>
            <span class="s1">range(</span><span class="s4">100</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">index=date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;s&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">100</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;idx&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">dtype=</span><span class="s2">&quot;float&quot;</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">s[</span><span class="s4">10</span><span class="s1">:</span><span class="s4">30</span><span class="s1">] = np.nan</span>
        <span class="s1">index = PeriodIndex(</span>
            <span class="s1">[Period(</span><span class="s2">&quot;2013-01-01 00:00&quot;</span><span class="s0">, </span><span class="s2">&quot;T&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">Period(</span><span class="s2">&quot;2013-01-01 00:01&quot;</span><span class="s0">, </span><span class="s2">&quot;T&quot;</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">name=</span><span class="s2">&quot;idx&quot;</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">expected = Series([</span><span class="s4">34.5</span><span class="s0">, </span><span class="s4">79.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=index)</span>
        <span class="s1">result = s.to_period().resample(</span><span class="s2">&quot;T&quot;</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;period&quot;</span><span class="s1">).mean()</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
        <span class="s1">result2 = s.resample(</span><span class="s2">&quot;T&quot;</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;period&quot;</span><span class="s1">).mean()</span>
        <span class="s1">tm.assert_series_equal(result2</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;freq,expected_vals&quot;</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s4">31</span><span class="s0">, </span><span class="s4">29</span><span class="s0">, </span><span class="s4">31</span><span class="s0">, </span><span class="s4">9</span><span class="s1">])</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;2M&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s4">31 </span><span class="s1">+ </span><span class="s4">29</span><span class="s0">, </span><span class="s4">31 </span><span class="s1">+ </span><span class="s4">9</span><span class="s1">])]</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_resample_count(self</span><span class="s0">, </span><span class="s1">freq</span><span class="s0">, </span><span class="s1">expected_vals):</span>
        <span class="s3"># GH12774</span>
        <span class="s1">series = Series(</span><span class="s4">1</span><span class="s0">, </span><span class="s1">index=period_range(start=</span><span class="s2">&quot;2000&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">100</span><span class="s1">))</span>
        <span class="s1">result = series.resample(freq).count()</span>
        <span class="s1">expected_index = period_range(</span>
            <span class="s1">start=</span><span class="s2">&quot;2000&quot;</span><span class="s0">, </span><span class="s1">freq=freq</span><span class="s0">, </span><span class="s1">periods=len(expected_vals)</span>
        <span class="s1">)</span>
        <span class="s1">expected = Series(expected_vals</span><span class="s0">, </span><span class="s1">index=expected_index)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_resample_same_freq(self</span><span class="s0">, </span><span class="s1">resample_method):</span>

        <span class="s3"># GH12770</span>
        <span class="s1">series = Series(range(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=period_range(start=</span><span class="s2">&quot;2000&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">3</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">))</span>
        <span class="s1">expected = series</span>

        <span class="s1">result = getattr(series.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">resample_method)()</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_resample_incompat_freq(self):</span>
        <span class="s1">msg = (</span>
            <span class="s2">&quot;Frequency &lt;MonthEnd&gt; cannot be resampled to &lt;Week: weekday=6&gt;, &quot;</span>
            <span class="s2">&quot;as they are not sub or super periods&quot;</span>
        <span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(IncompatibleFrequency</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">Series(</span>
                <span class="s1">range(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=period_range(start=</span><span class="s2">&quot;2000&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">3</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span>
            <span class="s1">).resample(</span><span class="s2">&quot;W&quot;</span><span class="s1">).mean()</span>

    <span class="s0">def </span><span class="s1">test_with_local_timezone_pytz(self):</span>
        <span class="s3"># see gh-5430</span>
        <span class="s1">local_timezone = pytz.timezone(</span><span class="s2">&quot;America/Los_Angeles&quot;</span><span class="s1">)</span>

        <span class="s1">start = datetime(year=</span><span class="s4">2013</span><span class="s0">, </span><span class="s1">month=</span><span class="s4">11</span><span class="s0">, </span><span class="s1">day=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">hour=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">minute=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">tzinfo=pytz.utc)</span>
        <span class="s3"># 1 day later</span>
        <span class="s1">end = datetime(year=</span><span class="s4">2013</span><span class="s0">, </span><span class="s1">month=</span><span class="s4">11</span><span class="s0">, </span><span class="s1">day=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">hour=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">minute=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">tzinfo=pytz.utc)</span>

        <span class="s1">index = date_range(start</span><span class="s0">, </span><span class="s1">end</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;H&quot;</span><span class="s1">)</span>

        <span class="s1">series = Series(</span><span class="s4">1</span><span class="s0">, </span><span class="s1">index=index)</span>
        <span class="s1">series = series.tz_convert(local_timezone)</span>
        <span class="s1">result = series.resample(</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;period&quot;</span><span class="s1">).mean()</span>

        <span class="s3"># Create the expected series</span>
        <span class="s3"># Index is moved back a day with the timezone conversion from UTC to</span>
        <span class="s3"># Pacific</span>
        <span class="s1">expected_index = period_range(start=start</span><span class="s0">, </span><span class="s1">end=end</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">) - offsets.Day()</span>
        <span class="s1">expected = Series(</span><span class="s4">1.0</span><span class="s0">, </span><span class="s1">index=expected_index)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_resample_with_pytz(self):</span>
        <span class="s3"># GH 13238</span>
        <span class="s1">s = Series(</span>
            <span class="s4">2</span><span class="s0">, </span><span class="s1">index=date_range(</span><span class="s2">&quot;2017-01-01&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">48</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>
        <span class="s1">result = s.resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).mean()</span>
        <span class="s1">expected = Series(</span>
            <span class="s4">2.0</span><span class="s0">,</span>
            <span class="s1">index=pd.DatetimeIndex(</span>
                <span class="s1">[</span><span class="s2">&quot;2017-01-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2017-01-02&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
        <span class="s3"># Especially assert that the timezone is LMT for pytz</span>
        <span class="s0">assert </span><span class="s1">result.index.tz == pytz.timezone(</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_with_local_timezone_dateutil(self):</span>
        <span class="s3"># see gh-5430</span>
        <span class="s1">local_timezone = </span><span class="s2">&quot;dateutil/America/Los_Angeles&quot;</span>

        <span class="s1">start = datetime(</span>
            <span class="s1">year=</span><span class="s4">2013</span><span class="s0">, </span><span class="s1">month=</span><span class="s4">11</span><span class="s0">, </span><span class="s1">day=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">hour=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">minute=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">tzinfo=dateutil.tz.tzutc()</span>
        <span class="s1">)</span>
        <span class="s3"># 1 day later</span>
        <span class="s1">end = datetime(</span>
            <span class="s1">year=</span><span class="s4">2013</span><span class="s0">, </span><span class="s1">month=</span><span class="s4">11</span><span class="s0">, </span><span class="s1">day=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">hour=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">minute=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">tzinfo=dateutil.tz.tzutc()</span>
        <span class="s1">)</span>

        <span class="s1">index = date_range(start</span><span class="s0">, </span><span class="s1">end</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;idx&quot;</span><span class="s1">)</span>

        <span class="s1">series = Series(</span><span class="s4">1</span><span class="s0">, </span><span class="s1">index=index)</span>
        <span class="s1">series = series.tz_convert(local_timezone)</span>
        <span class="s1">result = series.resample(</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;period&quot;</span><span class="s1">).mean()</span>

        <span class="s3"># Create the expected series</span>
        <span class="s3"># Index is moved back a day with the timezone conversion from UTC to</span>
        <span class="s3"># Pacific</span>
        <span class="s1">expected_index = (</span>
            <span class="s1">period_range(start=start</span><span class="s0">, </span><span class="s1">end=end</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;idx&quot;</span><span class="s1">) - offsets.Day()</span>
        <span class="s1">)</span>
        <span class="s1">expected = Series(</span><span class="s4">1.0</span><span class="s0">, </span><span class="s1">index=expected_index)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_resample_nonexistent_time_bin_edge(self):</span>
        <span class="s3"># GH 19375</span>
        <span class="s1">index = date_range(</span><span class="s2">&quot;2017-03-12&quot;</span><span class="s0">, </span><span class="s2">&quot;2017-03-12 1:45:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;15T&quot;</span><span class="s1">)</span>
        <span class="s1">s = Series(np.zeros(len(index))</span><span class="s0">, </span><span class="s1">index=index)</span>
        <span class="s1">expected = s.tz_localize(</span><span class="s2">&quot;US/Pacific&quot;</span><span class="s1">)</span>
        <span class="s1">expected.index = pd.DatetimeIndex(expected.index</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;900S&quot;</span><span class="s1">)</span>
        <span class="s1">result = expected.resample(</span><span class="s2">&quot;900S&quot;</span><span class="s1">).mean()</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s3"># GH 23742</span>
        <span class="s1">index = date_range(start=</span><span class="s2">&quot;2017-10-10&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;2017-10-20&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;1H&quot;</span><span class="s1">)</span>
        <span class="s1">index = index.tz_localize(</span><span class="s2">&quot;UTC&quot;</span><span class="s1">).tz_convert(</span><span class="s2">&quot;America/Sao_Paulo&quot;</span><span class="s1">)</span>
        <span class="s1">df = DataFrame(data=list(range(len(index)))</span><span class="s0">, </span><span class="s1">index=index)</span>
        <span class="s1">result = df.groupby(pd.Grouper(freq=</span><span class="s2">&quot;1D&quot;</span><span class="s1">)).count()</span>
        <span class="s1">expected = date_range(</span>
            <span class="s1">start=</span><span class="s2">&quot;2017-10-09&quot;</span><span class="s0">,</span>
            <span class="s1">end=</span><span class="s2">&quot;2017-10-20&quot;</span><span class="s0">,</span>
            <span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s0">,</span>
            <span class="s1">tz=</span><span class="s2">&quot;America/Sao_Paulo&quot;</span><span class="s0">,</span>
            <span class="s1">nonexistent=</span><span class="s2">&quot;shift_forward&quot;</span><span class="s0">,</span>
            <span class="s1">inclusive=</span><span class="s2">&quot;left&quot;</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(result.index</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_resample_ambiguous_time_bin_edge(self):</span>
        <span class="s3"># GH 10117</span>
        <span class="s1">idx = date_range(</span>
            <span class="s2">&quot;2014-10-25 22:00:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2014-10-26 00:30:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;30T&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;Europe/London&quot;</span>
        <span class="s1">)</span>
        <span class="s1">expected = Series(np.zeros(len(idx))</span><span class="s0">, </span><span class="s1">index=idx)</span>
        <span class="s1">result = expected.resample(</span><span class="s2">&quot;30T&quot;</span><span class="s1">).mean()</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_fill_method_and_how_upsample(self):</span>
        <span class="s3"># GH2073</span>
        <span class="s1">s = Series(</span>
            <span class="s1">np.arange(</span><span class="s4">9</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;int64&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">index=date_range(</span><span class="s2">&quot;2010-01-01&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">9</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;Q&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">last = s.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).ffill()</span>
        <span class="s1">both = s.resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).ffill().resample(</span><span class="s2">&quot;M&quot;</span><span class="s1">).last().astype(</span><span class="s2">&quot;int64&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(last</span><span class="s0">, </span><span class="s1">both)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;day&quot;</span><span class="s0">, </span><span class="s1">DAYS)</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;target&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;convention&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;start&quot;</span><span class="s0">, </span><span class="s2">&quot;end&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_weekly_upsample(self</span><span class="s0">, </span><span class="s1">day</span><span class="s0">, </span><span class="s1">target</span><span class="s0">, </span><span class="s1">convention</span><span class="s0">, </span><span class="s1">simple_period_range_series):</span>
        <span class="s1">freq = </span><span class="s2">f&quot;W-</span><span class="s0">{</span><span class="s1">day</span><span class="s0">}</span><span class="s2">&quot;</span>
        <span class="s1">ts = simple_period_range_series(</span><span class="s2">&quot;1/1/1990&quot;</span><span class="s0">, </span><span class="s2">&quot;12/31/1995&quot;</span><span class="s0">, </span><span class="s1">freq=freq)</span>
        <span class="s1">result = ts.resample(target</span><span class="s0">, </span><span class="s1">convention=convention).ffill()</span>
        <span class="s1">expected = result.to_timestamp(target</span><span class="s0">, </span><span class="s1">how=convention)</span>
        <span class="s1">expected = expected.asfreq(target</span><span class="s0">, </span><span class="s2">&quot;ffill&quot;</span><span class="s1">).to_period()</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_resample_to_timestamps(self</span><span class="s0">, </span><span class="s1">simple_period_range_series):</span>
        <span class="s1">ts = simple_period_range_series(</span><span class="s2">&quot;1/1/1990&quot;</span><span class="s0">, </span><span class="s2">&quot;12/31/1995&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span>

        <span class="s1">result = ts.resample(</span><span class="s2">&quot;A-DEC&quot;</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;timestamp&quot;</span><span class="s1">).mean()</span>
        <span class="s1">expected = ts.to_timestamp(how=</span><span class="s2">&quot;start&quot;</span><span class="s1">).resample(</span><span class="s2">&quot;A-DEC&quot;</span><span class="s1">).mean()</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_resample_to_quarterly(self</span><span class="s0">, </span><span class="s1">simple_period_range_series):</span>
        <span class="s0">for </span><span class="s1">month </span><span class="s0">in </span><span class="s1">MONTHS:</span>
            <span class="s1">ts = simple_period_range_series(</span><span class="s2">&quot;1990&quot;</span><span class="s0">, </span><span class="s2">&quot;1992&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">f&quot;A-</span><span class="s0">{</span><span class="s1">month</span><span class="s0">}</span><span class="s2">&quot;</span><span class="s1">)</span>
            <span class="s1">quar_ts = ts.resample(</span><span class="s2">f&quot;Q-</span><span class="s0">{</span><span class="s1">month</span><span class="s0">}</span><span class="s2">&quot;</span><span class="s1">).ffill()</span>

            <span class="s1">stamps = ts.to_timestamp(</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">how=</span><span class="s2">&quot;start&quot;</span><span class="s1">)</span>
            <span class="s1">qdates = period_range(</span>
                <span class="s1">ts.index[</span><span class="s4">0</span><span class="s1">].asfreq(</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;start&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">ts.index[-</span><span class="s4">1</span><span class="s1">].asfreq(</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;end&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">freq=</span><span class="s2">f&quot;Q-</span><span class="s0">{</span><span class="s1">month</span><span class="s0">}</span><span class="s2">&quot;</span><span class="s0">,</span>
            <span class="s1">)</span>

            <span class="s1">expected = stamps.reindex(qdates.to_timestamp(</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;s&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">method=</span><span class="s2">&quot;ffill&quot;</span><span class="s1">)</span>
            <span class="s1">expected.index = qdates</span>

            <span class="s1">tm.assert_series_equal(quar_ts</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s3"># conforms, but different month</span>
        <span class="s1">ts = simple_period_range_series(</span><span class="s2">&quot;1990&quot;</span><span class="s0">, </span><span class="s2">&quot;1992&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;A-JUN&quot;</span><span class="s1">)</span>

        <span class="s0">for </span><span class="s1">how </span><span class="s0">in </span><span class="s1">[</span><span class="s2">&quot;start&quot;</span><span class="s0">, </span><span class="s2">&quot;end&quot;</span><span class="s1">]:</span>
            <span class="s1">result = ts.resample(</span><span class="s2">&quot;Q-MAR&quot;</span><span class="s0">, </span><span class="s1">convention=how).ffill()</span>
            <span class="s1">expected = ts.asfreq(</span><span class="s2">&quot;Q-MAR&quot;</span><span class="s0">, </span><span class="s1">how=how)</span>
            <span class="s1">expected = expected.reindex(result.index</span><span class="s0">, </span><span class="s1">method=</span><span class="s2">&quot;ffill&quot;</span><span class="s1">)</span>

            <span class="s3"># .to_timestamp('D')</span>
            <span class="s3"># expected = expected.resample('Q-MAR').ffill()</span>

            <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_resample_fill_missing(self):</span>
        <span class="s1">rng = PeriodIndex([</span><span class="s4">2000</span><span class="s0">, </span><span class="s4">2005</span><span class="s0">, </span><span class="s4">2007</span><span class="s0">, </span><span class="s4">2009</span><span class="s1">]</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;A&quot;</span><span class="s1">)</span>

        <span class="s1">s = Series(np.random.randn(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=rng)</span>

        <span class="s1">stamps = s.to_timestamp()</span>
        <span class="s1">filled = s.resample(</span><span class="s2">&quot;A&quot;</span><span class="s1">).ffill()</span>
        <span class="s1">expected = stamps.resample(</span><span class="s2">&quot;A&quot;</span><span class="s1">).ffill().to_period(</span><span class="s2">&quot;A&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(filled</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_cant_fill_missing_dups(self):</span>
        <span class="s1">rng = PeriodIndex([</span><span class="s4">2000</span><span class="s0">, </span><span class="s4">2005</span><span class="s0">, </span><span class="s4">2005</span><span class="s0">, </span><span class="s4">2007</span><span class="s0">, </span><span class="s4">2007</span><span class="s1">]</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;A&quot;</span><span class="s1">)</span>
        <span class="s1">s = Series(np.random.randn(</span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=rng)</span>
        <span class="s1">msg = </span><span class="s2">&quot;Reindexing only valid with uniquely valued Index objects&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(InvalidIndexError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">s.resample(</span><span class="s2">&quot;A&quot;</span><span class="s1">).ffill()</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;freq&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;5min&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;kind&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;period&quot;</span><span class="s0">, None, </span><span class="s2">&quot;timestamp&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_resample_5minute(self</span><span class="s0">, </span><span class="s1">freq</span><span class="s0">, </span><span class="s1">kind):</span>
        <span class="s1">rng = period_range(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s2">&quot;1/5/2000&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;T&quot;</span><span class="s1">)</span>
        <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">index=rng)</span>
        <span class="s1">expected = ts.to_timestamp().resample(freq).mean()</span>
        <span class="s0">if </span><span class="s1">kind != </span><span class="s2">&quot;timestamp&quot;</span><span class="s1">:</span>
            <span class="s1">expected = expected.to_period(freq)</span>
        <span class="s1">result = ts.resample(freq</span><span class="s0">, </span><span class="s1">kind=kind).mean()</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_upsample_daily_business_daily(self</span><span class="s0">, </span><span class="s1">simple_period_range_series):</span>
        <span class="s1">ts = simple_period_range_series(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s2">&quot;2/1/2000&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;B&quot;</span><span class="s1">)</span>

        <span class="s1">result = ts.resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).asfreq()</span>
        <span class="s1">expected = ts.asfreq(</span><span class="s2">&quot;D&quot;</span><span class="s1">).reindex(period_range(</span><span class="s2">&quot;1/3/2000&quot;</span><span class="s0">, </span><span class="s2">&quot;2/1/2000&quot;</span><span class="s1">))</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">ts = simple_period_range_series(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s2">&quot;2/1/2000&quot;</span><span class="s1">)</span>
        <span class="s1">result = ts.resample(</span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s1">convention=</span><span class="s2">&quot;s&quot;</span><span class="s1">).asfreq()</span>
        <span class="s1">exp_rng = period_range(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s2">&quot;2/1/2000 23:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;H&quot;</span><span class="s1">)</span>
        <span class="s1">expected = ts.asfreq(</span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s1">how=</span><span class="s2">&quot;s&quot;</span><span class="s1">).reindex(exp_rng)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_resample_irregular_sparse(self):</span>
        <span class="s1">dr = date_range(start=</span><span class="s2">&quot;1/1/2012&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;5min&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">1000</span><span class="s1">)</span>
        <span class="s1">s = Series(np.array(</span><span class="s4">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=dr)</span>
        <span class="s3"># subset the data.</span>
        <span class="s1">subset = s[:</span><span class="s2">&quot;2012-01-04 06:55&quot;</span><span class="s1">]</span>

        <span class="s1">result = subset.resample(</span><span class="s2">&quot;10min&quot;</span><span class="s1">).apply(len)</span>
        <span class="s1">expected = s.resample(</span><span class="s2">&quot;10min&quot;</span><span class="s1">).apply(len).loc[result.index]</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_resample_weekly_all_na(self):</span>
        <span class="s1">rng = date_range(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">10</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;W-WED&quot;</span><span class="s1">)</span>
        <span class="s1">ts = Series(np.random.randn(len(rng))</span><span class="s0">, </span><span class="s1">index=rng)</span>

        <span class="s1">result = ts.resample(</span><span class="s2">&quot;W-THU&quot;</span><span class="s1">).asfreq()</span>

        <span class="s0">assert </span><span class="s1">result.isna().all()</span>

        <span class="s1">result = ts.resample(</span><span class="s2">&quot;W-THU&quot;</span><span class="s1">).asfreq().ffill()[:-</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">expected = ts.asfreq(</span><span class="s2">&quot;W-THU&quot;</span><span class="s1">).ffill()</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_resample_tz_localized(self):</span>
        <span class="s1">dr = date_range(start=</span><span class="s2">&quot;2012-4-13&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;2012-5-1&quot;</span><span class="s1">)</span>
        <span class="s1">ts = Series(range(len(dr))</span><span class="s0">, </span><span class="s1">index=dr)</span>

        <span class="s1">ts_utc = ts.tz_localize(</span><span class="s2">&quot;UTC&quot;</span><span class="s1">)</span>
        <span class="s1">ts_local = ts_utc.tz_convert(</span><span class="s2">&quot;America/Los_Angeles&quot;</span><span class="s1">)</span>

        <span class="s1">result = ts_local.resample(</span><span class="s2">&quot;W&quot;</span><span class="s1">).mean()</span>

        <span class="s1">ts_local_naive = ts_local.copy()</span>
        <span class="s1">ts_local_naive.index = [</span>
            <span class="s1">x.replace(tzinfo=</span><span class="s0">None</span><span class="s1">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">ts_local_naive.index.to_pydatetime()</span>
        <span class="s1">]</span>

        <span class="s1">exp = ts_local_naive.resample(</span><span class="s2">&quot;W&quot;</span><span class="s1">).mean().tz_localize(</span><span class="s2">&quot;America/Los_Angeles&quot;</span><span class="s1">)</span>
        <span class="s1">exp.index = pd.DatetimeIndex(exp.index</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;W&quot;</span><span class="s1">)</span>

        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s3"># it works</span>
        <span class="s1">result = ts_local.resample(</span><span class="s2">&quot;D&quot;</span><span class="s1">).mean()</span>

        <span class="s3"># #2245</span>
        <span class="s1">idx = date_range(</span>
            <span class="s2">&quot;2001-09-20 15:59&quot;</span><span class="s0">, </span><span class="s2">&quot;2001-09-20 16:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;T&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;Australia/Sydney&quot;</span>
        <span class="s1">)</span>
        <span class="s1">s = Series([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=idx)</span>

        <span class="s1">result = s.resample(</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;right&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;right&quot;</span><span class="s1">).mean()</span>
        <span class="s1">ex_index = date_range(</span><span class="s2">&quot;2001-09-21&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;Australia/Sydney&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Series([</span><span class="s4">1.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=ex_index)</span>

        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s3"># for good measure</span>
        <span class="s1">result = s.resample(</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">kind=</span><span class="s2">&quot;period&quot;</span><span class="s1">).mean()</span>
        <span class="s1">ex_index = period_range(</span><span class="s2">&quot;2001-09-20&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Series([</span><span class="s4">1.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=ex_index)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s3"># GH 6397</span>
        <span class="s3"># comparing an offset that doesn't propagate tz's</span>
        <span class="s1">rng = date_range(</span><span class="s2">&quot;1/1/2011&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">20000</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;H&quot;</span><span class="s1">)</span>
        <span class="s1">rng = rng.tz_localize(</span><span class="s2">&quot;EST&quot;</span><span class="s1">)</span>
        <span class="s1">ts = DataFrame(index=rng)</span>
        <span class="s1">ts[</span><span class="s2">&quot;first&quot;</span><span class="s1">] = np.random.randn(len(rng))</span>
        <span class="s1">ts[</span><span class="s2">&quot;second&quot;</span><span class="s1">] = np.cumsum(np.random.randn(len(rng)))</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;first&quot;</span><span class="s1">: ts.resample(</span><span class="s2">&quot;A&quot;</span><span class="s1">).sum()[</span><span class="s2">&quot;first&quot;</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;second&quot;</span><span class="s1">: ts.resample(</span><span class="s2">&quot;A&quot;</span><span class="s1">).mean()[</span><span class="s2">&quot;second&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">}</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s2">&quot;first&quot;</span><span class="s0">, </span><span class="s2">&quot;second&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">result = (</span>
            <span class="s1">ts.resample(</span><span class="s2">&quot;A&quot;</span><span class="s1">)</span>
            <span class="s1">.agg({</span><span class="s2">&quot;first&quot;</span><span class="s1">: np.sum</span><span class="s0">, </span><span class="s2">&quot;second&quot;</span><span class="s1">: np.mean})</span>
            <span class="s1">.reindex(columns=[</span><span class="s2">&quot;first&quot;</span><span class="s0">, </span><span class="s2">&quot;second&quot;</span><span class="s1">])</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_closed_left_corner(self):</span>
        <span class="s3"># #1465</span>
        <span class="s1">s = Series(</span>
            <span class="s1">np.random.randn(</span><span class="s4">21</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">index=date_range(start=</span><span class="s2">&quot;1/1/2012 9:30&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;1min&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">21</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">s[</span><span class="s4">0</span><span class="s1">] = np.nan</span>

        <span class="s1">result = s.resample(</span><span class="s2">&quot;10min&quot;</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;left&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;right&quot;</span><span class="s1">).mean()</span>
        <span class="s1">exp = s[</span><span class="s4">1</span><span class="s1">:].resample(</span><span class="s2">&quot;10min&quot;</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;left&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;right&quot;</span><span class="s1">).mean()</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s1">result = s.resample(</span><span class="s2">&quot;10min&quot;</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;left&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;left&quot;</span><span class="s1">).mean()</span>
        <span class="s1">exp = s[</span><span class="s4">1</span><span class="s1">:].resample(</span><span class="s2">&quot;10min&quot;</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;left&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;left&quot;</span><span class="s1">).mean()</span>

        <span class="s1">ex_index = date_range(start=</span><span class="s2">&quot;1/1/2012 9:30&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;10min&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">3</span><span class="s1">)</span>

        <span class="s1">tm.assert_index_equal(result.index</span><span class="s0">, </span><span class="s1">ex_index)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">exp)</span>

    <span class="s0">def </span><span class="s1">test_quarterly_resampling(self):</span>
        <span class="s1">rng = period_range(</span><span class="s2">&quot;2000Q1&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">10</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;Q-DEC&quot;</span><span class="s1">)</span>
        <span class="s1">ts = Series(np.arange(</span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=rng)</span>

        <span class="s1">result = ts.resample(</span><span class="s2">&quot;A&quot;</span><span class="s1">).mean()</span>
        <span class="s1">exp = ts.to_timestamp().resample(</span><span class="s2">&quot;A&quot;</span><span class="s1">).mean().to_period()</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">exp)</span>

    <span class="s0">def </span><span class="s1">test_resample_weekly_bug_1726(self):</span>
        <span class="s3"># 8/6/12 is a Monday</span>
        <span class="s1">ind = date_range(start=</span><span class="s2">&quot;8/6/2012&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;8/26/2012&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">)</span>
        <span class="s1">n = len(ind)</span>
        <span class="s1">data = [[x] * </span><span class="s4">5 </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range(n)]</span>
        <span class="s1">df = DataFrame(data</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s2">&quot;open&quot;</span><span class="s0">, </span><span class="s2">&quot;high&quot;</span><span class="s0">, </span><span class="s2">&quot;low&quot;</span><span class="s0">, </span><span class="s2">&quot;close&quot;</span><span class="s0">, </span><span class="s2">&quot;vol&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=ind)</span>

        <span class="s3"># it works!</span>
        <span class="s1">df.resample(</span><span class="s2">&quot;W-MON&quot;</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;left&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;left&quot;</span><span class="s1">).first()</span>

    <span class="s0">def </span><span class="s1">test_resample_with_dst_time_change(self):</span>
        <span class="s3"># GH 15549</span>
        <span class="s1">index = (</span>
            <span class="s1">pd.DatetimeIndex([</span><span class="s4">1457537600000000000</span><span class="s0">, </span><span class="s4">1458059600000000000</span><span class="s1">])</span>
            <span class="s1">.tz_localize(</span><span class="s2">&quot;UTC&quot;</span><span class="s1">)</span>
            <span class="s1">.tz_convert(</span><span class="s2">&quot;America/Chicago&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>
        <span class="s1">df = DataFrame([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=index)</span>
        <span class="s1">result = df.resample(</span><span class="s2">&quot;12h&quot;</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;right&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;right&quot;</span><span class="s1">).last().ffill()</span>

        <span class="s1">expected_index_values = [</span>
            <span class="s2">&quot;2016-03-09 12:00:00-06:00&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;2016-03-10 00:00:00-06:00&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;2016-03-10 12:00:00-06:00&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;2016-03-11 00:00:00-06:00&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;2016-03-11 12:00:00-06:00&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;2016-03-12 00:00:00-06:00&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;2016-03-12 12:00:00-06:00&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;2016-03-13 00:00:00-06:00&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;2016-03-13 13:00:00-05:00&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;2016-03-14 01:00:00-05:00&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;2016-03-14 13:00:00-05:00&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;2016-03-15 01:00:00-05:00&quot;</span><span class="s0">,</span>
            <span class="s2">&quot;2016-03-15 13:00:00-05:00&quot;</span><span class="s0">,</span>
        <span class="s1">]</span>
        <span class="s1">index = pd.to_datetime(expected_index_values</span><span class="s0">, </span><span class="s1">utc=</span><span class="s0">True</span><span class="s1">).tz_convert(</span>
            <span class="s2">&quot;America/Chicago&quot;</span>
        <span class="s1">)</span>
        <span class="s1">index = pd.DatetimeIndex(index</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;12h&quot;</span><span class="s1">)</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[</span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">2.0</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">index=index</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_resample_bms_2752(self):</span>
        <span class="s3"># GH2753</span>
        <span class="s1">foo = Series(index=pd.bdate_range(</span><span class="s2">&quot;20000101&quot;</span><span class="s0">, </span><span class="s2">&quot;20000201&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=np.float64)</span>
        <span class="s1">res1 = foo.resample(</span><span class="s2">&quot;BMS&quot;</span><span class="s1">).mean()</span>
        <span class="s1">res2 = foo.resample(</span><span class="s2">&quot;BMS&quot;</span><span class="s1">).mean().resample(</span><span class="s2">&quot;B&quot;</span><span class="s1">).mean()</span>
        <span class="s0">assert </span><span class="s1">res1.index[</span><span class="s4">0</span><span class="s1">] == Timestamp(</span><span class="s2">&quot;20000103&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">res1.index[</span><span class="s4">0</span><span class="s1">] == res2.index[</span><span class="s4">0</span><span class="s1">]</span>

    <span class="s3"># def test_monthly_convention_span(self):</span>
    <span class="s3">#     rng = period_range('2000-01', periods=3, freq='M')</span>
    <span class="s3">#     ts = Series(np.arange(3), index=rng)</span>

    <span class="s3">#     # hacky way to get same thing</span>
    <span class="s3">#     exp_index = period_range('2000-01-01', '2000-03-31', freq='D')</span>
    <span class="s3">#     expected = ts.asfreq('D', how='end').reindex(exp_index)</span>
    <span class="s3">#     expected = expected.fillna(method='bfill')</span>

    <span class="s3">#     result = ts.resample('D', convention='span').mean()</span>

    <span class="s3">#     tm.assert_series_equal(result, expected)</span>

    <span class="s0">def </span><span class="s1">test_default_right_closed_label(self):</span>
        <span class="s1">end_freq = [</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;Q&quot;</span><span class="s0">, </span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s1">]</span>
        <span class="s1">end_types = [</span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;Q&quot;</span><span class="s0">, </span><span class="s2">&quot;W&quot;</span><span class="s1">]</span>

        <span class="s0">for </span><span class="s1">from_freq</span><span class="s0">, </span><span class="s1">to_freq </span><span class="s0">in </span><span class="s1">zip(end_freq</span><span class="s0">, </span><span class="s1">end_types):</span>
            <span class="s1">idx = date_range(start=</span><span class="s2">&quot;8/15/2012&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">100</span><span class="s0">, </span><span class="s1">freq=from_freq)</span>
            <span class="s1">df = DataFrame(np.random.randn(len(idx)</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">idx)</span>

            <span class="s1">resampled = df.resample(to_freq).mean()</span>
            <span class="s1">tm.assert_frame_equal(</span>
                <span class="s1">resampled</span><span class="s0">, </span><span class="s1">df.resample(to_freq</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;right&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;right&quot;</span><span class="s1">).mean()</span>
            <span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_default_left_closed_label(self):</span>
        <span class="s1">others = [</span><span class="s2">&quot;MS&quot;</span><span class="s0">, </span><span class="s2">&quot;AS&quot;</span><span class="s0">, </span><span class="s2">&quot;QS&quot;</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;H&quot;</span><span class="s1">]</span>
        <span class="s1">others_freq = [</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;Q&quot;</span><span class="s0">, </span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s2">&quot;T&quot;</span><span class="s1">]</span>

        <span class="s0">for </span><span class="s1">from_freq</span><span class="s0">, </span><span class="s1">to_freq </span><span class="s0">in </span><span class="s1">zip(others_freq</span><span class="s0">, </span><span class="s1">others):</span>
            <span class="s1">idx = date_range(start=</span><span class="s2">&quot;8/15/2012&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">100</span><span class="s0">, </span><span class="s1">freq=from_freq)</span>
            <span class="s1">df = DataFrame(np.random.randn(len(idx)</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">idx)</span>

            <span class="s1">resampled = df.resample(to_freq).mean()</span>
            <span class="s1">tm.assert_frame_equal(</span>
                <span class="s1">resampled</span><span class="s0">, </span><span class="s1">df.resample(to_freq</span><span class="s0">, </span><span class="s1">closed=</span><span class="s2">&quot;left&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;left&quot;</span><span class="s1">).mean()</span>
            <span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_all_values_single_bin(self):</span>
        <span class="s3"># 2070</span>
        <span class="s1">index = period_range(start=</span><span class="s2">&quot;2012-01-01&quot;</span><span class="s0">, </span><span class="s1">end=</span><span class="s2">&quot;2012-12-31&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span>
        <span class="s1">s = Series(np.random.randn(len(index))</span><span class="s0">, </span><span class="s1">index=index)</span>

        <span class="s1">result = s.resample(</span><span class="s2">&quot;A&quot;</span><span class="s1">).mean()</span>
        <span class="s1">tm.assert_almost_equal(result[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">s.mean())</span>

    <span class="s0">def </span><span class="s1">test_evenly_divisible_with_no_extra_bins(self):</span>
        <span class="s3"># 4076</span>
        <span class="s3"># when the frequency is evenly divisible, sometimes extra bins</span>

        <span class="s1">df = DataFrame(np.random.randn(</span><span class="s4">9</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=date_range(</span><span class="s2">&quot;2000-1-1&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">9</span><span class="s1">))</span>
        <span class="s1">result = df.resample(</span><span class="s2">&quot;5D&quot;</span><span class="s1">).mean()</span>
        <span class="s1">expected = pd.concat([df.iloc[</span><span class="s4">0</span><span class="s1">:</span><span class="s4">5</span><span class="s1">].mean()</span><span class="s0">, </span><span class="s1">df.iloc[</span><span class="s4">5</span><span class="s1">:].mean()]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">).T</span>
        <span class="s1">expected.index = pd.DatetimeIndex(</span>
            <span class="s1">[Timestamp(</span><span class="s2">&quot;2000-1-1&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">Timestamp(</span><span class="s2">&quot;2000-1-6&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;5D&quot;</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">index = date_range(start=</span><span class="s2">&quot;2001-5-4&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">28</span><span class="s1">)</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">[</span>
                <span class="s1">{</span>
                    <span class="s2">&quot;REST_KEY&quot;</span><span class="s1">: </span><span class="s4">1</span><span class="s0">,</span>
                    <span class="s2">&quot;DLY_TRN_QT&quot;</span><span class="s1">: </span><span class="s4">80</span><span class="s0">,</span>
                    <span class="s2">&quot;DLY_SLS_AMT&quot;</span><span class="s1">: </span><span class="s4">90</span><span class="s0">,</span>
                    <span class="s2">&quot;COOP_DLY_TRN_QT&quot;</span><span class="s1">: </span><span class="s4">30</span><span class="s0">,</span>
                    <span class="s2">&quot;COOP_DLY_SLS_AMT&quot;</span><span class="s1">: </span><span class="s4">20</span><span class="s0">,</span>
                <span class="s1">}</span>
            <span class="s1">]</span>
            <span class="s1">* </span><span class="s4">28</span>
            <span class="s1">+ [</span>
                <span class="s1">{</span>
                    <span class="s2">&quot;REST_KEY&quot;</span><span class="s1">: </span><span class="s4">2</span><span class="s0">,</span>
                    <span class="s2">&quot;DLY_TRN_QT&quot;</span><span class="s1">: </span><span class="s4">70</span><span class="s0">,</span>
                    <span class="s2">&quot;DLY_SLS_AMT&quot;</span><span class="s1">: </span><span class="s4">10</span><span class="s0">,</span>
                    <span class="s2">&quot;COOP_DLY_TRN_QT&quot;</span><span class="s1">: </span><span class="s4">50</span><span class="s0">,</span>
                    <span class="s2">&quot;COOP_DLY_SLS_AMT&quot;</span><span class="s1">: </span><span class="s4">20</span><span class="s0">,</span>
                <span class="s1">}</span>
            <span class="s1">]</span>
            <span class="s1">* </span><span class="s4">28</span><span class="s0">,</span>
            <span class="s1">index=index.append(index)</span><span class="s0">,</span>
        <span class="s1">).sort_index()</span>

        <span class="s1">index = date_range(</span><span class="s2">&quot;2001-5-4&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">4</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;7D&quot;</span><span class="s1">)</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[</span>
                <span class="s1">{</span>
                    <span class="s2">&quot;REST_KEY&quot;</span><span class="s1">: </span><span class="s4">14</span><span class="s0">,</span>
                    <span class="s2">&quot;DLY_TRN_QT&quot;</span><span class="s1">: </span><span class="s4">14</span><span class="s0">,</span>
                    <span class="s2">&quot;DLY_SLS_AMT&quot;</span><span class="s1">: </span><span class="s4">14</span><span class="s0">,</span>
                    <span class="s2">&quot;COOP_DLY_TRN_QT&quot;</span><span class="s1">: </span><span class="s4">14</span><span class="s0">,</span>
                    <span class="s2">&quot;COOP_DLY_SLS_AMT&quot;</span><span class="s1">: </span><span class="s4">14</span><span class="s0">,</span>
                <span class="s1">}</span>
            <span class="s1">]</span>
            <span class="s1">* </span><span class="s4">4</span><span class="s0">,</span>
            <span class="s1">index=index</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">result = df.resample(</span><span class="s2">&quot;7D&quot;</span><span class="s1">).count()</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[</span>
                <span class="s1">{</span>
                    <span class="s2">&quot;REST_KEY&quot;</span><span class="s1">: </span><span class="s4">21</span><span class="s0">,</span>
                    <span class="s2">&quot;DLY_TRN_QT&quot;</span><span class="s1">: </span><span class="s4">1050</span><span class="s0">,</span>
                    <span class="s2">&quot;DLY_SLS_AMT&quot;</span><span class="s1">: </span><span class="s4">700</span><span class="s0">,</span>
                    <span class="s2">&quot;COOP_DLY_TRN_QT&quot;</span><span class="s1">: </span><span class="s4">560</span><span class="s0">,</span>
                    <span class="s2">&quot;COOP_DLY_SLS_AMT&quot;</span><span class="s1">: </span><span class="s4">280</span><span class="s0">,</span>
                <span class="s1">}</span>
            <span class="s1">]</span>
            <span class="s1">* </span><span class="s4">4</span><span class="s0">,</span>
            <span class="s1">index=index</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">result = df.resample(</span><span class="s2">&quot;7D&quot;</span><span class="s1">).sum()</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;freq, period_mult&quot;</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s4">24</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;12H&quot;</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;kind&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s2">&quot;period&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_upsampling_ohlc(self</span><span class="s0">, </span><span class="s1">freq</span><span class="s0">, </span><span class="s1">period_mult</span><span class="s0">, </span><span class="s1">kind):</span>
        <span class="s3"># GH 13083</span>
        <span class="s1">pi = period_range(start=</span><span class="s2">&quot;2000&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">s = Series(range(len(pi))</span><span class="s0">, </span><span class="s1">index=pi)</span>
        <span class="s1">expected = s.to_timestamp().resample(freq).ohlc().to_period(freq)</span>

        <span class="s3"># timestamp-based resampling doesn't include all sub-periods</span>
        <span class="s3"># of the last original period, so extend accordingly:</span>
        <span class="s1">new_index = period_range(start=</span><span class="s2">&quot;2000&quot;</span><span class="s0">, </span><span class="s1">freq=freq</span><span class="s0">, </span><span class="s1">periods=period_mult * len(pi))</span>
        <span class="s1">expected = expected.reindex(new_index)</span>
        <span class="s1">result = s.resample(freq</span><span class="s0">, </span><span class="s1">kind=kind).ohlc()</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;periods, values&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">(</span>
                <span class="s1">[</span>
                    <span class="s1">pd.NaT</span><span class="s0">,</span>
                    <span class="s2">&quot;1970-01-01 00:00:00&quot;</span><span class="s0">,</span>
                    <span class="s1">pd.NaT</span><span class="s0">,</span>
                    <span class="s2">&quot;1970-01-01 00:00:02&quot;</span><span class="s0">,</span>
                    <span class="s2">&quot;1970-01-01 00:00:03&quot;</span><span class="s0">,</span>
                <span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">11</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span>
                <span class="s1">[</span>
                    <span class="s1">pd.NaT</span><span class="s0">,</span>
                    <span class="s1">pd.NaT</span><span class="s0">,</span>
                    <span class="s2">&quot;1970-01-01 00:00:00&quot;</span><span class="s0">,</span>
                    <span class="s1">pd.NaT</span><span class="s0">,</span>
                    <span class="s1">pd.NaT</span><span class="s0">,</span>
                    <span class="s1">pd.NaT</span><span class="s0">,</span>
                    <span class="s2">&quot;1970-01-01 00:00:02&quot;</span><span class="s0">,</span>
                    <span class="s2">&quot;1970-01-01 00:00:03&quot;</span><span class="s0">,</span>
                    <span class="s1">pd.NaT</span><span class="s0">,</span>
                    <span class="s1">pd.NaT</span><span class="s0">,</span>
                <span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">11</span><span class="s0">, </span><span class="s4">12</span><span class="s0">, </span><span class="s4">13</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;freq, expected_values&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">(</span><span class="s2">&quot;1s&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s1">np.NaN</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">11</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;2s&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s1">(</span><span class="s4">7 </span><span class="s1">+ </span><span class="s4">11</span><span class="s1">) / </span><span class="s4">2</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;3s&quot;</span><span class="s0">, </span><span class="s1">[(</span><span class="s4">3 </span><span class="s1">+ </span><span class="s4">7</span><span class="s1">) / </span><span class="s4">2</span><span class="s0">, </span><span class="s4">11</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_resample_with_nat(self</span><span class="s0">, </span><span class="s1">periods</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">freq</span><span class="s0">, </span><span class="s1">expected_values):</span>
        <span class="s3"># GH 13224</span>
        <span class="s1">index = PeriodIndex(periods</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;S&quot;</span><span class="s1">)</span>
        <span class="s1">frame = DataFrame(values</span><span class="s0">, </span><span class="s1">index=index)</span>

        <span class="s1">expected_index = period_range(</span>
            <span class="s2">&quot;1970-01-01 00:00:00&quot;</span><span class="s0">, </span><span class="s1">periods=len(expected_values)</span><span class="s0">, </span><span class="s1">freq=freq</span>
        <span class="s1">)</span>
        <span class="s1">expected = DataFrame(expected_values</span><span class="s0">, </span><span class="s1">index=expected_index)</span>
        <span class="s1">result = frame.resample(freq).mean()</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_resample_with_only_nat(self):</span>
        <span class="s3"># GH 13224</span>
        <span class="s1">pi = PeriodIndex([pd.NaT] * </span><span class="s4">3</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;S&quot;</span><span class="s1">)</span>
        <span class="s1">frame = DataFrame([</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=pi</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s2">&quot;a&quot;</span><span class="s1">])</span>
        <span class="s1">expected_index = PeriodIndex(data=[]</span><span class="s0">, </span><span class="s1">freq=pi.freq)</span>
        <span class="s1">expected = DataFrame(index=expected_index</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s2">&quot;a&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;float64&quot;</span><span class="s1">)</span>
        <span class="s1">result = frame.resample(</span><span class="s2">&quot;1s&quot;</span><span class="s1">).mean()</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;start,end,start_freq,end_freq,offset&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">(</span><span class="s2">&quot;19910905&quot;</span><span class="s0">, </span><span class="s2">&quot;19910909 03:00&quot;</span><span class="s0">, </span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s2">&quot;24H&quot;</span><span class="s0">, </span><span class="s2">&quot;10H&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;19910905&quot;</span><span class="s0">, </span><span class="s2">&quot;19910909 12:00&quot;</span><span class="s0">, </span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s2">&quot;24H&quot;</span><span class="s0">, </span><span class="s2">&quot;10H&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;19910905&quot;</span><span class="s0">, </span><span class="s2">&quot;19910909 23:00&quot;</span><span class="s0">, </span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s2">&quot;24H&quot;</span><span class="s0">, </span><span class="s2">&quot;10H&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;19910905 10:00&quot;</span><span class="s0">, </span><span class="s2">&quot;19910909&quot;</span><span class="s0">, </span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s2">&quot;24H&quot;</span><span class="s0">, </span><span class="s2">&quot;10H&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;19910905 10:00&quot;</span><span class="s0">, </span><span class="s2">&quot;19910909 10:00&quot;</span><span class="s0">, </span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s2">&quot;24H&quot;</span><span class="s0">, </span><span class="s2">&quot;10H&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;19910905&quot;</span><span class="s0">, </span><span class="s2">&quot;19910909 10:00&quot;</span><span class="s0">, </span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s2">&quot;24H&quot;</span><span class="s0">, </span><span class="s2">&quot;10H&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;19910905 12:00&quot;</span><span class="s0">, </span><span class="s2">&quot;19910909&quot;</span><span class="s0">, </span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s2">&quot;24H&quot;</span><span class="s0">, </span><span class="s2">&quot;10H&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;19910905 12:00&quot;</span><span class="s0">, </span><span class="s2">&quot;19910909 03:00&quot;</span><span class="s0">, </span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s2">&quot;24H&quot;</span><span class="s0">, </span><span class="s2">&quot;10H&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;19910905 12:00&quot;</span><span class="s0">, </span><span class="s2">&quot;19910909 12:00&quot;</span><span class="s0">, </span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s2">&quot;24H&quot;</span><span class="s0">, </span><span class="s2">&quot;10H&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;19910905 12:00&quot;</span><span class="s0">, </span><span class="s2">&quot;19910909 12:00&quot;</span><span class="s0">, </span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s2">&quot;24H&quot;</span><span class="s0">, </span><span class="s2">&quot;34H&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;19910905 12:00&quot;</span><span class="s0">, </span><span class="s2">&quot;19910909 12:00&quot;</span><span class="s0">, </span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s2">&quot;17H&quot;</span><span class="s0">, </span><span class="s2">&quot;10H&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;19910905 12:00&quot;</span><span class="s0">, </span><span class="s2">&quot;19910909 12:00&quot;</span><span class="s0">, </span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s2">&quot;17H&quot;</span><span class="s0">, </span><span class="s2">&quot;3H&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;19910905 12:00&quot;</span><span class="s0">, </span><span class="s2">&quot;19910909 1:00&quot;</span><span class="s0">, </span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s2">&quot;3H&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;19910905&quot;</span><span class="s0">, </span><span class="s2">&quot;19910913 06:00&quot;</span><span class="s0">, </span><span class="s2">&quot;2H&quot;</span><span class="s0">, </span><span class="s2">&quot;24H&quot;</span><span class="s0">, </span><span class="s2">&quot;10H&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;19910905&quot;</span><span class="s0">, </span><span class="s2">&quot;19910905 01:39&quot;</span><span class="s0">, </span><span class="s2">&quot;Min&quot;</span><span class="s0">, </span><span class="s2">&quot;5Min&quot;</span><span class="s0">, </span><span class="s2">&quot;3Min&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;19910905&quot;</span><span class="s0">, </span><span class="s2">&quot;19910905 03:18&quot;</span><span class="s0">, </span><span class="s2">&quot;2Min&quot;</span><span class="s0">, </span><span class="s2">&quot;5Min&quot;</span><span class="s0">, </span><span class="s2">&quot;3Min&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_resample_with_offset(self</span><span class="s0">, </span><span class="s1">start</span><span class="s0">, </span><span class="s1">end</span><span class="s0">, </span><span class="s1">start_freq</span><span class="s0">, </span><span class="s1">end_freq</span><span class="s0">, </span><span class="s1">offset):</span>
        <span class="s3"># GH 23882 &amp; 31809</span>
        <span class="s1">s = Series(</span><span class="s4">0</span><span class="s0">, </span><span class="s1">index=period_range(start</span><span class="s0">, </span><span class="s1">end</span><span class="s0">, </span><span class="s1">freq=start_freq))</span>
        <span class="s1">s = s + np.arange(len(s))</span>
        <span class="s1">result = s.resample(end_freq</span><span class="s0">, </span><span class="s1">offset=offset).mean()</span>
        <span class="s1">result = result.to_timestamp(end_freq)</span>

        <span class="s1">expected = s.to_timestamp().resample(end_freq</span><span class="s0">, </span><span class="s1">offset=offset).mean()</span>
        <span class="s0">if </span><span class="s1">end_freq == </span><span class="s2">&quot;M&quot;</span><span class="s1">:</span>
            <span class="s3"># TODO: is non-tick the relevant characteristic? (GH 33815)</span>
            <span class="s1">expected.index = expected.index._with_freq(</span><span class="s0">None</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;first,last,freq,exp_first,exp_last&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">(</span><span class="s2">&quot;19910905&quot;</span><span class="s0">, </span><span class="s2">&quot;19920406&quot;</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;19910905&quot;</span><span class="s0">, </span><span class="s2">&quot;19920406&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;19910905 00:00&quot;</span><span class="s0">, </span><span class="s2">&quot;19920406 06:00&quot;</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;19910905&quot;</span><span class="s0">, </span><span class="s2">&quot;19920406&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span>
                <span class="s2">&quot;19910905 06:00&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;19920406 06:00&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;H&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;19910905 06:00&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;19920406 06:00&quot;</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;19910906&quot;</span><span class="s0">, </span><span class="s2">&quot;19920406&quot;</span><span class="s0">, </span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s2">&quot;1991-09&quot;</span><span class="s0">, </span><span class="s2">&quot;1992-04&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;19910831&quot;</span><span class="s0">, </span><span class="s2">&quot;19920430&quot;</span><span class="s0">, </span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s2">&quot;1991-08&quot;</span><span class="s0">, </span><span class="s2">&quot;1992-04&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;1991-08&quot;</span><span class="s0">, </span><span class="s2">&quot;1992-04&quot;</span><span class="s0">, </span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s2">&quot;1991-08&quot;</span><span class="s0">, </span><span class="s2">&quot;1992-04&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_get_period_range_edges(self</span><span class="s0">, </span><span class="s1">first</span><span class="s0">, </span><span class="s1">last</span><span class="s0">, </span><span class="s1">freq</span><span class="s0">, </span><span class="s1">exp_first</span><span class="s0">, </span><span class="s1">exp_last):</span>
        <span class="s1">first = Period(first)</span>
        <span class="s1">last = Period(last)</span>

        <span class="s1">exp_first = Period(exp_first</span><span class="s0">, </span><span class="s1">freq=freq)</span>
        <span class="s1">exp_last = Period(exp_last</span><span class="s0">, </span><span class="s1">freq=freq)</span>

        <span class="s1">freq = pd.tseries.frequencies.to_offset(freq)</span>
        <span class="s1">result = _get_period_range_edges(first</span><span class="s0">, </span><span class="s1">last</span><span class="s0">, </span><span class="s1">freq)</span>
        <span class="s1">expected = (exp_first</span><span class="s0">, </span><span class="s1">exp_last)</span>
        <span class="s0">assert </span><span class="s1">result == expected</span>

    <span class="s0">def </span><span class="s1">test_sum_min_count(self):</span>
        <span class="s3"># GH 19974</span>
        <span class="s1">index = date_range(start=</span><span class="s2">&quot;2018&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">6</span><span class="s1">)</span>
        <span class="s1">data = np.ones(</span><span class="s4">6</span><span class="s1">)</span>
        <span class="s1">data[</span><span class="s4">3</span><span class="s1">:</span><span class="s4">6</span><span class="s1">] = np.nan</span>
        <span class="s1">s = Series(data</span><span class="s0">, </span><span class="s1">index).to_period()</span>
        <span class="s1">result = s.resample(</span><span class="s2">&quot;Q&quot;</span><span class="s1">).sum(min_count=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">expected = Series(</span>
            <span class="s1">[</span><span class="s4">3.0</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">index=PeriodIndex([</span><span class="s2">&quot;2018Q1&quot;</span><span class="s0">, </span><span class="s2">&quot;2018Q2&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;Q-DEC&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
</pre>
</body>
</html>