<html>
<head>
<title>_bullet.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
_bullet.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">__future__ </span><span class="s0">import </span><span class="s1">absolute_import</span>

<span class="s0">import </span><span class="s1">collections</span>
<span class="s0">import </span><span class="s1">math</span>

<span class="s0">from </span><span class="s1">plotly </span><span class="s0">import </span><span class="s1">exceptions</span><span class="s0">, </span><span class="s1">optional_imports</span>
<span class="s0">import </span><span class="s1">plotly.colors </span><span class="s0">as </span><span class="s1">clrs</span>
<span class="s0">from </span><span class="s1">plotly.figure_factory </span><span class="s0">import </span><span class="s1">utils</span>

<span class="s0">import </span><span class="s1">plotly</span>
<span class="s0">import </span><span class="s1">plotly.graph_objs </span><span class="s0">as </span><span class="s1">go</span>

<span class="s1">pd = optional_imports.get_module(</span><span class="s2">&quot;pandas&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">_bullet(</span>
    <span class="s1">df</span><span class="s0">,</span>
    <span class="s1">markers</span><span class="s0">,</span>
    <span class="s1">measures</span><span class="s0">,</span>
    <span class="s1">ranges</span><span class="s0">,</span>
    <span class="s1">subtitles</span><span class="s0">,</span>
    <span class="s1">titles</span><span class="s0">,</span>
    <span class="s1">orientation</span><span class="s0">,</span>
    <span class="s1">range_colors</span><span class="s0">,</span>
    <span class="s1">measure_colors</span><span class="s0">,</span>
    <span class="s1">horizontal_spacing</span><span class="s0">,</span>
    <span class="s1">vertical_spacing</span><span class="s0">,</span>
    <span class="s1">scatter_options</span><span class="s0">,</span>
    <span class="s1">layout_options</span><span class="s0">,</span>
<span class="s1">):</span>
    <span class="s1">num_of_lanes = len(df)</span>
    <span class="s1">num_of_rows = num_of_lanes </span><span class="s0">if </span><span class="s1">orientation == </span><span class="s2">&quot;h&quot; </span><span class="s0">else </span><span class="s3">1</span>
    <span class="s1">num_of_cols = </span><span class="s3">1 </span><span class="s0">if </span><span class="s1">orientation == </span><span class="s2">&quot;h&quot; </span><span class="s0">else </span><span class="s1">num_of_lanes</span>
    <span class="s0">if not </span><span class="s1">horizontal_spacing:</span>
        <span class="s1">horizontal_spacing = </span><span class="s3">1.0 </span><span class="s1">/ num_of_lanes</span>
    <span class="s0">if not </span><span class="s1">vertical_spacing:</span>
        <span class="s1">vertical_spacing = </span><span class="s3">1.0 </span><span class="s1">/ num_of_lanes</span>
    <span class="s1">fig = plotly.subplots.make_subplots(</span>
        <span class="s1">num_of_rows</span><span class="s0">,</span>
        <span class="s1">num_of_cols</span><span class="s0">,</span>
        <span class="s1">print_grid=</span><span class="s0">False,</span>
        <span class="s1">horizontal_spacing=horizontal_spacing</span><span class="s0">,</span>
        <span class="s1">vertical_spacing=vertical_spacing</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s4"># layout</span>
    <span class="s1">fig[</span><span class="s2">&quot;layout&quot;</span><span class="s1">].update(</span>
        <span class="s1">dict(shapes=[])</span><span class="s0">,</span>
        <span class="s1">title=</span><span class="s2">&quot;Bullet Chart&quot;</span><span class="s0">,</span>
        <span class="s1">height=</span><span class="s3">600</span><span class="s0">,</span>
        <span class="s1">width=</span><span class="s3">1000</span><span class="s0">,</span>
        <span class="s1">showlegend=</span><span class="s0">False,</span>
        <span class="s1">barmode=</span><span class="s2">&quot;stack&quot;</span><span class="s0">,</span>
        <span class="s1">annotations=[]</span><span class="s0">,</span>
        <span class="s1">margin=dict(l=</span><span class="s3">120 </span><span class="s0">if </span><span class="s1">orientation == </span><span class="s2">&quot;h&quot; </span><span class="s0">else </span><span class="s3">80</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s4"># update layout</span>
    <span class="s1">fig[</span><span class="s2">&quot;layout&quot;</span><span class="s1">].update(layout_options)</span>

    <span class="s0">if </span><span class="s1">orientation == </span><span class="s2">&quot;h&quot;</span><span class="s1">:</span>
        <span class="s1">width_axis = </span><span class="s2">&quot;yaxis&quot;</span>
        <span class="s1">length_axis = </span><span class="s2">&quot;xaxis&quot;</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">width_axis = </span><span class="s2">&quot;xaxis&quot;</span>
        <span class="s1">length_axis = </span><span class="s2">&quot;yaxis&quot;</span>

    <span class="s0">for </span><span class="s1">key </span><span class="s0">in </span><span class="s1">fig[</span><span class="s2">&quot;layout&quot;</span><span class="s1">]:</span>
        <span class="s0">if </span><span class="s2">&quot;xaxis&quot; </span><span class="s0">in </span><span class="s1">key </span><span class="s0">or </span><span class="s2">&quot;yaxis&quot; </span><span class="s0">in </span><span class="s1">key:</span>
            <span class="s1">fig[</span><span class="s2">&quot;layout&quot;</span><span class="s1">][key][</span><span class="s2">&quot;showgrid&quot;</span><span class="s1">] = </span><span class="s0">False</span>
            <span class="s1">fig[</span><span class="s2">&quot;layout&quot;</span><span class="s1">][key][</span><span class="s2">&quot;zeroline&quot;</span><span class="s1">] = </span><span class="s0">False</span>
        <span class="s0">if </span><span class="s1">length_axis </span><span class="s0">in </span><span class="s1">key:</span>
            <span class="s1">fig[</span><span class="s2">&quot;layout&quot;</span><span class="s1">][key][</span><span class="s2">&quot;tickwidth&quot;</span><span class="s1">] = </span><span class="s3">1</span>
        <span class="s0">if </span><span class="s1">width_axis </span><span class="s0">in </span><span class="s1">key:</span>
            <span class="s1">fig[</span><span class="s2">&quot;layout&quot;</span><span class="s1">][key][</span><span class="s2">&quot;showticklabels&quot;</span><span class="s1">] = </span><span class="s0">False</span>
            <span class="s1">fig[</span><span class="s2">&quot;layout&quot;</span><span class="s1">][key][</span><span class="s2">&quot;range&quot;</span><span class="s1">] = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>

    <span class="s4"># narrow domain if 1 bar</span>
    <span class="s0">if </span><span class="s1">num_of_lanes &lt;= </span><span class="s3">1</span><span class="s1">:</span>
        <span class="s1">fig[</span><span class="s2">&quot;layout&quot;</span><span class="s1">][width_axis + </span><span class="s2">&quot;1&quot;</span><span class="s1">][</span><span class="s2">&quot;domain&quot;</span><span class="s1">] = [</span><span class="s3">0.4</span><span class="s0">, </span><span class="s3">0.6</span><span class="s1">]</span>

    <span class="s0">if not </span><span class="s1">range_colors:</span>
        <span class="s1">range_colors = [</span><span class="s2">&quot;rgb(200, 200, 200)&quot;</span><span class="s0">, </span><span class="s2">&quot;rgb(245, 245, 245)&quot;</span><span class="s1">]</span>
    <span class="s0">if not </span><span class="s1">measure_colors:</span>
        <span class="s1">measure_colors = [</span><span class="s2">&quot;rgb(31, 119, 180)&quot;</span><span class="s0">, </span><span class="s2">&quot;rgb(176, 196, 221)&quot;</span><span class="s1">]</span>

    <span class="s0">for </span><span class="s1">row </span><span class="s0">in </span><span class="s1">range(num_of_lanes):</span>
        <span class="s4"># ranges bars</span>
        <span class="s0">for </span><span class="s1">idx </span><span class="s0">in </span><span class="s1">range(len(df.iloc[row][</span><span class="s2">&quot;ranges&quot;</span><span class="s1">])):</span>
            <span class="s1">inter_colors = clrs.n_colors(</span>
                <span class="s1">range_colors[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">range_colors[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">len(df.iloc[row][</span><span class="s2">&quot;ranges&quot;</span><span class="s1">])</span><span class="s0">, </span><span class="s2">&quot;rgb&quot;</span>
            <span class="s1">)</span>
            <span class="s1">x = (</span>
                <span class="s1">[sorted(df.iloc[row][</span><span class="s2">&quot;ranges&quot;</span><span class="s1">])[-</span><span class="s3">1 </span><span class="s1">- idx]]</span>
                <span class="s0">if </span><span class="s1">orientation == </span><span class="s2">&quot;h&quot;</span>
                <span class="s0">else </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span>
            <span class="s1">)</span>
            <span class="s1">y = (</span>
                <span class="s1">[</span><span class="s3">0</span><span class="s1">]</span>
                <span class="s0">if </span><span class="s1">orientation == </span><span class="s2">&quot;h&quot;</span>
                <span class="s0">else </span><span class="s1">[sorted(df.iloc[row][</span><span class="s2">&quot;ranges&quot;</span><span class="s1">])[-</span><span class="s3">1 </span><span class="s1">- idx]]</span>
            <span class="s1">)</span>
            <span class="s1">bar = go.Bar(</span>
                <span class="s1">x=x</span><span class="s0">,</span>
                <span class="s1">y=y</span><span class="s0">,</span>
                <span class="s1">marker=dict(color=inter_colors[-</span><span class="s3">1 </span><span class="s1">- idx])</span><span class="s0">,</span>
                <span class="s1">name=</span><span class="s2">&quot;ranges&quot;</span><span class="s0">,</span>
                <span class="s1">hoverinfo=</span><span class="s2">&quot;x&quot; </span><span class="s0">if </span><span class="s1">orientation == </span><span class="s2">&quot;h&quot; </span><span class="s0">else </span><span class="s2">&quot;y&quot;</span><span class="s0">,</span>
                <span class="s1">orientation=orientation</span><span class="s0">,</span>
                <span class="s1">width=</span><span class="s3">2</span><span class="s0">,</span>
                <span class="s1">base=</span><span class="s3">0</span><span class="s0">,</span>
                <span class="s1">xaxis=</span><span class="s2">&quot;x{}&quot;</span><span class="s1">.format(row + </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">yaxis=</span><span class="s2">&quot;y{}&quot;</span><span class="s1">.format(row + </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span>
            <span class="s1">fig.add_trace(bar)</span>

        <span class="s4"># measures bars</span>
        <span class="s0">for </span><span class="s1">idx </span><span class="s0">in </span><span class="s1">range(len(df.iloc[row][</span><span class="s2">&quot;measures&quot;</span><span class="s1">])):</span>
            <span class="s1">inter_colors = clrs.n_colors(</span>
                <span class="s1">measure_colors[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">measure_colors[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">len(df.iloc[row][</span><span class="s2">&quot;measures&quot;</span><span class="s1">])</span><span class="s0">,</span>
                <span class="s2">&quot;rgb&quot;</span><span class="s0">,</span>
            <span class="s1">)</span>
            <span class="s1">x = (</span>
                <span class="s1">[sorted(df.iloc[row][</span><span class="s2">&quot;measures&quot;</span><span class="s1">])[-</span><span class="s3">1 </span><span class="s1">- idx]]</span>
                <span class="s0">if </span><span class="s1">orientation == </span><span class="s2">&quot;h&quot;</span>
                <span class="s0">else </span><span class="s1">[</span><span class="s3">0.5</span><span class="s1">]</span>
            <span class="s1">)</span>
            <span class="s1">y = (</span>
                <span class="s1">[</span><span class="s3">0.5</span><span class="s1">]</span>
                <span class="s0">if </span><span class="s1">orientation == </span><span class="s2">&quot;h&quot;</span>
                <span class="s0">else </span><span class="s1">[sorted(df.iloc[row][</span><span class="s2">&quot;measures&quot;</span><span class="s1">])[-</span><span class="s3">1 </span><span class="s1">- idx]]</span>
            <span class="s1">)</span>
            <span class="s1">bar = go.Bar(</span>
                <span class="s1">x=x</span><span class="s0">,</span>
                <span class="s1">y=y</span><span class="s0">,</span>
                <span class="s1">marker=dict(color=inter_colors[-</span><span class="s3">1 </span><span class="s1">- idx])</span><span class="s0">,</span>
                <span class="s1">name=</span><span class="s2">&quot;measures&quot;</span><span class="s0">,</span>
                <span class="s1">hoverinfo=</span><span class="s2">&quot;x&quot; </span><span class="s0">if </span><span class="s1">orientation == </span><span class="s2">&quot;h&quot; </span><span class="s0">else </span><span class="s2">&quot;y&quot;</span><span class="s0">,</span>
                <span class="s1">orientation=orientation</span><span class="s0">,</span>
                <span class="s1">width=</span><span class="s3">0.4</span><span class="s0">,</span>
                <span class="s1">base=</span><span class="s3">0</span><span class="s0">,</span>
                <span class="s1">xaxis=</span><span class="s2">&quot;x{}&quot;</span><span class="s1">.format(row + </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">yaxis=</span><span class="s2">&quot;y{}&quot;</span><span class="s1">.format(row + </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span>
            <span class="s1">fig.add_trace(bar)</span>

        <span class="s4"># markers</span>
        <span class="s1">x = df.iloc[row][</span><span class="s2">&quot;markers&quot;</span><span class="s1">] </span><span class="s0">if </span><span class="s1">orientation == </span><span class="s2">&quot;h&quot; </span><span class="s0">else </span><span class="s1">[</span><span class="s3">0.5</span><span class="s1">]</span>
        <span class="s1">y = [</span><span class="s3">0.5</span><span class="s1">] </span><span class="s0">if </span><span class="s1">orientation == </span><span class="s2">&quot;h&quot; </span><span class="s0">else </span><span class="s1">df.iloc[row][</span><span class="s2">&quot;markers&quot;</span><span class="s1">]</span>
        <span class="s1">markers = go.Scatter(</span>
            <span class="s1">x=x</span><span class="s0">,</span>
            <span class="s1">y=y</span><span class="s0">,</span>
            <span class="s1">name=</span><span class="s2">&quot;markers&quot;</span><span class="s0">,</span>
            <span class="s1">hoverinfo=</span><span class="s2">&quot;x&quot; </span><span class="s0">if </span><span class="s1">orientation == </span><span class="s2">&quot;h&quot; </span><span class="s0">else </span><span class="s2">&quot;y&quot;</span><span class="s0">,</span>
            <span class="s1">xaxis=</span><span class="s2">&quot;x{}&quot;</span><span class="s1">.format(row + </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">yaxis=</span><span class="s2">&quot;y{}&quot;</span><span class="s1">.format(row + </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">**scatter_options</span>
        <span class="s1">)</span>

        <span class="s1">fig.add_trace(markers)</span>

        <span class="s4"># titles and subtitles</span>
        <span class="s1">title = df.iloc[row][</span><span class="s2">&quot;titles&quot;</span><span class="s1">]</span>
        <span class="s0">if </span><span class="s2">&quot;subtitles&quot; </span><span class="s0">in </span><span class="s1">df:</span>
            <span class="s1">subtitle = </span><span class="s2">&quot;&lt;br&gt;{}&quot;</span><span class="s1">.format(df.iloc[row][</span><span class="s2">&quot;subtitles&quot;</span><span class="s1">])</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">subtitle = </span><span class="s2">&quot;&quot;</span>
        <span class="s1">label = </span><span class="s2">&quot;&lt;b&gt;{}&lt;/b&gt;&quot;</span><span class="s1">.format(title) + subtitle</span>
        <span class="s1">annot = utils.annotation_dict_for_label(</span>
            <span class="s1">label</span><span class="s0">,</span>
            <span class="s1">(num_of_lanes - row </span><span class="s0">if </span><span class="s1">orientation == </span><span class="s2">&quot;h&quot; </span><span class="s0">else </span><span class="s1">row + </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">num_of_lanes</span><span class="s0">,</span>
            <span class="s1">vertical_spacing </span><span class="s0">if </span><span class="s1">orientation == </span><span class="s2">&quot;h&quot; </span><span class="s0">else </span><span class="s1">horizontal_spacing</span><span class="s0">,</span>
            <span class="s2">&quot;row&quot; </span><span class="s0">if </span><span class="s1">orientation == </span><span class="s2">&quot;h&quot; </span><span class="s0">else </span><span class="s2">&quot;col&quot;</span><span class="s0">,</span>
            <span class="s0">True if </span><span class="s1">orientation == </span><span class="s2">&quot;h&quot; </span><span class="s0">else False,</span>
            <span class="s0">False,</span>
        <span class="s1">)</span>
        <span class="s1">fig[</span><span class="s2">&quot;layout&quot;</span><span class="s1">][</span><span class="s2">&quot;annotations&quot;</span><span class="s1">] += (annot</span><span class="s0">,</span><span class="s1">)</span>

    <span class="s0">return </span><span class="s1">fig</span>


<span class="s0">def </span><span class="s1">create_bullet(</span>
    <span class="s1">data</span><span class="s0">,</span>
    <span class="s1">markers=</span><span class="s0">None,</span>
    <span class="s1">measures=</span><span class="s0">None,</span>
    <span class="s1">ranges=</span><span class="s0">None,</span>
    <span class="s1">subtitles=</span><span class="s0">None,</span>
    <span class="s1">titles=</span><span class="s0">None,</span>
    <span class="s1">orientation=</span><span class="s2">&quot;h&quot;</span><span class="s0">,</span>
    <span class="s1">range_colors=(</span><span class="s2">&quot;rgb(200, 200, 200)&quot;</span><span class="s0">, </span><span class="s2">&quot;rgb(245, 245, 245)&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">measure_colors=(</span><span class="s2">&quot;rgb(31, 119, 180)&quot;</span><span class="s0">, </span><span class="s2">&quot;rgb(176, 196, 221)&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">horizontal_spacing=</span><span class="s0">None,</span>
    <span class="s1">vertical_spacing=</span><span class="s0">None,</span>
    <span class="s1">scatter_options={}</span><span class="s0">,</span>
    <span class="s1">**layout_options</span>
<span class="s1">):</span>
    <span class="s5">&quot;&quot;&quot; 
    **deprecated**, use instead the plotly.graph_objects trace 
    :class:`plotly.graph_objects.Indicator`. 
 
    :param (pd.DataFrame | list | tuple) data: either a list/tuple of 
        dictionaries or a pandas DataFrame. 
    :param (str) markers: the column name or dictionary key for the markers in 
        each subplot. 
    :param (str) measures: the column name or dictionary key for the measure 
        bars in each subplot. This bar usually represents the quantitative 
        measure of performance, usually a list of two values [a, b] and are 
        the blue bars in the foreground of each subplot by default. 
    :param (str) ranges: the column name or dictionary key for the qualitative 
        ranges of performance, usually a 3-item list [bad, okay, good]. They 
        correspond to the grey bars in the background of each chart. 
    :param (str) subtitles: the column name or dictionary key for the subtitle 
        of each subplot chart. The subplots are displayed right underneath 
        each title. 
    :param (str) titles: the column name or dictionary key for the main label 
        of each subplot chart. 
    :param (bool) orientation: if 'h', the bars are placed horizontally as 
        rows. If 'v' the bars are placed vertically in the chart. 
    :param (list) range_colors: a tuple of two colors between which all 
        the rectangles for the range are drawn. These rectangles are meant to 
        be qualitative indicators against which the marker and measure bars 
        are compared. 
        Default=('rgb(200, 200, 200)', 'rgb(245, 245, 245)') 
    :param (list) measure_colors: a tuple of two colors which is used to color 
        the thin quantitative bars in the bullet chart. 
        Default=('rgb(31, 119, 180)', 'rgb(176, 196, 221)') 
    :param (float) horizontal_spacing: see the 'horizontal_spacing' param in 
        plotly.tools.make_subplots. Ranges between 0 and 1. 
    :param (float) vertical_spacing: see the 'vertical_spacing' param in 
        plotly.tools.make_subplots. Ranges between 0 and 1. 
    :param (dict) scatter_options: describes attributes for the scatter trace 
        in each subplot such as name and marker size. Call 
        help(plotly.graph_objs.Scatter) for more information on valid params. 
    :param layout_options: describes attributes for the layout of the figure 
        such as title, height and width. Call help(plotly.graph_objs.Layout) 
        for more information on valid params. 
 
    Example 1: Use a Dictionary 
     
    &gt;&gt;&gt; import plotly.figure_factory as ff 
 
    &gt;&gt;&gt; data = [ 
    ...   {&quot;label&quot;: &quot;revenue&quot;, &quot;sublabel&quot;: &quot;us$, in thousands&quot;, 
    ...    &quot;range&quot;: [150, 225, 300], &quot;performance&quot;: [220,270], &quot;point&quot;: [250]}, 
    ...   {&quot;label&quot;: &quot;Profit&quot;, &quot;sublabel&quot;: &quot;%&quot;, &quot;range&quot;: [20, 25, 30], 
    ...    &quot;performance&quot;: [21, 23], &quot;point&quot;: [26]}, 
    ...   {&quot;label&quot;: &quot;Order Size&quot;, &quot;sublabel&quot;:&quot;US$, average&quot;,&quot;range&quot;: [350, 500, 600], 
    ...    &quot;performance&quot;: [100,320],&quot;point&quot;: [550]}, 
    ...   {&quot;label&quot;: &quot;New Customers&quot;, &quot;sublabel&quot;: &quot;count&quot;, &quot;range&quot;: [1400, 2000, 2500], 
    ...    &quot;performance&quot;: [1000, 1650],&quot;point&quot;: [2100]}, 
    ...   {&quot;label&quot;: &quot;Satisfaction&quot;, &quot;sublabel&quot;: &quot;out of 5&quot;,&quot;range&quot;: [3.5, 4.25, 5], 
    ...    &quot;performance&quot;: [3.2, 4.7], &quot;point&quot;: [4.4]} 
    ... ] 
 
    &gt;&gt;&gt; fig = ff.create_bullet( 
    ...     data, titles='label', subtitles='sublabel', markers='point', 
    ...     measures='performance', ranges='range', orientation='h', 
    ...     title='my simple bullet chart' 
    ... ) 
    &gt;&gt;&gt; fig.show() 
 
    Example 2: Use a DataFrame with Custom Colors 
 
    &gt;&gt;&gt; import plotly.figure_factory as ff 
    &gt;&gt;&gt; import pandas as pd 
    &gt;&gt;&gt; data = pd.read_json('https://cdn.rawgit.com/plotly/datasets/master/BulletData.json') 
 
    &gt;&gt;&gt; fig = ff.create_bullet( 
    ...     data, titles='title', markers='markers', measures='measures', 
    ...     orientation='v', measure_colors=['rgb(14, 52, 75)', 'rgb(31, 141, 127)'], 
    ...     scatter_options={'marker': {'symbol': 'circle'}}, width=700) 
    &gt;&gt;&gt; fig.show() 
    &quot;&quot;&quot;</span>
    <span class="s4"># validate df</span>
    <span class="s0">if not </span><span class="s1">pd:</span>
        <span class="s0">raise </span><span class="s1">ImportError(</span><span class="s2">&quot;'pandas' must be installed for this figure factory.&quot;</span><span class="s1">)</span>

    <span class="s0">if </span><span class="s1">utils.is_sequence(data):</span>
        <span class="s0">if not </span><span class="s1">all(isinstance(item</span><span class="s0">, </span><span class="s1">dict) </span><span class="s0">for </span><span class="s1">item </span><span class="s0">in </span><span class="s1">data):</span>
            <span class="s0">raise </span><span class="s1">exceptions.PlotlyError(</span>
                <span class="s2">&quot;Every entry of the data argument list, tuple, etc must &quot;</span>
                <span class="s2">&quot;be a dictionary.&quot;</span>
            <span class="s1">)</span>

    <span class="s0">elif not </span><span class="s1">isinstance(data</span><span class="s0">, </span><span class="s1">pd.DataFrame):</span>
        <span class="s0">raise </span><span class="s1">exceptions.PlotlyError(</span>
            <span class="s2">&quot;You must input a pandas DataFrame, or a list of dictionaries.&quot;</span>
        <span class="s1">)</span>

    <span class="s4"># make DataFrame from data with correct column headers</span>
    <span class="s1">col_names = [</span><span class="s2">&quot;titles&quot;</span><span class="s0">, </span><span class="s2">&quot;subtitle&quot;</span><span class="s0">, </span><span class="s2">&quot;markers&quot;</span><span class="s0">, </span><span class="s2">&quot;measures&quot;</span><span class="s0">, </span><span class="s2">&quot;ranges&quot;</span><span class="s1">]</span>
    <span class="s0">if </span><span class="s1">utils.is_sequence(data):</span>
        <span class="s1">df = pd.DataFrame(</span>
            <span class="s1">[</span>
                <span class="s1">[d[titles] </span><span class="s0">for </span><span class="s1">d </span><span class="s0">in </span><span class="s1">data] </span><span class="s0">if </span><span class="s1">titles </span><span class="s0">else </span><span class="s1">[</span><span class="s2">&quot;&quot;</span><span class="s1">] * len(data)</span><span class="s0">,</span>
                <span class="s1">[d[subtitles] </span><span class="s0">for </span><span class="s1">d </span><span class="s0">in </span><span class="s1">data] </span><span class="s0">if </span><span class="s1">subtitles </span><span class="s0">else </span><span class="s1">[</span><span class="s2">&quot;&quot;</span><span class="s1">] * len(data)</span><span class="s0">,</span>
                <span class="s1">[d[markers] </span><span class="s0">for </span><span class="s1">d </span><span class="s0">in </span><span class="s1">data] </span><span class="s0">if </span><span class="s1">markers </span><span class="s0">else </span><span class="s1">[[]] * len(data)</span><span class="s0">,</span>
                <span class="s1">[d[measures] </span><span class="s0">for </span><span class="s1">d </span><span class="s0">in </span><span class="s1">data] </span><span class="s0">if </span><span class="s1">measures </span><span class="s0">else </span><span class="s1">[[]] * len(data)</span><span class="s0">,</span>
                <span class="s1">[d[ranges] </span><span class="s0">for </span><span class="s1">d </span><span class="s0">in </span><span class="s1">data] </span><span class="s0">if </span><span class="s1">ranges </span><span class="s0">else </span><span class="s1">[[]] * len(data)</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">index=col_names</span><span class="s0">,</span>
        <span class="s1">)</span>
    <span class="s0">elif </span><span class="s1">isinstance(data</span><span class="s0">, </span><span class="s1">pd.DataFrame):</span>
        <span class="s1">df = pd.DataFrame(</span>
            <span class="s1">[</span>
                <span class="s1">data[titles].tolist() </span><span class="s0">if </span><span class="s1">titles </span><span class="s0">else </span><span class="s1">[</span><span class="s2">&quot;&quot;</span><span class="s1">] * len(data)</span><span class="s0">,</span>
                <span class="s1">data[subtitles].tolist() </span><span class="s0">if </span><span class="s1">subtitles </span><span class="s0">else </span><span class="s1">[</span><span class="s2">&quot;&quot;</span><span class="s1">] * len(data)</span><span class="s0">,</span>
                <span class="s1">data[markers].tolist() </span><span class="s0">if </span><span class="s1">markers </span><span class="s0">else </span><span class="s1">[[]] * len(data)</span><span class="s0">,</span>
                <span class="s1">data[measures].tolist() </span><span class="s0">if </span><span class="s1">measures </span><span class="s0">else </span><span class="s1">[[]] * len(data)</span><span class="s0">,</span>
                <span class="s1">data[ranges].tolist() </span><span class="s0">if </span><span class="s1">ranges </span><span class="s0">else </span><span class="s1">[[]] * len(data)</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">index=col_names</span><span class="s0">,</span>
        <span class="s1">)</span>
    <span class="s1">df = pd.DataFrame.transpose(df)</span>

    <span class="s4"># make sure ranges, measures, 'markers' are not NAN or NONE</span>
    <span class="s0">for </span><span class="s1">needed_key </span><span class="s0">in </span><span class="s1">[</span><span class="s2">&quot;ranges&quot;</span><span class="s0">, </span><span class="s2">&quot;measures&quot;</span><span class="s0">, </span><span class="s2">&quot;markers&quot;</span><span class="s1">]:</span>
        <span class="s0">for </span><span class="s1">idx</span><span class="s0">, </span><span class="s1">r </span><span class="s0">in </span><span class="s1">enumerate(df[needed_key]):</span>
            <span class="s0">try</span><span class="s1">:</span>
                <span class="s1">r_is_nan = math.isnan(r)</span>
                <span class="s0">if </span><span class="s1">r_is_nan </span><span class="s0">or </span><span class="s1">r </span><span class="s0">is None</span><span class="s1">:</span>
                    <span class="s1">df[needed_key][idx] = []</span>
            <span class="s0">except </span><span class="s1">TypeError:</span>
                <span class="s0">pass</span>

    <span class="s4"># validate custom colors</span>
    <span class="s0">for </span><span class="s1">colors_list </span><span class="s0">in </span><span class="s1">[range_colors</span><span class="s0">, </span><span class="s1">measure_colors]:</span>
        <span class="s0">if </span><span class="s1">colors_list:</span>
            <span class="s0">if </span><span class="s1">len(colors_list) != </span><span class="s3">2</span><span class="s1">:</span>
                <span class="s0">raise </span><span class="s1">exceptions.PlotlyError(</span>
                    <span class="s2">&quot;Both 'range_colors' or 'measure_colors' must be a list &quot;</span>
                    <span class="s2">&quot;of two valid colors.&quot;</span>
                <span class="s1">)</span>
            <span class="s1">clrs.validate_colors(colors_list)</span>
            <span class="s1">colors_list = clrs.convert_colors_to_same_type(colors_list</span><span class="s0">, </span><span class="s2">&quot;rgb&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">]</span>

    <span class="s4"># default scatter options</span>
    <span class="s1">default_scatter = {</span>
        <span class="s2">&quot;marker&quot;</span><span class="s1">: {</span><span class="s2">&quot;size&quot;</span><span class="s1">: </span><span class="s3">12</span><span class="s0">, </span><span class="s2">&quot;symbol&quot;</span><span class="s1">: </span><span class="s2">&quot;diamond-tall&quot;</span><span class="s0">, </span><span class="s2">&quot;color&quot;</span><span class="s1">: </span><span class="s2">&quot;rgb(0, 0, 0)&quot;</span><span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s0">if </span><span class="s1">scatter_options == {}:</span>
        <span class="s1">scatter_options.update(default_scatter)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s4"># add default options to scatter_options if they are not present</span>
        <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">default_scatter[</span><span class="s2">&quot;marker&quot;</span><span class="s1">]:</span>
            <span class="s0">if </span><span class="s1">k </span><span class="s0">not in </span><span class="s1">scatter_options[</span><span class="s2">&quot;marker&quot;</span><span class="s1">]:</span>
                <span class="s1">scatter_options[</span><span class="s2">&quot;marker&quot;</span><span class="s1">][k] = default_scatter[</span><span class="s2">&quot;marker&quot;</span><span class="s1">][k]</span>

    <span class="s1">fig = _bullet(</span>
        <span class="s1">df</span><span class="s0">,</span>
        <span class="s1">markers</span><span class="s0">,</span>
        <span class="s1">measures</span><span class="s0">,</span>
        <span class="s1">ranges</span><span class="s0">,</span>
        <span class="s1">subtitles</span><span class="s0">,</span>
        <span class="s1">titles</span><span class="s0">,</span>
        <span class="s1">orientation</span><span class="s0">,</span>
        <span class="s1">range_colors</span><span class="s0">,</span>
        <span class="s1">measure_colors</span><span class="s0">,</span>
        <span class="s1">horizontal_spacing</span><span class="s0">,</span>
        <span class="s1">vertical_spacing</span><span class="s0">,</span>
        <span class="s1">scatter_options</span><span class="s0">,</span>
        <span class="s1">layout_options</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s0">return </span><span class="s1">fig</span>
</pre>
</body>
</html>