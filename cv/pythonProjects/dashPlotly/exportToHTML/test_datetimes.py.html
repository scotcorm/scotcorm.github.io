<html>
<head>
<title>test_datetimes.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_datetimes.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">datetime </span><span class="s0">as </span><span class="s1">dt</span>
<span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">datetime</span>

<span class="s0">import </span><span class="s1">dateutil</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">DataFrame</span><span class="s0">,</span>
    <span class="s1">DatetimeIndex</span><span class="s0">,</span>
    <span class="s1">Index</span><span class="s0">,</span>
    <span class="s1">MultiIndex</span><span class="s0">,</span>
    <span class="s1">Series</span><span class="s0">,</span>
    <span class="s1">Timestamp</span><span class="s0">,</span>
    <span class="s1">concat</span><span class="s0">,</span>
    <span class="s1">date_range</span><span class="s0">,</span>
    <span class="s1">to_timedelta</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">pandas._testing </span><span class="s0">as </span><span class="s1">tm</span>


<span class="s0">class </span><span class="s1">TestDatetimeConcat:</span>
    <span class="s0">def </span><span class="s1">test_concat_datetime64_block(self):</span>
        <span class="s0">from </span><span class="s1">pandas.core.indexes.datetimes </span><span class="s0">import </span><span class="s1">date_range</span>

        <span class="s1">rng = date_range(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">10</span><span class="s1">)</span>

        <span class="s1">df = DataFrame({</span><span class="s2">&quot;time&quot;</span><span class="s1">: rng})</span>

        <span class="s1">result = concat([df</span><span class="s0">, </span><span class="s1">df])</span>
        <span class="s0">assert </span><span class="s1">(result.iloc[:</span><span class="s3">10</span><span class="s1">][</span><span class="s2">&quot;time&quot;</span><span class="s1">] == rng).all()</span>
        <span class="s0">assert </span><span class="s1">(result.iloc[</span><span class="s3">10</span><span class="s1">:][</span><span class="s2">&quot;time&quot;</span><span class="s1">] == rng).all()</span>

    <span class="s0">def </span><span class="s1">test_concat_datetime_datetime64_frame(self):</span>
        <span class="s4"># GH#2624</span>
        <span class="s1">rows = []</span>
        <span class="s1">rows.append([datetime(</span><span class="s3">2010</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">rows.append([datetime(</span><span class="s3">2010</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s2">&quot;hi&quot;</span><span class="s1">])</span>

        <span class="s1">df2_obj = DataFrame.from_records(rows</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s2">&quot;date&quot;</span><span class="s0">, </span><span class="s2">&quot;test&quot;</span><span class="s1">])</span>

        <span class="s1">ind = date_range(start=</span><span class="s2">&quot;2000/1/1&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">10</span><span class="s1">)</span>
        <span class="s1">df1 = DataFrame({</span><span class="s2">&quot;date&quot;</span><span class="s1">: ind</span><span class="s0">, </span><span class="s2">&quot;test&quot;</span><span class="s1">: range(</span><span class="s3">10</span><span class="s1">)})</span>

        <span class="s4"># it works!</span>
        <span class="s1">concat([df1</span><span class="s0">, </span><span class="s1">df2_obj])</span>

    <span class="s0">def </span><span class="s1">test_concat_datetime_timezone(self):</span>
        <span class="s4"># GH 18523</span>
        <span class="s1">idx1 = date_range(</span><span class="s2">&quot;2011-01-01&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;Europe/Paris&quot;</span><span class="s1">)</span>
        <span class="s1">idx2 = date_range(start=idx1[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">end=idx1[-</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;H&quot;</span><span class="s1">)</span>
        <span class="s1">df1 = DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=idx1)</span>
        <span class="s1">df2 = DataFrame({</span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=idx2)</span>
        <span class="s1">result = concat([df1</span><span class="s0">, </span><span class="s1">df2]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span>

        <span class="s1">exp_idx = (</span>
            <span class="s1">DatetimeIndex(</span>
                <span class="s1">[</span>
                    <span class="s2">&quot;2011-01-01 00:00:00+01:00&quot;</span><span class="s0">,</span>
                    <span class="s2">&quot;2011-01-01 01:00:00+01:00&quot;</span><span class="s0">,</span>
                    <span class="s2">&quot;2011-01-01 02:00:00+01:00&quot;</span><span class="s0">,</span>
                <span class="s1">]</span><span class="s0">,</span>
                <span class="s1">freq=</span><span class="s2">&quot;H&quot;</span><span class="s0">,</span>
            <span class="s1">)</span>
            <span class="s1">.tz_convert(</span><span class="s2">&quot;UTC&quot;</span><span class="s1">)</span>
            <span class="s1">.tz_convert(</span><span class="s2">&quot;Europe/Paris&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>

        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">index=exp_idx</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>

        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">idx3 = date_range(</span><span class="s2">&quot;2011-01-01&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;Asia/Tokyo&quot;</span><span class="s1">)</span>
        <span class="s1">df3 = DataFrame({</span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=idx3)</span>
        <span class="s1">result = concat([df1</span><span class="s0">, </span><span class="s1">df3]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span>

        <span class="s1">exp_idx = DatetimeIndex(</span>
            <span class="s1">[</span>
                <span class="s2">&quot;2010-12-31 15:00:00+00:00&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;2010-12-31 16:00:00+00:00&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;2010-12-31 17:00:00+00:00&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;2010-12-31 23:00:00+00:00&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;2011-01-01 00:00:00+00:00&quot;</span><span class="s0">,</span>
                <span class="s2">&quot;2011-01-01 01:00:00+00:00&quot;</span><span class="s0">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>

        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[</span>
                <span class="s1">[np.nan</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[np.nan</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[np.nan</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s3">3</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">index=exp_idx</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>

        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s4"># GH 13783: Concat after resample</span>
        <span class="s1">result = concat([df1.resample(</span><span class="s2">&quot;H&quot;</span><span class="s1">).mean()</span><span class="s0">, </span><span class="s1">df2.resample(</span><span class="s2">&quot;H&quot;</span><span class="s1">).mean()]</span><span class="s0">, </span><span class="s1">sort=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">] + [np.nan] * </span><span class="s3">3</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [np.nan] * </span><span class="s3">3 </span><span class="s1">+ [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]}</span><span class="s0">,</span>
            <span class="s1">index=idx1.append(idx1)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_concat_datetimeindex_freq(self):</span>
        <span class="s4"># GH 3232</span>
        <span class="s4"># Monotonic index result</span>
        <span class="s1">dr = date_range(</span><span class="s2">&quot;01-Jan-2013&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">100</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;50L&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;UTC&quot;</span><span class="s1">)</span>
        <span class="s1">data = list(range(</span><span class="s3">100</span><span class="s1">))</span>
        <span class="s1">expected = DataFrame(data</span><span class="s0">, </span><span class="s1">index=dr)</span>
        <span class="s1">result = concat([expected[:</span><span class="s3">50</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected[</span><span class="s3">50</span><span class="s1">:]])</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s4"># Non-monotonic index result</span>
        <span class="s1">result = concat([expected[</span><span class="s3">50</span><span class="s1">:]</span><span class="s0">, </span><span class="s1">expected[:</span><span class="s3">50</span><span class="s1">]])</span>
        <span class="s1">expected = DataFrame(data[</span><span class="s3">50</span><span class="s1">:] + data[:</span><span class="s3">50</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=dr[</span><span class="s3">50</span><span class="s1">:].append(dr[:</span><span class="s3">50</span><span class="s1">]))</span>
        <span class="s1">expected.index._data.freq = </span><span class="s0">None</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_concat_multiindex_datetime_object_index(self):</span>
        <span class="s4"># https://github.com/pandas-dev/pandas/issues/11058</span>
        <span class="s1">idx = Index(</span>
            <span class="s1">[dt.date(</span><span class="s3">2013</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dt.date(</span><span class="s3">2014</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dt.date(</span><span class="s3">2015</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">dtype=</span><span class="s2">&quot;object&quot;</span><span class="s0">,</span>
        <span class="s1">)</span>

        <span class="s1">s = Series(</span>
            <span class="s1">[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">index=MultiIndex.from_arrays(</span>
                <span class="s1">[</span>
                    <span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">idx[:-</span><span class="s3">1</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">]</span><span class="s0">,</span>
                <span class="s1">names=[</span><span class="s2">&quot;first&quot;</span><span class="s0">, </span><span class="s2">&quot;second&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">s2 = Series(</span>
            <span class="s1">[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">index=MultiIndex.from_arrays(</span>
                <span class="s1">[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">idx[::</span><span class="s3">2</span><span class="s1">]]</span><span class="s0">,</span>
                <span class="s1">names=[</span><span class="s2">&quot;first&quot;</span><span class="s0">, </span><span class="s2">&quot;second&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">mi = MultiIndex.from_arrays(</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">idx]</span><span class="s0">,</span>
            <span class="s1">names=[</span><span class="s2">&quot;first&quot;</span><span class="s0">, </span><span class="s2">&quot;second&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">mi.levels[</span><span class="s3">1</span><span class="s1">].dtype == object</span>

        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">[np.nan</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">index=mi</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">result = concat([s</span><span class="s0">, </span><span class="s1">s2]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_concat_NaT_series(self):</span>
        <span class="s4"># GH 11693</span>
        <span class="s4"># test for merging NaT series with datetime series.</span>
        <span class="s1">x = Series(</span>
            <span class="s1">date_range(</span><span class="s2">&quot;20151124 08:00&quot;</span><span class="s0">, </span><span class="s2">&quot;20151124 09:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;1h&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>
        <span class="s1">y = Series(pd.NaT</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;datetime64[ns, US/Eastern]&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Series([x[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">pd.NaT</span><span class="s0">, </span><span class="s1">pd.NaT])</span>

        <span class="s1">result = concat([x</span><span class="s0">, </span><span class="s1">y]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s4"># all NaT with tz</span>
        <span class="s1">expected = Series(pd.NaT</span><span class="s0">, </span><span class="s1">index=range(</span><span class="s3">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;datetime64[ns, US/Eastern]&quot;</span><span class="s1">)</span>
        <span class="s1">result = concat([y</span><span class="s0">, </span><span class="s1">y]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s4"># without tz</span>
        <span class="s1">x = Series(date_range(</span><span class="s2">&quot;20151124 08:00&quot;</span><span class="s0">, </span><span class="s2">&quot;20151124 09:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;1h&quot;</span><span class="s1">))</span>
        <span class="s1">y = Series(date_range(</span><span class="s2">&quot;20151124 10:00&quot;</span><span class="s0">, </span><span class="s2">&quot;20151124 11:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;1h&quot;</span><span class="s1">))</span>
        <span class="s1">y[:] = pd.NaT</span>
        <span class="s1">expected = Series([x[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">pd.NaT</span><span class="s0">, </span><span class="s1">pd.NaT])</span>
        <span class="s1">result = concat([x</span><span class="s0">, </span><span class="s1">y]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s4"># all NaT without tz</span>
        <span class="s1">x[:] = pd.NaT</span>
        <span class="s1">expected = Series(pd.NaT</span><span class="s0">, </span><span class="s1">index=range(</span><span class="s3">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="s1">)</span>
        <span class="s1">result = concat([x</span><span class="s0">, </span><span class="s1">y]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;tz&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s2">&quot;UTC&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_concat_NaT_dataframes(self</span><span class="s0">, </span><span class="s1">tz):</span>
        <span class="s4"># GH 12396</span>

        <span class="s1">first = DataFrame([[pd.NaT]</span><span class="s0">, </span><span class="s1">[pd.NaT]])</span>
        <span class="s1">first = first.apply(</span><span class="s0">lambda </span><span class="s1">x: x.dt.tz_localize(tz))</span>
        <span class="s1">second = DataFrame(</span>
            <span class="s1">[[Timestamp(</span><span class="s2">&quot;2015/01/01&quot;</span><span class="s0">, </span><span class="s1">tz=tz)]</span><span class="s0">, </span><span class="s1">[Timestamp(</span><span class="s2">&quot;2016/01/01&quot;</span><span class="s0">, </span><span class="s1">tz=tz)]]</span><span class="s0">,</span>
            <span class="s1">index=[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[</span>
                <span class="s1">pd.NaT</span><span class="s0">,</span>
                <span class="s1">pd.NaT</span><span class="s0">,</span>
                <span class="s1">Timestamp(</span><span class="s2">&quot;2015/01/01&quot;</span><span class="s0">, </span><span class="s1">tz=tz)</span><span class="s0">,</span>
                <span class="s1">Timestamp(</span><span class="s2">&quot;2016/01/01&quot;</span><span class="s0">, </span><span class="s1">tz=tz)</span><span class="s0">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>

        <span class="s1">result = concat([first</span><span class="s0">, </span><span class="s1">second]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;tz1&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s2">&quot;UTC&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;tz2&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s2">&quot;UTC&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;s&quot;</span><span class="s0">, </span><span class="s1">[pd.NaT</span><span class="s0">, </span><span class="s1">Timestamp(</span><span class="s2">&quot;20150101&quot;</span><span class="s1">)])</span>
    <span class="s0">def </span><span class="s1">test_concat_NaT_dataframes_all_NaT_axis_0(self</span><span class="s0">, </span><span class="s1">tz1</span><span class="s0">, </span><span class="s1">tz2</span><span class="s0">, </span><span class="s1">s):</span>
        <span class="s4"># GH 12396</span>

        <span class="s4"># tz-naive</span>
        <span class="s1">first = DataFrame([[pd.NaT]</span><span class="s0">, </span><span class="s1">[pd.NaT]]).apply(</span><span class="s0">lambda </span><span class="s1">x: x.dt.tz_localize(tz1))</span>
        <span class="s1">second = DataFrame([s]).apply(</span><span class="s0">lambda </span><span class="s1">x: x.dt.tz_localize(tz2))</span>

        <span class="s1">result = concat([first</span><span class="s0">, </span><span class="s1">second]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">expected = DataFrame(Series([pd.NaT</span><span class="s0">, </span><span class="s1">pd.NaT</span><span class="s0">, </span><span class="s1">s]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]))</span>
        <span class="s1">expected = expected.apply(</span><span class="s0">lambda </span><span class="s1">x: x.dt.tz_localize(tz2))</span>
        <span class="s0">if </span><span class="s1">tz1 != tz2:</span>
            <span class="s1">expected = expected.astype(object)</span>

        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;tz1&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s2">&quot;UTC&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;tz2&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s2">&quot;UTC&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_concat_NaT_dataframes_all_NaT_axis_1(self</span><span class="s0">, </span><span class="s1">tz1</span><span class="s0">, </span><span class="s1">tz2):</span>
        <span class="s4"># GH 12396</span>

        <span class="s1">first = DataFrame(Series([pd.NaT</span><span class="s0">, </span><span class="s1">pd.NaT]).dt.tz_localize(tz1))</span>
        <span class="s1">second = DataFrame(Series([pd.NaT]).dt.tz_localize(tz2)</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s3">0</span><span class="s1">: Series([pd.NaT</span><span class="s0">, </span><span class="s1">pd.NaT]).dt.tz_localize(tz1)</span><span class="s0">,</span>
                <span class="s3">1</span><span class="s1">: Series([pd.NaT</span><span class="s0">, </span><span class="s1">pd.NaT]).dt.tz_localize(tz2)</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
        <span class="s1">result = concat([first</span><span class="s0">, </span><span class="s1">second]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;tz1&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s2">&quot;UTC&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;tz2&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s2">&quot;UTC&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_concat_NaT_series_dataframe_all_NaT(self</span><span class="s0">, </span><span class="s1">tz1</span><span class="s0">, </span><span class="s1">tz2):</span>
        <span class="s4"># GH 12396</span>

        <span class="s4"># tz-naive</span>
        <span class="s1">first = Series([pd.NaT</span><span class="s0">, </span><span class="s1">pd.NaT]).dt.tz_localize(tz1)</span>
        <span class="s1">second = DataFrame(</span>
            <span class="s1">[</span>
                <span class="s1">[Timestamp(</span><span class="s2">&quot;2015/01/01&quot;</span><span class="s0">, </span><span class="s1">tz=tz2)]</span><span class="s0">,</span>
                <span class="s1">[Timestamp(</span><span class="s2">&quot;2016/01/01&quot;</span><span class="s0">, </span><span class="s1">tz=tz2)]</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">index=[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>

        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[</span>
                <span class="s1">pd.NaT</span><span class="s0">,</span>
                <span class="s1">pd.NaT</span><span class="s0">,</span>
                <span class="s1">Timestamp(</span><span class="s2">&quot;2015/01/01&quot;</span><span class="s0">, </span><span class="s1">tz=tz2)</span><span class="s0">,</span>
                <span class="s1">Timestamp(</span><span class="s2">&quot;2016/01/01&quot;</span><span class="s0">, </span><span class="s1">tz=tz2)</span><span class="s0">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s0">if </span><span class="s1">tz1 != tz2:</span>
            <span class="s1">expected = expected.astype(object)</span>

        <span class="s1">result = concat([first</span><span class="s0">, </span><span class="s1">second])</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">class </span><span class="s1">TestTimezoneConcat:</span>
    <span class="s0">def </span><span class="s1">test_concat_tz_series(self):</span>
        <span class="s4"># gh-11755: tz and no tz</span>
        <span class="s1">x = Series(date_range(</span><span class="s2">&quot;20151124 08:00&quot;</span><span class="s0">, </span><span class="s2">&quot;20151124 09:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;1h&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;UTC&quot;</span><span class="s1">))</span>
        <span class="s1">y = Series(date_range(</span><span class="s2">&quot;2012-01-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2012-01-02&quot;</span><span class="s1">))</span>
        <span class="s1">expected = Series([x[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[</span><span class="s3">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;object&quot;</span><span class="s1">)</span>
        <span class="s1">result = concat([x</span><span class="s0">, </span><span class="s1">y]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s4"># gh-11887: concat tz and object</span>
        <span class="s1">x = Series(date_range(</span><span class="s2">&quot;20151124 08:00&quot;</span><span class="s0">, </span><span class="s2">&quot;20151124 09:00&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;1h&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;UTC&quot;</span><span class="s1">))</span>
        <span class="s1">y = Series([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">])</span>
        <span class="s1">expected = Series([x[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[</span><span class="s3">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;object&quot;</span><span class="s1">)</span>
        <span class="s1">result = concat([x</span><span class="s0">, </span><span class="s1">y]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s4"># see gh-12217 and gh-12306</span>
        <span class="s4"># Concatenating two UTC times</span>
        <span class="s1">first = DataFrame([[datetime(</span><span class="s3">2016</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)]])</span>
        <span class="s1">first[</span><span class="s3">0</span><span class="s1">] = first[</span><span class="s3">0</span><span class="s1">].dt.tz_localize(</span><span class="s2">&quot;UTC&quot;</span><span class="s1">)</span>

        <span class="s1">second = DataFrame([[datetime(</span><span class="s3">2016</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)]])</span>
        <span class="s1">second[</span><span class="s3">0</span><span class="s1">] = second[</span><span class="s3">0</span><span class="s1">].dt.tz_localize(</span><span class="s2">&quot;UTC&quot;</span><span class="s1">)</span>

        <span class="s1">result = concat([first</span><span class="s0">, </span><span class="s1">second])</span>
        <span class="s0">assert </span><span class="s1">result[</span><span class="s3">0</span><span class="s1">].dtype == </span><span class="s2">&quot;datetime64[ns, UTC]&quot;</span>

        <span class="s4"># Concatenating two London times</span>
        <span class="s1">first = DataFrame([[datetime(</span><span class="s3">2016</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)]])</span>
        <span class="s1">first[</span><span class="s3">0</span><span class="s1">] = first[</span><span class="s3">0</span><span class="s1">].dt.tz_localize(</span><span class="s2">&quot;Europe/London&quot;</span><span class="s1">)</span>

        <span class="s1">second = DataFrame([[datetime(</span><span class="s3">2016</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)]])</span>
        <span class="s1">second[</span><span class="s3">0</span><span class="s1">] = second[</span><span class="s3">0</span><span class="s1">].dt.tz_localize(</span><span class="s2">&quot;Europe/London&quot;</span><span class="s1">)</span>

        <span class="s1">result = concat([first</span><span class="s0">, </span><span class="s1">second])</span>
        <span class="s0">assert </span><span class="s1">result[</span><span class="s3">0</span><span class="s1">].dtype == </span><span class="s2">&quot;datetime64[ns, Europe/London]&quot;</span>

        <span class="s4"># Concatenating 2+1 London times</span>
        <span class="s1">first = DataFrame([[datetime(</span><span class="s3">2016</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[datetime(</span><span class="s3">2016</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)]])</span>
        <span class="s1">first[</span><span class="s3">0</span><span class="s1">] = first[</span><span class="s3">0</span><span class="s1">].dt.tz_localize(</span><span class="s2">&quot;Europe/London&quot;</span><span class="s1">)</span>

        <span class="s1">second = DataFrame([[datetime(</span><span class="s3">2016</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)]])</span>
        <span class="s1">second[</span><span class="s3">0</span><span class="s1">] = second[</span><span class="s3">0</span><span class="s1">].dt.tz_localize(</span><span class="s2">&quot;Europe/London&quot;</span><span class="s1">)</span>

        <span class="s1">result = concat([first</span><span class="s0">, </span><span class="s1">second])</span>
        <span class="s0">assert </span><span class="s1">result[</span><span class="s3">0</span><span class="s1">].dtype == </span><span class="s2">&quot;datetime64[ns, Europe/London]&quot;</span>

        <span class="s4"># Concat'ing 1+2 London times</span>
        <span class="s1">first = DataFrame([[datetime(</span><span class="s3">2016</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)]])</span>
        <span class="s1">first[</span><span class="s3">0</span><span class="s1">] = first[</span><span class="s3">0</span><span class="s1">].dt.tz_localize(</span><span class="s2">&quot;Europe/London&quot;</span><span class="s1">)</span>

        <span class="s1">second = DataFrame([[datetime(</span><span class="s3">2016</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[datetime(</span><span class="s3">2016</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)]])</span>
        <span class="s1">second[</span><span class="s3">0</span><span class="s1">] = second[</span><span class="s3">0</span><span class="s1">].dt.tz_localize(</span><span class="s2">&quot;Europe/London&quot;</span><span class="s1">)</span>

        <span class="s1">result = concat([first</span><span class="s0">, </span><span class="s1">second])</span>
        <span class="s0">assert </span><span class="s1">result[</span><span class="s3">0</span><span class="s1">].dtype == </span><span class="s2">&quot;datetime64[ns, Europe/London]&quot;</span>

    <span class="s0">def </span><span class="s1">test_concat_tz_series_tzlocal(self):</span>
        <span class="s4"># see gh-13583</span>
        <span class="s1">x = [</span>
            <span class="s1">Timestamp(</span><span class="s2">&quot;2011-01-01&quot;</span><span class="s0">, </span><span class="s1">tz=dateutil.tz.tzlocal())</span><span class="s0">,</span>
            <span class="s1">Timestamp(</span><span class="s2">&quot;2011-02-01&quot;</span><span class="s0">, </span><span class="s1">tz=dateutil.tz.tzlocal())</span><span class="s0">,</span>
        <span class="s1">]</span>
        <span class="s1">y = [</span>
            <span class="s1">Timestamp(</span><span class="s2">&quot;2012-01-01&quot;</span><span class="s0">, </span><span class="s1">tz=dateutil.tz.tzlocal())</span><span class="s0">,</span>
            <span class="s1">Timestamp(</span><span class="s2">&quot;2012-02-01&quot;</span><span class="s0">, </span><span class="s1">tz=dateutil.tz.tzlocal())</span><span class="s0">,</span>
        <span class="s1">]</span>

        <span class="s1">result = concat([Series(x)</span><span class="s0">, </span><span class="s1">Series(y)]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">Series(x + y))</span>
        <span class="s0">assert </span><span class="s1">result.dtype == </span><span class="s2">&quot;datetime64[ns, tzlocal()]&quot;</span>

    <span class="s0">def </span><span class="s1">test_concat_tz_series_with_datetimelike(self):</span>
        <span class="s4"># see gh-12620: tz and timedelta</span>
        <span class="s1">x = [</span>
            <span class="s1">Timestamp(</span><span class="s2">&quot;2011-01-01&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">Timestamp(</span><span class="s2">&quot;2011-02-01&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span>
        <span class="s1">y = [pd.Timedelta(</span><span class="s2">&quot;1 day&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">pd.Timedelta(</span><span class="s2">&quot;2 day&quot;</span><span class="s1">)]</span>
        <span class="s1">result = concat([Series(x)</span><span class="s0">, </span><span class="s1">Series(y)]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">Series(x + y</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;object&quot;</span><span class="s1">))</span>

        <span class="s4"># tz and period</span>
        <span class="s1">y = [pd.Period(</span><span class="s2">&quot;2011-03&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">pd.Period(</span><span class="s2">&quot;2011-04&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)]</span>
        <span class="s1">result = concat([Series(x)</span><span class="s0">, </span><span class="s1">Series(y)]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">Series(x + y</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;object&quot;</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_concat_tz_frame(self):</span>
        <span class="s1">df2 = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;A&quot;</span><span class="s1">: Timestamp(</span><span class="s2">&quot;20130102&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;B&quot;</span><span class="s1">: Timestamp(</span><span class="s2">&quot;20130603&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;CET&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">}</span><span class="s0">,</span>
            <span class="s1">index=range(</span><span class="s3">5</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>

        <span class="s4"># concat</span>
        <span class="s1">df3 = concat([df2.A.to_frame()</span><span class="s0">, </span><span class="s1">df2.B.to_frame()]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(df2</span><span class="s0">, </span><span class="s1">df3)</span>

    <span class="s0">def </span><span class="s1">test_concat_multiple_tzs(self):</span>
        <span class="s4"># GH#12467</span>
        <span class="s4"># combining datetime tz-aware and naive DataFrames</span>
        <span class="s1">ts1 = Timestamp(</span><span class="s2">&quot;2015-01-01&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s0">None</span><span class="s1">)</span>
        <span class="s1">ts2 = Timestamp(</span><span class="s2">&quot;2015-01-01&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;UTC&quot;</span><span class="s1">)</span>
        <span class="s1">ts3 = Timestamp(</span><span class="s2">&quot;2015-01-01&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;EST&quot;</span><span class="s1">)</span>

        <span class="s1">df1 = DataFrame({</span><span class="s2">&quot;time&quot;</span><span class="s1">: [ts1]})</span>
        <span class="s1">df2 = DataFrame({</span><span class="s2">&quot;time&quot;</span><span class="s1">: [ts2]})</span>
        <span class="s1">df3 = DataFrame({</span><span class="s2">&quot;time&quot;</span><span class="s1">: [ts3]})</span>

        <span class="s1">results = concat([df1</span><span class="s0">, </span><span class="s1">df2]).reset_index(drop=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected = DataFrame({</span><span class="s2">&quot;time&quot;</span><span class="s1">: [ts1</span><span class="s0">, </span><span class="s1">ts2]}</span><span class="s0">, </span><span class="s1">dtype=object)</span>
        <span class="s1">tm.assert_frame_equal(results</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">results = concat([df1</span><span class="s0">, </span><span class="s1">df3]).reset_index(drop=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected = DataFrame({</span><span class="s2">&quot;time&quot;</span><span class="s1">: [ts1</span><span class="s0">, </span><span class="s1">ts3]}</span><span class="s0">, </span><span class="s1">dtype=object)</span>
        <span class="s1">tm.assert_frame_equal(results</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">results = concat([df2</span><span class="s0">, </span><span class="s1">df3]).reset_index(drop=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected = DataFrame({</span><span class="s2">&quot;time&quot;</span><span class="s1">: [ts2</span><span class="s0">, </span><span class="s1">ts3]})</span>
        <span class="s1">tm.assert_frame_equal(results</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.filterwarnings(</span><span class="s2">&quot;ignore:Timestamp.freq is deprecated:FutureWarning&quot;</span><span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_concat_multiindex_with_tz(self):</span>
        <span class="s4"># GH 6606</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;dt&quot;</span><span class="s1">: [</span>
                    <span class="s1">datetime(</span><span class="s3">2014</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
                    <span class="s1">datetime(</span><span class="s3">2014</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">,</span>
                    <span class="s1">datetime(</span><span class="s3">2014</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;c&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;d&quot;</span><span class="s1">: [</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
        <span class="s1">df[</span><span class="s2">&quot;dt&quot;</span><span class="s1">] = df[</span><span class="s2">&quot;dt&quot;</span><span class="s1">].apply(</span><span class="s0">lambda </span><span class="s1">d: Timestamp(d</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;US/Pacific&quot;</span><span class="s1">))</span>
        <span class="s1">df = df.set_index([</span><span class="s2">&quot;dt&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">])</span>

        <span class="s1">exp_idx1 = DatetimeIndex(</span>
            <span class="s1">[</span><span class="s2">&quot;2014-01-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2014-01-02&quot;</span><span class="s0">, </span><span class="s2">&quot;2014-01-03&quot;</span><span class="s1">] * </span><span class="s3">2</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;US/Pacific&quot;</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;dt&quot;</span>
        <span class="s1">)</span>
        <span class="s1">exp_idx2 = Index([</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s1">] * </span><span class="s3">2</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;b&quot;</span><span class="s1">)</span>
        <span class="s1">exp_idx = MultiIndex.from_arrays([exp_idx1</span><span class="s0">, </span><span class="s1">exp_idx2])</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">{</span><span class="s2">&quot;c&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">] * </span><span class="s3">2</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s1">: [</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s1">] * </span><span class="s3">2</span><span class="s1">}</span><span class="s0">, </span><span class="s1">index=exp_idx</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>

        <span class="s1">result = concat([df</span><span class="s0">, </span><span class="s1">df])</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_concat_tz_not_aligned(self):</span>
        <span class="s4"># GH#22796</span>
        <span class="s1">ts = pd.to_datetime([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]).tz_localize(</span><span class="s2">&quot;UTC&quot;</span><span class="s1">)</span>
        <span class="s1">a = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: ts})</span>
        <span class="s1">b = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: ts</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: ts})</span>
        <span class="s1">result = concat([a</span><span class="s0">, </span><span class="s1">b]</span><span class="s0">, </span><span class="s1">sort=</span><span class="s0">True, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">{</span><span class="s2">&quot;A&quot;</span><span class="s1">: list(ts) + list(ts)</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: [pd.NaT</span><span class="s0">, </span><span class="s1">pd.NaT] + list(ts)}</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;t1&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s2">&quot;2015-01-01&quot;</span><span class="s0">,</span>
            <span class="s1">pytest.param(</span>
                <span class="s1">pd.NaT</span><span class="s0">,</span>
                <span class="s1">marks=pytest.mark.xfail(</span>
                    <span class="s1">reason=</span><span class="s2">&quot;GH23037 incorrect dtype when concatenating&quot;</span>
                <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_concat_tz_NaT(self</span><span class="s0">, </span><span class="s1">t1):</span>
        <span class="s4"># GH#22796</span>
        <span class="s4"># Concatenating tz-aware multicolumn DataFrames</span>
        <span class="s1">ts1 = Timestamp(t1</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;UTC&quot;</span><span class="s1">)</span>
        <span class="s1">ts2 = Timestamp(</span><span class="s2">&quot;2015-01-01&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;UTC&quot;</span><span class="s1">)</span>
        <span class="s1">ts3 = Timestamp(</span><span class="s2">&quot;2015-01-01&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;UTC&quot;</span><span class="s1">)</span>

        <span class="s1">df1 = DataFrame([[ts1</span><span class="s0">, </span><span class="s1">ts2]])</span>
        <span class="s1">df2 = DataFrame([[ts3]])</span>

        <span class="s1">result = concat([df1</span><span class="s0">, </span><span class="s1">df2])</span>
        <span class="s1">expected = DataFrame([[ts1</span><span class="s0">, </span><span class="s1">ts2]</span><span class="s0">, </span><span class="s1">[ts3</span><span class="s0">, </span><span class="s1">pd.NaT]]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>

        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_concat_tz_with_empty(self):</span>
        <span class="s4"># GH 9188</span>
        <span class="s1">result = concat(</span>
            <span class="s1">[DataFrame(date_range(</span><span class="s2">&quot;2000&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;UTC&quot;</span><span class="s1">))</span><span class="s0">, </span><span class="s1">DataFrame()]</span>
        <span class="s1">)</span>
        <span class="s1">expected = DataFrame(date_range(</span><span class="s2">&quot;2000&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;UTC&quot;</span><span class="s1">))</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">class </span><span class="s1">TestPeriodConcat:</span>
    <span class="s0">def </span><span class="s1">test_concat_period_series(self):</span>
        <span class="s1">x = Series(pd.PeriodIndex([</span><span class="s2">&quot;2015-11-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2015-12-01&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">))</span>
        <span class="s1">y = Series(pd.PeriodIndex([</span><span class="s2">&quot;2015-10-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2016-01-01&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">))</span>
        <span class="s1">expected = Series([x[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[</span><span class="s3">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;Period[D]&quot;</span><span class="s1">)</span>
        <span class="s1">result = concat([x</span><span class="s0">, </span><span class="s1">y]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_concat_period_multiple_freq_series(self):</span>
        <span class="s1">x = Series(pd.PeriodIndex([</span><span class="s2">&quot;2015-11-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2015-12-01&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">))</span>
        <span class="s1">y = Series(pd.PeriodIndex([</span><span class="s2">&quot;2015-10-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2016-01-01&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">))</span>
        <span class="s1">expected = Series([x[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[</span><span class="s3">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;object&quot;</span><span class="s1">)</span>
        <span class="s1">result = concat([x</span><span class="s0">, </span><span class="s1">y]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
        <span class="s0">assert </span><span class="s1">result.dtype == </span><span class="s2">&quot;object&quot;</span>

    <span class="s0">def </span><span class="s1">test_concat_period_other_series(self):</span>
        <span class="s1">x = Series(pd.PeriodIndex([</span><span class="s2">&quot;2015-11-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2015-12-01&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">))</span>
        <span class="s1">y = Series(pd.PeriodIndex([</span><span class="s2">&quot;2015-11-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2015-12-01&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">))</span>
        <span class="s1">expected = Series([x[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[</span><span class="s3">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;object&quot;</span><span class="s1">)</span>
        <span class="s1">result = concat([x</span><span class="s0">, </span><span class="s1">y]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
        <span class="s0">assert </span><span class="s1">result.dtype == </span><span class="s2">&quot;object&quot;</span>

        <span class="s4"># non-period</span>
        <span class="s1">x = Series(pd.PeriodIndex([</span><span class="s2">&quot;2015-11-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2015-12-01&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">))</span>
        <span class="s1">y = Series(DatetimeIndex([</span><span class="s2">&quot;2015-11-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2015-12-01&quot;</span><span class="s1">]))</span>
        <span class="s1">expected = Series([x[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[</span><span class="s3">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;object&quot;</span><span class="s1">)</span>
        <span class="s1">result = concat([x</span><span class="s0">, </span><span class="s1">y]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
        <span class="s0">assert </span><span class="s1">result.dtype == </span><span class="s2">&quot;object&quot;</span>

        <span class="s1">x = Series(pd.PeriodIndex([</span><span class="s2">&quot;2015-11-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2015-12-01&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;D&quot;</span><span class="s1">))</span>
        <span class="s1">y = Series([</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">])</span>
        <span class="s1">expected = Series([x[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[</span><span class="s3">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;object&quot;</span><span class="s1">)</span>
        <span class="s1">result = concat([x</span><span class="s0">, </span><span class="s1">y]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
        <span class="s0">assert </span><span class="s1">result.dtype == </span><span class="s2">&quot;object&quot;</span>


<span class="s0">def </span><span class="s1">test_concat_timedelta64_block():</span>
    <span class="s1">rng = to_timedelta(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">unit=</span><span class="s2">&quot;s&quot;</span><span class="s1">)</span>

    <span class="s1">df = DataFrame({</span><span class="s2">&quot;time&quot;</span><span class="s1">: rng})</span>

    <span class="s1">result = concat([df</span><span class="s0">, </span><span class="s1">df])</span>
    <span class="s1">tm.assert_frame_equal(result.iloc[:</span><span class="s3">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">df)</span>
    <span class="s1">tm.assert_frame_equal(result.iloc[</span><span class="s3">10</span><span class="s1">:]</span><span class="s0">, </span><span class="s1">df)</span>


<span class="s0">def </span><span class="s1">test_concat_multiindex_datetime_nat():</span>
    <span class="s4"># GH#44900</span>
    <span class="s1">left = DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: </span><span class="s3">1</span><span class="s1">}</span><span class="s0">, </span><span class="s1">index=MultiIndex.from_tuples([(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">pd.NaT)]))</span>
    <span class="s1">right = DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;b&quot;</span><span class="s1">: </span><span class="s3">2</span><span class="s1">}</span><span class="s0">, </span><span class="s1">index=MultiIndex.from_tuples([(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">pd.NaT)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s1">pd.NaT)])</span>
    <span class="s1">)</span>
    <span class="s1">result = concat([left</span><span class="s0">, </span><span class="s1">right]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s2">&quot;columns&quot;</span><span class="s1">)</span>
    <span class="s1">expected = DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: </span><span class="s3">2</span><span class="s1">}</span><span class="s0">, </span><span class="s1">MultiIndex.from_tuples([(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">pd.NaT)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s1">pd.NaT)])</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
</pre>
</body>
</html>