<html>
<head>
<title>_renderers.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #808080;}
.s4 { color: #629755; font-style: italic;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
_renderers.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">__future__ </span><span class="s0">import </span><span class="s1">absolute_import</span><span class="s0">, </span><span class="s1">division</span>

<span class="s0">import </span><span class="s1">textwrap</span>
<span class="s0">from </span><span class="s1">copy </span><span class="s0">import </span><span class="s1">copy</span>

<span class="s0">import </span><span class="s1">six</span>
<span class="s0">import </span><span class="s1">os</span>
<span class="s0">from </span><span class="s1">distutils.version </span><span class="s0">import </span><span class="s1">LooseVersion</span>

<span class="s0">from </span><span class="s1">plotly </span><span class="s0">import </span><span class="s1">optional_imports</span>

<span class="s0">from </span><span class="s1">plotly.io._base_renderers </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">MimetypeRenderer</span><span class="s0">,</span>
    <span class="s1">ExternalRenderer</span><span class="s0">,</span>
    <span class="s1">PlotlyRenderer</span><span class="s0">,</span>
    <span class="s1">NotebookRenderer</span><span class="s0">,</span>
    <span class="s1">KaggleRenderer</span><span class="s0">,</span>
    <span class="s1">AzureRenderer</span><span class="s0">,</span>
    <span class="s1">ColabRenderer</span><span class="s0">,</span>
    <span class="s1">JsonRenderer</span><span class="s0">,</span>
    <span class="s1">PngRenderer</span><span class="s0">,</span>
    <span class="s1">JpegRenderer</span><span class="s0">,</span>
    <span class="s1">SvgRenderer</span><span class="s0">,</span>
    <span class="s1">PdfRenderer</span><span class="s0">,</span>
    <span class="s1">BrowserRenderer</span><span class="s0">,</span>
    <span class="s1">IFrameRenderer</span><span class="s0">,</span>
    <span class="s1">SphinxGalleryHtmlRenderer</span><span class="s0">,</span>
    <span class="s1">SphinxGalleryOrcaRenderer</span><span class="s0">,</span>
    <span class="s1">CoCalcRenderer</span><span class="s0">,</span>
    <span class="s1">DatabricksRenderer</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">from </span><span class="s1">plotly.io._utils </span><span class="s0">import </span><span class="s1">validate_coerce_fig_to_dict</span>

<span class="s1">ipython = optional_imports.get_module(</span><span class="s2">&quot;IPython&quot;</span><span class="s1">)</span>
<span class="s1">ipython_display = optional_imports.get_module(</span><span class="s2">&quot;IPython.display&quot;</span><span class="s1">)</span>
<span class="s1">nbformat = optional_imports.get_module(</span><span class="s2">&quot;nbformat&quot;</span><span class="s1">)</span>


<span class="s3"># Renderer configuration class</span>
<span class="s3"># -----------------------------</span>
<span class="s0">class </span><span class="s1">RenderersConfig(object):</span>
    <span class="s4">&quot;&quot;&quot; 
    Singleton object containing the current renderer configurations 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__(self):</span>
        <span class="s1">self._renderers = {}</span>
        <span class="s1">self._default_name = </span><span class="s0">None</span>
        <span class="s1">self._default_renderers = []</span>
        <span class="s1">self._render_on_display = </span><span class="s0">False</span>
        <span class="s1">self._to_activate = []</span>

    <span class="s3"># ### Magic methods ###</span>
    <span class="s3"># Make this act as a dict of renderers</span>
    <span class="s0">def </span><span class="s1">__len__(self):</span>
        <span class="s0">return </span><span class="s1">len(self._renderers)</span>

    <span class="s0">def </span><span class="s1">__contains__(self</span><span class="s0">, </span><span class="s1">item):</span>
        <span class="s0">return </span><span class="s1">item </span><span class="s0">in </span><span class="s1">self._renderers</span>

    <span class="s0">def </span><span class="s1">__iter__(self):</span>
        <span class="s0">return </span><span class="s1">iter(self._renderers)</span>

    <span class="s0">def </span><span class="s1">__getitem__(self</span><span class="s0">, </span><span class="s1">item):</span>
        <span class="s1">renderer = self._renderers[item]</span>
        <span class="s0">return </span><span class="s1">renderer</span>

    <span class="s0">def </span><span class="s1">__setitem__(self</span><span class="s0">, </span><span class="s1">key</span><span class="s0">, </span><span class="s1">value):</span>
        <span class="s0">if not </span><span class="s1">isinstance(value</span><span class="s0">, </span><span class="s1">(MimetypeRenderer</span><span class="s0">, </span><span class="s1">ExternalRenderer)):</span>
            <span class="s0">raise </span><span class="s1">ValueError(</span>
                <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
</span><span class="s2">Renderer must be a subclass of MimetypeRenderer or ExternalRenderer. 
    Received value with type: {typ}&quot;&quot;&quot;</span><span class="s1">.format(</span>
                    <span class="s1">typ=type(value)</span>
                <span class="s1">)</span>
            <span class="s1">)</span>

        <span class="s1">self._renderers[key] = value</span>

    <span class="s0">def </span><span class="s1">__delitem__(self</span><span class="s0">, </span><span class="s1">key):</span>
        <span class="s3"># Remove template</span>
        <span class="s0">del </span><span class="s1">self._renderers[key]</span>

        <span class="s3"># Check if we need to remove it as the default</span>
        <span class="s0">if </span><span class="s1">self._default == key:</span>
            <span class="s1">self._default = </span><span class="s0">None</span>

    <span class="s0">def </span><span class="s1">keys(self):</span>
        <span class="s0">return </span><span class="s1">self._renderers.keys()</span>

    <span class="s0">def </span><span class="s1">items(self):</span>
        <span class="s0">return </span><span class="s1">self._renderers.items()</span>

    <span class="s0">def </span><span class="s1">update(self</span><span class="s0">, </span><span class="s1">d={}</span><span class="s0">, </span><span class="s1">**kwargs):</span>
        <span class="s4">&quot;&quot;&quot; 
        Update one or more renderers from a dict or from input keyword 
        arguments. 
 
        Parameters 
        ---------- 
        d: dict 
            Dictionary from renderer names to new renderer objects. 
 
        kwargs 
            Named argument value pairs where the name is a renderer name 
            and the value is a new renderer object 
        &quot;&quot;&quot;</span>
        <span class="s0">for </span><span class="s1">k</span><span class="s0">, </span><span class="s1">v </span><span class="s0">in </span><span class="s1">dict(d</span><span class="s0">, </span><span class="s1">**kwargs).items():</span>
            <span class="s1">self[k] = v</span>

    <span class="s3"># ### Properties ###</span>
    <span class="s1">@property</span>
    <span class="s0">def </span><span class="s1">default(self):</span>
        <span class="s4">&quot;&quot;&quot; 
        The default renderer, or None if no there is no default 
 
        If not None, the default renderer is used to render 
        figures when the `plotly.io.show` function is called on a Figure. 
 
        If `plotly.io.renderers.render_on_display` is True, then the default 
        renderer will also be used to display Figures automatically when 
        displayed in the Jupyter Notebook 
 
        Multiple renderers may be registered by separating their names with 
        '+' characters. For example, to specify rendering compatible with 
        the classic Jupyter Notebook, JupyterLab, and PDF export: 
 
        &gt;&gt;&gt; import plotly.io as pio 
        &gt;&gt;&gt; pio.renderers.default = 'notebook+jupyterlab+pdf' 
 
        The names of available renderers may be retrieved with: 
 
        &gt;&gt;&gt; import plotly.io as pio 
        &gt;&gt;&gt; list(pio.renderers) 
 
        Returns 
        ------- 
        str 
        &quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">self._default_name</span>

    <span class="s1">@default.setter</span>
    <span class="s0">def </span><span class="s1">default(self</span><span class="s0">, </span><span class="s1">value):</span>
        <span class="s3"># Handle None</span>
        <span class="s0">if not </span><span class="s1">value:</span>
            <span class="s3"># _default_name should always be a string so we can do</span>
            <span class="s3"># pio.renderers.default.split('+')</span>
            <span class="s1">self._default_name = </span><span class="s2">&quot;&quot;</span>
            <span class="s1">self._default_renderers = []</span>
            <span class="s0">return</span>

        <span class="s3"># Store defaults name and list of renderer(s)</span>
        <span class="s1">renderer_names = self._validate_coerce_renderers(value)</span>
        <span class="s1">self._default_name = value</span>
        <span class="s1">self._default_renderers = [self[name] </span><span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">renderer_names]</span>

        <span class="s3"># Register renderers for activation before their next use</span>
        <span class="s1">self._to_activate = list(self._default_renderers)</span>

    <span class="s1">@property</span>
    <span class="s0">def </span><span class="s1">render_on_display(self):</span>
        <span class="s4">&quot;&quot;&quot; 
        If True, the default mimetype renderers will be used to render 
        figures when they are displayed in an IPython context. 
 
        Returns 
        ------- 
        bool 
        &quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">self._render_on_display</span>

    <span class="s1">@render_on_display.setter</span>
    <span class="s0">def </span><span class="s1">render_on_display(self</span><span class="s0">, </span><span class="s1">val):</span>
        <span class="s1">self._render_on_display = bool(val)</span>

    <span class="s0">def </span><span class="s1">_activate_pending_renderers(self</span><span class="s0">, </span><span class="s1">cls=object):</span>
        <span class="s4">&quot;&quot;&quot; 
        Activate all renderers that are waiting in the _to_activate list 
 
        Parameters 
        ---------- 
        cls 
            Only activate renders that are subclasses of this class 
        &quot;&quot;&quot;</span>
        <span class="s1">to_activate_with_cls = [</span>
            <span class="s1">r </span><span class="s0">for </span><span class="s1">r </span><span class="s0">in </span><span class="s1">self._to_activate </span><span class="s0">if </span><span class="s1">cls </span><span class="s0">and </span><span class="s1">isinstance(r</span><span class="s0">, </span><span class="s1">cls)</span>
        <span class="s1">]</span>

        <span class="s0">while </span><span class="s1">to_activate_with_cls:</span>
            <span class="s3"># Activate renderers from left to right so that right-most</span>
            <span class="s3"># renderers take precedence</span>
            <span class="s1">renderer = to_activate_with_cls.pop(</span><span class="s5">0</span><span class="s1">)</span>
            <span class="s1">renderer.activate()</span>

        <span class="s1">self._to_activate = [</span>
            <span class="s1">r </span><span class="s0">for </span><span class="s1">r </span><span class="s0">in </span><span class="s1">self._to_activate </span><span class="s0">if not </span><span class="s1">(cls </span><span class="s0">and </span><span class="s1">isinstance(r</span><span class="s0">, </span><span class="s1">cls))</span>
        <span class="s1">]</span>

    <span class="s0">def </span><span class="s1">_validate_coerce_renderers(self</span><span class="s0">, </span><span class="s1">renderers_string):</span>
        <span class="s4">&quot;&quot;&quot; 
        Input a string and validate that it contains the names of one or more 
        valid renderers separated on '+' characters.  If valid, return 
        a list of the renderer names 
 
        Parameters 
        ---------- 
        renderers_string: str 
 
        Returns 
        ------- 
        list of str 
        &quot;&quot;&quot;</span>
        <span class="s3"># Validate value</span>
        <span class="s0">if not </span><span class="s1">isinstance(renderers_string</span><span class="s0">, </span><span class="s1">six.string_types):</span>
            <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s2">&quot;Renderer must be specified as a string&quot;</span><span class="s1">)</span>

        <span class="s1">renderer_names = renderers_string.split(</span><span class="s2">&quot;+&quot;</span><span class="s1">)</span>
        <span class="s1">invalid = [name </span><span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">renderer_names </span><span class="s0">if </span><span class="s1">name </span><span class="s0">not in </span><span class="s1">self]</span>
        <span class="s0">if </span><span class="s1">invalid:</span>
            <span class="s0">raise </span><span class="s1">ValueError(</span>
                <span class="s2">&quot;&quot;&quot; 
Invalid named renderer(s) received: {}&quot;&quot;&quot;</span><span class="s1">.format(</span>
                    <span class="s1">str(invalid)</span>
                <span class="s1">)</span>
            <span class="s1">)</span>

        <span class="s0">return </span><span class="s1">renderer_names</span>

    <span class="s0">def </span><span class="s1">__repr__(self):</span>
        <span class="s0">return </span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
</span><span class="s2">Renderers configuration 
----------------------- 
    Default renderer: {default} 
    Available renderers: 
{available} 
&quot;&quot;&quot;</span><span class="s1">.format(</span>
            <span class="s1">default=repr(self.default)</span><span class="s0">, </span><span class="s1">available=self._available_renderers_str()</span>
        <span class="s1">)</span>

    <span class="s0">def </span><span class="s1">_available_renderers_str(self):</span>
        <span class="s4">&quot;&quot;&quot; 
        Return nicely wrapped string representation of all 
        available renderer names 
        &quot;&quot;&quot;</span>
        <span class="s1">available = </span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot;</span><span class="s1">.join(</span>
            <span class="s1">textwrap.wrap(</span>
                <span class="s1">repr(list(self))</span><span class="s0">,</span>
                <span class="s1">width=</span><span class="s5">79 </span><span class="s1">- </span><span class="s5">8</span><span class="s0">,</span>
                <span class="s1">initial_indent=</span><span class="s2">&quot; &quot; </span><span class="s1">* </span><span class="s5">8</span><span class="s0">,</span>
                <span class="s1">subsequent_indent=</span><span class="s2">&quot; &quot; </span><span class="s1">* </span><span class="s5">9</span><span class="s0">,</span>
            <span class="s1">)</span>
        <span class="s1">)</span>
        <span class="s0">return </span><span class="s1">available</span>

    <span class="s0">def </span><span class="s1">_build_mime_bundle(self</span><span class="s0">, </span><span class="s1">fig_dict</span><span class="s0">, </span><span class="s1">renderers_string=</span><span class="s0">None, </span><span class="s1">**kwargs):</span>
        <span class="s4">&quot;&quot;&quot; 
        Build a mime bundle dict containing a kev/value pair for each 
        MimetypeRenderer specified in either the default renderer string, 
        or in the supplied renderers_string argument. 
 
        Note that this method skips any renderers that are not subclasses 
        of MimetypeRenderer. 
 
        Parameters 
        ---------- 
        fig_dict: dict 
            Figure dictionary 
        renderers_string: str or None (default None) 
            Renderer string to process rather than the current default 
            renderer string 
 
        Returns 
        ------- 
        dict 
        &quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">renderers_string:</span>
            <span class="s1">renderer_names = self._validate_coerce_renderers(renderers_string)</span>
            <span class="s1">renderers_list = [self[name] </span><span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">renderer_names]</span>

            <span class="s3"># Activate these non-default renderers</span>
            <span class="s0">for </span><span class="s1">renderer </span><span class="s0">in </span><span class="s1">renderers_list:</span>
                <span class="s0">if </span><span class="s1">isinstance(renderer</span><span class="s0">, </span><span class="s1">MimetypeRenderer):</span>
                    <span class="s1">renderer.activate()</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s3"># Activate any pending default renderers</span>
            <span class="s1">self._activate_pending_renderers(cls=MimetypeRenderer)</span>
            <span class="s1">renderers_list = self._default_renderers</span>

        <span class="s1">bundle = {}</span>
        <span class="s0">for </span><span class="s1">renderer </span><span class="s0">in </span><span class="s1">renderers_list:</span>
            <span class="s0">if </span><span class="s1">isinstance(renderer</span><span class="s0">, </span><span class="s1">MimetypeRenderer):</span>
                <span class="s1">renderer = copy(renderer)</span>
                <span class="s0">for </span><span class="s1">k</span><span class="s0">, </span><span class="s1">v </span><span class="s0">in </span><span class="s1">kwargs.items():</span>
                    <span class="s0">if </span><span class="s1">hasattr(renderer</span><span class="s0">, </span><span class="s1">k):</span>
                        <span class="s1">setattr(renderer</span><span class="s0">, </span><span class="s1">k</span><span class="s0">, </span><span class="s1">v)</span>

                <span class="s1">bundle.update(renderer.to_mimebundle(fig_dict))</span>

        <span class="s0">return </span><span class="s1">bundle</span>

    <span class="s0">def </span><span class="s1">_perform_external_rendering(self</span><span class="s0">, </span><span class="s1">fig_dict</span><span class="s0">, </span><span class="s1">renderers_string=</span><span class="s0">None, </span><span class="s1">**kwargs):</span>
        <span class="s4">&quot;&quot;&quot; 
        Perform external rendering for each ExternalRenderer specified 
        in either the default renderer string, or in the supplied 
        renderers_string argument. 
 
        Note that this method skips any renderers that are not subclasses 
        of ExternalRenderer. 
 
        Parameters 
        ---------- 
        fig_dict: dict 
            Figure dictionary 
        renderers_string: str or None (default None) 
            Renderer string to process rather than the current default 
            renderer string 
 
        Returns 
        ------- 
        None 
        &quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">renderers_string:</span>
            <span class="s1">renderer_names = self._validate_coerce_renderers(renderers_string)</span>
            <span class="s1">renderers_list = [self[name] </span><span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">renderer_names]</span>

            <span class="s3"># Activate these non-default renderers</span>
            <span class="s0">for </span><span class="s1">renderer </span><span class="s0">in </span><span class="s1">renderers_list:</span>
                <span class="s0">if </span><span class="s1">isinstance(renderer</span><span class="s0">, </span><span class="s1">ExternalRenderer):</span>
                    <span class="s1">renderer.activate()</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">self._activate_pending_renderers(cls=ExternalRenderer)</span>
            <span class="s1">renderers_list = self._default_renderers</span>

        <span class="s0">for </span><span class="s1">renderer </span><span class="s0">in </span><span class="s1">renderers_list:</span>
            <span class="s0">if </span><span class="s1">isinstance(renderer</span><span class="s0">, </span><span class="s1">ExternalRenderer):</span>
                <span class="s1">renderer = copy(renderer)</span>
                <span class="s0">for </span><span class="s1">k</span><span class="s0">, </span><span class="s1">v </span><span class="s0">in </span><span class="s1">kwargs.items():</span>
                    <span class="s0">if </span><span class="s1">hasattr(renderer</span><span class="s0">, </span><span class="s1">k):</span>
                        <span class="s1">setattr(renderer</span><span class="s0">, </span><span class="s1">k</span><span class="s0">, </span><span class="s1">v)</span>

                <span class="s1">renderer.render(fig_dict)</span>


<span class="s3"># Make renderers a singleton object</span>
<span class="s3"># ---------------------------------</span>
<span class="s1">renderers = RenderersConfig()</span>
<span class="s0">del </span><span class="s1">RenderersConfig</span>


<span class="s3"># Show</span>
<span class="s0">def </span><span class="s1">show(fig</span><span class="s0">, </span><span class="s1">renderer=</span><span class="s0">None, </span><span class="s1">validate=</span><span class="s0">True, </span><span class="s1">**kwargs):</span>
    <span class="s4">&quot;&quot;&quot; 
    Show a figure using either the default renderer(s) or the renderer(s) 
    specified by the renderer argument 
 
    Parameters 
    ---------- 
    fig: dict of Figure 
        The Figure object or figure dict to display 
 
    renderer: str or None (default None) 
        A string containing the names of one or more registered renderers 
        (separated by '+' characters) or None.  If None, then the default 
        renderers specified in plotly.io.renderers.default are used. 
 
    validate: bool (default True) 
        True if the figure should be validated before being shown, 
        False otherwise. 
 
    width: int or float 
        An integer or float that determines the number of pixels wide the 
        plot is. The default is set in plotly.js. 
 
    height: int or float 
        An integer or float that determines the number of pixels wide the 
        plot is. The default is set in plotly.js. 
 
    config: dict 
        A dict of parameters to configure the figure. The defaults are set 
        in plotly.js. 
 
    Returns 
    ------- 
    None 
    &quot;&quot;&quot;</span>
    <span class="s1">fig_dict = validate_coerce_fig_to_dict(fig</span><span class="s0">, </span><span class="s1">validate)</span>

    <span class="s3"># Mimetype renderers</span>
    <span class="s1">bundle = renderers._build_mime_bundle(fig_dict</span><span class="s0">, </span><span class="s1">renderers_string=renderer</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s0">if </span><span class="s1">bundle:</span>
        <span class="s0">if not </span><span class="s1">ipython_display:</span>
            <span class="s0">raise </span><span class="s1">ValueError(</span>
                <span class="s2">&quot;Mime type rendering requires ipython but it is not installed&quot;</span>
            <span class="s1">)</span>

        <span class="s0">if not </span><span class="s1">nbformat </span><span class="s0">or </span><span class="s1">LooseVersion(nbformat.__version__) &lt; LooseVersion(</span><span class="s2">&quot;4.2.0&quot;</span><span class="s1">):</span>
            <span class="s0">raise </span><span class="s1">ValueError(</span>
                <span class="s2">&quot;Mime type rendering requires nbformat&gt;=4.2.0 but it is not installed&quot;</span>
            <span class="s1">)</span>

        <span class="s1">ipython_display.display(bundle</span><span class="s0">, </span><span class="s1">raw=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s3"># external renderers</span>
    <span class="s1">renderers._perform_external_rendering(fig_dict</span><span class="s0">, </span><span class="s1">renderers_string=renderer</span><span class="s0">, </span><span class="s1">**kwargs)</span>


<span class="s3"># Register renderers</span>
<span class="s3"># ------------------</span>

<span class="s3"># Plotly mime type</span>
<span class="s1">plotly_renderer = PlotlyRenderer()</span>
<span class="s1">renderers[</span><span class="s2">&quot;plotly_mimetype&quot;</span><span class="s1">] = plotly_renderer</span>
<span class="s1">renderers[</span><span class="s2">&quot;jupyterlab&quot;</span><span class="s1">] = plotly_renderer</span>
<span class="s1">renderers[</span><span class="s2">&quot;nteract&quot;</span><span class="s1">] = plotly_renderer</span>
<span class="s1">renderers[</span><span class="s2">&quot;vscode&quot;</span><span class="s1">] = plotly_renderer</span>

<span class="s3"># HTML-based</span>
<span class="s1">config = {}</span>
<span class="s1">renderers[</span><span class="s2">&quot;notebook&quot;</span><span class="s1">] = NotebookRenderer(config=config)</span>
<span class="s1">renderers[</span><span class="s2">&quot;notebook_connected&quot;</span><span class="s1">] = NotebookRenderer(config=config</span><span class="s0">, </span><span class="s1">connected=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s1">renderers[</span><span class="s2">&quot;kaggle&quot;</span><span class="s1">] = KaggleRenderer(config=config)</span>
<span class="s1">renderers[</span><span class="s2">&quot;azure&quot;</span><span class="s1">] = AzureRenderer(config=config)</span>
<span class="s1">renderers[</span><span class="s2">&quot;colab&quot;</span><span class="s1">] = ColabRenderer(config=config)</span>
<span class="s1">renderers[</span><span class="s2">&quot;cocalc&quot;</span><span class="s1">] = CoCalcRenderer()</span>
<span class="s1">renderers[</span><span class="s2">&quot;databricks&quot;</span><span class="s1">] = DatabricksRenderer()</span>

<span class="s3"># JSON</span>
<span class="s1">renderers[</span><span class="s2">&quot;json&quot;</span><span class="s1">] = JsonRenderer()</span>

<span class="s3"># Static Image</span>
<span class="s1">renderers[</span><span class="s2">&quot;png&quot;</span><span class="s1">] = PngRenderer()</span>
<span class="s1">jpeg_renderer = JpegRenderer()</span>
<span class="s1">renderers[</span><span class="s2">&quot;jpeg&quot;</span><span class="s1">] = jpeg_renderer</span>
<span class="s1">renderers[</span><span class="s2">&quot;jpg&quot;</span><span class="s1">] = jpeg_renderer</span>
<span class="s1">renderers[</span><span class="s2">&quot;svg&quot;</span><span class="s1">] = SvgRenderer()</span>
<span class="s1">renderers[</span><span class="s2">&quot;pdf&quot;</span><span class="s1">] = PdfRenderer()</span>

<span class="s3"># External</span>
<span class="s1">renderers[</span><span class="s2">&quot;browser&quot;</span><span class="s1">] = BrowserRenderer(config=config)</span>
<span class="s1">renderers[</span><span class="s2">&quot;firefox&quot;</span><span class="s1">] = BrowserRenderer(config=config</span><span class="s0">, </span><span class="s1">using=(</span><span class="s2">&quot;firefox&quot;</span><span class="s1">))</span>
<span class="s1">renderers[</span><span class="s2">&quot;chrome&quot;</span><span class="s1">] = BrowserRenderer(config=config</span><span class="s0">, </span><span class="s1">using=(</span><span class="s2">&quot;chrome&quot;</span><span class="s0">, </span><span class="s2">&quot;google-chrome&quot;</span><span class="s1">))</span>
<span class="s1">renderers[</span><span class="s2">&quot;chromium&quot;</span><span class="s1">] = BrowserRenderer(</span>
    <span class="s1">config=config</span><span class="s0">, </span><span class="s1">using=(</span><span class="s2">&quot;chromium&quot;</span><span class="s0">, </span><span class="s2">&quot;chromium-browser&quot;</span><span class="s1">)</span>
<span class="s1">)</span>
<span class="s1">renderers[</span><span class="s2">&quot;iframe&quot;</span><span class="s1">] = IFrameRenderer(config=config</span><span class="s0">, </span><span class="s1">include_plotlyjs=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s1">renderers[</span><span class="s2">&quot;iframe_connected&quot;</span><span class="s1">] = IFrameRenderer(config=config</span><span class="s0">, </span><span class="s1">include_plotlyjs=</span><span class="s2">&quot;cdn&quot;</span><span class="s1">)</span>
<span class="s1">renderers[</span><span class="s2">&quot;sphinx_gallery&quot;</span><span class="s1">] = SphinxGalleryHtmlRenderer()</span>
<span class="s1">renderers[</span><span class="s2">&quot;sphinx_gallery_png&quot;</span><span class="s1">] = SphinxGalleryOrcaRenderer()</span>

<span class="s3"># Set default renderer</span>
<span class="s3"># --------------------</span>
<span class="s3"># Version 4 renderer configuration</span>
<span class="s1">default_renderer = </span><span class="s0">None</span>

<span class="s3"># Handle the PLOTLY_RENDERER environment variable</span>
<span class="s1">env_renderer = os.environ.get(</span><span class="s2">&quot;PLOTLY_RENDERER&quot;</span><span class="s0">, None</span><span class="s1">)</span>
<span class="s0">if </span><span class="s1">env_renderer:</span>
    <span class="s0">try</span><span class="s1">:</span>
        <span class="s1">renderers._validate_coerce_renderers(env_renderer)</span>
    <span class="s0">except </span><span class="s1">ValueError:</span>
        <span class="s0">raise </span><span class="s1">ValueError(</span>
            <span class="s2">&quot;&quot;&quot; 
Invalid named renderer(s) specified in the 'PLOTLY_RENDERER' 
environment variable: {env_renderer}&quot;&quot;&quot;</span><span class="s1">.format(</span>
                <span class="s1">env_renderer=env_renderer</span>
            <span class="s1">)</span>
        <span class="s1">)</span>

    <span class="s1">default_renderer = env_renderer</span>
<span class="s0">elif </span><span class="s1">ipython </span><span class="s0">and </span><span class="s1">ipython.get_ipython():</span>
    <span class="s3"># Try to detect environment so that we can enable a useful</span>
    <span class="s3"># default renderer</span>
    <span class="s0">if not </span><span class="s1">default_renderer:</span>
        <span class="s0">try</span><span class="s1">:</span>
            <span class="s0">import </span><span class="s1">google.colab</span>

            <span class="s1">default_renderer = </span><span class="s2">&quot;colab&quot;</span>
        <span class="s0">except </span><span class="s1">ImportError:</span>
            <span class="s0">pass</span>

    <span class="s3"># Check if we're running in a Kaggle notebook</span>
    <span class="s0">if not </span><span class="s1">default_renderer </span><span class="s0">and </span><span class="s1">os.path.exists(</span><span class="s2">&quot;/kaggle/input&quot;</span><span class="s1">):</span>
        <span class="s1">default_renderer = </span><span class="s2">&quot;kaggle&quot;</span>

    <span class="s3"># Check if we're running in an Azure Notebook</span>
    <span class="s0">if not </span><span class="s1">default_renderer </span><span class="s0">and </span><span class="s2">&quot;AZURE_NOTEBOOKS_HOST&quot; </span><span class="s0">in </span><span class="s1">os.environ:</span>
        <span class="s1">default_renderer = </span><span class="s2">&quot;azure&quot;</span>

    <span class="s3"># Check if we're running in VSCode</span>
    <span class="s0">if not </span><span class="s1">default_renderer </span><span class="s0">and </span><span class="s2">&quot;VSCODE_PID&quot; </span><span class="s0">in </span><span class="s1">os.environ:</span>
        <span class="s1">default_renderer = </span><span class="s2">&quot;vscode&quot;</span>

    <span class="s3"># Check if we're running in nteract</span>
    <span class="s0">if not </span><span class="s1">default_renderer </span><span class="s0">and </span><span class="s2">&quot;NTERACT_EXE&quot; </span><span class="s0">in </span><span class="s1">os.environ:</span>
        <span class="s1">default_renderer = </span><span class="s2">&quot;nteract&quot;</span>

    <span class="s3"># Check if we're running in CoCalc</span>
    <span class="s0">if not </span><span class="s1">default_renderer </span><span class="s0">and </span><span class="s2">&quot;COCALC_PROJECT_ID&quot; </span><span class="s0">in </span><span class="s1">os.environ:</span>
        <span class="s1">default_renderer = </span><span class="s2">&quot;cocalc&quot;</span>

    <span class="s0">if not </span><span class="s1">default_renderer </span><span class="s0">and </span><span class="s2">&quot;DATABRICKS_RUNTIME_VERSION&quot; </span><span class="s0">in </span><span class="s1">os.environ:</span>
        <span class="s1">default_renderer = </span><span class="s2">&quot;databricks&quot;</span>

    <span class="s3"># Check if we're running in spyder and orca is installed</span>
    <span class="s0">if not </span><span class="s1">default_renderer </span><span class="s0">and </span><span class="s2">&quot;SPYDER_ARGS&quot; </span><span class="s0">in </span><span class="s1">os.environ:</span>
        <span class="s0">try</span><span class="s1">:</span>
            <span class="s0">from </span><span class="s1">plotly.io.orca </span><span class="s0">import </span><span class="s1">validate_executable</span>

            <span class="s1">validate_executable()</span>
            <span class="s1">default_renderer = </span><span class="s2">&quot;svg&quot;</span>
        <span class="s0">except </span><span class="s1">ValueError:</span>
            <span class="s3"># orca not found</span>
            <span class="s0">pass</span>

    <span class="s3"># Check if we're running in ipython terminal</span>
    <span class="s0">if not </span><span class="s1">default_renderer </span><span class="s0">and </span><span class="s1">(</span>
        <span class="s1">ipython.get_ipython().__class__.__name__ == </span><span class="s2">&quot;TerminalInteractiveShell&quot;</span>
    <span class="s1">):</span>
        <span class="s1">default_renderer = </span><span class="s2">&quot;browser&quot;</span>

    <span class="s3"># Fallback to renderer combination that will work automatically</span>
    <span class="s3"># in the classic notebook (offline), jupyterlab, nteract, vscode, and</span>
    <span class="s3"># nbconvert HTML export.</span>
    <span class="s0">if not </span><span class="s1">default_renderer:</span>
        <span class="s1">default_renderer = </span><span class="s2">&quot;plotly_mimetype+notebook&quot;</span>
<span class="s0">else</span><span class="s1">:</span>
    <span class="s3"># If ipython isn't available, try to display figures in the default</span>
    <span class="s3"># browser</span>
    <span class="s0">import </span><span class="s1">webbrowser</span>

    <span class="s0">try</span><span class="s1">:</span>
        <span class="s1">webbrowser.get()</span>
        <span class="s1">default_renderer = </span><span class="s2">&quot;browser&quot;</span>
    <span class="s0">except </span><span class="s1">webbrowser.Error:</span>
        <span class="s3"># Default browser could not be loaded</span>
        <span class="s0">pass</span>

<span class="s1">renderers.render_on_display = </span><span class="s0">True</span>
<span class="s1">renderers.default = default_renderer</span>
</pre>
</body>
</html>