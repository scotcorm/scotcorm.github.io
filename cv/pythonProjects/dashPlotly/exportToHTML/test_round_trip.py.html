<html>
<head>
<title>test_round_trip.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #808080;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_round_trip.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">datetime</span>
<span class="s0">import </span><span class="s1">re</span>
<span class="s0">from </span><span class="s1">warnings </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">catch_warnings</span><span class="s0">,</span>
    <span class="s1">simplefilter</span><span class="s0">,</span>
<span class="s1">)</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas._libs.tslibs </span><span class="s0">import </span><span class="s1">Timestamp</span>
<span class="s0">from </span><span class="s1">pandas.compat </span><span class="s0">import </span><span class="s1">is_platform_windows</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">DataFrame</span><span class="s0">,</span>
    <span class="s1">Index</span><span class="s0">,</span>
    <span class="s1">Series</span><span class="s0">,</span>
    <span class="s1">_testing </span><span class="s0">as </span><span class="s1">tm</span><span class="s0">,</span>
    <span class="s1">bdate_range</span><span class="s0">,</span>
    <span class="s1">read_hdf</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">from </span><span class="s1">pandas.tests.io.pytables.common </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">_maybe_remove</span><span class="s0">,</span>
    <span class="s1">ensure_clean_path</span><span class="s0">,</span>
    <span class="s1">ensure_clean_store</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">from </span><span class="s1">pandas.util </span><span class="s0">import </span><span class="s1">_test_decorators </span><span class="s0">as </span><span class="s1">td</span>

<span class="s1">_default_compressor = </span><span class="s2">&quot;blosc&quot;</span>


<span class="s1">pytestmark = pytest.mark.single</span>


<span class="s0">def </span><span class="s1">test_conv_read_write(setup_path):</span>
    <span class="s0">with </span><span class="s1">tm.ensure_clean() </span><span class="s0">as </span><span class="s1">path:</span>

        <span class="s0">def </span><span class="s1">roundtrip(key</span><span class="s0">, </span><span class="s1">obj</span><span class="s0">, </span><span class="s1">**kwargs):</span>
            <span class="s1">obj.to_hdf(path</span><span class="s0">, </span><span class="s1">key</span><span class="s0">, </span><span class="s1">**kwargs)</span>
            <span class="s0">return </span><span class="s1">read_hdf(path</span><span class="s0">, </span><span class="s1">key)</span>

        <span class="s1">o = tm.makeTimeSeries()</span>
        <span class="s1">tm.assert_series_equal(o</span><span class="s0">, </span><span class="s1">roundtrip(</span><span class="s2">&quot;series&quot;</span><span class="s0">, </span><span class="s1">o))</span>

        <span class="s1">o = tm.makeStringSeries()</span>
        <span class="s1">tm.assert_series_equal(o</span><span class="s0">, </span><span class="s1">roundtrip(</span><span class="s2">&quot;string_series&quot;</span><span class="s0">, </span><span class="s1">o))</span>

        <span class="s1">o = tm.makeDataFrame()</span>
        <span class="s1">tm.assert_frame_equal(o</span><span class="s0">, </span><span class="s1">roundtrip(</span><span class="s2">&quot;frame&quot;</span><span class="s0">, </span><span class="s1">o))</span>

        <span class="s3"># table</span>
        <span class="s1">df = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: range(</span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: range(</span><span class="s4">5</span><span class="s1">)})</span>
        <span class="s1">df.to_hdf(path</span><span class="s0">, </span><span class="s2">&quot;table&quot;</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">result = read_hdf(path</span><span class="s0">, </span><span class="s2">&quot;table&quot;</span><span class="s0">, </span><span class="s1">where=[</span><span class="s2">&quot;index&gt;2&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_frame_equal(df[df.index &gt; </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">result)</span>


<span class="s0">def </span><span class="s1">test_long_strings(setup_path):</span>

    <span class="s3"># GH6166</span>
    <span class="s1">df = DataFrame(</span>
        <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: tm.rands_array(</span><span class="s4">100</span><span class="s0">, </span><span class="s1">size=</span><span class="s4">10</span><span class="s1">)}</span><span class="s0">, </span><span class="s1">index=tm.rands_array(</span><span class="s4">100</span><span class="s0">, </span><span class="s1">size=</span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">)</span>

    <span class="s0">with </span><span class="s1">ensure_clean_store(setup_path) </span><span class="s0">as </span><span class="s1">store:</span>
        <span class="s1">store.append(</span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">df</span><span class="s0">, </span><span class="s1">data_columns=[</span><span class="s2">&quot;a&quot;</span><span class="s1">])</span>

        <span class="s1">result = store.select(</span><span class="s2">&quot;df&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">result)</span>


<span class="s0">def </span><span class="s1">test_api(setup_path):</span>

    <span class="s3"># GH4584</span>
    <span class="s3"># API issue when to_hdf doesn't accept append AND format args</span>
    <span class="s0">with </span><span class="s1">ensure_clean_path(setup_path) </span><span class="s0">as </span><span class="s1">path:</span>

        <span class="s1">df = tm.makeDataFrame()</span>
        <span class="s1">df.iloc[:</span><span class="s4">10</span><span class="s1">].to_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">True, </span><span class="s1">format=</span><span class="s2">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">df.iloc[</span><span class="s4">10</span><span class="s1">:].to_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">True, </span><span class="s1">format=</span><span class="s2">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(read_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">df)</span>

        <span class="s3"># append to False</span>
        <span class="s1">df.iloc[:</span><span class="s4">10</span><span class="s1">].to_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">False, </span><span class="s1">format=</span><span class="s2">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">df.iloc[</span><span class="s4">10</span><span class="s1">:].to_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">True, </span><span class="s1">format=</span><span class="s2">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(read_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">df)</span>

    <span class="s0">with </span><span class="s1">ensure_clean_path(setup_path) </span><span class="s0">as </span><span class="s1">path:</span>

        <span class="s1">df = tm.makeDataFrame()</span>
        <span class="s1">df.iloc[:</span><span class="s4">10</span><span class="s1">].to_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">df.iloc[</span><span class="s4">10</span><span class="s1">:].to_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">True, </span><span class="s1">format=</span><span class="s2">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(read_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">df)</span>

        <span class="s3"># append to False</span>
        <span class="s1">df.iloc[:</span><span class="s4">10</span><span class="s1">].to_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">False, </span><span class="s1">format=</span><span class="s2">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">df.iloc[</span><span class="s4">10</span><span class="s1">:].to_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(read_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">df)</span>

    <span class="s0">with </span><span class="s1">ensure_clean_path(setup_path) </span><span class="s0">as </span><span class="s1">path:</span>

        <span class="s1">df = tm.makeDataFrame()</span>
        <span class="s1">df.to_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">False, </span><span class="s1">format=</span><span class="s2">&quot;fixed&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(read_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">df)</span>

        <span class="s1">df.to_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">False, </span><span class="s1">format=</span><span class="s2">&quot;f&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(read_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">df)</span>

        <span class="s1">df.to_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(read_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">df)</span>

        <span class="s1">df.to_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(read_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">df)</span>

    <span class="s0">with </span><span class="s1">ensure_clean_store(setup_path) </span><span class="s0">as </span><span class="s1">store:</span>

        <span class="s1">df = tm.makeDataFrame()</span>

        <span class="s1">_maybe_remove(store</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s1">)</span>
        <span class="s1">store.append(</span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">df.iloc[:</span><span class="s4">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">True, </span><span class="s1">format=</span><span class="s2">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">store.append(</span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">df.iloc[</span><span class="s4">10</span><span class="s1">:]</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">True, </span><span class="s1">format=</span><span class="s2">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(store.select(</span><span class="s2">&quot;df&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">df)</span>

        <span class="s3"># append to False</span>
        <span class="s1">_maybe_remove(store</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s1">)</span>
        <span class="s1">store.append(</span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">df.iloc[:</span><span class="s4">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">False, </span><span class="s1">format=</span><span class="s2">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">store.append(</span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">df.iloc[</span><span class="s4">10</span><span class="s1">:]</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">True, </span><span class="s1">format=</span><span class="s2">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(store.select(</span><span class="s2">&quot;df&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">df)</span>

        <span class="s3"># formats</span>
        <span class="s1">_maybe_remove(store</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s1">)</span>
        <span class="s1">store.append(</span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">df.iloc[:</span><span class="s4">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">False, </span><span class="s1">format=</span><span class="s2">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">store.append(</span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">df.iloc[</span><span class="s4">10</span><span class="s1">:]</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">True, </span><span class="s1">format=</span><span class="s2">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(store.select(</span><span class="s2">&quot;df&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">df)</span>

        <span class="s1">_maybe_remove(store</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s1">)</span>
        <span class="s1">store.append(</span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">df.iloc[:</span><span class="s4">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">False, </span><span class="s1">format=</span><span class="s2">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">store.append(</span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">df.iloc[</span><span class="s4">10</span><span class="s1">:]</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">True, </span><span class="s1">format=</span><span class="s0">None</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(store.select(</span><span class="s2">&quot;df&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">df)</span>

    <span class="s0">with </span><span class="s1">ensure_clean_path(setup_path) </span><span class="s0">as </span><span class="s1">path:</span>
        <span class="s3"># Invalid.</span>
        <span class="s1">df = tm.makeDataFrame()</span>

        <span class="s1">msg = </span><span class="s2">&quot;Can only append to Tables&quot;</span>

        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">df.to_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">True, </span><span class="s1">format=</span><span class="s2">&quot;f&quot;</span><span class="s1">)</span>

        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">df.to_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">True, </span><span class="s1">format=</span><span class="s2">&quot;fixed&quot;</span><span class="s1">)</span>

        <span class="s1">msg = </span><span class="s2">r&quot;invalid HDFStore format specified \[foo\]&quot;</span>

        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">df.to_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">True, </span><span class="s1">format=</span><span class="s2">&quot;foo&quot;</span><span class="s1">)</span>

        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">df.to_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">append=</span><span class="s0">False, </span><span class="s1">format=</span><span class="s2">&quot;foo&quot;</span><span class="s1">)</span>

    <span class="s3"># File path doesn't exist</span>
    <span class="s1">path = </span><span class="s2">&quot;&quot;</span>
    <span class="s1">msg = </span><span class="s2">f&quot;File </span><span class="s0">{</span><span class="s1">path</span><span class="s0">} </span><span class="s2">does not exist&quot;</span>

    <span class="s0">with </span><span class="s1">pytest.raises(FileNotFoundError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">read_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_get(setup_path):</span>

    <span class="s0">with </span><span class="s1">ensure_clean_store(setup_path) </span><span class="s0">as </span><span class="s1">store:</span>
        <span class="s1">store[</span><span class="s2">&quot;a&quot;</span><span class="s1">] = tm.makeTimeSeries()</span>
        <span class="s1">left = store.get(</span><span class="s2">&quot;a&quot;</span><span class="s1">)</span>
        <span class="s1">right = store[</span><span class="s2">&quot;a&quot;</span><span class="s1">]</span>
        <span class="s1">tm.assert_series_equal(left</span><span class="s0">, </span><span class="s1">right)</span>

        <span class="s1">left = store.get(</span><span class="s2">&quot;/a&quot;</span><span class="s1">)</span>
        <span class="s1">right = store[</span><span class="s2">&quot;/a&quot;</span><span class="s1">]</span>
        <span class="s1">tm.assert_series_equal(left</span><span class="s0">, </span><span class="s1">right)</span>

        <span class="s0">with </span><span class="s1">pytest.raises(KeyError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;'No object named b in the file'&quot;</span><span class="s1">):</span>
            <span class="s1">store.get(</span><span class="s2">&quot;b&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_put_integer(setup_path):</span>
    <span class="s3"># non-date, non-string index</span>
    <span class="s1">df = DataFrame(np.random.randn(</span><span class="s4">50</span><span class="s0">, </span><span class="s4">100</span><span class="s1">))</span>
    <span class="s1">_check_roundtrip(df</span><span class="s0">, </span><span class="s1">tm.assert_frame_equal</span><span class="s0">, </span><span class="s1">setup_path)</span>


<span class="s0">def </span><span class="s1">test_table_values_dtypes_roundtrip(setup_path):</span>

    <span class="s0">with </span><span class="s1">ensure_clean_store(setup_path) </span><span class="s0">as </span><span class="s1">store:</span>
        <span class="s1">df1 = DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;f8&quot;</span><span class="s1">)</span>
        <span class="s1">store.append(</span><span class="s2">&quot;df_f8&quot;</span><span class="s0">, </span><span class="s1">df1)</span>
        <span class="s1">tm.assert_series_equal(df1.dtypes</span><span class="s0">, </span><span class="s1">store[</span><span class="s2">&quot;df_f8&quot;</span><span class="s1">].dtypes)</span>

        <span class="s1">df2 = DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;i8&quot;</span><span class="s1">)</span>
        <span class="s1">store.append(</span><span class="s2">&quot;df_i8&quot;</span><span class="s0">, </span><span class="s1">df2)</span>
        <span class="s1">tm.assert_series_equal(df2.dtypes</span><span class="s0">, </span><span class="s1">store[</span><span class="s2">&quot;df_i8&quot;</span><span class="s1">].dtypes)</span>

        <span class="s3"># incompatible dtype</span>
        <span class="s1">msg = re.escape(</span>
            <span class="s2">&quot;invalid combination of [values_axes] on appending data &quot;</span>
            <span class="s2">&quot;[name-&gt;values_block_0,cname-&gt;values_block_0,&quot;</span>
            <span class="s2">&quot;dtype-&gt;float64,kind-&gt;float,shape-&gt;(1, 3)] vs &quot;</span>
            <span class="s2">&quot;current table [name-&gt;values_block_0,&quot;</span>
            <span class="s2">&quot;cname-&gt;values_block_0,dtype-&gt;int64,kind-&gt;integer,&quot;</span>
            <span class="s2">&quot;shape-&gt;None]&quot;</span>
        <span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">store.append(</span><span class="s2">&quot;df_i8&quot;</span><span class="s0">, </span><span class="s1">df1)</span>

        <span class="s3"># check creation/storage/retrieval of float32 (a bit hacky to</span>
        <span class="s3"># actually create them thought)</span>
        <span class="s1">df1 = DataFrame(np.array([[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;f4&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s2">&quot;A&quot;</span><span class="s1">])</span>
        <span class="s1">store.append(</span><span class="s2">&quot;df_f4&quot;</span><span class="s0">, </span><span class="s1">df1)</span>
        <span class="s1">tm.assert_series_equal(df1.dtypes</span><span class="s0">, </span><span class="s1">store[</span><span class="s2">&quot;df_f4&quot;</span><span class="s1">].dtypes)</span>
        <span class="s0">assert </span><span class="s1">df1.dtypes[</span><span class="s4">0</span><span class="s1">] == </span><span class="s2">&quot;float32&quot;</span>

        <span class="s3"># check with mixed dtypes</span>
        <span class="s1">df1 = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s1">c: Series(np.random.randint(</span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=c)</span>
                <span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">[</span><span class="s2">&quot;float32&quot;</span><span class="s0">, </span><span class="s2">&quot;float64&quot;</span><span class="s0">, </span><span class="s2">&quot;int32&quot;</span><span class="s0">, </span><span class="s2">&quot;int64&quot;</span><span class="s0">, </span><span class="s2">&quot;int16&quot;</span><span class="s0">, </span><span class="s2">&quot;int8&quot;</span><span class="s1">]</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
        <span class="s1">df1[</span><span class="s2">&quot;string&quot;</span><span class="s1">] = </span><span class="s2">&quot;foo&quot;</span>
        <span class="s1">df1[</span><span class="s2">&quot;float322&quot;</span><span class="s1">] = </span><span class="s4">1.0</span>
        <span class="s1">df1[</span><span class="s2">&quot;float322&quot;</span><span class="s1">] = df1[</span><span class="s2">&quot;float322&quot;</span><span class="s1">].astype(</span><span class="s2">&quot;float32&quot;</span><span class="s1">)</span>
        <span class="s1">df1[</span><span class="s2">&quot;bool&quot;</span><span class="s1">] = df1[</span><span class="s2">&quot;float32&quot;</span><span class="s1">] &gt; </span><span class="s4">0</span>
        <span class="s1">df1[</span><span class="s2">&quot;time1&quot;</span><span class="s1">] = Timestamp(</span><span class="s2">&quot;20130101&quot;</span><span class="s1">)</span>
        <span class="s1">df1[</span><span class="s2">&quot;time2&quot;</span><span class="s1">] = Timestamp(</span><span class="s2">&quot;20130102&quot;</span><span class="s1">)</span>

        <span class="s1">store.append(</span><span class="s2">&quot;df_mixed_dtypes1&quot;</span><span class="s0">, </span><span class="s1">df1)</span>
        <span class="s1">result = store.select(</span><span class="s2">&quot;df_mixed_dtypes1&quot;</span><span class="s1">).dtypes.value_counts()</span>
        <span class="s1">result.index = [str(i) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">result.index]</span>
        <span class="s1">expected = Series(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;float32&quot;</span><span class="s1">: </span><span class="s4">2</span><span class="s0">,</span>
                <span class="s2">&quot;float64&quot;</span><span class="s1">: </span><span class="s4">1</span><span class="s0">,</span>
                <span class="s2">&quot;int32&quot;</span><span class="s1">: </span><span class="s4">1</span><span class="s0">,</span>
                <span class="s2">&quot;bool&quot;</span><span class="s1">: </span><span class="s4">1</span><span class="s0">,</span>
                <span class="s2">&quot;int16&quot;</span><span class="s1">: </span><span class="s4">1</span><span class="s0">,</span>
                <span class="s2">&quot;int8&quot;</span><span class="s1">: </span><span class="s4">1</span><span class="s0">,</span>
                <span class="s2">&quot;int64&quot;</span><span class="s1">: </span><span class="s4">1</span><span class="s0">,</span>
                <span class="s2">&quot;object&quot;</span><span class="s1">: </span><span class="s4">1</span><span class="s0">,</span>
                <span class="s2">&quot;datetime64[ns]&quot;</span><span class="s1">: </span><span class="s4">2</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
        <span class="s1">result = result.sort_index()</span>
        <span class="s1">expected = expected.sort_index()</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_series(setup_path):</span>

    <span class="s1">s = tm.makeStringSeries()</span>
    <span class="s1">_check_roundtrip(s</span><span class="s0">, </span><span class="s1">tm.assert_series_equal</span><span class="s0">, </span><span class="s1">path=setup_path)</span>

    <span class="s1">ts = tm.makeTimeSeries()</span>
    <span class="s1">_check_roundtrip(ts</span><span class="s0">, </span><span class="s1">tm.assert_series_equal</span><span class="s0">, </span><span class="s1">path=setup_path)</span>

    <span class="s1">ts2 = Series(ts.index</span><span class="s0">, </span><span class="s1">Index(ts.index</span><span class="s0">, </span><span class="s1">dtype=object))</span>
    <span class="s1">_check_roundtrip(ts2</span><span class="s0">, </span><span class="s1">tm.assert_series_equal</span><span class="s0">, </span><span class="s1">path=setup_path)</span>

    <span class="s1">ts3 = Series(ts.values</span><span class="s0">, </span><span class="s1">Index(np.asarray(ts.index</span><span class="s0">, </span><span class="s1">dtype=object)</span><span class="s0">, </span><span class="s1">dtype=object))</span>
    <span class="s1">_check_roundtrip(</span>
        <span class="s1">ts3</span><span class="s0">, </span><span class="s1">tm.assert_series_equal</span><span class="s0">, </span><span class="s1">path=setup_path</span><span class="s0">, </span><span class="s1">check_index_type=</span><span class="s0">False</span>
    <span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_float_index(setup_path):</span>

    <span class="s3"># GH #454</span>
    <span class="s1">index = np.random.randn(</span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">s = Series(np.random.randn(</span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=index)</span>
    <span class="s1">_check_roundtrip(s</span><span class="s0">, </span><span class="s1">tm.assert_series_equal</span><span class="s0">, </span><span class="s1">path=setup_path)</span>


<span class="s0">def </span><span class="s1">test_tuple_index(setup_path):</span>

    <span class="s3"># GH #492</span>
    <span class="s1">col = np.arange(</span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">idx = [(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2.0</span><span class="s0">, </span><span class="s4">3.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">4.0</span><span class="s0">, </span><span class="s4">5.0</span><span class="s1">)]</span>
    <span class="s1">data = np.random.randn(</span><span class="s4">30</span><span class="s1">).reshape((</span><span class="s4">3</span><span class="s0">, </span><span class="s4">10</span><span class="s1">))</span>
    <span class="s1">DF = DataFrame(data</span><span class="s0">, </span><span class="s1">index=idx</span><span class="s0">, </span><span class="s1">columns=col)</span>

    <span class="s0">with </span><span class="s1">catch_warnings(record=</span><span class="s0">True</span><span class="s1">):</span>
        <span class="s1">simplefilter(</span><span class="s2">&quot;ignore&quot;</span><span class="s0">, </span><span class="s1">pd.errors.PerformanceWarning)</span>
        <span class="s1">_check_roundtrip(DF</span><span class="s0">, </span><span class="s1">tm.assert_frame_equal</span><span class="s0">, </span><span class="s1">path=setup_path)</span>


<span class="s1">@pytest.mark.filterwarnings(</span><span class="s2">&quot;ignore::pandas.errors.PerformanceWarning&quot;</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_index_types(setup_path):</span>
    <span class="s0">with </span><span class="s1">catch_warnings(record=</span><span class="s0">True</span><span class="s1">):</span>
        <span class="s1">values = np.random.randn(</span><span class="s4">2</span><span class="s1">)</span>

        <span class="s1">func = </span><span class="s0">lambda </span><span class="s1">l</span><span class="s0">, </span><span class="s1">r: tm.assert_series_equal(l</span><span class="s0">, </span><span class="s1">r</span><span class="s0">, </span><span class="s1">check_index_type=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s0">with </span><span class="s1">catch_warnings(record=</span><span class="s0">True</span><span class="s1">):</span>
        <span class="s1">ser = Series(values</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s2">&quot;y&quot;</span><span class="s1">])</span>
        <span class="s1">_check_roundtrip(ser</span><span class="s0">, </span><span class="s1">func</span><span class="s0">, </span><span class="s1">path=setup_path)</span>

    <span class="s0">with </span><span class="s1">catch_warnings(record=</span><span class="s0">True</span><span class="s1">):</span>
        <span class="s1">ser = Series(values</span><span class="s0">, </span><span class="s1">[datetime.datetime.today()</span><span class="s0">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">_check_roundtrip(ser</span><span class="s0">, </span><span class="s1">func</span><span class="s0">, </span><span class="s1">path=setup_path)</span>

    <span class="s0">with </span><span class="s1">catch_warnings(record=</span><span class="s0">True</span><span class="s1">):</span>
        <span class="s1">ser = Series(values</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;y&quot;</span><span class="s0">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">_check_roundtrip(ser</span><span class="s0">, </span><span class="s1">func</span><span class="s0">, </span><span class="s1">path=setup_path)</span>

    <span class="s0">with </span><span class="s1">catch_warnings(record=</span><span class="s0">True</span><span class="s1">):</span>
        <span class="s1">ser = Series(values</span><span class="s0">, </span><span class="s1">[datetime.date.today()</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">])</span>
        <span class="s1">_check_roundtrip(ser</span><span class="s0">, </span><span class="s1">func</span><span class="s0">, </span><span class="s1">path=setup_path)</span>

    <span class="s0">with </span><span class="s1">catch_warnings(record=</span><span class="s0">True</span><span class="s1">):</span>
        <span class="s1">ser = Series(values</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s2">&quot;y&quot;</span><span class="s1">])</span>
        <span class="s1">_check_roundtrip(ser</span><span class="s0">, </span><span class="s1">func</span><span class="s0">, </span><span class="s1">path=setup_path)</span>

        <span class="s1">ser = Series(values</span><span class="s0">, </span><span class="s1">[datetime.datetime.today()</span><span class="s0">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">_check_roundtrip(ser</span><span class="s0">, </span><span class="s1">func</span><span class="s0">, </span><span class="s1">path=setup_path)</span>

        <span class="s1">ser = Series(values</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;y&quot;</span><span class="s0">, </span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">_check_roundtrip(ser</span><span class="s0">, </span><span class="s1">func</span><span class="s0">, </span><span class="s1">path=setup_path)</span>

        <span class="s1">ser = Series(values</span><span class="s0">, </span><span class="s1">[datetime.date.today()</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">])</span>
        <span class="s1">_check_roundtrip(ser</span><span class="s0">, </span><span class="s1">func</span><span class="s0">, </span><span class="s1">path=setup_path)</span>

        <span class="s1">ser = Series(values</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1.23</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">])</span>
        <span class="s1">_check_roundtrip(ser</span><span class="s0">, </span><span class="s1">func</span><span class="s0">, </span><span class="s1">path=setup_path)</span>

        <span class="s1">ser = Series(values</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1.53</span><span class="s1">])</span>
        <span class="s1">_check_roundtrip(ser</span><span class="s0">, </span><span class="s1">func</span><span class="s0">, </span><span class="s1">path=setup_path)</span>

        <span class="s1">ser = Series(values</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s1">])</span>
        <span class="s1">_check_roundtrip(ser</span><span class="s0">, </span><span class="s1">func</span><span class="s0">, </span><span class="s1">path=setup_path)</span>

        <span class="s1">ser = Series(</span>
            <span class="s1">values</span><span class="s0">, </span><span class="s1">[datetime.datetime(</span><span class="s4">2012</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">datetime.datetime(</span><span class="s4">2012</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)]</span>
        <span class="s1">)</span>
        <span class="s1">_check_roundtrip(ser</span><span class="s0">, </span><span class="s1">func</span><span class="s0">, </span><span class="s1">path=setup_path)</span>


<span class="s0">def </span><span class="s1">test_timeseries_preepoch(setup_path):</span>

    <span class="s1">dr = bdate_range(</span><span class="s2">&quot;1/1/1940&quot;</span><span class="s0">, </span><span class="s2">&quot;1/1/1960&quot;</span><span class="s1">)</span>
    <span class="s1">ts = Series(np.random.randn(len(dr))</span><span class="s0">, </span><span class="s1">index=dr)</span>
    <span class="s0">try</span><span class="s1">:</span>
        <span class="s1">_check_roundtrip(ts</span><span class="s0">, </span><span class="s1">tm.assert_series_equal</span><span class="s0">, </span><span class="s1">path=setup_path)</span>
    <span class="s0">except </span><span class="s1">OverflowError:</span>
        <span class="s0">if </span><span class="s1">is_platform_windows():</span>
            <span class="s1">pytest.xfail(</span><span class="s2">&quot;known failure on some windows platforms&quot;</span><span class="s1">)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">raise</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;compression&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, </span><span class="s1">pytest.param(</span><span class="s0">True, </span><span class="s1">marks=td.skip_if_windows)]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_frame(compression</span><span class="s0">, </span><span class="s1">setup_path):</span>

    <span class="s1">df = tm.makeDataFrame()</span>

    <span class="s3"># put in some random NAs</span>
    <span class="s1">df.values[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">] = np.nan</span>
    <span class="s1">df.values[</span><span class="s4">5</span><span class="s0">, </span><span class="s4">3</span><span class="s1">] = np.nan</span>

    <span class="s1">_check_roundtrip_table(</span>
        <span class="s1">df</span><span class="s0">, </span><span class="s1">tm.assert_frame_equal</span><span class="s0">, </span><span class="s1">path=setup_path</span><span class="s0">, </span><span class="s1">compression=compression</span>
    <span class="s1">)</span>
    <span class="s1">_check_roundtrip(</span>
        <span class="s1">df</span><span class="s0">, </span><span class="s1">tm.assert_frame_equal</span><span class="s0">, </span><span class="s1">path=setup_path</span><span class="s0">, </span><span class="s1">compression=compression</span>
    <span class="s1">)</span>

    <span class="s1">tdf = tm.makeTimeDataFrame()</span>
    <span class="s1">_check_roundtrip(</span>
        <span class="s1">tdf</span><span class="s0">, </span><span class="s1">tm.assert_frame_equal</span><span class="s0">, </span><span class="s1">path=setup_path</span><span class="s0">, </span><span class="s1">compression=compression</span>
    <span class="s1">)</span>

    <span class="s0">with </span><span class="s1">ensure_clean_store(setup_path) </span><span class="s0">as </span><span class="s1">store:</span>
        <span class="s3"># not consolidated</span>
        <span class="s1">df[</span><span class="s2">&quot;foo&quot;</span><span class="s1">] = np.random.randn(len(df))</span>
        <span class="s1">store[</span><span class="s2">&quot;df&quot;</span><span class="s1">] = df</span>
        <span class="s1">recons = store[</span><span class="s2">&quot;df&quot;</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">recons._mgr.is_consolidated()</span>

    <span class="s3"># empty</span>
    <span class="s1">_check_roundtrip(df[:</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tm.assert_frame_equal</span><span class="s0">, </span><span class="s1">path=setup_path)</span>


<span class="s0">def </span><span class="s1">test_empty_series_frame(setup_path):</span>
    <span class="s1">s0 = Series(dtype=object)</span>
    <span class="s1">s1 = Series(name=</span><span class="s2">&quot;myseries&quot;</span><span class="s0">, </span><span class="s1">dtype=object)</span>
    <span class="s1">df0 = DataFrame()</span>
    <span class="s1">df1 = DataFrame(index=[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">])</span>
    <span class="s1">df2 = DataFrame(columns=[</span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s2">&quot;e&quot;</span><span class="s0">, </span><span class="s2">&quot;f&quot;</span><span class="s1">])</span>

    <span class="s1">_check_roundtrip(s0</span><span class="s0">, </span><span class="s1">tm.assert_series_equal</span><span class="s0">, </span><span class="s1">path=setup_path)</span>
    <span class="s1">_check_roundtrip(s1</span><span class="s0">, </span><span class="s1">tm.assert_series_equal</span><span class="s0">, </span><span class="s1">path=setup_path)</span>
    <span class="s1">_check_roundtrip(df0</span><span class="s0">, </span><span class="s1">tm.assert_frame_equal</span><span class="s0">, </span><span class="s1">path=setup_path)</span>
    <span class="s1">_check_roundtrip(df1</span><span class="s0">, </span><span class="s1">tm.assert_frame_equal</span><span class="s0">, </span><span class="s1">path=setup_path)</span>
    <span class="s1">_check_roundtrip(df2</span><span class="s0">, </span><span class="s1">tm.assert_frame_equal</span><span class="s0">, </span><span class="s1">path=setup_path)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;dtype&quot;</span><span class="s0">, </span><span class="s1">[np.int64</span><span class="s0">, </span><span class="s1">np.float64</span><span class="s0">, </span><span class="s1">object</span><span class="s0">, </span><span class="s2">&quot;m8[ns]&quot;</span><span class="s0">, </span><span class="s2">&quot;M8[ns]&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_empty_series(dtype</span><span class="s0">, </span><span class="s1">setup_path):</span>
    <span class="s1">s = Series(dtype=dtype)</span>
    <span class="s1">_check_roundtrip(s</span><span class="s0">, </span><span class="s1">tm.assert_series_equal</span><span class="s0">, </span><span class="s1">path=setup_path)</span>


<span class="s0">def </span><span class="s1">test_can_serialize_dates(setup_path):</span>

    <span class="s1">rng = [x.date() </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">bdate_range(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s2">&quot;1/30/2000&quot;</span><span class="s1">)]</span>
    <span class="s1">frame = DataFrame(np.random.randn(len(rng)</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=rng)</span>

    <span class="s1">_check_roundtrip(frame</span><span class="s0">, </span><span class="s1">tm.assert_frame_equal</span><span class="s0">, </span><span class="s1">path=setup_path)</span>


<span class="s0">def </span><span class="s1">test_store_hierarchical(setup_path</span><span class="s0">, </span><span class="s1">multiindex_dataframe_random_data):</span>
    <span class="s1">frame = multiindex_dataframe_random_data</span>

    <span class="s1">_check_roundtrip(frame</span><span class="s0">, </span><span class="s1">tm.assert_frame_equal</span><span class="s0">, </span><span class="s1">path=setup_path)</span>
    <span class="s1">_check_roundtrip(frame.T</span><span class="s0">, </span><span class="s1">tm.assert_frame_equal</span><span class="s0">, </span><span class="s1">path=setup_path)</span>
    <span class="s1">_check_roundtrip(frame[</span><span class="s2">&quot;A&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tm.assert_series_equal</span><span class="s0">, </span><span class="s1">path=setup_path)</span>

    <span class="s3"># check that the names are stored</span>
    <span class="s0">with </span><span class="s1">ensure_clean_store(setup_path) </span><span class="s0">as </span><span class="s1">store:</span>
        <span class="s1">store[</span><span class="s2">&quot;frame&quot;</span><span class="s1">] = frame</span>
        <span class="s1">recons = store[</span><span class="s2">&quot;frame&quot;</span><span class="s1">]</span>
        <span class="s1">tm.assert_frame_equal(recons</span><span class="s0">, </span><span class="s1">frame)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;compression&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, </span><span class="s1">pytest.param(</span><span class="s0">True, </span><span class="s1">marks=td.skip_if_windows)]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_store_mixed(compression</span><span class="s0">, </span><span class="s1">setup_path):</span>
    <span class="s0">def </span><span class="s1">_make_one():</span>
        <span class="s1">df = tm.makeDataFrame()</span>
        <span class="s1">df[</span><span class="s2">&quot;obj1&quot;</span><span class="s1">] = </span><span class="s2">&quot;foo&quot;</span>
        <span class="s1">df[</span><span class="s2">&quot;obj2&quot;</span><span class="s1">] = </span><span class="s2">&quot;bar&quot;</span>
        <span class="s1">df[</span><span class="s2">&quot;bool1&quot;</span><span class="s1">] = df[</span><span class="s2">&quot;A&quot;</span><span class="s1">] &gt; </span><span class="s4">0</span>
        <span class="s1">df[</span><span class="s2">&quot;bool2&quot;</span><span class="s1">] = df[</span><span class="s2">&quot;B&quot;</span><span class="s1">] &gt; </span><span class="s4">0</span>
        <span class="s1">df[</span><span class="s2">&quot;int1&quot;</span><span class="s1">] = </span><span class="s4">1</span>
        <span class="s1">df[</span><span class="s2">&quot;int2&quot;</span><span class="s1">] = </span><span class="s4">2</span>
        <span class="s0">return </span><span class="s1">df._consolidate()</span>

    <span class="s1">df1 = _make_one()</span>
    <span class="s1">df2 = _make_one()</span>

    <span class="s1">_check_roundtrip(df1</span><span class="s0">, </span><span class="s1">tm.assert_frame_equal</span><span class="s0">, </span><span class="s1">path=setup_path)</span>
    <span class="s1">_check_roundtrip(df2</span><span class="s0">, </span><span class="s1">tm.assert_frame_equal</span><span class="s0">, </span><span class="s1">path=setup_path)</span>

    <span class="s0">with </span><span class="s1">ensure_clean_store(setup_path) </span><span class="s0">as </span><span class="s1">store:</span>
        <span class="s1">store[</span><span class="s2">&quot;obj&quot;</span><span class="s1">] = df1</span>
        <span class="s1">tm.assert_frame_equal(store[</span><span class="s2">&quot;obj&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">df1)</span>
        <span class="s1">store[</span><span class="s2">&quot;obj&quot;</span><span class="s1">] = df2</span>
        <span class="s1">tm.assert_frame_equal(store[</span><span class="s2">&quot;obj&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">df2)</span>

    <span class="s3"># check that can store Series of all of these types</span>
    <span class="s1">_check_roundtrip(</span>
        <span class="s1">df1[</span><span class="s2">&quot;obj1&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">tm.assert_series_equal</span><span class="s0">,</span>
        <span class="s1">path=setup_path</span><span class="s0">,</span>
        <span class="s1">compression=compression</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">_check_roundtrip(</span>
        <span class="s1">df1[</span><span class="s2">&quot;bool1&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">tm.assert_series_equal</span><span class="s0">,</span>
        <span class="s1">path=setup_path</span><span class="s0">,</span>
        <span class="s1">compression=compression</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">_check_roundtrip(</span>
        <span class="s1">df1[</span><span class="s2">&quot;int1&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">tm.assert_series_equal</span><span class="s0">,</span>
        <span class="s1">path=setup_path</span><span class="s0">,</span>
        <span class="s1">compression=compression</span><span class="s0">,</span>
    <span class="s1">)</span>


<span class="s0">def </span><span class="s1">_check_roundtrip(obj</span><span class="s0">, </span><span class="s1">comparator</span><span class="s0">, </span><span class="s1">path</span><span class="s0">, </span><span class="s1">compression=</span><span class="s0">False, </span><span class="s1">**kwargs):</span>

    <span class="s1">options = {}</span>
    <span class="s0">if </span><span class="s1">compression:</span>
        <span class="s1">options[</span><span class="s2">&quot;complib&quot;</span><span class="s1">] = _default_compressor</span>

    <span class="s0">with </span><span class="s1">ensure_clean_store(path</span><span class="s0">, </span><span class="s2">&quot;w&quot;</span><span class="s0">, </span><span class="s1">**options) </span><span class="s0">as </span><span class="s1">store:</span>
        <span class="s1">store[</span><span class="s2">&quot;obj&quot;</span><span class="s1">] = obj</span>
        <span class="s1">retrieved = store[</span><span class="s2">&quot;obj&quot;</span><span class="s1">]</span>
        <span class="s1">comparator(retrieved</span><span class="s0">, </span><span class="s1">obj</span><span class="s0">, </span><span class="s1">**kwargs)</span>


<span class="s0">def </span><span class="s1">_check_double_roundtrip(self</span><span class="s0">, </span><span class="s1">obj</span><span class="s0">, </span><span class="s1">comparator</span><span class="s0">, </span><span class="s1">path</span><span class="s0">, </span><span class="s1">compression=</span><span class="s0">False, </span><span class="s1">**kwargs):</span>
    <span class="s1">options = {}</span>
    <span class="s0">if </span><span class="s1">compression:</span>
        <span class="s1">options[</span><span class="s2">&quot;complib&quot;</span><span class="s1">] = compression </span><span class="s0">or </span><span class="s1">_default_compressor</span>

    <span class="s0">with </span><span class="s1">ensure_clean_store(path</span><span class="s0">, </span><span class="s2">&quot;w&quot;</span><span class="s0">, </span><span class="s1">**options) </span><span class="s0">as </span><span class="s1">store:</span>
        <span class="s1">store[</span><span class="s2">&quot;obj&quot;</span><span class="s1">] = obj</span>
        <span class="s1">retrieved = store[</span><span class="s2">&quot;obj&quot;</span><span class="s1">]</span>
        <span class="s1">comparator(retrieved</span><span class="s0">, </span><span class="s1">obj</span><span class="s0">, </span><span class="s1">**kwargs)</span>
        <span class="s1">store[</span><span class="s2">&quot;obj&quot;</span><span class="s1">] = retrieved</span>
        <span class="s1">again = store[</span><span class="s2">&quot;obj&quot;</span><span class="s1">]</span>
        <span class="s1">comparator(again</span><span class="s0">, </span><span class="s1">obj</span><span class="s0">, </span><span class="s1">**kwargs)</span>


<span class="s0">def </span><span class="s1">_check_roundtrip_table(obj</span><span class="s0">, </span><span class="s1">comparator</span><span class="s0">, </span><span class="s1">path</span><span class="s0">, </span><span class="s1">compression=</span><span class="s0">False</span><span class="s1">):</span>
    <span class="s1">options = {}</span>
    <span class="s0">if </span><span class="s1">compression:</span>
        <span class="s1">options[</span><span class="s2">&quot;complib&quot;</span><span class="s1">] = _default_compressor</span>

    <span class="s0">with </span><span class="s1">ensure_clean_store(path</span><span class="s0">, </span><span class="s2">&quot;w&quot;</span><span class="s0">, </span><span class="s1">**options) </span><span class="s0">as </span><span class="s1">store:</span>
        <span class="s1">store.put(</span><span class="s2">&quot;obj&quot;</span><span class="s0">, </span><span class="s1">obj</span><span class="s0">, </span><span class="s1">format=</span><span class="s2">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">retrieved = store[</span><span class="s2">&quot;obj&quot;</span><span class="s1">]</span>

        <span class="s1">comparator(retrieved</span><span class="s0">, </span><span class="s1">obj)</span>


<span class="s0">def </span><span class="s1">test_unicode_index(setup_path):</span>

    <span class="s1">unicode_values = [</span><span class="s2">&quot;</span><span class="s0">\u03c3</span><span class="s2">&quot;</span><span class="s0">, </span><span class="s2">&quot;</span><span class="s0">\u03c3\u03c3</span><span class="s2">&quot;</span><span class="s1">]</span>

    <span class="s3"># PerformanceWarning</span>
    <span class="s0">with </span><span class="s1">catch_warnings(record=</span><span class="s0">True</span><span class="s1">):</span>
        <span class="s1">simplefilter(</span><span class="s2">&quot;ignore&quot;</span><span class="s0">, </span><span class="s1">pd.errors.PerformanceWarning)</span>
        <span class="s1">s = Series(np.random.randn(len(unicode_values))</span><span class="s0">, </span><span class="s1">unicode_values)</span>
        <span class="s1">_check_roundtrip(s</span><span class="s0">, </span><span class="s1">tm.assert_series_equal</span><span class="s0">, </span><span class="s1">path=setup_path)</span>


<span class="s0">def </span><span class="s1">test_unicode_longer_encoded(setup_path):</span>
    <span class="s3"># GH 11234</span>
    <span class="s1">char = </span><span class="s2">&quot;</span><span class="s0">\u0394</span><span class="s2">&quot;</span>
    <span class="s1">df = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: [char]})</span>
    <span class="s0">with </span><span class="s1">ensure_clean_store(setup_path) </span><span class="s0">as </span><span class="s1">store:</span>
        <span class="s1">store.put(</span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">df</span><span class="s0">, </span><span class="s1">format=</span><span class="s2">&quot;table&quot;</span><span class="s0">, </span><span class="s1">encoding=</span><span class="s2">&quot;utf-8&quot;</span><span class="s1">)</span>
        <span class="s1">result = store.get(</span><span class="s2">&quot;df&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">df)</span>

    <span class="s1">df = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s1">char]</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: [</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">]})</span>
    <span class="s0">with </span><span class="s1">ensure_clean_store(setup_path) </span><span class="s0">as </span><span class="s1">store:</span>
        <span class="s1">store.put(</span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">df</span><span class="s0">, </span><span class="s1">format=</span><span class="s2">&quot;table&quot;</span><span class="s0">, </span><span class="s1">encoding=</span><span class="s2">&quot;utf-8&quot;</span><span class="s1">)</span>
        <span class="s1">result = store.get(</span><span class="s2">&quot;df&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">df)</span>


<span class="s0">def </span><span class="s1">test_store_datetime_mixed(setup_path):</span>

    <span class="s1">df = DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">2.0</span><span class="s0">, </span><span class="s4">3.0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">: [</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">]})</span>
    <span class="s1">ts = tm.makeTimeSeries()</span>
    <span class="s1">df[</span><span class="s2">&quot;d&quot;</span><span class="s1">] = ts.index[:</span><span class="s4">3</span><span class="s1">]</span>
    <span class="s1">_check_roundtrip(df</span><span class="s0">, </span><span class="s1">tm.assert_frame_equal</span><span class="s0">, </span><span class="s1">path=setup_path)</span>


<span class="s0">def </span><span class="s1">test_round_trip_equals(setup_path):</span>
    <span class="s3"># GH 9330</span>
    <span class="s1">df = DataFrame({</span><span class="s2">&quot;B&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s2">&quot;y&quot;</span><span class="s1">]})</span>

    <span class="s0">with </span><span class="s1">ensure_clean_path(setup_path) </span><span class="s0">as </span><span class="s1">path:</span>
        <span class="s1">df.to_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s0">, </span><span class="s1">format=</span><span class="s2">&quot;table&quot;</span><span class="s1">)</span>
        <span class="s1">other = read_hdf(path</span><span class="s0">, </span><span class="s2">&quot;df&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">other)</span>
        <span class="s0">assert </span><span class="s1">df.equals(other)</span>
        <span class="s0">assert </span><span class="s1">other.equals(df)</span>
</pre>
</body>
</html>