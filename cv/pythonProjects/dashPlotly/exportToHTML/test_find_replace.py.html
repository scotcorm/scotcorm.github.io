<html>
<head>
<title>test_find_replace.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
.s5 { color: #a5c261;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_find_replace.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">datetime</span>
<span class="s0">import </span><span class="s1">re</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">Series</span><span class="s0">,</span>
    <span class="s1">_testing </span><span class="s0">as </span><span class="s1">tm</span><span class="s0">,</span>
<span class="s1">)</span>

<span class="s2"># --------------------------------------------------------------------------------------</span>
<span class="s2"># str.contains</span>
<span class="s2"># --------------------------------------------------------------------------------------</span>


<span class="s0">def </span><span class="s1">test_contains(any_string_dtype):</span>
    <span class="s1">values = np.array(</span>
        <span class="s1">[</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;fooommm__foo&quot;</span><span class="s0">, </span><span class="s3">&quot;mmm_&quot;</span><span class="s0">, </span><span class="s3">&quot;foommm[_]+bar&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.object_</span>
    <span class="s1">)</span>
    <span class="s1">values = Series(values</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">pat = </span><span class="s3">&quot;mmm[_]+&quot;</span>

    <span class="s1">result = values.str.contains(pat)</span>
    <span class="s1">expected_dtype = </span><span class="s3">&quot;object&quot; </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;boolean&quot;</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">np.array([</span><span class="s0">False, </span><span class="s1">np.nan</span><span class="s0">, True, True, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.object_)</span><span class="s0">,</span>
        <span class="s1">dtype=expected_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = values.str.contains(pat</span><span class="s0">, </span><span class="s1">regex=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">np.array([</span><span class="s0">False, </span><span class="s1">np.nan</span><span class="s0">, False, False, True</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.object_)</span><span class="s0">,</span>
        <span class="s1">dtype=expected_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">values = Series(</span>
        <span class="s1">np.array([</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;xyz&quot;</span><span class="s0">, </span><span class="s3">&quot;fooommm__foo&quot;</span><span class="s0">, </span><span class="s3">&quot;mmm_&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=object)</span><span class="s0">,</span>
        <span class="s1">dtype=any_string_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">result = values.str.contains(pat)</span>
    <span class="s1">expected_dtype = np.bool_ </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;boolean&quot;</span>
    <span class="s1">expected = Series(np.array([</span><span class="s0">False, False, True, True</span><span class="s1">])</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s2"># case insensitive using regex</span>
    <span class="s1">values = Series(</span>
        <span class="s1">np.array([</span><span class="s3">&quot;Foo&quot;</span><span class="s0">, </span><span class="s3">&quot;xYz&quot;</span><span class="s0">, </span><span class="s3">&quot;fOOomMm__fOo&quot;</span><span class="s0">, </span><span class="s3">&quot;MMM_&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=object)</span><span class="s0">,</span>
        <span class="s1">dtype=any_string_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">result = values.str.contains(</span><span class="s3">&quot;FOO|mmm&quot;</span><span class="s0">, </span><span class="s1">case=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">expected = Series(np.array([</span><span class="s0">True, False, True, True</span><span class="s1">])</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s2"># case insensitive without regex</span>
    <span class="s1">result = values.str.contains(</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">regex=</span><span class="s0">False, </span><span class="s1">case=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">expected = Series(np.array([</span><span class="s0">True, False, True, False</span><span class="s1">])</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s2"># unicode</span>
    <span class="s1">values = Series(</span>
        <span class="s1">np.array([</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;fooommm__foo&quot;</span><span class="s0">, </span><span class="s3">&quot;mmm_&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.object_)</span><span class="s0">,</span>
        <span class="s1">dtype=any_string_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">pat = </span><span class="s3">&quot;mmm[_]+&quot;</span>

    <span class="s1">result = values.str.contains(pat)</span>
    <span class="s1">expected_dtype = </span><span class="s3">&quot;object&quot; </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;boolean&quot;</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">np.array([</span><span class="s0">False, </span><span class="s1">np.nan</span><span class="s0">, True, True</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.object_)</span><span class="s0">, </span><span class="s1">dtype=expected_dtype</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = values.str.contains(pat</span><span class="s0">, </span><span class="s1">na=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">expected_dtype = np.bool_ </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;boolean&quot;</span>
    <span class="s1">expected = Series(np.array([</span><span class="s0">False, False, True, True</span><span class="s1">])</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">values = Series(</span>
        <span class="s1">np.array([</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;xyz&quot;</span><span class="s0">, </span><span class="s3">&quot;fooommm__foo&quot;</span><span class="s0">, </span><span class="s3">&quot;mmm_&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.object_)</span><span class="s0">,</span>
        <span class="s1">dtype=any_string_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">result = values.str.contains(pat)</span>
    <span class="s1">expected = Series(np.array([</span><span class="s0">False, False, True, True</span><span class="s1">])</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_contains_object_mixed():</span>
    <span class="s1">mixed = Series(</span>
        <span class="s1">np.array(</span>
            <span class="s1">[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, True, </span><span class="s1">datetime.today()</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s0">, None, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2.0</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">dtype=object</span><span class="s0">,</span>
        <span class="s1">)</span>
    <span class="s1">)</span>
    <span class="s1">result = mixed.str.contains(</span><span class="s3">&quot;o&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">np.array(</span>
            <span class="s1">[</span><span class="s0">False, </span><span class="s1">np.nan</span><span class="s0">, False, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, True, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">,</span>
            <span class="s1">dtype=np.object_</span><span class="s0">,</span>
        <span class="s1">)</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_contains_na_kwarg_for_object_category():</span>
    <span class="s2"># gh 22158</span>

    <span class="s2"># na for category</span>
    <span class="s1">values = Series([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;category&quot;</span><span class="s1">)</span>
    <span class="s1">result = values.str.contains(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">na=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s0">True, False, False, True, True</span><span class="s1">])</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = values.str.contains(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">na=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s0">True, False, False, True, False</span><span class="s1">])</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s2"># na for objects</span>
    <span class="s1">values = Series([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">np.nan])</span>
    <span class="s1">result = values.str.contains(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">na=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s0">True, False, False, True, True</span><span class="s1">])</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = values.str.contains(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">na=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s0">True, False, False, True, False</span><span class="s1">])</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;na, expected&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s0">None, </span><span class="s1">pd.NA)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s0">True, True</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s0">False, False</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">0</span><span class="s0">, False</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">3</span><span class="s0">, True</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(np.nan</span><span class="s0">, </span><span class="s1">pd.NA)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;regex&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_contains_na_kwarg_for_nullable_string_dtype(</span>
    <span class="s1">nullable_string_dtype</span><span class="s0">, </span><span class="s1">na</span><span class="s0">, </span><span class="s1">expected</span><span class="s0">, </span><span class="s1">regex</span>
<span class="s1">):</span>
    <span class="s2"># https://github.com/pandas-dev/pandas/pull/41025#issuecomment-824062416</span>

    <span class="s1">values = Series([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=nullable_string_dtype)</span>
    <span class="s1">result = values.str.contains(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">na=na</span><span class="s0">, </span><span class="s1">regex=regex)</span>
    <span class="s1">expected = Series([</span><span class="s0">True, False, False, True, </span><span class="s1">expected]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;boolean&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_contains_moar(any_string_dtype):</span>
    <span class="s2"># PR #1179</span>
    <span class="s1">s = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s3">&quot;C&quot;</span><span class="s0">, </span><span class="s3">&quot;Aaba&quot;</span><span class="s0">, </span><span class="s3">&quot;Baca&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;CABA&quot;</span><span class="s0">, </span><span class="s3">&quot;dog&quot;</span><span class="s0">, </span><span class="s3">&quot;cat&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">dtype=any_string_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s1">result = s.str.contains(</span><span class="s3">&quot;a&quot;</span><span class="s1">)</span>
    <span class="s1">expected_dtype = </span><span class="s3">&quot;object&quot; </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;boolean&quot;</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">[</span><span class="s0">False, False, False, True, True, False, </span><span class="s1">np.nan</span><span class="s0">, False, False, True</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">dtype=expected_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = s.str.contains(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">case=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">[</span><span class="s0">True, False, False, True, True, False, </span><span class="s1">np.nan</span><span class="s0">, True, False, True</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">dtype=expected_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = s.str.contains(</span><span class="s3">&quot;Aa&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">[</span><span class="s0">False, False, False, True, False, False, </span><span class="s1">np.nan</span><span class="s0">, False, False, False</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">dtype=expected_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = s.str.contains(</span><span class="s3">&quot;ba&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">[</span><span class="s0">False, False, False, True, False, False, </span><span class="s1">np.nan</span><span class="s0">, False, False, False</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">dtype=expected_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = s.str.contains(</span><span class="s3">&quot;ba&quot;</span><span class="s0">, </span><span class="s1">case=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">[</span><span class="s0">False, False, False, True, True, False, </span><span class="s1">np.nan</span><span class="s0">, True, False, False</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">dtype=expected_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_contains_nan(any_string_dtype):</span>
    <span class="s2"># PR #14171</span>
    <span class="s1">s = Series([np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>

    <span class="s1">result = s.str.contains(</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">na=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">expected_dtype = np.bool_ </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;boolean&quot;</span>
    <span class="s1">expected = Series([</span><span class="s0">False, False, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = s.str.contains(</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">na=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s0">True, True, True</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = s.str.contains(</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">na=</span><span class="s3">&quot;foo&quot;</span><span class="s1">)</span>
    <span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot;</span><span class="s1">:</span>
        <span class="s1">expected = Series([</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.object_)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">expected = Series([</span><span class="s0">True, True, True</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;boolean&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = s.str.contains(</span><span class="s3">&quot;foo&quot;</span><span class="s1">)</span>
    <span class="s1">expected_dtype = </span><span class="s3">&quot;object&quot; </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;boolean&quot;</span>
    <span class="s1">expected = Series([np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s2"># --------------------------------------------------------------------------------------</span>
<span class="s2"># str.startswith</span>
<span class="s2"># --------------------------------------------------------------------------------------</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;dtype&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s3">&quot;category&quot;</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;null_value&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">pd.NA])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;na&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_startswith(dtype</span><span class="s0">, </span><span class="s1">null_value</span><span class="s0">, </span><span class="s1">na):</span>
    <span class="s2"># add category dtype parametrizations for GH-36241</span>
    <span class="s1">values = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;om&quot;</span><span class="s0">, </span><span class="s1">null_value</span><span class="s0">, </span><span class="s3">&quot;foo_nom&quot;</span><span class="s0">, </span><span class="s3">&quot;nom&quot;</span><span class="s0">, </span><span class="s3">&quot;bar_foo&quot;</span><span class="s0">, </span><span class="s1">null_value</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">dtype=dtype</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s1">result = values.str.startswith(</span><span class="s3">&quot;foo&quot;</span><span class="s1">)</span>
    <span class="s1">exp = Series([</span><span class="s0">False, </span><span class="s1">np.nan</span><span class="s0">, True, False, False, </span><span class="s1">np.nan</span><span class="s0">, True</span><span class="s1">])</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">exp)</span>

    <span class="s1">result = values.str.startswith(</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">na=na)</span>
    <span class="s1">exp = Series([</span><span class="s0">False, </span><span class="s1">na</span><span class="s0">, True, False, False, </span><span class="s1">na</span><span class="s0">, True</span><span class="s1">])</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">exp)</span>

    <span class="s2"># mixed</span>
    <span class="s1">mixed = np.array(</span>
        <span class="s1">[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, True, </span><span class="s1">datetime.today()</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s0">, None, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2.0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">dtype=np.object_</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">rs = Series(mixed).str.startswith(</span><span class="s3">&quot;f&quot;</span><span class="s1">)</span>
    <span class="s1">xp = Series([</span><span class="s0">False, </span><span class="s1">np.nan</span><span class="s0">, False, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, True, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan])</span>
    <span class="s1">tm.assert_series_equal(rs</span><span class="s0">, </span><span class="s1">xp)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;na&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, True, False</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_startswith_nullable_string_dtype(nullable_string_dtype</span><span class="s0">, </span><span class="s1">na):</span>
    <span class="s1">values = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;om&quot;</span><span class="s0">, None, </span><span class="s3">&quot;foo_nom&quot;</span><span class="s0">, </span><span class="s3">&quot;nom&quot;</span><span class="s0">, </span><span class="s3">&quot;bar_foo&quot;</span><span class="s0">, None, </span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;regex&quot;</span><span class="s0">, </span><span class="s3">&quot;rege.&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">dtype=nullable_string_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">result = values.str.startswith(</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">na=na)</span>
    <span class="s1">exp = Series(</span>
        <span class="s1">[</span><span class="s0">False, </span><span class="s1">na</span><span class="s0">, True, False, False, </span><span class="s1">na</span><span class="s0">, True, False, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;boolean&quot;</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">exp)</span>

    <span class="s1">result = values.str.startswith(</span><span class="s3">&quot;rege.&quot;</span><span class="s0">, </span><span class="s1">na=na)</span>
    <span class="s1">exp = Series(</span>
        <span class="s1">[</span><span class="s0">False, </span><span class="s1">na</span><span class="s0">, False, False, False, </span><span class="s1">na</span><span class="s0">, False, False, True</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;boolean&quot;</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">exp)</span>


<span class="s2"># --------------------------------------------------------------------------------------</span>
<span class="s2"># str.endswith</span>
<span class="s2"># --------------------------------------------------------------------------------------</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;dtype&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s3">&quot;category&quot;</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;null_value&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">pd.NA])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;na&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_endswith(dtype</span><span class="s0">, </span><span class="s1">null_value</span><span class="s0">, </span><span class="s1">na):</span>
    <span class="s2"># add category dtype parametrizations for GH-36241</span>
    <span class="s1">values = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;om&quot;</span><span class="s0">, </span><span class="s1">null_value</span><span class="s0">, </span><span class="s3">&quot;foo_nom&quot;</span><span class="s0">, </span><span class="s3">&quot;nom&quot;</span><span class="s0">, </span><span class="s3">&quot;bar_foo&quot;</span><span class="s0">, </span><span class="s1">null_value</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">dtype=dtype</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s1">result = values.str.endswith(</span><span class="s3">&quot;foo&quot;</span><span class="s1">)</span>
    <span class="s1">exp = Series([</span><span class="s0">False, </span><span class="s1">np.nan</span><span class="s0">, False, False, True, </span><span class="s1">np.nan</span><span class="s0">, True</span><span class="s1">])</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">exp)</span>

    <span class="s1">result = values.str.endswith(</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">na=na)</span>
    <span class="s1">exp = Series([</span><span class="s0">False, </span><span class="s1">na</span><span class="s0">, False, False, True, </span><span class="s1">na</span><span class="s0">, True</span><span class="s1">])</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">exp)</span>

    <span class="s2"># mixed</span>
    <span class="s1">mixed = np.array(</span>
        <span class="s1">[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, True, </span><span class="s1">datetime.today()</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s0">, None, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2.0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">dtype=object</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">rs = Series(mixed).str.endswith(</span><span class="s3">&quot;f&quot;</span><span class="s1">)</span>
    <span class="s1">xp = Series([</span><span class="s0">False, </span><span class="s1">np.nan</span><span class="s0">, False, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, False, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan])</span>
    <span class="s1">tm.assert_series_equal(rs</span><span class="s0">, </span><span class="s1">xp)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;na&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, True, False</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_endswith_nullable_string_dtype(nullable_string_dtype</span><span class="s0">, </span><span class="s1">na):</span>
    <span class="s1">values = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;om&quot;</span><span class="s0">, None, </span><span class="s3">&quot;foo_nom&quot;</span><span class="s0">, </span><span class="s3">&quot;nom&quot;</span><span class="s0">, </span><span class="s3">&quot;bar_foo&quot;</span><span class="s0">, None, </span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;regex&quot;</span><span class="s0">, </span><span class="s3">&quot;rege.&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">dtype=nullable_string_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">result = values.str.endswith(</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">na=na)</span>
    <span class="s1">exp = Series(</span>
        <span class="s1">[</span><span class="s0">False, </span><span class="s1">na</span><span class="s0">, False, False, True, </span><span class="s1">na</span><span class="s0">, True, False, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;boolean&quot;</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">exp)</span>

    <span class="s1">result = values.str.endswith(</span><span class="s3">&quot;rege.&quot;</span><span class="s0">, </span><span class="s1">na=na)</span>
    <span class="s1">exp = Series(</span>
        <span class="s1">[</span><span class="s0">False, </span><span class="s1">na</span><span class="s0">, False, False, False, </span><span class="s1">na</span><span class="s0">, False, False, True</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;boolean&quot;</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">exp)</span>


<span class="s2"># --------------------------------------------------------------------------------------</span>
<span class="s2"># str.replace</span>
<span class="s2"># --------------------------------------------------------------------------------------</span>


<span class="s0">def </span><span class="s1">test_replace(any_string_dtype):</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;fooBAD__barBAD&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>

    <span class="s1">result = ser.str.replace(</span><span class="s3">&quot;BAD[_]*&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">regex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s3">&quot;foobar&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_replace_max_replacements(any_string_dtype):</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;fooBAD__barBAD&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>

    <span class="s1">expected = Series([</span><span class="s3">&quot;foobarBAD&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">result = ser.str.replace(</span><span class="s3">&quot;BAD[_]*&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">n=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">regex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">expected = Series([</span><span class="s3">&quot;foo__barBAD&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">result = ser.str.replace(</span><span class="s3">&quot;BAD&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">n=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">regex=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_replace_mixed_object():</span>
    <span class="s1">ser = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;aBAD&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;bBAD&quot;</span><span class="s0">, True, </span><span class="s1">datetime.today()</span><span class="s0">, </span><span class="s3">&quot;fooBAD&quot;</span><span class="s0">, None, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2.0</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">result = Series(ser).str.replace(</span><span class="s3">&quot;BAD[_]*&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">regex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan])</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_replace_unicode(any_string_dtype):</span>
    <span class="s1">ser = Series([</span><span class="s5">b&quot;abcd,</span><span class="s0">\xc3\xa0</span><span class="s5">&quot;</span><span class="s1">.decode(</span><span class="s3">&quot;utf-8&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">expected = Series([</span><span class="s5">b&quot;abcd, </span><span class="s0">\xc3\xa0</span><span class="s5">&quot;</span><span class="s1">.decode(</span><span class="s3">&quot;utf-8&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">result = ser.str.replace(</span><span class="s3">r&quot;(?&lt;=\w),(?=\w)&quot;</span><span class="s0">, </span><span class="s3">&quot;, &quot;</span><span class="s0">, </span><span class="s1">flags=re.UNICODE</span><span class="s0">, </span><span class="s1">regex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;repl&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s4">3</span><span class="s0">, </span><span class="s1">{</span><span class="s3">&quot;a&quot;</span><span class="s1">: </span><span class="s3">&quot;b&quot;</span><span class="s1">}])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;data&quot;</span><span class="s0">, </span><span class="s1">[[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, None</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;ad&quot;</span><span class="s1">]])</span>
<span class="s0">def </span><span class="s1">test_replace_wrong_repl_type_raises(any_string_dtype</span><span class="s0">, </span><span class="s1">index_or_series</span><span class="s0">, </span><span class="s1">repl</span><span class="s0">, </span><span class="s1">data):</span>
    <span class="s2"># https://github.com/pandas-dev/pandas/issues/13438</span>
    <span class="s1">msg = </span><span class="s3">&quot;repl must be a string or callable&quot;</span>
    <span class="s1">obj = index_or_series(data</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">obj.str.replace(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">repl)</span>


<span class="s0">def </span><span class="s1">test_replace_callable(any_string_dtype):</span>
    <span class="s2"># GH 15055</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;fooBAD__barBAD&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>

    <span class="s2"># test with callable</span>
    <span class="s1">repl = </span><span class="s0">lambda </span><span class="s1">m: m.group(</span><span class="s4">0</span><span class="s1">).swapcase()</span>
    <span class="s1">result = ser.str.replace(</span><span class="s3">&quot;[a-z][A-Z]{2}&quot;</span><span class="s0">, </span><span class="s1">repl</span><span class="s0">, </span><span class="s1">n=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">regex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s3">&quot;foObaD__baRbaD&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;repl&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">lambda</span><span class="s1">: </span><span class="s0">None, lambda </span><span class="s1">m</span><span class="s0">, </span><span class="s1">x: </span><span class="s0">None, lambda </span><span class="s1">m</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y=</span><span class="s0">None</span><span class="s1">: </span><span class="s0">None</span><span class="s1">]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_replace_callable_raises(any_string_dtype</span><span class="s0">, </span><span class="s1">repl):</span>
    <span class="s2"># GH 15055</span>
    <span class="s1">values = Series([</span><span class="s3">&quot;fooBAD__barBAD&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>

    <span class="s2"># test with wrong number of arguments, raising an error</span>
    <span class="s1">msg = (</span>
        <span class="s3">r&quot;((takes)|(missing)) (?(2)from \d+ to )?\d+ &quot;</span>
        <span class="s3">r&quot;(?(3)required )positional arguments?&quot;</span>
    <span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">values.str.replace(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">repl)</span>


<span class="s0">def </span><span class="s1">test_replace_callable_named_groups(any_string_dtype):</span>
    <span class="s2"># test regex named groups</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;Foo Bar Baz&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">pat = </span><span class="s3">r&quot;(?P&lt;first&gt;\w+) (?P&lt;middle&gt;\w+) (?P&lt;last&gt;\w+)&quot;</span>
    <span class="s1">repl = </span><span class="s0">lambda </span><span class="s1">m: m.group(</span><span class="s3">&quot;middle&quot;</span><span class="s1">).swapcase()</span>
    <span class="s1">result = ser.str.replace(pat</span><span class="s0">, </span><span class="s1">repl</span><span class="s0">, </span><span class="s1">regex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s3">&quot;bAR&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_replace_compiled_regex(any_string_dtype):</span>
    <span class="s2"># GH 15446</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;fooBAD__barBAD&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>

    <span class="s2"># test with compiled regex</span>
    <span class="s1">pat = re.compile(</span><span class="s3">r&quot;BAD_*&quot;</span><span class="s1">)</span>
    <span class="s1">result = ser.str.replace(pat</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">regex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s3">&quot;foobar&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ser.str.replace(pat</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">n=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">regex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s3">&quot;foobarBAD&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_replace_compiled_regex_mixed_object():</span>
    <span class="s1">pat = re.compile(</span><span class="s3">r&quot;BAD_*&quot;</span><span class="s1">)</span>
    <span class="s1">ser = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;aBAD&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;bBAD&quot;</span><span class="s0">, True, </span><span class="s1">datetime.today()</span><span class="s0">, </span><span class="s3">&quot;fooBAD&quot;</span><span class="s0">, None, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2.0</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">result = Series(ser).str.replace(pat</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">regex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan])</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_replace_compiled_regex_unicode(any_string_dtype):</span>
    <span class="s1">ser = Series([</span><span class="s5">b&quot;abcd,</span><span class="s0">\xc3\xa0</span><span class="s5">&quot;</span><span class="s1">.decode(</span><span class="s3">&quot;utf-8&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">expected = Series([</span><span class="s5">b&quot;abcd, </span><span class="s0">\xc3\xa0</span><span class="s5">&quot;</span><span class="s1">.decode(</span><span class="s3">&quot;utf-8&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">pat = re.compile(</span><span class="s3">r&quot;(?&lt;=\w),(?=\w)&quot;</span><span class="s0">, </span><span class="s1">flags=re.UNICODE)</span>
    <span class="s1">result = ser.str.replace(pat</span><span class="s0">, </span><span class="s3">&quot;, &quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_replace_compiled_regex_raises(any_string_dtype):</span>
    <span class="s2"># case and flags provided to str.replace will have no effect</span>
    <span class="s2"># and will produce warnings</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;fooBAD__barBAD__bad&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">pat = re.compile(</span><span class="s3">r&quot;BAD_*&quot;</span><span class="s1">)</span>

    <span class="s1">msg = </span><span class="s3">&quot;case and flags cannot be set when pat is a compiled regex&quot;</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">ser.str.replace(pat</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">flags=re.IGNORECASE)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">ser.str.replace(pat</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">case=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">ser.str.replace(pat</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">case=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_replace_compiled_regex_callable(any_string_dtype):</span>
    <span class="s2"># test with callable</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;fooBAD__barBAD&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">repl = </span><span class="s0">lambda </span><span class="s1">m: m.group(</span><span class="s4">0</span><span class="s1">).swapcase()</span>
    <span class="s1">pat = re.compile(</span><span class="s3">&quot;[a-z][A-Z]{2}&quot;</span><span class="s1">)</span>
    <span class="s1">result = ser.str.replace(pat</span><span class="s0">, </span><span class="s1">repl</span><span class="s0">, </span><span class="s1">n=</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s3">&quot;foObaD__baRbaD&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;regex,expected&quot;</span><span class="s0">, </span><span class="s1">[(</span><span class="s0">True, </span><span class="s1">[</span><span class="s3">&quot;bao&quot;</span><span class="s0">, </span><span class="s3">&quot;bao&quot;</span><span class="s0">, </span><span class="s1">np.nan])</span><span class="s0">, </span><span class="s1">(</span><span class="s0">False, </span><span class="s1">[</span><span class="s3">&quot;bao&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">np.nan])]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_replace_literal(regex</span><span class="s0">, </span><span class="s1">expected</span><span class="s0">, </span><span class="s1">any_string_dtype):</span>
    <span class="s2"># GH16808 literal replace (regex=False vs regex=True)</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;f.o&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">expected = Series(expected</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">result = ser.str.replace(</span><span class="s3">&quot;f.&quot;</span><span class="s0">, </span><span class="s3">&quot;ba&quot;</span><span class="s0">, </span><span class="s1">regex=regex)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_replace_literal_callable_raises(any_string_dtype):</span>
    <span class="s1">ser = Series([]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">repl = </span><span class="s0">lambda </span><span class="s1">m: m.group(</span><span class="s4">0</span><span class="s1">).swapcase()</span>

    <span class="s1">msg = </span><span class="s3">&quot;Cannot use a callable replacement when regex=False&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">ser.str.replace(</span><span class="s3">&quot;abc&quot;</span><span class="s0">, </span><span class="s1">repl</span><span class="s0">, </span><span class="s1">regex=</span><span class="s0">False</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_replace_literal_compiled_raises(any_string_dtype):</span>
    <span class="s1">ser = Series([]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">pat = re.compile(</span><span class="s3">&quot;[a-z][A-Z]{2}&quot;</span><span class="s1">)</span>

    <span class="s1">msg = </span><span class="s3">&quot;Cannot use a compiled regex as replacement pattern with regex=False&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">ser.str.replace(pat</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">regex=</span><span class="s0">False</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_replace_moar(any_string_dtype):</span>
    <span class="s2"># PR #1179</span>
    <span class="s1">ser = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s3">&quot;C&quot;</span><span class="s0">, </span><span class="s3">&quot;Aaba&quot;</span><span class="s0">, </span><span class="s3">&quot;Baca&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;CABA&quot;</span><span class="s0">, </span><span class="s3">&quot;dog&quot;</span><span class="s0">, </span><span class="s3">&quot;cat&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">dtype=any_string_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s1">result = ser.str.replace(</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;YYY&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;YYY&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s3">&quot;C&quot;</span><span class="s0">, </span><span class="s3">&quot;YYYaba&quot;</span><span class="s0">, </span><span class="s3">&quot;Baca&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;CYYYBYYY&quot;</span><span class="s0">, </span><span class="s3">&quot;dog&quot;</span><span class="s0">, </span><span class="s3">&quot;cat&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">dtype=any_string_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ser.str.replace(</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;YYY&quot;</span><span class="s0">, </span><span class="s1">case=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">[</span>
            <span class="s3">&quot;YYY&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;B&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;C&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;YYYYYYbYYY&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;BYYYcYYY&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;&quot;</span><span class="s0">,</span>
            <span class="s1">np.nan</span><span class="s0">,</span>
            <span class="s3">&quot;CYYYBYYY&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;dog&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;cYYYt&quot;</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
        <span class="s1">dtype=any_string_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ser.str.replace(</span><span class="s3">&quot;^.a|dog&quot;</span><span class="s0">, </span><span class="s3">&quot;XX-XX &quot;</span><span class="s0">, </span><span class="s1">case=</span><span class="s0">False, </span><span class="s1">regex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">[</span>
            <span class="s3">&quot;A&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;B&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;C&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;XX-XX ba&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;XX-XX ca&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;&quot;</span><span class="s0">,</span>
            <span class="s1">np.nan</span><span class="s0">,</span>
            <span class="s3">&quot;XX-XX BA&quot;</span><span class="s0">,</span>
            <span class="s3">&quot;XX-XX &quot;</span><span class="s0">,</span>
            <span class="s3">&quot;XX-XX t&quot;</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
        <span class="s1">dtype=any_string_dtype</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_replace_not_case_sensitive_not_regex(any_string_dtype):</span>
    <span class="s2"># https://github.com/pandas-dev/pandas/issues/41602</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;A.&quot;</span><span class="s0">, </span><span class="s3">&quot;a.&quot;</span><span class="s0">, </span><span class="s3">&quot;Ab&quot;</span><span class="s0">, </span><span class="s3">&quot;ab&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>

    <span class="s1">result = ser.str.replace(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s1">case=</span><span class="s0">False, </span><span class="s1">regex=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s3">&quot;c.&quot;</span><span class="s0">, </span><span class="s3">&quot;c.&quot;</span><span class="s0">, </span><span class="s3">&quot;cb&quot;</span><span class="s0">, </span><span class="s3">&quot;cb&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ser.str.replace(</span><span class="s3">&quot;a.&quot;</span><span class="s0">, </span><span class="s3">&quot;c.&quot;</span><span class="s0">, </span><span class="s1">case=</span><span class="s0">False, </span><span class="s1">regex=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s3">&quot;c.&quot;</span><span class="s0">, </span><span class="s3">&quot;c.&quot;</span><span class="s0">, </span><span class="s3">&quot;Ab&quot;</span><span class="s0">, </span><span class="s3">&quot;ab&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_replace_regex_default_warning(any_string_dtype):</span>
    <span class="s2"># https://github.com/pandas-dev/pandas/pull/24809</span>
    <span class="s1">s = Series([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;ac&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">msg = (</span>
        <span class="s3">&quot;The default value of regex will change from True to False in a &quot;</span>
        <span class="s3">&quot;future version</span><span class="s0">\\</span><span class="s3">.$&quot;</span>
    <span class="s1">)</span>
    <span class="s0">with </span><span class="s1">tm.assert_produces_warning(FutureWarning</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">result = s.str.replace(</span><span class="s3">&quot;^.$&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;ac&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;regex&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False, None</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_replace_regex_single_character(regex</span><span class="s0">, </span><span class="s1">any_string_dtype):</span>
    <span class="s2"># https://github.com/pandas-dev/pandas/pull/24809</span>

    <span class="s2"># The current behavior is to treat single character patterns as literal strings,</span>
    <span class="s2"># even when ``regex`` is set to ``True``.</span>

    <span class="s1">s = Series([</span><span class="s3">&quot;a.b&quot;</span><span class="s0">, </span><span class="s3">&quot;.&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>

    <span class="s0">if </span><span class="s1">regex </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s1">msg = re.escape(</span>
            <span class="s3">&quot;The default value of regex will change from True to False in a future &quot;</span>
            <span class="s3">&quot;version. In addition, single character regular expressions will *not* &quot;</span>
            <span class="s3">&quot;be treated as literal strings when regex=True.&quot;</span>
        <span class="s1">)</span>
        <span class="s0">with </span><span class="s1">tm.assert_produces_warning(FutureWarning</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">result = s.str.replace(</span><span class="s3">&quot;.&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">regex=regex)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">result = s.str.replace(</span><span class="s3">&quot;.&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">regex=regex)</span>

    <span class="s1">expected = Series([</span><span class="s3">&quot;aab&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s2"># --------------------------------------------------------------------------------------</span>
<span class="s2"># str.match</span>
<span class="s2"># --------------------------------------------------------------------------------------</span>


<span class="s0">def </span><span class="s1">test_match(any_string_dtype):</span>
    <span class="s2"># New match behavior introduced in 0.13</span>
    <span class="s1">expected_dtype = </span><span class="s3">&quot;object&quot; </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;boolean&quot;</span>

    <span class="s1">values = Series([</span><span class="s3">&quot;fooBAD__barBAD&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">result = values.str.match(</span><span class="s3">&quot;.*(BAD[_]+).*(BAD)&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s0">True, </span><span class="s1">np.nan</span><span class="s0">, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">values = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;fooBAD__barBAD&quot;</span><span class="s0">, </span><span class="s3">&quot;BAD_BADleroybrown&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype</span>
    <span class="s1">)</span>
    <span class="s1">result = values.str.match(</span><span class="s3">&quot;.*BAD[_]+.*BAD&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s0">True, True, </span><span class="s1">np.nan</span><span class="s0">, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = values.str.match(</span><span class="s3">&quot;BAD[_]+.*BAD&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s0">False, True, </span><span class="s1">np.nan</span><span class="s0">, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">values = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;fooBAD__barBAD&quot;</span><span class="s0">, </span><span class="s3">&quot;^BAD_BADleroybrown&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype</span>
    <span class="s1">)</span>
    <span class="s1">result = values.str.match(</span><span class="s3">&quot;^BAD[_]+.*BAD&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s0">False, False, </span><span class="s1">np.nan</span><span class="s0">, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = values.str.match(</span><span class="s3">&quot;</span><span class="s0">\\</span><span class="s3">^BAD[_]+.*BAD&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s0">False, True, </span><span class="s1">np.nan</span><span class="s0">, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_match_mixed_object():</span>
    <span class="s1">mixed = Series(</span>
        <span class="s1">[</span>
            <span class="s3">&quot;aBAD_BAD&quot;</span><span class="s0">,</span>
            <span class="s1">np.nan</span><span class="s0">,</span>
            <span class="s3">&quot;BAD_b_BAD&quot;</span><span class="s0">,</span>
            <span class="s0">True,</span>
            <span class="s1">datetime.today()</span><span class="s0">,</span>
            <span class="s3">&quot;foo&quot;</span><span class="s0">,</span>
            <span class="s0">None,</span>
            <span class="s4">1</span><span class="s0">,</span>
            <span class="s4">2.0</span><span class="s0">,</span>
        <span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">result = Series(mixed).str.match(</span><span class="s3">&quot;.*(BAD[_]+).*(BAD)&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">[</span><span class="s0">True, </span><span class="s1">np.nan</span><span class="s0">, True, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, False, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan]</span>
    <span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">isinstance(result</span><span class="s0">, </span><span class="s1">Series)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_match_na_kwarg(any_string_dtype):</span>
    <span class="s2"># GH #6609</span>
    <span class="s1">s = Series([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>

    <span class="s1">result = s.str.match(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">na=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">expected_dtype = np.bool_ </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;boolean&quot;</span>
    <span class="s1">expected = Series([</span><span class="s0">True, False, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = s.str.match(</span><span class="s3">&quot;a&quot;</span><span class="s1">)</span>
    <span class="s1">expected_dtype = </span><span class="s3">&quot;object&quot; </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;boolean&quot;</span>
    <span class="s1">expected = Series([</span><span class="s0">True, False, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_match_case_kwarg(any_string_dtype):</span>
    <span class="s1">values = Series([</span><span class="s3">&quot;ab&quot;</span><span class="s0">, </span><span class="s3">&quot;AB&quot;</span><span class="s0">, </span><span class="s3">&quot;abc&quot;</span><span class="s0">, </span><span class="s3">&quot;ABC&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">result = values.str.match(</span><span class="s3">&quot;ab&quot;</span><span class="s0">, </span><span class="s1">case=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">expected_dtype = np.bool_ </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;boolean&quot;</span>
    <span class="s1">expected = Series([</span><span class="s0">True, True, True, True</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s2"># --------------------------------------------------------------------------------------</span>
<span class="s2"># str.fullmatch</span>
<span class="s2"># --------------------------------------------------------------------------------------</span>


<span class="s0">def </span><span class="s1">test_fullmatch(any_string_dtype):</span>
    <span class="s2"># GH 32806</span>
    <span class="s1">ser = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;fooBAD__barBAD&quot;</span><span class="s0">, </span><span class="s3">&quot;BAD_BADleroybrown&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype</span>
    <span class="s1">)</span>
    <span class="s1">result = ser.str.fullmatch(</span><span class="s3">&quot;.*BAD[_]+.*BAD&quot;</span><span class="s1">)</span>
    <span class="s1">expected_dtype = </span><span class="s3">&quot;object&quot; </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;boolean&quot;</span>
    <span class="s1">expected = Series([</span><span class="s0">True, False, </span><span class="s1">np.nan</span><span class="s0">, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_fullmatch_na_kwarg(any_string_dtype):</span>
    <span class="s1">ser = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;fooBAD__barBAD&quot;</span><span class="s0">, </span><span class="s3">&quot;BAD_BADleroybrown&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype</span>
    <span class="s1">)</span>
    <span class="s1">result = ser.str.fullmatch(</span><span class="s3">&quot;.*BAD[_]+.*BAD&quot;</span><span class="s0">, </span><span class="s1">na=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">expected_dtype = np.bool_ </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;boolean&quot;</span>
    <span class="s1">expected = Series([</span><span class="s0">True, False, False, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_fullmatch_case_kwarg(any_string_dtype):</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;ab&quot;</span><span class="s0">, </span><span class="s3">&quot;AB&quot;</span><span class="s0">, </span><span class="s3">&quot;abc&quot;</span><span class="s0">, </span><span class="s3">&quot;ABC&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">expected_dtype = np.bool_ </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;boolean&quot;</span>

    <span class="s1">expected = Series([</span><span class="s0">True, False, False, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>

    <span class="s1">result = ser.str.fullmatch(</span><span class="s3">&quot;ab&quot;</span><span class="s0">, </span><span class="s1">case=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">expected = Series([</span><span class="s0">True, True, False, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>

    <span class="s1">result = ser.str.fullmatch(</span><span class="s3">&quot;ab&quot;</span><span class="s0">, </span><span class="s1">case=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ser.str.fullmatch(</span><span class="s3">&quot;ab&quot;</span><span class="s0">, </span><span class="s1">flags=re.IGNORECASE)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s2"># --------------------------------------------------------------------------------------</span>
<span class="s2"># str.findall</span>
<span class="s2"># --------------------------------------------------------------------------------------</span>


<span class="s0">def </span><span class="s1">test_findall(any_string_dtype):</span>
    <span class="s1">ser = Series([</span><span class="s3">&quot;fooBAD__barBAD&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;BAD&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s1">result = ser.str.findall(</span><span class="s3">&quot;BAD[_]*&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series([[</span><span class="s3">&quot;BAD__&quot;</span><span class="s0">, </span><span class="s3">&quot;BAD&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;BAD&quot;</span><span class="s1">]])</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_findall_mixed_object():</span>
    <span class="s1">ser = Series(</span>
        <span class="s1">[</span>
            <span class="s3">&quot;fooBAD__barBAD&quot;</span><span class="s0">,</span>
            <span class="s1">np.nan</span><span class="s0">,</span>
            <span class="s3">&quot;foo&quot;</span><span class="s0">,</span>
            <span class="s0">True,</span>
            <span class="s1">datetime.today()</span><span class="s0">,</span>
            <span class="s3">&quot;BAD&quot;</span><span class="s0">,</span>
            <span class="s0">None,</span>
            <span class="s4">1</span><span class="s0">,</span>
            <span class="s4">2.0</span><span class="s0">,</span>
        <span class="s1">]</span>
    <span class="s1">)</span>

    <span class="s1">result = ser.str.findall(</span><span class="s3">&quot;BAD[_]*&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series(</span>
        <span class="s1">[</span>
            <span class="s1">[</span><span class="s3">&quot;BAD__&quot;</span><span class="s0">, </span><span class="s3">&quot;BAD&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">np.nan</span><span class="s0">,</span>
            <span class="s1">[]</span><span class="s0">,</span>
            <span class="s1">np.nan</span><span class="s0">,</span>
            <span class="s1">np.nan</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s3">&quot;BAD&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">np.nan</span><span class="s0">,</span>
            <span class="s1">np.nan</span><span class="s0">,</span>
            <span class="s1">np.nan</span><span class="s0">,</span>
        <span class="s1">]</span>
    <span class="s1">)</span>

    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s2"># --------------------------------------------------------------------------------------</span>
<span class="s2"># str.find</span>
<span class="s2"># --------------------------------------------------------------------------------------</span>


<span class="s0">def </span><span class="s1">test_find(any_string_dtype):</span>
    <span class="s1">ser = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;ABCDEFG&quot;</span><span class="s0">, </span><span class="s3">&quot;BCDEFEF&quot;</span><span class="s0">, </span><span class="s3">&quot;DEFGHIJEF&quot;</span><span class="s0">, </span><span class="s3">&quot;EFGHEF&quot;</span><span class="s0">, </span><span class="s3">&quot;XXXX&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype</span>
    <span class="s1">)</span>
    <span class="s1">expected_dtype = np.int64 </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;Int64&quot;</span>

    <span class="s1">result = ser.str.find(</span><span class="s3">&quot;EF&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s4">4</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
    <span class="s1">expected = np.array([v.find(</span><span class="s3">&quot;EF&quot;</span><span class="s1">) </span><span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s1">np.array(ser)]</span><span class="s0">, </span><span class="s1">dtype=np.int64)</span>
    <span class="s1">tm.assert_numpy_array_equal(np.array(result</span><span class="s0">, </span><span class="s1">dtype=np.int64)</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ser.str.rfind(</span><span class="s3">&quot;EF&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
    <span class="s1">expected = np.array([v.rfind(</span><span class="s3">&quot;EF&quot;</span><span class="s1">) </span><span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s1">np.array(ser)]</span><span class="s0">, </span><span class="s1">dtype=np.int64)</span>
    <span class="s1">tm.assert_numpy_array_equal(np.array(result</span><span class="s0">, </span><span class="s1">dtype=np.int64)</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ser.str.find(</span><span class="s3">&quot;EF&quot;</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s4">4</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
    <span class="s1">expected = np.array([v.find(</span><span class="s3">&quot;EF&quot;</span><span class="s0">, </span><span class="s4">3</span><span class="s1">) </span><span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s1">np.array(ser)]</span><span class="s0">, </span><span class="s1">dtype=np.int64)</span>
    <span class="s1">tm.assert_numpy_array_equal(np.array(result</span><span class="s0">, </span><span class="s1">dtype=np.int64)</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ser.str.rfind(</span><span class="s3">&quot;EF&quot;</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
    <span class="s1">expected = np.array([v.rfind(</span><span class="s3">&quot;EF&quot;</span><span class="s0">, </span><span class="s4">3</span><span class="s1">) </span><span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s1">np.array(ser)]</span><span class="s0">, </span><span class="s1">dtype=np.int64)</span>
    <span class="s1">tm.assert_numpy_array_equal(np.array(result</span><span class="s0">, </span><span class="s1">dtype=np.int64)</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ser.str.find(</span><span class="s3">&quot;EF&quot;</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">6</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s4">4</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
    <span class="s1">expected = np.array([v.find(</span><span class="s3">&quot;EF&quot;</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">6</span><span class="s1">) </span><span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s1">np.array(ser)]</span><span class="s0">, </span><span class="s1">dtype=np.int64)</span>
    <span class="s1">tm.assert_numpy_array_equal(np.array(result</span><span class="s0">, </span><span class="s1">dtype=np.int64)</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ser.str.rfind(</span><span class="s3">&quot;EF&quot;</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">6</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s4">4</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
    <span class="s1">expected = np.array([v.rfind(</span><span class="s3">&quot;EF&quot;</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">6</span><span class="s1">) </span><span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s1">np.array(ser)]</span><span class="s0">, </span><span class="s1">dtype=np.int64)</span>
    <span class="s1">tm.assert_numpy_array_equal(np.array(result</span><span class="s0">, </span><span class="s1">dtype=np.int64)</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_find_bad_arg_raises(any_string_dtype):</span>
    <span class="s1">ser = Series([]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;expected a string object, not int&quot;</span><span class="s1">):</span>
        <span class="s1">ser.str.find(</span><span class="s4">0</span><span class="s1">)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;expected a string object, not int&quot;</span><span class="s1">):</span>
        <span class="s1">ser.str.rfind(</span><span class="s4">0</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_find_nan(any_string_dtype):</span>
    <span class="s1">ser = Series(</span>
        <span class="s1">[</span><span class="s3">&quot;ABCDEFG&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;DEFGHIJEF&quot;</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">&quot;XXXX&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype</span>
    <span class="s1">)</span>
    <span class="s1">expected_dtype = np.float64 </span><span class="s0">if </span><span class="s1">any_string_dtype == </span><span class="s3">&quot;object&quot; </span><span class="s0">else </span><span class="s3">&quot;Int64&quot;</span>

    <span class="s1">result = ser.str.find(</span><span class="s3">&quot;EF&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s4">4</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ser.str.rfind(</span><span class="s3">&quot;EF&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s4">4</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ser.str.find(</span><span class="s3">&quot;EF&quot;</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s4">4</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ser.str.rfind(</span><span class="s3">&quot;EF&quot;</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s4">4</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ser.str.find(</span><span class="s3">&quot;EF&quot;</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">6</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s4">4</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = ser.str.rfind(</span><span class="s3">&quot;EF&quot;</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">6</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s4">4</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s2"># --------------------------------------------------------------------------------------</span>
<span class="s2"># str.translate</span>
<span class="s2"># --------------------------------------------------------------------------------------</span>


<span class="s0">def </span><span class="s1">test_translate(index_or_series</span><span class="s0">, </span><span class="s1">any_string_dtype):</span>
    <span class="s1">obj = index_or_series(</span>
        <span class="s1">[</span><span class="s3">&quot;abcdefg&quot;</span><span class="s0">, </span><span class="s3">&quot;abcc&quot;</span><span class="s0">, </span><span class="s3">&quot;cdddfg&quot;</span><span class="s0">, </span><span class="s3">&quot;cdefggg&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype</span>
    <span class="s1">)</span>
    <span class="s1">table = str.maketrans(</span><span class="s3">&quot;abc&quot;</span><span class="s0">, </span><span class="s3">&quot;cde&quot;</span><span class="s1">)</span>
    <span class="s1">result = obj.str.translate(table)</span>
    <span class="s1">expected = index_or_series(</span>
        <span class="s1">[</span><span class="s3">&quot;cdedefg&quot;</span><span class="s0">, </span><span class="s3">&quot;cdee&quot;</span><span class="s0">, </span><span class="s3">&quot;edddfg&quot;</span><span class="s0">, </span><span class="s3">&quot;edefggg&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_translate_mixed_object():</span>
    <span class="s2"># Series with non-string values</span>
    <span class="s1">s = Series([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s4">1.2</span><span class="s1">])</span>
    <span class="s1">table = str.maketrans(</span><span class="s3">&quot;abc&quot;</span><span class="s0">, </span><span class="s3">&quot;cde&quot;</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;d&quot;</span><span class="s0">, </span><span class="s3">&quot;e&quot;</span><span class="s0">, </span><span class="s1">np.nan])</span>
    <span class="s1">result = s.str.translate(table)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s2"># --------------------------------------------------------------------------------------</span>


<span class="s0">def </span><span class="s1">test_flags_kwarg(any_string_dtype):</span>
    <span class="s1">data = {</span>
        <span class="s3">&quot;Dave&quot;</span><span class="s1">: </span><span class="s3">&quot;dave@google.com&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;Steve&quot;</span><span class="s1">: </span><span class="s3">&quot;steve@gmail.com&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;Rob&quot;</span><span class="s1">: </span><span class="s3">&quot;rob@gmail.com&quot;</span><span class="s0">,</span>
        <span class="s3">&quot;Wes&quot;</span><span class="s1">: np.nan</span><span class="s0">,</span>
    <span class="s1">}</span>
    <span class="s1">data = Series(data</span><span class="s0">, </span><span class="s1">dtype=any_string_dtype)</span>

    <span class="s1">pat = </span><span class="s3">r&quot;([A-Z0-9._%+-]+)@([A-Z0-9.-]+)\.([A-Z]{2,4})&quot;</span>

    <span class="s1">result = data.str.extract(pat</span><span class="s0">, </span><span class="s1">flags=re.IGNORECASE</span><span class="s0">, </span><span class="s1">expand=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">result.iloc[</span><span class="s4">0</span><span class="s1">].tolist() == [</span><span class="s3">&quot;dave&quot;</span><span class="s0">, </span><span class="s3">&quot;google&quot;</span><span class="s0">, </span><span class="s3">&quot;com&quot;</span><span class="s1">]</span>

    <span class="s1">result = data.str.match(pat</span><span class="s0">, </span><span class="s1">flags=re.IGNORECASE)</span>
    <span class="s0">assert </span><span class="s1">result[</span><span class="s4">0</span><span class="s1">]</span>

    <span class="s1">result = data.str.fullmatch(pat</span><span class="s0">, </span><span class="s1">flags=re.IGNORECASE)</span>
    <span class="s0">assert </span><span class="s1">result[</span><span class="s4">0</span><span class="s1">]</span>

    <span class="s1">result = data.str.findall(pat</span><span class="s0">, </span><span class="s1">flags=re.IGNORECASE)</span>
    <span class="s0">assert </span><span class="s1">result[</span><span class="s4">0</span><span class="s1">][</span><span class="s4">0</span><span class="s1">] == (</span><span class="s3">&quot;dave&quot;</span><span class="s0">, </span><span class="s3">&quot;google&quot;</span><span class="s0">, </span><span class="s3">&quot;com&quot;</span><span class="s1">)</span>

    <span class="s1">result = data.str.count(pat</span><span class="s0">, </span><span class="s1">flags=re.IGNORECASE)</span>
    <span class="s0">assert </span><span class="s1">result[</span><span class="s4">0</span><span class="s1">] == </span><span class="s4">1</span>

    <span class="s1">msg = </span><span class="s3">&quot;has match groups&quot;</span>
    <span class="s0">with </span><span class="s1">tm.assert_produces_warning(UserWarning</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">result = data.str.contains(pat</span><span class="s0">, </span><span class="s1">flags=re.IGNORECASE)</span>
    <span class="s0">assert </span><span class="s1">result[</span><span class="s4">0</span><span class="s1">]</span>
</pre>
</body>
</html>