<html>
<head>
<title>test_slice.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_slice.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas.errors </span><span class="s0">import </span><span class="s1">UnsortedIndexError</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">DataFrame</span><span class="s0">,</span>
    <span class="s1">Index</span><span class="s0">,</span>
    <span class="s1">MultiIndex</span><span class="s0">,</span>
    <span class="s1">Series</span><span class="s0">,</span>
    <span class="s1">Timestamp</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">pandas._testing </span><span class="s0">as </span><span class="s1">tm</span>
<span class="s0">from </span><span class="s1">pandas.tests.indexing.common </span><span class="s0">import </span><span class="s1">_mklbl</span>


<span class="s0">class </span><span class="s1">TestMultiIndexSlicers:</span>
    <span class="s0">def </span><span class="s1">test_per_axis_per_level_getitem(self):</span>

        <span class="s2"># GH6134</span>
        <span class="s2"># example test case</span>
        <span class="s1">ix = MultiIndex.from_product(</span>
            <span class="s1">[_mklbl(</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">_mklbl(</span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s4">7</span><span class="s1">)</span><span class="s0">, </span><span class="s1">_mklbl(</span><span class="s3">&quot;C&quot;</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">_mklbl(</span><span class="s3">&quot;D&quot;</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)]</span>
        <span class="s1">)</span>
        <span class="s1">df = DataFrame(np.arange(len(ix.to_numpy()))</span><span class="s0">, </span><span class="s1">index=ix)</span>

        <span class="s1">result = df.loc[(slice(</span><span class="s3">&quot;A1&quot;</span><span class="s0">, </span><span class="s3">&quot;A3&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;C1&quot;</span><span class="s0">, </span><span class="s3">&quot;C3&quot;</span><span class="s1">])</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">expected = df.loc[</span>
            <span class="s1">[</span>
                <span class="s1">(</span>
                    <span class="s1">a</span><span class="s0">,</span>
                    <span class="s1">b</span><span class="s0">,</span>
                    <span class="s1">c</span><span class="s0">,</span>
                    <span class="s1">d</span><span class="s0">,</span>
                <span class="s1">)</span>
                <span class="s0">for </span><span class="s1">a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">c</span><span class="s0">, </span><span class="s1">d </span><span class="s0">in </span><span class="s1">df.index.values</span>
                <span class="s0">if </span><span class="s1">(a == </span><span class="s3">&quot;A1&quot; </span><span class="s0">or </span><span class="s1">a == </span><span class="s3">&quot;A2&quot; </span><span class="s0">or </span><span class="s1">a == </span><span class="s3">&quot;A3&quot;</span><span class="s1">) </span><span class="s0">and </span><span class="s1">(c == </span><span class="s3">&quot;C1&quot; </span><span class="s0">or </span><span class="s1">c == </span><span class="s3">&quot;C3&quot;</span><span class="s1">)</span>
            <span class="s1">]</span>
        <span class="s1">]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">expected = df.loc[</span>
            <span class="s1">[</span>
                <span class="s1">(</span>
                    <span class="s1">a</span><span class="s0">,</span>
                    <span class="s1">b</span><span class="s0">,</span>
                    <span class="s1">c</span><span class="s0">,</span>
                    <span class="s1">d</span><span class="s0">,</span>
                <span class="s1">)</span>
                <span class="s0">for </span><span class="s1">a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">c</span><span class="s0">, </span><span class="s1">d </span><span class="s0">in </span><span class="s1">df.index.values</span>
                <span class="s0">if </span><span class="s1">(a == </span><span class="s3">&quot;A1&quot; </span><span class="s0">or </span><span class="s1">a == </span><span class="s3">&quot;A2&quot; </span><span class="s0">or </span><span class="s1">a == </span><span class="s3">&quot;A3&quot;</span><span class="s1">)</span>
                <span class="s0">and </span><span class="s1">(c == </span><span class="s3">&quot;C1&quot; </span><span class="s0">or </span><span class="s1">c == </span><span class="s3">&quot;C2&quot; </span><span class="s0">or </span><span class="s1">c == </span><span class="s3">&quot;C3&quot;</span><span class="s1">)</span>
            <span class="s1">]</span>
        <span class="s1">]</span>
        <span class="s1">result = df.loc[(slice(</span><span class="s3">&quot;A1&quot;</span><span class="s0">, </span><span class="s3">&quot;A3&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s3">&quot;C1&quot;</span><span class="s0">, </span><span class="s3">&quot;C3&quot;</span><span class="s1">))</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># test multi-index slicing with per axis and per index controls</span>
        <span class="s1">index = MultiIndex.from_tuples(</span>
            <span class="s1">[(</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">names=[</span><span class="s3">&quot;one&quot;</span><span class="s0">, </span><span class="s3">&quot;two&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">columns = MultiIndex.from_tuples(</span>
            <span class="s1">[(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;bar&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;bah&quot;</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">names=[</span><span class="s3">&quot;lvl0&quot;</span><span class="s0">, </span><span class="s3">&quot;lvl1&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>

        <span class="s1">df = DataFrame(</span>
            <span class="s1">np.arange(</span><span class="s4">16</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;int64&quot;</span><span class="s1">).reshape(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=index</span><span class="s0">, </span><span class="s1">columns=columns</span>
        <span class="s1">)</span>
        <span class="s1">df = df.sort_index(axis=</span><span class="s4">0</span><span class="s1">).sort_index(axis=</span><span class="s4">1</span><span class="s1">)</span>

        <span class="s2"># identity</span>
        <span class="s1">result = df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s0">None</span><span class="s1">))</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">df)</span>
        <span class="s1">result = df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s0">None</span><span class="s1">))</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s0">None</span><span class="s1">))]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">df)</span>
        <span class="s1">result = df.loc[:</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s0">None</span><span class="s1">))]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">df)</span>

        <span class="s2"># index</span>
        <span class="s1">result = df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">])</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">expected = df.iloc[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">result = df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">expected = df.iloc[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># columns</span>
        <span class="s1">result = df.loc[:</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;foo&quot;</span><span class="s1">])]</span>
        <span class="s1">expected = df.iloc[:</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># both</span>
        <span class="s1">result = df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;foo&quot;</span><span class="s1">])]</span>
        <span class="s1">expected = df.iloc[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">result = df.loc[</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s1">]</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">{</span><span class="s3">&quot;bar&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">9</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">: [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">8</span><span class="s1">]}</span><span class="s0">,</span>
            <span class="s1">index=Index([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">name=</span><span class="s3">&quot;two&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">columns=Index([</span><span class="s3">&quot;bar&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">name=</span><span class="s3">&quot;lvl1&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">result = df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">expected = df.iloc[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># multi-level series</span>
        <span class="s1">s = Series(np.arange(len(ix.to_numpy()))</span><span class="s0">, </span><span class="s1">index=ix)</span>
        <span class="s1">result = s.loc[</span><span class="s3">&quot;A1&quot;</span><span class="s1">:</span><span class="s3">&quot;A3&quot;</span><span class="s0">, </span><span class="s1">:</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;C1&quot;</span><span class="s0">, </span><span class="s3">&quot;C3&quot;</span><span class="s1">]]</span>
        <span class="s1">expected = s.loc[</span>
            <span class="s1">[</span>
                <span class="s1">(</span>
                    <span class="s1">a</span><span class="s0">,</span>
                    <span class="s1">b</span><span class="s0">,</span>
                    <span class="s1">c</span><span class="s0">,</span>
                    <span class="s1">d</span><span class="s0">,</span>
                <span class="s1">)</span>
                <span class="s0">for </span><span class="s1">a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">c</span><span class="s0">, </span><span class="s1">d </span><span class="s0">in </span><span class="s1">s.index.values</span>
                <span class="s0">if </span><span class="s1">(a == </span><span class="s3">&quot;A1&quot; </span><span class="s0">or </span><span class="s1">a == </span><span class="s3">&quot;A2&quot; </span><span class="s0">or </span><span class="s1">a == </span><span class="s3">&quot;A3&quot;</span><span class="s1">) </span><span class="s0">and </span><span class="s1">(c == </span><span class="s3">&quot;C1&quot; </span><span class="s0">or </span><span class="s1">c == </span><span class="s3">&quot;C3&quot;</span><span class="s1">)</span>
            <span class="s1">]</span>
        <span class="s1">]</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># boolean indexers</span>
        <span class="s1">result = df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">df.loc[:</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;bar&quot;</span><span class="s1">)] &gt; </span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">expected = df.iloc[[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">msg = (</span>
            <span class="s3">&quot;cannot index with a boolean indexer &quot;</span>
            <span class="s3">&quot;that is not the same length as the index&quot;</span>
        <span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s0">True, False</span><span class="s1">]))</span><span class="s0">, </span><span class="s1">:]</span>

        <span class="s0">with </span><span class="s1">pytest.raises(KeyError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">r&quot;\[1\] not in index&quot;</span><span class="s1">):</span>
            <span class="s2"># slice(None) is on the index, [1] is on the columns, but 1 is</span>
            <span class="s2">#  not in the columns, so we raise</span>
            <span class="s2">#  This used to treat [1] as positional GH#16396</span>
            <span class="s1">df.loc[slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">]]</span>

        <span class="s2"># not lexsorted</span>
        <span class="s0">assert </span><span class="s1">df.index._lexsort_depth == </span><span class="s4">2</span>
        <span class="s1">df = df.sort_index(level=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">df.index._lexsort_depth == </span><span class="s4">0</span>

        <span class="s1">msg = (</span>
            <span class="s3">&quot;MultiIndex slicing requires the index to be &quot;</span>
            <span class="s3">r&quot;lexsorted: slicing on levels \[1\], lexsort depth 0&quot;</span>
        <span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(UnsortedIndexError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s3">&quot;bar&quot;</span><span class="s1">))</span><span class="s0">, </span><span class="s1">:]</span>

        <span class="s2"># GH 16734: not sorted, but no real slicing</span>
        <span class="s1">result = df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">df.loc[:</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;bar&quot;</span><span class="s1">)] &gt; </span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">df.iloc[[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">:])</span>

    <span class="s0">def </span><span class="s1">test_multiindex_slicers_non_unique(self):</span>

        <span class="s2"># GH 7106</span>
        <span class="s2"># non-unique mi index support</span>
        <span class="s1">df = (</span>
            <span class="s1">DataFrame(</span>
                <span class="s1">{</span>
                    <span class="s3">&quot;A&quot;</span><span class="s1">: [</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s3">&quot;B&quot;</span><span class="s1">: [</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s3">&quot;C&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s3">&quot;D&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">}</span>
            <span class="s1">)</span>
            <span class="s1">.set_index([</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s3">&quot;C&quot;</span><span class="s1">])</span>
            <span class="s1">.sort_index()</span>
        <span class="s1">)</span>
        <span class="s0">assert not </span><span class="s1">df.index.is_unique</span>
        <span class="s1">expected = (</span>
            <span class="s1">DataFrame({</span><span class="s3">&quot;A&quot;</span><span class="s1">: [</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s1">: [</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;C&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;D&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]})</span>
            <span class="s1">.set_index([</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s3">&quot;C&quot;</span><span class="s1">])</span>
            <span class="s1">.sort_index()</span>
        <span class="s1">)</span>
        <span class="s1">result = df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># this is equivalent of an xs expression</span>
        <span class="s1">result = df.xs(</span><span class="s4">1</span><span class="s0">, </span><span class="s1">level=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">drop_level=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">df = (</span>
            <span class="s1">DataFrame(</span>
                <span class="s1">{</span>
                    <span class="s3">&quot;A&quot;</span><span class="s1">: [</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s3">&quot;B&quot;</span><span class="s1">: [</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s3">&quot;C&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s3">&quot;D&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">}</span>
            <span class="s1">)</span>
            <span class="s1">.set_index([</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s3">&quot;C&quot;</span><span class="s1">])</span>
            <span class="s1">.sort_index()</span>
        <span class="s1">)</span>
        <span class="s0">assert not </span><span class="s1">df.index.is_unique</span>
        <span class="s1">expected = (</span>
            <span class="s1">DataFrame({</span><span class="s3">&quot;A&quot;</span><span class="s1">: [</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s1">: [</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;C&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;D&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]})</span>
            <span class="s1">.set_index([</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s3">&quot;C&quot;</span><span class="s1">])</span>
            <span class="s1">.sort_index()</span>
        <span class="s1">)</span>
        <span class="s1">result = df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s0">assert not </span><span class="s1">result.index.is_unique</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># GH12896</span>
        <span class="s2"># numpy-implementation dependent bug</span>
        <span class="s1">ints = [</span>
            <span class="s4">1</span><span class="s0">,</span>
            <span class="s4">2</span><span class="s0">,</span>
            <span class="s4">3</span><span class="s0">,</span>
            <span class="s4">4</span><span class="s0">,</span>
            <span class="s4">5</span><span class="s0">,</span>
            <span class="s4">6</span><span class="s0">,</span>
            <span class="s4">7</span><span class="s0">,</span>
            <span class="s4">8</span><span class="s0">,</span>
            <span class="s4">9</span><span class="s0">,</span>
            <span class="s4">10</span><span class="s0">,</span>
            <span class="s4">11</span><span class="s0">,</span>
            <span class="s4">12</span><span class="s0">,</span>
            <span class="s4">12</span><span class="s0">,</span>
            <span class="s4">13</span><span class="s0">,</span>
            <span class="s4">14</span><span class="s0">,</span>
            <span class="s4">14</span><span class="s0">,</span>
            <span class="s4">16</span><span class="s0">,</span>
            <span class="s4">17</span><span class="s0">,</span>
            <span class="s4">18</span><span class="s0">,</span>
            <span class="s4">19</span><span class="s0">,</span>
            <span class="s4">200000</span><span class="s0">,</span>
            <span class="s4">200000</span><span class="s0">,</span>
        <span class="s1">]</span>
        <span class="s1">n = len(ints)</span>
        <span class="s1">idx = MultiIndex.from_arrays([[</span><span class="s3">&quot;a&quot;</span><span class="s1">] * n</span><span class="s0">, </span><span class="s1">ints])</span>
        <span class="s1">result = Series([</span><span class="s4">1</span><span class="s1">] * n</span><span class="s0">, </span><span class="s1">index=idx)</span>
        <span class="s1">result = result.sort_index()</span>
        <span class="s1">result = result.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s4">100000</span><span class="s1">))]</span>
        <span class="s1">expected = Series([</span><span class="s4">1</span><span class="s1">] * (n - </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=idx[:-</span><span class="s4">2</span><span class="s1">]).sort_index()</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_multiindex_slicers_datetimelike(self):</span>

        <span class="s2"># GH 7429</span>
        <span class="s2"># buggy/inconsistent behavior when slicing with datetime-like</span>
        <span class="s0">import </span><span class="s1">datetime</span>

        <span class="s1">dates = [</span>
            <span class="s1">datetime.datetime(</span><span class="s4">2012</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">12</span><span class="s0">, </span><span class="s4">12</span><span class="s0">, </span><span class="s4">12</span><span class="s1">) + datetime.timedelta(days=i)</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">6</span><span class="s1">)</span>
        <span class="s1">]</span>
        <span class="s1">freq = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
        <span class="s1">index = MultiIndex.from_product([dates</span><span class="s0">, </span><span class="s1">freq]</span><span class="s0">, </span><span class="s1">names=[</span><span class="s3">&quot;date&quot;</span><span class="s0">, </span><span class="s3">&quot;frequency&quot;</span><span class="s1">])</span>

        <span class="s1">df = DataFrame(</span>
            <span class="s1">np.arange(</span><span class="s4">6 </span><span class="s1">* </span><span class="s4">2 </span><span class="s1">* </span><span class="s4">4</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;int64&quot;</span><span class="s1">).reshape(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">index=index</span><span class="s0">,</span>
            <span class="s1">columns=list(</span><span class="s3">&quot;ABCD&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>

        <span class="s2"># multi-axis slicing</span>
        <span class="s1">idx = pd.IndexSlice</span>
        <span class="s1">expected = df.iloc[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]]</span>
        <span class="s1">result = df.loc[</span>
            <span class="s1">(</span>
                <span class="s1">slice(</span>
                    <span class="s1">Timestamp(</span><span class="s3">&quot;2012-01-01 12:12:12&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">Timestamp(</span><span class="s3">&quot;2012-01-03 12:12:12&quot;</span><span class="s1">)</span>
                <span class="s1">)</span><span class="s0">,</span>
                <span class="s1">slice(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">slice(</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">result = df.loc[</span>
            <span class="s1">(</span>
                <span class="s1">idx[</span>
                    <span class="s1">Timestamp(</span><span class="s3">&quot;2012-01-01 12:12:12&quot;</span><span class="s1">) : Timestamp(</span><span class="s3">&quot;2012-01-03 12:12:12&quot;</span><span class="s1">)</span>
                <span class="s1">]</span><span class="s0">,</span>
                <span class="s1">idx[</span><span class="s4">1</span><span class="s1">:</span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">slice(</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">result = df.loc[</span>
            <span class="s1">(</span>
                <span class="s1">slice(</span>
                    <span class="s1">Timestamp(</span><span class="s3">&quot;2012-01-01 12:12:12&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">Timestamp(</span><span class="s3">&quot;2012-01-03 12:12:12&quot;</span><span class="s1">)</span>
                <span class="s1">)</span><span class="s0">,</span>
                <span class="s4">1</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">slice(</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># with strings</span>
        <span class="s1">result = df.loc[</span>
            <span class="s1">(slice(</span><span class="s3">&quot;2012-01-01 12:12:12&quot;</span><span class="s0">, </span><span class="s3">&quot;2012-01-03 12:12:12&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span><span class="s0">,</span>
            <span class="s1">slice(</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">result = df.loc[</span>
            <span class="s1">(idx[</span><span class="s3">&quot;2012-01-01 12:12:12&quot;</span><span class="s1">:</span><span class="s3">&quot;2012-01-03 12:12:12&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">idx[</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s1">]</span>
        <span class="s1">]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_multiindex_slicers_edges(self):</span>
        <span class="s2"># GH 8132</span>
        <span class="s2"># various edge cases</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s3">&quot;A&quot;</span><span class="s1">: [</span><span class="s3">&quot;A0&quot;</span><span class="s1">] * </span><span class="s4">5 </span><span class="s1">+ [</span><span class="s3">&quot;A1&quot;</span><span class="s1">] * </span><span class="s4">5 </span><span class="s1">+ [</span><span class="s3">&quot;A2&quot;</span><span class="s1">] * </span><span class="s4">5</span><span class="s0">,</span>
                <span class="s3">&quot;B&quot;</span><span class="s1">: [</span><span class="s3">&quot;B0&quot;</span><span class="s0">, </span><span class="s3">&quot;B0&quot;</span><span class="s0">, </span><span class="s3">&quot;B1&quot;</span><span class="s0">, </span><span class="s3">&quot;B1&quot;</span><span class="s0">, </span><span class="s3">&quot;B2&quot;</span><span class="s1">] * </span><span class="s4">3</span><span class="s0">,</span>
                <span class="s3">&quot;DATE&quot;</span><span class="s1">: [</span>
                    <span class="s3">&quot;2013-06-11&quot;</span><span class="s0">,</span>
                    <span class="s3">&quot;2013-07-02&quot;</span><span class="s0">,</span>
                    <span class="s3">&quot;2013-07-09&quot;</span><span class="s0">,</span>
                    <span class="s3">&quot;2013-07-30&quot;</span><span class="s0">,</span>
                    <span class="s3">&quot;2013-08-06&quot;</span><span class="s0">,</span>
                    <span class="s3">&quot;2013-06-11&quot;</span><span class="s0">,</span>
                    <span class="s3">&quot;2013-07-02&quot;</span><span class="s0">,</span>
                    <span class="s3">&quot;2013-07-09&quot;</span><span class="s0">,</span>
                    <span class="s3">&quot;2013-07-30&quot;</span><span class="s0">,</span>
                    <span class="s3">&quot;2013-08-06&quot;</span><span class="s0">,</span>
                    <span class="s3">&quot;2013-09-03&quot;</span><span class="s0">,</span>
                    <span class="s3">&quot;2013-10-01&quot;</span><span class="s0">,</span>
                    <span class="s3">&quot;2013-07-09&quot;</span><span class="s0">,</span>
                    <span class="s3">&quot;2013-08-06&quot;</span><span class="s0">,</span>
                    <span class="s3">&quot;2013-09-03&quot;</span><span class="s0">,</span>
                <span class="s1">]</span><span class="s0">,</span>
                <span class="s3">&quot;VALUES&quot;</span><span class="s1">: [</span><span class="s4">22</span><span class="s0">, </span><span class="s4">35</span><span class="s0">, </span><span class="s4">14</span><span class="s0">, </span><span class="s4">9</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">40</span><span class="s0">, </span><span class="s4">18</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>

        <span class="s1">df[</span><span class="s3">&quot;DATE&quot;</span><span class="s1">] = pd.to_datetime(df[</span><span class="s3">&quot;DATE&quot;</span><span class="s1">])</span>
        <span class="s1">df1 = df.set_index([</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s3">&quot;DATE&quot;</span><span class="s1">])</span>
        <span class="s1">df1 = df1.sort_index()</span>

        <span class="s2"># A1 - Get all values under &quot;A0&quot; and &quot;A1&quot;</span>
        <span class="s1">result = df1.loc[(slice(</span><span class="s3">&quot;A1&quot;</span><span class="s1">))</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">expected = df1.iloc[</span><span class="s4">0</span><span class="s1">:</span><span class="s4">10</span><span class="s1">]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># A2 - Get all values from the start to &quot;A2&quot;</span>
        <span class="s1">result = df1.loc[(slice(</span><span class="s3">&quot;A2&quot;</span><span class="s1">))</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">expected = df1</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># A3 - Get all values under &quot;B1&quot; or &quot;B2&quot;</span>
        <span class="s1">result = df1.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s3">&quot;B1&quot;</span><span class="s0">, </span><span class="s3">&quot;B2&quot;</span><span class="s1">))</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">expected = df1.iloc[[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">9</span><span class="s0">, </span><span class="s4">12</span><span class="s0">, </span><span class="s4">13</span><span class="s0">, </span><span class="s4">14</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># A4 - Get all values between 2013-07-02 and 2013-07-09</span>
        <span class="s1">result = df1.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s3">&quot;20130702&quot;</span><span class="s0">, </span><span class="s3">&quot;20130709&quot;</span><span class="s1">))</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">expected = df1.iloc[[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">12</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># B1 - Get all values in B0 that are also under A0, A1 and A2</span>
        <span class="s1">result = df1.loc[(slice(</span><span class="s3">&quot;A2&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s3">&quot;B0&quot;</span><span class="s1">))</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">expected = df1.iloc[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">11</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># B2 - Get all values in B0, B1 and B2 (similar to what #2 is doing for</span>
        <span class="s2"># the As)</span>
        <span class="s1">result = df1.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s3">&quot;B2&quot;</span><span class="s1">))</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">expected = df1</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># B3 - Get all values from B1 to B2 and up to 2013-08-06</span>
        <span class="s1">result = df1.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s3">&quot;B1&quot;</span><span class="s0">, </span><span class="s3">&quot;B2&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s3">&quot;2013-08-06&quot;</span><span class="s1">))</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">expected = df1.iloc[[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">9</span><span class="s0">, </span><span class="s4">12</span><span class="s0">, </span><span class="s4">13</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># B4 - Same as A4 but the start of the date slice is not a key.</span>
        <span class="s2">#      shows indexing on a partial selection slice</span>
        <span class="s1">result = df1.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s3">&quot;20130701&quot;</span><span class="s0">, </span><span class="s3">&quot;20130709&quot;</span><span class="s1">))</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">expected = df1.iloc[[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">12</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_per_axis_per_level_doc_examples(self):</span>

        <span class="s2"># test index maker</span>
        <span class="s1">idx = pd.IndexSlice</span>

        <span class="s2"># from indexing.rst / advanced</span>
        <span class="s1">index = MultiIndex.from_product(</span>
            <span class="s1">[_mklbl(</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">_mklbl(</span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">_mklbl(</span><span class="s3">&quot;C&quot;</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">_mklbl(</span><span class="s3">&quot;D&quot;</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)]</span>
        <span class="s1">)</span>
        <span class="s1">columns = MultiIndex.from_tuples(</span>
            <span class="s1">[(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;bar&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;bah&quot;</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">names=[</span><span class="s3">&quot;lvl0&quot;</span><span class="s0">, </span><span class="s3">&quot;lvl1&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">np.arange(len(index) * len(columns)</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;int64&quot;</span><span class="s1">).reshape(</span>
                <span class="s1">(len(index)</span><span class="s0">, </span><span class="s1">len(columns))</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">index=index</span><span class="s0">,</span>
            <span class="s1">columns=columns</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">result = df.loc[(slice(</span><span class="s3">&quot;A1&quot;</span><span class="s0">, </span><span class="s3">&quot;A3&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;C1&quot;</span><span class="s0">, </span><span class="s3">&quot;C3&quot;</span><span class="s1">])</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">expected = df.loc[</span>
            <span class="s1">[</span>
                <span class="s1">(</span>
                    <span class="s1">a</span><span class="s0">,</span>
                    <span class="s1">b</span><span class="s0">,</span>
                    <span class="s1">c</span><span class="s0">,</span>
                    <span class="s1">d</span><span class="s0">,</span>
                <span class="s1">)</span>
                <span class="s0">for </span><span class="s1">a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">c</span><span class="s0">, </span><span class="s1">d </span><span class="s0">in </span><span class="s1">df.index.values</span>
                <span class="s0">if </span><span class="s1">(a == </span><span class="s3">&quot;A1&quot; </span><span class="s0">or </span><span class="s1">a == </span><span class="s3">&quot;A2&quot; </span><span class="s0">or </span><span class="s1">a == </span><span class="s3">&quot;A3&quot;</span><span class="s1">) </span><span class="s0">and </span><span class="s1">(c == </span><span class="s3">&quot;C1&quot; </span><span class="s0">or </span><span class="s1">c == </span><span class="s3">&quot;C3&quot;</span><span class="s1">)</span>
            <span class="s1">]</span>
        <span class="s1">]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
        <span class="s1">result = df.loc[idx[</span><span class="s3">&quot;A1&quot;</span><span class="s1">:</span><span class="s3">&quot;A3&quot;</span><span class="s0">, </span><span class="s1">:</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;C1&quot;</span><span class="s0">, </span><span class="s3">&quot;C3&quot;</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">result = df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;C1&quot;</span><span class="s0">, </span><span class="s3">&quot;C3&quot;</span><span class="s1">])</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">expected = df.loc[</span>
            <span class="s1">[</span>
                <span class="s1">(</span>
                    <span class="s1">a</span><span class="s0">,</span>
                    <span class="s1">b</span><span class="s0">,</span>
                    <span class="s1">c</span><span class="s0">,</span>
                    <span class="s1">d</span><span class="s0">,</span>
                <span class="s1">)</span>
                <span class="s0">for </span><span class="s1">a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">c</span><span class="s0">, </span><span class="s1">d </span><span class="s0">in </span><span class="s1">df.index.values</span>
                <span class="s0">if </span><span class="s1">(c == </span><span class="s3">&quot;C1&quot; </span><span class="s0">or </span><span class="s1">c == </span><span class="s3">&quot;C3&quot;</span><span class="s1">)</span>
            <span class="s1">]</span>
        <span class="s1">]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
        <span class="s1">result = df.loc[idx[:</span><span class="s0">, </span><span class="s1">:</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;C1&quot;</span><span class="s0">, </span><span class="s3">&quot;C3&quot;</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># not sorted</span>
        <span class="s1">msg = (</span>
            <span class="s3">&quot;MultiIndex slicing requires the index to be lexsorted: &quot;</span>
            <span class="s3">r&quot;slicing on levels \[1\], lexsort depth 1&quot;</span>
        <span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(UnsortedIndexError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">df.loc[</span><span class="s3">&quot;A1&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">slice(</span><span class="s3">&quot;foo&quot;</span><span class="s1">))]</span>

        <span class="s2"># GH 16734: not sorted, but no real slicing</span>
        <span class="s1">tm.assert_frame_equal(</span>
            <span class="s1">df.loc[</span><span class="s3">&quot;A1&quot;</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">df.loc[</span><span class="s3">&quot;A1&quot;</span><span class="s1">].iloc[:</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]]</span>
        <span class="s1">)</span>

        <span class="s1">df = df.sort_index(axis=</span><span class="s4">1</span><span class="s1">)</span>

        <span class="s2"># slicing</span>
        <span class="s1">df.loc[</span><span class="s3">&quot;A1&quot;</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">)]</span>
        <span class="s1">df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;C1&quot;</span><span class="s0">, </span><span class="s3">&quot;C3&quot;</span><span class="s1">])</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">)]</span>

        <span class="s2"># setitem</span>
        <span class="s1">df.loc(axis=</span><span class="s4">0</span><span class="s1">)[:</span><span class="s0">, </span><span class="s1">:</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;C1&quot;</span><span class="s0">, </span><span class="s3">&quot;C3&quot;</span><span class="s1">]] = -</span><span class="s4">10</span>

    <span class="s0">def </span><span class="s1">test_loc_axis_arguments(self):</span>

        <span class="s1">index = MultiIndex.from_product(</span>
            <span class="s1">[_mklbl(</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">_mklbl(</span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">_mklbl(</span><span class="s3">&quot;C&quot;</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">_mklbl(</span><span class="s3">&quot;D&quot;</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)]</span>
        <span class="s1">)</span>
        <span class="s1">columns = MultiIndex.from_tuples(</span>
            <span class="s1">[(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;bar&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;bah&quot;</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">names=[</span><span class="s3">&quot;lvl0&quot;</span><span class="s0">, </span><span class="s3">&quot;lvl1&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">df = (</span>
            <span class="s1">DataFrame(</span>
                <span class="s1">np.arange(len(index) * len(columns)</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;int64&quot;</span><span class="s1">).reshape(</span>
                    <span class="s1">(len(index)</span><span class="s0">, </span><span class="s1">len(columns))</span>
                <span class="s1">)</span><span class="s0">,</span>
                <span class="s1">index=index</span><span class="s0">,</span>
                <span class="s1">columns=columns</span><span class="s0">,</span>
            <span class="s1">)</span>
            <span class="s1">.sort_index()</span>
            <span class="s1">.sort_index(axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">)</span>

        <span class="s2"># axis 0</span>
        <span class="s1">result = df.loc(axis=</span><span class="s4">0</span><span class="s1">)[</span><span class="s3">&quot;A1&quot;</span><span class="s1">:</span><span class="s3">&quot;A3&quot;</span><span class="s0">, </span><span class="s1">:</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;C1&quot;</span><span class="s0">, </span><span class="s3">&quot;C3&quot;</span><span class="s1">]]</span>
        <span class="s1">expected = df.loc[</span>
            <span class="s1">[</span>
                <span class="s1">(</span>
                    <span class="s1">a</span><span class="s0">,</span>
                    <span class="s1">b</span><span class="s0">,</span>
                    <span class="s1">c</span><span class="s0">,</span>
                    <span class="s1">d</span><span class="s0">,</span>
                <span class="s1">)</span>
                <span class="s0">for </span><span class="s1">a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">c</span><span class="s0">, </span><span class="s1">d </span><span class="s0">in </span><span class="s1">df.index.values</span>
                <span class="s0">if </span><span class="s1">(a == </span><span class="s3">&quot;A1&quot; </span><span class="s0">or </span><span class="s1">a == </span><span class="s3">&quot;A2&quot; </span><span class="s0">or </span><span class="s1">a == </span><span class="s3">&quot;A3&quot;</span><span class="s1">) </span><span class="s0">and </span><span class="s1">(c == </span><span class="s3">&quot;C1&quot; </span><span class="s0">or </span><span class="s1">c == </span><span class="s3">&quot;C3&quot;</span><span class="s1">)</span>
            <span class="s1">]</span>
        <span class="s1">]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">result = df.loc(axis=</span><span class="s3">&quot;index&quot;</span><span class="s1">)[:</span><span class="s0">, </span><span class="s1">:</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;C1&quot;</span><span class="s0">, </span><span class="s3">&quot;C3&quot;</span><span class="s1">]]</span>
        <span class="s1">expected = df.loc[</span>
            <span class="s1">[</span>
                <span class="s1">(</span>
                    <span class="s1">a</span><span class="s0">,</span>
                    <span class="s1">b</span><span class="s0">,</span>
                    <span class="s1">c</span><span class="s0">,</span>
                    <span class="s1">d</span><span class="s0">,</span>
                <span class="s1">)</span>
                <span class="s0">for </span><span class="s1">a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">c</span><span class="s0">, </span><span class="s1">d </span><span class="s0">in </span><span class="s1">df.index.values</span>
                <span class="s0">if </span><span class="s1">(c == </span><span class="s3">&quot;C1&quot; </span><span class="s0">or </span><span class="s1">c == </span><span class="s3">&quot;C3&quot;</span><span class="s1">)</span>
            <span class="s1">]</span>
        <span class="s1">]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># axis 1</span>
        <span class="s1">result = df.loc(axis=</span><span class="s4">1</span><span class="s1">)[:</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">]</span>
        <span class="s1">expected = df.loc[:</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">)]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">result = df.loc(axis=</span><span class="s3">&quot;columns&quot;</span><span class="s1">)[:</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">]</span>
        <span class="s1">expected = df.loc[:</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">)]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># invalid axis</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">[-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">]:</span>
            <span class="s1">msg = </span><span class="s3">f&quot;No axis named </span><span class="s0">{</span><span class="s1">i</span><span class="s0">} </span><span class="s3">for object type DataFrame&quot;</span>
            <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
                <span class="s1">df.loc(axis=i)[:</span><span class="s0">, </span><span class="s1">:</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;C1&quot;</span><span class="s0">, </span><span class="s3">&quot;C3&quot;</span><span class="s1">]]</span>

    <span class="s0">def </span><span class="s1">test_loc_axis_single_level_multi_col_indexing_multiindex_col_df(self):</span>

        <span class="s2"># GH29519</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">np.arange(</span><span class="s4">27</span><span class="s1">).reshape(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">9</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">columns=MultiIndex.from_product([[</span><span class="s3">&quot;a1&quot;</span><span class="s0">, </span><span class="s3">&quot;a2&quot;</span><span class="s0">, </span><span class="s3">&quot;a3&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;b1&quot;</span><span class="s0">, </span><span class="s3">&quot;b2&quot;</span><span class="s0">, </span><span class="s3">&quot;b3&quot;</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">result = df.loc(axis=</span><span class="s4">1</span><span class="s1">)[</span><span class="s3">&quot;a1&quot;</span><span class="s1">:</span><span class="s3">&quot;a2&quot;</span><span class="s1">]</span>
        <span class="s1">expected = df.iloc[:</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">3</span><span class="s1">]</span>

        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_loc_axis_single_level_single_col_indexing_multiindex_col_df(self):</span>

        <span class="s2"># GH29519</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">np.arange(</span><span class="s4">27</span><span class="s1">).reshape(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">9</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">columns=MultiIndex.from_product([[</span><span class="s3">&quot;a1&quot;</span><span class="s0">, </span><span class="s3">&quot;a2&quot;</span><span class="s0">, </span><span class="s3">&quot;a3&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;b1&quot;</span><span class="s0">, </span><span class="s3">&quot;b2&quot;</span><span class="s0">, </span><span class="s3">&quot;b3&quot;</span><span class="s1">]])</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">result = df.loc(axis=</span><span class="s4">1</span><span class="s1">)[</span><span class="s3">&quot;a1&quot;</span><span class="s1">]</span>
        <span class="s1">expected = df.iloc[:</span><span class="s0">, </span><span class="s1">:</span><span class="s4">3</span><span class="s1">]</span>
        <span class="s1">expected.columns = [</span><span class="s3">&quot;b1&quot;</span><span class="s0">, </span><span class="s3">&quot;b2&quot;</span><span class="s0">, </span><span class="s3">&quot;b3&quot;</span><span class="s1">]</span>

        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_loc_ax_single_level_indexer_simple_df(self):</span>

        <span class="s2"># GH29519</span>
        <span class="s2"># test single level indexing on single index column data frame</span>
        <span class="s1">df = DataFrame(np.arange(</span><span class="s4">9</span><span class="s1">).reshape(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">result = df.loc(axis=</span><span class="s4">1</span><span class="s1">)[</span><span class="s3">&quot;a&quot;</span><span class="s1">]</span>
        <span class="s1">expected = Series(np.array([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">6</span><span class="s1">])</span><span class="s0">, </span><span class="s1">name=</span><span class="s3">&quot;a&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_per_axis_per_level_setitem(self):</span>

        <span class="s2"># test index maker</span>
        <span class="s1">idx = pd.IndexSlice</span>

        <span class="s2"># test multi-index slicing with per axis and per index controls</span>
        <span class="s1">index = MultiIndex.from_tuples(</span>
            <span class="s1">[(</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">names=[</span><span class="s3">&quot;one&quot;</span><span class="s0">, </span><span class="s3">&quot;two&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">columns = MultiIndex.from_tuples(</span>
            <span class="s1">[(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;bar&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;bah&quot;</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">names=[</span><span class="s3">&quot;lvl0&quot;</span><span class="s0">, </span><span class="s3">&quot;lvl1&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>

        <span class="s1">df_orig = DataFrame(</span>
            <span class="s1">np.arange(</span><span class="s4">16</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;int64&quot;</span><span class="s1">).reshape(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=index</span><span class="s0">, </span><span class="s1">columns=columns</span>
        <span class="s1">)</span>
        <span class="s1">df_orig = df_orig.sort_index(axis=</span><span class="s4">0</span><span class="s1">).sort_index(axis=</span><span class="s4">1</span><span class="s1">)</span>

        <span class="s2"># identity</span>
        <span class="s1">df = df_orig.copy()</span>
        <span class="s1">df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s0">None</span><span class="s1">))</span><span class="s0">, </span><span class="s1">:] = </span><span class="s4">100</span>
        <span class="s1">expected = df_orig.copy()</span>
        <span class="s1">expected.iloc[:</span><span class="s0">, </span><span class="s1">:] = </span><span class="s4">100</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">df = df_orig.copy()</span>
        <span class="s1">df.loc(axis=</span><span class="s4">0</span><span class="s1">)[:</span><span class="s0">, </span><span class="s1">:] = </span><span class="s4">100</span>
        <span class="s1">expected = df_orig.copy()</span>
        <span class="s1">expected.iloc[:</span><span class="s0">, </span><span class="s1">:] = </span><span class="s4">100</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">df = df_orig.copy()</span>
        <span class="s1">df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s0">None</span><span class="s1">))</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s0">None</span><span class="s1">))] = </span><span class="s4">100</span>
        <span class="s1">expected = df_orig.copy()</span>
        <span class="s1">expected.iloc[:</span><span class="s0">, </span><span class="s1">:] = </span><span class="s4">100</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">df = df_orig.copy()</span>
        <span class="s1">df.loc[:</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s0">None</span><span class="s1">))] = </span><span class="s4">100</span>
        <span class="s1">expected = df_orig.copy()</span>
        <span class="s1">expected.iloc[:</span><span class="s0">, </span><span class="s1">:] = </span><span class="s4">100</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># index</span>
        <span class="s1">df = df_orig.copy()</span>
        <span class="s1">df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">])</span><span class="s0">, </span><span class="s1">:] = </span><span class="s4">100</span>
        <span class="s1">expected = df_orig.copy()</span>
        <span class="s1">expected.iloc[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]] = </span><span class="s4">100</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">df = df_orig.copy()</span>
        <span class="s1">df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">:] = </span><span class="s4">100</span>
        <span class="s1">expected = df_orig.copy()</span>
        <span class="s1">expected.iloc[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]] = </span><span class="s4">100</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">df = df_orig.copy()</span>
        <span class="s1">df.loc(axis=</span><span class="s4">0</span><span class="s1">)[:</span><span class="s0">, </span><span class="s4">1</span><span class="s1">] = </span><span class="s4">100</span>
        <span class="s1">expected = df_orig.copy()</span>
        <span class="s1">expected.iloc[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]] = </span><span class="s4">100</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># columns</span>
        <span class="s1">df = df_orig.copy()</span>
        <span class="s1">df.loc[:</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;foo&quot;</span><span class="s1">])] = </span><span class="s4">100</span>
        <span class="s1">expected = df_orig.copy()</span>
        <span class="s1">expected.iloc[:</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]] = </span><span class="s4">100</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># both</span>
        <span class="s1">df = df_orig.copy()</span>
        <span class="s1">df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;foo&quot;</span><span class="s1">])] = </span><span class="s4">100</span>
        <span class="s1">expected = df_orig.copy()</span>
        <span class="s1">expected.iloc[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]] = </span><span class="s4">100</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">df = df_orig.copy()</span>
        <span class="s1">df.loc[idx[:</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">idx[:</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;foo&quot;</span><span class="s1">]]] = </span><span class="s4">100</span>
        <span class="s1">expected = df_orig.copy()</span>
        <span class="s1">expected.iloc[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]] = </span><span class="s4">100</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">df = df_orig.copy()</span>
        <span class="s1">df.loc[</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s1">] = </span><span class="s4">100</span>
        <span class="s1">expected = df_orig.copy()</span>
        <span class="s1">expected.iloc[</span><span class="s4">0</span><span class="s1">:</span><span class="s4">3</span><span class="s0">, </span><span class="s4">0</span><span class="s1">:</span><span class="s4">2</span><span class="s1">] = </span><span class="s4">100</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># setting with a list-like</span>
        <span class="s1">df = df_orig.copy()</span>
        <span class="s1">df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;foo&quot;</span><span class="s1">])] = np.array(</span>
            <span class="s1">[[</span><span class="s4">100</span><span class="s0">, </span><span class="s4">100</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">100</span><span class="s0">, </span><span class="s4">100</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;int64&quot;</span>
        <span class="s1">)</span>
        <span class="s1">expected = df_orig.copy()</span>
        <span class="s1">expected.iloc[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]] = </span><span class="s4">100</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># not enough values</span>
        <span class="s1">df = df_orig.copy()</span>

        <span class="s1">msg = </span><span class="s3">&quot;setting an array element with a sequence.&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;foo&quot;</span><span class="s1">])] = np.array(</span>
                <span class="s1">[[</span><span class="s4">100</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">100</span><span class="s0">, </span><span class="s4">100</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;int64&quot;</span>
            <span class="s1">)</span>

        <span class="s1">msg = </span><span class="s3">&quot;Must have equal len keys and value when setting with an iterable&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;foo&quot;</span><span class="s1">])] = np.array(</span>
                <span class="s1">[</span><span class="s4">100</span><span class="s0">, </span><span class="s4">100</span><span class="s0">, </span><span class="s4">100</span><span class="s0">, </span><span class="s4">100</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;int64&quot;</span>
            <span class="s1">)</span>

        <span class="s2"># with an alignable rhs</span>
        <span class="s1">df = df_orig.copy()</span>
        <span class="s1">df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;foo&quot;</span><span class="s1">])] = (</span>
            <span class="s1">df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;foo&quot;</span><span class="s1">])] * </span><span class="s4">5</span>
        <span class="s1">)</span>
        <span class="s1">expected = df_orig.copy()</span>
        <span class="s1">expected.iloc[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]] = expected.iloc[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]] * </span><span class="s4">5</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">df = df_orig.copy()</span>
        <span class="s1">df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;foo&quot;</span><span class="s1">])] *= df.loc[</span>
            <span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;foo&quot;</span><span class="s1">])</span>
        <span class="s1">]</span>
        <span class="s1">expected = df_orig.copy()</span>
        <span class="s1">expected.iloc[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]] *= expected.iloc[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">rhs = df_orig.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;foo&quot;</span><span class="s1">])].copy()</span>
        <span class="s1">rhs.loc[:</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;bah&quot;</span><span class="s1">)] = </span><span class="s4">10</span>
        <span class="s1">df = df_orig.copy()</span>
        <span class="s1">df.loc[(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(slice(</span><span class="s0">None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;foo&quot;</span><span class="s1">])] *= rhs</span>
        <span class="s1">expected = df_orig.copy()</span>
        <span class="s1">expected.iloc[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]] *= expected.iloc[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_multiindex_label_slicing_with_negative_step(self):</span>
        <span class="s1">ser = Series(</span>
            <span class="s1">np.arange(</span><span class="s4">20</span><span class="s1">)</span><span class="s0">, </span><span class="s1">MultiIndex.from_product([list(</span><span class="s3">&quot;abcde&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s4">4</span><span class="s1">)])</span>
        <span class="s1">)</span>
        <span class="s1">SLC = pd.IndexSlice</span>

        <span class="s1">tm.assert_indexing_slices_equivalent(ser</span><span class="s0">, </span><span class="s1">SLC[::-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">SLC[::-</span><span class="s4">1</span><span class="s1">])</span>

        <span class="s1">tm.assert_indexing_slices_equivalent(ser</span><span class="s0">, </span><span class="s1">SLC[</span><span class="s3">&quot;d&quot;</span><span class="s1">::-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">SLC[</span><span class="s4">15</span><span class="s1">::-</span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">tm.assert_indexing_slices_equivalent(ser</span><span class="s0">, </span><span class="s1">SLC[(</span><span class="s3">&quot;d&quot;</span><span class="s0">,</span><span class="s1">)::-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">SLC[</span><span class="s4">15</span><span class="s1">::-</span><span class="s4">1</span><span class="s1">])</span>

        <span class="s1">tm.assert_indexing_slices_equivalent(ser</span><span class="s0">, </span><span class="s1">SLC[:</span><span class="s3">&quot;d&quot;</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">SLC[:</span><span class="s4">11</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">tm.assert_indexing_slices_equivalent(ser</span><span class="s0">, </span><span class="s1">SLC[:(</span><span class="s3">&quot;d&quot;</span><span class="s0">,</span><span class="s1">):-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">SLC[:</span><span class="s4">11</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>

        <span class="s1">tm.assert_indexing_slices_equivalent(ser</span><span class="s0">, </span><span class="s1">SLC[</span><span class="s3">&quot;d&quot;</span><span class="s1">:</span><span class="s3">&quot;b&quot;</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">SLC[</span><span class="s4">15</span><span class="s1">:</span><span class="s4">3</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">tm.assert_indexing_slices_equivalent(ser</span><span class="s0">, </span><span class="s1">SLC[(</span><span class="s3">&quot;d&quot;</span><span class="s0">,</span><span class="s1">):</span><span class="s3">&quot;b&quot;</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">SLC[</span><span class="s4">15</span><span class="s1">:</span><span class="s4">3</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">tm.assert_indexing_slices_equivalent(ser</span><span class="s0">, </span><span class="s1">SLC[</span><span class="s3">&quot;d&quot;</span><span class="s1">:(</span><span class="s3">&quot;b&quot;</span><span class="s0">,</span><span class="s1">):-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">SLC[</span><span class="s4">15</span><span class="s1">:</span><span class="s4">3</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">tm.assert_indexing_slices_equivalent(ser</span><span class="s0">, </span><span class="s1">SLC[(</span><span class="s3">&quot;d&quot;</span><span class="s0">,</span><span class="s1">):(</span><span class="s3">&quot;b&quot;</span><span class="s0">,</span><span class="s1">):-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">SLC[</span><span class="s4">15</span><span class="s1">:</span><span class="s4">3</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">tm.assert_indexing_slices_equivalent(ser</span><span class="s0">, </span><span class="s1">SLC[</span><span class="s3">&quot;b&quot;</span><span class="s1">:</span><span class="s3">&quot;d&quot;</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">SLC[:</span><span class="s4">0</span><span class="s1">])</span>

        <span class="s1">tm.assert_indexing_slices_equivalent(ser</span><span class="s0">, </span><span class="s1">SLC[(</span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)::-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">SLC[</span><span class="s4">10</span><span class="s1">::-</span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">tm.assert_indexing_slices_equivalent(ser</span><span class="s0">, </span><span class="s1">SLC[:(</span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s4">2</span><span class="s1">):-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">SLC[:</span><span class="s4">9</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">tm.assert_indexing_slices_equivalent(</span>
            <span class="s1">ser</span><span class="s0">, </span><span class="s1">SLC[(</span><span class="s3">&quot;e&quot;</span><span class="s0">, </span><span class="s4">0</span><span class="s1">):(</span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s4">2</span><span class="s1">):-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">SLC[</span><span class="s4">16</span><span class="s1">:</span><span class="s4">9</span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_multiindex_slice_first_level(self):</span>
        <span class="s2"># GH 12697</span>
        <span class="s1">freq = [</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;d&quot;</span><span class="s1">]</span>
        <span class="s1">idx = MultiIndex.from_product([freq</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s4">500</span><span class="s1">)])</span>
        <span class="s1">df = DataFrame(list(range(</span><span class="s4">2000</span><span class="s1">))</span><span class="s0">, </span><span class="s1">index=idx</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;Test&quot;</span><span class="s1">])</span>
        <span class="s1">df_slice = df.loc[pd.IndexSlice[:</span><span class="s0">, </span><span class="s4">30</span><span class="s1">:</span><span class="s4">70</span><span class="s1">]</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">result = df_slice.loc[</span><span class="s3">&quot;a&quot;</span><span class="s1">]</span>
        <span class="s1">expected = DataFrame(list(range(</span><span class="s4">30</span><span class="s0">, </span><span class="s4">71</span><span class="s1">))</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;Test&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=range(</span><span class="s4">30</span><span class="s0">, </span><span class="s4">71</span><span class="s1">))</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
        <span class="s1">result = df_slice.loc[</span><span class="s3">&quot;d&quot;</span><span class="s1">]</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">list(range(</span><span class="s4">1530</span><span class="s0">, </span><span class="s4">1571</span><span class="s1">))</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;Test&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=range(</span><span class="s4">30</span><span class="s0">, </span><span class="s4">71</span><span class="s1">)</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_int_series_slicing(self</span><span class="s0">, </span><span class="s1">multiindex_year_month_day_dataframe_random_data):</span>
        <span class="s1">ymd = multiindex_year_month_day_dataframe_random_data</span>
        <span class="s1">s = ymd[</span><span class="s3">&quot;A&quot;</span><span class="s1">]</span>
        <span class="s1">result = s[</span><span class="s4">5</span><span class="s1">:]</span>
        <span class="s1">expected = s.reindex(s.index[</span><span class="s4">5</span><span class="s1">:])</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">exp = ymd[</span><span class="s3">&quot;A&quot;</span><span class="s1">].copy()</span>
        <span class="s1">s[</span><span class="s4">5</span><span class="s1">:] = </span><span class="s4">0</span>
        <span class="s1">exp.values[</span><span class="s4">5</span><span class="s1">:] = </span><span class="s4">0</span>
        <span class="s1">tm.assert_numpy_array_equal(s.values</span><span class="s0">, </span><span class="s1">exp.values)</span>

        <span class="s1">result = ymd[</span><span class="s4">5</span><span class="s1">:]</span>
        <span class="s1">expected = ymd.reindex(s.index[</span><span class="s4">5</span><span class="s1">:])</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_loc_slice_negative_stepsize(self):</span>
        <span class="s2"># GH#38071</span>
        <span class="s1">mi = MultiIndex.from_product([[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]])</span>
        <span class="s1">df = DataFrame([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">7</span><span class="s0">, </span><span class="s4">8</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">index=mi)</span>
        <span class="s1">result = df.loc[(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s1">slice(</span><span class="s0">None, None, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">))</span><span class="s0">, </span><span class="s1">:]</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">index=MultiIndex.from_tuples([(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)])</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
</pre>
</body>
</html>