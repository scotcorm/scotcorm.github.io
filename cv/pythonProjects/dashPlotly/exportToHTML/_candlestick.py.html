<html>
<head>
<title>_candlestick.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #629755; font-style: italic;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
_candlestick.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">__future__ </span><span class="s0">import </span><span class="s1">absolute_import</span>

<span class="s0">from </span><span class="s1">plotly.figure_factory </span><span class="s0">import </span><span class="s1">utils</span>
<span class="s0">from </span><span class="s1">plotly.figure_factory._ohlc </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">_DEFAULT_INCREASING_COLOR</span><span class="s0">,</span>
    <span class="s1">_DEFAULT_DECREASING_COLOR</span><span class="s0">,</span>
    <span class="s1">validate_ohlc</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">from </span><span class="s1">plotly.graph_objs </span><span class="s0">import </span><span class="s1">graph_objs</span>


<span class="s0">def </span><span class="s1">make_increasing_candle(open</span><span class="s0">, </span><span class="s1">high</span><span class="s0">, </span><span class="s1">low</span><span class="s0">, </span><span class="s1">close</span><span class="s0">, </span><span class="s1">dates</span><span class="s0">, </span><span class="s1">**kwargs):</span>
    <span class="s2">&quot;&quot;&quot; 
    Makes boxplot trace for increasing candlesticks 
 
    _make_increasing_candle() and _make_decreasing_candle separate the 
    increasing traces from the decreasing traces so kwargs (such as 
    color) can be passed separately to increasing or decreasing traces 
    when direction is set to 'increasing' or 'decreasing' in 
    FigureFactory.create_candlestick() 
 
    :param (list) open: opening values 
    :param (list) high: high values 
    :param (list) low: low values 
    :param (list) close: closing values 
    :param (list) dates: list of datetime objects. Default: None 
    :param kwargs: kwargs to be passed to increasing trace via 
        plotly.graph_objs.Scatter. 
 
    :rtype (list) candle_incr_data: list of the box trace for 
        increasing candlesticks. 
    &quot;&quot;&quot;</span>
    <span class="s1">increase_x</span><span class="s0">, </span><span class="s1">increase_y = _Candlestick(</span>
        <span class="s1">open</span><span class="s0">, </span><span class="s1">high</span><span class="s0">, </span><span class="s1">low</span><span class="s0">, </span><span class="s1">close</span><span class="s0">, </span><span class="s1">dates</span><span class="s0">, </span><span class="s1">**kwargs</span>
    <span class="s1">).get_candle_increase()</span>

    <span class="s0">if </span><span class="s3">&quot;line&quot; </span><span class="s0">in </span><span class="s1">kwargs:</span>
        <span class="s1">kwargs.setdefault(</span><span class="s3">&quot;fillcolor&quot;</span><span class="s0">, </span><span class="s1">kwargs[</span><span class="s3">&quot;line&quot;</span><span class="s1">][</span><span class="s3">&quot;color&quot;</span><span class="s1">])</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">kwargs.setdefault(</span><span class="s3">&quot;fillcolor&quot;</span><span class="s0">, </span><span class="s1">_DEFAULT_INCREASING_COLOR)</span>
    <span class="s0">if </span><span class="s3">&quot;name&quot; </span><span class="s0">in </span><span class="s1">kwargs:</span>
        <span class="s1">kwargs.setdefault(</span><span class="s3">&quot;showlegend&quot;</span><span class="s0">, True</span><span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">kwargs.setdefault(</span><span class="s3">&quot;showlegend&quot;</span><span class="s0">, False</span><span class="s1">)</span>
    <span class="s1">kwargs.setdefault(</span><span class="s3">&quot;name&quot;</span><span class="s0">, </span><span class="s3">&quot;Increasing&quot;</span><span class="s1">)</span>
    <span class="s1">kwargs.setdefault(</span><span class="s3">&quot;line&quot;</span><span class="s0">, </span><span class="s1">dict(color=_DEFAULT_INCREASING_COLOR))</span>

    <span class="s1">candle_incr_data = dict(</span>
        <span class="s1">type=</span><span class="s3">&quot;box&quot;</span><span class="s0">,</span>
        <span class="s1">x=increase_x</span><span class="s0">,</span>
        <span class="s1">y=increase_y</span><span class="s0">,</span>
        <span class="s1">whiskerwidth=</span><span class="s4">0</span><span class="s0">,</span>
        <span class="s1">boxpoints=</span><span class="s0">False,</span>
        <span class="s1">**kwargs</span>
    <span class="s1">)</span>

    <span class="s0">return </span><span class="s1">[candle_incr_data]</span>


<span class="s0">def </span><span class="s1">make_decreasing_candle(open</span><span class="s0">, </span><span class="s1">high</span><span class="s0">, </span><span class="s1">low</span><span class="s0">, </span><span class="s1">close</span><span class="s0">, </span><span class="s1">dates</span><span class="s0">, </span><span class="s1">**kwargs):</span>
    <span class="s2">&quot;&quot;&quot; 
    Makes boxplot trace for decreasing candlesticks 
 
    :param (list) open: opening values 
    :param (list) high: high values 
    :param (list) low: low values 
    :param (list) close: closing values 
    :param (list) dates: list of datetime objects. Default: None 
    :param kwargs: kwargs to be passed to decreasing trace via 
        plotly.graph_objs.Scatter. 
 
    :rtype (list) candle_decr_data: list of the box trace for 
        decreasing candlesticks. 
    &quot;&quot;&quot;</span>

    <span class="s1">decrease_x</span><span class="s0">, </span><span class="s1">decrease_y = _Candlestick(</span>
        <span class="s1">open</span><span class="s0">, </span><span class="s1">high</span><span class="s0">, </span><span class="s1">low</span><span class="s0">, </span><span class="s1">close</span><span class="s0">, </span><span class="s1">dates</span><span class="s0">, </span><span class="s1">**kwargs</span>
    <span class="s1">).get_candle_decrease()</span>

    <span class="s0">if </span><span class="s3">&quot;line&quot; </span><span class="s0">in </span><span class="s1">kwargs:</span>
        <span class="s1">kwargs.setdefault(</span><span class="s3">&quot;fillcolor&quot;</span><span class="s0">, </span><span class="s1">kwargs[</span><span class="s3">&quot;line&quot;</span><span class="s1">][</span><span class="s3">&quot;color&quot;</span><span class="s1">])</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">kwargs.setdefault(</span><span class="s3">&quot;fillcolor&quot;</span><span class="s0">, </span><span class="s1">_DEFAULT_DECREASING_COLOR)</span>
    <span class="s1">kwargs.setdefault(</span><span class="s3">&quot;showlegend&quot;</span><span class="s0">, False</span><span class="s1">)</span>
    <span class="s1">kwargs.setdefault(</span><span class="s3">&quot;line&quot;</span><span class="s0">, </span><span class="s1">dict(color=_DEFAULT_DECREASING_COLOR))</span>
    <span class="s1">kwargs.setdefault(</span><span class="s3">&quot;name&quot;</span><span class="s0">, </span><span class="s3">&quot;Decreasing&quot;</span><span class="s1">)</span>

    <span class="s1">candle_decr_data = dict(</span>
        <span class="s1">type=</span><span class="s3">&quot;box&quot;</span><span class="s0">,</span>
        <span class="s1">x=decrease_x</span><span class="s0">,</span>
        <span class="s1">y=decrease_y</span><span class="s0">,</span>
        <span class="s1">whiskerwidth=</span><span class="s4">0</span><span class="s0">,</span>
        <span class="s1">boxpoints=</span><span class="s0">False,</span>
        <span class="s1">**kwargs</span>
    <span class="s1">)</span>

    <span class="s0">return </span><span class="s1">[candle_decr_data]</span>


<span class="s0">def </span><span class="s1">create_candlestick(open</span><span class="s0">, </span><span class="s1">high</span><span class="s0">, </span><span class="s1">low</span><span class="s0">, </span><span class="s1">close</span><span class="s0">, </span><span class="s1">dates=</span><span class="s0">None, </span><span class="s1">direction=</span><span class="s3">&quot;both&quot;</span><span class="s0">, </span><span class="s1">**kwargs):</span>
    <span class="s2">&quot;&quot;&quot; 
    **deprecated**, use instead the plotly.graph_objects trace  
    :class:`plotly.graph_objects.Candlestick` 
 
    :param (list) open: opening values 
    :param (list) high: high values 
    :param (list) low: low values 
    :param (list) close: closing values 
    :param (list) dates: list of datetime objects. Default: None 
    :param (string) direction: direction can be 'increasing', 'decreasing', 
        or 'both'. When the direction is 'increasing', the returned figure 
        consists of all candlesticks where the close value is greater than 
        the corresponding open value, and when the direction is 
        'decreasing', the returned figure consists of all candlesticks 
        where the close value is less than or equal to the corresponding 
        open value. When the direction is 'both', both increasing and 
        decreasing candlesticks are returned. Default: 'both' 
    :param kwargs: kwargs passed through plotly.graph_objs.Scatter. 
        These kwargs describe other attributes about the ohlc Scatter trace 
        such as the color or the legend name. For more information on valid 
        kwargs call help(plotly.graph_objs.Scatter) 
 
    :rtype (dict): returns a representation of candlestick chart figure. 
 
    Example 1: Simple candlestick chart from a Pandas DataFrame 
 
    &gt;&gt;&gt; from plotly.figure_factory import create_candlestick 
    &gt;&gt;&gt; from datetime import datetime 
    &gt;&gt;&gt; import pandas as pd 
 
    &gt;&gt;&gt; df = pd.read_csv('https://raw.githubusercontent.com/plotly/datasets/master/finance-charts-apple.csv') 
    &gt;&gt;&gt; fig = create_candlestick(df['AAPL.Open'], df['AAPL.High'], df['AAPL.Low'], df['AAPL.Close'], 
    ...                          dates=df.index) 
    &gt;&gt;&gt; fig.show() 
 
    Example 2: Customize the candlestick colors 
 
    &gt;&gt;&gt; from plotly.figure_factory import create_candlestick 
    &gt;&gt;&gt; from plotly.graph_objs import Line, Marker 
    &gt;&gt;&gt; from datetime import datetime 
 
    &gt;&gt;&gt; import pandas as pd 
    &gt;&gt;&gt; df = pd.read_csv('https://raw.githubusercontent.com/plotly/datasets/master/finance-charts-apple.csv') 
 
    &gt;&gt;&gt; # Make increasing candlesticks and customize their color and name 
    &gt;&gt;&gt; fig_increasing = create_candlestick(df['AAPL.Open'], df['AAPL.High'], df['AAPL.Low'], df['AAPL.Close'], 
    ...     dates=df.index, 
    ...     direction='increasing', name='AAPL', 
    ...     marker=Marker(color='rgb(150, 200, 250)'), 
    ...     line=Line(color='rgb(150, 200, 250)')) 
 
    &gt;&gt;&gt; # Make decreasing candlesticks and customize their color and name 
    &gt;&gt;&gt; fig_decreasing = create_candlestick(df['AAPL.Open'], df['AAPL.High'], df['AAPL.Low'], df['AAPL.Close'], 
    ...     dates=df.index, 
    ...     direction='decreasing', 
    ...     marker=Marker(color='rgb(128, 128, 128)'), 
    ...     line=Line(color='rgb(128, 128, 128)')) 
 
    &gt;&gt;&gt; # Initialize the figure 
    &gt;&gt;&gt; fig = fig_increasing 
 
    &gt;&gt;&gt; # Add decreasing data with .extend() 
    &gt;&gt;&gt; fig.add_trace(fig_decreasing['data']) # doctest: +SKIP 
    &gt;&gt;&gt; fig.show() 
 
    Example 3: Candlestick chart with datetime objects 
  
    &gt;&gt;&gt; from plotly.figure_factory import create_candlestick 
 
    &gt;&gt;&gt; from datetime import datetime 
 
    &gt;&gt;&gt; # Add data 
    &gt;&gt;&gt; open_data = [33.0, 33.3, 33.5, 33.0, 34.1] 
    &gt;&gt;&gt; high_data = [33.1, 33.3, 33.6, 33.2, 34.8] 
    &gt;&gt;&gt; low_data = [32.7, 32.7, 32.8, 32.6, 32.8] 
    &gt;&gt;&gt; close_data = [33.0, 32.9, 33.3, 33.1, 33.1] 
    &gt;&gt;&gt; dates = [datetime(year=2013, month=10, day=10), 
    ...          datetime(year=2013, month=11, day=10), 
    ...          datetime(year=2013, month=12, day=10), 
    ...          datetime(year=2014, month=1, day=10), 
    ...          datetime(year=2014, month=2, day=10)] 
 
    &gt;&gt;&gt; # Create ohlc 
    &gt;&gt;&gt; fig = create_candlestick(open_data, high_data, 
    ...     low_data, close_data, dates=dates) 
    &gt;&gt;&gt; fig.show() 
    &quot;&quot;&quot;</span>
    <span class="s0">if </span><span class="s1">dates </span><span class="s0">is not None</span><span class="s1">:</span>
        <span class="s1">utils.validate_equal_length(open</span><span class="s0">, </span><span class="s1">high</span><span class="s0">, </span><span class="s1">low</span><span class="s0">, </span><span class="s1">close</span><span class="s0">, </span><span class="s1">dates)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">utils.validate_equal_length(open</span><span class="s0">, </span><span class="s1">high</span><span class="s0">, </span><span class="s1">low</span><span class="s0">, </span><span class="s1">close)</span>
    <span class="s1">validate_ohlc(open</span><span class="s0">, </span><span class="s1">high</span><span class="s0">, </span><span class="s1">low</span><span class="s0">, </span><span class="s1">close</span><span class="s0">, </span><span class="s1">direction</span><span class="s0">, </span><span class="s1">**kwargs)</span>

    <span class="s0">if </span><span class="s1">direction == </span><span class="s3">&quot;increasing&quot;</span><span class="s1">:</span>
        <span class="s1">candle_incr_data = make_increasing_candle(</span>
            <span class="s1">open</span><span class="s0">, </span><span class="s1">high</span><span class="s0">, </span><span class="s1">low</span><span class="s0">, </span><span class="s1">close</span><span class="s0">, </span><span class="s1">dates</span><span class="s0">, </span><span class="s1">**kwargs</span>
        <span class="s1">)</span>
        <span class="s1">data = candle_incr_data</span>
    <span class="s0">elif </span><span class="s1">direction == </span><span class="s3">&quot;decreasing&quot;</span><span class="s1">:</span>
        <span class="s1">candle_decr_data = make_decreasing_candle(</span>
            <span class="s1">open</span><span class="s0">, </span><span class="s1">high</span><span class="s0">, </span><span class="s1">low</span><span class="s0">, </span><span class="s1">close</span><span class="s0">, </span><span class="s1">dates</span><span class="s0">, </span><span class="s1">**kwargs</span>
        <span class="s1">)</span>
        <span class="s1">data = candle_decr_data</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">candle_incr_data = make_increasing_candle(</span>
            <span class="s1">open</span><span class="s0">, </span><span class="s1">high</span><span class="s0">, </span><span class="s1">low</span><span class="s0">, </span><span class="s1">close</span><span class="s0">, </span><span class="s1">dates</span><span class="s0">, </span><span class="s1">**kwargs</span>
        <span class="s1">)</span>
        <span class="s1">candle_decr_data = make_decreasing_candle(</span>
            <span class="s1">open</span><span class="s0">, </span><span class="s1">high</span><span class="s0">, </span><span class="s1">low</span><span class="s0">, </span><span class="s1">close</span><span class="s0">, </span><span class="s1">dates</span><span class="s0">, </span><span class="s1">**kwargs</span>
        <span class="s1">)</span>
        <span class="s1">data = candle_incr_data + candle_decr_data</span>

    <span class="s1">layout = graph_objs.Layout()</span>
    <span class="s0">return </span><span class="s1">graph_objs.Figure(data=data</span><span class="s0">, </span><span class="s1">layout=layout)</span>


<span class="s0">class </span><span class="s1">_Candlestick(object):</span>
    <span class="s2">&quot;&quot;&quot; 
    Refer to FigureFactory.create_candlestick() for docstring. 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">open</span><span class="s0">, </span><span class="s1">high</span><span class="s0">, </span><span class="s1">low</span><span class="s0">, </span><span class="s1">close</span><span class="s0">, </span><span class="s1">dates</span><span class="s0">, </span><span class="s1">**kwargs):</span>
        <span class="s1">self.open = open</span>
        <span class="s1">self.high = high</span>
        <span class="s1">self.low = low</span>
        <span class="s1">self.close = close</span>
        <span class="s0">if </span><span class="s1">dates </span><span class="s0">is not None</span><span class="s1">:</span>
            <span class="s1">self.x = dates</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">self.x = [x </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range(len(self.open))]</span>
        <span class="s1">self.get_candle_increase()</span>

    <span class="s0">def </span><span class="s1">get_candle_increase(self):</span>
        <span class="s2">&quot;&quot;&quot; 
        Separate increasing data from decreasing data. 
 
        The data is increasing when close value &gt; open value 
        and decreasing when the close value &lt;= open value. 
        &quot;&quot;&quot;</span>
        <span class="s1">increase_y = []</span>
        <span class="s1">increase_x = []</span>
        <span class="s0">for </span><span class="s1">index </span><span class="s0">in </span><span class="s1">range(len(self.open)):</span>
            <span class="s0">if </span><span class="s1">self.close[index] &gt; self.open[index]:</span>
                <span class="s1">increase_y.append(self.low[index])</span>
                <span class="s1">increase_y.append(self.open[index])</span>
                <span class="s1">increase_y.append(self.close[index])</span>
                <span class="s1">increase_y.append(self.close[index])</span>
                <span class="s1">increase_y.append(self.close[index])</span>
                <span class="s1">increase_y.append(self.high[index])</span>
                <span class="s1">increase_x.append(self.x[index])</span>

        <span class="s1">increase_x = [[x</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">x] </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">increase_x]</span>
        <span class="s1">increase_x = utils.flatten(increase_x)</span>

        <span class="s0">return </span><span class="s1">increase_x</span><span class="s0">, </span><span class="s1">increase_y</span>

    <span class="s0">def </span><span class="s1">get_candle_decrease(self):</span>
        <span class="s2">&quot;&quot;&quot; 
        Separate increasing data from decreasing data. 
 
        The data is increasing when close value &gt; open value 
        and decreasing when the close value &lt;= open value. 
        &quot;&quot;&quot;</span>
        <span class="s1">decrease_y = []</span>
        <span class="s1">decrease_x = []</span>
        <span class="s0">for </span><span class="s1">index </span><span class="s0">in </span><span class="s1">range(len(self.open)):</span>
            <span class="s0">if </span><span class="s1">self.close[index] &lt;= self.open[index]:</span>
                <span class="s1">decrease_y.append(self.low[index])</span>
                <span class="s1">decrease_y.append(self.open[index])</span>
                <span class="s1">decrease_y.append(self.close[index])</span>
                <span class="s1">decrease_y.append(self.close[index])</span>
                <span class="s1">decrease_y.append(self.close[index])</span>
                <span class="s1">decrease_y.append(self.high[index])</span>
                <span class="s1">decrease_x.append(self.x[index])</span>

        <span class="s1">decrease_x = [[x</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">x] </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">decrease_x]</span>
        <span class="s1">decrease_x = utils.flatten(decrease_x)</span>

        <span class="s0">return </span><span class="s1">decrease_x</span><span class="s0">, </span><span class="s1">decrease_y</span>
</pre>
</body>
</html>