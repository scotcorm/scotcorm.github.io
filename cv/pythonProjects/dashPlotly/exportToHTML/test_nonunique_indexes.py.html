<html>
<head>
<title>test_nonunique_indexes.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_nonunique_indexes.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">DataFrame</span><span class="s0">,</span>
    <span class="s1">Series</span><span class="s0">,</span>
    <span class="s1">date_range</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">pandas._testing </span><span class="s0">as </span><span class="s1">tm</span>


<span class="s0">def </span><span class="s1">check(result</span><span class="s0">, </span><span class="s1">expected=</span><span class="s0">None</span><span class="s1">):</span>
    <span class="s0">if </span><span class="s1">expected </span><span class="s0">is not None</span><span class="s1">:</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
    <span class="s1">result.dtypes</span>
    <span class="s1">str(result)</span>


<span class="s0">class </span><span class="s1">TestDataFrameNonuniqueIndexes:</span>
    <span class="s0">def </span><span class="s1">test_setattr_columns_vs_construct_with_columns(self):</span>

        <span class="s2"># assignment</span>
        <span class="s2"># GH 3687</span>
        <span class="s1">arr = np.random.randn(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">idx = list(range(</span><span class="s3">2</span><span class="s1">))</span>
        <span class="s1">df = DataFrame(arr</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s4">&quot;A&quot;</span><span class="s1">])</span>
        <span class="s1">df.columns = idx</span>
        <span class="s1">expected = DataFrame(arr</span><span class="s0">, </span><span class="s1">columns=idx)</span>
        <span class="s1">check(df</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_setattr_columns_vs_construct_with_columns_datetimeindx(self):</span>
        <span class="s1">idx = date_range(</span><span class="s4">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">freq=</span><span class="s4">&quot;Q-NOV&quot;</span><span class="s1">)</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">df.columns = idx</span>
        <span class="s1">expected = DataFrame([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">columns=idx)</span>
        <span class="s1">check(df</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_insert_with_duplicate_columns(self):</span>
        <span class="s2"># insert</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;bar&quot;</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;hello&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">df[</span><span class="s4">&quot;string&quot;</span><span class="s1">] = </span><span class="s4">&quot;bah&quot;</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;bar&quot;</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;hello&quot;</span><span class="s0">, </span><span class="s4">&quot;string&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">check(df</span><span class="s0">, </span><span class="s1">expected)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">&quot;Length of value&quot;</span><span class="s1">):</span>
            <span class="s1">df.insert(</span><span class="s3">0</span><span class="s0">, </span><span class="s4">&quot;AnotherColumn&quot;</span><span class="s0">, </span><span class="s1">range(len(df.index) - </span><span class="s3">1</span><span class="s1">))</span>

        <span class="s2"># insert same dtype</span>
        <span class="s1">df[</span><span class="s4">&quot;foo2&quot;</span><span class="s1">] = </span><span class="s3">3</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;bar&quot;</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;hello&quot;</span><span class="s0">, </span><span class="s4">&quot;string&quot;</span><span class="s0">, </span><span class="s4">&quot;foo2&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">check(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># set (non-dup)</span>
        <span class="s1">df[</span><span class="s4">&quot;foo2&quot;</span><span class="s1">] = </span><span class="s3">4</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;bar&quot;</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;hello&quot;</span><span class="s0">, </span><span class="s4">&quot;string&quot;</span><span class="s0">, </span><span class="s4">&quot;foo2&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">check(df</span><span class="s0">, </span><span class="s1">expected)</span>
        <span class="s1">df[</span><span class="s4">&quot;foo2&quot;</span><span class="s1">] = </span><span class="s3">3</span>

        <span class="s2"># delete (non dup)</span>
        <span class="s0">del </span><span class="s1">df[</span><span class="s4">&quot;bar&quot;</span><span class="s1">]</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;hello&quot;</span><span class="s0">, </span><span class="s4">&quot;string&quot;</span><span class="s0">, </span><span class="s4">&quot;foo2&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">check(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># try to delete again (its not consolidated)</span>
        <span class="s0">del </span><span class="s1">df[</span><span class="s4">&quot;hello&quot;</span><span class="s1">]</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;string&quot;</span><span class="s0">, </span><span class="s4">&quot;foo2&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">check(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># consolidate</span>
        <span class="s1">df = df._consolidate()</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;string&quot;</span><span class="s0">, </span><span class="s4">&quot;foo2&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">check(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># insert</span>
        <span class="s1">df.insert(</span><span class="s3">2</span><span class="s0">, </span><span class="s4">&quot;new_col&quot;</span><span class="s0">, </span><span class="s3">5.0</span><span class="s1">)</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">5.0</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">5.0</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">5.0</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;new_col&quot;</span><span class="s0">, </span><span class="s4">&quot;string&quot;</span><span class="s0">, </span><span class="s4">&quot;foo2&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">check(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># insert a dup</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">&quot;cannot insert&quot;</span><span class="s1">):</span>
            <span class="s1">df.insert(</span><span class="s3">2</span><span class="s0">, </span><span class="s4">&quot;new_col&quot;</span><span class="s0">, </span><span class="s3">4.0</span><span class="s1">)</span>

        <span class="s1">df.insert(</span><span class="s3">2</span><span class="s0">, </span><span class="s4">&quot;new_col&quot;</span><span class="s0">, </span><span class="s3">4.0</span><span class="s0">, </span><span class="s1">allow_duplicates=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[</span>
                <span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">5.0</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">5.0</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">5.0</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;new_col&quot;</span><span class="s0">, </span><span class="s4">&quot;new_col&quot;</span><span class="s0">, </span><span class="s4">&quot;string&quot;</span><span class="s0">, </span><span class="s4">&quot;foo2&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">check(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># delete (dup)</span>
        <span class="s0">del </span><span class="s1">df[</span><span class="s4">&quot;foo&quot;</span><span class="s1">]</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[[</span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">5.0</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">5.0</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">5.0</span><span class="s0">, </span><span class="s4">&quot;bah&quot;</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s4">&quot;new_col&quot;</span><span class="s0">, </span><span class="s4">&quot;new_col&quot;</span><span class="s0">, </span><span class="s4">&quot;string&quot;</span><span class="s0">, </span><span class="s4">&quot;foo2&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_dup_across_dtypes(self):</span>
        <span class="s2"># dup across dtypes</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2.0</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3.0</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;bar&quot;</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;hello&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">check(df)</span>

        <span class="s1">df[</span><span class="s4">&quot;foo2&quot;</span><span class="s1">] = </span><span class="s3">7.0</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">7.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2.0</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">7.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3.0</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">7.0</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;bar&quot;</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;hello&quot;</span><span class="s0">, </span><span class="s4">&quot;foo2&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">check(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">result = df[</span><span class="s4">&quot;foo&quot;</span><span class="s1">]</span>
        <span class="s1">expected = DataFrame([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3.0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s1">])</span>
        <span class="s1">check(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># multiple replacements</span>
        <span class="s1">df[</span><span class="s4">&quot;foo&quot;</span><span class="s1">] = </span><span class="s4">&quot;string&quot;</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[</span>
                <span class="s1">[</span><span class="s4">&quot;string&quot;</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s4">&quot;string&quot;</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">7.0</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">&quot;string&quot;</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s4">&quot;string&quot;</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">7.0</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">&quot;string&quot;</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s4">&quot;string&quot;</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">7.0</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;bar&quot;</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;hello&quot;</span><span class="s0">, </span><span class="s4">&quot;foo2&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">check(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s0">del </span><span class="s1">df[</span><span class="s4">&quot;foo&quot;</span><span class="s1">]</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">7.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">7.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">7.0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">&quot;bar&quot;</span><span class="s0">, </span><span class="s4">&quot;hello&quot;</span><span class="s0">, </span><span class="s4">&quot;foo2&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">check(df</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_column_dups_indexes(self):</span>
        <span class="s2"># check column dups with index equal and not equal to df's index</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">np.random.randn(</span><span class="s3">5</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">index=[</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;c&quot;</span><span class="s0">, </span><span class="s4">&quot;d&quot;</span><span class="s0">, </span><span class="s4">&quot;e&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s4">&quot;B&quot;</span><span class="s0">, </span><span class="s4">&quot;A&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s0">for </span><span class="s1">index </span><span class="s0">in </span><span class="s1">[df.index</span><span class="s0">, </span><span class="s1">pd.Index(list(</span><span class="s4">&quot;edcba&quot;</span><span class="s1">))]:</span>
            <span class="s1">this_df = df.copy()</span>
            <span class="s1">expected_ser = Series(index.values</span><span class="s0">, </span><span class="s1">index=this_df.index)</span>
            <span class="s1">expected_df = DataFrame(</span>
                <span class="s1">{</span><span class="s4">&quot;A&quot;</span><span class="s1">: expected_ser</span><span class="s0">, </span><span class="s4">&quot;B&quot;</span><span class="s1">: this_df[</span><span class="s4">&quot;B&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s4">&quot;A&quot;</span><span class="s1">: expected_ser}</span><span class="s0">,</span>
                <span class="s1">columns=[</span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s4">&quot;B&quot;</span><span class="s0">, </span><span class="s4">&quot;A&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">)</span>
            <span class="s1">this_df[</span><span class="s4">&quot;A&quot;</span><span class="s1">] = index</span>
            <span class="s1">check(this_df</span><span class="s0">, </span><span class="s1">expected_df)</span>

    <span class="s0">def </span><span class="s1">test_changing_dtypes_with_duplicate_columns(self):</span>
        <span class="s2"># multiple assignments that change dtypes</span>
        <span class="s2"># the location indexer is a slice</span>
        <span class="s2"># GH 6120</span>
        <span class="s1">df = DataFrame(np.random.randn(</span><span class="s3">5</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">&quot;that&quot;</span><span class="s0">, </span><span class="s4">&quot;that&quot;</span><span class="s1">])</span>
        <span class="s1">expected = DataFrame(</span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">index=range(</span><span class="s3">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">&quot;that&quot;</span><span class="s0">, </span><span class="s4">&quot;that&quot;</span><span class="s1">])</span>

        <span class="s1">df[</span><span class="s4">&quot;that&quot;</span><span class="s1">] = </span><span class="s3">1.0</span>
        <span class="s1">check(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">df = DataFrame(np.random.rand(</span><span class="s3">5</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">&quot;that&quot;</span><span class="s0">, </span><span class="s4">&quot;that&quot;</span><span class="s1">])</span>
        <span class="s1">expected = DataFrame(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">index=range(</span><span class="s3">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">&quot;that&quot;</span><span class="s0">, </span><span class="s4">&quot;that&quot;</span><span class="s1">])</span>

        <span class="s1">df[</span><span class="s4">&quot;that&quot;</span><span class="s1">] = </span><span class="s3">1</span>
        <span class="s1">check(df</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_dup_columns_comparisons(self):</span>
        <span class="s2"># equality</span>
        <span class="s1">df1 = DataFrame([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">4</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s4">&quot;B&quot;</span><span class="s1">])</span>
        <span class="s1">df2 = DataFrame([[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s4">&quot;A&quot;</span><span class="s1">])</span>

        <span class="s2"># not-comparing like-labelled</span>
        <span class="s1">msg = </span><span class="s4">&quot;Can only compare identically-labeled DataFrame objects&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">df1 == df2</span>

        <span class="s1">df1r = df1.reindex_like(df2)</span>
        <span class="s1">result = df1r == df2</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[[</span><span class="s0">False, True</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s4">&quot;A&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_mixed_column_selection(self):</span>
        <span class="s2"># mixed column selection</span>
        <span class="s2"># GH 5639</span>
        <span class="s1">dfbool = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s4">&quot;one&quot;</span><span class="s1">: Series([</span><span class="s0">True, True, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;c&quot;</span><span class="s1">])</span><span class="s0">,</span>
                <span class="s4">&quot;two&quot;</span><span class="s1">: Series([</span><span class="s0">False, False, True, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;c&quot;</span><span class="s0">, </span><span class="s4">&quot;d&quot;</span><span class="s1">])</span><span class="s0">,</span>
                <span class="s4">&quot;three&quot;</span><span class="s1">: Series([</span><span class="s0">False, True, True, True</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;c&quot;</span><span class="s0">, </span><span class="s4">&quot;d&quot;</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
        <span class="s1">expected = pd.concat([dfbool[</span><span class="s4">&quot;one&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dfbool[</span><span class="s4">&quot;three&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dfbool[</span><span class="s4">&quot;one&quot;</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">result = dfbool[[</span><span class="s4">&quot;one&quot;</span><span class="s0">, </span><span class="s4">&quot;three&quot;</span><span class="s0">, </span><span class="s4">&quot;one&quot;</span><span class="s1">]]</span>
        <span class="s1">check(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_multi_axis_dups(self):</span>
        <span class="s2"># multi-axis dups</span>
        <span class="s2"># GH 6121</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">np.arange(</span><span class="s3">25.0</span><span class="s1">).reshape(</span><span class="s3">5</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">index=[</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;c&quot;</span><span class="s0">, </span><span class="s4">&quot;d&quot;</span><span class="s0">, </span><span class="s4">&quot;e&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s4">&quot;B&quot;</span><span class="s0">, </span><span class="s4">&quot;C&quot;</span><span class="s0">, </span><span class="s4">&quot;D&quot;</span><span class="s0">, </span><span class="s4">&quot;E&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">z = df[[</span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s4">&quot;C&quot;</span><span class="s0">, </span><span class="s4">&quot;A&quot;</span><span class="s1">]].copy()</span>
        <span class="s1">expected = z.loc[[</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;c&quot;</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s1">]]</span>

        <span class="s1">df = DataFrame(</span>
            <span class="s1">np.arange(</span><span class="s3">25.0</span><span class="s1">).reshape(</span><span class="s3">5</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">index=[</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;c&quot;</span><span class="s0">, </span><span class="s4">&quot;d&quot;</span><span class="s0">, </span><span class="s4">&quot;e&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s4">&quot;B&quot;</span><span class="s0">, </span><span class="s4">&quot;C&quot;</span><span class="s0">, </span><span class="s4">&quot;D&quot;</span><span class="s0">, </span><span class="s4">&quot;E&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">z = df[[</span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s4">&quot;C&quot;</span><span class="s0">, </span><span class="s4">&quot;A&quot;</span><span class="s1">]]</span>
        <span class="s1">result = z.loc[[</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;c&quot;</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s1">]]</span>
        <span class="s1">check(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_columns_with_dups(self):</span>
        <span class="s2"># GH 3468 related</span>

        <span class="s2"># basic</span>
        <span class="s1">df = DataFrame([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s1">])</span>
        <span class="s1">df.columns = [</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;a.1&quot;</span><span class="s1">]</span>
        <span class="s1">str(df)</span>
        <span class="s1">expected = DataFrame([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;a.1&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">df = DataFrame([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s1">])</span>
        <span class="s1">df.columns = [</span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;a.1&quot;</span><span class="s1">]</span>
        <span class="s1">str(df)</span>
        <span class="s1">expected = DataFrame([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;a.1&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_columns_with_dup_index(self):</span>
        <span class="s2"># with a dup index</span>
        <span class="s1">df = DataFrame([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s1">])</span>
        <span class="s1">df.columns = [</span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;b&quot;</span><span class="s1">]</span>
        <span class="s1">str(df)</span>
        <span class="s1">expected = DataFrame([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;b&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_multi_dtype(self):</span>
        <span class="s2"># multi-dtype</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2.0</span><span class="s0">, </span><span class="s3">3.0</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;bar&quot;</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">columns=[</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;d&quot;</span><span class="s0">, </span><span class="s4">&quot;c&quot;</span><span class="s0">, </span><span class="s4">&quot;c&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">df.columns = list(</span><span class="s4">&quot;ABCDEFG&quot;</span><span class="s1">)</span>
        <span class="s1">str(df)</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2.0</span><span class="s0">, </span><span class="s3">3.0</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;bar&quot;</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">columns=list(</span><span class="s4">&quot;ABCDEFG&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_multi_dtype2(self):</span>
        <span class="s1">df = DataFrame([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;bar&quot;</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s1">])</span>
        <span class="s1">df.columns = [</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;a.1&quot;</span><span class="s0">, </span><span class="s4">&quot;a.2&quot;</span><span class="s0">, </span><span class="s4">&quot;a.3&quot;</span><span class="s1">]</span>
        <span class="s1">str(df)</span>
        <span class="s1">expected = DataFrame([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;bar&quot;</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;a.1&quot;</span><span class="s0">, </span><span class="s4">&quot;a.2&quot;</span><span class="s0">, </span><span class="s4">&quot;a.3&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_dups_across_blocks(self</span><span class="s0">, </span><span class="s1">using_array_manager):</span>
        <span class="s2"># dups across blocks</span>
        <span class="s1">df_float = DataFrame(np.random.randn(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">&quot;float64&quot;</span><span class="s1">)</span>
        <span class="s1">df_int = DataFrame(np.random.randn(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">3</span><span class="s1">).astype(</span><span class="s4">&quot;int64&quot;</span><span class="s1">))</span>
        <span class="s1">df_bool = DataFrame(</span><span class="s0">True, </span><span class="s1">index=df_float.index</span><span class="s0">, </span><span class="s1">columns=df_float.columns)</span>
        <span class="s1">df_object = DataFrame(</span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">index=df_float.index</span><span class="s0">, </span><span class="s1">columns=df_float.columns)</span>
        <span class="s1">df_dt = DataFrame(</span>
            <span class="s1">pd.Timestamp(</span><span class="s4">&quot;20010101&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=df_float.index</span><span class="s0">, </span><span class="s1">columns=df_float.columns</span>
        <span class="s1">)</span>
        <span class="s1">df = pd.concat([df_float</span><span class="s0">, </span><span class="s1">df_int</span><span class="s0">, </span><span class="s1">df_bool</span><span class="s0">, </span><span class="s1">df_object</span><span class="s0">, </span><span class="s1">df_dt]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span>

        <span class="s0">if not </span><span class="s1">using_array_manager:</span>
            <span class="s0">assert </span><span class="s1">len(df._mgr.blknos) == len(df.columns)</span>
            <span class="s0">assert </span><span class="s1">len(df._mgr.blklocs) == len(df.columns)</span>

        <span class="s2"># testing iloc</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(len(df.columns)):</span>
            <span class="s1">df.iloc[:</span><span class="s0">, </span><span class="s1">i]</span>

    <span class="s0">def </span><span class="s1">test_dup_columns_across_dtype(self):</span>
        <span class="s2"># dup columns across dtype GH 2079/2194</span>
        <span class="s1">vals = [[</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s1">-</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3.0</span><span class="s1">]]</span>
        <span class="s1">rs = DataFrame(vals</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s4">&quot;B&quot;</span><span class="s1">])</span>
        <span class="s1">xp = DataFrame(vals)</span>
        <span class="s1">xp.columns = [</span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s4">&quot;B&quot;</span><span class="s1">]</span>
        <span class="s1">tm.assert_frame_equal(rs</span><span class="s0">, </span><span class="s1">xp)</span>

    <span class="s0">def </span><span class="s1">test_set_value_by_index(self):</span>
        <span class="s2"># See gh-12344</span>
        <span class="s1">df = DataFrame(np.arange(</span><span class="s3">9</span><span class="s1">).reshape(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">).T)</span>
        <span class="s1">df.columns = list(</span><span class="s4">&quot;AAA&quot;</span><span class="s1">)</span>
        <span class="s1">expected = df.iloc[:</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span>

        <span class="s1">df.iloc[:</span><span class="s0">, </span><span class="s3">0</span><span class="s1">] = </span><span class="s3">3</span>
        <span class="s1">tm.assert_series_equal(df.iloc[:</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">df = DataFrame(np.arange(</span><span class="s3">9</span><span class="s1">).reshape(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">).T)</span>
        <span class="s1">df.columns = [</span><span class="s3">2</span><span class="s0">, </span><span class="s1">float(</span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">str(</span><span class="s3">2</span><span class="s1">)]</span>
        <span class="s1">expected = df.iloc[:</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>

        <span class="s1">df.iloc[:</span><span class="s0">, </span><span class="s3">0</span><span class="s1">] = </span><span class="s3">3</span>
        <span class="s1">tm.assert_series_equal(df.iloc[:</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected)</span>
</pre>
</body>
</html>