<html>
<head>
<title>util.pxd</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #a9b7c6;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
util.pxd</font>
</center></td></tr></table>
<pre>
<span class="s0">from cpython.object cimport PyTypeObject</span>


<span class="s0">cdef extern from *:</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0">PyObject* char_to_string(const char* data) {</span>
        <span class="s0">return PyUnicode_FromString(data);</span>
    <span class="s0">}</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0">object char_to_string(const char* data)</span>


<span class="s0">cdef extern from &quot;Python.h&quot;:</span>
    <span class="s0"># Note: importing extern-style allows us to declare these as nogil</span>
    <span class="s0"># functions, whereas `from cpython cimport` does not.</span>
    <span class="s0">bint PyUnicode_Check(object obj) nogil</span>
    <span class="s0">bint PyBool_Check(object obj) nogil</span>
    <span class="s0">bint PyFloat_Check(object obj) nogil</span>
    <span class="s0">bint PyComplex_Check(object obj) nogil</span>
    <span class="s0">bint PyObject_TypeCheck(object obj, PyTypeObject* type) nogil</span>

    <span class="s0"># Note that following functions can potentially raise an exception,</span>
    <span class="s0"># thus they cannot be declared 'nogil'. Also PyUnicode_AsUTF8AndSize() can</span>
    <span class="s0"># potentially allocate memory inside in unlikely case of when underlying</span>
    <span class="s0"># unicode object was stored as non-utf8 and utf8 wasn't requested before.</span>
    <span class="s0">const char* PyUnicode_AsUTF8AndSize(object obj,</span>
                                        <span class="s0">Py_ssize_t* length) except NULL</span>

<span class="s0">from numpy cimport (</span>
    <span class="s0">float64_t,</span>
    <span class="s0">int64_t,</span>
<span class="s0">)</span>


<span class="s0">cdef extern from &quot;numpy/arrayobject.h&quot;:</span>
    <span class="s0">PyTypeObject PyFloatingArrType_Type</span>

<span class="s0">cdef extern from &quot;numpy/ndarrayobject.h&quot;:</span>
    <span class="s0">PyTypeObject PyTimedeltaArrType_Type</span>
    <span class="s0">PyTypeObject PyDatetimeArrType_Type</span>
    <span class="s0">PyTypeObject PyComplexFloatingArrType_Type</span>
    <span class="s0">PyTypeObject PyBoolArrType_Type</span>

    <span class="s0">bint PyArray_IsIntegerScalar(obj) nogil</span>
    <span class="s0">bint PyArray_Check(obj) nogil</span>

<span class="s0">cdef extern from &quot;numpy/npy_common.h&quot;:</span>
    <span class="s0">int64_t NPY_MIN_INT64</span>


<span class="s0">cdef inline int64_t get_nat():</span>
    <span class="s0">return NPY_MIN_INT64</span>


<span class="s0"># --------------------------------------------------------------------</span>
<span class="s0"># Type Checking</span>

<span class="s0">cdef inline bint is_integer_object(object obj) nogil:</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0">Cython equivalent of</span>

    <span class="s0">`isinstance(val, (int, long, np.integer)) and not isinstance(val, bool)`</span>

    <span class="s0">Parameters</span>
    <span class="s0">----------</span>
    <span class="s0">val : object</span>

    <span class="s0">Returns</span>
    <span class="s0">-------</span>
    <span class="s0">is_integer : bool</span>

    <span class="s0">Notes</span>
    <span class="s0">-----</span>
    <span class="s0">This counts np.timedelta64 objects as integers.</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0">return (not PyBool_Check(obj) and PyArray_IsIntegerScalar(obj)</span>
            <span class="s0">and not is_timedelta64_object(obj))</span>


<span class="s0">cdef inline bint is_float_object(object obj) nogil:</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0">Cython equivalent of `isinstance(val, (float, np.complex_))`</span>

    <span class="s0">Parameters</span>
    <span class="s0">----------</span>
    <span class="s0">val : object</span>

    <span class="s0">Returns</span>
    <span class="s0">-------</span>
    <span class="s0">is_float : bool</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0">return (PyFloat_Check(obj) or</span>
            <span class="s0">(PyObject_TypeCheck(obj, &amp;PyFloatingArrType_Type)))</span>


<span class="s0">cdef inline bint is_complex_object(object obj) nogil:</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0">Cython equivalent of `isinstance(val, (complex, np.complex_))`</span>

    <span class="s0">Parameters</span>
    <span class="s0">----------</span>
    <span class="s0">val : object</span>

    <span class="s0">Returns</span>
    <span class="s0">-------</span>
    <span class="s0">is_complex : bool</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0">return (PyComplex_Check(obj) or</span>
            <span class="s0">PyObject_TypeCheck(obj, &amp;PyComplexFloatingArrType_Type))</span>


<span class="s0">cdef inline bint is_bool_object(object obj) nogil:</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0">Cython equivalent of `isinstance(val, (bool, np.bool_))`</span>

    <span class="s0">Parameters</span>
    <span class="s0">----------</span>
    <span class="s0">val : object</span>

    <span class="s0">Returns</span>
    <span class="s0">-------</span>
    <span class="s0">is_bool : bool</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0">return (PyBool_Check(obj) or</span>
            <span class="s0">PyObject_TypeCheck(obj, &amp;PyBoolArrType_Type))</span>


<span class="s0">cdef inline bint is_real_number_object(object obj) nogil:</span>
    <span class="s0">return is_bool_object(obj) or is_integer_object(obj) or is_float_object(obj)</span>


<span class="s0">cdef inline bint is_timedelta64_object(object obj) nogil:</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0">Cython equivalent of `isinstance(val, np.timedelta64)`</span>

    <span class="s0">Parameters</span>
    <span class="s0">----------</span>
    <span class="s0">val : object</span>

    <span class="s0">Returns</span>
    <span class="s0">-------</span>
    <span class="s0">is_timedelta64 : bool</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0">return PyObject_TypeCheck(obj, &amp;PyTimedeltaArrType_Type)</span>


<span class="s0">cdef inline bint is_datetime64_object(object obj) nogil:</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0">Cython equivalent of `isinstance(val, np.datetime64)`</span>

    <span class="s0">Parameters</span>
    <span class="s0">----------</span>
    <span class="s0">val : object</span>

    <span class="s0">Returns</span>
    <span class="s0">-------</span>
    <span class="s0">is_datetime64 : bool</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0">return PyObject_TypeCheck(obj, &amp;PyDatetimeArrType_Type)</span>


<span class="s0">cdef inline bint is_array(object val):</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0">Cython equivalent of `isinstance(val, np.ndarray)`</span>

    <span class="s0">Parameters</span>
    <span class="s0">----------</span>
    <span class="s0">val : object</span>

    <span class="s0">Returns</span>
    <span class="s0">-------</span>
    <span class="s0">is_ndarray : bool</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0">return PyArray_Check(val)</span>


<span class="s0">cdef inline bint is_nan(object val):</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0">Check if val is a Not-A-Number float or complex, including</span>
    <span class="s0">float('NaN') and np.nan.</span>

    <span class="s0">Parameters</span>
    <span class="s0">----------</span>
    <span class="s0">val : object</span>

    <span class="s0">Returns</span>
    <span class="s0">-------</span>
    <span class="s0">is_nan : bool</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0">cdef float64_t fval</span>
    <span class="s0">if is_float_object(val):</span>
        <span class="s0">fval = val</span>
        <span class="s0">return fval != fval</span>
    <span class="s0">return is_complex_object(val) and val != val</span>


<span class="s0">cdef inline const char* get_c_string_buf_and_size(str py_string,</span>
                                                  <span class="s0">Py_ssize_t *length) except NULL:</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0">Extract internal char* buffer of unicode or bytes object `py_string` with</span>
    <span class="s0">getting length of this internal buffer saved in `length`.</span>

    <span class="s0">Notes</span>
    <span class="s0">-----</span>
    <span class="s0">Python object owns memory, thus returned char* must not be freed.</span>
    <span class="s0">`length` can be NULL if getting buffer length is not needed.</span>

    <span class="s0">Parameters</span>
    <span class="s0">----------</span>
    <span class="s0">py_string : str</span>
    <span class="s0">length : Py_ssize_t*</span>

    <span class="s0">Returns</span>
    <span class="s0">-------</span>
    <span class="s0">buf : const char*</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0">return PyUnicode_AsUTF8AndSize(py_string, length)</span>


<span class="s0">cdef inline const char* get_c_string(str py_string) except NULL:</span>
    <span class="s0">return get_c_string_buf_and_size(py_string, NULL)</span>
</pre>
</body>
</html>