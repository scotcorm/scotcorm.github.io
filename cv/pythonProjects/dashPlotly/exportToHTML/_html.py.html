<html>
<head>
<title>_html.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #808080;}
.s4 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
_html.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">uuid</span>
<span class="s0">import </span><span class="s1">os</span>
<span class="s0">from </span><span class="s1">pathlib </span><span class="s0">import </span><span class="s1">Path</span>
<span class="s0">import </span><span class="s1">webbrowser</span>

<span class="s0">import </span><span class="s1">six</span>

<span class="s0">from </span><span class="s1">_plotly_utils.optional_imports </span><span class="s0">import </span><span class="s1">get_module</span>
<span class="s0">from </span><span class="s1">plotly.io._utils </span><span class="s0">import </span><span class="s1">validate_coerce_fig_to_dict</span><span class="s0">, </span><span class="s1">plotly_cdn_url</span>
<span class="s0">from </span><span class="s1">plotly.offline.offline </span><span class="s0">import </span><span class="s1">_get_jconfig</span><span class="s0">, </span><span class="s1">get_plotlyjs</span>
<span class="s0">from </span><span class="s1">plotly </span><span class="s0">import </span><span class="s1">utils</span>

<span class="s1">_json = get_module(</span><span class="s2">&quot;json&quot;</span><span class="s1">)</span>


<span class="s3"># Build script to set global PlotlyConfig object. This must execute before</span>
<span class="s3"># plotly.js is loaded.</span>
<span class="s1">_window_plotly_config = </span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
</span><span class="s2">&lt;script type=&quot;text/javascript&quot;&gt;</span><span class="s0">\ 
</span><span class="s2">window.PlotlyConfig = {MathJaxConfig: 'local'};</span><span class="s0">\ 
</span><span class="s2">&lt;/script&gt;&quot;&quot;&quot;</span>

<span class="s1">_mathjax_config = </span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
</span><span class="s2">&lt;script type=&quot;text/javascript&quot;&gt;</span><span class="s0">\ 
</span><span class="s2">if (window.MathJax) {MathJax.Hub.Config({SVG: {font: &quot;STIX-Web&quot;}});}</span><span class="s0">\ 
</span><span class="s2">&lt;/script&gt;&quot;&quot;&quot;</span>


<span class="s0">def </span><span class="s1">to_html(</span>
    <span class="s1">fig</span><span class="s0">,</span>
    <span class="s1">config=</span><span class="s0">None,</span>
    <span class="s1">auto_play=</span><span class="s0">True,</span>
    <span class="s1">include_plotlyjs=</span><span class="s0">True,</span>
    <span class="s1">include_mathjax=</span><span class="s0">False,</span>
    <span class="s1">post_script=</span><span class="s0">None,</span>
    <span class="s1">full_html=</span><span class="s0">True,</span>
    <span class="s1">animation_opts=</span><span class="s0">None,</span>
    <span class="s1">default_width=</span><span class="s2">&quot;100%&quot;</span><span class="s0">,</span>
    <span class="s1">default_height=</span><span class="s2">&quot;100%&quot;</span><span class="s0">,</span>
    <span class="s1">validate=</span><span class="s0">True,</span>
    <span class="s1">div_id=</span><span class="s0">None,</span>
<span class="s1">):</span>
    <span class="s4">&quot;&quot;&quot; 
    Convert a figure to an HTML string representation. 
 
    Parameters 
    ---------- 
    fig: 
        Figure object or dict representing a figure 
    config: dict or None (default None) 
        Plotly.js figure config options 
    auto_play: bool (default=True) 
        Whether to automatically start the animation sequence on page load 
        if the figure contains frames. Has no effect if the figure does not 
        contain frames. 
    include_plotlyjs: bool or string (default True) 
        Specifies how the plotly.js library is included/loaded in the output 
        div string. 
 
        If True, a script tag containing the plotly.js source code (~3MB) 
        is included in the output.  HTML files generated with this option are 
        fully self-contained and can be used offline. 
 
        If 'cdn', a script tag that references the plotly.js CDN is included 
        in the output. The url used is versioned to match the bundled plotly.js. 
        HTML files generated with this option are about 3MB smaller than those 
        generated with include_plotlyjs=True, but they require an active 
        internet connection in order to load the plotly.js library. 
 
        If 'directory', a script tag is included that references an external 
        plotly.min.js bundle that is assumed to reside in the same 
        directory as the HTML file. 
 
        If 'require', Plotly.js is loaded using require.js.  This option 
        assumes that require.js is globally available and that it has been 
        globally configured to know how to find Plotly.js as 'plotly'. 
        This option is not advised when full_html=True as it will result 
        in a non-functional html file. 
 
        If a string that ends in '.js', a script tag is included that 
        references the specified path. This approach can be used to point 
        the resulting HTML file to an alternative CDN or local bundle. 
 
        If False, no script tag referencing plotly.js is included. This is 
        useful when the resulting div string will be placed inside an HTML 
        document that already loads plotly.js. This option is not advised 
        when full_html=True as it will result in a non-functional html file. 
    include_mathjax: bool or string (default False) 
        Specifies how the MathJax.js library is included in the output html 
        div string.  MathJax is required in order to display labels 
        with LaTeX typesetting. 
 
        If False, no script tag referencing MathJax.js will be included in the 
        output. 
 
        If 'cdn', a script tag that references a MathJax CDN location will be 
        included in the output.  HTML div strings generated with this option 
        will be able to display LaTeX typesetting as long as internet access 
        is available. 
 
        If a string that ends in '.js', a script tag is included that 
        references the specified path. This approach can be used to point the 
        resulting HTML div string to an alternative CDN. 
    post_script: str or list or None (default None) 
        JavaScript snippet(s) to be included in the resulting div just after 
        plot creation.  The string(s) may include '{plot_id}' placeholders 
        that will then be replaced by the `id` of the div element that the 
        plotly.js figure is associated with.  One application for this script 
        is to install custom plotly.js event handlers. 
    full_html: bool (default True) 
        If True, produce a string containing a complete HTML document 
        starting with an &lt;html&gt; tag.  If False, produce a string containing 
        a single &lt;div&gt; element. 
    animation_opts: dict or None (default None) 
        dict of custom animation parameters to be passed to the function 
        Plotly.animate in Plotly.js. See 
        https://github.com/plotly/plotly.js/blob/master/src/plots/animation_attributes.js 
        for available options. Has no effect if the figure does not contain 
        frames, or auto_play is False. 
    default_width, default_height: number or str (default '100%') 
        The default figure width/height to use if the provided figure does not 
        specify its own layout.width/layout.height property.  May be 
        specified in pixels as an integer (e.g. 500), or as a css width style 
        string (e.g. '500px', '100%'). 
    validate: bool (default True) 
        True if the figure should be validated before being converted to 
        JSON, False otherwise. 
    div_id: str (default None) 
        If provided, this is the value of the id attribute of the div tag. If None, the 
        id attribute is a UUID. 
 
    Returns 
    ------- 
    str 
        Representation of figure as an HTML div string 
    &quot;&quot;&quot;</span>
    <span class="s0">from </span><span class="s1">plotly.io.json </span><span class="s0">import </span><span class="s1">to_json_plotly</span>

    <span class="s3"># ## Validate figure ##</span>
    <span class="s1">fig_dict = validate_coerce_fig_to_dict(fig</span><span class="s0">, </span><span class="s1">validate)</span>

    <span class="s3"># ## Generate div id ##</span>
    <span class="s1">plotdivid = div_id </span><span class="s0">or </span><span class="s1">str(uuid.uuid4())</span>

    <span class="s3"># ## Serialize figure ##</span>
    <span class="s1">jdata = to_json_plotly(fig_dict.get(</span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s1">[]))</span>
    <span class="s1">jlayout = to_json_plotly(fig_dict.get(</span><span class="s2">&quot;layout&quot;</span><span class="s0">, </span><span class="s1">{}))</span>

    <span class="s0">if </span><span class="s1">fig_dict.get(</span><span class="s2">&quot;frames&quot;</span><span class="s0">, None</span><span class="s1">):</span>
        <span class="s1">jframes = to_json_plotly(fig_dict.get(</span><span class="s2">&quot;frames&quot;</span><span class="s0">, </span><span class="s1">[]))</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">jframes = </span><span class="s0">None</span>

    <span class="s3"># ## Serialize figure config ##</span>
    <span class="s1">config = _get_jconfig(config)</span>

    <span class="s3"># Set responsive</span>
    <span class="s1">config.setdefault(</span><span class="s2">&quot;responsive&quot;</span><span class="s0">, True</span><span class="s1">)</span>

    <span class="s3"># Get div width/height</span>
    <span class="s1">layout_dict = fig_dict.get(</span><span class="s2">&quot;layout&quot;</span><span class="s0">, </span><span class="s1">{})</span>
    <span class="s1">template_dict = fig_dict.get(</span><span class="s2">&quot;layout&quot;</span><span class="s0">, </span><span class="s1">{}).get(</span><span class="s2">&quot;template&quot;</span><span class="s0">, </span><span class="s1">{}).get(</span><span class="s2">&quot;layout&quot;</span><span class="s0">, </span><span class="s1">{})</span>

    <span class="s1">div_width = layout_dict.get(</span><span class="s2">&quot;width&quot;</span><span class="s0">, </span><span class="s1">template_dict.get(</span><span class="s2">&quot;width&quot;</span><span class="s0">, </span><span class="s1">default_width))</span>
    <span class="s1">div_height = layout_dict.get(</span><span class="s2">&quot;height&quot;</span><span class="s0">, </span><span class="s1">template_dict.get(</span><span class="s2">&quot;height&quot;</span><span class="s0">, </span><span class="s1">default_height))</span>

    <span class="s3"># Add 'px' suffix to numeric widths</span>
    <span class="s0">try</span><span class="s1">:</span>
        <span class="s1">float(div_width)</span>
    <span class="s0">except </span><span class="s1">(ValueError</span><span class="s0">, </span><span class="s1">TypeError):</span>
        <span class="s0">pass</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">div_width = str(div_width) + </span><span class="s2">&quot;px&quot;</span>

    <span class="s0">try</span><span class="s1">:</span>
        <span class="s1">float(div_height)</span>
    <span class="s0">except </span><span class="s1">(ValueError</span><span class="s0">, </span><span class="s1">TypeError):</span>
        <span class="s0">pass</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">div_height = str(div_height) + </span><span class="s2">&quot;px&quot;</span>

    <span class="s3"># ## Get platform URL ##</span>
    <span class="s0">if </span><span class="s1">config.get(</span><span class="s2">&quot;showLink&quot;</span><span class="s0">, False</span><span class="s1">) </span><span class="s0">or </span><span class="s1">config.get(</span><span class="s2">&quot;showSendToCloud&quot;</span><span class="s0">, False</span><span class="s1">):</span>
        <span class="s3"># Figure is going to include a Chart Studio link or send-to-cloud button,</span>
        <span class="s3"># So we need to configure the PLOTLYENV.BASE_URL property</span>
        <span class="s1">base_url_line = </span><span class="s2">&quot;&quot;&quot; 
                    window.PLOTLYENV.BASE_URL='{plotly_platform_url}';</span><span class="s0">\ 
</span><span class="s2">&quot;&quot;&quot;</span><span class="s1">.format(</span>
            <span class="s1">plotly_platform_url=config.get(</span><span class="s2">&quot;plotlyServerURL&quot;</span><span class="s0">, </span><span class="s2">&quot;https://plot.ly&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s3"># Figure is not going to include a Chart Studio link or send-to-cloud button,</span>
        <span class="s3"># In this case we don't want https://plot.ly to show up anywhere in the HTML</span>
        <span class="s3"># output</span>
        <span class="s1">config.pop(</span><span class="s2">&quot;plotlyServerURL&quot;</span><span class="s0">, None</span><span class="s1">)</span>
        <span class="s1">config.pop(</span><span class="s2">&quot;linkText&quot;</span><span class="s0">, None</span><span class="s1">)</span>
        <span class="s1">config.pop(</span><span class="s2">&quot;showLink&quot;</span><span class="s0">, None</span><span class="s1">)</span>
        <span class="s1">base_url_line = </span><span class="s2">&quot;&quot;</span>

    <span class="s3"># ## Build script body ##</span>
    <span class="s3"># This is the part that actually calls Plotly.js</span>

    <span class="s3"># build post script snippet(s)</span>
    <span class="s1">then_post_script = </span><span class="s2">&quot;&quot;</span>
    <span class="s0">if </span><span class="s1">post_script:</span>
        <span class="s0">if not </span><span class="s1">isinstance(post_script</span><span class="s0">, </span><span class="s1">(list</span><span class="s0">, </span><span class="s1">tuple)):</span>
            <span class="s1">post_script = [post_script]</span>
        <span class="s0">for </span><span class="s1">ps </span><span class="s0">in </span><span class="s1">post_script:</span>
            <span class="s1">then_post_script += </span><span class="s2">&quot;&quot;&quot;.then(function(){{ 
                            {post_script} 
                        }})&quot;&quot;&quot;</span><span class="s1">.format(</span>
                <span class="s1">post_script=ps.replace(</span><span class="s2">&quot;{plot_id}&quot;</span><span class="s0">, </span><span class="s1">plotdivid)</span>
            <span class="s1">)</span>

    <span class="s1">then_addframes = </span><span class="s2">&quot;&quot;</span>
    <span class="s1">then_animate = </span><span class="s2">&quot;&quot;</span>
    <span class="s0">if </span><span class="s1">jframes:</span>
        <span class="s1">then_addframes = </span><span class="s2">&quot;&quot;&quot;.then(function(){{ 
                            Plotly.addFrames('{id}', {frames}); 
                        }})&quot;&quot;&quot;</span><span class="s1">.format(</span>
            <span class="s1">id=plotdivid</span><span class="s0">, </span><span class="s1">frames=jframes</span>
        <span class="s1">)</span>

        <span class="s0">if </span><span class="s1">auto_play:</span>
            <span class="s0">if </span><span class="s1">animation_opts:</span>
                <span class="s1">animation_opts_arg = </span><span class="s2">&quot;, &quot; </span><span class="s1">+ _json.dumps(animation_opts)</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">animation_opts_arg = </span><span class="s2">&quot;&quot;</span>
            <span class="s1">then_animate = </span><span class="s2">&quot;&quot;&quot;.then(function(){{ 
                            Plotly.animate('{id}', null{animation_opts}); 
                        }})&quot;&quot;&quot;</span><span class="s1">.format(</span>
                <span class="s1">id=plotdivid</span><span class="s0">, </span><span class="s1">animation_opts=animation_opts_arg</span>
            <span class="s1">)</span>

    <span class="s3"># Serialize config dict to JSON</span>
    <span class="s1">jconfig = _json.dumps(config)</span>

    <span class="s1">script = </span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
                </span><span class="s2">if (document.getElementById(&quot;{id}&quot;)) {{</span><span class="s0">\ 
                    </span><span class="s2">Plotly.newPlot(</span><span class="s0">\ 
                        </span><span class="s2">&quot;{id}&quot;,</span><span class="s0">\ 
                        </span><span class="s2">{data},</span><span class="s0">\ 
                        </span><span class="s2">{layout},</span><span class="s0">\ 
                        </span><span class="s2">{config}</span><span class="s0">\ 
                    </span><span class="s2">){then_addframes}{then_animate}{then_post_script}</span><span class="s0">\ 
                </span><span class="s2">}}&quot;&quot;&quot;</span><span class="s1">.format(</span>
        <span class="s1">id=plotdivid</span><span class="s0">,</span>
        <span class="s1">data=jdata</span><span class="s0">,</span>
        <span class="s1">layout=jlayout</span><span class="s0">,</span>
        <span class="s1">config=jconfig</span><span class="s0">,</span>
        <span class="s1">then_addframes=then_addframes</span><span class="s0">,</span>
        <span class="s1">then_animate=then_animate</span><span class="s0">,</span>
        <span class="s1">then_post_script=then_post_script</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s3"># ## Handle loading/initializing plotly.js ##</span>
    <span class="s1">include_plotlyjs_orig = include_plotlyjs</span>
    <span class="s0">if </span><span class="s1">isinstance(include_plotlyjs</span><span class="s0">, </span><span class="s1">six.string_types):</span>
        <span class="s1">include_plotlyjs = include_plotlyjs.lower()</span>

    <span class="s3"># Start/end of requirejs block (if any)</span>
    <span class="s1">require_start = </span><span class="s2">&quot;&quot;</span>
    <span class="s1">require_end = </span><span class="s2">&quot;&quot;</span>

    <span class="s3"># Init and load</span>
    <span class="s1">load_plotlyjs = </span><span class="s2">&quot;&quot;</span>

    <span class="s3"># Init plotlyjs. This block needs to run before plotly.js is loaded in</span>
    <span class="s3"># order for MathJax configuration to work properly</span>
    <span class="s0">if </span><span class="s1">include_plotlyjs == </span><span class="s2">&quot;require&quot;</span><span class="s1">:</span>
        <span class="s1">require_start = </span><span class="s2">'require([&quot;plotly&quot;], function(Plotly) {'</span>
        <span class="s1">require_end = </span><span class="s2">&quot;});&quot;</span>

    <span class="s0">elif </span><span class="s1">include_plotlyjs == </span><span class="s2">&quot;cdn&quot;</span><span class="s1">:</span>
        <span class="s1">load_plotlyjs = </span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        </span><span class="s2">{win_config} 
        &lt;script src=&quot;{cdn_url}&quot;&gt;&lt;/script&gt;</span><span class="s0">\ 
    </span><span class="s2">&quot;&quot;&quot;</span><span class="s1">.format(</span>
            <span class="s1">win_config=_window_plotly_config</span><span class="s0">, </span><span class="s1">cdn_url=plotly_cdn_url()</span>
        <span class="s1">)</span>

    <span class="s0">elif </span><span class="s1">include_plotlyjs == </span><span class="s2">&quot;directory&quot;</span><span class="s1">:</span>
        <span class="s1">load_plotlyjs = </span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        </span><span class="s2">{win_config} 
        &lt;script src=&quot;plotly.min.js&quot;&gt;&lt;/script&gt;</span><span class="s0">\ 
    </span><span class="s2">&quot;&quot;&quot;</span><span class="s1">.format(</span>
            <span class="s1">win_config=_window_plotly_config</span>
        <span class="s1">)</span>

    <span class="s0">elif </span><span class="s1">isinstance(include_plotlyjs</span><span class="s0">, </span><span class="s1">six.string_types) </span><span class="s0">and </span><span class="s1">include_plotlyjs.endswith(</span>
        <span class="s2">&quot;.js&quot;</span>
    <span class="s1">):</span>
        <span class="s1">load_plotlyjs = </span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        </span><span class="s2">{win_config} 
        &lt;script src=&quot;{url}&quot;&gt;&lt;/script&gt;</span><span class="s0">\ 
    </span><span class="s2">&quot;&quot;&quot;</span><span class="s1">.format(</span>
            <span class="s1">win_config=_window_plotly_config</span><span class="s0">, </span><span class="s1">url=include_plotlyjs_orig</span>
        <span class="s1">)</span>

    <span class="s0">elif </span><span class="s1">include_plotlyjs:</span>
        <span class="s1">load_plotlyjs = </span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
        </span><span class="s2">{win_config} 
        &lt;script type=&quot;text/javascript&quot;&gt;{plotlyjs}&lt;/script&gt;</span><span class="s0">\ 
    </span><span class="s2">&quot;&quot;&quot;</span><span class="s1">.format(</span>
            <span class="s1">win_config=_window_plotly_config</span><span class="s0">, </span><span class="s1">plotlyjs=get_plotlyjs()</span>
        <span class="s1">)</span>

    <span class="s3"># ## Handle loading/initializing MathJax ##</span>
    <span class="s1">include_mathjax_orig = include_mathjax</span>
    <span class="s0">if </span><span class="s1">isinstance(include_mathjax</span><span class="s0">, </span><span class="s1">six.string_types):</span>
        <span class="s1">include_mathjax = include_mathjax.lower()</span>

    <span class="s1">mathjax_template = </span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
    </span><span class="s2">&lt;script src=&quot;{url}?config=TeX-AMS-MML_SVG&quot;&gt;&lt;/script&gt;&quot;&quot;&quot;</span>

    <span class="s0">if </span><span class="s1">include_mathjax == </span><span class="s2">&quot;cdn&quot;</span><span class="s1">:</span>
        <span class="s1">mathjax_script = (</span>
            <span class="s1">mathjax_template.format(</span>
                <span class="s1">url=(</span>
                    <span class="s2">&quot;https://cdnjs.cloudflare.com&quot; &quot;/ajax/libs/mathjax/2.7.5/MathJax.js&quot;</span>
                <span class="s1">)</span>
            <span class="s1">)</span>
            <span class="s1">+ _mathjax_config</span>
        <span class="s1">)</span>

    <span class="s0">elif </span><span class="s1">isinstance(include_mathjax</span><span class="s0">, </span><span class="s1">six.string_types) </span><span class="s0">and </span><span class="s1">include_mathjax.endswith(</span>
        <span class="s2">&quot;.js&quot;</span>
    <span class="s1">):</span>

        <span class="s1">mathjax_script = (</span>
            <span class="s1">mathjax_template.format(url=include_mathjax_orig) + _mathjax_config</span>
        <span class="s1">)</span>
    <span class="s0">elif not </span><span class="s1">include_mathjax:</span>
        <span class="s1">mathjax_script = </span><span class="s2">&quot;&quot;</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s0">raise </span><span class="s1">ValueError(</span>
            <span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
</span><span class="s2">Invalid value of type {typ} received as the include_mathjax argument 
    Received value: {val} 
 
include_mathjax may be specified as False, 'cdn', or a string ending with '.js' 
    &quot;&quot;&quot;</span><span class="s1">.format(</span>
                <span class="s1">typ=type(include_mathjax)</span><span class="s0">, </span><span class="s1">val=repr(include_mathjax)</span>
            <span class="s1">)</span>
        <span class="s1">)</span>

    <span class="s1">plotly_html_div = </span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
</span><span class="s2">&lt;div&gt;</span><span class="s0">\ 
        </span><span class="s2">{mathjax_script}</span><span class="s0">\ 
        </span><span class="s2">{load_plotlyjs}</span><span class="s0">\ 
            </span><span class="s2">&lt;div id=&quot;{id}&quot; class=&quot;plotly-graph-div&quot; </span><span class="s0">\ 
</span><span class="s2">style=&quot;height:{height}; width:{width};&quot;&gt;&lt;/div&gt;</span><span class="s0">\ 
            </span><span class="s2">&lt;script type=&quot;text/javascript&quot;&gt;</span><span class="s0">\ 
                </span><span class="s2">{require_start}</span><span class="s0">\ 
                    </span><span class="s2">window.PLOTLYENV=window.PLOTLYENV || {{}};{base_url_line}</span><span class="s0">\ 
                    </span><span class="s2">{script};</span><span class="s0">\ 
                </span><span class="s2">{require_end}</span><span class="s0">\ 
            </span><span class="s2">&lt;/script&gt;</span><span class="s0">\ 
        </span><span class="s2">&lt;/div&gt;&quot;&quot;&quot;</span><span class="s1">.format(</span>
        <span class="s1">mathjax_script=mathjax_script</span><span class="s0">,</span>
        <span class="s1">load_plotlyjs=load_plotlyjs</span><span class="s0">,</span>
        <span class="s1">id=plotdivid</span><span class="s0">,</span>
        <span class="s1">width=div_width</span><span class="s0">,</span>
        <span class="s1">height=div_height</span><span class="s0">,</span>
        <span class="s1">base_url_line=base_url_line</span><span class="s0">,</span>
        <span class="s1">require_start=require_start</span><span class="s0">,</span>
        <span class="s1">script=script</span><span class="s0">,</span>
        <span class="s1">require_end=require_end</span><span class="s0">,</span>
    <span class="s1">).strip()</span>

    <span class="s0">if </span><span class="s1">full_html:</span>
        <span class="s0">return </span><span class="s2">&quot;&quot;&quot;</span><span class="s0">\ 
</span><span class="s2">&lt;html&gt; 
&lt;head&gt;&lt;meta charset=&quot;utf-8&quot; /&gt;&lt;/head&gt; 
&lt;body&gt; 
    {div} 
&lt;/body&gt; 
&lt;/html&gt;&quot;&quot;&quot;</span><span class="s1">.format(</span>
            <span class="s1">div=plotly_html_div</span>
        <span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s0">return </span><span class="s1">plotly_html_div</span>


<span class="s0">def </span><span class="s1">write_html(</span>
    <span class="s1">fig</span><span class="s0">,</span>
    <span class="s1">file</span><span class="s0">,</span>
    <span class="s1">config=</span><span class="s0">None,</span>
    <span class="s1">auto_play=</span><span class="s0">True,</span>
    <span class="s1">include_plotlyjs=</span><span class="s0">True,</span>
    <span class="s1">include_mathjax=</span><span class="s0">False,</span>
    <span class="s1">post_script=</span><span class="s0">None,</span>
    <span class="s1">full_html=</span><span class="s0">True,</span>
    <span class="s1">animation_opts=</span><span class="s0">None,</span>
    <span class="s1">validate=</span><span class="s0">True,</span>
    <span class="s1">default_width=</span><span class="s2">&quot;100%&quot;</span><span class="s0">,</span>
    <span class="s1">default_height=</span><span class="s2">&quot;100%&quot;</span><span class="s0">,</span>
    <span class="s1">auto_open=</span><span class="s0">False,</span>
    <span class="s1">div_id=</span><span class="s0">None,</span>
<span class="s1">):</span>
    <span class="s4">&quot;&quot;&quot; 
    Write a figure to an HTML file representation 
 
    Parameters 
    ---------- 
    fig: 
        Figure object or dict representing a figure 
    file: str or writeable 
        A string representing a local file path or a writeable object 
        (e.g. a pathlib.Path object or an open file descriptor) 
    config: dict or None (default None) 
        Plotly.js figure config options 
    auto_play: bool (default=True) 
        Whether to automatically start the animation sequence on page load 
        if the figure contains frames. Has no effect if the figure does not 
        contain frames. 
    include_plotlyjs: bool or string (default True) 
        Specifies how the plotly.js library is included/loaded in the output 
        div string. 
 
        If True, a script tag containing the plotly.js source code (~3MB) 
        is included in the output.  HTML files generated with this option are 
        fully self-contained and can be used offline. 
 
        If 'cdn', a script tag that references the plotly.js CDN is included 
        in the output. The url used is versioned to match the bundled plotly.js. 
        HTML files generated with this option are about 3MB smaller than those 
        generated with include_plotlyjs=True, but they require an active 
        internet connection in order to load the plotly.js library. 
 
        If 'directory', a script tag is included that references an external 
        plotly.min.js bundle that is assumed to reside in the same 
        directory as the HTML file.  If `file` is a string to a local file 
        path and `full_html` is True, then the plotly.min.js bundle is copied 
        into the directory of the resulting HTML file. If a file named 
        plotly.min.js already exists in the output directory then this file 
        is left unmodified and no copy is performed. HTML files generated 
        with this option can be used offline, but they require a copy of 
        the plotly.min.js bundle in the same directory. This option is 
        useful when many figures will be saved as HTML files in the same 
        directory because the plotly.js source code will be included only 
        once per output directory, rather than once per output file. 
 
        If 'require', Plotly.js is loaded using require.js.  This option 
        assumes that require.js is globally available and that it has been 
        globally configured to know how to find Plotly.js as 'plotly'. 
        This option is not advised when full_html=True as it will result 
        in a non-functional html file. 
 
        If a string that ends in '.js', a script tag is included that 
        references the specified path. This approach can be used to point 
        the resulting HTML file to an alternative CDN or local bundle. 
 
        If False, no script tag referencing plotly.js is included. This is 
        useful when the resulting div string will be placed inside an HTML 
        document that already loads plotly.js.  This option is not advised 
        when full_html=True as it will result in a non-functional html file. 
 
    include_mathjax: bool or string (default False) 
        Specifies how the MathJax.js library is included in the output html 
        div string.  MathJax is required in order to display labels 
        with LaTeX typesetting. 
 
        If False, no script tag referencing MathJax.js will be included in the 
        output. 
 
        If 'cdn', a script tag that references a MathJax CDN location will be 
        included in the output.  HTML div strings generated with this option 
        will be able to display LaTeX typesetting as long as internet access 
        is available. 
 
        If a string that ends in '.js', a script tag is included that 
        references the specified path. This approach can be used to point the 
        resulting HTML div string to an alternative CDN. 
    post_script: str or list or None (default None) 
        JavaScript snippet(s) to be included in the resulting div just after 
        plot creation.  The string(s) may include '{plot_id}' placeholders 
        that will then be replaced by the `id` of the div element that the 
        plotly.js figure is associated with.  One application for this script 
        is to install custom plotly.js event handlers. 
    full_html: bool (default True) 
        If True, produce a string containing a complete HTML document 
        starting with an &lt;html&gt; tag.  If False, produce a string containing 
        a single &lt;div&gt; element. 
    animation_opts: dict or None (default None) 
        dict of custom animation parameters to be passed to the function 
        Plotly.animate in Plotly.js. See 
        https://github.com/plotly/plotly.js/blob/master/src/plots/animation_attributes.js 
        for available options. Has no effect if the figure does not contain 
        frames, or auto_play is False. 
    default_width, default_height: number or str (default '100%') 
        The default figure width/height to use if the provided figure does not 
        specify its own layout.width/layout.height property.  May be 
        specified in pixels as an integer (e.g. 500), or as a css width style 
        string (e.g. '500px', '100%'). 
    validate: bool (default True) 
        True if the figure should be validated before being converted to 
        JSON, False otherwise. 
    auto_open: bool (default True) 
        If True, open the saved file in a web browser after saving. 
        This argument only applies if `full_html` is True. 
    div_id: str (default None) 
        If provided, this is the value of the id attribute of the div tag. If None, the 
        id attribute is a UUID. 
 
    Returns 
    ------- 
    str 
        Representation of figure as an HTML div string 
    &quot;&quot;&quot;</span>

    <span class="s3"># Build HTML string</span>
    <span class="s1">html_str = to_html(</span>
        <span class="s1">fig</span><span class="s0">,</span>
        <span class="s1">config=config</span><span class="s0">,</span>
        <span class="s1">auto_play=auto_play</span><span class="s0">,</span>
        <span class="s1">include_plotlyjs=include_plotlyjs</span><span class="s0">,</span>
        <span class="s1">include_mathjax=include_mathjax</span><span class="s0">,</span>
        <span class="s1">post_script=post_script</span><span class="s0">,</span>
        <span class="s1">full_html=full_html</span><span class="s0">,</span>
        <span class="s1">animation_opts=animation_opts</span><span class="s0">,</span>
        <span class="s1">default_width=default_width</span><span class="s0">,</span>
        <span class="s1">default_height=default_height</span><span class="s0">,</span>
        <span class="s1">validate=validate</span><span class="s0">,</span>
        <span class="s1">div_id=div_id</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s3"># Check if file is a string</span>
    <span class="s0">if </span><span class="s1">isinstance(file</span><span class="s0">, </span><span class="s1">six.string_types):</span>
        <span class="s3"># Use the standard pathlib constructor to make a pathlib object.</span>
        <span class="s1">path = Path(file)</span>
    <span class="s0">elif </span><span class="s1">isinstance(file</span><span class="s0">, </span><span class="s1">Path):  </span><span class="s3"># PurePath is the most general pathlib object.</span>
        <span class="s3"># `file` is already a pathlib object.</span>
        <span class="s1">path = file</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s3"># We could not make a pathlib object out of file. Either `file` is an open file</span>
        <span class="s3"># descriptor with a `write()` method or it's an invalid object.</span>
        <span class="s1">path = </span><span class="s0">None</span>

    <span class="s3"># Write HTML string</span>
    <span class="s0">if </span><span class="s1">path </span><span class="s0">is not None</span><span class="s1">:</span>
        <span class="s1">path.write_text(html_str)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">file.write(html_str)</span>

    <span class="s3"># Check if we should copy plotly.min.js to output directory</span>
    <span class="s0">if </span><span class="s1">path </span><span class="s0">is not None and </span><span class="s1">full_html </span><span class="s0">and </span><span class="s1">include_plotlyjs == </span><span class="s2">&quot;directory&quot;</span><span class="s1">:</span>
        <span class="s1">bundle_path = path.parent / </span><span class="s2">&quot;plotly.min.js&quot;</span>

        <span class="s0">if not </span><span class="s1">bundle_path.exists():</span>
            <span class="s1">bundle_path.write_text(get_plotlyjs())</span>

    <span class="s3"># Handle auto_open</span>
    <span class="s0">if </span><span class="s1">path </span><span class="s0">is not None and </span><span class="s1">full_html </span><span class="s0">and </span><span class="s1">auto_open:</span>
        <span class="s1">url = path.absolute().as_uri()</span>
        <span class="s1">webbrowser.open(url)</span>
</pre>
</body>
</html>