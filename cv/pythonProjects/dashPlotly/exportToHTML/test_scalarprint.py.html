<html>
<head>
<title>test_scalarprint.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
.s5 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_scalarprint.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; Test printing of scalar types. 
 
&quot;&quot;&quot;</span>
<span class="s2">import </span><span class="s1">code</span>
<span class="s2">import </span><span class="s1">platform</span>
<span class="s2">import </span><span class="s1">pytest</span>
<span class="s2">import </span><span class="s1">sys</span>

<span class="s2">from </span><span class="s1">tempfile </span><span class="s2">import </span><span class="s1">TemporaryFile</span>
<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">from </span><span class="s1">numpy.testing </span><span class="s2">import </span><span class="s1">assert_</span><span class="s2">, </span><span class="s1">assert_equal</span><span class="s2">, </span><span class="s1">assert_raises</span>

<span class="s2">class </span><span class="s1">TestRealScalars:</span>
    <span class="s2">def </span><span class="s1">test_str(self):</span>
        <span class="s1">svals = [</span><span class="s3">0.0</span><span class="s2">, </span><span class="s1">-</span><span class="s3">0.0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">np.inf</span><span class="s2">, </span><span class="s1">-np.inf</span><span class="s2">, </span><span class="s1">np.nan]</span>
        <span class="s1">styps = [np.float16</span><span class="s2">, </span><span class="s1">np.float32</span><span class="s2">, </span><span class="s1">np.float64</span><span class="s2">, </span><span class="s1">np.longdouble]</span>
        <span class="s1">wanted = [</span>
             <span class="s1">[</span><span class="s4">'0.0'</span><span class="s2">,  </span><span class="s4">'0.0'</span><span class="s2">,  </span><span class="s4">'0.0'</span><span class="s2">,  </span><span class="s4">'0.0' </span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">'-0.0'</span><span class="s2">, </span><span class="s4">'-0.0'</span><span class="s2">, </span><span class="s4">'-0.0'</span><span class="s2">, </span><span class="s4">'-0.0'</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">'1.0'</span><span class="s2">,  </span><span class="s4">'1.0'</span><span class="s2">,  </span><span class="s4">'1.0'</span><span class="s2">,  </span><span class="s4">'1.0' </span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">'-1.0'</span><span class="s2">, </span><span class="s4">'-1.0'</span><span class="s2">, </span><span class="s4">'-1.0'</span><span class="s2">, </span><span class="s4">'-1.0'</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">'inf'</span><span class="s2">,  </span><span class="s4">'inf'</span><span class="s2">,  </span><span class="s4">'inf'</span><span class="s2">,  </span><span class="s4">'inf' </span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">'-inf'</span><span class="s2">, </span><span class="s4">'-inf'</span><span class="s2">, </span><span class="s4">'-inf'</span><span class="s2">, </span><span class="s4">'-inf'</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s4">'nan'</span><span class="s2">,  </span><span class="s4">'nan'</span><span class="s2">,  </span><span class="s4">'nan'</span><span class="s2">,  </span><span class="s4">'nan'</span><span class="s1">]]</span>

        <span class="s2">for </span><span class="s1">wants</span><span class="s2">, </span><span class="s1">val </span><span class="s2">in </span><span class="s1">zip(wanted</span><span class="s2">, </span><span class="s1">svals):</span>
            <span class="s2">for </span><span class="s1">want</span><span class="s2">, </span><span class="s1">styp </span><span class="s2">in </span><span class="s1">zip(wants</span><span class="s2">, </span><span class="s1">styps):</span>
                <span class="s1">msg = </span><span class="s4">'for str({}({}))'</span><span class="s1">.format(np.dtype(styp).name</span><span class="s2">, </span><span class="s1">repr(val))</span>
                <span class="s1">assert_equal(str(styp(val))</span><span class="s2">, </span><span class="s1">want</span><span class="s2">, </span><span class="s1">err_msg=msg)</span>

    <span class="s2">def </span><span class="s1">test_scalar_cutoffs(self):</span>
        <span class="s5"># test that both the str and repr of np.float64 behaves</span>
        <span class="s5"># like python floats in python3.</span>
        <span class="s2">def </span><span class="s1">check(v):</span>
            <span class="s1">assert_equal(str(np.float64(v))</span><span class="s2">, </span><span class="s1">str(v))</span>
            <span class="s1">assert_equal(str(np.float64(v))</span><span class="s2">, </span><span class="s1">repr(v))</span>
            <span class="s1">assert_equal(repr(np.float64(v))</span><span class="s2">, </span><span class="s1">repr(v))</span>
            <span class="s1">assert_equal(repr(np.float64(v))</span><span class="s2">, </span><span class="s1">str(v))</span>

        <span class="s5"># check we use the same number of significant digits</span>
        <span class="s1">check(</span><span class="s3">1.12345678901234567890</span><span class="s1">)</span>
        <span class="s1">check(</span><span class="s3">0.0112345678901234567890</span><span class="s1">)</span>

        <span class="s5"># check switch from scientific output to positional and back</span>
        <span class="s1">check(</span><span class="s3">1e-5</span><span class="s1">)</span>
        <span class="s1">check(</span><span class="s3">1e-4</span><span class="s1">)</span>
        <span class="s1">check(</span><span class="s3">1e15</span><span class="s1">)</span>
        <span class="s1">check(</span><span class="s3">1e16</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_py2_float_print(self):</span>
        <span class="s5"># gh-10753</span>
        <span class="s5"># In python2, the python float type implements an obsolete method</span>
        <span class="s5"># tp_print, which overrides tp_repr and tp_str when using &quot;print&quot; to</span>
        <span class="s5"># output to a &quot;real file&quot; (ie, not a StringIO). Make sure we don't</span>
        <span class="s5"># inherit it.</span>
        <span class="s1">x = np.double(</span><span class="s3">0.1999999999999</span><span class="s1">)</span>
        <span class="s2">with </span><span class="s1">TemporaryFile(</span><span class="s4">'r+t'</span><span class="s1">) </span><span class="s2">as </span><span class="s1">f:</span>
            <span class="s1">print(x</span><span class="s2">, </span><span class="s1">file=f)</span>
            <span class="s1">f.seek(</span><span class="s3">0</span><span class="s1">)</span>
            <span class="s1">output = f.read()</span>
        <span class="s1">assert_equal(output</span><span class="s2">, </span><span class="s1">str(x) + </span><span class="s4">'</span><span class="s2">\n</span><span class="s4">'</span><span class="s1">)</span>
        <span class="s5"># In python2 the value float('0.1999999999999') prints with reduced</span>
        <span class="s5"># precision as '0.2', but we want numpy's np.double('0.1999999999999')</span>
        <span class="s5"># to print the unique value, '0.1999999999999'.</span>

        <span class="s5"># gh-11031</span>
        <span class="s5"># Only in the python2 interactive shell and when stdout is a &quot;real&quot;</span>
        <span class="s5"># file, the output of the last command is printed to stdout without</span>
        <span class="s5"># Py_PRINT_RAW (unlike the print statement) so `&gt;&gt;&gt; x` and `&gt;&gt;&gt; print</span>
        <span class="s5"># x` are potentially different. Make sure they are the same. The only</span>
        <span class="s5"># way I found to get prompt-like output is using an actual prompt from</span>
        <span class="s5"># the 'code' module. Again, must use tempfile to get a &quot;real&quot; file.</span>

        <span class="s5"># dummy user-input which enters one line and then ctrl-Ds.</span>
        <span class="s2">def </span><span class="s1">userinput():</span>
            <span class="s2">yield </span><span class="s4">'np.sqrt(2)'</span>
            <span class="s2">raise </span><span class="s1">EOFError</span>
        <span class="s1">gen = userinput()</span>
        <span class="s1">input_func = </span><span class="s2">lambda </span><span class="s1">prompt=</span><span class="s4">&quot;&quot;</span><span class="s1">: next(gen)</span>

        <span class="s2">with </span><span class="s1">TemporaryFile(</span><span class="s4">'r+t'</span><span class="s1">) </span><span class="s2">as </span><span class="s1">fo</span><span class="s2">, </span><span class="s1">TemporaryFile(</span><span class="s4">'r+t'</span><span class="s1">) </span><span class="s2">as </span><span class="s1">fe:</span>
            <span class="s1">orig_stdout</span><span class="s2">, </span><span class="s1">orig_stderr = sys.stdout</span><span class="s2">, </span><span class="s1">sys.stderr</span>
            <span class="s1">sys.stdout</span><span class="s2">, </span><span class="s1">sys.stderr = fo</span><span class="s2">, </span><span class="s1">fe</span>

            <span class="s1">code.interact(local={</span><span class="s4">'np'</span><span class="s1">: np}</span><span class="s2">, </span><span class="s1">readfunc=input_func</span><span class="s2">, </span><span class="s1">banner=</span><span class="s4">''</span><span class="s1">)</span>

            <span class="s1">sys.stdout</span><span class="s2">, </span><span class="s1">sys.stderr = orig_stdout</span><span class="s2">, </span><span class="s1">orig_stderr</span>

            <span class="s1">fo.seek(</span><span class="s3">0</span><span class="s1">)</span>
            <span class="s1">capture = fo.read().strip()</span>

        <span class="s1">assert_equal(capture</span><span class="s2">, </span><span class="s1">repr(np.sqrt(</span><span class="s3">2</span><span class="s1">)))</span>

    <span class="s2">def </span><span class="s1">test_dragon4(self):</span>
        <span class="s5"># these tests are adapted from Ryan Juckett's dragon4 implementation,</span>
        <span class="s5"># see dragon4.c for details.</span>

        <span class="s1">fpos32 = </span><span class="s2">lambda </span><span class="s1">x</span><span class="s2">, </span><span class="s1">**k: np.format_float_positional(np.float32(x)</span><span class="s2">, </span><span class="s1">**k)</span>
        <span class="s1">fsci32 = </span><span class="s2">lambda </span><span class="s1">x</span><span class="s2">, </span><span class="s1">**k: np.format_float_scientific(np.float32(x)</span><span class="s2">, </span><span class="s1">**k)</span>
        <span class="s1">fpos64 = </span><span class="s2">lambda </span><span class="s1">x</span><span class="s2">, </span><span class="s1">**k: np.format_float_positional(np.float64(x)</span><span class="s2">, </span><span class="s1">**k)</span>
        <span class="s1">fsci64 = </span><span class="s2">lambda </span><span class="s1">x</span><span class="s2">, </span><span class="s1">**k: np.format_float_scientific(np.float64(x)</span><span class="s2">, </span><span class="s1">**k)</span>

        <span class="s1">preckwd = </span><span class="s2">lambda </span><span class="s1">prec: {</span><span class="s4">'unique'</span><span class="s1">: </span><span class="s2">False, </span><span class="s4">'precision'</span><span class="s1">: prec}</span>

        <span class="s1">assert_equal(fpos32(</span><span class="s4">'1.0'</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;1.&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci32(</span><span class="s4">'1.0'</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;1.e+00&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos32(</span><span class="s4">'10.234'</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;10.234&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos32(</span><span class="s4">'-10.234'</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;-10.234&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci32(</span><span class="s4">'10.234'</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;1.0234e+01&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci32(</span><span class="s4">'-10.234'</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;-1.0234e+01&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos32(</span><span class="s4">'1000.0'</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;1000.&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos32(</span><span class="s4">'1.0'</span><span class="s2">, </span><span class="s1">precision=</span><span class="s3">0</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;1.&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci32(</span><span class="s4">'1.0'</span><span class="s2">, </span><span class="s1">precision=</span><span class="s3">0</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;1.e+00&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos32(</span><span class="s4">'10.234'</span><span class="s2">, </span><span class="s1">precision=</span><span class="s3">0</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;10.&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos32(</span><span class="s4">'-10.234'</span><span class="s2">, </span><span class="s1">precision=</span><span class="s3">0</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;-10.&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci32(</span><span class="s4">'10.234'</span><span class="s2">, </span><span class="s1">precision=</span><span class="s3">0</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;1.e+01&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci32(</span><span class="s4">'-10.234'</span><span class="s2">, </span><span class="s1">precision=</span><span class="s3">0</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;-1.e+01&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos32(</span><span class="s4">'10.234'</span><span class="s2">, </span><span class="s1">precision=</span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;10.23&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci32(</span><span class="s4">'-10.234'</span><span class="s2">, </span><span class="s1">precision=</span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;-1.02e+01&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci64(</span><span class="s4">'9.9999999999999995e-08'</span><span class="s2">, </span><span class="s1">**preckwd(</span><span class="s3">16</span><span class="s1">))</span><span class="s2">,</span>
                            <span class="s4">'9.9999999999999995e-08'</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci64(</span><span class="s4">'9.8813129168249309e-324'</span><span class="s2">, </span><span class="s1">**preckwd(</span><span class="s3">16</span><span class="s1">))</span><span class="s2">,</span>
                            <span class="s4">'9.8813129168249309e-324'</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci64(</span><span class="s4">'9.9999999999999694e-311'</span><span class="s2">, </span><span class="s1">**preckwd(</span><span class="s3">16</span><span class="s1">))</span><span class="s2">,</span>
                            <span class="s4">'9.9999999999999694e-311'</span><span class="s1">)</span>


        <span class="s5"># test rounding</span>
        <span class="s5"># 3.1415927410 is closest float32 to np.pi</span>
        <span class="s1">assert_equal(fpos32(</span><span class="s4">'3.14159265358979323846'</span><span class="s2">, </span><span class="s1">**preckwd(</span><span class="s3">10</span><span class="s1">))</span><span class="s2">,</span>
                            <span class="s4">&quot;3.1415927410&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci32(</span><span class="s4">'3.14159265358979323846'</span><span class="s2">, </span><span class="s1">**preckwd(</span><span class="s3">10</span><span class="s1">))</span><span class="s2">,</span>
                            <span class="s4">&quot;3.1415927410e+00&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos64(</span><span class="s4">'3.14159265358979323846'</span><span class="s2">, </span><span class="s1">**preckwd(</span><span class="s3">10</span><span class="s1">))</span><span class="s2">,</span>
                            <span class="s4">&quot;3.1415926536&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci64(</span><span class="s4">'3.14159265358979323846'</span><span class="s2">, </span><span class="s1">**preckwd(</span><span class="s3">10</span><span class="s1">))</span><span class="s2">,</span>
                            <span class="s4">&quot;3.1415926536e+00&quot;</span><span class="s1">)</span>
        <span class="s5"># 299792448 is closest float32 to 299792458</span>
        <span class="s1">assert_equal(fpos32(</span><span class="s4">'299792458.0'</span><span class="s2">, </span><span class="s1">**preckwd(</span><span class="s3">5</span><span class="s1">))</span><span class="s2">, </span><span class="s4">&quot;299792448.00000&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci32(</span><span class="s4">'299792458.0'</span><span class="s2">, </span><span class="s1">**preckwd(</span><span class="s3">5</span><span class="s1">))</span><span class="s2">, </span><span class="s4">&quot;2.99792e+08&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos64(</span><span class="s4">'299792458.0'</span><span class="s2">, </span><span class="s1">**preckwd(</span><span class="s3">5</span><span class="s1">))</span><span class="s2">, </span><span class="s4">&quot;299792458.00000&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci64(</span><span class="s4">'299792458.0'</span><span class="s2">, </span><span class="s1">**preckwd(</span><span class="s3">5</span><span class="s1">))</span><span class="s2">, </span><span class="s4">&quot;2.99792e+08&quot;</span><span class="s1">)</span>

        <span class="s1">assert_equal(fpos32(</span><span class="s4">'3.14159265358979323846'</span><span class="s2">, </span><span class="s1">**preckwd(</span><span class="s3">25</span><span class="s1">))</span><span class="s2">,</span>
                            <span class="s4">&quot;3.1415927410125732421875000&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos64(</span><span class="s4">'3.14159265358979323846'</span><span class="s2">, </span><span class="s1">**preckwd(</span><span class="s3">50</span><span class="s1">))</span><span class="s2">,</span>
                         <span class="s4">&quot;3.14159265358979311599796346854418516159057617187500&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos64(</span><span class="s4">'3.14159265358979323846'</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;3.141592653589793&quot;</span><span class="s1">)</span>


        <span class="s5"># smallest numbers</span>
        <span class="s1">assert_equal(fpos32(</span><span class="s3">0.5</span><span class="s1">**(</span><span class="s3">126 </span><span class="s1">+ </span><span class="s3">23</span><span class="s1">)</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">149</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s4">&quot;0.00000000000000000000000000000000000000000000140129846432&quot;</span>
                    <span class="s4">&quot;4817070923729583289916131280261941876515771757068283889791&quot;</span>
                    <span class="s4">&quot;08268586060148663818836212158203125&quot;</span><span class="s1">)</span>
        
        <span class="s1">assert_equal(fpos64(</span><span class="s3">5e-324</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">1074</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s4">&quot;0.00000000000000000000000000000000000000000000000000000000&quot;</span>
                    <span class="s4">&quot;0000000000000000000000000000000000000000000000000000000000&quot;</span>
                    <span class="s4">&quot;0000000000000000000000000000000000000000000000000000000000&quot;</span>
                    <span class="s4">&quot;0000000000000000000000000000000000000000000000000000000000&quot;</span>
                    <span class="s4">&quot;0000000000000000000000000000000000000000000000000000000000&quot;</span>
                    <span class="s4">&quot;0000000000000000000000000000000000049406564584124654417656&quot;</span>
                    <span class="s4">&quot;8792868221372365059802614324764425585682500675507270208751&quot;</span>
                    <span class="s4">&quot;8652998363616359923797965646954457177309266567103559397963&quot;</span>
                    <span class="s4">&quot;9877479601078187812630071319031140452784581716784898210368&quot;</span>
                    <span class="s4">&quot;8718636056998730723050006387409153564984387312473397273169&quot;</span>
                    <span class="s4">&quot;6151400317153853980741262385655911710266585566867681870395&quot;</span>
                    <span class="s4">&quot;6031062493194527159149245532930545654440112748012970999954&quot;</span>
                    <span class="s4">&quot;1931989409080416563324524757147869014726780159355238611550&quot;</span>
                    <span class="s4">&quot;1348035264934720193790268107107491703332226844753335720832&quot;</span>
                    <span class="s4">&quot;4319360923828934583680601060115061698097530783422773183292&quot;</span>
                    <span class="s4">&quot;4790498252473077637592724787465608477820373446969953364701&quot;</span>
                    <span class="s4">&quot;7972677717585125660551199131504891101451037862738167250955&quot;</span>
                    <span class="s4">&quot;8373897335989936648099411642057026370902792427675445652290&quot;</span>
                    <span class="s4">&quot;87538682506419718265533447265625&quot;</span><span class="s1">)</span>

        <span class="s5"># largest numbers</span>
        <span class="s1">f32x = np.finfo(np.float32).max</span>
        <span class="s1">assert_equal(fpos32(f32x</span><span class="s2">, </span><span class="s1">**preckwd(</span><span class="s3">0</span><span class="s1">))</span><span class="s2">,</span>
                    <span class="s4">&quot;340282346638528859811704183484516925440.&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos64(np.finfo(np.float64).max</span><span class="s2">, </span><span class="s1">**preckwd(</span><span class="s3">0</span><span class="s1">))</span><span class="s2">,</span>
                    <span class="s4">&quot;1797693134862315708145274237317043567980705675258449965989&quot;</span>
                    <span class="s4">&quot;1747680315726078002853876058955863276687817154045895351438&quot;</span>
                    <span class="s4">&quot;2464234321326889464182768467546703537516986049910576551282&quot;</span>
                    <span class="s4">&quot;0762454900903893289440758685084551339423045832369032229481&quot;</span>
                    <span class="s4">&quot;6580855933212334827479782620414472316873817718091929988125&quot;</span>
                    <span class="s4">&quot;0404026184124858368.&quot;</span><span class="s1">)</span>
        <span class="s5"># Warning: In unique mode only the integer digits necessary for</span>
        <span class="s5"># uniqueness are computed, the rest are 0.</span>
        <span class="s1">assert_equal(fpos32(f32x)</span><span class="s2">,</span>
                    <span class="s4">&quot;340282350000000000000000000000000000000.&quot;</span><span class="s1">)</span>

        <span class="s5"># Further tests of zero-padding vs rounding in different combinations</span>
        <span class="s5"># of unique, fractional, precision, min_digits</span>
        <span class="s5"># precision can only reduce digits, not add them.</span>
        <span class="s5"># min_digits can only extend digits, not reduce them.</span>
        <span class="s1">assert_equal(fpos32(f32x</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">True, </span><span class="s1">fractional=</span><span class="s2">True, </span><span class="s1">precision=</span><span class="s3">0</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s4">&quot;340282350000000000000000000000000000000.&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos32(f32x</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">True, </span><span class="s1">fractional=</span><span class="s2">True, </span><span class="s1">precision=</span><span class="s3">4</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s4">&quot;340282350000000000000000000000000000000.&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos32(f32x</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">True, </span><span class="s1">fractional=</span><span class="s2">True, </span><span class="s1">min_digits=</span><span class="s3">0</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s4">&quot;340282346638528859811704183484516925440.&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos32(f32x</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">True, </span><span class="s1">fractional=</span><span class="s2">True, </span><span class="s1">min_digits=</span><span class="s3">4</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s4">&quot;340282346638528859811704183484516925440.0000&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos32(f32x</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">True, </span><span class="s1">fractional=</span><span class="s2">True,</span>
                                    <span class="s1">min_digits=</span><span class="s3">4</span><span class="s2">, </span><span class="s1">precision=</span><span class="s3">4</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s4">&quot;340282346638528859811704183484516925440.0000&quot;</span><span class="s1">)</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">fpos32</span><span class="s2">, </span><span class="s1">f32x</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">True, </span><span class="s1">fractional=</span><span class="s2">False,</span>
                                          <span class="s1">precision=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos32(f32x</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">True, </span><span class="s1">fractional=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">4</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s4">&quot;340300000000000000000000000000000000000.&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos32(f32x</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">True, </span><span class="s1">fractional=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">20</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s4">&quot;340282350000000000000000000000000000000.&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos32(f32x</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">True, </span><span class="s1">fractional=</span><span class="s2">False, </span><span class="s1">min_digits=</span><span class="s3">4</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s4">&quot;340282350000000000000000000000000000000.&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos32(f32x</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">True, </span><span class="s1">fractional=</span><span class="s2">False,</span>
                                  <span class="s1">min_digits=</span><span class="s3">20</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s4">&quot;340282346638528859810000000000000000000.&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos32(f32x</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">True, </span><span class="s1">fractional=</span><span class="s2">False,</span>
                                  <span class="s1">min_digits=</span><span class="s3">15</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s4">&quot;340282346638529000000000000000000000000.&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos32(f32x</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">fractional=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">4</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s4">&quot;340300000000000000000000000000000000000.&quot;</span><span class="s1">)</span>
        <span class="s5"># test that unique rounding is preserved when precision is supplied</span>
        <span class="s5"># but no extra digits need to be printed (gh-18609)</span>
        <span class="s1">a = np.float64.fromhex(</span><span class="s4">'-1p-97'</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci64(a</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">True</span><span class="s1">)</span><span class="s2">, </span><span class="s4">'-6.310887241768095e-30'</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci64(a</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">15</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s4">'-6.310887241768094e-30'</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci64(a</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">True, </span><span class="s1">precision=</span><span class="s3">15</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s4">'-6.310887241768095e-30'</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci64(a</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">True, </span><span class="s1">min_digits=</span><span class="s3">15</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s4">'-6.310887241768095e-30'</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci64(a</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">True, </span><span class="s1">precision=</span><span class="s3">15</span><span class="s2">, </span><span class="s1">min_digits=</span><span class="s3">15</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s4">'-6.310887241768095e-30'</span><span class="s1">)</span>
        <span class="s5"># adds/remove digits in unique mode with unbiased rnding</span>
        <span class="s1">assert_equal(fsci64(a</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">True, </span><span class="s1">precision=</span><span class="s3">14</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s4">'-6.31088724176809e-30'</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci64(a</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">True, </span><span class="s1">min_digits=</span><span class="s3">16</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s4">'-6.3108872417680944e-30'</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci64(a</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">True, </span><span class="s1">precision=</span><span class="s3">16</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s4">'-6.310887241768095e-30'</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci64(a</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">True, </span><span class="s1">min_digits=</span><span class="s3">14</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s4">'-6.310887241768095e-30'</span><span class="s1">)</span>
        <span class="s5"># test min_digits in unique mode with different rounding cases</span>
        <span class="s1">assert_equal(fsci64(</span><span class="s4">'1e120'</span><span class="s2">, </span><span class="s1">min_digits=</span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s4">'1.000e+120'</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci64(</span><span class="s4">'1e100'</span><span class="s2">, </span><span class="s1">min_digits=</span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s4">'1.000e+100'</span><span class="s1">)</span>

        <span class="s5"># test trailing zeros</span>
        <span class="s1">assert_equal(fpos32(</span><span class="s4">'1.0'</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;1.000&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos64(</span><span class="s4">'1.0'</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;1.000&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci32(</span><span class="s4">'1.0'</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;1.000e+00&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci64(</span><span class="s4">'1.0'</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;1.000e+00&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos32(</span><span class="s4">'1.5'</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;1.500&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fpos64(</span><span class="s4">'1.5'</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;1.500&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci32(</span><span class="s4">'1.5'</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;1.500e+00&quot;</span><span class="s1">)</span>
        <span class="s1">assert_equal(fsci64(</span><span class="s4">'1.5'</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;1.500e+00&quot;</span><span class="s1">)</span>
        <span class="s5"># gh-10713</span>
        <span class="s1">assert_equal(fpos64(</span><span class="s4">'324'</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">5</span><span class="s2">,</span>
                                   <span class="s1">fractional=</span><span class="s2">False</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;324.00&quot;</span><span class="s1">)</span>


    <span class="s2">def </span><span class="s1">test_dragon4_interface(self):</span>
        <span class="s1">tps = [np.float16</span><span class="s2">, </span><span class="s1">np.float32</span><span class="s2">, </span><span class="s1">np.float64]</span>
        <span class="s2">if </span><span class="s1">hasattr(np</span><span class="s2">, </span><span class="s4">'float128'</span><span class="s1">):</span>
            <span class="s1">tps.append(np.float128)</span>

        <span class="s1">fpos = np.format_float_positional</span>
        <span class="s1">fsci = np.format_float_scientific</span>

        <span class="s2">for </span><span class="s1">tp </span><span class="s2">in </span><span class="s1">tps:</span>
            <span class="s5"># test padding</span>
            <span class="s1">assert_equal(fpos(tp(</span><span class="s4">'1.0'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">pad_left=</span><span class="s3">4</span><span class="s2">, </span><span class="s1">pad_right=</span><span class="s3">4</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;   1.    &quot;</span><span class="s1">)</span>
            <span class="s1">assert_equal(fpos(tp(</span><span class="s4">'-1.0'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">pad_left=</span><span class="s3">4</span><span class="s2">, </span><span class="s1">pad_right=</span><span class="s3">4</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;  -1.    &quot;</span><span class="s1">)</span>
            <span class="s1">assert_equal(fpos(tp(</span><span class="s4">'-10.2'</span><span class="s1">)</span><span class="s2">,</span>
                         <span class="s1">pad_left=</span><span class="s3">4</span><span class="s2">, </span><span class="s1">pad_right=</span><span class="s3">4</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot; -10.2   &quot;</span><span class="s1">)</span>

            <span class="s5"># test exp_digits</span>
            <span class="s1">assert_equal(fsci(tp(</span><span class="s4">'1.23e1'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">exp_digits=</span><span class="s3">5</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;1.23e+00001&quot;</span><span class="s1">)</span>

            <span class="s5"># test fixed (non-unique) mode</span>
            <span class="s1">assert_equal(fpos(tp(</span><span class="s4">'1.0'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">4</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;1.0000&quot;</span><span class="s1">)</span>
            <span class="s1">assert_equal(fsci(tp(</span><span class="s4">'1.0'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">4</span><span class="s1">)</span><span class="s2">,</span>
                         <span class="s4">&quot;1.0000e+00&quot;</span><span class="s1">)</span>

            <span class="s5"># test trimming</span>
            <span class="s5"># trim of 'k' or '.' only affects non-unique mode, since unique</span>
            <span class="s5"># mode will not output trailing 0s.</span>
            <span class="s1">assert_equal(fpos(tp(</span><span class="s4">'1.'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">4</span><span class="s2">, </span><span class="s1">trim=</span><span class="s4">'k'</span><span class="s1">)</span><span class="s2">,</span>
                         <span class="s4">&quot;1.0000&quot;</span><span class="s1">)</span>

            <span class="s1">assert_equal(fpos(tp(</span><span class="s4">'1.'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">4</span><span class="s2">, </span><span class="s1">trim=</span><span class="s4">'.'</span><span class="s1">)</span><span class="s2">,</span>
                         <span class="s4">&quot;1.&quot;</span><span class="s1">)</span>
            <span class="s1">assert_equal(fpos(tp(</span><span class="s4">'1.2'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">4</span><span class="s2">, </span><span class="s1">trim=</span><span class="s4">'.'</span><span class="s1">)</span><span class="s2">,</span>
                         <span class="s4">&quot;1.2&quot; </span><span class="s2">if </span><span class="s1">tp != np.float16 </span><span class="s2">else </span><span class="s4">&quot;1.2002&quot;</span><span class="s1">)</span>

            <span class="s1">assert_equal(fpos(tp(</span><span class="s4">'1.'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">4</span><span class="s2">, </span><span class="s1">trim=</span><span class="s4">'0'</span><span class="s1">)</span><span class="s2">,</span>
                         <span class="s4">&quot;1.0&quot;</span><span class="s1">)</span>
            <span class="s1">assert_equal(fpos(tp(</span><span class="s4">'1.2'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">4</span><span class="s2">, </span><span class="s1">trim=</span><span class="s4">'0'</span><span class="s1">)</span><span class="s2">,</span>
                         <span class="s4">&quot;1.2&quot; </span><span class="s2">if </span><span class="s1">tp != np.float16 </span><span class="s2">else </span><span class="s4">&quot;1.2002&quot;</span><span class="s1">)</span>
            <span class="s1">assert_equal(fpos(tp(</span><span class="s4">'1.'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">trim=</span><span class="s4">'0'</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;1.0&quot;</span><span class="s1">)</span>

            <span class="s1">assert_equal(fpos(tp(</span><span class="s4">'1.'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">4</span><span class="s2">, </span><span class="s1">trim=</span><span class="s4">'-'</span><span class="s1">)</span><span class="s2">,</span>
                         <span class="s4">&quot;1&quot;</span><span class="s1">)</span>
            <span class="s1">assert_equal(fpos(tp(</span><span class="s4">'1.2'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">unique=</span><span class="s2">False, </span><span class="s1">precision=</span><span class="s3">4</span><span class="s2">, </span><span class="s1">trim=</span><span class="s4">'-'</span><span class="s1">)</span><span class="s2">,</span>
                         <span class="s4">&quot;1.2&quot; </span><span class="s2">if </span><span class="s1">tp != np.float16 </span><span class="s2">else </span><span class="s4">&quot;1.2002&quot;</span><span class="s1">)</span>
            <span class="s1">assert_equal(fpos(tp(</span><span class="s4">'1.'</span><span class="s1">)</span><span class="s2">, </span><span class="s1">trim=</span><span class="s4">'-'</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;1&quot;</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.skipif(</span><span class="s2">not </span><span class="s1">platform.machine().startswith(</span><span class="s4">&quot;ppc64&quot;</span><span class="s1">)</span><span class="s2">,</span>
                        <span class="s1">reason=</span><span class="s4">&quot;only applies to ppc float128 values&quot;</span><span class="s1">)</span>
    <span class="s2">def </span><span class="s1">test_ppc64_ibm_double_double128(self):</span>
        <span class="s5"># check that the precision decreases once we get into the subnormal</span>
        <span class="s5"># range. Unlike float64, this starts around 1e-292 instead of 1e-308,</span>
        <span class="s5"># which happens when the first double is normal and the second is</span>
        <span class="s5"># subnormal.</span>
        <span class="s1">x = np.float128(</span><span class="s4">'2.123123123123123123123123123123123e-286'</span><span class="s1">)</span>
        <span class="s1">got = [str(x/np.float128(</span><span class="s4">'2e' </span><span class="s1">+ str(i))) </span><span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(</span><span class="s3">0</span><span class="s2">,</span><span class="s3">40</span><span class="s1">)]</span>
        <span class="s1">expected = [</span>
            <span class="s4">&quot;1.06156156156156156156156156156157e-286&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.06156156156156156156156156156158e-287&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.06156156156156156156156156156159e-288&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.0615615615615615615615615615616e-289&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.06156156156156156156156156156157e-290&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.06156156156156156156156156156156e-291&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.0615615615615615615615615615616e-292&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.0615615615615615615615615615615e-293&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.061561561561561561561561561562e-294&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.06156156156156156156156156155e-295&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.0615615615615615615615615616e-296&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.06156156156156156156156156e-297&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.06156156156156156156156157e-298&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.0615615615615615615615616e-299&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.06156156156156156156156e-300&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.06156156156156156156155e-301&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.0615615615615615615616e-302&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.061561561561561561562e-303&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.06156156156156156156e-304&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.0615615615615615618e-305&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.06156156156156156e-306&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.06156156156156157e-307&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.0615615615615616e-308&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.06156156156156e-309&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.06156156156157e-310&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.0615615615616e-311&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.06156156156e-312&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.06156156154e-313&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.0615615616e-314&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.06156156e-315&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.06156155e-316&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.061562e-317&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.06156e-318&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.06155e-319&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.0617e-320&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.06e-321&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1.04e-322&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;1e-323&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;0.0&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;0.0&quot;</span><span class="s1">]</span>
        <span class="s1">assert_equal(got</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s5"># Note: we follow glibc behavior, but it (or gcc) might not be right.</span>
        <span class="s5"># In particular we can get two values that print the same but are not</span>
        <span class="s5"># equal:</span>
        <span class="s1">a = np.float128(</span><span class="s4">'2'</span><span class="s1">)/np.float128(</span><span class="s4">'3'</span><span class="s1">)</span>
        <span class="s1">b = np.float128(str(a))</span>
        <span class="s1">assert_equal(str(a)</span><span class="s2">, </span><span class="s1">str(b))</span>
        <span class="s1">assert_(a != b)</span>

    <span class="s2">def </span><span class="s1">float32_roundtrip(self):</span>
        <span class="s5"># gh-9360</span>
        <span class="s1">x = np.float32(</span><span class="s3">1024 </span><span class="s1">- </span><span class="s3">2</span><span class="s1">**-</span><span class="s3">14</span><span class="s1">)</span>
        <span class="s1">y = np.float32(</span><span class="s3">1024 </span><span class="s1">- </span><span class="s3">2</span><span class="s1">**-</span><span class="s3">13</span><span class="s1">)</span>
        <span class="s1">assert_(repr(x) != repr(y))</span>
        <span class="s1">assert_equal(np.float32(repr(x))</span><span class="s2">, </span><span class="s1">x)</span>
        <span class="s1">assert_equal(np.float32(repr(y))</span><span class="s2">, </span><span class="s1">y)</span>

    <span class="s2">def </span><span class="s1">float64_vs_python(self):</span>
        <span class="s5"># gh-2643, gh-6136, gh-6908</span>
        <span class="s1">assert_equal(repr(np.float64(</span><span class="s3">0.1</span><span class="s1">))</span><span class="s2">, </span><span class="s1">repr(</span><span class="s3">0.1</span><span class="s1">))</span>
        <span class="s1">assert_(repr(np.float64(</span><span class="s3">0.20000000000000004</span><span class="s1">)) != repr(</span><span class="s3">0.2</span><span class="s1">))</span>
</pre>
</body>
</html>