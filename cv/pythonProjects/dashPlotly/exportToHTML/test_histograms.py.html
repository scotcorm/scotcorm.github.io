<html>
<head>
<title>test_histograms.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #808080;}
.s4 { color: #6a8759;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_histograms.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>

<span class="s0">from </span><span class="s1">numpy.lib.histograms </span><span class="s0">import </span><span class="s1">histogram</span><span class="s0">, </span><span class="s1">histogramdd</span><span class="s0">, </span><span class="s1">histogram_bin_edges</span>
<span class="s0">from </span><span class="s1">numpy.testing </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">assert_</span><span class="s0">, </span><span class="s1">assert_equal</span><span class="s0">, </span><span class="s1">assert_array_equal</span><span class="s0">, </span><span class="s1">assert_almost_equal</span><span class="s0">,</span>
    <span class="s1">assert_array_almost_equal</span><span class="s0">, </span><span class="s1">assert_raises</span><span class="s0">, </span><span class="s1">assert_allclose</span><span class="s0">,</span>
    <span class="s1">assert_array_max_ulp</span><span class="s0">, </span><span class="s1">assert_raises_regex</span><span class="s0">, </span><span class="s1">suppress_warnings</span><span class="s0">,</span>
    <span class="s1">)</span>
<span class="s0">import </span><span class="s1">pytest</span>


<span class="s0">class </span><span class="s1">TestHistogram:</span>

    <span class="s0">def </span><span class="s1">setup(self):</span>
        <span class="s0">pass</span>

    <span class="s0">def </span><span class="s1">teardown(self):</span>
        <span class="s0">pass</span>

    <span class="s0">def </span><span class="s1">test_simple(self):</span>
        <span class="s1">n = </span><span class="s2">100</span>
        <span class="s1">v = np.random.rand(n)</span>
        <span class="s1">(a</span><span class="s0">, </span><span class="s1">b) = histogram(v)</span>
        <span class="s3"># check if the sum of the bins equals the number of samples</span>
        <span class="s1">assert_equal(np.sum(a</span><span class="s0">, </span><span class="s1">axis=</span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">n)</span>
        <span class="s3"># check that the bin counts are evenly spaced when the data is from</span>
        <span class="s3"># a linear function</span>
        <span class="s1">(a</span><span class="s0">, </span><span class="s1">b) = histogram(np.linspace(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">100</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(a</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_one_bin(self):</span>
        <span class="s3"># Ticket 632</span>
        <span class="s1">hist</span><span class="s0">, </span><span class="s1">edges = histogram([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(hist</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s1">])</span>
        <span class="s1">assert_array_equal(edges</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">histogram</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">bins=</span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">h</span><span class="s0">, </span><span class="s1">e = histogram([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">bins=</span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(h</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s2">2</span><span class="s1">]))</span>
        <span class="s1">assert_allclose(e</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s2">1.</span><span class="s0">, </span><span class="s2">2.</span><span class="s1">]))</span>

    <span class="s0">def </span><span class="s1">test_normed(self):</span>
        <span class="s1">sup = suppress_warnings()</span>
        <span class="s0">with </span><span class="s1">sup:</span>
            <span class="s1">rec = sup.record(np.VisibleDeprecationWarning</span><span class="s0">, </span><span class="s4">'.*normed.*'</span><span class="s1">)</span>
            <span class="s3"># Check that the integral of the density equals 1.</span>
            <span class="s1">n = </span><span class="s2">100</span>
            <span class="s1">v = np.random.rand(n)</span>
            <span class="s1">a</span><span class="s0">, </span><span class="s1">b = histogram(v</span><span class="s0">, </span><span class="s1">normed=</span><span class="s0">True</span><span class="s1">)</span>
            <span class="s1">area = np.sum(a * np.diff(b))</span>
            <span class="s1">assert_almost_equal(area</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
            <span class="s1">assert_equal(len(rec)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

        <span class="s1">sup = suppress_warnings()</span>
        <span class="s0">with </span><span class="s1">sup:</span>
            <span class="s1">rec = sup.record(np.VisibleDeprecationWarning</span><span class="s0">, </span><span class="s4">'.*normed.*'</span><span class="s1">)</span>
            <span class="s3"># Check with non-constant bin widths (buggy but backwards</span>
            <span class="s3"># compatible)</span>
            <span class="s1">v = np.arange(</span><span class="s2">10</span><span class="s1">)</span>
            <span class="s1">bins = [</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s1">]</span>
            <span class="s1">a</span><span class="s0">, </span><span class="s1">b = histogram(v</span><span class="s0">, </span><span class="s1">bins</span><span class="s0">, </span><span class="s1">normed=</span><span class="s0">True</span><span class="s1">)</span>
            <span class="s1">area = np.sum(a * np.diff(b))</span>
            <span class="s1">assert_almost_equal(area</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
            <span class="s1">assert_equal(len(rec)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_density(self):</span>
        <span class="s3"># Check that the integral of the density equals 1.</span>
        <span class="s1">n = </span><span class="s2">100</span>
        <span class="s1">v = np.random.rand(n)</span>
        <span class="s1">a</span><span class="s0">, </span><span class="s1">b = histogram(v</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">area = np.sum(a * np.diff(b))</span>
        <span class="s1">assert_almost_equal(area</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

        <span class="s3"># Check with non-constant bin widths</span>
        <span class="s1">v = np.arange(</span><span class="s2">10</span><span class="s1">)</span>
        <span class="s1">bins = [</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">10</span><span class="s1">]</span>
        <span class="s1">a</span><span class="s0">, </span><span class="s1">b = histogram(v</span><span class="s0">, </span><span class="s1">bins</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(a</span><span class="s0">, </span><span class="s2">.1</span><span class="s1">)</span>
        <span class="s1">assert_equal(np.sum(a * np.diff(b))</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

        <span class="s3"># Test that passing False works too</span>
        <span class="s1">a</span><span class="s0">, </span><span class="s1">b = histogram(v</span><span class="s0">, </span><span class="s1">bins</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(a</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">])</span>

        <span class="s3"># Variable bin widths are especially useful to deal with</span>
        <span class="s3"># infinities.</span>
        <span class="s1">v = np.arange(</span><span class="s2">10</span><span class="s1">)</span>
        <span class="s1">bins = [</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s1">np.inf]</span>
        <span class="s1">a</span><span class="s0">, </span><span class="s1">b = histogram(v</span><span class="s0">, </span><span class="s1">bins</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(a</span><span class="s0">, </span><span class="s1">[</span><span class="s2">.1</span><span class="s0">, </span><span class="s2">.1</span><span class="s0">, </span><span class="s2">.1</span><span class="s0">, </span><span class="s2">0.</span><span class="s1">])</span>

        <span class="s3"># Taken from a bug report from N. Becker on the numpy-discussion</span>
        <span class="s3"># mailing list Aug. 6, 2010.</span>
        <span class="s1">counts</span><span class="s0">, </span><span class="s1">dmy = np.histogram(</span>
            <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">1.5</span><span class="s0">, </span><span class="s1">np.inf]</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(counts</span><span class="s0">, </span><span class="s1">[</span><span class="s2">.25</span><span class="s0">, </span><span class="s2">0</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_outliers(self):</span>
        <span class="s3"># Check that outliers are not tallied</span>
        <span class="s1">a = np.arange(</span><span class="s2">10</span><span class="s1">) + </span><span class="s2">.5</span>

        <span class="s3"># Lower outliers</span>
        <span class="s1">h</span><span class="s0">, </span><span class="s1">b = histogram(a</span><span class="s0">, </span><span class="s1">range=[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">9</span><span class="s1">])</span>
        <span class="s1">assert_equal(h.sum()</span><span class="s0">, </span><span class="s2">9</span><span class="s1">)</span>

        <span class="s3"># Upper outliers</span>
        <span class="s1">h</span><span class="s0">, </span><span class="s1">b = histogram(a</span><span class="s0">, </span><span class="s1">range=[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">10</span><span class="s1">])</span>
        <span class="s1">assert_equal(h.sum()</span><span class="s0">, </span><span class="s2">9</span><span class="s1">)</span>

        <span class="s3"># Normalization</span>
        <span class="s1">h</span><span class="s0">, </span><span class="s1">b = histogram(a</span><span class="s0">, </span><span class="s1">range=[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal((h * np.diff(b)).sum()</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s2">15</span><span class="s1">)</span>

        <span class="s3"># Weights</span>
        <span class="s1">w = np.arange(</span><span class="s2">10</span><span class="s1">) + </span><span class="s2">.5</span>
        <span class="s1">h</span><span class="s0">, </span><span class="s1">b = histogram(a</span><span class="s0">, </span><span class="s1">range=[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">weights=w</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_equal((h * np.diff(b)).sum()</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

        <span class="s1">h</span><span class="s0">, </span><span class="s1">b = histogram(a</span><span class="s0">, </span><span class="s1">bins=</span><span class="s2">8</span><span class="s0">, </span><span class="s1">range=[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">weights=w)</span>
        <span class="s1">assert_equal(h</span><span class="s0">, </span><span class="s1">w[</span><span class="s2">1</span><span class="s1">:-</span><span class="s2">1</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_arr_weights_mismatch(self):</span>
        <span class="s1">a = np.arange(</span><span class="s2">10</span><span class="s1">) + </span><span class="s2">.5</span>
        <span class="s1">w = np.arange(</span><span class="s2">11</span><span class="s1">) + </span><span class="s2">.5</span>
        <span class="s0">with </span><span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s4">&quot;same shape as&quot;</span><span class="s1">):</span>
            <span class="s1">h</span><span class="s0">, </span><span class="s1">b = histogram(a</span><span class="s0">, </span><span class="s1">range=[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">weights=w</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>


    <span class="s0">def </span><span class="s1">test_type(self):</span>
        <span class="s3"># Check the type of the returned histogram</span>
        <span class="s1">a = np.arange(</span><span class="s2">10</span><span class="s1">) + </span><span class="s2">.5</span>
        <span class="s1">h</span><span class="s0">, </span><span class="s1">b = histogram(a)</span>
        <span class="s1">assert_(np.issubdtype(h.dtype</span><span class="s0">, </span><span class="s1">np.integer))</span>

        <span class="s1">h</span><span class="s0">, </span><span class="s1">b = histogram(a</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_(np.issubdtype(h.dtype</span><span class="s0">, </span><span class="s1">np.floating))</span>

        <span class="s1">h</span><span class="s0">, </span><span class="s1">b = histogram(a</span><span class="s0">, </span><span class="s1">weights=np.ones(</span><span class="s2">10</span><span class="s0">, </span><span class="s1">int))</span>
        <span class="s1">assert_(np.issubdtype(h.dtype</span><span class="s0">, </span><span class="s1">np.integer))</span>

        <span class="s1">h</span><span class="s0">, </span><span class="s1">b = histogram(a</span><span class="s0">, </span><span class="s1">weights=np.ones(</span><span class="s2">10</span><span class="s0">, </span><span class="s1">float))</span>
        <span class="s1">assert_(np.issubdtype(h.dtype</span><span class="s0">, </span><span class="s1">np.floating))</span>

    <span class="s0">def </span><span class="s1">test_f32_rounding(self):</span>
        <span class="s3"># gh-4799, check that the rounding of the edges works with float32</span>
        <span class="s1">x = np.array([</span><span class="s2">276.318359</span><span class="s0">, </span><span class="s1">-</span><span class="s2">69.593948</span><span class="s0">, </span><span class="s2">21.329449</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.float32)</span>
        <span class="s1">y = np.array([</span><span class="s2">5005.689453</span><span class="s0">, </span><span class="s2">4481.327637</span><span class="s0">, </span><span class="s2">6010.369629</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.float32)</span>
        <span class="s1">counts_hist</span><span class="s0">, </span><span class="s1">xedges</span><span class="s0">, </span><span class="s1">yedges = np.histogram2d(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">bins=</span><span class="s2">100</span><span class="s1">)</span>
        <span class="s1">assert_equal(counts_hist.sum()</span><span class="s0">, </span><span class="s2">3.</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_bool_conversion(self):</span>
        <span class="s3"># gh-12107</span>
        <span class="s3"># Reference integer histogram</span>
        <span class="s1">a = np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.uint8)</span>
        <span class="s1">int_hist</span><span class="s0">, </span><span class="s1">int_edges = np.histogram(a)</span>

        <span class="s3"># Should raise an warning on booleans</span>
        <span class="s3"># Ensure that the histograms are equivalent, need to suppress</span>
        <span class="s3"># the warnings to get the actual outputs</span>
        <span class="s0">with </span><span class="s1">suppress_warnings() </span><span class="s0">as </span><span class="s1">sup:</span>
            <span class="s1">rec = sup.record(RuntimeWarning</span><span class="s0">, </span><span class="s4">'Converting input from .*'</span><span class="s1">)</span>
            <span class="s1">hist</span><span class="s0">, </span><span class="s1">edges = np.histogram([</span><span class="s0">True, True, False</span><span class="s1">])</span>
            <span class="s3"># A warning should be issued</span>
            <span class="s1">assert_equal(len(rec)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
            <span class="s1">assert_array_equal(hist</span><span class="s0">, </span><span class="s1">int_hist)</span>
            <span class="s1">assert_array_equal(edges</span><span class="s0">, </span><span class="s1">int_edges)</span>

    <span class="s0">def </span><span class="s1">test_weights(self):</span>
        <span class="s1">v = np.random.rand(</span><span class="s2">100</span><span class="s1">)</span>
        <span class="s1">w = np.ones(</span><span class="s2">100</span><span class="s1">) * </span><span class="s2">5</span>
        <span class="s1">a</span><span class="s0">, </span><span class="s1">b = histogram(v)</span>
        <span class="s1">na</span><span class="s0">, </span><span class="s1">nb = histogram(v</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">wa</span><span class="s0">, </span><span class="s1">wb = histogram(v</span><span class="s0">, </span><span class="s1">weights=w)</span>
        <span class="s1">nwa</span><span class="s0">, </span><span class="s1">nwb = histogram(v</span><span class="s0">, </span><span class="s1">weights=w</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(a * </span><span class="s2">5</span><span class="s0">, </span><span class="s1">wa)</span>
        <span class="s1">assert_array_almost_equal(na</span><span class="s0">, </span><span class="s1">nwa)</span>

        <span class="s3"># Check weights are properly applied.</span>
        <span class="s1">v = np.linspace(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)</span>
        <span class="s1">w = np.concatenate((np.zeros(</span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.ones(</span><span class="s2">5</span><span class="s1">)))</span>
        <span class="s1">wa</span><span class="s0">, </span><span class="s1">wb = histogram(v</span><span class="s0">, </span><span class="s1">bins=np.arange(</span><span class="s2">11</span><span class="s1">)</span><span class="s0">, </span><span class="s1">weights=w)</span>
        <span class="s1">assert_array_almost_equal(wa</span><span class="s0">, </span><span class="s1">w)</span>

        <span class="s3"># Check with integer weights</span>
        <span class="s1">wa</span><span class="s0">, </span><span class="s1">wb = histogram([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">bins=</span><span class="s2">4</span><span class="s0">, </span><span class="s1">weights=[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(wa</span><span class="s0">, </span><span class="s1">[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>
        <span class="s1">wa</span><span class="s0">, </span><span class="s1">wb = histogram(</span>
            <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">bins=</span><span class="s2">4</span><span class="s0">, </span><span class="s1">weights=[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(wa</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]) / </span><span class="s2">10. </span><span class="s1">/ </span><span class="s2">3. </span><span class="s1">* </span><span class="s2">4</span><span class="s1">)</span>

        <span class="s3"># Check weights with non-uniform bin widths</span>
        <span class="s1">a</span><span class="s0">, </span><span class="s1">b = histogram(</span>
            <span class="s1">np.arange(</span><span class="s2">9</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">10</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">weights=[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(a</span><span class="s0">, </span><span class="s1">[</span><span class="s2">.2</span><span class="s0">, </span><span class="s2">.1</span><span class="s0">, </span><span class="s2">.1</span><span class="s0">, </span><span class="s2">.075</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_exotic_weights(self):</span>

        <span class="s3"># Test the use of weights that are not integer or floats, but e.g.</span>
        <span class="s3"># complex numbers or object types.</span>

        <span class="s3"># Complex weights</span>
        <span class="s1">values = np.array([</span><span class="s2">1.3</span><span class="s0">, </span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">2.3</span><span class="s1">])</span>
        <span class="s1">weights = np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]) + </span><span class="s2">1j </span><span class="s1">* np.array([</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>

        <span class="s3"># Check with custom bins</span>
        <span class="s1">wa</span><span class="s0">, </span><span class="s1">wb = histogram(values</span><span class="s0">, </span><span class="s1">bins=[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">weights=weights)</span>
        <span class="s1">assert_array_almost_equal(wa</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]) + </span><span class="s2">1j </span><span class="s1">* np.array([</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]))</span>

        <span class="s3"># Check with even bins</span>
        <span class="s1">wa</span><span class="s0">, </span><span class="s1">wb = histogram(values</span><span class="s0">, </span><span class="s1">bins=</span><span class="s2">2</span><span class="s0">, </span><span class="s1">range=[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">weights=weights)</span>
        <span class="s1">assert_array_almost_equal(wa</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]) + </span><span class="s2">1j </span><span class="s1">* np.array([</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]))</span>

        <span class="s3"># Decimal weights</span>
        <span class="s0">from </span><span class="s1">decimal </span><span class="s0">import </span><span class="s1">Decimal</span>
        <span class="s1">values = np.array([</span><span class="s2">1.3</span><span class="s0">, </span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">2.3</span><span class="s1">])</span>
        <span class="s1">weights = np.array([Decimal(</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">Decimal(</span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">Decimal(</span><span class="s2">3</span><span class="s1">)])</span>

        <span class="s3"># Check with custom bins</span>
        <span class="s1">wa</span><span class="s0">, </span><span class="s1">wb = histogram(values</span><span class="s0">, </span><span class="s1">bins=[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">weights=weights)</span>
        <span class="s1">assert_array_almost_equal(wa</span><span class="s0">, </span><span class="s1">[Decimal(</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">Decimal(</span><span class="s2">5</span><span class="s1">)])</span>

        <span class="s3"># Check with even bins</span>
        <span class="s1">wa</span><span class="s0">, </span><span class="s1">wb = histogram(values</span><span class="s0">, </span><span class="s1">bins=</span><span class="s2">2</span><span class="s0">, </span><span class="s1">range=[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">weights=weights)</span>
        <span class="s1">assert_array_almost_equal(wa</span><span class="s0">, </span><span class="s1">[Decimal(</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">Decimal(</span><span class="s2">5</span><span class="s1">)])</span>

    <span class="s0">def </span><span class="s1">test_no_side_effects(self):</span>
        <span class="s3"># This is a regression test that ensures that values passed to</span>
        <span class="s3"># ``histogram`` are unchanged.</span>
        <span class="s1">values = np.array([</span><span class="s2">1.3</span><span class="s0">, </span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">2.3</span><span class="s1">])</span>
        <span class="s1">np.histogram(values</span><span class="s0">, </span><span class="s1">range=[-</span><span class="s2">10</span><span class="s0">, </span><span class="s2">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">bins=</span><span class="s2">100</span><span class="s1">)</span>
        <span class="s1">assert_array_almost_equal(values</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1.3</span><span class="s0">, </span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">2.3</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_empty(self):</span>
        <span class="s1">a</span><span class="s0">, </span><span class="s1">b = histogram([]</span><span class="s0">, </span><span class="s1">bins=([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]))</span>
        <span class="s1">assert_array_equal(a</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s2">0</span><span class="s1">]))</span>
        <span class="s1">assert_array_equal(b</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]))</span>

    <span class="s0">def </span><span class="s1">test_error_binnum_type (self):</span>
        <span class="s3"># Tests if right Error is raised if bins argument is float</span>
        <span class="s1">vals = np.linspace(</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">1.0</span><span class="s0">, </span><span class="s1">num=</span><span class="s2">100</span><span class="s1">)</span>
        <span class="s1">histogram(vals</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span>
        <span class="s1">assert_raises(TypeError</span><span class="s0">, </span><span class="s1">histogram</span><span class="s0">, </span><span class="s1">vals</span><span class="s0">, </span><span class="s2">2.4</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_finite_range(self):</span>
        <span class="s3"># Normal ranges should be fine</span>
        <span class="s1">vals = np.linspace(</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">1.0</span><span class="s0">, </span><span class="s1">num=</span><span class="s2">100</span><span class="s1">)</span>
        <span class="s1">histogram(vals</span><span class="s0">, </span><span class="s1">range=[</span><span class="s2">0.25</span><span class="s0">,</span><span class="s2">0.75</span><span class="s1">])</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">histogram</span><span class="s0">, </span><span class="s1">vals</span><span class="s0">, </span><span class="s1">range=[np.nan</span><span class="s0">,</span><span class="s2">0.75</span><span class="s1">])</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">histogram</span><span class="s0">, </span><span class="s1">vals</span><span class="s0">, </span><span class="s1">range=[</span><span class="s2">0.25</span><span class="s0">,</span><span class="s1">np.inf])</span>

    <span class="s0">def </span><span class="s1">test_invalid_range(self):</span>
        <span class="s3"># start of range must be &lt; end of range</span>
        <span class="s1">vals = np.linspace(</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">1.0</span><span class="s0">, </span><span class="s1">num=</span><span class="s2">100</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s4">&quot;max must be larger than&quot;</span><span class="s1">):</span>
            <span class="s1">np.histogram(vals</span><span class="s0">, </span><span class="s1">range=[</span><span class="s2">0.1</span><span class="s0">, </span><span class="s2">0.01</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_bin_edge_cases(self):</span>
        <span class="s3"># Ensure that floating-point computations correctly place edge cases.</span>
        <span class="s1">arr = np.array([</span><span class="s2">337</span><span class="s0">, </span><span class="s2">404</span><span class="s0">, </span><span class="s2">739</span><span class="s0">, </span><span class="s2">806</span><span class="s0">, </span><span class="s2">1007</span><span class="s0">, </span><span class="s2">1811</span><span class="s0">, </span><span class="s2">2012</span><span class="s1">])</span>
        <span class="s1">hist</span><span class="s0">, </span><span class="s1">edges = np.histogram(arr</span><span class="s0">, </span><span class="s1">bins=</span><span class="s2">8296</span><span class="s0">, </span><span class="s1">range=(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2280</span><span class="s1">))</span>
        <span class="s1">mask = hist &gt; </span><span class="s2">0</span>
        <span class="s1">left_edges = edges[:-</span><span class="s2">1</span><span class="s1">][mask]</span>
        <span class="s1">right_edges = edges[</span><span class="s2">1</span><span class="s1">:][mask]</span>
        <span class="s0">for </span><span class="s1">x</span><span class="s0">, </span><span class="s1">left</span><span class="s0">, </span><span class="s1">right </span><span class="s0">in </span><span class="s1">zip(arr</span><span class="s0">, </span><span class="s1">left_edges</span><span class="s0">, </span><span class="s1">right_edges):</span>
            <span class="s1">assert_(x &gt;= left)</span>
            <span class="s1">assert_(x &lt; right)</span>

    <span class="s0">def </span><span class="s1">test_last_bin_inclusive_range(self):</span>
        <span class="s1">arr = np.array([</span><span class="s2">0.</span><span class="s0">,  </span><span class="s2">0.</span><span class="s0">,  </span><span class="s2">0.</span><span class="s0">,  </span><span class="s2">1.</span><span class="s0">,  </span><span class="s2">2.</span><span class="s0">,  </span><span class="s2">3.</span><span class="s0">,  </span><span class="s2">3.</span><span class="s0">,  </span><span class="s2">4.</span><span class="s0">,  </span><span class="s2">5.</span><span class="s1">])</span>
        <span class="s1">hist</span><span class="s0">, </span><span class="s1">edges = np.histogram(arr</span><span class="s0">, </span><span class="s1">bins=</span><span class="s2">30</span><span class="s0">, </span><span class="s1">range=(-</span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">5</span><span class="s1">))</span>
        <span class="s1">assert_equal(hist[-</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_bin_array_dims(self):</span>
        <span class="s3"># gracefully handle bins object &gt; 1 dimension</span>
        <span class="s1">vals = np.linspace(</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">1.0</span><span class="s0">, </span><span class="s1">num=</span><span class="s2">100</span><span class="s1">)</span>
        <span class="s1">bins = np.array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0.6</span><span class="s0">, </span><span class="s2">1.0</span><span class="s1">]])</span>
        <span class="s0">with </span><span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s4">&quot;must be 1d&quot;</span><span class="s1">):</span>
            <span class="s1">np.histogram(vals</span><span class="s0">, </span><span class="s1">bins=bins)</span>

    <span class="s0">def </span><span class="s1">test_unsigned_monotonicity_check(self):</span>
        <span class="s3"># Ensures ValueError is raised if bins not increasing monotonically</span>
        <span class="s3"># when bins contain unsigned values (see #9222)</span>
        <span class="s1">arr = np.array([</span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">bins = np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">'uint64'</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">assert_raises(ValueError):</span>
            <span class="s1">hist</span><span class="s0">, </span><span class="s1">edges = np.histogram(arr</span><span class="s0">, </span><span class="s1">bins=bins)</span>

    <span class="s0">def </span><span class="s1">test_object_array_of_0d(self):</span>
        <span class="s3"># gh-7864</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">,</span>
            <span class="s1">histogram</span><span class="s0">, </span><span class="s1">[np.array(</span><span class="s2">0.4</span><span class="s1">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">10</span><span class="s1">)] + [-np.inf])</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">,</span>
            <span class="s1">histogram</span><span class="s0">, </span><span class="s1">[np.array(</span><span class="s2">0.4</span><span class="s1">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">10</span><span class="s1">)] + [np.inf])</span>

        <span class="s3"># these should not crash</span>
        <span class="s1">np.histogram([np.array(</span><span class="s2">0.5</span><span class="s1">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">10</span><span class="s1">)] + [</span><span class="s2">.500000000000001</span><span class="s1">])</span>
        <span class="s1">np.histogram([np.array(</span><span class="s2">0.5</span><span class="s1">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">10</span><span class="s1">)] + [</span><span class="s2">.5</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_some_nan_values(self):</span>
        <span class="s3"># gh-7503</span>
        <span class="s1">one_nan = np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">np.nan])</span>
        <span class="s1">all_nan = np.array([np.nan</span><span class="s0">, </span><span class="s1">np.nan])</span>

        <span class="s3"># the internal comparisons with NaN give warnings</span>
        <span class="s1">sup = suppress_warnings()</span>
        <span class="s1">sup.filter(RuntimeWarning)</span>
        <span class="s0">with </span><span class="s1">sup:</span>
            <span class="s3"># can't infer range with nan</span>
            <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">histogram</span><span class="s0">, </span><span class="s1">one_nan</span><span class="s0">, </span><span class="s1">bins=</span><span class="s4">'auto'</span><span class="s1">)</span>
            <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">histogram</span><span class="s0">, </span><span class="s1">all_nan</span><span class="s0">, </span><span class="s1">bins=</span><span class="s4">'auto'</span><span class="s1">)</span>

            <span class="s3"># explicit range solves the problem</span>
            <span class="s1">h</span><span class="s0">, </span><span class="s1">b = histogram(one_nan</span><span class="s0">, </span><span class="s1">bins=</span><span class="s4">'auto'</span><span class="s0">, </span><span class="s1">range=(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">))</span>
            <span class="s1">assert_equal(h.sum()</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)  </span><span class="s3"># nan is not counted</span>
            <span class="s1">h</span><span class="s0">, </span><span class="s1">b = histogram(all_nan</span><span class="s0">, </span><span class="s1">bins=</span><span class="s4">'auto'</span><span class="s0">, </span><span class="s1">range=(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">))</span>
            <span class="s1">assert_equal(h.sum()</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)  </span><span class="s3"># nan is not counted</span>

            <span class="s3"># as does an explicit set of bins</span>
            <span class="s1">h</span><span class="s0">, </span><span class="s1">b = histogram(one_nan</span><span class="s0">, </span><span class="s1">bins=[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>
            <span class="s1">assert_equal(h.sum()</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)  </span><span class="s3"># nan is not counted</span>
            <span class="s1">h</span><span class="s0">, </span><span class="s1">b = histogram(all_nan</span><span class="s0">, </span><span class="s1">bins=[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>
            <span class="s1">assert_equal(h.sum()</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)  </span><span class="s3"># nan is not counted</span>

    <span class="s0">def </span><span class="s1">test_datetime(self):</span>
        <span class="s1">begin = np.datetime64(</span><span class="s4">'2000-01-01'</span><span class="s0">, </span><span class="s4">'D'</span><span class="s1">)</span>
        <span class="s1">offsets = np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">20</span><span class="s1">])</span>
        <span class="s1">bins = np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">20</span><span class="s1">])</span>
        <span class="s1">dates = begin + offsets</span>
        <span class="s1">date_bins = begin + bins</span>

        <span class="s1">td = np.dtype(</span><span class="s4">'timedelta64[D]'</span><span class="s1">)</span>

        <span class="s3"># Results should be the same for integer offsets or datetime values.</span>
        <span class="s3"># For now, only explicit bins are supported, since linspace does not</span>
        <span class="s3"># work on datetimes or timedeltas</span>
        <span class="s1">d_count</span><span class="s0">, </span><span class="s1">d_edge = histogram(dates</span><span class="s0">, </span><span class="s1">bins=date_bins)</span>
        <span class="s1">t_count</span><span class="s0">, </span><span class="s1">t_edge = histogram(offsets.astype(td)</span><span class="s0">, </span><span class="s1">bins=bins.astype(td))</span>
        <span class="s1">i_count</span><span class="s0">, </span><span class="s1">i_edge = histogram(offsets</span><span class="s0">, </span><span class="s1">bins=bins)</span>

        <span class="s1">assert_equal(d_count</span><span class="s0">, </span><span class="s1">i_count)</span>
        <span class="s1">assert_equal(t_count</span><span class="s0">, </span><span class="s1">i_count)</span>

        <span class="s1">assert_equal((d_edge - begin).astype(int)</span><span class="s0">, </span><span class="s1">i_edge)</span>
        <span class="s1">assert_equal(t_edge.astype(int)</span><span class="s0">, </span><span class="s1">i_edge)</span>

        <span class="s1">assert_equal(d_edge.dtype</span><span class="s0">, </span><span class="s1">dates.dtype)</span>
        <span class="s1">assert_equal(t_edge.dtype</span><span class="s0">, </span><span class="s1">td)</span>

    <span class="s0">def </span><span class="s1">do_signed_overflow_bounds(self</span><span class="s0">, </span><span class="s1">dtype):</span>
        <span class="s1">exponent = </span><span class="s2">8 </span><span class="s1">* np.dtype(dtype).itemsize - </span><span class="s2">1</span>
        <span class="s1">arr = np.array([-</span><span class="s2">2</span><span class="s1">**exponent + </span><span class="s2">4</span><span class="s0">, </span><span class="s2">2</span><span class="s1">**exponent - </span><span class="s2">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
        <span class="s1">hist</span><span class="s0">, </span><span class="s1">e = histogram(arr</span><span class="s0">, </span><span class="s1">bins=</span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">assert_equal(e</span><span class="s0">, </span><span class="s1">[-</span><span class="s2">2</span><span class="s1">**exponent + </span><span class="s2">4</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">**exponent - </span><span class="s2">4</span><span class="s1">])</span>
        <span class="s1">assert_equal(hist</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_signed_overflow_bounds(self):</span>
        <span class="s1">self.do_signed_overflow_bounds(np.byte)</span>
        <span class="s1">self.do_signed_overflow_bounds(np.short)</span>
        <span class="s1">self.do_signed_overflow_bounds(np.intc)</span>
        <span class="s1">self.do_signed_overflow_bounds(np.int_)</span>
        <span class="s1">self.do_signed_overflow_bounds(np.longlong)</span>

    <span class="s0">def </span><span class="s1">do_precision_lower_bound(self</span><span class="s0">, </span><span class="s1">float_small</span><span class="s0">, </span><span class="s1">float_large):</span>
        <span class="s1">eps = np.finfo(float_large).eps</span>

        <span class="s1">arr = np.array([</span><span class="s2">1.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">float_small)</span>
        <span class="s1">range = np.array([</span><span class="s2">1.0 </span><span class="s1">+ eps</span><span class="s0">, </span><span class="s2">2.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">float_large)</span>

        <span class="s3"># test is looking for behavior when the bounds change between dtypes</span>
        <span class="s0">if </span><span class="s1">range.astype(float_small)[</span><span class="s2">0</span><span class="s1">] != </span><span class="s2">1</span><span class="s1">:</span>
            <span class="s0">return</span>

        <span class="s3"># previously crashed</span>
        <span class="s1">count</span><span class="s0">, </span><span class="s1">x_loc = np.histogram(arr</span><span class="s0">, </span><span class="s1">bins=</span><span class="s2">1</span><span class="s0">, </span><span class="s1">range=range)</span>
        <span class="s1">assert_equal(count</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s1">])</span>

        <span class="s3"># gh-10322 means that the type comes from arr - this may change</span>
        <span class="s1">assert_equal(x_loc.dtype</span><span class="s0">, </span><span class="s1">float_small)</span>

    <span class="s0">def </span><span class="s1">do_precision_upper_bound(self</span><span class="s0">, </span><span class="s1">float_small</span><span class="s0">, </span><span class="s1">float_large):</span>
        <span class="s1">eps = np.finfo(float_large).eps</span>

        <span class="s1">arr = np.array([</span><span class="s2">1.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">float_small)</span>
        <span class="s1">range = np.array([</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">1.0 </span><span class="s1">- eps]</span><span class="s0">, </span><span class="s1">float_large)</span>

        <span class="s3"># test is looking for behavior when the bounds change between dtypes</span>
        <span class="s0">if </span><span class="s1">range.astype(float_small)[-</span><span class="s2">1</span><span class="s1">] != </span><span class="s2">1</span><span class="s1">:</span>
            <span class="s0">return</span>

        <span class="s3"># previously crashed</span>
        <span class="s1">count</span><span class="s0">, </span><span class="s1">x_loc = np.histogram(arr</span><span class="s0">, </span><span class="s1">bins=</span><span class="s2">1</span><span class="s0">, </span><span class="s1">range=range)</span>
        <span class="s1">assert_equal(count</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s1">])</span>

        <span class="s3"># gh-10322 means that the type comes from arr - this may change</span>
        <span class="s1">assert_equal(x_loc.dtype</span><span class="s0">, </span><span class="s1">float_small)</span>

    <span class="s0">def </span><span class="s1">do_precision(self</span><span class="s0">, </span><span class="s1">float_small</span><span class="s0">, </span><span class="s1">float_large):</span>
        <span class="s1">self.do_precision_lower_bound(float_small</span><span class="s0">, </span><span class="s1">float_large)</span>
        <span class="s1">self.do_precision_upper_bound(float_small</span><span class="s0">, </span><span class="s1">float_large)</span>

    <span class="s0">def </span><span class="s1">test_precision(self):</span>
        <span class="s3"># not looping results in a useful stack trace upon failure</span>
        <span class="s1">self.do_precision(np.half</span><span class="s0">, </span><span class="s1">np.single)</span>
        <span class="s1">self.do_precision(np.half</span><span class="s0">, </span><span class="s1">np.double)</span>
        <span class="s1">self.do_precision(np.half</span><span class="s0">, </span><span class="s1">np.longdouble)</span>
        <span class="s1">self.do_precision(np.single</span><span class="s0">, </span><span class="s1">np.double)</span>
        <span class="s1">self.do_precision(np.single</span><span class="s0">, </span><span class="s1">np.longdouble)</span>
        <span class="s1">self.do_precision(np.double</span><span class="s0">, </span><span class="s1">np.longdouble)</span>

    <span class="s0">def </span><span class="s1">test_histogram_bin_edges(self):</span>
        <span class="s1">hist</span><span class="s0">, </span><span class="s1">e = histogram([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">edges = histogram_bin_edges([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(edges</span><span class="s0">, </span><span class="s1">e)</span>

        <span class="s1">arr = np.array([</span><span class="s2">0.</span><span class="s0">,  </span><span class="s2">0.</span><span class="s0">,  </span><span class="s2">0.</span><span class="s0">,  </span><span class="s2">1.</span><span class="s0">,  </span><span class="s2">2.</span><span class="s0">,  </span><span class="s2">3.</span><span class="s0">,  </span><span class="s2">3.</span><span class="s0">,  </span><span class="s2">4.</span><span class="s0">,  </span><span class="s2">5.</span><span class="s1">])</span>
        <span class="s1">hist</span><span class="s0">, </span><span class="s1">e = histogram(arr</span><span class="s0">, </span><span class="s1">bins=</span><span class="s2">30</span><span class="s0">, </span><span class="s1">range=(-</span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">5</span><span class="s1">))</span>
        <span class="s1">edges = histogram_bin_edges(arr</span><span class="s0">, </span><span class="s1">bins=</span><span class="s2">30</span><span class="s0">, </span><span class="s1">range=(-</span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">5</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(edges</span><span class="s0">, </span><span class="s1">e)</span>

        <span class="s1">hist</span><span class="s0">, </span><span class="s1">e = histogram(arr</span><span class="s0">, </span><span class="s1">bins=</span><span class="s4">'auto'</span><span class="s0">, </span><span class="s1">range=(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">))</span>
        <span class="s1">edges = histogram_bin_edges(arr</span><span class="s0">, </span><span class="s1">bins=</span><span class="s4">'auto'</span><span class="s0">, </span><span class="s1">range=(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(edges</span><span class="s0">, </span><span class="s1">e)</span>


<span class="s0">class </span><span class="s1">TestHistogramOptimBinNums:</span>
    <span class="s5">&quot;&quot;&quot; 
    Provide test coverage when using provided estimators for optimal number of 
    bins 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">test_empty(self):</span>
        <span class="s1">estimator_list = [</span><span class="s4">'fd'</span><span class="s0">, </span><span class="s4">'scott'</span><span class="s0">, </span><span class="s4">'rice'</span><span class="s0">, </span><span class="s4">'sturges'</span><span class="s0">,</span>
                          <span class="s4">'doane'</span><span class="s0">, </span><span class="s4">'sqrt'</span><span class="s0">, </span><span class="s4">'auto'</span><span class="s0">, </span><span class="s4">'stone'</span><span class="s1">]</span>
        <span class="s3"># check it can deal with empty data</span>
        <span class="s0">for </span><span class="s1">estimator </span><span class="s0">in </span><span class="s1">estimator_list:</span>
            <span class="s1">a</span><span class="s0">, </span><span class="s1">b = histogram([]</span><span class="s0">, </span><span class="s1">bins=estimator)</span>
            <span class="s1">assert_array_equal(a</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s2">0</span><span class="s1">]))</span>
            <span class="s1">assert_array_equal(b</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]))</span>

    <span class="s0">def </span><span class="s1">test_simple(self):</span>
        <span class="s5">&quot;&quot;&quot; 
        Straightforward testing with a mixture of linspace data (for 
        consistency). All test values have been precomputed and the values 
        shouldn't change 
        &quot;&quot;&quot;</span>
        <span class="s3"># Some basic sanity checking, with some fixed data.</span>
        <span class="s3"># Checking for the correct number of bins</span>
        <span class="s1">basic_test = {</span><span class="s2">50</span><span class="s1">:   {</span><span class="s4">'fd'</span><span class="s1">: </span><span class="s2">4</span><span class="s0">,  </span><span class="s4">'scott'</span><span class="s1">: </span><span class="s2">4</span><span class="s0">,  </span><span class="s4">'rice'</span><span class="s1">: </span><span class="s2">8</span><span class="s0">,  </span><span class="s4">'sturges'</span><span class="s1">: </span><span class="s2">7</span><span class="s0">,</span>
                             <span class="s4">'doane'</span><span class="s1">: </span><span class="s2">8</span><span class="s0">, </span><span class="s4">'sqrt'</span><span class="s1">: </span><span class="s2">8</span><span class="s0">, </span><span class="s4">'auto'</span><span class="s1">: </span><span class="s2">7</span><span class="s0">, </span><span class="s4">'stone'</span><span class="s1">: </span><span class="s2">2</span><span class="s1">}</span><span class="s0">,</span>
                      <span class="s2">500</span><span class="s1">:  {</span><span class="s4">'fd'</span><span class="s1">: </span><span class="s2">8</span><span class="s0">,  </span><span class="s4">'scott'</span><span class="s1">: </span><span class="s2">8</span><span class="s0">,  </span><span class="s4">'rice'</span><span class="s1">: </span><span class="s2">16</span><span class="s0">, </span><span class="s4">'sturges'</span><span class="s1">: </span><span class="s2">10</span><span class="s0">,</span>
                             <span class="s4">'doane'</span><span class="s1">: </span><span class="s2">12</span><span class="s0">, </span><span class="s4">'sqrt'</span><span class="s1">: </span><span class="s2">23</span><span class="s0">, </span><span class="s4">'auto'</span><span class="s1">: </span><span class="s2">10</span><span class="s0">, </span><span class="s4">'stone'</span><span class="s1">: </span><span class="s2">9</span><span class="s1">}</span><span class="s0">,</span>
                      <span class="s2">5000</span><span class="s1">: {</span><span class="s4">'fd'</span><span class="s1">: </span><span class="s2">17</span><span class="s0">, </span><span class="s4">'scott'</span><span class="s1">: </span><span class="s2">17</span><span class="s0">, </span><span class="s4">'rice'</span><span class="s1">: </span><span class="s2">35</span><span class="s0">, </span><span class="s4">'sturges'</span><span class="s1">: </span><span class="s2">14</span><span class="s0">,</span>
                             <span class="s4">'doane'</span><span class="s1">: </span><span class="s2">17</span><span class="s0">, </span><span class="s4">'sqrt'</span><span class="s1">: </span><span class="s2">71</span><span class="s0">, </span><span class="s4">'auto'</span><span class="s1">: </span><span class="s2">17</span><span class="s0">, </span><span class="s4">'stone'</span><span class="s1">: </span><span class="s2">20</span><span class="s1">}}</span>

        <span class="s0">for </span><span class="s1">testlen</span><span class="s0">, </span><span class="s1">expectedResults </span><span class="s0">in </span><span class="s1">basic_test.items():</span>
            <span class="s3"># Create some sort of non uniform data to test with</span>
            <span class="s3"># (2 peak uniform mixture)</span>
            <span class="s1">x1 = np.linspace(-</span><span class="s2">10</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">testlen // </span><span class="s2">5 </span><span class="s1">* </span><span class="s2">2</span><span class="s1">)</span>
            <span class="s1">x2 = np.linspace(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s1">testlen // </span><span class="s2">5 </span><span class="s1">* </span><span class="s2">3</span><span class="s1">)</span>
            <span class="s1">x = np.concatenate((x1</span><span class="s0">, </span><span class="s1">x2))</span>
            <span class="s0">for </span><span class="s1">estimator</span><span class="s0">, </span><span class="s1">numbins </span><span class="s0">in </span><span class="s1">expectedResults.items():</span>
                <span class="s1">a</span><span class="s0">, </span><span class="s1">b = np.histogram(x</span><span class="s0">, </span><span class="s1">estimator)</span>
                <span class="s1">assert_equal(len(a)</span><span class="s0">, </span><span class="s1">numbins</span><span class="s0">, </span><span class="s1">err_msg=</span><span class="s4">&quot;For the {0} estimator &quot;</span>
                             <span class="s4">&quot;with datasize of {1}&quot;</span><span class="s1">.format(estimator</span><span class="s0">, </span><span class="s1">testlen))</span>

    <span class="s0">def </span><span class="s1">test_small(self):</span>
        <span class="s5">&quot;&quot;&quot; 
        Smaller datasets have the potential to cause issues with the data 
        adaptive methods, especially the FD method. All bin numbers have been 
        precalculated. 
        &quot;&quot;&quot;</span>
        <span class="s1">small_dat = {</span><span class="s2">1</span><span class="s1">: {</span><span class="s4">'fd'</span><span class="s1">: </span><span class="s2">1</span><span class="s0">, </span><span class="s4">'scott'</span><span class="s1">: </span><span class="s2">1</span><span class="s0">, </span><span class="s4">'rice'</span><span class="s1">: </span><span class="s2">1</span><span class="s0">, </span><span class="s4">'sturges'</span><span class="s1">: </span><span class="s2">1</span><span class="s0">,</span>
                         <span class="s4">'doane'</span><span class="s1">: </span><span class="s2">1</span><span class="s0">, </span><span class="s4">'sqrt'</span><span class="s1">: </span><span class="s2">1</span><span class="s0">, </span><span class="s4">'stone'</span><span class="s1">: </span><span class="s2">1</span><span class="s1">}</span><span class="s0">,</span>
                     <span class="s2">2</span><span class="s1">: {</span><span class="s4">'fd'</span><span class="s1">: </span><span class="s2">2</span><span class="s0">, </span><span class="s4">'scott'</span><span class="s1">: </span><span class="s2">1</span><span class="s0">, </span><span class="s4">'rice'</span><span class="s1">: </span><span class="s2">3</span><span class="s0">, </span><span class="s4">'sturges'</span><span class="s1">: </span><span class="s2">2</span><span class="s0">,</span>
                         <span class="s4">'doane'</span><span class="s1">: </span><span class="s2">1</span><span class="s0">, </span><span class="s4">'sqrt'</span><span class="s1">: </span><span class="s2">2</span><span class="s0">, </span><span class="s4">'stone'</span><span class="s1">: </span><span class="s2">1</span><span class="s1">}</span><span class="s0">,</span>
                     <span class="s2">3</span><span class="s1">: {</span><span class="s4">'fd'</span><span class="s1">: </span><span class="s2">2</span><span class="s0">, </span><span class="s4">'scott'</span><span class="s1">: </span><span class="s2">2</span><span class="s0">, </span><span class="s4">'rice'</span><span class="s1">: </span><span class="s2">3</span><span class="s0">, </span><span class="s4">'sturges'</span><span class="s1">: </span><span class="s2">3</span><span class="s0">,</span>
                         <span class="s4">'doane'</span><span class="s1">: </span><span class="s2">3</span><span class="s0">, </span><span class="s4">'sqrt'</span><span class="s1">: </span><span class="s2">2</span><span class="s0">, </span><span class="s4">'stone'</span><span class="s1">: </span><span class="s2">1</span><span class="s1">}}</span>

        <span class="s0">for </span><span class="s1">testlen</span><span class="s0">, </span><span class="s1">expectedResults </span><span class="s0">in </span><span class="s1">small_dat.items():</span>
            <span class="s1">testdat = np.arange(testlen)</span>
            <span class="s0">for </span><span class="s1">estimator</span><span class="s0">, </span><span class="s1">expbins </span><span class="s0">in </span><span class="s1">expectedResults.items():</span>
                <span class="s1">a</span><span class="s0">, </span><span class="s1">b = np.histogram(testdat</span><span class="s0">, </span><span class="s1">estimator)</span>
                <span class="s1">assert_equal(len(a)</span><span class="s0">, </span><span class="s1">expbins</span><span class="s0">, </span><span class="s1">err_msg=</span><span class="s4">&quot;For the {0} estimator &quot;</span>
                             <span class="s4">&quot;with datasize of {1}&quot;</span><span class="s1">.format(estimator</span><span class="s0">, </span><span class="s1">testlen))</span>

    <span class="s0">def </span><span class="s1">test_incorrect_methods(self):</span>
        <span class="s5">&quot;&quot;&quot; 
        Check a Value Error is thrown when an unknown string is passed in 
        &quot;&quot;&quot;</span>
        <span class="s1">check_list = [</span><span class="s4">'mad'</span><span class="s0">, </span><span class="s4">'freeman'</span><span class="s0">, </span><span class="s4">'histograms'</span><span class="s0">, </span><span class="s4">'IQR'</span><span class="s1">]</span>
        <span class="s0">for </span><span class="s1">estimator </span><span class="s0">in </span><span class="s1">check_list:</span>
            <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">histogram</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">estimator)</span>

    <span class="s0">def </span><span class="s1">test_novariance(self):</span>
        <span class="s5">&quot;&quot;&quot; 
        Check that methods handle no variance in data 
        Primarily for Scott and FD as the SD and IQR are both 0 in this case 
        &quot;&quot;&quot;</span>
        <span class="s1">novar_dataset = np.ones(</span><span class="s2">100</span><span class="s1">)</span>
        <span class="s1">novar_resultdict = {</span><span class="s4">'fd'</span><span class="s1">: </span><span class="s2">1</span><span class="s0">, </span><span class="s4">'scott'</span><span class="s1">: </span><span class="s2">1</span><span class="s0">, </span><span class="s4">'rice'</span><span class="s1">: </span><span class="s2">1</span><span class="s0">, </span><span class="s4">'sturges'</span><span class="s1">: </span><span class="s2">1</span><span class="s0">,</span>
                            <span class="s4">'doane'</span><span class="s1">: </span><span class="s2">1</span><span class="s0">, </span><span class="s4">'sqrt'</span><span class="s1">: </span><span class="s2">1</span><span class="s0">, </span><span class="s4">'auto'</span><span class="s1">: </span><span class="s2">1</span><span class="s0">, </span><span class="s4">'stone'</span><span class="s1">: </span><span class="s2">1</span><span class="s1">}</span>

        <span class="s0">for </span><span class="s1">estimator</span><span class="s0">, </span><span class="s1">numbins </span><span class="s0">in </span><span class="s1">novar_resultdict.items():</span>
            <span class="s1">a</span><span class="s0">, </span><span class="s1">b = np.histogram(novar_dataset</span><span class="s0">, </span><span class="s1">estimator)</span>
            <span class="s1">assert_equal(len(a)</span><span class="s0">, </span><span class="s1">numbins</span><span class="s0">, </span><span class="s1">err_msg=</span><span class="s4">&quot;{0} estimator, &quot;</span>
                         <span class="s4">&quot;No Variance test&quot;</span><span class="s1">.format(estimator))</span>

    <span class="s0">def </span><span class="s1">test_limited_variance(self):</span>
        <span class="s5">&quot;&quot;&quot; 
        Check when IQR is 0, but variance exists, we return the sturges value 
        and not the fd value. 
        &quot;&quot;&quot;</span>
        <span class="s1">lim_var_data = np.ones(</span><span class="s2">1000</span><span class="s1">)</span>
        <span class="s1">lim_var_data[:</span><span class="s2">3</span><span class="s1">] = </span><span class="s2">0</span>
        <span class="s1">lim_var_data[-</span><span class="s2">4</span><span class="s1">:] = </span><span class="s2">100</span>

        <span class="s1">edges_auto = histogram_bin_edges(lim_var_data</span><span class="s0">, </span><span class="s4">'auto'</span><span class="s1">)</span>
        <span class="s1">assert_equal(edges_auto</span><span class="s0">, </span><span class="s1">np.linspace(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">100</span><span class="s0">, </span><span class="s2">12</span><span class="s1">))</span>

        <span class="s1">edges_fd = histogram_bin_edges(lim_var_data</span><span class="s0">, </span><span class="s4">'fd'</span><span class="s1">)</span>
        <span class="s1">assert_equal(edges_fd</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">100</span><span class="s1">]))</span>

        <span class="s1">edges_sturges = histogram_bin_edges(lim_var_data</span><span class="s0">, </span><span class="s4">'sturges'</span><span class="s1">)</span>
        <span class="s1">assert_equal(edges_sturges</span><span class="s0">, </span><span class="s1">np.linspace(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">100</span><span class="s0">, </span><span class="s2">12</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_outlier(self):</span>
        <span class="s5">&quot;&quot;&quot; 
        Check the FD, Scott and Doane with outliers. 
 
        The FD estimates a smaller binwidth since it's less affected by 
        outliers. Since the range is so (artificially) large, this means more 
        bins, most of which will be empty, but the data of interest usually is 
        unaffected. The Scott estimator is more affected and returns fewer bins, 
        despite most of the variance being in one area of the data. The Doane 
        estimator lies somewhere between the other two. 
        &quot;&quot;&quot;</span>
        <span class="s1">xcenter = np.linspace(-</span><span class="s2">10</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">50</span><span class="s1">)</span>
        <span class="s1">outlier_dataset = np.hstack((np.linspace(-</span><span class="s2">110</span><span class="s0">, </span><span class="s1">-</span><span class="s2">100</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">xcenter))</span>

        <span class="s1">outlier_resultdict = {</span><span class="s4">'fd'</span><span class="s1">: </span><span class="s2">21</span><span class="s0">, </span><span class="s4">'scott'</span><span class="s1">: </span><span class="s2">5</span><span class="s0">, </span><span class="s4">'doane'</span><span class="s1">: </span><span class="s2">11</span><span class="s0">, </span><span class="s4">'stone'</span><span class="s1">: </span><span class="s2">6</span><span class="s1">}</span>

        <span class="s0">for </span><span class="s1">estimator</span><span class="s0">, </span><span class="s1">numbins </span><span class="s0">in </span><span class="s1">outlier_resultdict.items():</span>
            <span class="s1">a</span><span class="s0">, </span><span class="s1">b = np.histogram(outlier_dataset</span><span class="s0">, </span><span class="s1">estimator)</span>
            <span class="s1">assert_equal(len(a)</span><span class="s0">, </span><span class="s1">numbins)</span>

    <span class="s0">def </span><span class="s1">test_scott_vs_stone(self):</span>
        <span class="s5">&quot;&quot;&quot;Verify that Scott's rule and Stone's rule converges for normally distributed data&quot;&quot;&quot;</span>

        <span class="s0">def </span><span class="s1">nbins_ratio(seed</span><span class="s0">, </span><span class="s1">size):</span>
            <span class="s1">rng = np.random.RandomState(seed)</span>
            <span class="s1">x = rng.normal(loc=</span><span class="s2">0</span><span class="s0">, </span><span class="s1">scale=</span><span class="s2">2</span><span class="s0">, </span><span class="s1">size=size)</span>
            <span class="s1">a</span><span class="s0">, </span><span class="s1">b = len(np.histogram(x</span><span class="s0">, </span><span class="s4">'stone'</span><span class="s1">)[</span><span class="s2">0</span><span class="s1">])</span><span class="s0">, </span><span class="s1">len(np.histogram(x</span><span class="s0">, </span><span class="s4">'scott'</span><span class="s1">)[</span><span class="s2">0</span><span class="s1">])</span>
            <span class="s0">return </span><span class="s1">a / (a + b)</span>

        <span class="s1">ll = [[nbins_ratio(seed</span><span class="s0">, </span><span class="s1">size) </span><span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">np.geomspace(start=</span><span class="s2">10</span><span class="s0">, </span><span class="s1">stop=</span><span class="s2">100</span><span class="s0">, </span><span class="s1">num=</span><span class="s2">4</span><span class="s1">).round().astype(int)]</span>
              <span class="s0">for </span><span class="s1">seed </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">10</span><span class="s1">)]</span>

        <span class="s3"># the average difference between the two methods decreases as the dataset size increases.</span>
        <span class="s1">avg = abs(np.mean(ll</span><span class="s0">, </span><span class="s1">axis=</span><span class="s2">0</span><span class="s1">) - </span><span class="s2">0.5</span><span class="s1">)</span>
        <span class="s1">assert_almost_equal(avg</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0.15</span><span class="s0">, </span><span class="s2">0.09</span><span class="s0">, </span><span class="s2">0.08</span><span class="s0">, </span><span class="s2">0.03</span><span class="s1">]</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s2">2</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_simple_range(self):</span>
        <span class="s5">&quot;&quot;&quot; 
        Straightforward testing with a mixture of linspace data (for 
        consistency). Adding in a 3rd mixture that will then be 
        completely ignored. All test values have been precomputed and 
        the shouldn't change. 
        &quot;&quot;&quot;</span>
        <span class="s3"># some basic sanity checking, with some fixed data.</span>
        <span class="s3"># Checking for the correct number of bins</span>
        <span class="s1">basic_test = {</span>
                      <span class="s2">50</span><span class="s1">:   {</span><span class="s4">'fd'</span><span class="s1">: </span><span class="s2">8</span><span class="s0">,  </span><span class="s4">'scott'</span><span class="s1">: </span><span class="s2">8</span><span class="s0">,  </span><span class="s4">'rice'</span><span class="s1">: </span><span class="s2">15</span><span class="s0">,</span>
                             <span class="s4">'sturges'</span><span class="s1">: </span><span class="s2">14</span><span class="s0">, </span><span class="s4">'auto'</span><span class="s1">: </span><span class="s2">14</span><span class="s0">, </span><span class="s4">'stone'</span><span class="s1">: </span><span class="s2">8</span><span class="s1">}</span><span class="s0">,</span>
                      <span class="s2">500</span><span class="s1">:  {</span><span class="s4">'fd'</span><span class="s1">: </span><span class="s2">15</span><span class="s0">, </span><span class="s4">'scott'</span><span class="s1">: </span><span class="s2">16</span><span class="s0">, </span><span class="s4">'rice'</span><span class="s1">: </span><span class="s2">32</span><span class="s0">,</span>
                             <span class="s4">'sturges'</span><span class="s1">: </span><span class="s2">20</span><span class="s0">, </span><span class="s4">'auto'</span><span class="s1">: </span><span class="s2">20</span><span class="s0">, </span><span class="s4">'stone'</span><span class="s1">: </span><span class="s2">80</span><span class="s1">}</span><span class="s0">,</span>
                      <span class="s2">5000</span><span class="s1">: {</span><span class="s4">'fd'</span><span class="s1">: </span><span class="s2">33</span><span class="s0">, </span><span class="s4">'scott'</span><span class="s1">: </span><span class="s2">33</span><span class="s0">, </span><span class="s4">'rice'</span><span class="s1">: </span><span class="s2">69</span><span class="s0">,</span>
                             <span class="s4">'sturges'</span><span class="s1">: </span><span class="s2">27</span><span class="s0">, </span><span class="s4">'auto'</span><span class="s1">: </span><span class="s2">33</span><span class="s0">, </span><span class="s4">'stone'</span><span class="s1">: </span><span class="s2">80</span><span class="s1">}</span>
                     <span class="s1">}</span>

        <span class="s0">for </span><span class="s1">testlen</span><span class="s0">, </span><span class="s1">expectedResults </span><span class="s0">in </span><span class="s1">basic_test.items():</span>
            <span class="s3"># create some sort of non uniform data to test with</span>
            <span class="s3"># (3 peak uniform mixture)</span>
            <span class="s1">x1 = np.linspace(-</span><span class="s2">10</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">testlen // </span><span class="s2">5 </span><span class="s1">* </span><span class="s2">2</span><span class="s1">)</span>
            <span class="s1">x2 = np.linspace(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s1">testlen // </span><span class="s2">5 </span><span class="s1">* </span><span class="s2">3</span><span class="s1">)</span>
            <span class="s1">x3 = np.linspace(-</span><span class="s2">100</span><span class="s0">, </span><span class="s1">-</span><span class="s2">50</span><span class="s0">, </span><span class="s1">testlen)</span>
            <span class="s1">x = np.hstack((x1</span><span class="s0">, </span><span class="s1">x2</span><span class="s0">, </span><span class="s1">x3))</span>
            <span class="s0">for </span><span class="s1">estimator</span><span class="s0">, </span><span class="s1">numbins </span><span class="s0">in </span><span class="s1">expectedResults.items():</span>
                <span class="s1">a</span><span class="s0">, </span><span class="s1">b = np.histogram(x</span><span class="s0">, </span><span class="s1">estimator</span><span class="s0">, </span><span class="s1">range = (-</span><span class="s2">20</span><span class="s0">, </span><span class="s2">20</span><span class="s1">))</span>
                <span class="s1">msg = </span><span class="s4">&quot;For the {0} estimator&quot;</span><span class="s1">.format(estimator)</span>
                <span class="s1">msg += </span><span class="s4">&quot; with datasize of {0}&quot;</span><span class="s1">.format(testlen)</span>
                <span class="s1">assert_equal(len(a)</span><span class="s0">, </span><span class="s1">numbins</span><span class="s0">, </span><span class="s1">err_msg=msg)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;bins&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'auto'</span><span class="s0">, </span><span class="s4">'fd'</span><span class="s0">, </span><span class="s4">'doane'</span><span class="s0">, </span><span class="s4">'scott'</span><span class="s0">,</span>
                                      <span class="s4">'stone'</span><span class="s0">, </span><span class="s4">'rice'</span><span class="s0">, </span><span class="s4">'sturges'</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_signed_integer_data(self</span><span class="s0">, </span><span class="s1">bins):</span>
        <span class="s3"># Regression test for gh-14379.</span>
        <span class="s1">a = np.array([-</span><span class="s2">2</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">127</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.int8)</span>
        <span class="s1">hist</span><span class="s0">, </span><span class="s1">edges = np.histogram(a</span><span class="s0">, </span><span class="s1">bins=bins)</span>
        <span class="s1">hist32</span><span class="s0">, </span><span class="s1">edges32 = np.histogram(a.astype(np.int32)</span><span class="s0">, </span><span class="s1">bins=bins)</span>
        <span class="s1">assert_array_equal(hist</span><span class="s0">, </span><span class="s1">hist32)</span>
        <span class="s1">assert_array_equal(edges</span><span class="s0">, </span><span class="s1">edges32)</span>

    <span class="s0">def </span><span class="s1">test_simple_weighted(self):</span>
        <span class="s5">&quot;&quot;&quot; 
        Check that weighted data raises a TypeError 
        &quot;&quot;&quot;</span>
        <span class="s1">estimator_list = [</span><span class="s4">'fd'</span><span class="s0">, </span><span class="s4">'scott'</span><span class="s0">, </span><span class="s4">'rice'</span><span class="s0">, </span><span class="s4">'sturges'</span><span class="s0">, </span><span class="s4">'auto'</span><span class="s1">]</span>
        <span class="s0">for </span><span class="s1">estimator </span><span class="s0">in </span><span class="s1">estimator_list:</span>
            <span class="s1">assert_raises(TypeError</span><span class="s0">, </span><span class="s1">histogram</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">,</span>
                          <span class="s1">estimator</span><span class="s0">, </span><span class="s1">weights=[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span>


<span class="s0">class </span><span class="s1">TestHistogramdd:</span>

    <span class="s0">def </span><span class="s1">test_simple(self):</span>
        <span class="s1">x = np.array([[-</span><span class="s2">.5</span><span class="s0">, </span><span class="s2">.5</span><span class="s0">, </span><span class="s2">1.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s2">.5</span><span class="s0">, </span><span class="s2">1.5</span><span class="s0">, </span><span class="s2">2.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s2">.5</span><span class="s0">, </span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">.5</span><span class="s1">]</span><span class="s0">,</span>
                      <span class="s1">[</span><span class="s2">.5</span><span class="s0">,  </span><span class="s2">.5</span><span class="s0">, </span><span class="s2">1.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">.5</span><span class="s0">,  </span><span class="s2">1.5</span><span class="s0">, </span><span class="s2">2.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">.5</span><span class="s0">,  </span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">2.5</span><span class="s1">]])</span>
        <span class="s1">H</span><span class="s0">, </span><span class="s1">edges = histogramdd(x</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">,</span>
                               <span class="s1">range=[[-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]])</span>
        <span class="s1">answer = np.array([[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]</span><span class="s0">,</span>
                           <span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]])</span>
        <span class="s1">assert_array_equal(H</span><span class="s0">, </span><span class="s1">answer)</span>

        <span class="s3"># Check normalization</span>
        <span class="s1">ed = [[-</span><span class="s2">2</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]]</span>
        <span class="s1">H</span><span class="s0">, </span><span class="s1">edges = histogramdd(x</span><span class="s0">, </span><span class="s1">bins=ed</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_(np.all(H == answer / </span><span class="s2">12.</span><span class="s1">))</span>

        <span class="s3"># Check that H has the correct shape.</span>
        <span class="s1">H</span><span class="s0">, </span><span class="s1">edges = histogramdd(x</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">,</span>
                               <span class="s1">range=[[-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]]</span><span class="s0">,</span>
                               <span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">answer = np.array([[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]</span><span class="s0">,</span>
                           <span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]])</span>
        <span class="s1">assert_array_almost_equal(H</span><span class="s0">, </span><span class="s1">answer / </span><span class="s2">6.</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span>
        <span class="s3"># Check that a sequence of arrays is accepted and H has the correct</span>
        <span class="s3"># shape.</span>
        <span class="s1">z = [np.squeeze(y) </span><span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">np.split(x</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s1">axis=</span><span class="s2">1</span><span class="s1">)]</span>
        <span class="s1">H</span><span class="s0">, </span><span class="s1">edges = histogramdd(</span>
            <span class="s1">z</span><span class="s0">, </span><span class="s1">bins=(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">range=[[-</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">answer = np.array([[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]</span><span class="s0">,</span>
                           <span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]</span><span class="s0">,</span>
                           <span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]</span><span class="s0">,</span>
                           <span class="s1">[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]])</span>
        <span class="s1">assert_array_equal(H</span><span class="s0">, </span><span class="s1">answer)</span>

        <span class="s1">Z = np.zeros((</span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s1">))</span>
        <span class="s1">Z[list(range(</span><span class="s2">5</span><span class="s1">))</span><span class="s0">, </span><span class="s1">list(range(</span><span class="s2">5</span><span class="s1">))</span><span class="s0">, </span><span class="s1">list(range(</span><span class="s2">5</span><span class="s1">))] = </span><span class="s2">1.</span>
        <span class="s1">H</span><span class="s0">, </span><span class="s1">edges = histogramdd([np.arange(</span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s2">5</span><span class="s1">)]</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(H</span><span class="s0">, </span><span class="s1">Z)</span>

    <span class="s0">def </span><span class="s1">test_shape_3d(self):</span>
        <span class="s3"># All possible permutations for bins of different lengths in 3D.</span>
        <span class="s1">bins = ((</span><span class="s2">5</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
        <span class="s1">r = np.random.rand(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">b </span><span class="s0">in </span><span class="s1">bins:</span>
            <span class="s1">H</span><span class="s0">, </span><span class="s1">edges = histogramdd(r</span><span class="s0">, </span><span class="s1">b)</span>
            <span class="s1">assert_(H.shape == b)</span>

    <span class="s0">def </span><span class="s1">test_shape_4d(self):</span>
        <span class="s3"># All possible permutations for bins of different lengths in 4D.</span>
        <span class="s1">bins = ((</span><span class="s2">7</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">7</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">(</span><span class="s2">5</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">7</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">6</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">(</span><span class="s2">7</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">7</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">5</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">5</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">7</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">(</span><span class="s2">5</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">7</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">7</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">4</span><span class="s1">))</span>

        <span class="s1">r = np.random.rand(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">b </span><span class="s0">in </span><span class="s1">bins:</span>
            <span class="s1">H</span><span class="s0">, </span><span class="s1">edges = histogramdd(r</span><span class="s0">, </span><span class="s1">b)</span>
            <span class="s1">assert_(H.shape == b)</span>

    <span class="s0">def </span><span class="s1">test_weights(self):</span>
        <span class="s1">v = np.random.rand(</span><span class="s2">100</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">hist</span><span class="s0">, </span><span class="s1">edges = histogramdd(v)</span>
        <span class="s1">n_hist</span><span class="s0">, </span><span class="s1">edges = histogramdd(v</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">w_hist</span><span class="s0">, </span><span class="s1">edges = histogramdd(v</span><span class="s0">, </span><span class="s1">weights=np.ones(</span><span class="s2">100</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(w_hist</span><span class="s0">, </span><span class="s1">hist)</span>
        <span class="s1">w_hist</span><span class="s0">, </span><span class="s1">edges = histogramdd(v</span><span class="s0">, </span><span class="s1">weights=np.ones(</span><span class="s2">100</span><span class="s1">) * </span><span class="s2">2</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(w_hist</span><span class="s0">, </span><span class="s1">n_hist)</span>
        <span class="s1">w_hist</span><span class="s0">, </span><span class="s1">edges = histogramdd(v</span><span class="s0">, </span><span class="s1">weights=np.ones(</span><span class="s2">100</span><span class="s0">, </span><span class="s1">int) * </span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(w_hist</span><span class="s0">, </span><span class="s2">2 </span><span class="s1">* hist)</span>

    <span class="s0">def </span><span class="s1">test_identical_samples(self):</span>
        <span class="s1">x = np.zeros((</span><span class="s2">10</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">int)</span>
        <span class="s1">hist</span><span class="s0">, </span><span class="s1">edges = histogramdd(x</span><span class="s0">, </span><span class="s1">bins=</span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(edges[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">np.array([-</span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">0.</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">]))</span>

    <span class="s0">def </span><span class="s1">test_empty(self):</span>
        <span class="s1">a</span><span class="s0">, </span><span class="s1">b = histogramdd([[]</span><span class="s0">, </span><span class="s1">[]]</span><span class="s0">, </span><span class="s1">bins=([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]))</span>
        <span class="s1">assert_array_max_ulp(a</span><span class="s0">, </span><span class="s1">np.array([[</span><span class="s2">0.</span><span class="s1">]]))</span>
        <span class="s1">a</span><span class="s0">, </span><span class="s1">b = np.histogramdd([[]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">[]]</span><span class="s0">, </span><span class="s1">bins=</span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">assert_array_max_ulp(a</span><span class="s0">, </span><span class="s1">np.zeros((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)))</span>

    <span class="s0">def </span><span class="s1">test_bins_errors(self):</span>
        <span class="s3"># There are two ways to specify bins. Check for the right errors</span>
        <span class="s3"># when mixing those.</span>
        <span class="s1">x = np.arange(</span><span class="s2">8</span><span class="s1">).reshape(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">np.histogramdd</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">bins=[-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s1">])</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">np.histogramdd</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">bins=[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0.99</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>
        <span class="s1">assert_raises(</span>
            <span class="s1">ValueError</span><span class="s0">, </span><span class="s1">np.histogramdd</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">bins=[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s1">-</span><span class="s2">3</span><span class="s1">]])</span>
        <span class="s1">assert_(np.histogramdd(x</span><span class="s0">, </span><span class="s1">bins=[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]]))</span>

    <span class="s0">def </span><span class="s1">test_inf_edges(self):</span>
        <span class="s3"># Test using +/-inf bin edges works. See #1788.</span>
        <span class="s0">with </span><span class="s1">np.errstate(invalid=</span><span class="s4">'ignore'</span><span class="s1">):</span>
            <span class="s1">x = np.arange(</span><span class="s2">6</span><span class="s1">).reshape(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
            <span class="s1">expected = np.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]])</span>
            <span class="s1">h</span><span class="s0">, </span><span class="s1">e = np.histogramdd(x</span><span class="s0">, </span><span class="s1">bins=[</span><span class="s2">3</span><span class="s0">, </span><span class="s1">[-np.inf</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">10</span><span class="s1">]])</span>
            <span class="s1">assert_allclose(h</span><span class="s0">, </span><span class="s1">expected)</span>
            <span class="s1">h</span><span class="s0">, </span><span class="s1">e = np.histogramdd(x</span><span class="s0">, </span><span class="s1">bins=[</span><span class="s2">3</span><span class="s0">, </span><span class="s1">np.array([-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">np.inf])])</span>
            <span class="s1">assert_allclose(h</span><span class="s0">, </span><span class="s1">expected)</span>
            <span class="s1">h</span><span class="s0">, </span><span class="s1">e = np.histogramdd(x</span><span class="s0">, </span><span class="s1">bins=[</span><span class="s2">3</span><span class="s0">, </span><span class="s1">[-np.inf</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s1">np.inf]])</span>
            <span class="s1">assert_allclose(h</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_rightmost_binedge(self):</span>
        <span class="s3"># Test event very close to rightmost binedge. See Github issue #4266</span>
        <span class="s1">x = [</span><span class="s2">0.9999999995</span><span class="s1">]</span>
        <span class="s1">bins = [[</span><span class="s2">0.</span><span class="s0">, </span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">1.0</span><span class="s1">]]</span>
        <span class="s1">hist</span><span class="s0">, </span><span class="s1">_ = histogramdd(x</span><span class="s0">, </span><span class="s1">bins=bins)</span>
        <span class="s1">assert_(hist[</span><span class="s2">0</span><span class="s1">] == </span><span class="s2">0.0</span><span class="s1">)</span>
        <span class="s1">assert_(hist[</span><span class="s2">1</span><span class="s1">] == </span><span class="s2">1.</span><span class="s1">)</span>
        <span class="s1">x = [</span><span class="s2">1.0</span><span class="s1">]</span>
        <span class="s1">bins = [[</span><span class="s2">0.</span><span class="s0">, </span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">1.0</span><span class="s1">]]</span>
        <span class="s1">hist</span><span class="s0">, </span><span class="s1">_ = histogramdd(x</span><span class="s0">, </span><span class="s1">bins=bins)</span>
        <span class="s1">assert_(hist[</span><span class="s2">0</span><span class="s1">] == </span><span class="s2">0.0</span><span class="s1">)</span>
        <span class="s1">assert_(hist[</span><span class="s2">1</span><span class="s1">] == </span><span class="s2">1.</span><span class="s1">)</span>
        <span class="s1">x = [</span><span class="s2">1.0000000001</span><span class="s1">]</span>
        <span class="s1">bins = [[</span><span class="s2">0.</span><span class="s0">, </span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">1.0</span><span class="s1">]]</span>
        <span class="s1">hist</span><span class="s0">, </span><span class="s1">_ = histogramdd(x</span><span class="s0">, </span><span class="s1">bins=bins)</span>
        <span class="s1">assert_(hist[</span><span class="s2">0</span><span class="s1">] == </span><span class="s2">0.0</span><span class="s1">)</span>
        <span class="s1">assert_(hist[</span><span class="s2">1</span><span class="s1">] == </span><span class="s2">0.0</span><span class="s1">)</span>
        <span class="s1">x = [</span><span class="s2">1.0001</span><span class="s1">]</span>
        <span class="s1">bins = [[</span><span class="s2">0.</span><span class="s0">, </span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">1.0</span><span class="s1">]]</span>
        <span class="s1">hist</span><span class="s0">, </span><span class="s1">_ = histogramdd(x</span><span class="s0">, </span><span class="s1">bins=bins)</span>
        <span class="s1">assert_(hist[</span><span class="s2">0</span><span class="s1">] == </span><span class="s2">0.0</span><span class="s1">)</span>
        <span class="s1">assert_(hist[</span><span class="s2">1</span><span class="s1">] == </span><span class="s2">0.0</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_finite_range(self):</span>
        <span class="s1">vals = np.random.random((</span><span class="s2">100</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>
        <span class="s1">histogramdd(vals</span><span class="s0">, </span><span class="s1">range=[[</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">1.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0.25</span><span class="s0">, </span><span class="s2">0.75</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0.25</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">]])</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">histogramdd</span><span class="s0">, </span><span class="s1">vals</span><span class="s0">,</span>
                      <span class="s1">range=[[</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">1.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0.25</span><span class="s0">, </span><span class="s2">0.75</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0.25</span><span class="s0">, </span><span class="s1">np.inf]])</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">histogramdd</span><span class="s0">, </span><span class="s1">vals</span><span class="s0">,</span>
                      <span class="s1">range=[[</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">1.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[np.nan</span><span class="s0">, </span><span class="s2">0.75</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0.25</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">]])</span>

    <span class="s0">def </span><span class="s1">test_equal_edges(self):</span>
        <span class="s5">&quot;&quot;&quot; Test that adjacent entries in an edge array can be equal &quot;&quot;&quot;</span>
        <span class="s1">x = np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">y = np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">x_edges = np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">y_edges = </span><span class="s2">1</span>
        <span class="s1">hist</span><span class="s0">, </span><span class="s1">edges = histogramdd((x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">bins=(x_edges</span><span class="s0">, </span><span class="s1">y_edges))</span>

        <span class="s1">hist_expected = np.array([</span>
            <span class="s1">[</span><span class="s2">2.</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s2">1.</span><span class="s1">]</span><span class="s0">,  </span><span class="s3"># x == 2 falls in the final bin</span>
        <span class="s1">])</span>
        <span class="s1">assert_equal(hist</span><span class="s0">, </span><span class="s1">hist_expected)</span>

    <span class="s0">def </span><span class="s1">test_edge_dtype(self):</span>
        <span class="s5">&quot;&quot;&quot; Test that if an edge array is input, its type is preserved &quot;&quot;&quot;</span>
        <span class="s1">x = np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">20</span><span class="s1">])</span>
        <span class="s1">y = x / </span><span class="s2">10</span>
        <span class="s1">x_edges = np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">15</span><span class="s0">, </span><span class="s2">20</span><span class="s1">])</span>
        <span class="s1">y_edges = x_edges / </span><span class="s2">10</span>
        <span class="s1">hist</span><span class="s0">, </span><span class="s1">edges = histogramdd((x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">bins=(x_edges</span><span class="s0">, </span><span class="s1">y_edges))</span>

        <span class="s1">assert_equal(edges[</span><span class="s2">0</span><span class="s1">].dtype</span><span class="s0">, </span><span class="s1">x_edges.dtype)</span>
        <span class="s1">assert_equal(edges[</span><span class="s2">1</span><span class="s1">].dtype</span><span class="s0">, </span><span class="s1">y_edges.dtype)</span>

    <span class="s0">def </span><span class="s1">test_large_integers(self):</span>
        <span class="s1">big = </span><span class="s2">2</span><span class="s1">**</span><span class="s2">60  </span><span class="s3"># Too large to represent with a full precision float</span>

        <span class="s1">x = np.array([</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">np.int64)</span>
        <span class="s1">x_edges = np.array([-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">+</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">np.int64)</span>
        <span class="s1">y = big + x</span>
        <span class="s1">y_edges = big + x_edges</span>

        <span class="s1">hist</span><span class="s0">, </span><span class="s1">edges = histogramdd((x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">bins=(x_edges</span><span class="s0">, </span><span class="s1">y_edges))</span>

        <span class="s1">assert_equal(hist[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_density_non_uniform_2d(self):</span>
        <span class="s3"># Defines the following grid:</span>
        <span class="s3">#</span>
        <span class="s3">#    0 2     8</span>
        <span class="s3">#   0+-+-----+</span>
        <span class="s3">#    + |     +</span>
        <span class="s3">#    + |     +</span>
        <span class="s3">#   6+-+-----+</span>
        <span class="s3">#   8+-+-----+</span>
        <span class="s1">x_edges = np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">8</span><span class="s1">])</span>
        <span class="s1">y_edges = np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">])</span>
        <span class="s1">relative_areas = np.array([</span>
            <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">9</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]])</span>

        <span class="s3"># ensure the number of points in each region is proportional to its area</span>
        <span class="s1">x = np.array([</span><span class="s2">1</span><span class="s1">] + [</span><span class="s2">1</span><span class="s1">]*</span><span class="s2">3 </span><span class="s1">+ [</span><span class="s2">7</span><span class="s1">]*</span><span class="s2">3 </span><span class="s1">+ [</span><span class="s2">7</span><span class="s1">]*</span><span class="s2">9</span><span class="s1">)</span>
        <span class="s1">y = np.array([</span><span class="s2">7</span><span class="s1">] + [</span><span class="s2">1</span><span class="s1">]*</span><span class="s2">3 </span><span class="s1">+ [</span><span class="s2">7</span><span class="s1">]*</span><span class="s2">3 </span><span class="s1">+ [</span><span class="s2">1</span><span class="s1">]*</span><span class="s2">9</span><span class="s1">)</span>

        <span class="s3"># sanity check that the above worked as intended</span>
        <span class="s1">hist</span><span class="s0">, </span><span class="s1">edges = histogramdd((y</span><span class="s0">, </span><span class="s1">x)</span><span class="s0">, </span><span class="s1">bins=(y_edges</span><span class="s0">, </span><span class="s1">x_edges))</span>
        <span class="s1">assert_equal(hist</span><span class="s0">, </span><span class="s1">relative_areas)</span>

        <span class="s3"># resulting histogram should be uniform, since counts and areas are proportional</span>
        <span class="s1">hist</span><span class="s0">, </span><span class="s1">edges = histogramdd((y</span><span class="s0">, </span><span class="s1">x)</span><span class="s0">, </span><span class="s1">bins=(y_edges</span><span class="s0">, </span><span class="s1">x_edges)</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(hist</span><span class="s0">, </span><span class="s2">1 </span><span class="s1">/ (</span><span class="s2">8</span><span class="s1">*</span><span class="s2">8</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_density_non_uniform_1d(self):</span>
        <span class="s3"># compare to histogram to show the results are the same</span>
        <span class="s1">v = np.arange(</span><span class="s2">10</span><span class="s1">)</span>
        <span class="s1">bins = np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">10</span><span class="s1">])</span>
        <span class="s1">hist</span><span class="s0">, </span><span class="s1">edges = histogram(v</span><span class="s0">, </span><span class="s1">bins</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">hist_dd</span><span class="s0">, </span><span class="s1">edges_dd = histogramdd((v</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(bins</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(hist</span><span class="s0">, </span><span class="s1">hist_dd)</span>
        <span class="s1">assert_equal(edges</span><span class="s0">, </span><span class="s1">edges_dd[</span><span class="s2">0</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_density_via_normed(self):</span>
        <span class="s3"># normed should simply alias to density argument</span>
        <span class="s1">v = np.arange(</span><span class="s2">10</span><span class="s1">)</span>
        <span class="s1">bins = np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">10</span><span class="s1">])</span>
        <span class="s1">hist</span><span class="s0">, </span><span class="s1">edges = histogram(v</span><span class="s0">, </span><span class="s1">bins</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">hist_dd</span><span class="s0">, </span><span class="s1">edges_dd = histogramdd((v</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(bins</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">normed=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">assert_equal(hist</span><span class="s0">, </span><span class="s1">hist_dd)</span>
        <span class="s1">assert_equal(edges</span><span class="s0">, </span><span class="s1">edges_dd[</span><span class="s2">0</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_density_normed_redundancy(self):</span>
        <span class="s1">v = np.arange(</span><span class="s2">10</span><span class="s1">)</span>
        <span class="s1">bins = np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">10</span><span class="s1">])</span>
        <span class="s0">with </span><span class="s1">assert_raises_regex(TypeError</span><span class="s0">, </span><span class="s4">&quot;Cannot specify both&quot;</span><span class="s1">):</span>
            <span class="s1">hist_dd</span><span class="s0">, </span><span class="s1">edges_dd = histogramdd((v</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(bins</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
                                            <span class="s1">density=</span><span class="s0">True,</span>
                                            <span class="s1">normed=</span><span class="s0">True</span><span class="s1">)</span>
</pre>
</body>
</html>