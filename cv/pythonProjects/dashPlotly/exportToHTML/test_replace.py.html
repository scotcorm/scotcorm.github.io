<html>
<head>
<title>test_replace.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_replace.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">re</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">import </span><span class="s1">pandas._testing </span><span class="s0">as </span><span class="s1">tm</span>
<span class="s0">from </span><span class="s1">pandas.core.arrays </span><span class="s0">import </span><span class="s1">IntervalArray</span>


<span class="s0">class </span><span class="s1">TestSeriesReplace:</span>
    <span class="s0">def </span><span class="s1">test_replace_explicit_none(self):</span>
        <span class="s2"># GH#36984 if the user explicitly passes value=None, give it to them</span>
        <span class="s1">ser = pd.Series([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s4">&quot;&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=object)</span>
        <span class="s1">result = ser.replace(</span><span class="s4">&quot;&quot;</span><span class="s0">, None</span><span class="s1">)</span>
        <span class="s1">expected = pd.Series([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, None</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=object)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">df = pd.DataFrame(np.zeros((</span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)))</span>
        <span class="s1">df.iloc[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">] = </span><span class="s4">&quot;&quot;</span>
        <span class="s1">result = df.replace(</span><span class="s4">&quot;&quot;</span><span class="s0">, None</span><span class="s1">)</span>
        <span class="s1">expected = pd.DataFrame(</span>
            <span class="s1">{</span>
                <span class="s3">0</span><span class="s1">: np.zeros(</span><span class="s3">3</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s3">1</span><span class="s1">: np.zeros(</span><span class="s3">3</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s3">2</span><span class="s1">: np.array([</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, None</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=object)</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">expected.iloc[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">] </span><span class="s0">is None</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># GH#19998 same thing with object dtype</span>
        <span class="s1">ser = pd.Series([</span><span class="s3">10</span><span class="s0">, </span><span class="s3">20</span><span class="s0">, </span><span class="s3">30</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s1">])</span>
        <span class="s1">result = ser.replace(</span><span class="s4">&quot;a&quot;</span><span class="s0">, None</span><span class="s1">)</span>
        <span class="s1">expected = pd.Series([</span><span class="s3">10</span><span class="s0">, </span><span class="s3">20</span><span class="s0">, </span><span class="s3">30</span><span class="s0">, None, None, </span><span class="s4">&quot;b&quot;</span><span class="s0">, None</span><span class="s1">])</span>
        <span class="s0">assert </span><span class="s1">expected.iloc[-</span><span class="s3">1</span><span class="s1">] </span><span class="s0">is None</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_replace_noop_doesnt_downcast(self):</span>
        <span class="s2"># GH#44498</span>
        <span class="s1">ser = pd.Series([</span><span class="s0">None, None, </span><span class="s1">pd.Timestamp(</span><span class="s4">&quot;2021-12-16 17:31&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">dtype=object)</span>
        <span class="s1">res = ser.replace({np.nan: </span><span class="s0">None</span><span class="s1">})  </span><span class="s2"># should be a no-op</span>
        <span class="s1">tm.assert_series_equal(res</span><span class="s0">, </span><span class="s1">ser)</span>
        <span class="s0">assert </span><span class="s1">res.dtype == object</span>

        <span class="s2"># same thing but different calling convention</span>
        <span class="s1">res = ser.replace(np.nan</span><span class="s0">, None</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(res</span><span class="s0">, </span><span class="s1">ser)</span>
        <span class="s0">assert </span><span class="s1">res.dtype == object</span>

    <span class="s0">def </span><span class="s1">test_replace(self):</span>
        <span class="s1">N = </span><span class="s3">100</span>
        <span class="s1">ser = pd.Series(np.random.randn(N))</span>
        <span class="s1">ser[</span><span class="s3">0</span><span class="s1">:</span><span class="s3">4</span><span class="s1">] = np.nan</span>
        <span class="s1">ser[</span><span class="s3">6</span><span class="s1">:</span><span class="s3">10</span><span class="s1">] = </span><span class="s3">0</span>

        <span class="s2"># replace list with a single value</span>
        <span class="s1">return_value = ser.replace([np.nan]</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">inplace=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">return_value </span><span class="s0">is None</span>

        <span class="s1">exp = ser.fillna(-</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(ser</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s1">rs = ser.replace(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">np.nan)</span>
        <span class="s1">ser[ser == </span><span class="s3">0.0</span><span class="s1">] = np.nan</span>
        <span class="s1">tm.assert_series_equal(rs</span><span class="s0">, </span><span class="s1">ser)</span>

        <span class="s1">ser = pd.Series(np.fabs(np.random.randn(N))</span><span class="s0">, </span><span class="s1">tm.makeDateIndex(N)</span><span class="s0">, </span><span class="s1">dtype=object)</span>
        <span class="s1">ser[:</span><span class="s3">5</span><span class="s1">] = np.nan</span>
        <span class="s1">ser[</span><span class="s3">6</span><span class="s1">:</span><span class="s3">10</span><span class="s1">] = </span><span class="s4">&quot;foo&quot;</span>
        <span class="s1">ser[</span><span class="s3">20</span><span class="s1">:</span><span class="s3">30</span><span class="s1">] = </span><span class="s4">&quot;bar&quot;</span>

        <span class="s2"># replace list with a single value</span>
        <span class="s1">rs = ser.replace([np.nan</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;bar&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)</span>

        <span class="s0">assert </span><span class="s1">(rs[:</span><span class="s3">5</span><span class="s1">] == -</span><span class="s3">1</span><span class="s1">).all()</span>
        <span class="s0">assert </span><span class="s1">(rs[</span><span class="s3">6</span><span class="s1">:</span><span class="s3">10</span><span class="s1">] == -</span><span class="s3">1</span><span class="s1">).all()</span>
        <span class="s0">assert </span><span class="s1">(rs[</span><span class="s3">20</span><span class="s1">:</span><span class="s3">30</span><span class="s1">] == -</span><span class="s3">1</span><span class="s1">).all()</span>
        <span class="s0">assert </span><span class="s1">(pd.isna(ser[:</span><span class="s3">5</span><span class="s1">])).all()</span>

        <span class="s2"># replace with different values</span>
        <span class="s1">rs = ser.replace({np.nan: -</span><span class="s3">1</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s1">: -</span><span class="s3">2</span><span class="s0">, </span><span class="s4">&quot;bar&quot;</span><span class="s1">: -</span><span class="s3">3</span><span class="s1">})</span>

        <span class="s0">assert </span><span class="s1">(rs[:</span><span class="s3">5</span><span class="s1">] == -</span><span class="s3">1</span><span class="s1">).all()</span>
        <span class="s0">assert </span><span class="s1">(rs[</span><span class="s3">6</span><span class="s1">:</span><span class="s3">10</span><span class="s1">] == -</span><span class="s3">2</span><span class="s1">).all()</span>
        <span class="s0">assert </span><span class="s1">(rs[</span><span class="s3">20</span><span class="s1">:</span><span class="s3">30</span><span class="s1">] == -</span><span class="s3">3</span><span class="s1">).all()</span>
        <span class="s0">assert </span><span class="s1">(pd.isna(ser[:</span><span class="s3">5</span><span class="s1">])).all()</span>

        <span class="s2"># replace with different values with 2 lists</span>
        <span class="s1">rs2 = ser.replace([np.nan</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;bar&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">2</span><span class="s0">, </span><span class="s1">-</span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(rs</span><span class="s0">, </span><span class="s1">rs2)</span>

        <span class="s2"># replace inplace</span>
        <span class="s1">return_value = ser.replace([np.nan</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;bar&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">inplace=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">return_value </span><span class="s0">is None</span>

        <span class="s0">assert </span><span class="s1">(ser[:</span><span class="s3">5</span><span class="s1">] == -</span><span class="s3">1</span><span class="s1">).all()</span>
        <span class="s0">assert </span><span class="s1">(ser[</span><span class="s3">6</span><span class="s1">:</span><span class="s3">10</span><span class="s1">] == -</span><span class="s3">1</span><span class="s1">).all()</span>
        <span class="s0">assert </span><span class="s1">(ser[</span><span class="s3">20</span><span class="s1">:</span><span class="s3">30</span><span class="s1">] == -</span><span class="s3">1</span><span class="s1">).all()</span>

    <span class="s0">def </span><span class="s1">test_replace_nan_with_inf(self):</span>
        <span class="s1">ser = pd.Series([np.nan</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s1">np.inf])</span>
        <span class="s1">tm.assert_series_equal(ser.replace(np.nan</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ser.fillna(</span><span class="s3">0</span><span class="s1">))</span>

        <span class="s1">ser = pd.Series([np.nan</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;bar&quot;</span><span class="s0">, </span><span class="s1">np.inf</span><span class="s0">, None, </span><span class="s1">pd.NaT])</span>
        <span class="s1">tm.assert_series_equal(ser.replace(np.nan</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ser.fillna(</span><span class="s3">0</span><span class="s1">))</span>
        <span class="s1">filled = ser.copy()</span>
        <span class="s1">filled[</span><span class="s3">4</span><span class="s1">] = </span><span class="s3">0</span>
        <span class="s1">tm.assert_series_equal(ser.replace(np.inf</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">filled)</span>

    <span class="s0">def </span><span class="s1">test_replace_listlike_value_listlike_target(self</span><span class="s0">, </span><span class="s1">datetime_series):</span>
        <span class="s1">ser = pd.Series(datetime_series.index)</span>
        <span class="s1">tm.assert_series_equal(ser.replace(np.nan</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ser.fillna(</span><span class="s3">0</span><span class="s1">))</span>

        <span class="s2"># malformed</span>
        <span class="s1">msg = </span><span class="s4">r&quot;Replacement lists must match in length\. Expecting 3 got 2&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">ser.replace([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[np.nan</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>

        <span class="s2"># ser is dt64 so can't hold 1 or 2, so this replace is a no-op</span>
        <span class="s1">result = ser.replace([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[np.nan</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">ser)</span>

        <span class="s1">ser = pd.Series([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">])</span>
        <span class="s1">result = ser.replace([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">pd.Series([</span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]))</span>

    <span class="s0">def </span><span class="s1">test_replace_gh5319(self):</span>
        <span class="s2"># API change from 0.12?</span>
        <span class="s2"># GH 5319</span>
        <span class="s1">ser = pd.Series([</span><span class="s3">0</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">])</span>
        <span class="s1">expected = ser.ffill()</span>
        <span class="s1">result = ser.replace([np.nan])</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">ser = pd.Series([</span><span class="s3">0</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">])</span>
        <span class="s1">expected = ser.ffill()</span>
        <span class="s1">result = ser.replace(np.nan)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_replace_datetime64(self):</span>
        <span class="s2"># GH 5797</span>
        <span class="s1">ser = pd.Series(pd.date_range(</span><span class="s4">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">5</span><span class="s1">))</span>
        <span class="s1">expected = ser.copy()</span>
        <span class="s1">expected.loc[</span><span class="s3">2</span><span class="s1">] = pd.Timestamp(</span><span class="s4">&quot;20120101&quot;</span><span class="s1">)</span>
        <span class="s1">result = ser.replace({pd.Timestamp(</span><span class="s4">&quot;20130103&quot;</span><span class="s1">): pd.Timestamp(</span><span class="s4">&quot;20120101&quot;</span><span class="s1">)})</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
        <span class="s1">result = ser.replace(pd.Timestamp(</span><span class="s4">&quot;20130103&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">pd.Timestamp(</span><span class="s4">&quot;20120101&quot;</span><span class="s1">))</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_replace_nat_with_tz(self):</span>
        <span class="s2"># GH 11792: Test with replacing NaT in a list with tz data</span>
        <span class="s1">ts = pd.Timestamp(</span><span class="s4">&quot;2015/01/01&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s4">&quot;UTC&quot;</span><span class="s1">)</span>
        <span class="s1">s = pd.Series([pd.NaT</span><span class="s0">, </span><span class="s1">pd.Timestamp(</span><span class="s4">&quot;2015/01/01&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s4">&quot;UTC&quot;</span><span class="s1">)])</span>
        <span class="s1">result = s.replace([np.nan</span><span class="s0">, </span><span class="s1">pd.NaT]</span><span class="s0">, </span><span class="s1">pd.Timestamp.min)</span>
        <span class="s1">expected = pd.Series([pd.Timestamp.min</span><span class="s0">, </span><span class="s1">ts]</span><span class="s0">, </span><span class="s1">dtype=object)</span>
        <span class="s1">tm.assert_series_equal(expected</span><span class="s0">, </span><span class="s1">result)</span>

    <span class="s0">def </span><span class="s1">test_replace_timedelta_td64(self):</span>
        <span class="s1">tdi = pd.timedelta_range(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">5</span><span class="s1">)</span>
        <span class="s1">ser = pd.Series(tdi)</span>

        <span class="s2"># Using a single dict argument means we go through replace_list</span>
        <span class="s1">result = ser.replace({ser[</span><span class="s3">1</span><span class="s1">]: ser[</span><span class="s3">3</span><span class="s1">]})</span>

        <span class="s1">expected = pd.Series([ser[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ser[</span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ser[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ser[</span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ser[</span><span class="s3">4</span><span class="s1">]])</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_replace_with_single_list(self):</span>
        <span class="s1">ser = pd.Series([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">])</span>
        <span class="s1">result = ser.replace([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">pd.Series([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]))</span>

        <span class="s1">s = ser.copy()</span>
        <span class="s1">return_value = s.replace([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">inplace=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">return_value </span><span class="s0">is None</span>
        <span class="s1">tm.assert_series_equal(s</span><span class="s0">, </span><span class="s1">pd.Series([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]))</span>

        <span class="s2"># make sure things don't get corrupted when fillna call fails</span>
        <span class="s1">s = ser.copy()</span>
        <span class="s1">msg = (</span>
            <span class="s4">r&quot;Invalid fill method\. Expecting pad \(ffill\) or backfill &quot;</span>
            <span class="s4">r&quot;\(bfill\)\. Got crash_cymbal&quot;</span>
        <span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">return_value = s.replace([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">inplace=</span><span class="s0">True, </span><span class="s1">method=</span><span class="s4">&quot;crash_cymbal&quot;</span><span class="s1">)</span>
            <span class="s0">assert </span><span class="s1">return_value </span><span class="s0">is None</span>
        <span class="s1">tm.assert_series_equal(s</span><span class="s0">, </span><span class="s1">ser)</span>

    <span class="s0">def </span><span class="s1">test_replace_mixed_types(self):</span>
        <span class="s1">ser = pd.Series(np.arange(</span><span class="s3">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">&quot;int64&quot;</span><span class="s1">)</span>

        <span class="s0">def </span><span class="s1">check_replace(to_rep</span><span class="s0">, </span><span class="s1">val</span><span class="s0">, </span><span class="s1">expected):</span>
            <span class="s1">sc = ser.copy()</span>
            <span class="s1">result = ser.replace(to_rep</span><span class="s0">, </span><span class="s1">val)</span>
            <span class="s1">return_value = sc.replace(to_rep</span><span class="s0">, </span><span class="s1">val</span><span class="s0">, </span><span class="s1">inplace=</span><span class="s0">True</span><span class="s1">)</span>
            <span class="s0">assert </span><span class="s1">return_value </span><span class="s0">is None</span>
            <span class="s1">tm.assert_series_equal(expected</span><span class="s0">, </span><span class="s1">result)</span>
            <span class="s1">tm.assert_series_equal(expected</span><span class="s0">, </span><span class="s1">sc)</span>

        <span class="s2"># 3.0 can still be held in our int64 series, so we do not upcast GH#44940</span>
        <span class="s1">tr</span><span class="s0">, </span><span class="s1">v = [</span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">3.0</span><span class="s1">]</span>
        <span class="s1">check_replace(tr</span><span class="s0">, </span><span class="s1">v</span><span class="s0">, </span><span class="s1">ser)</span>
        <span class="s2"># Note this matches what we get with the scalars 3 and 3.0</span>
        <span class="s1">check_replace(tr[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">v[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ser)</span>

        <span class="s2"># MUST upcast to float</span>
        <span class="s1">e = pd.Series([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3.5</span><span class="s0">, </span><span class="s3">4</span><span class="s1">])</span>
        <span class="s1">tr</span><span class="s0">, </span><span class="s1">v = [</span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">3.5</span><span class="s1">]</span>
        <span class="s1">check_replace(tr</span><span class="s0">, </span><span class="s1">v</span><span class="s0">, </span><span class="s1">e)</span>

        <span class="s2"># casts to object</span>
        <span class="s1">e = pd.Series([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3.5</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s1">])</span>
        <span class="s1">tr</span><span class="s0">, </span><span class="s1">v = [</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">3.5</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s1">]</span>
        <span class="s1">check_replace(tr</span><span class="s0">, </span><span class="s1">v</span><span class="s0">, </span><span class="s1">e)</span>

        <span class="s2"># again casts to object</span>
        <span class="s1">e = pd.Series([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3.5</span><span class="s0">, </span><span class="s1">pd.Timestamp(</span><span class="s4">&quot;20130101&quot;</span><span class="s1">)])</span>
        <span class="s1">tr</span><span class="s0">, </span><span class="s1">v = [</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">3.5</span><span class="s0">, </span><span class="s1">pd.Timestamp(</span><span class="s4">&quot;20130101&quot;</span><span class="s1">)]</span>
        <span class="s1">check_replace(tr</span><span class="s0">, </span><span class="s1">v</span><span class="s0">, </span><span class="s1">e)</span>

        <span class="s2"># casts to object</span>
        <span class="s1">e = pd.Series([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3.5</span><span class="s0">, True</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">&quot;object&quot;</span><span class="s1">)</span>
        <span class="s1">tr</span><span class="s0">, </span><span class="s1">v = [</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">3.5</span><span class="s0">, True</span><span class="s1">]</span>
        <span class="s1">check_replace(tr</span><span class="s0">, </span><span class="s1">v</span><span class="s0">, </span><span class="s1">e)</span>

        <span class="s2"># test an object with dates + floats + integers + strings</span>
        <span class="s1">dr = pd.Series(pd.date_range(</span><span class="s4">&quot;1/1/2001&quot;</span><span class="s0">, </span><span class="s4">&quot;1/10/2001&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s4">&quot;D&quot;</span><span class="s1">))</span>
        <span class="s1">result = dr.astype(object).replace([dr[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dr[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dr[</span><span class="s3">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s1">])</span>
        <span class="s1">expected = pd.Series([</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s1">] + dr[</span><span class="s3">3</span><span class="s1">:].tolist()</span><span class="s0">, </span><span class="s1">dtype=object)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_replace_bool_with_string_no_op(self):</span>
        <span class="s1">s = pd.Series([</span><span class="s0">True, False, True</span><span class="s1">])</span>
        <span class="s1">result = s.replace(</span><span class="s4">&quot;fun&quot;</span><span class="s0">, </span><span class="s4">&quot;in-the-sun&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(s</span><span class="s0">, </span><span class="s1">result)</span>

    <span class="s0">def </span><span class="s1">test_replace_bool_with_string(self):</span>
        <span class="s2"># nonexistent elements</span>
        <span class="s1">s = pd.Series([</span><span class="s0">True, False, True</span><span class="s1">])</span>
        <span class="s1">result = s.replace(</span><span class="s0">True, </span><span class="s4">&quot;2u&quot;</span><span class="s1">)</span>
        <span class="s1">expected = pd.Series([</span><span class="s4">&quot;2u&quot;</span><span class="s0">, False, </span><span class="s4">&quot;2u&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(expected</span><span class="s0">, </span><span class="s1">result)</span>

    <span class="s0">def </span><span class="s1">test_replace_bool_with_bool(self):</span>
        <span class="s1">s = pd.Series([</span><span class="s0">True, False, True</span><span class="s1">])</span>
        <span class="s1">result = s.replace(</span><span class="s0">True, False</span><span class="s1">)</span>
        <span class="s1">expected = pd.Series([</span><span class="s0">False</span><span class="s1">] * len(s))</span>
        <span class="s1">tm.assert_series_equal(expected</span><span class="s0">, </span><span class="s1">result)</span>

    <span class="s0">def </span><span class="s1">test_replace_with_dict_with_bool_keys(self):</span>
        <span class="s1">s = pd.Series([</span><span class="s0">True, False, True</span><span class="s1">])</span>
        <span class="s1">result = s.replace({</span><span class="s4">&quot;asdf&quot;</span><span class="s1">: </span><span class="s4">&quot;asdb&quot;</span><span class="s0">, True</span><span class="s1">: </span><span class="s4">&quot;yes&quot;</span><span class="s1">})</span>
        <span class="s1">expected = pd.Series([</span><span class="s4">&quot;yes&quot;</span><span class="s0">, False, </span><span class="s4">&quot;yes&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_replace_Int_with_na(self</span><span class="s0">, </span><span class="s1">any_int_ea_dtype):</span>
        <span class="s2"># GH 38267</span>
        <span class="s1">result = pd.Series([</span><span class="s3">0</span><span class="s0">, None</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_int_ea_dtype).replace(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">pd.NA)</span>
        <span class="s1">expected = pd.Series([pd.NA</span><span class="s0">, </span><span class="s1">pd.NA]</span><span class="s0">, </span><span class="s1">dtype=any_int_ea_dtype)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
        <span class="s1">result = pd.Series([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_int_ea_dtype).replace(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">pd.NA)</span>
        <span class="s1">result.replace(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">pd.NA</span><span class="s0">, </span><span class="s1">inplace=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_replace2(self):</span>
        <span class="s1">N = </span><span class="s3">100</span>
        <span class="s1">ser = pd.Series(np.fabs(np.random.randn(N))</span><span class="s0">, </span><span class="s1">tm.makeDateIndex(N)</span><span class="s0">, </span><span class="s1">dtype=object)</span>
        <span class="s1">ser[:</span><span class="s3">5</span><span class="s1">] = np.nan</span>
        <span class="s1">ser[</span><span class="s3">6</span><span class="s1">:</span><span class="s3">10</span><span class="s1">] = </span><span class="s4">&quot;foo&quot;</span>
        <span class="s1">ser[</span><span class="s3">20</span><span class="s1">:</span><span class="s3">30</span><span class="s1">] = </span><span class="s4">&quot;bar&quot;</span>

        <span class="s2"># replace list with a single value</span>
        <span class="s1">rs = ser.replace([np.nan</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;bar&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)</span>

        <span class="s0">assert </span><span class="s1">(rs[:</span><span class="s3">5</span><span class="s1">] == -</span><span class="s3">1</span><span class="s1">).all()</span>
        <span class="s0">assert </span><span class="s1">(rs[</span><span class="s3">6</span><span class="s1">:</span><span class="s3">10</span><span class="s1">] == -</span><span class="s3">1</span><span class="s1">).all()</span>
        <span class="s0">assert </span><span class="s1">(rs[</span><span class="s3">20</span><span class="s1">:</span><span class="s3">30</span><span class="s1">] == -</span><span class="s3">1</span><span class="s1">).all()</span>
        <span class="s0">assert </span><span class="s1">(pd.isna(ser[:</span><span class="s3">5</span><span class="s1">])).all()</span>

        <span class="s2"># replace with different values</span>
        <span class="s1">rs = ser.replace({np.nan: -</span><span class="s3">1</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s1">: -</span><span class="s3">2</span><span class="s0">, </span><span class="s4">&quot;bar&quot;</span><span class="s1">: -</span><span class="s3">3</span><span class="s1">})</span>

        <span class="s0">assert </span><span class="s1">(rs[:</span><span class="s3">5</span><span class="s1">] == -</span><span class="s3">1</span><span class="s1">).all()</span>
        <span class="s0">assert </span><span class="s1">(rs[</span><span class="s3">6</span><span class="s1">:</span><span class="s3">10</span><span class="s1">] == -</span><span class="s3">2</span><span class="s1">).all()</span>
        <span class="s0">assert </span><span class="s1">(rs[</span><span class="s3">20</span><span class="s1">:</span><span class="s3">30</span><span class="s1">] == -</span><span class="s3">3</span><span class="s1">).all()</span>
        <span class="s0">assert </span><span class="s1">(pd.isna(ser[:</span><span class="s3">5</span><span class="s1">])).all()</span>

        <span class="s2"># replace with different values with 2 lists</span>
        <span class="s1">rs2 = ser.replace([np.nan</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;bar&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">2</span><span class="s0">, </span><span class="s1">-</span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(rs</span><span class="s0">, </span><span class="s1">rs2)</span>

        <span class="s2"># replace inplace</span>
        <span class="s1">return_value = ser.replace([np.nan</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;bar&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">inplace=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">return_value </span><span class="s0">is None</span>
        <span class="s0">assert </span><span class="s1">(ser[:</span><span class="s3">5</span><span class="s1">] == -</span><span class="s3">1</span><span class="s1">).all()</span>
        <span class="s0">assert </span><span class="s1">(ser[</span><span class="s3">6</span><span class="s1">:</span><span class="s3">10</span><span class="s1">] == -</span><span class="s3">1</span><span class="s1">).all()</span>
        <span class="s0">assert </span><span class="s1">(ser[</span><span class="s3">20</span><span class="s1">:</span><span class="s3">30</span><span class="s1">] == -</span><span class="s3">1</span><span class="s1">).all()</span>

    <span class="s0">def </span><span class="s1">test_replace_with_dictlike_and_string_dtype(self</span><span class="s0">, </span><span class="s1">nullable_string_dtype):</span>
        <span class="s2"># GH 32621, GH#44940</span>
        <span class="s1">ser = pd.Series([</span><span class="s4">&quot;one&quot;</span><span class="s0">, </span><span class="s4">&quot;two&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=nullable_string_dtype)</span>
        <span class="s1">expected = pd.Series([</span><span class="s4">&quot;1&quot;</span><span class="s0">, </span><span class="s4">&quot;2&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=nullable_string_dtype)</span>
        <span class="s1">result = ser.replace({</span><span class="s4">&quot;one&quot;</span><span class="s1">: </span><span class="s4">&quot;1&quot;</span><span class="s0">, </span><span class="s4">&quot;two&quot;</span><span class="s1">: </span><span class="s4">&quot;2&quot;</span><span class="s1">})</span>
        <span class="s1">tm.assert_series_equal(expected</span><span class="s0">, </span><span class="s1">result)</span>

    <span class="s0">def </span><span class="s1">test_replace_with_empty_dictlike(self):</span>
        <span class="s2"># GH 15289</span>
        <span class="s1">s = pd.Series(list(</span><span class="s4">&quot;abcd&quot;</span><span class="s1">))</span>
        <span class="s1">tm.assert_series_equal(s</span><span class="s0">, </span><span class="s1">s.replace({}))</span>

        <span class="s0">with </span><span class="s1">tm.assert_produces_warning(FutureWarning):</span>
            <span class="s1">empty_series = pd.Series([])</span>
        <span class="s1">tm.assert_series_equal(s</span><span class="s0">, </span><span class="s1">s.replace(empty_series))</span>

    <span class="s0">def </span><span class="s1">test_replace_string_with_number(self):</span>
        <span class="s2"># GH 15743</span>
        <span class="s1">s = pd.Series([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">result = s.replace(</span><span class="s4">&quot;2&quot;</span><span class="s0">, </span><span class="s1">np.nan)</span>
        <span class="s1">expected = pd.Series([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(expected</span><span class="s0">, </span><span class="s1">result)</span>

    <span class="s0">def </span><span class="s1">test_replace_replacer_equals_replacement(self):</span>
        <span class="s2"># GH 20656</span>
        <span class="s2"># make sure all replacers are matching against original values</span>
        <span class="s1">s = pd.Series([</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;b&quot;</span><span class="s1">])</span>
        <span class="s1">expected = pd.Series([</span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;a&quot;</span><span class="s1">])</span>
        <span class="s1">result = s.replace({</span><span class="s4">&quot;a&quot;</span><span class="s1">: </span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;b&quot;</span><span class="s1">: </span><span class="s4">&quot;a&quot;</span><span class="s1">})</span>
        <span class="s1">tm.assert_series_equal(expected</span><span class="s0">, </span><span class="s1">result)</span>

    <span class="s0">def </span><span class="s1">test_replace_unicode_with_number(self):</span>
        <span class="s2"># GH 15743</span>
        <span class="s1">s = pd.Series([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">result = s.replace(</span><span class="s4">&quot;2&quot;</span><span class="s0">, </span><span class="s1">np.nan)</span>
        <span class="s1">expected = pd.Series([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(expected</span><span class="s0">, </span><span class="s1">result)</span>

    <span class="s0">def </span><span class="s1">test_replace_mixed_types_with_string(self):</span>
        <span class="s2"># Testing mixed</span>
        <span class="s1">s = pd.Series([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s4">&quot;4&quot;</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">])</span>
        <span class="s1">result = s.replace([</span><span class="s3">2</span><span class="s0">, </span><span class="s4">&quot;4&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">np.nan)</span>
        <span class="s1">expected = pd.Series([</span><span class="s3">1</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(expected</span><span class="s0">, </span><span class="s1">result)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s4">&quot;categorical, numeric&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">(pd.Categorical([</span><span class="s4">&quot;A&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s4">&quot;B&quot;</span><span class="s1">])</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">(pd.Categorical([</span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s4">&quot;B&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">categories=[</span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s4">&quot;B&quot;</span><span class="s1">])</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_replace_categorical(self</span><span class="s0">, </span><span class="s1">categorical</span><span class="s0">, </span><span class="s1">numeric):</span>
        <span class="s2"># GH 24971, GH#23305</span>
        <span class="s1">ser = pd.Series(categorical)</span>
        <span class="s1">result = ser.replace({</span><span class="s4">&quot;A&quot;</span><span class="s1">: </span><span class="s3">1</span><span class="s0">, </span><span class="s4">&quot;B&quot;</span><span class="s1">: </span><span class="s3">2</span><span class="s1">})</span>
        <span class="s1">expected = pd.Series(numeric).astype(</span><span class="s4">&quot;category&quot;</span><span class="s1">)</span>
        <span class="s0">if </span><span class="s3">2 </span><span class="s0">not in </span><span class="s1">expected.cat.categories:</span>
            <span class="s2"># i.e. categories should be [1, 2] even if there are no &quot;B&quot;s present</span>
            <span class="s2"># GH#44940</span>
            <span class="s1">expected = expected.cat.add_categories(</span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(expected</span><span class="s0">, </span><span class="s1">result)</span>

    <span class="s0">def </span><span class="s1">test_replace_categorical_single(self):</span>
        <span class="s2"># GH 26988</span>
        <span class="s1">dti = pd.date_range(</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Pacific&quot;</span><span class="s1">)</span>
        <span class="s1">s = pd.Series(dti)</span>
        <span class="s1">c = s.astype(</span><span class="s4">&quot;category&quot;</span><span class="s1">)</span>

        <span class="s1">expected = c.copy()</span>
        <span class="s1">expected = expected.cat.add_categories(</span><span class="s4">&quot;foo&quot;</span><span class="s1">)</span>
        <span class="s1">expected[</span><span class="s3">2</span><span class="s1">] = </span><span class="s4">&quot;foo&quot;</span>
        <span class="s1">expected = expected.cat.remove_unused_categories()</span>
        <span class="s0">assert </span><span class="s1">c[</span><span class="s3">2</span><span class="s1">] != </span><span class="s4">&quot;foo&quot;</span>

        <span class="s1">result = c.replace(c[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(expected</span><span class="s0">, </span><span class="s1">result)</span>
        <span class="s0">assert </span><span class="s1">c[</span><span class="s3">2</span><span class="s1">] != </span><span class="s4">&quot;foo&quot;  </span><span class="s2"># ensure non-inplace call does not alter original</span>

        <span class="s1">return_value = c.replace(c[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">inplace=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">return_value </span><span class="s0">is None</span>
        <span class="s1">tm.assert_series_equal(expected</span><span class="s0">, </span><span class="s1">c)</span>

        <span class="s1">first_value = c[</span><span class="s3">0</span><span class="s1">]</span>
        <span class="s1">return_value = c.replace(c[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">inplace=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">return_value </span><span class="s0">is None</span>
        <span class="s0">assert </span><span class="s1">c[</span><span class="s3">0</span><span class="s1">] == c[</span><span class="s3">1</span><span class="s1">] == first_value  </span><span class="s2"># test replacing with existing value</span>

    <span class="s0">def </span><span class="s1">test_replace_with_no_overflowerror(self):</span>
        <span class="s2"># GH 25616</span>
        <span class="s2"># casts to object without Exception from OverflowError</span>
        <span class="s1">s = pd.Series([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">])</span>
        <span class="s1">result = s.replace([</span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">&quot;100000000000000000000&quot;</span><span class="s1">])</span>
        <span class="s1">expected = pd.Series([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s4">&quot;100000000000000000000&quot;</span><span class="s0">, </span><span class="s3">4</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">s = pd.Series([</span><span class="s3">0</span><span class="s0">, </span><span class="s4">&quot;100000000000000000000&quot;</span><span class="s0">, </span><span class="s4">&quot;100000000000000000001&quot;</span><span class="s1">])</span>
        <span class="s1">result = s.replace([</span><span class="s4">&quot;100000000000000000000&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">expected = pd.Series([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s4">&quot;100000000000000000001&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s4">&quot;ser, to_replace, exp&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">{</span><span class="s3">1</span><span class="s1">: </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">: </span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">: </span><span class="s3">4</span><span class="s1">}</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">([</span><span class="s4">&quot;1&quot;</span><span class="s0">, </span><span class="s4">&quot;2&quot;</span><span class="s0">, </span><span class="s4">&quot;3&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">{</span><span class="s4">&quot;1&quot;</span><span class="s1">: </span><span class="s4">&quot;2&quot;</span><span class="s0">, </span><span class="s4">&quot;2&quot;</span><span class="s1">: </span><span class="s4">&quot;3&quot;</span><span class="s0">, </span><span class="s4">&quot;3&quot;</span><span class="s1">: </span><span class="s4">&quot;4&quot;</span><span class="s1">}</span><span class="s0">, </span><span class="s1">[</span><span class="s4">&quot;2&quot;</span><span class="s0">, </span><span class="s4">&quot;3&quot;</span><span class="s0">, </span><span class="s4">&quot;4&quot;</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_replace_commutative(self</span><span class="s0">, </span><span class="s1">ser</span><span class="s0">, </span><span class="s1">to_replace</span><span class="s0">, </span><span class="s1">exp):</span>
        <span class="s2"># GH 16051</span>
        <span class="s2"># DataFrame.replace() overwrites when values are non-numeric</span>

        <span class="s1">series = pd.Series(ser)</span>

        <span class="s1">expected = pd.Series(exp)</span>
        <span class="s1">result = series.replace(to_replace)</span>

        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s4">&quot;ser, exp&quot;</span><span class="s0">, </span><span class="s1">[([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, True, </span><span class="s3">3</span><span class="s1">])</span><span class="s0">, </span><span class="s1">([</span><span class="s4">&quot;x&quot;</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">&quot;x&quot;</span><span class="s0">, True, </span><span class="s3">3</span><span class="s1">])]</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_replace_no_cast(self</span><span class="s0">, </span><span class="s1">ser</span><span class="s0">, </span><span class="s1">exp):</span>
        <span class="s2"># GH 9113</span>
        <span class="s2"># BUG: replace int64 dtype with bool coerces to int64</span>

        <span class="s1">series = pd.Series(ser)</span>
        <span class="s1">result = series.replace(</span><span class="s3">2</span><span class="s0">, True</span><span class="s1">)</span>
        <span class="s1">expected = pd.Series(exp)</span>

        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_replace_invalid_to_replace(self):</span>
        <span class="s2"># GH 18634</span>
        <span class="s2"># API: replace() should raise an exception if invalid argument is given</span>
        <span class="s1">series = pd.Series([</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;c &quot;</span><span class="s1">])</span>
        <span class="s1">msg = (</span>
            <span class="s4">r&quot;Expecting 'to_replace' to be either a scalar, array-like, &quot;</span>
            <span class="s4">r&quot;dict or None, got invalid type.*&quot;</span>
        <span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">series.replace(</span><span class="s0">lambda </span><span class="s1">x: x.strip())</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;frame&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_replace_nonbool_regex(self</span><span class="s0">, </span><span class="s1">frame):</span>
        <span class="s1">obj = pd.Series([</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;c &quot;</span><span class="s1">])</span>
        <span class="s0">if </span><span class="s1">frame:</span>
            <span class="s1">obj = obj.to_frame()</span>

        <span class="s1">msg = </span><span class="s4">&quot;'to_replace' must be 'None' if 'regex' is not a bool&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">obj.replace(to_replace=[</span><span class="s4">&quot;a&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">regex=</span><span class="s4">&quot;foo&quot;</span><span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;frame&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_replace_empty_copy(self</span><span class="s0">, </span><span class="s1">frame):</span>
        <span class="s1">obj = pd.Series([]</span><span class="s0">, </span><span class="s1">dtype=np.float64)</span>
        <span class="s0">if </span><span class="s1">frame:</span>
            <span class="s1">obj = obj.to_frame()</span>

        <span class="s1">res = obj.replace(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s1">inplace=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">res </span><span class="s0">is None</span>

        <span class="s1">res = obj.replace(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s1">inplace=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">tm.assert_equal(res</span><span class="s0">, </span><span class="s1">obj)</span>
        <span class="s0">assert </span><span class="s1">res </span><span class="s0">is not </span><span class="s1">obj</span>

    <span class="s0">def </span><span class="s1">test_replace_only_one_dictlike_arg(self</span><span class="s0">, </span><span class="s1">fixed_now_ts):</span>
        <span class="s2"># GH#33340</span>

        <span class="s1">ser = pd.Series([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s1">fixed_now_ts</span><span class="s0">, True</span><span class="s1">])</span>
        <span class="s1">to_replace = {</span><span class="s3">0</span><span class="s1">: </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">: </span><span class="s4">&quot;A&quot;</span><span class="s1">}</span>
        <span class="s1">value = </span><span class="s4">&quot;foo&quot;</span>
        <span class="s1">msg = </span><span class="s4">&quot;Series.replace cannot use dict-like to_replace and non-None value&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">ser.replace(to_replace</span><span class="s0">, </span><span class="s1">value)</span>

        <span class="s1">to_replace = </span><span class="s3">1</span>
        <span class="s1">value = {</span><span class="s3">0</span><span class="s1">: </span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">2</span><span class="s1">: </span><span class="s4">&quot;bar&quot;</span><span class="s1">}</span>
        <span class="s1">msg = </span><span class="s4">&quot;Series.replace cannot use dict-value and non-None to_replace&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">ser.replace(to_replace</span><span class="s0">, </span><span class="s1">value)</span>

    <span class="s0">def </span><span class="s1">test_replace_extension_other(self</span><span class="s0">, </span><span class="s1">frame_or_series):</span>
        <span class="s2"># https://github.com/pandas-dev/pandas/issues/34530</span>
        <span class="s1">obj = frame_or_series(pd.array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">&quot;Int64&quot;</span><span class="s1">))</span>
        <span class="s1">result = obj.replace(</span><span class="s4">&quot;&quot;</span><span class="s0">, </span><span class="s4">&quot;&quot;</span><span class="s1">)  </span><span class="s2"># no exception</span>
        <span class="s2"># should not have changed dtype</span>
        <span class="s1">tm.assert_equal(obj</span><span class="s0">, </span><span class="s1">result)</span>

    <span class="s0">def </span><span class="s1">_check_replace_with_method(self</span><span class="s0">, </span><span class="s1">ser: pd.Series):</span>
        <span class="s1">df = ser.to_frame()</span>

        <span class="s1">res = ser.replace(ser[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">method=</span><span class="s4">&quot;pad&quot;</span><span class="s1">)</span>
        <span class="s1">expected = pd.Series([ser[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ser[</span><span class="s3">0</span><span class="s1">]] + list(ser[</span><span class="s3">2</span><span class="s1">:])</span><span class="s0">, </span><span class="s1">dtype=ser.dtype)</span>
        <span class="s1">tm.assert_series_equal(res</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">res_df = df.replace(ser[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">method=</span><span class="s4">&quot;pad&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(res_df</span><span class="s0">, </span><span class="s1">expected.to_frame())</span>

        <span class="s1">ser2 = ser.copy()</span>
        <span class="s1">res2 = ser2.replace(ser[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">method=</span><span class="s4">&quot;pad&quot;</span><span class="s0">, </span><span class="s1">inplace=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">res2 </span><span class="s0">is None</span>
        <span class="s1">tm.assert_series_equal(ser2</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">res_df2 = df.replace(ser[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">method=</span><span class="s4">&quot;pad&quot;</span><span class="s0">, </span><span class="s1">inplace=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">res_df2 </span><span class="s0">is None</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected.to_frame())</span>

    <span class="s0">def </span><span class="s1">test_replace_ea_dtype_with_method(self</span><span class="s0">, </span><span class="s1">any_numeric_ea_dtype):</span>
        <span class="s1">arr = pd.array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">pd.NA</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=any_numeric_ea_dtype)</span>
        <span class="s1">ser = pd.Series(arr)</span>

        <span class="s1">self._check_replace_with_method(ser)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;as_categorical&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_replace_interval_with_method(self</span><span class="s0">, </span><span class="s1">as_categorical):</span>
        <span class="s2"># in particular interval that can't hold NA</span>

        <span class="s1">idx = pd.IntervalIndex.from_breaks(range(</span><span class="s3">4</span><span class="s1">))</span>
        <span class="s1">ser = pd.Series(idx)</span>
        <span class="s0">if </span><span class="s1">as_categorical:</span>
            <span class="s1">ser = ser.astype(</span><span class="s4">&quot;category&quot;</span><span class="s1">)</span>

        <span class="s1">self._check_replace_with_method(ser)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;as_period&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;as_categorical&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_replace_datetimelike_with_method(self</span><span class="s0">, </span><span class="s1">as_period</span><span class="s0">, </span><span class="s1">as_categorical):</span>
        <span class="s1">idx = pd.date_range(</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">5</span><span class="s0">, </span><span class="s1">tz=</span><span class="s4">&quot;US/Pacific&quot;</span><span class="s1">)</span>
        <span class="s0">if </span><span class="s1">as_period:</span>
            <span class="s1">idx = idx.tz_localize(</span><span class="s0">None</span><span class="s1">).to_period(</span><span class="s4">&quot;D&quot;</span><span class="s1">)</span>

        <span class="s1">ser = pd.Series(idx)</span>
        <span class="s1">ser.iloc[-</span><span class="s3">2</span><span class="s1">] = pd.NaT</span>
        <span class="s0">if </span><span class="s1">as_categorical:</span>
            <span class="s1">ser = ser.astype(</span><span class="s4">&quot;category&quot;</span><span class="s1">)</span>

        <span class="s1">self._check_replace_with_method(ser)</span>

    <span class="s0">def </span><span class="s1">test_replace_with_compiled_regex(self):</span>
        <span class="s2"># https://github.com/pandas-dev/pandas/issues/35680</span>
        <span class="s1">s = pd.Series([</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">regex = re.compile(</span><span class="s4">&quot;^a$&quot;</span><span class="s1">)</span>
        <span class="s1">result = s.replace({regex: </span><span class="s4">&quot;z&quot;</span><span class="s1">}</span><span class="s0">, </span><span class="s1">regex=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected = pd.Series([</span><span class="s4">&quot;z&quot;</span><span class="s0">, </span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_pandas_replace_na(self):</span>
        <span class="s2"># GH#43344</span>
        <span class="s1">ser = pd.Series([</span><span class="s4">&quot;AA&quot;</span><span class="s0">, </span><span class="s4">&quot;BB&quot;</span><span class="s0">, </span><span class="s4">&quot;CC&quot;</span><span class="s0">, </span><span class="s4">&quot;DD&quot;</span><span class="s0">, </span><span class="s4">&quot;EE&quot;</span><span class="s0">, </span><span class="s4">&quot;&quot;</span><span class="s0">, </span><span class="s1">pd.NA]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">&quot;string&quot;</span><span class="s1">)</span>
        <span class="s1">regex_mapping = {</span>
            <span class="s4">&quot;AA&quot;</span><span class="s1">: </span><span class="s4">&quot;CC&quot;</span><span class="s0">,</span>
            <span class="s4">&quot;BB&quot;</span><span class="s1">: </span><span class="s4">&quot;CC&quot;</span><span class="s0">,</span>
            <span class="s4">&quot;EE&quot;</span><span class="s1">: </span><span class="s4">&quot;CC&quot;</span><span class="s0">,</span>
            <span class="s4">&quot;CC&quot;</span><span class="s1">: </span><span class="s4">&quot;CC-REPL&quot;</span><span class="s0">,</span>
        <span class="s1">}</span>
        <span class="s1">result = ser.replace(regex_mapping</span><span class="s0">, </span><span class="s1">regex=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">exp = pd.Series([</span><span class="s4">&quot;CC&quot;</span><span class="s0">, </span><span class="s4">&quot;CC&quot;</span><span class="s0">, </span><span class="s4">&quot;CC-REPL&quot;</span><span class="s0">, </span><span class="s4">&quot;DD&quot;</span><span class="s0">, </span><span class="s4">&quot;CC&quot;</span><span class="s0">, </span><span class="s4">&quot;&quot;</span><span class="s0">, </span><span class="s1">pd.NA]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">&quot;string&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">exp)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s4">&quot;dtype, input_data, to_replace, expected_data&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">(</span><span class="s4">&quot;bool&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">{</span><span class="s0">True</span><span class="s1">: </span><span class="s0">False</span><span class="s1">}</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, False</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s4">&quot;int64&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">{</span><span class="s3">1</span><span class="s1">: </span><span class="s3">10</span><span class="s0">, </span><span class="s3">2</span><span class="s1">: </span><span class="s3">20</span><span class="s1">}</span><span class="s0">, </span><span class="s1">[</span><span class="s3">10</span><span class="s0">, </span><span class="s3">20</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s4">&quot;Int64&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">{</span><span class="s3">1</span><span class="s1">: </span><span class="s3">10</span><span class="s0">, </span><span class="s3">2</span><span class="s1">: </span><span class="s3">20</span><span class="s1">}</span><span class="s0">, </span><span class="s1">[</span><span class="s3">10</span><span class="s0">, </span><span class="s3">20</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s4">&quot;float64&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.1</span><span class="s0">, </span><span class="s3">2.2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">{</span><span class="s3">1.1</span><span class="s1">: </span><span class="s3">10.1</span><span class="s0">, </span><span class="s3">2.2</span><span class="s1">: </span><span class="s3">20.5</span><span class="s1">}</span><span class="s0">, </span><span class="s1">[</span><span class="s3">10.1</span><span class="s0">, </span><span class="s3">20.5</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s4">&quot;Float64&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.1</span><span class="s0">, </span><span class="s3">2.2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">{</span><span class="s3">1.1</span><span class="s1">: </span><span class="s3">10.1</span><span class="s0">, </span><span class="s3">2.2</span><span class="s1">: </span><span class="s3">20.5</span><span class="s1">}</span><span class="s0">, </span><span class="s1">[</span><span class="s3">10.1</span><span class="s0">, </span><span class="s3">20.5</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s4">&quot;string&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s4">&quot;one&quot;</span><span class="s0">, </span><span class="s4">&quot;two&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">{</span><span class="s4">&quot;one&quot;</span><span class="s1">: </span><span class="s4">&quot;1&quot;</span><span class="s0">, </span><span class="s4">&quot;two&quot;</span><span class="s1">: </span><span class="s4">&quot;2&quot;</span><span class="s1">}</span><span class="s0">, </span><span class="s1">[</span><span class="s4">&quot;1&quot;</span><span class="s0">, </span><span class="s4">&quot;2&quot;</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">(</span>
                <span class="s1">pd.IntervalDtype(</span><span class="s4">&quot;int64&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">IntervalArray([pd.Interval(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">pd.Interval(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)])</span><span class="s0">,</span>
                <span class="s1">{pd.Interval(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">): pd.Interval(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)}</span><span class="s0">,</span>
                <span class="s1">IntervalArray([pd.Interval(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span><span class="s0">, </span><span class="s1">pd.Interval(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)])</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span>
                <span class="s1">pd.IntervalDtype(</span><span class="s4">&quot;float64&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">IntervalArray([pd.Interval(</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2.7</span><span class="s1">)</span><span class="s0">, </span><span class="s1">pd.Interval(</span><span class="s3">2.8</span><span class="s0">, </span><span class="s3">3.1</span><span class="s1">)])</span><span class="s0">,</span>
                <span class="s1">{pd.Interval(</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2.7</span><span class="s1">): pd.Interval(</span><span class="s3">10.6</span><span class="s0">, </span><span class="s3">20.8</span><span class="s1">)}</span><span class="s0">,</span>
                <span class="s1">IntervalArray([pd.Interval(</span><span class="s3">10.6</span><span class="s0">, </span><span class="s3">20.8</span><span class="s1">)</span><span class="s0">, </span><span class="s1">pd.Interval(</span><span class="s3">2.8</span><span class="s0">, </span><span class="s3">3.1</span><span class="s1">)])</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span>
                <span class="s1">pd.PeriodDtype(</span><span class="s4">&quot;M&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[pd.Period(</span><span class="s4">&quot;2020-05&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s4">&quot;M&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                <span class="s1">{pd.Period(</span><span class="s4">&quot;2020-05&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s4">&quot;M&quot;</span><span class="s1">): pd.Period(</span><span class="s4">&quot;2020-06&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s4">&quot;M&quot;</span><span class="s1">)}</span><span class="s0">,</span>
                <span class="s1">[pd.Period(</span><span class="s4">&quot;2020-06&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s4">&quot;M&quot;</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_replace_dtype(self</span><span class="s0">, </span><span class="s1">dtype</span><span class="s0">, </span><span class="s1">input_data</span><span class="s0">, </span><span class="s1">to_replace</span><span class="s0">, </span><span class="s1">expected_data):</span>
        <span class="s2"># GH#33484</span>
        <span class="s1">ser = pd.Series(input_data</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
        <span class="s1">result = ser.replace(to_replace)</span>
        <span class="s1">expected = pd.Series(expected_data</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_replace_string_dtype(self):</span>
        <span class="s2"># GH#40732, GH#44940</span>
        <span class="s1">ser = pd.Series([</span><span class="s4">&quot;one&quot;</span><span class="s0">, </span><span class="s4">&quot;two&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">&quot;string&quot;</span><span class="s1">)</span>
        <span class="s1">res = ser.replace({</span><span class="s4">&quot;one&quot;</span><span class="s1">: </span><span class="s4">&quot;1&quot;</span><span class="s0">, </span><span class="s4">&quot;two&quot;</span><span class="s1">: </span><span class="s4">&quot;2&quot;</span><span class="s1">})</span>
        <span class="s1">expected = pd.Series([</span><span class="s4">&quot;1&quot;</span><span class="s0">, </span><span class="s4">&quot;2&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">&quot;string&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(res</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># GH#31644</span>
        <span class="s1">ser2 = pd.Series([</span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">&quot;string&quot;</span><span class="s1">)</span>
        <span class="s1">res2 = ser2.replace(</span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s4">&quot;B&quot;</span><span class="s1">)</span>
        <span class="s1">expected2 = pd.Series([</span><span class="s4">&quot;B&quot;</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">&quot;string&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(res2</span><span class="s0">, </span><span class="s1">expected2)</span>

        <span class="s1">ser3 = pd.Series([</span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s4">&quot;B&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">&quot;string&quot;</span><span class="s1">)</span>
        <span class="s1">res3 = ser3.replace(</span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s1">pd.NA)</span>
        <span class="s1">expected3 = pd.Series([pd.NA</span><span class="s0">, </span><span class="s4">&quot;B&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">&quot;string&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(res3</span><span class="s0">, </span><span class="s1">expected3)</span>

    <span class="s0">def </span><span class="s1">test_replace_string_dtype_list_to_replace(self):</span>
        <span class="s2"># GH#41215, GH#44940</span>
        <span class="s1">ser = pd.Series([</span><span class="s4">&quot;abc&quot;</span><span class="s0">, </span><span class="s4">&quot;def&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">&quot;string&quot;</span><span class="s1">)</span>
        <span class="s1">res = ser.replace([</span><span class="s4">&quot;abc&quot;</span><span class="s0">, </span><span class="s4">&quot;any other string&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s4">&quot;xyz&quot;</span><span class="s1">)</span>
        <span class="s1">expected = pd.Series([</span><span class="s4">&quot;xyz&quot;</span><span class="s0">, </span><span class="s4">&quot;def&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">&quot;string&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(res</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_replace_string_dtype_regex(self):</span>
        <span class="s2"># GH#31644</span>
        <span class="s1">ser = pd.Series([</span><span class="s4">&quot;A&quot;</span><span class="s0">, </span><span class="s4">&quot;B&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">&quot;string&quot;</span><span class="s1">)</span>
        <span class="s1">res = ser.replace(</span><span class="s4">r&quot;.&quot;</span><span class="s0">, </span><span class="s4">&quot;C&quot;</span><span class="s0">, </span><span class="s1">regex=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected = pd.Series([</span><span class="s4">&quot;C&quot;</span><span class="s0">, </span><span class="s4">&quot;C&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">&quot;string&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(res</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_replace_nullable_numeric(self):</span>
        <span class="s2"># GH#40732, GH#44940</span>

        <span class="s1">floats = pd.Series([</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2.0</span><span class="s0">, </span><span class="s3">3.999</span><span class="s0">, </span><span class="s3">4.4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=pd.Float64Dtype())</span>
        <span class="s0">assert </span><span class="s1">floats.replace({</span><span class="s3">1.0</span><span class="s1">: </span><span class="s3">9</span><span class="s1">}).dtype == floats.dtype</span>
        <span class="s0">assert </span><span class="s1">floats.replace(</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">9</span><span class="s1">).dtype == floats.dtype</span>
        <span class="s0">assert </span><span class="s1">floats.replace({</span><span class="s3">1.0</span><span class="s1">: </span><span class="s3">9.0</span><span class="s1">}).dtype == floats.dtype</span>
        <span class="s0">assert </span><span class="s1">floats.replace(</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">9.0</span><span class="s1">).dtype == floats.dtype</span>

        <span class="s1">res = floats.replace(to_replace=[</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">value=[</span><span class="s3">9.0</span><span class="s0">, </span><span class="s3">10.0</span><span class="s1">])</span>
        <span class="s0">assert </span><span class="s1">res.dtype == floats.dtype</span>

        <span class="s1">ints = pd.Series([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=pd.Int64Dtype())</span>
        <span class="s0">assert </span><span class="s1">ints.replace({</span><span class="s3">1</span><span class="s1">: </span><span class="s3">9</span><span class="s1">}).dtype == ints.dtype</span>
        <span class="s0">assert </span><span class="s1">ints.replace(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">9</span><span class="s1">).dtype == ints.dtype</span>
        <span class="s0">assert </span><span class="s1">ints.replace({</span><span class="s3">1</span><span class="s1">: </span><span class="s3">9.0</span><span class="s1">}).dtype == ints.dtype</span>
        <span class="s0">assert </span><span class="s1">ints.replace(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">9.0</span><span class="s1">).dtype == ints.dtype</span>
        <span class="s2"># FIXME: ints.replace({1: 9.5}) raises bc of incorrect _can_hold_element</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;regex&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_replace_regex_dtype_series(self</span><span class="s0">, </span><span class="s1">regex):</span>
        <span class="s2"># GH-48644</span>
        <span class="s1">series = pd.Series([</span><span class="s4">&quot;0&quot;</span><span class="s1">])</span>
        <span class="s1">expected = pd.Series([</span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">result = series.replace(to_replace=</span><span class="s4">&quot;0&quot;</span><span class="s0">, </span><span class="s1">value=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">regex=regex)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
</pre>
</body>
</html>