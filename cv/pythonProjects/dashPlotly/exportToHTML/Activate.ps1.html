<html>
<head>
<title>Activate.ps1</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #a9b7c6;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
Activate.ps1</font>
</center></td></tr></table>
<pre><span class="s0">$script:THIS_PATH = $myinvocation.mycommand.path</span>
<span class="s0">$script:BASE_DIR = Split-Path (Resolve-Path &quot;$THIS_PATH/..&quot;) -Parent</span>

<span class="s0">function global:deactivate([switch] $NonDestructive) {</span>
    <span class="s0">if (Test-Path variable:_OLD_VIRTUAL_PATH) {</span>
        <span class="s0">$env:PATH = $variable:_OLD_VIRTUAL_PATH</span>
        <span class="s0">Remove-Variable &quot;_OLD_VIRTUAL_PATH&quot; -Scope global</span>
    <span class="s0">}</span>

    <span class="s0">if (Test-Path function:_old_virtual_prompt) {</span>
        <span class="s0">$function:prompt = $function:_old_virtual_prompt</span>
        <span class="s0">Remove-Item function:\_old_virtual_prompt</span>
    <span class="s0">}</span>

    <span class="s0">if ($env:VIRTUAL_ENV) {</span>
        <span class="s0">Remove-Item env:VIRTUAL_ENV -ErrorAction SilentlyContinue</span>
    <span class="s0">}</span>

    <span class="s0">if (!$NonDestructive) {</span>
        <span class="s0"># Self destruct!</span>
        <span class="s0">Remove-Item function:deactivate</span>
        <span class="s0">Remove-Item function:pydoc</span>
    <span class="s0">}</span>
<span class="s0">}</span>

<span class="s0">function global:pydoc {</span>
    <span class="s0">python -m pydoc $args</span>
<span class="s0">}</span>

<span class="s0"># unset irrelevant variables</span>
<span class="s0">deactivate -nondestructive</span>

<span class="s0">$VIRTUAL_ENV = $BASE_DIR</span>
<span class="s0">$env:VIRTUAL_ENV = $VIRTUAL_ENV</span>

<span class="s0">New-Variable -Scope global -Name _OLD_VIRTUAL_PATH -Value $env:PATH</span>

<span class="s0">$env:PATH = &quot;$env:VIRTUAL_ENV/Scripts;&quot; + $env:PATH</span>
<span class="s0">if (!$env:VIRTUAL_ENV_DISABLE_PROMPT) {</span>
    <span class="s0">function global:_old_virtual_prompt {</span>
        <span class="s0">&quot;&quot;</span>
    <span class="s0">}</span>
    <span class="s0">$function:_old_virtual_prompt = $function:prompt</span>

    <span class="s0">if (&quot;&quot; -ne &quot;&quot;) {</span>
        <span class="s0">function global:prompt {</span>
            <span class="s0"># Add the custom prefix to the existing prompt</span>
            <span class="s0">$previous_prompt_value = &amp; $function:_old_virtual_prompt</span>
            <span class="s0">(&quot;&quot; + $previous_prompt_value)</span>
        <span class="s0">}</span>
    <span class="s0">}</span>
    <span class="s0">else {</span>
        <span class="s0">function global:prompt {</span>
            <span class="s0"># Add a prefix to the current prompt, but don't discard it.</span>
            <span class="s0">$previous_prompt_value = &amp; $function:_old_virtual_prompt</span>
            <span class="s0">$new_prompt_value = &quot;($( Split-Path $env:VIRTUAL_ENV -Leaf )) &quot;</span>
            <span class="s0">($new_prompt_value + $previous_prompt_value)</span>
        <span class="s0">}</span>
    <span class="s0">}</span>
<span class="s0">}</span>
</pre>
</body>
</html>