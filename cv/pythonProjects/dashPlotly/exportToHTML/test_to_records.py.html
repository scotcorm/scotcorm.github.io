<html>
<head>
<title>test_to_records.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_to_records.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">collections </span><span class="s0">import </span><span class="s1">abc</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">CategoricalDtype</span><span class="s0">,</span>
    <span class="s1">DataFrame</span><span class="s0">,</span>
    <span class="s1">MultiIndex</span><span class="s0">,</span>
    <span class="s1">Series</span><span class="s0">,</span>
    <span class="s1">Timestamp</span><span class="s0">,</span>
    <span class="s1">date_range</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">pandas._testing </span><span class="s0">as </span><span class="s1">tm</span>


<span class="s0">class </span><span class="s1">TestDataFrameToRecords:</span>
    <span class="s0">def </span><span class="s1">test_to_records_timeseries(self):</span>
        <span class="s1">index = date_range(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">10</span><span class="s1">)</span>
        <span class="s1">df = DataFrame(np.random.randn(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=index</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">])</span>

        <span class="s1">result = df.to_records()</span>
        <span class="s0">assert </span><span class="s1">result[</span><span class="s2">&quot;index&quot;</span><span class="s1">].dtype == </span><span class="s2">&quot;M8[ns]&quot;</span>

        <span class="s1">result = df.to_records(index=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_to_records_dt64(self):</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">[[</span><span class="s2">&quot;one&quot;</span><span class="s0">, </span><span class="s2">&quot;two&quot;</span><span class="s0">, </span><span class="s2">&quot;three&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;four&quot;</span><span class="s0">, </span><span class="s2">&quot;five&quot;</span><span class="s0">, </span><span class="s2">&quot;six&quot;</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">index=date_range(</span><span class="s2">&quot;2012-01-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2012-01-02&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>

        <span class="s1">expected = df.index.values[</span><span class="s3">0</span><span class="s1">]</span>
        <span class="s1">result = df.to_records()[</span><span class="s2">&quot;index&quot;</span><span class="s1">][</span><span class="s3">0</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">expected == result</span>

    <span class="s0">def </span><span class="s1">test_to_records_dt64tz_column(self):</span>
        <span class="s4"># GH#32535 dont less tz in to_records</span>
        <span class="s1">df = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: date_range(</span><span class="s2">&quot;2012-01-01&quot;</span><span class="s0">, </span><span class="s2">&quot;2012-01-02&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">)})</span>

        <span class="s1">result = df.to_records()</span>

        <span class="s0">assert </span><span class="s1">result.dtype[</span><span class="s2">&quot;A&quot;</span><span class="s1">] == object</span>
        <span class="s1">val = result[</span><span class="s3">0</span><span class="s1">][</span><span class="s3">1</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">isinstance(val</span><span class="s0">, </span><span class="s1">Timestamp)</span>
        <span class="s0">assert </span><span class="s1">val == df.loc[</span><span class="s3">0</span><span class="s0">, </span><span class="s2">&quot;A&quot;</span><span class="s1">]</span>

    <span class="s0">def </span><span class="s1">test_to_records_with_multindex(self):</span>
        <span class="s4"># GH#3189</span>
        <span class="s1">index = [</span>
            <span class="s1">[</span><span class="s2">&quot;bar&quot;</span><span class="s0">, </span><span class="s2">&quot;bar&quot;</span><span class="s0">, </span><span class="s2">&quot;baz&quot;</span><span class="s0">, </span><span class="s2">&quot;baz&quot;</span><span class="s0">, </span><span class="s2">&quot;foo&quot;</span><span class="s0">, </span><span class="s2">&quot;foo&quot;</span><span class="s0">, </span><span class="s2">&quot;qux&quot;</span><span class="s0">, </span><span class="s2">&quot;qux&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s2">&quot;one&quot;</span><span class="s0">, </span><span class="s2">&quot;two&quot;</span><span class="s0">, </span><span class="s2">&quot;one&quot;</span><span class="s0">, </span><span class="s2">&quot;two&quot;</span><span class="s0">, </span><span class="s2">&quot;one&quot;</span><span class="s0">, </span><span class="s2">&quot;two&quot;</span><span class="s0">, </span><span class="s2">&quot;one&quot;</span><span class="s0">, </span><span class="s2">&quot;two&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">]</span>
        <span class="s1">data = np.zeros((</span><span class="s3">8</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span>
        <span class="s1">df = DataFrame(data</span><span class="s0">, </span><span class="s1">index=index)</span>
        <span class="s1">r = df.to_records(index=</span><span class="s0">True</span><span class="s1">)[</span><span class="s2">&quot;level_0&quot;</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s2">&quot;bar&quot; </span><span class="s0">in </span><span class="s1">r</span>
        <span class="s0">assert </span><span class="s2">&quot;one&quot; </span><span class="s0">not in </span><span class="s1">r</span>

    <span class="s0">def </span><span class="s1">test_to_records_with_Mapping_type(self):</span>
        <span class="s0">import </span><span class="s1">email</span>
        <span class="s0">from </span><span class="s1">email.parser </span><span class="s0">import </span><span class="s1">Parser</span>

        <span class="s1">abc.Mapping.register(email.message.Message)</span>

        <span class="s1">headers = Parser().parsestr(</span>
            <span class="s2">&quot;From: &lt;user@example.com&gt;</span><span class="s0">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;To: &lt;someone_else@example.com&gt;</span><span class="s0">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Subject: Test message</span><span class="s0">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Body would go here</span><span class="s0">\n</span><span class="s2">&quot;</span>
        <span class="s1">)</span>

        <span class="s1">frame = DataFrame.from_records([headers])</span>
        <span class="s1">all(x </span><span class="s0">in </span><span class="s1">frame </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">[</span><span class="s2">&quot;Type&quot;</span><span class="s0">, </span><span class="s2">&quot;Subject&quot;</span><span class="s0">, </span><span class="s2">&quot;From&quot;</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_to_records_floats(self):</span>
        <span class="s1">df = DataFrame(np.random.rand(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">))</span>
        <span class="s1">df.to_records()</span>

    <span class="s0">def </span><span class="s1">test_to_records_index_name(self):</span>
        <span class="s1">df = DataFrame(np.random.randn(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">))</span>
        <span class="s1">df.index.name = </span><span class="s2">&quot;X&quot;</span>
        <span class="s1">rs = df.to_records()</span>
        <span class="s0">assert </span><span class="s2">&quot;X&quot; </span><span class="s0">in </span><span class="s1">rs.dtype.fields</span>

        <span class="s1">df = DataFrame(np.random.randn(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">))</span>
        <span class="s1">rs = df.to_records()</span>
        <span class="s0">assert </span><span class="s2">&quot;index&quot; </span><span class="s0">in </span><span class="s1">rs.dtype.fields</span>

        <span class="s1">df.index = MultiIndex.from_tuples([(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;x&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;y&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;z&quot;</span><span class="s1">)])</span>
        <span class="s1">df.index.names = [</span><span class="s2">&quot;A&quot;</span><span class="s0">, None</span><span class="s1">]</span>
        <span class="s1">result = df.to_records()</span>
        <span class="s1">expected = np.rec.fromarrays(</span>
            <span class="s1">[np.array([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">])</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s2">&quot;y&quot;</span><span class="s0">, </span><span class="s2">&quot;z&quot;</span><span class="s1">])]</span>
            <span class="s1">+ [np.asarray(df.iloc[:</span><span class="s0">, </span><span class="s1">i]) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">3</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">dtype={</span>
                <span class="s2">&quot;names&quot;</span><span class="s1">: [</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;level_1&quot;</span><span class="s0">, </span><span class="s2">&quot;0&quot;</span><span class="s0">, </span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s2">&quot;2&quot;</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;formats&quot;</span><span class="s1">: [</span><span class="s2">&quot;&lt;U1&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;U1&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;f8&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;f8&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;f8&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">}</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_numpy_array_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_to_records_with_unicode_index(self):</span>
        <span class="s4"># GH#13172</span>
        <span class="s4"># unicode_literals conflict with to_records</span>
        <span class="s1">result = DataFrame([{</span><span class="s2">&quot;a&quot;</span><span class="s1">: </span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: </span><span class="s2">&quot;y&quot;</span><span class="s1">}]).set_index(</span><span class="s2">&quot;a&quot;</span><span class="s1">).to_records()</span>
        <span class="s1">expected = np.rec.array([(</span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s2">&quot;y&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">dtype=[(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;O&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;O&quot;</span><span class="s1">)])</span>
        <span class="s1">tm.assert_almost_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_to_records_with_unicode_column_names(self):</span>
        <span class="s4"># xref issue: https://github.com/numpy/numpy/issues/2407</span>
        <span class="s4"># Issue GH#11879. to_records used to raise an exception when used</span>
        <span class="s4"># with column names containing non-ascii characters in Python 2</span>
        <span class="s1">result = DataFrame(data={</span><span class="s2">&quot;accented_name_é&quot;</span><span class="s1">: [</span><span class="s3">1.0</span><span class="s1">]}).to_records()</span>

        <span class="s4"># Note that numpy allows for unicode field names but dtypes need</span>
        <span class="s4"># to be specified using dictionary instead of list of tuples.</span>
        <span class="s1">expected = np.rec.array(</span>
            <span class="s1">[(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">dtype={</span><span class="s2">&quot;names&quot;</span><span class="s1">: [</span><span class="s2">&quot;index&quot;</span><span class="s0">, </span><span class="s2">&quot;accented_name_é&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;formats&quot;</span><span class="s1">: [</span><span class="s2">&quot;=i8&quot;</span><span class="s0">, </span><span class="s2">&quot;=f8&quot;</span><span class="s1">]}</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_almost_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_to_records_with_categorical(self):</span>
        <span class="s4"># GH#8626</span>

        <span class="s4"># dict creation</span>
        <span class="s1">df = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">)}</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;category&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Series(list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;category&quot;</span><span class="s0">, </span><span class="s1">name=</span><span class="s2">&quot;A&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(df[</span><span class="s2">&quot;A&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s4"># list-like creation</span>
        <span class="s1">df = DataFrame(list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;category&quot;</span><span class="s1">)</span>
        <span class="s1">expected = Series(list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;category&quot;</span><span class="s0">, </span><span class="s1">name=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(df[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s4"># to record array</span>
        <span class="s4"># this coerces</span>
        <span class="s1">result = df.to_records()</span>
        <span class="s1">expected = np.rec.array(</span>
            <span class="s1">[(</span><span class="s3">0</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">dtype=[(</span><span class="s2">&quot;index&quot;</span><span class="s0">, </span><span class="s2">&quot;=i8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;0&quot;</span><span class="s0">, </span><span class="s2">&quot;O&quot;</span><span class="s1">)]</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_almost_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;kwargs,expected&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s4"># No dtypes --&gt; default to array dtypes.</span>
            <span class="s1">(</span>
                <span class="s1">{}</span><span class="s0">,</span>
                <span class="s1">np.rec.array(</span>
                    <span class="s1">[(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1.5</span><span class="s0">, </span><span class="s2">&quot;bc&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                    <span class="s1">dtype=[(</span><span class="s2">&quot;index&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;i8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;i8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;f8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;O&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s4"># Should have no effect in this case.</span>
            <span class="s1">(</span>
                <span class="s1">{</span><span class="s2">&quot;index&quot;</span><span class="s1">: </span><span class="s0">True</span><span class="s1">}</span><span class="s0">,</span>
                <span class="s1">np.rec.array(</span>
                    <span class="s1">[(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1.5</span><span class="s0">, </span><span class="s2">&quot;bc&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                    <span class="s1">dtype=[(</span><span class="s2">&quot;index&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;i8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;i8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;f8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;O&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s4"># Column dtype applied across the board. Index unaffected.</span>
            <span class="s1">(</span>
                <span class="s1">{</span><span class="s2">&quot;column_dtypes&quot;</span><span class="s1">: </span><span class="s2">&quot;&lt;U4&quot;</span><span class="s1">}</span><span class="s0">,</span>
                <span class="s1">np.rec.array(</span>
                    <span class="s1">[(</span><span class="s2">&quot;0&quot;</span><span class="s0">, </span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s2">&quot;0.2&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s2">&quot;2&quot;</span><span class="s0">, </span><span class="s2">&quot;1.5&quot;</span><span class="s0">, </span><span class="s2">&quot;bc&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                    <span class="s1">dtype=[(</span><span class="s2">&quot;index&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;i8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;U4&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;U4&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;U4&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s4"># Index dtype applied across the board. Columns unaffected.</span>
            <span class="s1">(</span>
                <span class="s1">{</span><span class="s2">&quot;index_dtypes&quot;</span><span class="s1">: </span><span class="s2">&quot;&lt;U1&quot;</span><span class="s1">}</span><span class="s0">,</span>
                <span class="s1">np.rec.array(</span>
                    <span class="s1">[(</span><span class="s2">&quot;0&quot;</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1.5</span><span class="s0">, </span><span class="s2">&quot;bc&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                    <span class="s1">dtype=[(</span><span class="s2">&quot;index&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;U1&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;i8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;f8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;O&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s4"># Pass in a type instance.</span>
            <span class="s1">(</span>
                <span class="s1">{</span><span class="s2">&quot;column_dtypes&quot;</span><span class="s1">: str}</span><span class="s0">,</span>
                <span class="s1">np.rec.array(</span>
                    <span class="s1">[(</span><span class="s2">&quot;0&quot;</span><span class="s0">, </span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s2">&quot;0.2&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s2">&quot;2&quot;</span><span class="s0">, </span><span class="s2">&quot;1.5&quot;</span><span class="s0">, </span><span class="s2">&quot;bc&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                    <span class="s1">dtype=[(</span><span class="s2">&quot;index&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;i8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;U&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;U&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;U&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s4"># Pass in a dtype instance.</span>
            <span class="s1">(</span>
                <span class="s1">{</span><span class="s2">&quot;column_dtypes&quot;</span><span class="s1">: np.dtype(</span><span class="s2">&quot;unicode&quot;</span><span class="s1">)}</span><span class="s0">,</span>
                <span class="s1">np.rec.array(</span>
                    <span class="s1">[(</span><span class="s2">&quot;0&quot;</span><span class="s0">, </span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s2">&quot;0.2&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s2">&quot;2&quot;</span><span class="s0">, </span><span class="s2">&quot;1.5&quot;</span><span class="s0">, </span><span class="s2">&quot;bc&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                    <span class="s1">dtype=[(</span><span class="s2">&quot;index&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;i8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;U&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;U&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;U&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s4"># Pass in a dictionary (name-only).</span>
            <span class="s1">(</span>
                <span class="s1">{</span><span class="s2">&quot;column_dtypes&quot;</span><span class="s1">: {</span><span class="s2">&quot;A&quot;</span><span class="s1">: np.int8</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: np.float32</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s1">: </span><span class="s2">&quot;&lt;U2&quot;</span><span class="s1">}}</span><span class="s0">,</span>
                <span class="s1">np.rec.array(</span>
                    <span class="s1">[(</span><span class="s2">&quot;0&quot;</span><span class="s0">, </span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s2">&quot;0.2&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s2">&quot;2&quot;</span><span class="s0">, </span><span class="s2">&quot;1.5&quot;</span><span class="s0">, </span><span class="s2">&quot;bc&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                    <span class="s1">dtype=[(</span><span class="s2">&quot;index&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;i8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;i1&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;f4&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;U2&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s4"># Pass in a dictionary (indices-only).</span>
            <span class="s1">(</span>
                <span class="s1">{</span><span class="s2">&quot;index_dtypes&quot;</span><span class="s1">: {</span><span class="s3">0</span><span class="s1">: </span><span class="s2">&quot;int16&quot;</span><span class="s1">}}</span><span class="s0">,</span>
                <span class="s1">np.rec.array(</span>
                    <span class="s1">[(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1.5</span><span class="s0">, </span><span class="s2">&quot;bc&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                    <span class="s1">dtype=[(</span><span class="s2">&quot;index&quot;</span><span class="s0">, </span><span class="s2">&quot;i2&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;i8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;f8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;O&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s4"># Ignore index mappings if index is not True.</span>
            <span class="s1">(</span>
                <span class="s1">{</span><span class="s2">&quot;index&quot;</span><span class="s1">: </span><span class="s0">False, </span><span class="s2">&quot;index_dtypes&quot;</span><span class="s1">: </span><span class="s2">&quot;&lt;U2&quot;</span><span class="s1">}</span><span class="s0">,</span>
                <span class="s1">np.rec.array(</span>
                    <span class="s1">[(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1.5</span><span class="s0">, </span><span class="s2">&quot;bc&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                    <span class="s1">dtype=[(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;i8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;f8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;O&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s4"># Non-existent names / indices in mapping should not error.</span>
            <span class="s1">(</span>
                <span class="s1">{</span><span class="s2">&quot;index_dtypes&quot;</span><span class="s1">: {</span><span class="s3">0</span><span class="s1">: </span><span class="s2">&quot;int16&quot;</span><span class="s0">, </span><span class="s2">&quot;not-there&quot;</span><span class="s1">: </span><span class="s2">&quot;float32&quot;</span><span class="s1">}}</span><span class="s0">,</span>
                <span class="s1">np.rec.array(</span>
                    <span class="s1">[(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1.5</span><span class="s0">, </span><span class="s2">&quot;bc&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                    <span class="s1">dtype=[(</span><span class="s2">&quot;index&quot;</span><span class="s0">, </span><span class="s2">&quot;i2&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;i8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;f8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;O&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s4"># Names / indices not in mapping default to array dtype.</span>
            <span class="s1">(</span>
                <span class="s1">{</span><span class="s2">&quot;column_dtypes&quot;</span><span class="s1">: {</span><span class="s2">&quot;A&quot;</span><span class="s1">: np.int8</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: np.float32}}</span><span class="s0">,</span>
                <span class="s1">np.rec.array(</span>
                    <span class="s1">[(</span><span class="s2">&quot;0&quot;</span><span class="s0">, </span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s2">&quot;0.2&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s2">&quot;2&quot;</span><span class="s0">, </span><span class="s2">&quot;1.5&quot;</span><span class="s0">, </span><span class="s2">&quot;bc&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                    <span class="s1">dtype=[(</span><span class="s2">&quot;index&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;i8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;i1&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;f4&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;O&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s4"># Names / indices not in dtype mapping default to array dtype.</span>
            <span class="s1">(</span>
                <span class="s1">{</span><span class="s2">&quot;column_dtypes&quot;</span><span class="s1">: {</span><span class="s2">&quot;A&quot;</span><span class="s1">: np.dtype(</span><span class="s2">&quot;int8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: np.dtype(</span><span class="s2">&quot;float32&quot;</span><span class="s1">)}}</span><span class="s0">,</span>
                <span class="s1">np.rec.array(</span>
                    <span class="s1">[(</span><span class="s2">&quot;0&quot;</span><span class="s0">, </span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s2">&quot;0.2&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s2">&quot;2&quot;</span><span class="s0">, </span><span class="s2">&quot;1.5&quot;</span><span class="s0">, </span><span class="s2">&quot;bc&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                    <span class="s1">dtype=[(</span><span class="s2">&quot;index&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;i8&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;i1&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;f4&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;O&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s4"># Mixture of everything.</span>
            <span class="s1">(</span>
                <span class="s1">{</span>
                    <span class="s2">&quot;column_dtypes&quot;</span><span class="s1">: {</span><span class="s2">&quot;A&quot;</span><span class="s1">: np.int8</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: np.float32}</span><span class="s0">,</span>
                    <span class="s2">&quot;index_dtypes&quot;</span><span class="s1">: </span><span class="s2">&quot;&lt;U2&quot;</span><span class="s0">,</span>
                <span class="s1">}</span><span class="s0">,</span>
                <span class="s1">np.rec.array(</span>
                    <span class="s1">[(</span><span class="s2">&quot;0&quot;</span><span class="s0">, </span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s2">&quot;0.2&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s2">&quot;2&quot;</span><span class="s0">, </span><span class="s2">&quot;1.5&quot;</span><span class="s0">, </span><span class="s2">&quot;bc&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                    <span class="s1">dtype=[(</span><span class="s2">&quot;index&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;U2&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;i1&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;f4&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;O&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s4"># Invalid dype values.</span>
            <span class="s1">(</span>
                <span class="s1">{</span><span class="s2">&quot;index&quot;</span><span class="s1">: </span><span class="s0">False, </span><span class="s2">&quot;column_dtypes&quot;</span><span class="s1">: []}</span><span class="s0">,</span>
                <span class="s1">(ValueError</span><span class="s0">, </span><span class="s2">&quot;Invalid dtype </span><span class="s0">\\</span><span class="s2">[</span><span class="s0">\\</span><span class="s2">] specified for column A&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span>
                <span class="s1">{</span><span class="s2">&quot;index&quot;</span><span class="s1">: </span><span class="s0">False, </span><span class="s2">&quot;column_dtypes&quot;</span><span class="s1">: {</span><span class="s2">&quot;A&quot;</span><span class="s1">: </span><span class="s2">&quot;int32&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: </span><span class="s3">5</span><span class="s1">}}</span><span class="s0">,</span>
                <span class="s1">(ValueError</span><span class="s0">, </span><span class="s2">&quot;Invalid dtype 5 specified for column B&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s4"># Numpy can't handle EA types, so check error is raised</span>
            <span class="s1">(</span>
                <span class="s1">{</span>
                    <span class="s2">&quot;index&quot;</span><span class="s1">: </span><span class="s0">False,</span>
                    <span class="s2">&quot;column_dtypes&quot;</span><span class="s1">: {</span><span class="s2">&quot;A&quot;</span><span class="s1">: </span><span class="s2">&quot;int32&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: CategoricalDtype([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">])}</span><span class="s0">,</span>
                <span class="s1">}</span><span class="s0">,</span>
                <span class="s1">(ValueError</span><span class="s0">, </span><span class="s2">&quot;Invalid dtype category specified for column B&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s4"># Check that bad types raise</span>
            <span class="s1">(</span>
                <span class="s1">{</span><span class="s2">&quot;index&quot;</span><span class="s1">: </span><span class="s0">False, </span><span class="s2">&quot;column_dtypes&quot;</span><span class="s1">: {</span><span class="s2">&quot;A&quot;</span><span class="s1">: </span><span class="s2">&quot;int32&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: </span><span class="s2">&quot;foo&quot;</span><span class="s1">}}</span><span class="s0">,</span>
                <span class="s1">(TypeError</span><span class="s0">, </span><span class="s2">&quot;data type [</span><span class="s0">\&quot;</span><span class="s2">']foo[</span><span class="s0">\&quot;</span><span class="s2">'] not understood&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_to_records_dtype(self</span><span class="s0">, </span><span class="s1">kwargs</span><span class="s0">, </span><span class="s1">expected):</span>
        <span class="s4"># see GH#18146</span>
        <span class="s1">df = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: [</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">1.5</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s1">: [</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;bc&quot;</span><span class="s1">]})</span>

        <span class="s0">if not </span><span class="s1">isinstance(expected</span><span class="s0">, </span><span class="s1">np.recarray):</span>
            <span class="s0">with </span><span class="s1">pytest.raises(expected[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">match=expected[</span><span class="s3">1</span><span class="s1">]):</span>
                <span class="s1">df.to_records(**kwargs)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">result = df.to_records(**kwargs)</span>
            <span class="s1">tm.assert_almost_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;df,kwargs,expected&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s4"># MultiIndex in the index.</span>
            <span class="s1">(</span>
                <span class="s1">DataFrame(</span>
                    <span class="s1">[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">9</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">columns=list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">)</span>
                <span class="s1">).set_index([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">])</span><span class="s0">,</span>
                <span class="s1">{</span><span class="s2">&quot;column_dtypes&quot;</span><span class="s1">: </span><span class="s2">&quot;float64&quot;</span><span class="s0">, </span><span class="s2">&quot;index_dtypes&quot;</span><span class="s1">: {</span><span class="s3">0</span><span class="s1">: </span><span class="s2">&quot;int32&quot;</span><span class="s0">, </span><span class="s3">1</span><span class="s1">: </span><span class="s2">&quot;int8&quot;</span><span class="s1">}}</span><span class="s0">,</span>
                <span class="s1">np.rec.array(</span>
                    <span class="s1">[(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">9.0</span><span class="s1">)]</span><span class="s0">,</span>
                    <span class="s1">dtype=[(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;i4&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;i1&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;f8&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s4"># MultiIndex in the columns.</span>
            <span class="s1">(</span>
                <span class="s1">DataFrame(</span>
                    <span class="s1">[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">9</span><span class="s1">]]</span><span class="s0">,</span>
                    <span class="s1">columns=MultiIndex.from_tuples(</span>
                        <span class="s1">[(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;e&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;f&quot;</span><span class="s1">)]</span>
                    <span class="s1">)</span><span class="s0">,</span>
                <span class="s1">)</span><span class="s0">,</span>
                <span class="s1">{</span><span class="s2">&quot;column_dtypes&quot;</span><span class="s1">: {</span><span class="s3">0</span><span class="s1">: </span><span class="s2">&quot;&lt;U1&quot;</span><span class="s0">, </span><span class="s3">2</span><span class="s1">: </span><span class="s2">&quot;float32&quot;</span><span class="s1">}</span><span class="s0">, </span><span class="s2">&quot;index_dtypes&quot;</span><span class="s1">: </span><span class="s2">&quot;float32&quot;</span><span class="s1">}</span><span class="s0">,</span>
                <span class="s1">np.rec.array(</span>
                    <span class="s1">[(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1.0</span><span class="s0">, </span><span class="s2">&quot;4&quot;</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2.0</span><span class="s0">, </span><span class="s2">&quot;7&quot;</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">9.0</span><span class="s1">)]</span><span class="s0">,</span>
                    <span class="s1">dtype=[</span>
                        <span class="s1">(</span><span class="s2">&quot;index&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;f4&quot;</span><span class="s1">)</span><span class="s0">,</span>
                        <span class="s1">(</span><span class="s2">&quot;('a', 'd')&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;U1&quot;</span><span class="s1">)</span><span class="s0">,</span>
                        <span class="s1">(</span><span class="s2">&quot;('b', 'e')&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;i8&quot;</span><span class="s1">)</span><span class="s0">,</span>
                        <span class="s1">(</span><span class="s2">&quot;('c', 'f')&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;f4&quot;</span><span class="s1">)</span><span class="s0">,</span>
                    <span class="s1">]</span><span class="s0">,</span>
                <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s4"># MultiIndex in both the columns and index.</span>
            <span class="s1">(</span>
                <span class="s1">DataFrame(</span>
                    <span class="s1">[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">9</span><span class="s1">]]</span><span class="s0">,</span>
                    <span class="s1">columns=MultiIndex.from_tuples(</span>
                        <span class="s1">[(</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;e&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;f&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">names=list(</span><span class="s2">&quot;ab&quot;</span><span class="s1">)</span>
                    <span class="s1">)</span><span class="s0">,</span>
                    <span class="s1">index=MultiIndex.from_tuples(</span>
                        <span class="s1">[(</span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s1">-</span><span class="s3">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s1">-</span><span class="s3">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;f&quot;</span><span class="s0">, </span><span class="s1">-</span><span class="s3">6</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">names=list(</span><span class="s2">&quot;cd&quot;</span><span class="s1">)</span>
                    <span class="s1">)</span><span class="s0">,</span>
                <span class="s1">)</span><span class="s0">,</span>
                <span class="s1">{</span><span class="s2">&quot;column_dtypes&quot;</span><span class="s1">: </span><span class="s2">&quot;float64&quot;</span><span class="s0">, </span><span class="s2">&quot;index_dtypes&quot;</span><span class="s1">: {</span><span class="s3">0</span><span class="s1">: </span><span class="s2">&quot;&lt;U2&quot;</span><span class="s0">, </span><span class="s3">1</span><span class="s1">: </span><span class="s2">&quot;int8&quot;</span><span class="s1">}}</span><span class="s0">,</span>
                <span class="s1">np.rec.array(</span>
                    <span class="s1">[</span>
                        <span class="s1">(</span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s1">-</span><span class="s3">4</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2.0</span><span class="s0">, </span><span class="s3">3.0</span><span class="s1">)</span><span class="s0">,</span>
                        <span class="s1">(</span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s1">-</span><span class="s3">5</span><span class="s0">, </span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">5.0</span><span class="s0">, </span><span class="s3">6.0</span><span class="s1">)</span><span class="s0">,</span>
                        <span class="s1">(</span><span class="s2">&quot;f&quot;</span><span class="s0">, </span><span class="s1">-</span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">9.0</span><span class="s1">)</span><span class="s0">,</span>
                    <span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">dtype=[</span>
                        <span class="s1">(</span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;U2&quot;</span><span class="s1">)</span><span class="s0">,</span>
                        <span class="s1">(</span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s2">&quot;i1&quot;</span><span class="s1">)</span><span class="s0">,</span>
                        <span class="s1">(</span><span class="s2">&quot;('a', 'd')&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;f8&quot;</span><span class="s1">)</span><span class="s0">,</span>
                        <span class="s1">(</span><span class="s2">&quot;('b', 'e')&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;f8&quot;</span><span class="s1">)</span><span class="s0">,</span>
                        <span class="s1">(</span><span class="s2">&quot;('c', 'f')&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;f8&quot;</span><span class="s1">)</span><span class="s0">,</span>
                    <span class="s1">]</span><span class="s0">,</span>
                <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_to_records_dtype_mi(self</span><span class="s0">, </span><span class="s1">df</span><span class="s0">, </span><span class="s1">kwargs</span><span class="s0">, </span><span class="s1">expected):</span>
        <span class="s4"># see GH#18146</span>
        <span class="s1">result = df.to_records(**kwargs)</span>
        <span class="s1">tm.assert_almost_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_to_records_dict_like(self):</span>
        <span class="s4"># see GH#18146</span>
        <span class="s0">class </span><span class="s1">DictLike:</span>
            <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">**kwargs):</span>
                <span class="s1">self.d = kwargs.copy()</span>

            <span class="s0">def </span><span class="s1">__getitem__(self</span><span class="s0">, </span><span class="s1">key):</span>
                <span class="s0">return </span><span class="s1">self.d.__getitem__(key)</span>

            <span class="s0">def </span><span class="s1">__contains__(self</span><span class="s0">, </span><span class="s1">key) -&gt; bool:</span>
                <span class="s0">return </span><span class="s1">key </span><span class="s0">in </span><span class="s1">self.d</span>

            <span class="s0">def </span><span class="s1">keys(self):</span>
                <span class="s0">return </span><span class="s1">self.d.keys()</span>

        <span class="s1">df = DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: [</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">1.5</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s1">: [</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;bc&quot;</span><span class="s1">]})</span>

        <span class="s1">dtype_mappings = {</span>
            <span class="s2">&quot;column_dtypes&quot;</span><span class="s1">: DictLike(**{</span><span class="s2">&quot;A&quot;</span><span class="s1">: np.int8</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: np.float32})</span><span class="s0">,</span>
            <span class="s2">&quot;index_dtypes&quot;</span><span class="s1">: </span><span class="s2">&quot;&lt;U2&quot;</span><span class="s0">,</span>
        <span class="s1">}</span>

        <span class="s1">result = df.to_records(**dtype_mappings)</span>
        <span class="s1">expected = np.rec.array(</span>
            <span class="s1">[(</span><span class="s2">&quot;0&quot;</span><span class="s0">, </span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s2">&quot;0.2&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;1&quot;</span><span class="s0">, </span><span class="s2">&quot;2&quot;</span><span class="s0">, </span><span class="s2">&quot;1.5&quot;</span><span class="s0">, </span><span class="s2">&quot;bc&quot;</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">dtype=[(</span><span class="s2">&quot;index&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;U2&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;i1&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;&lt;f4&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;O&quot;</span><span class="s1">)]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_almost_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;tz&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;UTC&quot;</span><span class="s0">, </span><span class="s2">&quot;GMT&quot;</span><span class="s0">, </span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_to_records_datetimeindex_with_tz(self</span><span class="s0">, </span><span class="s1">tz):</span>
        <span class="s4"># GH#13937</span>
        <span class="s1">dr = date_range(</span><span class="s2">&quot;2016-01-01&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">10</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;S&quot;</span><span class="s0">, </span><span class="s1">tz=tz)</span>

        <span class="s1">df = DataFrame({</span><span class="s2">&quot;datetime&quot;</span><span class="s1">: dr}</span><span class="s0">, </span><span class="s1">index=dr)</span>

        <span class="s1">expected = df.to_records()</span>
        <span class="s1">result = df.tz_convert(</span><span class="s2">&quot;UTC&quot;</span><span class="s1">).to_records()</span>

        <span class="s4"># both converted to UTC, so they are equal</span>
        <span class="s1">tm.assert_numpy_array_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
</pre>
</body>
</html>