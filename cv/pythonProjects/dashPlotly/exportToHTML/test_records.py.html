<html>
<head>
<title>test_records.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #6a8759;}
.s4 { color: #629755; font-style: italic;}
.s5 { color: #808080;}
.s6 { color: #a5c261;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_records.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">collections.abc</span>
<span class="s0">import </span><span class="s1">textwrap</span>
<span class="s0">from </span><span class="s1">io </span><span class="s0">import </span><span class="s1">BytesIO</span>
<span class="s0">from </span><span class="s1">os </span><span class="s0">import </span><span class="s1">path</span>
<span class="s0">from </span><span class="s1">pathlib </span><span class="s0">import </span><span class="s1">Path</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy.testing </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">assert_</span><span class="s0">, </span><span class="s1">assert_equal</span><span class="s0">, </span><span class="s1">assert_array_equal</span><span class="s0">, </span><span class="s1">assert_array_almost_equal</span><span class="s0">,</span>
    <span class="s1">assert_raises</span><span class="s0">, </span><span class="s1">temppath</span><span class="s0">,</span>
    <span class="s1">)</span>
<span class="s0">from </span><span class="s1">numpy.compat </span><span class="s0">import </span><span class="s1">pickle</span>


<span class="s0">class </span><span class="s1">TestFromrecords:</span>
    <span class="s0">def </span><span class="s1">test_fromrecords(self):</span>
        <span class="s1">r = np.rec.fromrecords([[</span><span class="s2">456</span><span class="s0">, </span><span class="s3">'dbe'</span><span class="s0">, </span><span class="s2">1.2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s3">'de'</span><span class="s0">, </span><span class="s2">1.3</span><span class="s1">]]</span><span class="s0">,</span>
                            <span class="s1">names=</span><span class="s3">'col1,col2,col3'</span><span class="s1">)</span>
        <span class="s1">assert_equal(r[</span><span class="s2">0</span><span class="s1">].item()</span><span class="s0">, </span><span class="s1">(</span><span class="s2">456</span><span class="s0">, </span><span class="s3">'dbe'</span><span class="s0">, </span><span class="s2">1.2</span><span class="s1">))</span>
        <span class="s1">assert_equal(r[</span><span class="s3">'col1'</span><span class="s1">].dtype.kind</span><span class="s0">, </span><span class="s3">'i'</span><span class="s1">)</span>
        <span class="s1">assert_equal(r[</span><span class="s3">'col2'</span><span class="s1">].dtype.kind</span><span class="s0">, </span><span class="s3">'U'</span><span class="s1">)</span>
        <span class="s1">assert_equal(r[</span><span class="s3">'col2'</span><span class="s1">].dtype.itemsize</span><span class="s0">, </span><span class="s2">12</span><span class="s1">)</span>
        <span class="s1">assert_equal(r[</span><span class="s3">'col3'</span><span class="s1">].dtype.kind</span><span class="s0">, </span><span class="s3">'f'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_fromrecords_0len(self):</span>
        <span class="s4">&quot;&quot;&quot; Verify fromrecords works with a 0-length input &quot;&quot;&quot;</span>
        <span class="s1">dtype = [(</span><span class="s3">'a'</span><span class="s0">, </span><span class="s1">float)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'b'</span><span class="s0">, </span><span class="s1">float)]</span>
        <span class="s1">r = np.rec.fromrecords([]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
        <span class="s1">assert_equal(r.shape</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">,</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_fromrecords_2d(self):</span>
        <span class="s1">data = [</span>
            <span class="s1">[(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">[(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)]</span>
        <span class="s1">]</span>
        <span class="s1">expected_a = [[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">6</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]]</span>
        <span class="s1">expected_b = [[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]</span>

        <span class="s5"># try with dtype</span>
        <span class="s1">r1 = np.rec.fromrecords(data</span><span class="s0">, </span><span class="s1">dtype=[(</span><span class="s3">'a'</span><span class="s0">, </span><span class="s1">int)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'b'</span><span class="s0">, </span><span class="s1">int)])</span>
        <span class="s1">assert_equal(r1[</span><span class="s3">'a'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected_a)</span>
        <span class="s1">assert_equal(r1[</span><span class="s3">'b'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected_b)</span>

        <span class="s5"># try with names</span>
        <span class="s1">r2 = np.rec.fromrecords(data</span><span class="s0">, </span><span class="s1">names=[</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">])</span>
        <span class="s1">assert_equal(r2[</span><span class="s3">'a'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected_a)</span>
        <span class="s1">assert_equal(r2[</span><span class="s3">'b'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">expected_b)</span>

        <span class="s1">assert_equal(r1</span><span class="s0">, </span><span class="s1">r2)</span>

    <span class="s0">def </span><span class="s1">test_method_array(self):</span>
        <span class="s1">r = np.rec.array(</span><span class="s6">b'abcdefg' </span><span class="s1">* </span><span class="s2">100</span><span class="s0">, </span><span class="s1">formats=</span><span class="s3">'i2,a3,i4'</span><span class="s0">, </span><span class="s1">shape=</span><span class="s2">3</span><span class="s0">, </span><span class="s1">byteorder=</span><span class="s3">'big'</span><span class="s1">)</span>
        <span class="s1">assert_equal(r[</span><span class="s2">1</span><span class="s1">].item()</span><span class="s0">, </span><span class="s1">(</span><span class="s2">25444</span><span class="s0">, </span><span class="s6">b'efg'</span><span class="s0">, </span><span class="s2">1633837924</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_method_array2(self):</span>
        <span class="s1">r = np.rec.array([(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s3">'a'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">22</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">33</span><span class="s0">, </span><span class="s3">'c'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">44</span><span class="s0">, </span><span class="s3">'d'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">5</span><span class="s0">, </span><span class="s2">55</span><span class="s0">, </span><span class="s3">'ex'</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">66</span><span class="s0">, </span><span class="s3">'f'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">7</span><span class="s0">, </span><span class="s2">77</span><span class="s0">, </span><span class="s3">'g'</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">formats=</span><span class="s3">'u1,f4,a1'</span><span class="s1">)</span>
        <span class="s1">assert_equal(r[</span><span class="s2">1</span><span class="s1">].item()</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">22.0</span><span class="s0">, </span><span class="s6">b'b'</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_recarray_slices(self):</span>
        <span class="s1">r = np.rec.array([(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s3">'a'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">22</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">33</span><span class="s0">, </span><span class="s3">'c'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">44</span><span class="s0">, </span><span class="s3">'d'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">5</span><span class="s0">, </span><span class="s2">55</span><span class="s0">, </span><span class="s3">'ex'</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">66</span><span class="s0">, </span><span class="s3">'f'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">7</span><span class="s0">, </span><span class="s2">77</span><span class="s0">, </span><span class="s3">'g'</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">formats=</span><span class="s3">'u1,f4,a1'</span><span class="s1">)</span>
        <span class="s1">assert_equal(r[</span><span class="s2">1</span><span class="s1">::</span><span class="s2">2</span><span class="s1">][</span><span class="s2">1</span><span class="s1">].item()</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">44.0</span><span class="s0">, </span><span class="s6">b'd'</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_recarray_fromarrays(self):</span>
        <span class="s1">x1 = np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">])</span>
        <span class="s1">x2 = np.array([</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'dd'</span><span class="s0">, </span><span class="s3">'xyz'</span><span class="s0">, </span><span class="s3">'12'</span><span class="s1">])</span>
        <span class="s1">x3 = np.array([</span><span class="s2">1.1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">])</span>
        <span class="s1">r = np.rec.fromarrays([x1</span><span class="s0">, </span><span class="s1">x2</span><span class="s0">, </span><span class="s1">x3]</span><span class="s0">, </span><span class="s1">names=</span><span class="s3">'a,b,c'</span><span class="s1">)</span>
        <span class="s1">assert_equal(r[</span><span class="s2">1</span><span class="s1">].item()</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s3">'dd'</span><span class="s0">, </span><span class="s2">2.0</span><span class="s1">))</span>
        <span class="s1">x1[</span><span class="s2">1</span><span class="s1">] = </span><span class="s2">34</span>
        <span class="s1">assert_equal(r.a</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]))</span>

    <span class="s0">def </span><span class="s1">test_recarray_fromfile(self):</span>
        <span class="s1">data_dir = path.join(path.dirname(__file__)</span><span class="s0">, </span><span class="s3">'data'</span><span class="s1">)</span>
        <span class="s1">filename = path.join(data_dir</span><span class="s0">, </span><span class="s3">'recarray_from_file.fits'</span><span class="s1">)</span>
        <span class="s1">fd = open(filename</span><span class="s0">, </span><span class="s3">'rb'</span><span class="s1">)</span>
        <span class="s1">fd.seek(</span><span class="s2">2880 </span><span class="s1">* </span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">r1 = np.rec.fromfile(fd</span><span class="s0">, </span><span class="s1">formats=</span><span class="s3">'f8,i4,a5'</span><span class="s0">, </span><span class="s1">shape=</span><span class="s2">3</span><span class="s0">, </span><span class="s1">byteorder=</span><span class="s3">'big'</span><span class="s1">)</span>
        <span class="s1">fd.seek(</span><span class="s2">2880 </span><span class="s1">* </span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">r2 = np.rec.array(fd</span><span class="s0">, </span><span class="s1">formats=</span><span class="s3">'f8,i4,a5'</span><span class="s0">, </span><span class="s1">shape=</span><span class="s2">3</span><span class="s0">, </span><span class="s1">byteorder=</span><span class="s3">'big'</span><span class="s1">)</span>
        <span class="s1">fd.seek(</span><span class="s2">2880 </span><span class="s1">* </span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">bytes_array = BytesIO()</span>
        <span class="s1">bytes_array.write(fd.read())</span>
        <span class="s1">bytes_array.seek(</span><span class="s2">0</span><span class="s1">)</span>
        <span class="s1">r3 = np.rec.fromfile(bytes_array</span><span class="s0">, </span><span class="s1">formats=</span><span class="s3">'f8,i4,a5'</span><span class="s0">, </span><span class="s1">shape=</span><span class="s2">3</span><span class="s0">, </span><span class="s1">byteorder=</span><span class="s3">'big'</span><span class="s1">)</span>
        <span class="s1">fd.close()</span>
        <span class="s1">assert_equal(r1</span><span class="s0">, </span><span class="s1">r2)</span>
        <span class="s1">assert_equal(r2</span><span class="s0">, </span><span class="s1">r3)</span>

    <span class="s0">def </span><span class="s1">test_recarray_from_obj(self):</span>
        <span class="s1">count = </span><span class="s2">10</span>
        <span class="s1">a = np.zeros(count</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">'O'</span><span class="s1">)</span>
        <span class="s1">b = np.zeros(count</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">'f8'</span><span class="s1">)</span>
        <span class="s1">c = np.zeros(count</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">'f8'</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(len(a)):</span>
            <span class="s1">a[i] = list(range(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">10</span><span class="s1">))</span>

        <span class="s1">mine = np.rec.fromarrays([a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">c]</span><span class="s0">, </span><span class="s1">names=</span><span class="s3">'date,data1,data2'</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(len(a)):</span>
            <span class="s1">assert_((mine.date[i] == list(range(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">10</span><span class="s1">))))</span>
            <span class="s1">assert_((mine.data1[i] == </span><span class="s2">0.0</span><span class="s1">))</span>
            <span class="s1">assert_((mine.data2[i] == </span><span class="s2">0.0</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_recarray_repr(self):</span>
        <span class="s1">a = np.array([(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0.1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">0.2</span><span class="s1">)]</span><span class="s0">,</span>
                     <span class="s1">dtype=[(</span><span class="s3">'foo'</span><span class="s0">, </span><span class="s3">'&lt;i4'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'bar'</span><span class="s0">, </span><span class="s3">'&lt;f8'</span><span class="s1">)])</span>
        <span class="s1">a = np.rec.array(a)</span>
        <span class="s1">assert_equal(</span>
            <span class="s1">repr(a)</span><span class="s0">,</span>
            <span class="s1">textwrap.dedent(</span><span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s3">rec.array([(1, 0.1), (2, 0.2)], 
                      dtype=[('foo', '&lt;i4'), ('bar', '&lt;f8')])&quot;&quot;&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>

        <span class="s5"># make sure non-structured dtypes also show up as rec.array</span>
        <span class="s1">a = np.array(np.ones(</span><span class="s2">4</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">'f8'</span><span class="s1">))</span>
        <span class="s1">assert_(repr(np.rec.array(a)).startswith(</span><span class="s3">'rec.array'</span><span class="s1">))</span>

        <span class="s5"># check that the 'np.record' part of the dtype isn't shown</span>
        <span class="s1">a = np.rec.array(np.ones(</span><span class="s2">3</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">'i4,i4'</span><span class="s1">))</span>
        <span class="s1">assert_equal(repr(a).find(</span><span class="s3">'numpy.record'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">a = np.rec.array(np.ones(</span><span class="s2">3</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">'i4'</span><span class="s1">))</span>
        <span class="s1">assert_(repr(a).find(</span><span class="s3">'dtype=int32'</span><span class="s1">) != -</span><span class="s2">1</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_0d_recarray_repr(self):</span>
        <span class="s1">arr_0d = np.rec.array((</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2.0</span><span class="s0">, </span><span class="s3">'2003'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">'&lt;i4,&lt;f8,&lt;M8[Y]'</span><span class="s1">)</span>
        <span class="s1">assert_equal(repr(arr_0d)</span><span class="s0">, </span><span class="s1">textwrap.dedent(</span><span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s3">rec.array((1, 2., '2003'), 
                      dtype=[('f0', '&lt;i4'), ('f1', '&lt;f8'), ('f2', '&lt;M8[Y]')])&quot;&quot;&quot;</span><span class="s1">))</span>

        <span class="s1">record = arr_0d[()]</span>
        <span class="s1">assert_equal(repr(record)</span><span class="s0">, </span><span class="s3">&quot;(1, 2., '2003')&quot;</span><span class="s1">)</span>
        <span class="s5"># 1.13 converted to python scalars before the repr</span>
        <span class="s0">try</span><span class="s1">:</span>
            <span class="s1">np.set_printoptions(legacy=</span><span class="s3">'1.13'</span><span class="s1">)</span>
            <span class="s1">assert_equal(repr(record)</span><span class="s0">, </span><span class="s3">'(1, 2.0, datetime.date(2003, 1, 1))'</span><span class="s1">)</span>
        <span class="s0">finally</span><span class="s1">:</span>
            <span class="s1">np.set_printoptions(legacy=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_recarray_from_repr(self):</span>
        <span class="s1">a = np.array([(</span><span class="s2">1</span><span class="s0">,</span><span class="s3">'ABC'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s3">&quot;DEF&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                     <span class="s1">dtype=[(</span><span class="s3">'foo'</span><span class="s0">, </span><span class="s1">int)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'bar'</span><span class="s0">, </span><span class="s3">'S4'</span><span class="s1">)])</span>
        <span class="s1">recordarr = np.rec.array(a)</span>
        <span class="s1">recarr = a.view(np.recarray)</span>
        <span class="s1">recordview = a.view(np.dtype((np.record</span><span class="s0">, </span><span class="s1">a.dtype)))</span>

        <span class="s1">recordarr_r = eval(</span><span class="s3">&quot;numpy.&quot; </span><span class="s1">+ repr(recordarr)</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'numpy'</span><span class="s1">: np})</span>
        <span class="s1">recarr_r = eval(</span><span class="s3">&quot;numpy.&quot; </span><span class="s1">+ repr(recarr)</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'numpy'</span><span class="s1">: np})</span>
        <span class="s1">recordview_r = eval(</span><span class="s3">&quot;numpy.&quot; </span><span class="s1">+ repr(recordview)</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'numpy'</span><span class="s1">: np})</span>

        <span class="s1">assert_equal(type(recordarr_r)</span><span class="s0">, </span><span class="s1">np.recarray)</span>
        <span class="s1">assert_equal(recordarr_r.dtype.type</span><span class="s0">, </span><span class="s1">np.record)</span>
        <span class="s1">assert_equal(recordarr</span><span class="s0">, </span><span class="s1">recordarr_r)</span>

        <span class="s1">assert_equal(type(recarr_r)</span><span class="s0">, </span><span class="s1">np.recarray)</span>
        <span class="s1">assert_equal(recarr_r.dtype.type</span><span class="s0">, </span><span class="s1">np.record)</span>
        <span class="s1">assert_equal(recarr</span><span class="s0">, </span><span class="s1">recarr_r)</span>

        <span class="s1">assert_equal(type(recordview_r)</span><span class="s0">, </span><span class="s1">np.ndarray)</span>
        <span class="s1">assert_equal(recordview.dtype.type</span><span class="s0">, </span><span class="s1">np.record)</span>
        <span class="s1">assert_equal(recordview</span><span class="s0">, </span><span class="s1">recordview_r)</span>

    <span class="s0">def </span><span class="s1">test_recarray_views(self):</span>
        <span class="s1">a = np.array([(</span><span class="s2">1</span><span class="s0">,</span><span class="s3">'ABC'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s3">&quot;DEF&quot;</span><span class="s1">)]</span><span class="s0">,</span>
                     <span class="s1">dtype=[(</span><span class="s3">'foo'</span><span class="s0">, </span><span class="s1">int)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'bar'</span><span class="s0">, </span><span class="s3">'S4'</span><span class="s1">)])</span>
        <span class="s1">b = np.array([</span><span class="s2">1</span><span class="s0">,</span><span class="s2">2</span><span class="s0">,</span><span class="s2">3</span><span class="s0">,</span><span class="s2">4</span><span class="s0">,</span><span class="s2">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.int64)</span>

        <span class="s5">#check that np.rec.array gives right dtypes</span>
        <span class="s1">assert_equal(np.rec.array(a).dtype.type</span><span class="s0">, </span><span class="s1">np.record)</span>
        <span class="s1">assert_equal(type(np.rec.array(a))</span><span class="s0">, </span><span class="s1">np.recarray)</span>
        <span class="s1">assert_equal(np.rec.array(b).dtype.type</span><span class="s0">, </span><span class="s1">np.int64)</span>
        <span class="s1">assert_equal(type(np.rec.array(b))</span><span class="s0">, </span><span class="s1">np.recarray)</span>

        <span class="s5">#check that viewing as recarray does the same</span>
        <span class="s1">assert_equal(a.view(np.recarray).dtype.type</span><span class="s0">, </span><span class="s1">np.record)</span>
        <span class="s1">assert_equal(type(a.view(np.recarray))</span><span class="s0">, </span><span class="s1">np.recarray)</span>
        <span class="s1">assert_equal(b.view(np.recarray).dtype.type</span><span class="s0">, </span><span class="s1">np.int64)</span>
        <span class="s1">assert_equal(type(b.view(np.recarray))</span><span class="s0">, </span><span class="s1">np.recarray)</span>

        <span class="s5">#check that view to non-structured dtype preserves type=np.recarray</span>
        <span class="s1">r = np.rec.array(np.ones(</span><span class="s2">4</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;f4,i4&quot;</span><span class="s1">))</span>
        <span class="s1">rv = r.view(</span><span class="s3">'f8'</span><span class="s1">).view(</span><span class="s3">'f4,i4'</span><span class="s1">)</span>
        <span class="s1">assert_equal(type(rv)</span><span class="s0">, </span><span class="s1">np.recarray)</span>
        <span class="s1">assert_equal(rv.dtype.type</span><span class="s0">, </span><span class="s1">np.record)</span>

        <span class="s5">#check that getitem also preserves np.recarray and np.record</span>
        <span class="s1">r = np.rec.array(np.ones(</span><span class="s2">4</span><span class="s0">, </span><span class="s1">dtype=[(</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'i4'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'i4'</span><span class="s1">)</span><span class="s0">,</span>
                                           <span class="s1">(</span><span class="s3">'c'</span><span class="s0">, </span><span class="s3">'i4,i4'</span><span class="s1">)]))</span>
        <span class="s1">assert_equal(r[</span><span class="s3">'c'</span><span class="s1">].dtype.type</span><span class="s0">, </span><span class="s1">np.record)</span>
        <span class="s1">assert_equal(type(r[</span><span class="s3">'c'</span><span class="s1">])</span><span class="s0">, </span><span class="s1">np.recarray)</span>

        <span class="s5">#and that it preserves subclasses (gh-6949)</span>
        <span class="s0">class </span><span class="s1">C(np.recarray):</span>
            <span class="s0">pass</span>

        <span class="s1">c = r.view(C)</span>
        <span class="s1">assert_equal(type(c[</span><span class="s3">'c'</span><span class="s1">])</span><span class="s0">, </span><span class="s1">C)</span>

        <span class="s5"># check that accessing nested structures keep record type, but</span>
        <span class="s5"># not for subarrays, non-void structures, non-structured voids</span>
        <span class="s1">test_dtype = [(</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'f4,f4'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'V8'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'c'</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'f4'</span><span class="s0">,</span><span class="s2">2</span><span class="s1">))</span><span class="s0">,</span>
                      <span class="s1">(</span><span class="s3">'d'</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'i8'</span><span class="s0">, </span><span class="s3">'i4,i4'</span><span class="s1">))]</span>
        <span class="s1">r = np.rec.array([((</span><span class="s2">1</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s6">b'11111111'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">,</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">,</span>
                          <span class="s1">((</span><span class="s2">1</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s6">b'11111111'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">,</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">dtype=test_dtype)</span>
        <span class="s1">assert_equal(r.a.dtype.type</span><span class="s0">, </span><span class="s1">np.record)</span>
        <span class="s1">assert_equal(r.b.dtype.type</span><span class="s0">, </span><span class="s1">np.void)</span>
        <span class="s1">assert_equal(r.c.dtype.type</span><span class="s0">, </span><span class="s1">np.float32)</span>
        <span class="s1">assert_equal(r.d.dtype.type</span><span class="s0">, </span><span class="s1">np.int64)</span>
        <span class="s5"># check the same, but for views</span>
        <span class="s1">r = np.rec.array(np.ones(</span><span class="s2">4</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">'i4,i4'</span><span class="s1">))</span>
        <span class="s1">assert_equal(r.view(</span><span class="s3">'f4,f4'</span><span class="s1">).dtype.type</span><span class="s0">, </span><span class="s1">np.record)</span>
        <span class="s1">assert_equal(r.view((</span><span class="s3">'i4'</span><span class="s0">,</span><span class="s2">2</span><span class="s1">)).dtype.type</span><span class="s0">, </span><span class="s1">np.int32)</span>
        <span class="s1">assert_equal(r.view(</span><span class="s3">'V8'</span><span class="s1">).dtype.type</span><span class="s0">, </span><span class="s1">np.void)</span>
        <span class="s1">assert_equal(r.view((</span><span class="s3">'i8'</span><span class="s0">, </span><span class="s3">'i4,i4'</span><span class="s1">)).dtype.type</span><span class="s0">, </span><span class="s1">np.int64)</span>

        <span class="s5">#check that we can undo the view</span>
        <span class="s1">arrs = [np.ones(</span><span class="s2">4</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">'f4,i4'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.ones(</span><span class="s2">4</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">'f8'</span><span class="s1">)]</span>
        <span class="s0">for </span><span class="s1">arr </span><span class="s0">in </span><span class="s1">arrs:</span>
            <span class="s1">rec = np.rec.array(arr)</span>
            <span class="s5"># recommended way to view as an ndarray:</span>
            <span class="s1">arr2 = rec.view(rec.dtype.fields </span><span class="s0">or </span><span class="s1">rec.dtype</span><span class="s0">, </span><span class="s1">np.ndarray)</span>
            <span class="s1">assert_equal(arr2.dtype.type</span><span class="s0">, </span><span class="s1">arr.dtype.type)</span>
            <span class="s1">assert_equal(type(arr2)</span><span class="s0">, </span><span class="s1">type(arr))</span>

    <span class="s0">def </span><span class="s1">test_recarray_from_names(self):</span>
        <span class="s1">ra = np.rec.array([</span>
            <span class="s1">(</span><span class="s2">1</span><span class="s0">, </span><span class="s3">'abc'</span><span class="s0">, </span><span class="s2">3.7000002861022949</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s3">'xy'</span><span class="s0">, </span><span class="s2">6.6999998092651367</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s3">' '</span><span class="s0">, </span><span class="s2">0.40000000596046448</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)]</span><span class="s0">,</span>
                       <span class="s1">names=</span><span class="s3">'c1, c2, c3, c4'</span><span class="s1">)</span>
        <span class="s1">pa = np.rec.fromrecords([</span>
            <span class="s1">(</span><span class="s2">1</span><span class="s0">, </span><span class="s3">'abc'</span><span class="s0">, </span><span class="s2">3.7000002861022949</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s3">'xy'</span><span class="s0">, </span><span class="s2">6.6999998092651367</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s3">' '</span><span class="s0">, </span><span class="s2">0.40000000596046448</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)]</span><span class="s0">,</span>
                       <span class="s1">names=</span><span class="s3">'c1, c2, c3, c4'</span><span class="s1">)</span>
        <span class="s1">assert_(ra.dtype == pa.dtype)</span>
        <span class="s1">assert_(ra.shape == pa.shape)</span>
        <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range(len(ra)):</span>
            <span class="s1">assert_(ra[k].item() == pa[k].item())</span>

    <span class="s0">def </span><span class="s1">test_recarray_conflict_fields(self):</span>
        <span class="s1">ra = np.rec.array([(</span><span class="s2">1</span><span class="s0">, </span><span class="s3">'abc'</span><span class="s0">, </span><span class="s2">2.3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s3">'xyz'</span><span class="s0">, </span><span class="s2">4.2</span><span class="s1">)</span><span class="s0">,</span>
                        <span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s3">'wrs'</span><span class="s0">, </span><span class="s2">1.3</span><span class="s1">)]</span><span class="s0">,</span>
                       <span class="s1">names=</span><span class="s3">'field, shape, mean'</span><span class="s1">)</span>
        <span class="s1">ra.mean = [</span><span class="s2">1.1</span><span class="s0">, </span><span class="s2">2.2</span><span class="s0">, </span><span class="s2">3.3</span><span class="s1">]</span>
        <span class="s1">assert_array_almost_equal(ra[</span><span class="s3">'mean'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1.1</span><span class="s0">, </span><span class="s2">2.2</span><span class="s0">, </span><span class="s2">3.3</span><span class="s1">])</span>
        <span class="s1">assert_(type(ra.mean) </span><span class="s0">is </span><span class="s1">type(ra.var))</span>
        <span class="s1">ra.shape = (</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span>
        <span class="s1">assert_(ra.shape == (</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>
        <span class="s1">ra.shape = [</span><span class="s3">'A'</span><span class="s0">, </span><span class="s3">'B'</span><span class="s0">, </span><span class="s3">'C'</span><span class="s1">]</span>
        <span class="s1">assert_array_equal(ra[</span><span class="s3">'shape'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[[</span><span class="s3">'A'</span><span class="s0">, </span><span class="s3">'B'</span><span class="s0">, </span><span class="s3">'C'</span><span class="s1">]])</span>
        <span class="s1">ra.field = </span><span class="s2">5</span>
        <span class="s1">assert_array_equal(ra[</span><span class="s3">'field'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]])</span>
        <span class="s1">assert_(isinstance(ra.field</span><span class="s0">, </span><span class="s1">collections.abc.Callable))</span>

    <span class="s0">def </span><span class="s1">test_fromrecords_with_explicit_dtype(self):</span>
        <span class="s1">a = np.rec.fromrecords([(</span><span class="s2">1</span><span class="s0">, </span><span class="s3">'a'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s3">'bbb'</span><span class="s1">)]</span><span class="s0">,</span>
                                <span class="s1">dtype=[(</span><span class="s3">'a'</span><span class="s0">, </span><span class="s1">int)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'b'</span><span class="s0">, </span><span class="s1">object)])</span>
        <span class="s1">assert_equal(a.a</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">assert_equal(a[</span><span class="s2">0</span><span class="s1">].a</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(a.b</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'bbb'</span><span class="s1">])</span>
        <span class="s1">assert_equal(a[-</span><span class="s2">1</span><span class="s1">].b</span><span class="s0">, </span><span class="s3">'bbb'</span><span class="s1">)</span>
        <span class="s5">#</span>
        <span class="s1">ndtype = np.dtype([(</span><span class="s3">'a'</span><span class="s0">, </span><span class="s1">int)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'b'</span><span class="s0">, </span><span class="s1">object)])</span>
        <span class="s1">a = np.rec.fromrecords([(</span><span class="s2">1</span><span class="s0">, </span><span class="s3">'a'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">, </span><span class="s3">'bbb'</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">dtype=ndtype)</span>
        <span class="s1">assert_equal(a.a</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">assert_equal(a[</span><span class="s2">0</span><span class="s1">].a</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(a.b</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'bbb'</span><span class="s1">])</span>
        <span class="s1">assert_equal(a[-</span><span class="s2">1</span><span class="s1">].b</span><span class="s0">, </span><span class="s3">'bbb'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_recarray_stringtypes(self):</span>
        <span class="s5"># Issue #3993</span>
        <span class="s1">a = np.array([(</span><span class="s3">'abc '</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'abc'</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)]</span><span class="s0">,</span>
                     <span class="s1">dtype=[(</span><span class="s3">'foo'</span><span class="s0">, </span><span class="s3">'S4'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'bar'</span><span class="s0">, </span><span class="s1">int)])</span>
        <span class="s1">a = a.view(np.recarray)</span>
        <span class="s1">assert_equal(a.foo[</span><span class="s2">0</span><span class="s1">] == a.foo[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, False</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_recarray_returntypes(self):</span>
        <span class="s1">qux_fields = {</span><span class="s3">'C'</span><span class="s1">: (np.dtype(</span><span class="s3">'S5'</span><span class="s1">)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s3">'D'</span><span class="s1">: (np.dtype(</span><span class="s3">'S5'</span><span class="s1">)</span><span class="s0">, </span><span class="s2">6</span><span class="s1">)}</span>
        <span class="s1">a = np.rec.array([(</span><span class="s3">'abc '</span><span class="s0">, </span><span class="s1">(</span><span class="s2">1</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'abcde'</span><span class="s0">, </span><span class="s3">'fgehi'</span><span class="s1">))</span><span class="s0">,</span>
                          <span class="s1">(</span><span class="s3">'abc'</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2</span><span class="s0">,</span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'abcde'</span><span class="s0">, </span><span class="s3">'jklmn'</span><span class="s1">))]</span><span class="s0">,</span>
                         <span class="s1">dtype=[(</span><span class="s3">'foo'</span><span class="s0">, </span><span class="s3">'S4'</span><span class="s1">)</span><span class="s0">,</span>
                                <span class="s1">(</span><span class="s3">'bar'</span><span class="s0">, </span><span class="s1">[(</span><span class="s3">'A'</span><span class="s0">, </span><span class="s1">int)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'B'</span><span class="s0">, </span><span class="s1">int)])</span><span class="s0">,</span>
                                <span class="s1">(</span><span class="s3">'baz'</span><span class="s0">, </span><span class="s1">int)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'qux'</span><span class="s0">, </span><span class="s1">qux_fields)])</span>
        <span class="s1">assert_equal(type(a.foo)</span><span class="s0">, </span><span class="s1">np.ndarray)</span>
        <span class="s1">assert_equal(type(a[</span><span class="s3">'foo'</span><span class="s1">])</span><span class="s0">, </span><span class="s1">np.ndarray)</span>
        <span class="s1">assert_equal(type(a.bar)</span><span class="s0">, </span><span class="s1">np.recarray)</span>
        <span class="s1">assert_equal(type(a[</span><span class="s3">'bar'</span><span class="s1">])</span><span class="s0">, </span><span class="s1">np.recarray)</span>
        <span class="s1">assert_equal(a.bar.dtype.type</span><span class="s0">, </span><span class="s1">np.record)</span>
        <span class="s1">assert_equal(type(a[</span><span class="s3">'qux'</span><span class="s1">])</span><span class="s0">, </span><span class="s1">np.recarray)</span>
        <span class="s1">assert_equal(a.qux.dtype.type</span><span class="s0">, </span><span class="s1">np.record)</span>
        <span class="s1">assert_equal(dict(a.qux.dtype.fields)</span><span class="s0">, </span><span class="s1">qux_fields)</span>
        <span class="s1">assert_equal(type(a.baz)</span><span class="s0">, </span><span class="s1">np.ndarray)</span>
        <span class="s1">assert_equal(type(a[</span><span class="s3">'baz'</span><span class="s1">])</span><span class="s0">, </span><span class="s1">np.ndarray)</span>
        <span class="s1">assert_equal(type(a[</span><span class="s2">0</span><span class="s1">].bar)</span><span class="s0">, </span><span class="s1">np.record)</span>
        <span class="s1">assert_equal(type(a[</span><span class="s2">0</span><span class="s1">][</span><span class="s3">'bar'</span><span class="s1">])</span><span class="s0">, </span><span class="s1">np.record)</span>
        <span class="s1">assert_equal(a[</span><span class="s2">0</span><span class="s1">].bar.A</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(a[</span><span class="s2">0</span><span class="s1">].bar[</span><span class="s3">'A'</span><span class="s1">]</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(a[</span><span class="s2">0</span><span class="s1">][</span><span class="s3">'bar'</span><span class="s1">].A</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(a[</span><span class="s2">0</span><span class="s1">][</span><span class="s3">'bar'</span><span class="s1">][</span><span class="s3">'A'</span><span class="s1">]</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(a[</span><span class="s2">0</span><span class="s1">].qux.D</span><span class="s0">, </span><span class="s6">b'fgehi'</span><span class="s1">)</span>
        <span class="s1">assert_equal(a[</span><span class="s2">0</span><span class="s1">].qux[</span><span class="s3">'D'</span><span class="s1">]</span><span class="s0">, </span><span class="s6">b'fgehi'</span><span class="s1">)</span>
        <span class="s1">assert_equal(a[</span><span class="s2">0</span><span class="s1">][</span><span class="s3">'qux'</span><span class="s1">].D</span><span class="s0">, </span><span class="s6">b'fgehi'</span><span class="s1">)</span>
        <span class="s1">assert_equal(a[</span><span class="s2">0</span><span class="s1">][</span><span class="s3">'qux'</span><span class="s1">][</span><span class="s3">'D'</span><span class="s1">]</span><span class="s0">, </span><span class="s6">b'fgehi'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_zero_width_strings(self):</span>
        <span class="s5"># Test for #6430, based on the test case from #1901</span>

        <span class="s1">cols = [[</span><span class="s3">'test'</span><span class="s1">] * </span><span class="s2">3</span><span class="s0">, </span><span class="s1">[</span><span class="s3">''</span><span class="s1">] * </span><span class="s2">3</span><span class="s1">]</span>
        <span class="s1">rec = np.rec.fromarrays(cols)</span>
        <span class="s1">assert_equal(rec[</span><span class="s3">'f0'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'test'</span><span class="s0">, </span><span class="s3">'test'</span><span class="s0">, </span><span class="s3">'test'</span><span class="s1">])</span>
        <span class="s1">assert_equal(rec[</span><span class="s3">'f1'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">''</span><span class="s0">, </span><span class="s3">''</span><span class="s0">, </span><span class="s3">''</span><span class="s1">])</span>

        <span class="s1">dt = np.dtype([(</span><span class="s3">'f0'</span><span class="s0">, </span><span class="s3">'|S4'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'f1'</span><span class="s0">, </span><span class="s3">'|S'</span><span class="s1">)])</span>
        <span class="s1">rec = np.rec.fromarrays(cols</span><span class="s0">, </span><span class="s1">dtype=dt)</span>
        <span class="s1">assert_equal(rec.itemsize</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span>
        <span class="s1">assert_equal(rec[</span><span class="s3">'f0'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s6">b'test'</span><span class="s0">, </span><span class="s6">b'test'</span><span class="s0">, </span><span class="s6">b'test'</span><span class="s1">])</span>
        <span class="s1">assert_equal(rec[</span><span class="s3">'f1'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s6">b''</span><span class="s0">, </span><span class="s6">b''</span><span class="s0">, </span><span class="s6">b''</span><span class="s1">])</span>


<span class="s0">class </span><span class="s1">TestPathUsage:</span>
    <span class="s5"># Test that pathlib.Path can be used</span>
    <span class="s0">def </span><span class="s1">test_tofile_fromfile(self):</span>
        <span class="s0">with </span><span class="s1">temppath(suffix=</span><span class="s3">'.bin'</span><span class="s1">) </span><span class="s0">as </span><span class="s1">path:</span>
            <span class="s1">path = Path(path)</span>
            <span class="s1">np.random.seed(</span><span class="s2">123</span><span class="s1">)</span>
            <span class="s1">a = np.random.rand(</span><span class="s2">10</span><span class="s1">).astype(</span><span class="s3">'f8,i4,a5'</span><span class="s1">)</span>
            <span class="s1">a[</span><span class="s2">5</span><span class="s1">] = (</span><span class="s2">0.5</span><span class="s0">,</span><span class="s2">10</span><span class="s0">,</span><span class="s3">'abcde'</span><span class="s1">)</span>
            <span class="s0">with </span><span class="s1">path.open(</span><span class="s3">&quot;wb&quot;</span><span class="s1">) </span><span class="s0">as </span><span class="s1">fd:</span>
                <span class="s1">a.tofile(fd)</span>
            <span class="s1">x = np.core.records.fromfile(path</span><span class="s0">,</span>
                                         <span class="s1">formats=</span><span class="s3">'f8,i4,a5'</span><span class="s0">,</span>
                                         <span class="s1">shape=</span><span class="s2">10</span><span class="s1">)</span>
            <span class="s1">assert_array_equal(x</span><span class="s0">, </span><span class="s1">a)</span>


<span class="s0">class </span><span class="s1">TestRecord:</span>
    <span class="s0">def </span><span class="s1">setup(self):</span>
        <span class="s1">self.data = np.rec.fromrecords([(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s1">)]</span><span class="s0">,</span>
                            <span class="s1">dtype=[(</span><span class="s3">&quot;col1&quot;</span><span class="s0">, </span><span class="s3">&quot;&lt;i4&quot;</span><span class="s1">)</span><span class="s0">,</span>
                                   <span class="s1">(</span><span class="s3">&quot;col2&quot;</span><span class="s0">, </span><span class="s3">&quot;&lt;i4&quot;</span><span class="s1">)</span><span class="s0">,</span>
                                   <span class="s1">(</span><span class="s3">&quot;col3&quot;</span><span class="s0">, </span><span class="s3">&quot;&lt;i4&quot;</span><span class="s1">)])</span>

    <span class="s0">def </span><span class="s1">test_assignment1(self):</span>
        <span class="s1">a = self.data</span>
        <span class="s1">assert_equal(a.col1[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">a[</span><span class="s2">0</span><span class="s1">].col1 = </span><span class="s2">0</span>
        <span class="s1">assert_equal(a.col1[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_assignment2(self):</span>
        <span class="s1">a = self.data</span>
        <span class="s1">assert_equal(a.col1[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">a.col1[</span><span class="s2">0</span><span class="s1">] = </span><span class="s2">0</span>
        <span class="s1">assert_equal(a.col1[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_invalid_assignment(self):</span>
        <span class="s1">a = self.data</span>

        <span class="s0">def </span><span class="s1">assign_invalid_column(x):</span>
            <span class="s1">x[</span><span class="s2">0</span><span class="s1">].col5 = </span><span class="s2">1</span>

        <span class="s1">assert_raises(AttributeError</span><span class="s0">, </span><span class="s1">assign_invalid_column</span><span class="s0">, </span><span class="s1">a)</span>

    <span class="s0">def </span><span class="s1">test_nonwriteable_setfield(self):</span>
        <span class="s5"># gh-8171</span>
        <span class="s1">r = np.rec.array([(</span><span class="s2">0</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">1</span><span class="s0">,</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">dtype=[(</span><span class="s3">'f'</span><span class="s0">, </span><span class="s3">'i4'</span><span class="s1">)])</span>
        <span class="s1">r.flags.writeable = </span><span class="s0">False</span>
        <span class="s0">with </span><span class="s1">assert_raises(ValueError):</span>
            <span class="s1">r.f = [</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span>
        <span class="s0">with </span><span class="s1">assert_raises(ValueError):</span>
            <span class="s1">r.setfield([</span><span class="s2">2</span><span class="s0">,</span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">*r.dtype.fields[</span><span class="s3">'f'</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_out_of_order_fields(self):</span>
        <span class="s5"># names in the same order, padding added to descr</span>
        <span class="s1">x = self.data[[</span><span class="s3">'col1'</span><span class="s0">, </span><span class="s3">'col2'</span><span class="s1">]]</span>
        <span class="s1">assert_equal(x.dtype.names</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'col1'</span><span class="s0">, </span><span class="s3">'col2'</span><span class="s1">))</span>
        <span class="s1">assert_equal(x.dtype.descr</span><span class="s0">,</span>
                     <span class="s1">[(</span><span class="s3">'col1'</span><span class="s0">, </span><span class="s3">'&lt;i4'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'col2'</span><span class="s0">, </span><span class="s3">'&lt;i4'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">''</span><span class="s0">, </span><span class="s3">'|V4'</span><span class="s1">)])</span>

        <span class="s5"># names change order to match indexing, as of 1.14 - descr can't</span>
        <span class="s5"># represent that</span>
        <span class="s1">y = self.data[[</span><span class="s3">'col2'</span><span class="s0">, </span><span class="s3">'col1'</span><span class="s1">]]</span>
        <span class="s1">assert_equal(y.dtype.names</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'col2'</span><span class="s0">, </span><span class="s3">'col1'</span><span class="s1">))</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, lambda</span><span class="s1">: y.dtype.descr)</span>

    <span class="s0">def </span><span class="s1">test_pickle_1(self):</span>
        <span class="s5"># Issue #1529</span>
        <span class="s1">a = np.array([(</span><span class="s2">1</span><span class="s0">, </span><span class="s1">[])]</span><span class="s0">, </span><span class="s1">dtype=[(</span><span class="s3">'a'</span><span class="s0">, </span><span class="s1">np.int32)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'b'</span><span class="s0">, </span><span class="s1">np.int32</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)])</span>
        <span class="s0">for </span><span class="s1">proto </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">2</span><span class="s0">, </span><span class="s1">pickle.HIGHEST_PROTOCOL + </span><span class="s2">1</span><span class="s1">):</span>
            <span class="s1">assert_equal(a</span><span class="s0">, </span><span class="s1">pickle.loads(pickle.dumps(a</span><span class="s0">, </span><span class="s1">protocol=proto)))</span>
            <span class="s1">assert_equal(a[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">pickle.loads(pickle.dumps(a[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                                         <span class="s1">protocol=proto)))</span>

    <span class="s0">def </span><span class="s1">test_pickle_2(self):</span>
        <span class="s1">a = self.data</span>
        <span class="s0">for </span><span class="s1">proto </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">2</span><span class="s0">, </span><span class="s1">pickle.HIGHEST_PROTOCOL + </span><span class="s2">1</span><span class="s1">):</span>
            <span class="s1">assert_equal(a</span><span class="s0">, </span><span class="s1">pickle.loads(pickle.dumps(a</span><span class="s0">, </span><span class="s1">protocol=proto)))</span>
            <span class="s1">assert_equal(a[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">pickle.loads(pickle.dumps(a[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                                                         <span class="s1">protocol=proto)))</span>

    <span class="s0">def </span><span class="s1">test_pickle_3(self):</span>
        <span class="s5"># Issue #7140</span>
        <span class="s1">a = self.data</span>
        <span class="s0">for </span><span class="s1">proto </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">2</span><span class="s0">, </span><span class="s1">pickle.HIGHEST_PROTOCOL + </span><span class="s2">1</span><span class="s1">):</span>
            <span class="s1">pa = pickle.loads(pickle.dumps(a[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">protocol=proto))</span>
            <span class="s1">assert_(pa.flags.c_contiguous)</span>
            <span class="s1">assert_(pa.flags.f_contiguous)</span>
            <span class="s1">assert_(pa.flags.writeable)</span>
            <span class="s1">assert_(pa.flags.aligned)</span>

    <span class="s0">def </span><span class="s1">test_pickle_void(self):</span>
        <span class="s5"># issue gh-13593</span>
        <span class="s1">dt = np.dtype([(</span><span class="s3">'obj'</span><span class="s0">, </span><span class="s3">'O'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'int'</span><span class="s0">, </span><span class="s3">'i'</span><span class="s1">)])</span>
        <span class="s1">a = np.empty(</span><span class="s2">1</span><span class="s0">, </span><span class="s1">dtype=dt)</span>
        <span class="s1">data = (bytearray(</span><span class="s6">b'eman'</span><span class="s1">)</span><span class="s0">,</span><span class="s1">)</span>
        <span class="s1">a[</span><span class="s3">'obj'</span><span class="s1">] = data</span>
        <span class="s1">a[</span><span class="s3">'int'</span><span class="s1">] = </span><span class="s2">42</span>
        <span class="s1">ctor</span><span class="s0">, </span><span class="s1">args = a[</span><span class="s2">0</span><span class="s1">].__reduce__()</span>
        <span class="s5"># check the constructor is what we expect before interpreting the arguments</span>
        <span class="s0">assert </span><span class="s1">ctor </span><span class="s0">is </span><span class="s1">np.core.multiarray.scalar</span>
        <span class="s1">dtype</span><span class="s0">, </span><span class="s1">obj = args</span>
        <span class="s5"># make sure we did not pickle the address</span>
        <span class="s0">assert not </span><span class="s1">isinstance(obj</span><span class="s0">, </span><span class="s1">bytes)</span>

        <span class="s1">assert_raises(RuntimeError</span><span class="s0">, </span><span class="s1">ctor</span><span class="s0">, </span><span class="s1">dtype</span><span class="s0">, </span><span class="s2">13</span><span class="s1">)</span>

        <span class="s5"># Test roundtrip:</span>
        <span class="s1">dump = pickle.dumps(a[</span><span class="s2">0</span><span class="s1">])</span>
        <span class="s1">unpickled = pickle.loads(dump)</span>
        <span class="s0">assert </span><span class="s1">a[</span><span class="s2">0</span><span class="s1">] == unpickled</span>

        <span class="s5"># Also check the similar (impossible) &quot;object scalar&quot; path:</span>
        <span class="s0">with </span><span class="s1">pytest.warns(DeprecationWarning):</span>
            <span class="s0">assert </span><span class="s1">ctor(np.dtype(</span><span class="s3">&quot;O&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">data) </span><span class="s0">is </span><span class="s1">data</span>

    <span class="s0">def </span><span class="s1">test_objview_record(self):</span>
        <span class="s5"># https://github.com/numpy/numpy/issues/2599</span>
        <span class="s1">dt = np.dtype([(</span><span class="s3">'foo'</span><span class="s0">, </span><span class="s3">'i8'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'bar'</span><span class="s0">, </span><span class="s3">'O'</span><span class="s1">)])</span>
        <span class="s1">r = np.zeros((</span><span class="s2">1</span><span class="s0">,</span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=dt).view(np.recarray)</span>
        <span class="s1">r.foo = np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])  </span><span class="s5"># TypeError?</span>

        <span class="s5"># https://github.com/numpy/numpy/issues/3256</span>
        <span class="s1">ra = np.recarray((</span><span class="s2">2</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=[(</span><span class="s3">'x'</span><span class="s0">, </span><span class="s1">object)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'y'</span><span class="s0">, </span><span class="s1">float)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'z'</span><span class="s0">, </span><span class="s1">int)])</span>
        <span class="s1">ra[[</span><span class="s3">'x'</span><span class="s0">,</span><span class="s3">'y'</span><span class="s1">]]  </span><span class="s5"># TypeError?</span>

    <span class="s0">def </span><span class="s1">test_record_scalar_setitem(self):</span>
        <span class="s5"># https://github.com/numpy/numpy/issues/3561</span>
        <span class="s1">rec = np.recarray(</span><span class="s2">1</span><span class="s0">, </span><span class="s1">dtype=[(</span><span class="s3">'x'</span><span class="s0">, </span><span class="s1">float</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)])</span>
        <span class="s1">rec[</span><span class="s2">0</span><span class="s1">].x = </span><span class="s2">1</span>
        <span class="s1">assert_equal(rec[</span><span class="s2">0</span><span class="s1">].x</span><span class="s0">, </span><span class="s1">np.ones(</span><span class="s2">5</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_missing_field(self):</span>
        <span class="s5"># https://github.com/numpy/numpy/issues/4806</span>
        <span class="s1">arr = np.zeros((</span><span class="s2">3</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=[(</span><span class="s3">'x'</span><span class="s0">, </span><span class="s1">int)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'y'</span><span class="s0">, </span><span class="s1">int)])</span>
        <span class="s1">assert_raises(KeyError</span><span class="s0">, lambda</span><span class="s1">: arr[[</span><span class="s3">'nofield'</span><span class="s1">]])</span>

    <span class="s0">def </span><span class="s1">test_fromarrays_nested_structured_arrays(self):</span>
        <span class="s1">arrays = [</span>
            <span class="s1">np.arange(</span><span class="s2">10</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">np.ones(</span><span class="s2">10</span><span class="s0">, </span><span class="s1">dtype=[(</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'&lt;u2'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'&lt;f4'</span><span class="s1">)])</span><span class="s0">,</span>
        <span class="s1">]</span>
        <span class="s1">arr = np.rec.fromarrays(arrays)  </span><span class="s5"># ValueError?</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'nfields'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_assign_dtype_attribute(self</span><span class="s0">, </span><span class="s1">nfields):</span>
        <span class="s1">dt = np.dtype([(</span><span class="s3">'a'</span><span class="s0">, </span><span class="s1">np.uint8)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'b'</span><span class="s0">, </span><span class="s1">np.uint8)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'c'</span><span class="s0">, </span><span class="s1">np.uint8)][:nfields])</span>
        <span class="s1">data = np.zeros(</span><span class="s2">3</span><span class="s0">, </span><span class="s1">dt).view(np.recarray)</span>

        <span class="s5"># the original and resulting dtypes differ on whether they are records</span>
        <span class="s0">assert </span><span class="s1">data.dtype.type == np.record</span>
        <span class="s0">assert </span><span class="s1">dt.type != np.record</span>

        <span class="s5"># ensure that the dtype remains a record even when assigned</span>
        <span class="s1">data.dtype = dt</span>
        <span class="s0">assert </span><span class="s1">data.dtype.type == np.record</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'nfields'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_nested_fields_are_records(self</span><span class="s0">, </span><span class="s1">nfields):</span>
        <span class="s4">&quot;&quot;&quot; Test that nested structured types are treated as records too &quot;&quot;&quot;</span>
        <span class="s1">dt = np.dtype([(</span><span class="s3">'a'</span><span class="s0">, </span><span class="s1">np.uint8)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'b'</span><span class="s0">, </span><span class="s1">np.uint8)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'c'</span><span class="s0">, </span><span class="s1">np.uint8)][:nfields])</span>
        <span class="s1">dt_outer = np.dtype([(</span><span class="s3">'inner'</span><span class="s0">, </span><span class="s1">dt)])</span>

        <span class="s1">data = np.zeros(</span><span class="s2">3</span><span class="s0">, </span><span class="s1">dt_outer).view(np.recarray)</span>
        <span class="s0">assert </span><span class="s1">isinstance(data</span><span class="s0">, </span><span class="s1">np.recarray)</span>
        <span class="s0">assert </span><span class="s1">isinstance(data[</span><span class="s3">'inner'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">np.recarray)</span>

        <span class="s1">data0 = data[</span><span class="s2">0</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">isinstance(data0</span><span class="s0">, </span><span class="s1">np.record)</span>
        <span class="s0">assert </span><span class="s1">isinstance(data0[</span><span class="s3">'inner'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">np.record)</span>

    <span class="s0">def </span><span class="s1">test_nested_dtype_padding(self):</span>
        <span class="s4">&quot;&quot;&quot; test that trailing padding is preserved &quot;&quot;&quot;</span>
        <span class="s5"># construct a dtype with padding at the end</span>
        <span class="s1">dt = np.dtype([(</span><span class="s3">'a'</span><span class="s0">, </span><span class="s1">np.uint8)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'b'</span><span class="s0">, </span><span class="s1">np.uint8)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'c'</span><span class="s0">, </span><span class="s1">np.uint8)])</span>
        <span class="s1">dt_padded_end = dt[[</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">]]</span>
        <span class="s0">assert </span><span class="s1">dt_padded_end.itemsize == dt.itemsize</span>

        <span class="s1">dt_outer = np.dtype([(</span><span class="s3">'inner'</span><span class="s0">, </span><span class="s1">dt_padded_end)])</span>

        <span class="s1">data = np.zeros(</span><span class="s2">3</span><span class="s0">, </span><span class="s1">dt_outer).view(np.recarray)</span>
        <span class="s1">assert_equal(data[</span><span class="s3">'inner'</span><span class="s1">].dtype</span><span class="s0">, </span><span class="s1">dt_padded_end)</span>

        <span class="s1">data0 = data[</span><span class="s2">0</span><span class="s1">]</span>
        <span class="s1">assert_equal(data0[</span><span class="s3">'inner'</span><span class="s1">].dtype</span><span class="s0">, </span><span class="s1">dt_padded_end)</span>


<span class="s0">def </span><span class="s1">test_find_duplicate():</span>
    <span class="s1">l1 = [</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]</span>
    <span class="s1">assert_(np.rec.find_duplicate(l1) == [])</span>

    <span class="s1">l2 = [</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]</span>
    <span class="s1">assert_(np.rec.find_duplicate(l2) == [</span><span class="s2">1</span><span class="s1">])</span>

    <span class="s1">l3 = [</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span>
    <span class="s1">assert_(np.rec.find_duplicate(l3) == [</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>

    <span class="s1">l3 = [</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span>
    <span class="s1">assert_(np.rec.find_duplicate(l3) == [</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>
</pre>
</body>
</html>