<html>
<head>
<title>test_select_dtypes.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_select_dtypes.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas.core.dtypes.dtypes </span><span class="s0">import </span><span class="s1">ExtensionDtype</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">DataFrame</span><span class="s0">,</span>
    <span class="s1">Timestamp</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">pandas._testing </span><span class="s0">as </span><span class="s1">tm</span>
<span class="s0">from </span><span class="s1">pandas.core.arrays </span><span class="s0">import </span><span class="s1">ExtensionArray</span>


<span class="s0">class </span><span class="s1">DummyDtype(ExtensionDtype):</span>
    <span class="s1">type = int</span>

    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">numeric):</span>
        <span class="s1">self._numeric = numeric</span>

    <span class="s1">@property</span>
    <span class="s0">def </span><span class="s1">name(self):</span>
        <span class="s0">return </span><span class="s2">&quot;Dummy&quot;</span>

    <span class="s1">@property</span>
    <span class="s0">def </span><span class="s1">_is_numeric(self):</span>
        <span class="s0">return </span><span class="s1">self._numeric</span>


<span class="s0">class </span><span class="s1">DummyArray(ExtensionArray):</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">data</span><span class="s0">, </span><span class="s1">dtype):</span>
        <span class="s1">self.data = data</span>
        <span class="s1">self._dtype = dtype</span>

    <span class="s0">def </span><span class="s1">__array__(self</span><span class="s0">, </span><span class="s1">dtype):</span>
        <span class="s0">return </span><span class="s1">self.data</span>

    <span class="s1">@property</span>
    <span class="s0">def </span><span class="s1">dtype(self):</span>
        <span class="s0">return </span><span class="s1">self._dtype</span>

    <span class="s0">def </span><span class="s1">__len__(self) -&gt; int:</span>
        <span class="s0">return </span><span class="s1">len(self.data)</span>

    <span class="s0">def </span><span class="s1">__getitem__(self</span><span class="s0">, </span><span class="s1">item):</span>
        <span class="s0">pass</span>

    <span class="s0">def </span><span class="s1">copy(self):</span>
        <span class="s0">return </span><span class="s1">self</span>


<span class="s0">class </span><span class="s1">TestSelectDtypes:</span>
    <span class="s0">def </span><span class="s1">test_select_dtypes_include_using_list_like(self):</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;a&quot;</span><span class="s1">: list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;b&quot;</span><span class="s1">: list(range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s2">&quot;c&quot;</span><span class="s1">: np.arange(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">6</span><span class="s1">).astype(</span><span class="s2">&quot;u1&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;d&quot;</span><span class="s1">: np.arange(</span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">7.0</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;float64&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;e&quot;</span><span class="s1">: [</span><span class="s0">True, False, True</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;f&quot;</span><span class="s1">: pd.Categorical(list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s2">&quot;g&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;h&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;i&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;CET&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;j&quot;</span><span class="s1">: pd.period_range(</span><span class="s2">&quot;2013-01&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;k&quot;</span><span class="s1">: pd.timedelta_range(</span><span class="s2">&quot;1 day&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>

        <span class="s1">ri = df.select_dtypes(include=[np.number])</span>
        <span class="s1">ei = df[[</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s2">&quot;k&quot;</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(ri</span><span class="s0">, </span><span class="s1">ei)</span>

        <span class="s1">ri = df.select_dtypes(include=[np.number]</span><span class="s0">, </span><span class="s1">exclude=[</span><span class="s2">&quot;timedelta&quot;</span><span class="s1">])</span>
        <span class="s1">ei = df[[</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(ri</span><span class="s0">, </span><span class="s1">ei)</span>

        <span class="s1">ri = df.select_dtypes(include=[np.number</span><span class="s0">, </span><span class="s2">&quot;category&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">exclude=[</span><span class="s2">&quot;timedelta&quot;</span><span class="s1">])</span>
        <span class="s1">ei = df[[</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s2">&quot;f&quot;</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(ri</span><span class="s0">, </span><span class="s1">ei)</span>

        <span class="s1">ri = df.select_dtypes(include=[</span><span class="s2">&quot;datetime&quot;</span><span class="s1">])</span>
        <span class="s1">ei = df[[</span><span class="s2">&quot;g&quot;</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(ri</span><span class="s0">, </span><span class="s1">ei)</span>

        <span class="s1">ri = df.select_dtypes(include=[</span><span class="s2">&quot;datetime64&quot;</span><span class="s1">])</span>
        <span class="s1">ei = df[[</span><span class="s2">&quot;g&quot;</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(ri</span><span class="s0">, </span><span class="s1">ei)</span>

        <span class="s1">ri = df.select_dtypes(include=[</span><span class="s2">&quot;datetimetz&quot;</span><span class="s1">])</span>
        <span class="s1">ei = df[[</span><span class="s2">&quot;h&quot;</span><span class="s0">, </span><span class="s2">&quot;i&quot;</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(ri</span><span class="s0">, </span><span class="s1">ei)</span>

        <span class="s0">with </span><span class="s1">pytest.raises(NotImplementedError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">r&quot;^$&quot;</span><span class="s1">):</span>
            <span class="s1">df.select_dtypes(include=[</span><span class="s2">&quot;period&quot;</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_select_dtypes_exclude_using_list_like(self):</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;a&quot;</span><span class="s1">: list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;b&quot;</span><span class="s1">: list(range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s2">&quot;c&quot;</span><span class="s1">: np.arange(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">6</span><span class="s1">).astype(</span><span class="s2">&quot;u1&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;d&quot;</span><span class="s1">: np.arange(</span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">7.0</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;float64&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;e&quot;</span><span class="s1">: [</span><span class="s0">True, False, True</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
        <span class="s1">re = df.select_dtypes(exclude=[np.number])</span>
        <span class="s1">ee = df[[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;e&quot;</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(re</span><span class="s0">, </span><span class="s1">ee)</span>

    <span class="s0">def </span><span class="s1">test_select_dtypes_exclude_include_using_list_like(self):</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;a&quot;</span><span class="s1">: list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;b&quot;</span><span class="s1">: list(range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s2">&quot;c&quot;</span><span class="s1">: np.arange(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;u1&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;d&quot;</span><span class="s1">: np.arange(</span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">7.0</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;float64&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;e&quot;</span><span class="s1">: [</span><span class="s0">True, False, True</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;f&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;now&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">).values</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
        <span class="s1">exclude = (np.datetime64</span><span class="s0">,</span><span class="s1">)</span>
        <span class="s1">include = np.bool_</span><span class="s0">, </span><span class="s2">&quot;integer&quot;</span>
        <span class="s1">r = df.select_dtypes(include=include</span><span class="s0">, </span><span class="s1">exclude=exclude)</span>
        <span class="s1">e = df[[</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;e&quot;</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(r</span><span class="s0">, </span><span class="s1">e)</span>

        <span class="s1">exclude = (</span><span class="s2">&quot;datetime&quot;</span><span class="s0">,</span><span class="s1">)</span>
        <span class="s1">include = </span><span class="s2">&quot;bool&quot;</span><span class="s0">, </span><span class="s2">&quot;int64&quot;</span><span class="s0">, </span><span class="s2">&quot;int32&quot;</span>
        <span class="s1">r = df.select_dtypes(include=include</span><span class="s0">, </span><span class="s1">exclude=exclude)</span>
        <span class="s1">e = df[[</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;e&quot;</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(r</span><span class="s0">, </span><span class="s1">e)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;include&quot;</span><span class="s0">, </span><span class="s1">[(np.bool_</span><span class="s0">, </span><span class="s2">&quot;int&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(np.bool_</span><span class="s0">, </span><span class="s2">&quot;integer&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;bool&quot;</span><span class="s0">, </span><span class="s1">int)]</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_select_dtypes_exclude_include_int(self</span><span class="s0">, </span><span class="s1">include):</span>
        <span class="s4"># Fix select_dtypes(include='int') for Windows, FYI #36596</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;a&quot;</span><span class="s1">: list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;b&quot;</span><span class="s1">: list(range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s2">&quot;c&quot;</span><span class="s1">: np.arange(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;int32&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;d&quot;</span><span class="s1">: np.arange(</span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">7.0</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;float64&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;e&quot;</span><span class="s1">: [</span><span class="s0">True, False, True</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;f&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;now&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">).values</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
        <span class="s1">exclude = (np.datetime64</span><span class="s0">,</span><span class="s1">)</span>
        <span class="s1">result = df.select_dtypes(include=include</span><span class="s0">, </span><span class="s1">exclude=exclude)</span>
        <span class="s1">expected = df[[</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;e&quot;</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_select_dtypes_include_using_scalars(self):</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;a&quot;</span><span class="s1">: list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;b&quot;</span><span class="s1">: list(range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s2">&quot;c&quot;</span><span class="s1">: np.arange(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">6</span><span class="s1">).astype(</span><span class="s2">&quot;u1&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;d&quot;</span><span class="s1">: np.arange(</span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">7.0</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;float64&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;e&quot;</span><span class="s1">: [</span><span class="s0">True, False, True</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;f&quot;</span><span class="s1">: pd.Categorical(list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s2">&quot;g&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;h&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;i&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;CET&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;j&quot;</span><span class="s1">: pd.period_range(</span><span class="s2">&quot;2013-01&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;k&quot;</span><span class="s1">: pd.timedelta_range(</span><span class="s2">&quot;1 day&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>

        <span class="s1">ri = df.select_dtypes(include=np.number)</span>
        <span class="s1">ei = df[[</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s2">&quot;k&quot;</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(ri</span><span class="s0">, </span><span class="s1">ei)</span>

        <span class="s1">ri = df.select_dtypes(include=</span><span class="s2">&quot;datetime&quot;</span><span class="s1">)</span>
        <span class="s1">ei = df[[</span><span class="s2">&quot;g&quot;</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(ri</span><span class="s0">, </span><span class="s1">ei)</span>

        <span class="s1">ri = df.select_dtypes(include=</span><span class="s2">&quot;datetime64&quot;</span><span class="s1">)</span>
        <span class="s1">ei = df[[</span><span class="s2">&quot;g&quot;</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(ri</span><span class="s0">, </span><span class="s1">ei)</span>

        <span class="s1">ri = df.select_dtypes(include=</span><span class="s2">&quot;category&quot;</span><span class="s1">)</span>
        <span class="s1">ei = df[[</span><span class="s2">&quot;f&quot;</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(ri</span><span class="s0">, </span><span class="s1">ei)</span>

        <span class="s0">with </span><span class="s1">pytest.raises(NotImplementedError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">r&quot;^$&quot;</span><span class="s1">):</span>
            <span class="s1">df.select_dtypes(include=</span><span class="s2">&quot;period&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_select_dtypes_exclude_using_scalars(self):</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;a&quot;</span><span class="s1">: list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;b&quot;</span><span class="s1">: list(range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s2">&quot;c&quot;</span><span class="s1">: np.arange(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">6</span><span class="s1">).astype(</span><span class="s2">&quot;u1&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;d&quot;</span><span class="s1">: np.arange(</span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">7.0</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;float64&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;e&quot;</span><span class="s1">: [</span><span class="s0">True, False, True</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;f&quot;</span><span class="s1">: pd.Categorical(list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s2">&quot;g&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;h&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;i&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;CET&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;j&quot;</span><span class="s1">: pd.period_range(</span><span class="s2">&quot;2013-01&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;k&quot;</span><span class="s1">: pd.timedelta_range(</span><span class="s2">&quot;1 day&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>

        <span class="s1">ri = df.select_dtypes(exclude=np.number)</span>
        <span class="s1">ei = df[[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;e&quot;</span><span class="s0">, </span><span class="s2">&quot;f&quot;</span><span class="s0">, </span><span class="s2">&quot;g&quot;</span><span class="s0">, </span><span class="s2">&quot;h&quot;</span><span class="s0">, </span><span class="s2">&quot;i&quot;</span><span class="s0">, </span><span class="s2">&quot;j&quot;</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(ri</span><span class="s0">, </span><span class="s1">ei)</span>

        <span class="s1">ri = df.select_dtypes(exclude=</span><span class="s2">&quot;category&quot;</span><span class="s1">)</span>
        <span class="s1">ei = df[[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;d&quot;</span><span class="s0">, </span><span class="s2">&quot;e&quot;</span><span class="s0">, </span><span class="s2">&quot;g&quot;</span><span class="s0">, </span><span class="s2">&quot;h&quot;</span><span class="s0">, </span><span class="s2">&quot;i&quot;</span><span class="s0">, </span><span class="s2">&quot;j&quot;</span><span class="s0">, </span><span class="s2">&quot;k&quot;</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(ri</span><span class="s0">, </span><span class="s1">ei)</span>

        <span class="s0">with </span><span class="s1">pytest.raises(NotImplementedError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">r&quot;^$&quot;</span><span class="s1">):</span>
            <span class="s1">df.select_dtypes(exclude=</span><span class="s2">&quot;period&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_select_dtypes_include_exclude_using_scalars(self):</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;a&quot;</span><span class="s1">: list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;b&quot;</span><span class="s1">: list(range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s2">&quot;c&quot;</span><span class="s1">: np.arange(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">6</span><span class="s1">).astype(</span><span class="s2">&quot;u1&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;d&quot;</span><span class="s1">: np.arange(</span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">7.0</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;float64&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;e&quot;</span><span class="s1">: [</span><span class="s0">True, False, True</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;f&quot;</span><span class="s1">: pd.Categorical(list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s2">&quot;g&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;h&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;i&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;CET&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;j&quot;</span><span class="s1">: pd.period_range(</span><span class="s2">&quot;2013-01&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;k&quot;</span><span class="s1">: pd.timedelta_range(</span><span class="s2">&quot;1 day&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>

        <span class="s1">ri = df.select_dtypes(include=np.number</span><span class="s0">, </span><span class="s1">exclude=</span><span class="s2">&quot;floating&quot;</span><span class="s1">)</span>
        <span class="s1">ei = df[[</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;k&quot;</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(ri</span><span class="s0">, </span><span class="s1">ei)</span>

    <span class="s0">def </span><span class="s1">test_select_dtypes_include_exclude_mixed_scalars_lists(self):</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;a&quot;</span><span class="s1">: list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;b&quot;</span><span class="s1">: list(range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s2">&quot;c&quot;</span><span class="s1">: np.arange(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">6</span><span class="s1">).astype(</span><span class="s2">&quot;u1&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;d&quot;</span><span class="s1">: np.arange(</span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">7.0</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;float64&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;e&quot;</span><span class="s1">: [</span><span class="s0">True, False, True</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;f&quot;</span><span class="s1">: pd.Categorical(list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s2">&quot;g&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;h&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;i&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;20130101&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;CET&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;j&quot;</span><span class="s1">: pd.period_range(</span><span class="s2">&quot;2013-01&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">freq=</span><span class="s2">&quot;M&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;k&quot;</span><span class="s1">: pd.timedelta_range(</span><span class="s2">&quot;1 day&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>

        <span class="s1">ri = df.select_dtypes(include=np.number</span><span class="s0">, </span><span class="s1">exclude=[</span><span class="s2">&quot;floating&quot;</span><span class="s0">, </span><span class="s2">&quot;timedelta&quot;</span><span class="s1">])</span>
        <span class="s1">ei = df[[</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(ri</span><span class="s0">, </span><span class="s1">ei)</span>

        <span class="s1">ri = df.select_dtypes(include=[np.number</span><span class="s0">, </span><span class="s2">&quot;category&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">exclude=</span><span class="s2">&quot;floating&quot;</span><span class="s1">)</span>
        <span class="s1">ei = df[[</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s0">, </span><span class="s2">&quot;f&quot;</span><span class="s0">, </span><span class="s2">&quot;k&quot;</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(ri</span><span class="s0">, </span><span class="s1">ei)</span>

    <span class="s0">def </span><span class="s1">test_select_dtypes_duplicate_columns(self):</span>
        <span class="s4"># GH20839</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;a&quot;</span><span class="s1">: [</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;b&quot;</span><span class="s1">: [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;c&quot;</span><span class="s1">: np.arange(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">6</span><span class="s1">).astype(</span><span class="s2">&quot;u1&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;d&quot;</span><span class="s1">: np.arange(</span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">7.0</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;float64&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;e&quot;</span><span class="s1">: [</span><span class="s0">True, False, True</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;f&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;now&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">).values</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
        <span class="s1">df.columns = [</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;c&quot;</span><span class="s1">]</span>

        <span class="s1">expected = DataFrame(</span>
            <span class="s1">{</span><span class="s2">&quot;a&quot;</span><span class="s1">: list(range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: np.arange(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">6</span><span class="s1">).astype(</span><span class="s2">&quot;u1&quot;</span><span class="s1">)}</span>
        <span class="s1">)</span>

        <span class="s1">result = df.select_dtypes(include=[np.number]</span><span class="s0">, </span><span class="s1">exclude=[</span><span class="s2">&quot;floating&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_select_dtypes_not_an_attr_but_still_valid_dtype(self):</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;a&quot;</span><span class="s1">: list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;b&quot;</span><span class="s1">: list(range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s2">&quot;c&quot;</span><span class="s1">: np.arange(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">6</span><span class="s1">).astype(</span><span class="s2">&quot;u1&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;d&quot;</span><span class="s1">: np.arange(</span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">7.0</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;float64&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;e&quot;</span><span class="s1">: [</span><span class="s0">True, False, True</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;f&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;now&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">).values</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
        <span class="s1">df[</span><span class="s2">&quot;g&quot;</span><span class="s1">] = df.f.diff()</span>
        <span class="s0">assert not </span><span class="s1">hasattr(np</span><span class="s0">, </span><span class="s2">&quot;u8&quot;</span><span class="s1">)</span>
        <span class="s1">r = df.select_dtypes(include=[</span><span class="s2">&quot;i8&quot;</span><span class="s0">, </span><span class="s2">&quot;O&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">exclude=[</span><span class="s2">&quot;timedelta&quot;</span><span class="s1">])</span>
        <span class="s1">e = df[[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(r</span><span class="s0">, </span><span class="s1">e)</span>

        <span class="s1">r = df.select_dtypes(include=[</span><span class="s2">&quot;i8&quot;</span><span class="s0">, </span><span class="s2">&quot;O&quot;</span><span class="s0">, </span><span class="s2">&quot;timedelta64[ns]&quot;</span><span class="s1">])</span>
        <span class="s1">e = df[[</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s2">&quot;g&quot;</span><span class="s1">]]</span>
        <span class="s1">tm.assert_frame_equal(r</span><span class="s0">, </span><span class="s1">e)</span>

    <span class="s0">def </span><span class="s1">test_select_dtypes_empty(self):</span>
        <span class="s1">df = DataFrame({</span><span class="s2">&quot;a&quot;</span><span class="s1">: list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">: list(range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))})</span>
        <span class="s1">msg = </span><span class="s2">&quot;at least one of include or exclude must be nonempty&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">df.select_dtypes()</span>

    <span class="s0">def </span><span class="s1">test_select_dtypes_bad_datetime64(self):</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;a&quot;</span><span class="s1">: list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;b&quot;</span><span class="s1">: list(range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s2">&quot;c&quot;</span><span class="s1">: np.arange(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">6</span><span class="s1">).astype(</span><span class="s2">&quot;u1&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;d&quot;</span><span class="s1">: np.arange(</span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">7.0</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;float64&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;e&quot;</span><span class="s1">: [</span><span class="s0">True, False, True</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;f&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;now&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">).values</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;.+ is too specific&quot;</span><span class="s1">):</span>
            <span class="s1">df.select_dtypes(include=[</span><span class="s2">&quot;datetime64[D]&quot;</span><span class="s1">])</span>

        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;.+ is too specific&quot;</span><span class="s1">):</span>
            <span class="s1">df.select_dtypes(exclude=[</span><span class="s2">&quot;datetime64[as]&quot;</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_select_dtypes_datetime_with_tz(self):</span>

        <span class="s1">df2 = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;A&quot;</span><span class="s1">: Timestamp(</span><span class="s2">&quot;20130102&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;US/Eastern&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;B&quot;</span><span class="s1">: Timestamp(</span><span class="s2">&quot;20130603&quot;</span><span class="s0">, </span><span class="s1">tz=</span><span class="s2">&quot;CET&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">}</span><span class="s0">,</span>
            <span class="s1">index=range(</span><span class="s3">5</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">df3 = pd.concat([df2.A.to_frame()</span><span class="s0">, </span><span class="s1">df2.B.to_frame()]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">result = df3.select_dtypes(include=[</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="s1">])</span>
        <span class="s1">expected = df3.reindex(columns=[])</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;dtype&quot;</span><span class="s0">, </span><span class="s1">[str</span><span class="s0">, </span><span class="s2">&quot;str&quot;</span><span class="s0">, </span><span class="s1">np.string_</span><span class="s0">, </span><span class="s2">&quot;S1&quot;</span><span class="s0">, </span><span class="s2">&quot;unicode&quot;</span><span class="s0">, </span><span class="s1">np.unicode_</span><span class="s0">, </span><span class="s2">&quot;U1&quot;</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;arg&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;include&quot;</span><span class="s0">, </span><span class="s2">&quot;exclude&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_select_dtypes_str_raises(self</span><span class="s0">, </span><span class="s1">dtype</span><span class="s0">, </span><span class="s1">arg):</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;a&quot;</span><span class="s1">: list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;g&quot;</span><span class="s1">: list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;b&quot;</span><span class="s1">: list(range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s2">&quot;c&quot;</span><span class="s1">: np.arange(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">6</span><span class="s1">).astype(</span><span class="s2">&quot;u1&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;d&quot;</span><span class="s1">: np.arange(</span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">7.0</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;float64&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;e&quot;</span><span class="s1">: [</span><span class="s0">True, False, True</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;f&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;now&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">).values</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
        <span class="s1">msg = </span><span class="s2">&quot;string dtypes are not allowed&quot;</span>
        <span class="s1">kwargs = {arg: [dtype]}</span>

        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">df.select_dtypes(**kwargs)</span>

    <span class="s0">def </span><span class="s1">test_select_dtypes_bad_arg_raises(self):</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s2">&quot;a&quot;</span><span class="s1">: list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;g&quot;</span><span class="s1">: list(</span><span class="s2">&quot;abc&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;b&quot;</span><span class="s1">: list(range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s2">&quot;c&quot;</span><span class="s1">: np.arange(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">6</span><span class="s1">).astype(</span><span class="s2">&quot;u1&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;d&quot;</span><span class="s1">: np.arange(</span><span class="s3">4.0</span><span class="s0">, </span><span class="s3">7.0</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;float64&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s2">&quot;e&quot;</span><span class="s1">: [</span><span class="s0">True, False, True</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s2">&quot;f&quot;</span><span class="s1">: pd.date_range(</span><span class="s2">&quot;now&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s3">3</span><span class="s1">).values</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>

        <span class="s1">msg = </span><span class="s2">&quot;data type.*not understood&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">df.select_dtypes([</span><span class="s2">&quot;blargy, blarg, blarg&quot;</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_select_dtypes_typecodes(self):</span>
        <span class="s4"># GH 11990</span>
        <span class="s1">df = tm.makeCustomDataframe(</span><span class="s3">30</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s1">data_gen_f=</span><span class="s0">lambda </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y: np.random.random())</span>
        <span class="s1">expected = df</span>
        <span class="s1">FLOAT_TYPES = list(np.typecodes[</span><span class="s2">&quot;AllFloat&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_frame_equal(df.select_dtypes(FLOAT_TYPES)</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;arr,expected&quot;</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s1">(np.array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.int32)</span><span class="s0">, True</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(pd.array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s2">&quot;Int32&quot;</span><span class="s1">)</span><span class="s0">, True</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(DummyArray([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=DummyDtype(numeric=</span><span class="s0">True</span><span class="s1">))</span><span class="s0">, True</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(DummyArray([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=DummyDtype(numeric=</span><span class="s0">False</span><span class="s1">))</span><span class="s0">, False</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_select_dtypes_numeric(self</span><span class="s0">, </span><span class="s1">arr</span><span class="s0">, </span><span class="s1">expected):</span>
        <span class="s4"># GH 35340</span>

        <span class="s1">df = DataFrame(arr)</span>
        <span class="s1">is_selected = df.select_dtypes(np.number).shape == df.shape</span>
        <span class="s0">assert </span><span class="s1">is_selected == expected</span>

    <span class="s0">def </span><span class="s1">test_select_dtypes_numeric_nullable_string(self</span><span class="s0">, </span><span class="s1">nullable_string_dtype):</span>
        <span class="s1">arr = pd.array([</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s2">&quot;b&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=nullable_string_dtype)</span>
        <span class="s1">df = DataFrame(arr)</span>
        <span class="s1">is_selected = df.select_dtypes(np.number).shape == df.shape</span>
        <span class="s0">assert not </span><span class="s1">is_selected</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;expected, float_dtypes&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">[</span>
                <span class="s1">DataFrame(</span>
                    <span class="s1">{</span><span class="s2">&quot;A&quot;</span><span class="s1">: range(</span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: range(</span><span class="s3">5</span><span class="s0">, </span><span class="s3">8</span><span class="s1">)</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s1">: range(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)}</span>
                <span class="s1">).astype(dtype={</span><span class="s2">&quot;A&quot;</span><span class="s1">: float</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: np.float64</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s1">: np.float32})</span><span class="s0">,</span>
                <span class="s1">float</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span>
                <span class="s1">DataFrame(</span>
                    <span class="s1">{</span><span class="s2">&quot;A&quot;</span><span class="s1">: range(</span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: range(</span><span class="s3">5</span><span class="s0">, </span><span class="s3">8</span><span class="s1">)</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s1">: range(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)}</span>
                <span class="s1">).astype(dtype={</span><span class="s2">&quot;A&quot;</span><span class="s1">: float</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: np.float64</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s1">: np.float32})</span><span class="s0">,</span>
                <span class="s2">&quot;float&quot;</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[DataFrame({</span><span class="s2">&quot;C&quot;</span><span class="s1">: range(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)}</span><span class="s0">, </span><span class="s1">dtype=np.float32)</span><span class="s0">, </span><span class="s1">np.float32]</span><span class="s0">,</span>
            <span class="s1">[</span>
                <span class="s1">DataFrame({</span><span class="s2">&quot;A&quot;</span><span class="s1">: range(</span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: range(</span><span class="s3">5</span><span class="s0">, </span><span class="s3">8</span><span class="s1">)}).astype(</span>
                    <span class="s1">dtype={</span><span class="s2">&quot;A&quot;</span><span class="s1">: float</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: np.float64}</span>
                <span class="s1">)</span><span class="s0">,</span>
                <span class="s1">np.float64</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_select_dtypes_float_dtype(self</span><span class="s0">, </span><span class="s1">expected</span><span class="s0">, </span><span class="s1">float_dtypes):</span>
        <span class="s4"># GH#42452</span>
        <span class="s1">dtype_dict = {</span><span class="s2">&quot;A&quot;</span><span class="s1">: float</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: np.float64</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s1">: np.float32}</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span><span class="s2">&quot;A&quot;</span><span class="s1">: range(</span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: range(</span><span class="s3">5</span><span class="s0">, </span><span class="s3">8</span><span class="s1">)</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s1">: range(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)}</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">df = df.astype(dtype_dict)</span>
        <span class="s1">result = df.select_dtypes(include=float_dtypes)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>
</pre>
</body>
</html>