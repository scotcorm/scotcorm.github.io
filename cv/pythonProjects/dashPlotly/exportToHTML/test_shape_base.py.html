<html>
<head>
<title>test_shape_base.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #629755; font-style: italic;}
.s4 { color: #808080;}
.s5 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_shape_base.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy.core </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">array</span><span class="s0">, </span><span class="s1">arange</span><span class="s0">, </span><span class="s1">atleast_1d</span><span class="s0">, </span><span class="s1">atleast_2d</span><span class="s0">, </span><span class="s1">atleast_3d</span><span class="s0">, </span><span class="s1">block</span><span class="s0">, </span><span class="s1">vstack</span><span class="s0">, </span><span class="s1">hstack</span><span class="s0">,</span>
    <span class="s1">newaxis</span><span class="s0">, </span><span class="s1">concatenate</span><span class="s0">, </span><span class="s1">stack</span>
    <span class="s1">)</span>
<span class="s0">from </span><span class="s1">numpy.core.shape_base </span><span class="s0">import </span><span class="s1">(_block_dispatcher</span><span class="s0">, </span><span class="s1">_block_setup</span><span class="s0">,</span>
                                   <span class="s1">_block_concatenate</span><span class="s0">, </span><span class="s1">_block_slicing)</span>
<span class="s0">from </span><span class="s1">numpy.testing </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">assert_</span><span class="s0">, </span><span class="s1">assert_raises</span><span class="s0">, </span><span class="s1">assert_array_equal</span><span class="s0">, </span><span class="s1">assert_equal</span><span class="s0">,</span>
    <span class="s1">assert_raises_regex</span><span class="s0">, </span><span class="s1">assert_warns</span><span class="s0">, </span><span class="s1">IS_PYPY</span>
    <span class="s1">)</span>


<span class="s0">class </span><span class="s1">TestAtleast1d:</span>
    <span class="s0">def </span><span class="s1">test_0D_array(self):</span>
        <span class="s1">a = array(</span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">b = array(</span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">res = [atleast_1d(a)</span><span class="s0">, </span><span class="s1">atleast_1d(b)]</span>
        <span class="s1">desired = [array([</span><span class="s2">1</span><span class="s1">])</span><span class="s0">, </span><span class="s1">array([</span><span class="s2">2</span><span class="s1">])]</span>
        <span class="s1">assert_array_equal(res</span><span class="s0">, </span><span class="s1">desired)</span>

    <span class="s0">def </span><span class="s1">test_1D_array(self):</span>
        <span class="s1">a = array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">b = array([</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span>
        <span class="s1">res = [atleast_1d(a)</span><span class="s0">, </span><span class="s1">atleast_1d(b)]</span>
        <span class="s1">desired = [array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span><span class="s0">, </span><span class="s1">array([</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])]</span>
        <span class="s1">assert_array_equal(res</span><span class="s0">, </span><span class="s1">desired)</span>

    <span class="s0">def </span><span class="s1">test_2D_array(self):</span>
        <span class="s1">a = array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">b = array([[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]])</span>
        <span class="s1">res = [atleast_1d(a)</span><span class="s0">, </span><span class="s1">atleast_1d(b)]</span>
        <span class="s1">desired = [a</span><span class="s0">, </span><span class="s1">b]</span>
        <span class="s1">assert_array_equal(res</span><span class="s0">, </span><span class="s1">desired)</span>

    <span class="s0">def </span><span class="s1">test_3D_array(self):</span>
        <span class="s1">a = array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">b = array([[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]])</span>
        <span class="s1">a = array([a</span><span class="s0">, </span><span class="s1">a])</span>
        <span class="s1">b = array([b</span><span class="s0">, </span><span class="s1">b])</span>
        <span class="s1">res = [atleast_1d(a)</span><span class="s0">, </span><span class="s1">atleast_1d(b)]</span>
        <span class="s1">desired = [a</span><span class="s0">, </span><span class="s1">b]</span>
        <span class="s1">assert_array_equal(res</span><span class="s0">, </span><span class="s1">desired)</span>

    <span class="s0">def </span><span class="s1">test_r1array(self):</span>
        <span class="s3">&quot;&quot;&quot; Test to make sure equivalent Travis O's r1array function 
        &quot;&quot;&quot;</span>
        <span class="s1">assert_(atleast_1d(</span><span class="s2">3</span><span class="s1">).shape == (</span><span class="s2">1</span><span class="s0">,</span><span class="s1">))</span>
        <span class="s1">assert_(atleast_1d(</span><span class="s2">3j</span><span class="s1">).shape == (</span><span class="s2">1</span><span class="s0">,</span><span class="s1">))</span>
        <span class="s1">assert_(atleast_1d(</span><span class="s2">3.0</span><span class="s1">).shape == (</span><span class="s2">1</span><span class="s0">,</span><span class="s1">))</span>
        <span class="s1">assert_(atleast_1d([[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]]).shape == (</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>


<span class="s0">class </span><span class="s1">TestAtleast2d:</span>
    <span class="s0">def </span><span class="s1">test_0D_array(self):</span>
        <span class="s1">a = array(</span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">b = array(</span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">res = [atleast_2d(a)</span><span class="s0">, </span><span class="s1">atleast_2d(b)]</span>
        <span class="s1">desired = [array([[</span><span class="s2">1</span><span class="s1">]])</span><span class="s0">, </span><span class="s1">array([[</span><span class="s2">2</span><span class="s1">]])]</span>
        <span class="s1">assert_array_equal(res</span><span class="s0">, </span><span class="s1">desired)</span>

    <span class="s0">def </span><span class="s1">test_1D_array(self):</span>
        <span class="s1">a = array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">b = array([</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span>
        <span class="s1">res = [atleast_2d(a)</span><span class="s0">, </span><span class="s1">atleast_2d(b)]</span>
        <span class="s1">desired = [array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]])</span><span class="s0">, </span><span class="s1">array([[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]])]</span>
        <span class="s1">assert_array_equal(res</span><span class="s0">, </span><span class="s1">desired)</span>

    <span class="s0">def </span><span class="s1">test_2D_array(self):</span>
        <span class="s1">a = array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">b = array([[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]])</span>
        <span class="s1">res = [atleast_2d(a)</span><span class="s0">, </span><span class="s1">atleast_2d(b)]</span>
        <span class="s1">desired = [a</span><span class="s0">, </span><span class="s1">b]</span>
        <span class="s1">assert_array_equal(res</span><span class="s0">, </span><span class="s1">desired)</span>

    <span class="s0">def </span><span class="s1">test_3D_array(self):</span>
        <span class="s1">a = array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">b = array([[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]])</span>
        <span class="s1">a = array([a</span><span class="s0">, </span><span class="s1">a])</span>
        <span class="s1">b = array([b</span><span class="s0">, </span><span class="s1">b])</span>
        <span class="s1">res = [atleast_2d(a)</span><span class="s0">, </span><span class="s1">atleast_2d(b)]</span>
        <span class="s1">desired = [a</span><span class="s0">, </span><span class="s1">b]</span>
        <span class="s1">assert_array_equal(res</span><span class="s0">, </span><span class="s1">desired)</span>

    <span class="s0">def </span><span class="s1">test_r2array(self):</span>
        <span class="s3">&quot;&quot;&quot; Test to make sure equivalent Travis O's r2array function 
        &quot;&quot;&quot;</span>
        <span class="s1">assert_(atleast_2d(</span><span class="s2">3</span><span class="s1">).shape == (</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">))</span>
        <span class="s1">assert_(atleast_2d([</span><span class="s2">3j</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]).shape == (</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>
        <span class="s1">assert_(atleast_2d([[[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]]]).shape == (</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>


<span class="s0">class </span><span class="s1">TestAtleast3d:</span>
    <span class="s0">def </span><span class="s1">test_0D_array(self):</span>
        <span class="s1">a = array(</span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">b = array(</span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">res = [atleast_3d(a)</span><span class="s0">, </span><span class="s1">atleast_3d(b)]</span>
        <span class="s1">desired = [array([[[</span><span class="s2">1</span><span class="s1">]]])</span><span class="s0">, </span><span class="s1">array([[[</span><span class="s2">2</span><span class="s1">]]])]</span>
        <span class="s1">assert_array_equal(res</span><span class="s0">, </span><span class="s1">desired)</span>

    <span class="s0">def </span><span class="s1">test_1D_array(self):</span>
        <span class="s1">a = array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">b = array([</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span>
        <span class="s1">res = [atleast_3d(a)</span><span class="s0">, </span><span class="s1">atleast_3d(b)]</span>
        <span class="s1">desired = [array([[[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s1">]]])</span><span class="s0">, </span><span class="s1">array([[[</span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3</span><span class="s1">]]])]</span>
        <span class="s1">assert_array_equal(res</span><span class="s0">, </span><span class="s1">desired)</span>

    <span class="s0">def </span><span class="s1">test_2D_array(self):</span>
        <span class="s1">a = array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">b = array([[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]])</span>
        <span class="s1">res = [atleast_3d(a)</span><span class="s0">, </span><span class="s1">atleast_3d(b)]</span>
        <span class="s1">desired = [a[:</span><span class="s0">,</span><span class="s1">:</span><span class="s0">, </span><span class="s1">newaxis]</span><span class="s0">, </span><span class="s1">b[:</span><span class="s0">,</span><span class="s1">:</span><span class="s0">, </span><span class="s1">newaxis]]</span>
        <span class="s1">assert_array_equal(res</span><span class="s0">, </span><span class="s1">desired)</span>

    <span class="s0">def </span><span class="s1">test_3D_array(self):</span>
        <span class="s1">a = array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">b = array([[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]])</span>
        <span class="s1">a = array([a</span><span class="s0">, </span><span class="s1">a])</span>
        <span class="s1">b = array([b</span><span class="s0">, </span><span class="s1">b])</span>
        <span class="s1">res = [atleast_3d(a)</span><span class="s0">, </span><span class="s1">atleast_3d(b)]</span>
        <span class="s1">desired = [a</span><span class="s0">, </span><span class="s1">b]</span>
        <span class="s1">assert_array_equal(res</span><span class="s0">, </span><span class="s1">desired)</span>


<span class="s0">class </span><span class="s1">TestHstack:</span>
    <span class="s0">def </span><span class="s1">test_non_iterable(self):</span>
        <span class="s1">assert_raises(TypeError</span><span class="s0">, </span><span class="s1">hstack</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_empty_input(self):</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">hstack</span><span class="s0">, </span><span class="s1">())</span>

    <span class="s0">def </span><span class="s1">test_0D_array(self):</span>
        <span class="s1">a = array(</span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">b = array(</span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">res = hstack([a</span><span class="s0">, </span><span class="s1">b])</span>
        <span class="s1">desired = array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(res</span><span class="s0">, </span><span class="s1">desired)</span>

    <span class="s0">def </span><span class="s1">test_1D_array(self):</span>
        <span class="s1">a = array([</span><span class="s2">1</span><span class="s1">])</span>
        <span class="s1">b = array([</span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">res = hstack([a</span><span class="s0">, </span><span class="s1">b])</span>
        <span class="s1">desired = array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(res</span><span class="s0">, </span><span class="s1">desired)</span>

    <span class="s0">def </span><span class="s1">test_2D_array(self):</span>
        <span class="s1">a = array([[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">b = array([[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">res = hstack([a</span><span class="s0">, </span><span class="s1">b])</span>
        <span class="s1">desired = array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">assert_array_equal(res</span><span class="s0">, </span><span class="s1">desired)</span>

    <span class="s0">def </span><span class="s1">test_generator(self):</span>
        <span class="s0">with </span><span class="s1">assert_warns(FutureWarning):</span>
            <span class="s1">hstack((np.arange(</span><span class="s2">3</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">2</span><span class="s1">)))</span>
        <span class="s0">with </span><span class="s1">assert_warns(FutureWarning):</span>
            <span class="s1">hstack(map(</span><span class="s0">lambda </span><span class="s1">x: x</span><span class="s0">, </span><span class="s1">np.ones((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))))</span>


<span class="s0">class </span><span class="s1">TestVstack:</span>
    <span class="s0">def </span><span class="s1">test_non_iterable(self):</span>
        <span class="s1">assert_raises(TypeError</span><span class="s0">, </span><span class="s1">vstack</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_empty_input(self):</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">vstack</span><span class="s0">, </span><span class="s1">())</span>

    <span class="s0">def </span><span class="s1">test_0D_array(self):</span>
        <span class="s1">a = array(</span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">b = array(</span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">res = vstack([a</span><span class="s0">, </span><span class="s1">b])</span>
        <span class="s1">desired = array([[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">assert_array_equal(res</span><span class="s0">, </span><span class="s1">desired)</span>

    <span class="s0">def </span><span class="s1">test_1D_array(self):</span>
        <span class="s1">a = array([</span><span class="s2">1</span><span class="s1">])</span>
        <span class="s1">b = array([</span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">res = vstack([a</span><span class="s0">, </span><span class="s1">b])</span>
        <span class="s1">desired = array([[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">assert_array_equal(res</span><span class="s0">, </span><span class="s1">desired)</span>

    <span class="s0">def </span><span class="s1">test_2D_array(self):</span>
        <span class="s1">a = array([[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">b = array([[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">res = vstack([a</span><span class="s0">, </span><span class="s1">b])</span>
        <span class="s1">desired = array([[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">assert_array_equal(res</span><span class="s0">, </span><span class="s1">desired)</span>

    <span class="s0">def </span><span class="s1">test_2D_array2(self):</span>
        <span class="s1">a = array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">b = array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">res = vstack([a</span><span class="s0">, </span><span class="s1">b])</span>
        <span class="s1">desired = array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">assert_array_equal(res</span><span class="s0">, </span><span class="s1">desired)</span>

    <span class="s0">def </span><span class="s1">test_generator(self):</span>
        <span class="s0">with </span><span class="s1">assert_warns(FutureWarning):</span>
            <span class="s1">vstack((np.arange(</span><span class="s2">3</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">2</span><span class="s1">)))</span>


<span class="s0">class </span><span class="s1">TestConcatenate:</span>
    <span class="s0">def </span><span class="s1">test_returns_copy(self):</span>
        <span class="s1">a = np.eye(</span><span class="s2">3</span><span class="s1">)</span>
        <span class="s1">b = np.concatenate([a])</span>
        <span class="s1">b[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">] = </span><span class="s2">2</span>
        <span class="s0">assert </span><span class="s1">b[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">] != a[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span>

    <span class="s0">def </span><span class="s1">test_exceptions(self):</span>
        <span class="s4"># test axis must be in bounds</span>
        <span class="s0">for </span><span class="s1">ndim </span><span class="s0">in </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]:</span>
            <span class="s1">a = np.ones((</span><span class="s2">1</span><span class="s0">,</span><span class="s1">)*ndim)</span>
            <span class="s1">np.concatenate((a</span><span class="s0">, </span><span class="s1">a)</span><span class="s0">, </span><span class="s1">axis=</span><span class="s2">0</span><span class="s1">)  </span><span class="s4"># OK</span>
            <span class="s1">assert_raises(np.AxisError</span><span class="s0">, </span><span class="s1">np.concatenate</span><span class="s0">, </span><span class="s1">(a</span><span class="s0">, </span><span class="s1">a)</span><span class="s0">, </span><span class="s1">axis=ndim)</span>
            <span class="s1">assert_raises(np.AxisError</span><span class="s0">, </span><span class="s1">np.concatenate</span><span class="s0">, </span><span class="s1">(a</span><span class="s0">, </span><span class="s1">a)</span><span class="s0">, </span><span class="s1">axis=-(ndim + </span><span class="s2">1</span><span class="s1">))</span>

        <span class="s4"># Scalars cannot be concatenated</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">concatenate</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">,</span><span class="s1">))</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">concatenate</span><span class="s0">, </span><span class="s1">(np.array(</span><span class="s2">0</span><span class="s1">)</span><span class="s0">,</span><span class="s1">))</span>

        <span class="s4"># dimensionality must match</span>
        <span class="s1">assert_raises_regex(</span>
            <span class="s1">ValueError</span><span class="s0">,</span>
            <span class="s5">r&quot;all the input arrays must have same number of dimensions, but &quot;</span>
            <span class="s5">r&quot;the array at index 0 has 1 dimension\(s\) and the array at &quot;</span>
            <span class="s5">r&quot;index 1 has 2 dimension\(s\)&quot;</span><span class="s0">,</span>
            <span class="s1">np.concatenate</span><span class="s0">, </span><span class="s1">(np.zeros(</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.zeros((</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">))))</span>

        <span class="s4"># test shapes must match except for concatenation axis</span>
        <span class="s1">a = np.ones((</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>
        <span class="s1">b = np.ones((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>
        <span class="s1">axis = list(range(</span><span class="s2">3</span><span class="s1">))</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">3</span><span class="s1">):</span>
            <span class="s1">np.concatenate((a</span><span class="s0">, </span><span class="s1">b)</span><span class="s0">, </span><span class="s1">axis=axis[</span><span class="s2">0</span><span class="s1">])  </span><span class="s4"># OK</span>
            <span class="s1">assert_raises_regex(</span>
                <span class="s1">ValueError</span><span class="s0">,</span>
                <span class="s5">&quot;all the input array dimensions for the concatenation axis &quot;</span>
                <span class="s5">&quot;must match exactly, but along dimension {}, the array at &quot;</span>
                <span class="s5">&quot;index 0 has size 1 and the array at index 1 has size 2&quot;</span>
                <span class="s1">.format(i)</span><span class="s0">,</span>
                <span class="s1">np.concatenate</span><span class="s0">, </span><span class="s1">(a</span><span class="s0">, </span><span class="s1">b)</span><span class="s0">, </span><span class="s1">axis=axis[</span><span class="s2">1</span><span class="s1">])</span>
            <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">np.concatenate</span><span class="s0">, </span><span class="s1">(a</span><span class="s0">, </span><span class="s1">b)</span><span class="s0">, </span><span class="s1">axis=axis[</span><span class="s2">2</span><span class="s1">])</span>
            <span class="s1">a = np.moveaxis(a</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
            <span class="s1">b = np.moveaxis(b</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
            <span class="s1">axis.append(axis.pop(</span><span class="s2">0</span><span class="s1">))</span>

        <span class="s4"># No arrays to concatenate raises ValueError</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">concatenate</span><span class="s0">, </span><span class="s1">())</span>

    <span class="s0">def </span><span class="s1">test_concatenate_axis_None(self):</span>
        <span class="s1">a = np.arange(</span><span class="s2">4</span><span class="s0">, </span><span class="s1">dtype=np.float64).reshape((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>
        <span class="s1">b = list(range(</span><span class="s2">3</span><span class="s1">))</span>
        <span class="s1">c = [</span><span class="s5">'x'</span><span class="s1">]</span>
        <span class="s1">r = np.concatenate((a</span><span class="s0">, </span><span class="s1">a)</span><span class="s0">, </span><span class="s1">axis=</span><span class="s0">None</span><span class="s1">)</span>
        <span class="s1">assert_equal(r.dtype</span><span class="s0">, </span><span class="s1">a.dtype)</span>
        <span class="s1">assert_equal(r.ndim</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">r = np.concatenate((a</span><span class="s0">, </span><span class="s1">b)</span><span class="s0">, </span><span class="s1">axis=</span><span class="s0">None</span><span class="s1">)</span>
        <span class="s1">assert_equal(r.size</span><span class="s0">, </span><span class="s1">a.size + len(b))</span>
        <span class="s1">assert_equal(r.dtype</span><span class="s0">, </span><span class="s1">a.dtype)</span>
        <span class="s1">r = np.concatenate((a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">c)</span><span class="s0">, </span><span class="s1">axis=</span><span class="s0">None, </span><span class="s1">dtype=</span><span class="s5">&quot;U&quot;</span><span class="s1">)</span>
        <span class="s1">d = array([</span><span class="s5">'0.0'</span><span class="s0">, </span><span class="s5">'1.0'</span><span class="s0">, </span><span class="s5">'2.0'</span><span class="s0">, </span><span class="s5">'3.0'</span><span class="s0">,</span>
                   <span class="s5">'0'</span><span class="s0">, </span><span class="s5">'1'</span><span class="s0">, </span><span class="s5">'2'</span><span class="s0">, </span><span class="s5">'x'</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(r</span><span class="s0">, </span><span class="s1">d)</span>

        <span class="s1">out = np.zeros(a.size + len(b))</span>
        <span class="s1">r = np.concatenate((a</span><span class="s0">, </span><span class="s1">b)</span><span class="s0">, </span><span class="s1">axis=</span><span class="s0">None</span><span class="s1">)</span>
        <span class="s1">rout = np.concatenate((a</span><span class="s0">, </span><span class="s1">b)</span><span class="s0">, </span><span class="s1">axis=</span><span class="s0">None, </span><span class="s1">out=out)</span>
        <span class="s1">assert_(out </span><span class="s0">is </span><span class="s1">rout)</span>
        <span class="s1">assert_equal(r</span><span class="s0">, </span><span class="s1">rout)</span>

    <span class="s0">def </span><span class="s1">test_large_concatenate_axis_None(self):</span>
        <span class="s4"># When no axis is given, concatenate uses flattened versions.</span>
        <span class="s4"># This also had a bug with many arrays (see gh-5979).</span>
        <span class="s1">x = np.arange(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">100</span><span class="s1">)</span>
        <span class="s1">r = np.concatenate(x</span><span class="s0">, None</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(x</span><span class="s0">, </span><span class="s1">r)</span>

        <span class="s4"># This should probably be deprecated:</span>
        <span class="s1">r = np.concatenate(x</span><span class="s0">, </span><span class="s2">100</span><span class="s1">)  </span><span class="s4"># axis is &gt;= MAXDIMS</span>
        <span class="s1">assert_array_equal(x</span><span class="s0">, </span><span class="s1">r)</span>

    <span class="s0">def </span><span class="s1">test_concatenate(self):</span>
        <span class="s4"># Test concatenate function</span>
        <span class="s4"># One sequence returns unmodified (but as array)</span>
        <span class="s1">r4 = list(range(</span><span class="s2">4</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(concatenate((r4</span><span class="s0">,</span><span class="s1">))</span><span class="s0">, </span><span class="s1">r4)</span>
        <span class="s4"># Any sequence</span>
        <span class="s1">assert_array_equal(concatenate((tuple(r4)</span><span class="s0">,</span><span class="s1">))</span><span class="s0">, </span><span class="s1">r4)</span>
        <span class="s1">assert_array_equal(concatenate((array(r4)</span><span class="s0">,</span><span class="s1">))</span><span class="s0">, </span><span class="s1">r4)</span>
        <span class="s4"># 1D default concatenation</span>
        <span class="s1">r3 = list(range(</span><span class="s2">3</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(concatenate((r4</span><span class="s0">, </span><span class="s1">r3))</span><span class="s0">, </span><span class="s1">r4 + r3)</span>
        <span class="s4"># Mixed sequence types</span>
        <span class="s1">assert_array_equal(concatenate((tuple(r4)</span><span class="s0">, </span><span class="s1">r3))</span><span class="s0">, </span><span class="s1">r4 + r3)</span>
        <span class="s1">assert_array_equal(concatenate((array(r4)</span><span class="s0">, </span><span class="s1">r3))</span><span class="s0">, </span><span class="s1">r4 + r3)</span>
        <span class="s4"># Explicit axis specification</span>
        <span class="s1">assert_array_equal(concatenate((r4</span><span class="s0">, </span><span class="s1">r3)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">r4 + r3)</span>
        <span class="s4"># Including negative</span>
        <span class="s1">assert_array_equal(concatenate((r4</span><span class="s0">, </span><span class="s1">r3)</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">r4 + r3)</span>
        <span class="s4"># 2D</span>
        <span class="s1">a23 = array([[</span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">13</span><span class="s0">, </span><span class="s2">14</span><span class="s0">, </span><span class="s2">15</span><span class="s1">]])</span>
        <span class="s1">a13 = array([[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">res = array([[</span><span class="s2">10</span><span class="s0">, </span><span class="s2">11</span><span class="s0">, </span><span class="s2">12</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">13</span><span class="s0">, </span><span class="s2">14</span><span class="s0">, </span><span class="s2">15</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">assert_array_equal(concatenate((a23</span><span class="s0">, </span><span class="s1">a13))</span><span class="s0">, </span><span class="s1">res)</span>
        <span class="s1">assert_array_equal(concatenate((a23</span><span class="s0">, </span><span class="s1">a13)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">res)</span>
        <span class="s1">assert_array_equal(concatenate((a23.T</span><span class="s0">, </span><span class="s1">a13.T)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">res.T)</span>
        <span class="s1">assert_array_equal(concatenate((a23.T</span><span class="s0">, </span><span class="s1">a13.T)</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">res.T)</span>
        <span class="s4"># Arrays much match shape</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">concatenate</span><span class="s0">, </span><span class="s1">(a23.T</span><span class="s0">, </span><span class="s1">a13.T)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
        <span class="s4"># 3D</span>
        <span class="s1">res = arange(</span><span class="s2">2 </span><span class="s1">* </span><span class="s2">3 </span><span class="s1">* </span><span class="s2">7</span><span class="s1">).reshape((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">7</span><span class="s1">))</span>
        <span class="s1">a0 = res[...</span><span class="s0">, </span><span class="s1">:</span><span class="s2">4</span><span class="s1">]</span>
        <span class="s1">a1 = res[...</span><span class="s0">, </span><span class="s2">4</span><span class="s1">:</span><span class="s2">6</span><span class="s1">]</span>
        <span class="s1">a2 = res[...</span><span class="s0">, </span><span class="s2">6</span><span class="s1">:]</span>
        <span class="s1">assert_array_equal(concatenate((a0</span><span class="s0">, </span><span class="s1">a1</span><span class="s0">, </span><span class="s1">a2)</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">res)</span>
        <span class="s1">assert_array_equal(concatenate((a0</span><span class="s0">, </span><span class="s1">a1</span><span class="s0">, </span><span class="s1">a2)</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">res)</span>
        <span class="s1">assert_array_equal(concatenate((a0.T</span><span class="s0">, </span><span class="s1">a1.T</span><span class="s0">, </span><span class="s1">a2.T)</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">res.T)</span>

        <span class="s1">out = res.copy()</span>
        <span class="s1">rout = concatenate((a0</span><span class="s0">, </span><span class="s1">a1</span><span class="s0">, </span><span class="s1">a2)</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">out=out)</span>
        <span class="s1">assert_(out </span><span class="s0">is </span><span class="s1">rout)</span>
        <span class="s1">assert_equal(res</span><span class="s0">, </span><span class="s1">rout)</span>

    <span class="s1">@pytest.mark.skipif(IS_PYPY</span><span class="s0">, </span><span class="s1">reason=</span><span class="s5">&quot;PYPY handles sq_concat, nb_add differently than cpython&quot;</span><span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_operator_concat(self):</span>
        <span class="s0">import </span><span class="s1">operator</span>
        <span class="s1">a = array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">b = array([</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">])</span>
        <span class="s1">n = [</span><span class="s2">1</span><span class="s0">,</span><span class="s2">2</span><span class="s1">]</span>
        <span class="s1">res = array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">])</span>
        <span class="s1">assert_raises(TypeError</span><span class="s0">, </span><span class="s1">operator.concat</span><span class="s0">, </span><span class="s1">a</span><span class="s0">, </span><span class="s1">b)</span>
        <span class="s1">assert_raises(TypeError</span><span class="s0">, </span><span class="s1">operator.concat</span><span class="s0">, </span><span class="s1">a</span><span class="s0">, </span><span class="s1">n)</span>
        <span class="s1">assert_raises(TypeError</span><span class="s0">, </span><span class="s1">operator.concat</span><span class="s0">, </span><span class="s1">n</span><span class="s0">, </span><span class="s1">a)</span>
        <span class="s1">assert_raises(TypeError</span><span class="s0">, </span><span class="s1">operator.concat</span><span class="s0">, </span><span class="s1">a</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
        <span class="s1">assert_raises(TypeError</span><span class="s0">, </span><span class="s1">operator.concat</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">a)</span>

    <span class="s0">def </span><span class="s1">test_bad_out_shape(self):</span>
        <span class="s1">a = array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">b = array([</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">])</span>

        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">concatenate</span><span class="s0">, </span><span class="s1">(a</span><span class="s0">, </span><span class="s1">b)</span><span class="s0">, </span><span class="s1">out=np.empty(</span><span class="s2">5</span><span class="s1">))</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">concatenate</span><span class="s0">, </span><span class="s1">(a</span><span class="s0">, </span><span class="s1">b)</span><span class="s0">, </span><span class="s1">out=np.empty((</span><span class="s2">4</span><span class="s0">,</span><span class="s2">1</span><span class="s1">)))</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">concatenate</span><span class="s0">, </span><span class="s1">(a</span><span class="s0">, </span><span class="s1">b)</span><span class="s0">, </span><span class="s1">out=np.empty((</span><span class="s2">1</span><span class="s0">,</span><span class="s2">4</span><span class="s1">)))</span>
        <span class="s1">concatenate((a</span><span class="s0">, </span><span class="s1">b)</span><span class="s0">, </span><span class="s1">out=np.empty(</span><span class="s2">4</span><span class="s1">))</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s5">&quot;axis&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s2">0</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s5">&quot;out_dtype&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s5">&quot;c8&quot;</span><span class="s0">, </span><span class="s5">&quot;f4&quot;</span><span class="s0">, </span><span class="s5">&quot;f8&quot;</span><span class="s0">, </span><span class="s5">&quot;&gt;f8&quot;</span><span class="s0">, </span><span class="s5">&quot;i8&quot;</span><span class="s0">, </span><span class="s5">&quot;S4&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s5">&quot;casting&quot;</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s5">'no'</span><span class="s0">, </span><span class="s5">'equiv'</span><span class="s0">, </span><span class="s5">'safe'</span><span class="s0">, </span><span class="s5">'same_kind'</span><span class="s0">, </span><span class="s5">'unsafe'</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_out_and_dtype(self</span><span class="s0">, </span><span class="s1">axis</span><span class="s0">, </span><span class="s1">out_dtype</span><span class="s0">, </span><span class="s1">casting):</span>
        <span class="s4"># Compare usage of `out=out` with `dtype=out.dtype`</span>
        <span class="s1">out = np.empty(</span><span class="s2">4</span><span class="s0">, </span><span class="s1">dtype=out_dtype)</span>
        <span class="s1">to_concat = (array([</span><span class="s2">1.1</span><span class="s0">, </span><span class="s2">2.2</span><span class="s1">])</span><span class="s0">, </span><span class="s1">array([</span><span class="s2">3.3</span><span class="s0">, </span><span class="s2">4.4</span><span class="s1">]))</span>

        <span class="s0">if not </span><span class="s1">np.can_cast(to_concat[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">out_dtype</span><span class="s0">, </span><span class="s1">casting=casting):</span>
            <span class="s0">with </span><span class="s1">assert_raises(TypeError):</span>
                <span class="s1">concatenate(to_concat</span><span class="s0">, </span><span class="s1">out=out</span><span class="s0">, </span><span class="s1">axis=axis</span><span class="s0">, </span><span class="s1">casting=casting)</span>
            <span class="s0">with </span><span class="s1">assert_raises(TypeError):</span>
                <span class="s1">concatenate(to_concat</span><span class="s0">, </span><span class="s1">dtype=out.dtype</span><span class="s0">,</span>
                            <span class="s1">axis=axis</span><span class="s0">, </span><span class="s1">casting=casting)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">res_out = concatenate(to_concat</span><span class="s0">, </span><span class="s1">out=out</span><span class="s0">,</span>
                                  <span class="s1">axis=axis</span><span class="s0">, </span><span class="s1">casting=casting)</span>
            <span class="s1">res_dtype = concatenate(to_concat</span><span class="s0">, </span><span class="s1">dtype=out.dtype</span><span class="s0">,</span>
                                    <span class="s1">axis=axis</span><span class="s0">, </span><span class="s1">casting=casting)</span>
            <span class="s0">assert </span><span class="s1">res_out </span><span class="s0">is </span><span class="s1">out</span>
            <span class="s1">assert_array_equal(out</span><span class="s0">, </span><span class="s1">res_dtype)</span>
            <span class="s0">assert </span><span class="s1">res_dtype.dtype == out_dtype</span>

        <span class="s0">with </span><span class="s1">assert_raises(TypeError):</span>
            <span class="s1">concatenate(to_concat</span><span class="s0">, </span><span class="s1">out=out</span><span class="s0">, </span><span class="s1">dtype=out_dtype</span><span class="s0">, </span><span class="s1">axis=axis)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s5">&quot;axis&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s2">0</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s5">&quot;string_dt&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s5">&quot;S&quot;</span><span class="s0">, </span><span class="s5">&quot;U&quot;</span><span class="s0">, </span><span class="s5">&quot;S0&quot;</span><span class="s0">, </span><span class="s5">&quot;U0&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s5">&quot;arrs&quot;</span><span class="s0">,</span>
            <span class="s1">[([</span><span class="s2">0.</span><span class="s1">]</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">([</span><span class="s2">0.</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s1">])</span><span class="s0">, </span><span class="s1">([</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">&quot;string&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1.</span><span class="s1">])])</span>
    <span class="s0">def </span><span class="s1">test_dtype_with_promotion(self</span><span class="s0">, </span><span class="s1">arrs</span><span class="s0">, </span><span class="s1">string_dt</span><span class="s0">, </span><span class="s1">axis):</span>
        <span class="s4"># Note that U0 and S0 should be deprecated eventually and changed to</span>
        <span class="s4"># actually give the empty string result (together with `np.array`)</span>
        <span class="s1">res = np.concatenate(arrs</span><span class="s0">, </span><span class="s1">axis=axis</span><span class="s0">, </span><span class="s1">dtype=string_dt</span><span class="s0">, </span><span class="s1">casting=</span><span class="s5">&quot;unsafe&quot;</span><span class="s1">)</span>
        <span class="s4"># The actual dtype should be identical to a cast (of a double array):</span>
        <span class="s0">assert </span><span class="s1">res.dtype == np.array(</span><span class="s2">1.</span><span class="s1">).astype(string_dt).dtype</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s5">&quot;axis&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s2">0</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_string_dtype_does_not_inspect(self</span><span class="s0">, </span><span class="s1">axis):</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError):</span>
            <span class="s1">np.concatenate(([</span><span class="s0">None</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s1">])</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s5">&quot;S&quot;</span><span class="s0">, </span><span class="s1">axis=axis)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError):</span>
            <span class="s1">np.concatenate(([</span><span class="s0">None</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s1">])</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s5">&quot;U&quot;</span><span class="s0">, </span><span class="s1">axis=axis)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s5">&quot;axis&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s2">0</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_subarray_error(self</span><span class="s0">, </span><span class="s1">axis):</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s5">&quot;.*subarray dtype&quot;</span><span class="s1">):</span>
            <span class="s1">np.concatenate(([</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s1">])</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s5">&quot;(2,)i&quot;</span><span class="s0">, </span><span class="s1">axis=axis)</span>


<span class="s0">def </span><span class="s1">test_stack():</span>
    <span class="s4"># non-iterable input</span>
    <span class="s1">assert_raises(TypeError</span><span class="s0">, </span><span class="s1">stack</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

    <span class="s4"># 0d input</span>
    <span class="s0">for </span><span class="s1">input_ </span><span class="s0">in </span><span class="s1">[(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">,</span>
                   <span class="s1">[np.int32(</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.int32(</span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.int32(</span><span class="s2">3</span><span class="s1">)]</span><span class="s0">,</span>
                   <span class="s1">[np.array(</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.array(</span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.array(</span><span class="s2">3</span><span class="s1">)]]:</span>
        <span class="s1">assert_array_equal(stack(input_)</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span>
    <span class="s4"># 1d input examples</span>
    <span class="s1">a = np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span>
    <span class="s1">b = np.array([</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s1">])</span>
    <span class="s1">r1 = array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]])</span>
    <span class="s1">assert_array_equal(np.stack((a</span><span class="s0">, </span><span class="s1">b))</span><span class="s0">, </span><span class="s1">r1)</span>
    <span class="s1">assert_array_equal(np.stack((a</span><span class="s0">, </span><span class="s1">b)</span><span class="s0">, </span><span class="s1">axis=</span><span class="s2">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">r1.T)</span>
    <span class="s4"># all input types</span>
    <span class="s1">assert_array_equal(np.stack(list([a</span><span class="s0">, </span><span class="s1">b]))</span><span class="s0">, </span><span class="s1">r1)</span>
    <span class="s1">assert_array_equal(np.stack(array([a</span><span class="s0">, </span><span class="s1">b]))</span><span class="s0">, </span><span class="s1">r1)</span>
    <span class="s4"># all shapes for 1d input</span>
    <span class="s1">arrays = [np.random.randn(</span><span class="s2">3</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">10</span><span class="s1">)]</span>
    <span class="s1">axes = [</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">2</span><span class="s1">]</span>
    <span class="s1">expected_shapes = [(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)]</span>
    <span class="s0">for </span><span class="s1">axis</span><span class="s0">, </span><span class="s1">expected_shape </span><span class="s0">in </span><span class="s1">zip(axes</span><span class="s0">, </span><span class="s1">expected_shapes):</span>
        <span class="s1">assert_equal(np.stack(arrays</span><span class="s0">, </span><span class="s1">axis).shape</span><span class="s0">, </span><span class="s1">expected_shape)</span>
    <span class="s1">assert_raises_regex(np.AxisError</span><span class="s0">, </span><span class="s5">'out of bounds'</span><span class="s0">, </span><span class="s1">stack</span><span class="s0">, </span><span class="s1">arrays</span><span class="s0">, </span><span class="s1">axis=</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s1">assert_raises_regex(np.AxisError</span><span class="s0">, </span><span class="s5">'out of bounds'</span><span class="s0">, </span><span class="s1">stack</span><span class="s0">, </span><span class="s1">arrays</span><span class="s0">, </span><span class="s1">axis=-</span><span class="s2">3</span><span class="s1">)</span>
    <span class="s4"># all shapes for 2d input</span>
    <span class="s1">arrays = [np.random.randn(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">10</span><span class="s1">)]</span>
    <span class="s1">axes = [</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">-</span><span class="s2">2</span><span class="s0">, </span><span class="s1">-</span><span class="s2">3</span><span class="s1">]</span>
    <span class="s1">expected_shapes = [(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)</span><span class="s0">,</span>
                       <span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)]</span>
    <span class="s0">for </span><span class="s1">axis</span><span class="s0">, </span><span class="s1">expected_shape </span><span class="s0">in </span><span class="s1">zip(axes</span><span class="s0">, </span><span class="s1">expected_shapes):</span>
        <span class="s1">assert_equal(np.stack(arrays</span><span class="s0">, </span><span class="s1">axis).shape</span><span class="s0">, </span><span class="s1">expected_shape)</span>
    <span class="s4"># empty arrays</span>
    <span class="s1">assert_(stack([[]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">[]]).shape == (</span><span class="s2">3</span><span class="s0">, </span><span class="s2">0</span><span class="s1">))</span>
    <span class="s1">assert_(stack([[]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">[]]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s2">1</span><span class="s1">).shape == (</span><span class="s2">0</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>
    <span class="s4"># out</span>
    <span class="s1">out = np.zeros_like(r1)</span>
    <span class="s1">np.stack((a</span><span class="s0">, </span><span class="s1">b)</span><span class="s0">, </span><span class="s1">out=out)</span>
    <span class="s1">assert_array_equal(out</span><span class="s0">, </span><span class="s1">r1)</span>
    <span class="s4"># edge cases</span>
    <span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s5">'need at least one array'</span><span class="s0">, </span><span class="s1">stack</span><span class="s0">, </span><span class="s1">[])</span>
    <span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s5">'must have the same shape'</span><span class="s0">,</span>
                        <span class="s1">stack</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s2">3</span><span class="s1">)])</span>
    <span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s5">'must have the same shape'</span><span class="s0">,</span>
                        <span class="s1">stack</span><span class="s0">, </span><span class="s1">[np.arange(</span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>
    <span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s5">'must have the same shape'</span><span class="s0">,</span>
                        <span class="s1">stack</span><span class="s0">, </span><span class="s1">[np.arange(</span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s2">1</span><span class="s1">)</span>
    <span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s5">'must have the same shape'</span><span class="s0">,</span>
                        <span class="s1">stack</span><span class="s0">, </span><span class="s1">[np.zeros((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.zeros(</span><span class="s2">3</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s2">1</span><span class="s1">)</span>
    <span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s5">'must have the same shape'</span><span class="s0">,</span>
                        <span class="s1">stack</span><span class="s0">, </span><span class="s1">[np.arange(</span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s2">3</span><span class="s1">)])</span>
    <span class="s4"># generator is deprecated</span>
    <span class="s0">with </span><span class="s1">assert_warns(FutureWarning):</span>
        <span class="s1">result = stack((x </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">3</span><span class="s1">)))</span>
    <span class="s1">assert_array_equal(result</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]))</span>


<span class="s0">class </span><span class="s1">TestBlock:</span>
    <span class="s1">@pytest.fixture(params=[</span><span class="s5">'block'</span><span class="s0">, </span><span class="s5">'force_concatenate'</span><span class="s0">, </span><span class="s5">'force_slicing'</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">block(self</span><span class="s0">, </span><span class="s1">request):</span>
        <span class="s4"># blocking small arrays and large arrays go through different paths.</span>
        <span class="s4"># the algorithm is triggered depending on the number of element</span>
        <span class="s4"># copies required.</span>
        <span class="s4"># We define a test fixture that forces most tests to go through</span>
        <span class="s4"># both code paths.</span>
        <span class="s4"># Ultimately, this should be removed if a single algorithm is found</span>
        <span class="s4"># to be faster for both small and large arrays.</span>
        <span class="s0">def </span><span class="s1">_block_force_concatenate(arrays):</span>
            <span class="s1">arrays</span><span class="s0">, </span><span class="s1">list_ndim</span><span class="s0">, </span><span class="s1">result_ndim</span><span class="s0">, </span><span class="s1">_ = _block_setup(arrays)</span>
            <span class="s0">return </span><span class="s1">_block_concatenate(arrays</span><span class="s0">, </span><span class="s1">list_ndim</span><span class="s0">, </span><span class="s1">result_ndim)</span>

        <span class="s0">def </span><span class="s1">_block_force_slicing(arrays):</span>
            <span class="s1">arrays</span><span class="s0">, </span><span class="s1">list_ndim</span><span class="s0">, </span><span class="s1">result_ndim</span><span class="s0">, </span><span class="s1">_ = _block_setup(arrays)</span>
            <span class="s0">return </span><span class="s1">_block_slicing(arrays</span><span class="s0">, </span><span class="s1">list_ndim</span><span class="s0">, </span><span class="s1">result_ndim)</span>

        <span class="s0">if </span><span class="s1">request.param == </span><span class="s5">'force_concatenate'</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s1">_block_force_concatenate</span>
        <span class="s0">elif </span><span class="s1">request.param == </span><span class="s5">'force_slicing'</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s1">_block_force_slicing</span>
        <span class="s0">elif </span><span class="s1">request.param == </span><span class="s5">'block'</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s1">block</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s5">'Unknown blocking request. There is a typo in the tests.'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_returns_copy(self</span><span class="s0">, </span><span class="s1">block):</span>
        <span class="s1">a = np.eye(</span><span class="s2">3</span><span class="s1">)</span>
        <span class="s1">b = block(a)</span>
        <span class="s1">b[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">] = </span><span class="s2">2</span>
        <span class="s0">assert </span><span class="s1">b[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">] != a[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span>

    <span class="s0">def </span><span class="s1">test_block_total_size_estimate(self</span><span class="s0">, </span><span class="s1">block):</span>
        <span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">total_size = _block_setup([</span><span class="s2">1</span><span class="s1">])</span>
        <span class="s0">assert </span><span class="s1">total_size == </span><span class="s2">1</span>

        <span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">total_size = _block_setup([[</span><span class="s2">1</span><span class="s1">]])</span>
        <span class="s0">assert </span><span class="s1">total_size == </span><span class="s2">1</span>

        <span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">total_size = _block_setup([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]])</span>
        <span class="s0">assert </span><span class="s1">total_size == </span><span class="s2">2</span>

        <span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">total_size = _block_setup([[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s1">]])</span>
        <span class="s0">assert </span><span class="s1">total_size == </span><span class="s2">2</span>

        <span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">total_size = _block_setup([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]])</span>
        <span class="s0">assert </span><span class="s1">total_size == </span><span class="s2">4</span>

    <span class="s0">def </span><span class="s1">test_block_simple_row_wise(self</span><span class="s0">, </span><span class="s1">block):</span>
        <span class="s1">a_2d = np.ones((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>
        <span class="s1">b_2d = </span><span class="s2">2 </span><span class="s1">* a_2d</span>
        <span class="s1">desired = np.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">result = block([a_2d</span><span class="s0">, </span><span class="s1">b_2d])</span>
        <span class="s1">assert_equal(desired</span><span class="s0">, </span><span class="s1">result)</span>

    <span class="s0">def </span><span class="s1">test_block_simple_column_wise(self</span><span class="s0">, </span><span class="s1">block):</span>
        <span class="s1">a_2d = np.ones((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>
        <span class="s1">b_2d = </span><span class="s2">2 </span><span class="s1">* a_2d</span>
        <span class="s1">expected = np.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">result = block([[a_2d]</span><span class="s0">, </span><span class="s1">[b_2d]])</span>
        <span class="s1">assert_equal(expected</span><span class="s0">, </span><span class="s1">result)</span>

    <span class="s0">def </span><span class="s1">test_block_with_1d_arrays_row_wise(self</span><span class="s0">, </span><span class="s1">block):</span>
        <span class="s4"># # # 1-D vectors are treated as row arrays</span>
        <span class="s1">a = np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span>
        <span class="s1">b = np.array([</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">])</span>
        <span class="s1">expected = np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">])</span>
        <span class="s1">result = block([a</span><span class="s0">, </span><span class="s1">b])</span>
        <span class="s1">assert_equal(expected</span><span class="s0">, </span><span class="s1">result)</span>

    <span class="s0">def </span><span class="s1">test_block_with_1d_arrays_multiple_rows(self</span><span class="s0">, </span><span class="s1">block):</span>
        <span class="s1">a = np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span>
        <span class="s1">b = np.array([</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">])</span>
        <span class="s1">expected = np.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]])</span>
        <span class="s1">result = block([[a</span><span class="s0">, </span><span class="s1">b]</span><span class="s0">, </span><span class="s1">[a</span><span class="s0">, </span><span class="s1">b]])</span>
        <span class="s1">assert_equal(expected</span><span class="s0">, </span><span class="s1">result)</span>

    <span class="s0">def </span><span class="s1">test_block_with_1d_arrays_column_wise(self</span><span class="s0">, </span><span class="s1">block):</span>
        <span class="s4"># # # 1-D vectors are treated as row arrays</span>
        <span class="s1">a_1d = np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span>
        <span class="s1">b_1d = np.array([</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">])</span>
        <span class="s1">expected = np.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]])</span>
        <span class="s1">result = block([[a_1d]</span><span class="s0">, </span><span class="s1">[b_1d]])</span>
        <span class="s1">assert_equal(expected</span><span class="s0">, </span><span class="s1">result)</span>

    <span class="s0">def </span><span class="s1">test_block_mixed_1d_and_2d(self</span><span class="s0">, </span><span class="s1">block):</span>
        <span class="s1">a_2d = np.ones((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>
        <span class="s1">b_1d = np.array([</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">result = block([[a_2d]</span><span class="s0">, </span><span class="s1">[b_1d]])</span>
        <span class="s1">expected = np.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">assert_equal(expected</span><span class="s0">, </span><span class="s1">result)</span>

    <span class="s0">def </span><span class="s1">test_block_complicated(self</span><span class="s0">, </span><span class="s1">block):</span>
        <span class="s4"># a bit more complicated</span>
        <span class="s1">one_2d = np.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]])</span>
        <span class="s1">two_2d = np.array([[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">three_2d = np.array([[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]])</span>
        <span class="s1">four_1d = np.array([</span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">])</span>
        <span class="s1">five_0d = np.array(</span><span class="s2">5</span><span class="s1">)</span>
        <span class="s1">six_1d = np.array([</span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s1">])</span>
        <span class="s1">zero_2d = np.zeros((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>

        <span class="s1">expected = np.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]])</span>

        <span class="s1">result = block([[one_2d</span><span class="s0">, </span><span class="s1">two_2d]</span><span class="s0">,</span>
                        <span class="s1">[three_2d]</span><span class="s0">,</span>
                        <span class="s1">[four_1d]</span><span class="s0">,</span>
                        <span class="s1">[five_0d</span><span class="s0">, </span><span class="s1">six_1d]</span><span class="s0">,</span>
                        <span class="s1">[zero_2d]])</span>
        <span class="s1">assert_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_nested(self</span><span class="s0">, </span><span class="s1">block):</span>
        <span class="s1">one = np.array([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>
        <span class="s1">two = np.array([[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">three = np.array([</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">])</span>
        <span class="s1">four = np.array([</span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">])</span>
        <span class="s1">five = np.array(</span><span class="s2">5</span><span class="s1">)</span>
        <span class="s1">six = np.array([</span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s1">])</span>
        <span class="s1">zero = np.zeros((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>

        <span class="s1">result = block([</span>
            <span class="s1">[</span>
                <span class="s1">block([</span>
                   <span class="s1">[one]</span><span class="s0">,</span>
                   <span class="s1">[three]</span><span class="s0">,</span>
                   <span class="s1">[four]</span>
                <span class="s1">])</span><span class="s0">,</span>
                <span class="s1">two</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[five</span><span class="s0">, </span><span class="s1">six]</span><span class="s0">,</span>
            <span class="s1">[zero]</span>
        <span class="s1">])</span>
        <span class="s1">expected = np.array([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]])</span>

        <span class="s1">assert_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_3d(self</span><span class="s0">, </span><span class="s1">block):</span>
        <span class="s1">a000 = np.ones((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">int) * </span><span class="s2">1</span>

        <span class="s1">a100 = np.ones((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">int) * </span><span class="s2">2</span>
        <span class="s1">a010 = np.ones((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">int) * </span><span class="s2">3</span>
        <span class="s1">a001 = np.ones((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">int) * </span><span class="s2">4</span>

        <span class="s1">a011 = np.ones((</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">int) * </span><span class="s2">5</span>
        <span class="s1">a101 = np.ones((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">int) * </span><span class="s2">6</span>
        <span class="s1">a110 = np.ones((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">int) * </span><span class="s2">7</span>

        <span class="s1">a111 = np.ones((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">int) * </span><span class="s2">8</span>

        <span class="s1">result = block([</span>
            <span class="s1">[</span>
                <span class="s1">[a000</span><span class="s0">, </span><span class="s1">a001]</span><span class="s0">,</span>
                <span class="s1">[a010</span><span class="s0">, </span><span class="s1">a011]</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span>
                <span class="s1">[a100</span><span class="s0">, </span><span class="s1">a101]</span><span class="s0">,</span>
                <span class="s1">[a110</span><span class="s0">, </span><span class="s1">a111]</span><span class="s0">,</span>
            <span class="s1">]</span>
        <span class="s1">])</span>
        <span class="s1">expected = array([[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]]</span><span class="s0">,</span>

                          <span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s1">]]</span><span class="s0">,</span>

                          <span class="s1">[[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]]</span><span class="s0">,</span>

                          <span class="s1">[[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]]</span><span class="s0">,</span>

                          <span class="s1">[[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">6</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">7</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">8</span><span class="s1">]]])</span>

        <span class="s1">assert_array_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_block_with_mismatched_shape(self</span><span class="s0">, </span><span class="s1">block):</span>
        <span class="s1">a = np.array([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">])</span>
        <span class="s1">b = np.eye(</span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">block</span><span class="s0">, </span><span class="s1">[a</span><span class="s0">, </span><span class="s1">b])</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">block</span><span class="s0">, </span><span class="s1">[b</span><span class="s0">, </span><span class="s1">a])</span>

        <span class="s1">to_block = [[np.ones((</span><span class="s2">2</span><span class="s0">,</span><span class="s2">3</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.ones((</span><span class="s2">2</span><span class="s0">,</span><span class="s2">2</span><span class="s1">))]</span><span class="s0">,</span>
                    <span class="s1">[np.ones((</span><span class="s2">2</span><span class="s0">,</span><span class="s2">2</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.ones((</span><span class="s2">2</span><span class="s0">,</span><span class="s2">2</span><span class="s1">))]]</span>
        <span class="s1">assert_raises(ValueError</span><span class="s0">, </span><span class="s1">block</span><span class="s0">, </span><span class="s1">to_block)</span>
    <span class="s0">def </span><span class="s1">test_no_lists(self</span><span class="s0">, </span><span class="s1">block):</span>
        <span class="s1">assert_equal(block(</span><span class="s2">1</span><span class="s1">)</span><span class="s0">,         </span><span class="s1">np.array(</span><span class="s2">1</span><span class="s1">))</span>
        <span class="s1">assert_equal(block(np.eye(</span><span class="s2">3</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.eye(</span><span class="s2">3</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_invalid_nesting(self</span><span class="s0">, </span><span class="s1">block):</span>
        <span class="s1">msg = </span><span class="s5">'depths are mismatched'</span>
        <span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s1">msg</span><span class="s0">, </span><span class="s1">block</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s1">]])</span>
        <span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s1">msg</span><span class="s0">, </span><span class="s1">block</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s1">[]])</span>
        <span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s1">msg</span><span class="s0">, </span><span class="s1">block</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s1">msg</span><span class="s0">, </span><span class="s1">block</span><span class="s0">, </span><span class="s1">[[]</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
        <span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s1">msg</span><span class="s0">, </span><span class="s1">block</span><span class="s0">, </span><span class="s1">[</span>
            <span class="s1">[[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">[[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s2">5</span><span class="s1">]  </span><span class="s4"># missing brackets</span>
        <span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_empty_lists(self</span><span class="s0">, </span><span class="s1">block):</span>
        <span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s5">'empty'</span><span class="s0">, </span><span class="s1">block</span><span class="s0">, </span><span class="s1">[])</span>
        <span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s5">'empty'</span><span class="s0">, </span><span class="s1">block</span><span class="s0">, </span><span class="s1">[[]])</span>
        <span class="s1">assert_raises_regex(ValueError</span><span class="s0">, </span><span class="s5">'empty'</span><span class="s0">, </span><span class="s1">block</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[]])</span>

    <span class="s0">def </span><span class="s1">test_tuple(self</span><span class="s0">, </span><span class="s1">block):</span>
        <span class="s1">assert_raises_regex(TypeError</span><span class="s0">, </span><span class="s5">'tuple'</span><span class="s0">, </span><span class="s1">block</span><span class="s0">, </span><span class="s1">([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]))</span>
        <span class="s1">assert_raises_regex(TypeError</span><span class="s0">, </span><span class="s5">'tuple'</span><span class="s0">, </span><span class="s1">block</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)])</span>

    <span class="s0">def </span><span class="s1">test_different_ndims(self</span><span class="s0">, </span><span class="s1">block):</span>
        <span class="s1">a = </span><span class="s2">1.</span>
        <span class="s1">b = </span><span class="s2">2 </span><span class="s1">* np.ones((</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>
        <span class="s1">c = </span><span class="s2">3 </span><span class="s1">* np.ones((</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>

        <span class="s1">result = block([a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">c])</span>
        <span class="s1">expected = np.array([[[</span><span class="s2">1.</span><span class="s0">, </span><span class="s2">2.</span><span class="s0">, </span><span class="s2">2.</span><span class="s0">, </span><span class="s2">3.</span><span class="s0">, </span><span class="s2">3.</span><span class="s0">, </span><span class="s2">3.</span><span class="s1">]]])</span>

        <span class="s1">assert_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_different_ndims_depths(self</span><span class="s0">, </span><span class="s1">block):</span>
        <span class="s1">a = </span><span class="s2">1.</span>
        <span class="s1">b = </span><span class="s2">2 </span><span class="s1">* np.ones((</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>
        <span class="s1">c = </span><span class="s2">3 </span><span class="s1">* np.ones((</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>

        <span class="s1">result = block([[a</span><span class="s0">, </span><span class="s1">b]</span><span class="s0">, </span><span class="s1">[c]])</span>
        <span class="s1">expected = np.array([[[</span><span class="s2">1.</span><span class="s0">, </span><span class="s2">2.</span><span class="s0">, </span><span class="s2">2.</span><span class="s1">]</span><span class="s0">,</span>
                              <span class="s1">[</span><span class="s2">3.</span><span class="s0">, </span><span class="s2">3.</span><span class="s0">, </span><span class="s2">3.</span><span class="s1">]</span><span class="s0">,</span>
                              <span class="s1">[</span><span class="s2">3.</span><span class="s0">, </span><span class="s2">3.</span><span class="s0">, </span><span class="s2">3.</span><span class="s1">]]])</span>

        <span class="s1">assert_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_block_memory_order(self</span><span class="s0">, </span><span class="s1">block):</span>
        <span class="s4"># 3D</span>
        <span class="s1">arr_c = np.zeros((</span><span class="s2">3</span><span class="s0">,</span><span class="s1">)*</span><span class="s2">3</span><span class="s0">, </span><span class="s1">order=</span><span class="s5">'C'</span><span class="s1">)</span>
        <span class="s1">arr_f = np.zeros((</span><span class="s2">3</span><span class="s0">,</span><span class="s1">)*</span><span class="s2">3</span><span class="s0">, </span><span class="s1">order=</span><span class="s5">'F'</span><span class="s1">)</span>

        <span class="s1">b_c = [[[arr_c</span><span class="s0">, </span><span class="s1">arr_c]</span><span class="s0">,</span>
                <span class="s1">[arr_c</span><span class="s0">, </span><span class="s1">arr_c]]</span><span class="s0">,</span>
               <span class="s1">[[arr_c</span><span class="s0">, </span><span class="s1">arr_c]</span><span class="s0">,</span>
                <span class="s1">[arr_c</span><span class="s0">, </span><span class="s1">arr_c]]]</span>

        <span class="s1">b_f = [[[arr_f</span><span class="s0">, </span><span class="s1">arr_f]</span><span class="s0">,</span>
                <span class="s1">[arr_f</span><span class="s0">, </span><span class="s1">arr_f]]</span><span class="s0">,</span>
               <span class="s1">[[arr_f</span><span class="s0">, </span><span class="s1">arr_f]</span><span class="s0">,</span>
                <span class="s1">[arr_f</span><span class="s0">, </span><span class="s1">arr_f]]]</span>

        <span class="s0">assert </span><span class="s1">block(b_c).flags[</span><span class="s5">'C_CONTIGUOUS'</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">block(b_f).flags[</span><span class="s5">'F_CONTIGUOUS'</span><span class="s1">]</span>

        <span class="s1">arr_c = np.zeros((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">order=</span><span class="s5">'C'</span><span class="s1">)</span>
        <span class="s1">arr_f = np.zeros((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">order=</span><span class="s5">'F'</span><span class="s1">)</span>
        <span class="s4"># 2D</span>
        <span class="s1">b_c = [[arr_c</span><span class="s0">, </span><span class="s1">arr_c]</span><span class="s0">,</span>
               <span class="s1">[arr_c</span><span class="s0">, </span><span class="s1">arr_c]]</span>

        <span class="s1">b_f = [[arr_f</span><span class="s0">, </span><span class="s1">arr_f]</span><span class="s0">,</span>
               <span class="s1">[arr_f</span><span class="s0">, </span><span class="s1">arr_f]]</span>

        <span class="s0">assert </span><span class="s1">block(b_c).flags[</span><span class="s5">'C_CONTIGUOUS'</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">block(b_f).flags[</span><span class="s5">'F_CONTIGUOUS'</span><span class="s1">]</span>


<span class="s0">def </span><span class="s1">test_block_dispatcher():</span>
    <span class="s0">class </span><span class="s1">ArrayLike:</span>
        <span class="s0">pass</span>
    <span class="s1">a = ArrayLike()</span>
    <span class="s1">b = ArrayLike()</span>
    <span class="s1">c = ArrayLike()</span>
    <span class="s1">assert_equal(list(_block_dispatcher(a))</span><span class="s0">, </span><span class="s1">[a])</span>
    <span class="s1">assert_equal(list(_block_dispatcher([a]))</span><span class="s0">, </span><span class="s1">[a])</span>
    <span class="s1">assert_equal(list(_block_dispatcher([a</span><span class="s0">, </span><span class="s1">b]))</span><span class="s0">, </span><span class="s1">[a</span><span class="s0">, </span><span class="s1">b])</span>
    <span class="s1">assert_equal(list(_block_dispatcher([[a]</span><span class="s0">, </span><span class="s1">[b</span><span class="s0">, </span><span class="s1">[c]]]))</span><span class="s0">, </span><span class="s1">[a</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">c])</span>
    <span class="s4"># don't recurse into non-lists</span>
    <span class="s1">assert_equal(list(_block_dispatcher((a</span><span class="s0">, </span><span class="s1">b)))</span><span class="s0">, </span><span class="s1">[(a</span><span class="s0">, </span><span class="s1">b)])</span>
</pre>
</body>
</html>