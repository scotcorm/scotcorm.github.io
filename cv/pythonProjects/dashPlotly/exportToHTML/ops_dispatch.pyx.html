<html>
<head>
<title>ops_dispatch.pyx</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #a9b7c6;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
ops_dispatch.pyx</font>
</center></td></tr></table>
<pre><span class="s0">DISPATCHED_UFUNCS = {</span>
    <span class="s0">&quot;add&quot;,</span>
    <span class="s0">&quot;sub&quot;,</span>
    <span class="s0">&quot;mul&quot;,</span>
    <span class="s0">&quot;pow&quot;,</span>
    <span class="s0">&quot;mod&quot;,</span>
    <span class="s0">&quot;floordiv&quot;,</span>
    <span class="s0">&quot;truediv&quot;,</span>
    <span class="s0">&quot;divmod&quot;,</span>
    <span class="s0">&quot;eq&quot;,</span>
    <span class="s0">&quot;ne&quot;,</span>
    <span class="s0">&quot;lt&quot;,</span>
    <span class="s0">&quot;gt&quot;,</span>
    <span class="s0">&quot;le&quot;,</span>
    <span class="s0">&quot;ge&quot;,</span>
    <span class="s0">&quot;remainder&quot;,</span>
    <span class="s0">&quot;matmul&quot;,</span>
    <span class="s0">&quot;or&quot;,</span>
    <span class="s0">&quot;xor&quot;,</span>
    <span class="s0">&quot;and&quot;,</span>
    <span class="s0">&quot;neg&quot;,</span>
    <span class="s0">&quot;pos&quot;,</span>
    <span class="s0">&quot;abs&quot;,</span>
<span class="s0">}</span>
<span class="s0">UNARY_UFUNCS = {</span>
    <span class="s0">&quot;neg&quot;,</span>
    <span class="s0">&quot;pos&quot;,</span>
    <span class="s0">&quot;abs&quot;,</span>
<span class="s0">}</span>
<span class="s0">UFUNC_ALIASES = {</span>
    <span class="s0">&quot;subtract&quot;: &quot;sub&quot;,</span>
    <span class="s0">&quot;multiply&quot;: &quot;mul&quot;,</span>
    <span class="s0">&quot;floor_divide&quot;: &quot;floordiv&quot;,</span>
    <span class="s0">&quot;true_divide&quot;: &quot;truediv&quot;,</span>
    <span class="s0">&quot;power&quot;: &quot;pow&quot;,</span>
    <span class="s0">&quot;remainder&quot;: &quot;mod&quot;,</span>
    <span class="s0">&quot;divide&quot;: &quot;truediv&quot;,</span>
    <span class="s0">&quot;equal&quot;: &quot;eq&quot;,</span>
    <span class="s0">&quot;not_equal&quot;: &quot;ne&quot;,</span>
    <span class="s0">&quot;less&quot;: &quot;lt&quot;,</span>
    <span class="s0">&quot;less_equal&quot;: &quot;le&quot;,</span>
    <span class="s0">&quot;greater&quot;: &quot;gt&quot;,</span>
    <span class="s0">&quot;greater_equal&quot;: &quot;ge&quot;,</span>
    <span class="s0">&quot;bitwise_or&quot;: &quot;or&quot;,</span>
    <span class="s0">&quot;bitwise_and&quot;: &quot;and&quot;,</span>
    <span class="s0">&quot;bitwise_xor&quot;: &quot;xor&quot;,</span>
    <span class="s0">&quot;negative&quot;: &quot;neg&quot;,</span>
    <span class="s0">&quot;absolute&quot;: &quot;abs&quot;,</span>
    <span class="s0">&quot;positive&quot;: &quot;pos&quot;,</span>
<span class="s0">}</span>

<span class="s0"># For op(., Array) -&gt; Array.__r{op}__</span>
<span class="s0">REVERSED_NAMES = {</span>
    <span class="s0">&quot;lt&quot;: &quot;__gt__&quot;,</span>
    <span class="s0">&quot;le&quot;: &quot;__ge__&quot;,</span>
    <span class="s0">&quot;gt&quot;: &quot;__lt__&quot;,</span>
    <span class="s0">&quot;ge&quot;: &quot;__le__&quot;,</span>
    <span class="s0">&quot;eq&quot;: &quot;__eq__&quot;,</span>
    <span class="s0">&quot;ne&quot;: &quot;__ne__&quot;,</span>
<span class="s0">}</span>


<span class="s0">def maybe_dispatch_ufunc_to_dunder_op(</span>
    <span class="s0">object self, object ufunc, str method, *inputs, **kwargs</span>
<span class="s0">):</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0">Dispatch a ufunc to the equivalent dunder method.</span>

    <span class="s0">Parameters</span>
    <span class="s0">----------</span>
    <span class="s0">self : ArrayLike</span>
        <span class="s0">The array whose dunder method we dispatch to</span>
    <span class="s0">ufunc : Callable</span>
        <span class="s0">A NumPy ufunc</span>
    <span class="s0">method : {'reduce', 'accumulate', 'reduceat', 'outer', 'at', '__call__'}</span>
    <span class="s0">inputs : ArrayLike</span>
        <span class="s0">The input arrays.</span>
    <span class="s0">kwargs : Any</span>
        <span class="s0">The additional keyword arguments, e.g. ``out``.</span>

    <span class="s0">Returns</span>
    <span class="s0">-------</span>
    <span class="s0">result : Any</span>
        <span class="s0">The result of applying the ufunc</span>
    <span class="s0">&quot;&quot;&quot;</span>
    <span class="s0"># special has the ufuncs we dispatch to the dunder op on</span>

    <span class="s0">op_name = ufunc.__name__</span>
    <span class="s0">op_name = UFUNC_ALIASES.get(op_name, op_name)</span>

    <span class="s0">def not_implemented(*args, **kwargs):</span>
        <span class="s0">return NotImplemented</span>

    <span class="s0">if kwargs or ufunc.nin &gt; 2:</span>
        <span class="s0">return NotImplemented</span>

    <span class="s0">if method == &quot;__call__&quot; and op_name in DISPATCHED_UFUNCS:</span>

        <span class="s0">if inputs[0] is self:</span>
            <span class="s0">name = f&quot;__{op_name}__&quot;</span>
            <span class="s0">meth = getattr(self, name, not_implemented)</span>

            <span class="s0">if op_name in UNARY_UFUNCS:</span>
                <span class="s0">assert len(inputs) == 1</span>
                <span class="s0">return meth()</span>

            <span class="s0">return meth(inputs[1])</span>

        <span class="s0">elif inputs[1] is self:</span>
            <span class="s0">name = REVERSED_NAMES.get(op_name, f&quot;__r{op_name}__&quot;)</span>

            <span class="s0">meth = getattr(self, name, not_implemented)</span>
            <span class="s0">result = meth(inputs[0])</span>
            <span class="s0">return result</span>

        <span class="s0">else:</span>
            <span class="s0"># should not be reached, but covering our bases</span>
            <span class="s0">return NotImplemented</span>

    <span class="s0">else:</span>
        <span class="s0">return NotImplemented</span>
</pre>
</body>
</html>