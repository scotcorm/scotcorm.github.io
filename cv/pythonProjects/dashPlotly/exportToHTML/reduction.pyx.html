<html>
<head>
<title>reduction.pyx</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #a9b7c6;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
reduction.pyx</font>
</center></td></tr></table>
<pre><span class="s0">import numpy as np</span>

<span class="s0">cimport numpy as cnp</span>

<span class="s0">cnp.import_array()</span>

<span class="s0">from pandas._libs.util cimport is_array</span>


<span class="s0">cdef cnp.dtype _dtype_obj = np.dtype(&quot;object&quot;)</span>


<span class="s0">cpdef check_result_array(object obj, object dtype):</span>
    <span class="s0"># Our operation is supposed to be an aggregation/reduction. If</span>
    <span class="s0">#  it returns an ndarray, this likely means an invalid operation has</span>
    <span class="s0">#  been passed. See test_apply_without_aggregation, test_agg_must_agg</span>
    <span class="s0">if is_array(obj):</span>
        <span class="s0">if dtype != _dtype_obj:</span>
            <span class="s0"># If it is object dtype, the function can be a reduction/aggregation</span>
            <span class="s0">#  and still return an ndarray e.g. test_agg_over_numpy_arrays</span>
            <span class="s0">raise ValueError(&quot;Must produce aggregated value&quot;)</span>


<span class="s0">cpdef inline extract_result(object res):</span>
    <span class="s0">&quot;&quot;&quot; extract the result object, it might be a 0-dim ndarray</span>
        <span class="s0">or a len-1 0-dim, or a scalar &quot;&quot;&quot;</span>
    <span class="s0">if hasattr(res, &quot;_values&quot;):</span>
        <span class="s0"># Preserve EA</span>
        <span class="s0">res = res._values</span>
        <span class="s0">if res.ndim == 1 and len(res) == 1:</span>
            <span class="s0"># see test_agg_lambda_with_timezone, test_resampler_grouper.py::test_apply</span>
            <span class="s0">res = res[0]</span>
    <span class="s0">return res</span>
</pre>
</body>
</html>