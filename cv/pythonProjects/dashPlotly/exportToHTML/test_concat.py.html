<html>
<head>
<title>test_concat.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_concat.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">collections </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">abc</span><span class="s0">,</span>
    <span class="s1">deque</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">from </span><span class="s1">decimal </span><span class="s0">import </span><span class="s1">Decimal</span>
<span class="s0">from </span><span class="s1">warnings </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">catch_warnings</span><span class="s0">,</span>
    <span class="s1">simplefilter</span><span class="s0">,</span>
<span class="s1">)</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas.errors </span><span class="s0">import </span><span class="s1">PerformanceWarning</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">DataFrame</span><span class="s0">,</span>
    <span class="s1">Index</span><span class="s0">,</span>
    <span class="s1">MultiIndex</span><span class="s0">,</span>
    <span class="s1">PeriodIndex</span><span class="s0">,</span>
    <span class="s1">Series</span><span class="s0">,</span>
    <span class="s1">concat</span><span class="s0">,</span>
    <span class="s1">date_range</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">pandas._testing </span><span class="s0">as </span><span class="s1">tm</span>
<span class="s0">from </span><span class="s1">pandas.core.arrays </span><span class="s0">import </span><span class="s1">SparseArray</span>
<span class="s0">from </span><span class="s1">pandas.core.construction </span><span class="s0">import </span><span class="s1">create_series_with_explicit_dtype</span>
<span class="s0">from </span><span class="s1">pandas.tests.extension.decimal </span><span class="s0">import </span><span class="s1">to_decimal</span>


<span class="s0">class </span><span class="s1">TestConcatenate:</span>
    <span class="s0">def </span><span class="s1">test_append_concat(self):</span>
        <span class="s2"># GH#1815</span>
        <span class="s1">d1 = date_range(</span><span class="s3">&quot;12/31/1990&quot;</span><span class="s0">, </span><span class="s3">&quot;12/31/1999&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s3">&quot;A-DEC&quot;</span><span class="s1">)</span>
        <span class="s1">d2 = date_range(</span><span class="s3">&quot;12/31/2000&quot;</span><span class="s0">, </span><span class="s3">&quot;12/31/2009&quot;</span><span class="s0">, </span><span class="s1">freq=</span><span class="s3">&quot;A-DEC&quot;</span><span class="s1">)</span>

        <span class="s1">s1 = Series(np.random.randn(</span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">d1)</span>
        <span class="s1">s2 = Series(np.random.randn(</span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">d2)</span>

        <span class="s1">s1 = s1.to_period()</span>
        <span class="s1">s2 = s2.to_period()</span>

        <span class="s2"># drops index</span>
        <span class="s1">result = concat([s1</span><span class="s0">, </span><span class="s1">s2])</span>
        <span class="s0">assert </span><span class="s1">isinstance(result.index</span><span class="s0">, </span><span class="s1">PeriodIndex)</span>
        <span class="s0">assert </span><span class="s1">result.index[</span><span class="s4">0</span><span class="s1">] == s1.index[</span><span class="s4">0</span><span class="s1">]</span>

    <span class="s0">def </span><span class="s1">test_concat_copy(self</span><span class="s0">, </span><span class="s1">using_array_manager):</span>
        <span class="s1">df = DataFrame(np.random.randn(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">3</span><span class="s1">))</span>
        <span class="s1">df2 = DataFrame(np.random.randint(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s1">size=</span><span class="s4">4</span><span class="s1">).reshape(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>
        <span class="s1">df3 = DataFrame({</span><span class="s4">5</span><span class="s1">: </span><span class="s3">&quot;foo&quot;</span><span class="s1">}</span><span class="s0">, </span><span class="s1">index=range(</span><span class="s4">4</span><span class="s1">))</span>

        <span class="s2"># These are actual copies.</span>
        <span class="s1">result = concat([df</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">df3]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">copy=</span><span class="s0">True</span><span class="s1">)</span>

        <span class="s0">for </span><span class="s1">arr </span><span class="s0">in </span><span class="s1">result._mgr.arrays:</span>
            <span class="s0">assert </span><span class="s1">arr.base </span><span class="s0">is None</span>

        <span class="s2"># These are the same.</span>
        <span class="s1">result = concat([df</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">df3]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">copy=</span><span class="s0">False</span><span class="s1">)</span>

        <span class="s0">for </span><span class="s1">arr </span><span class="s0">in </span><span class="s1">result._mgr.arrays:</span>
            <span class="s0">if </span><span class="s1">arr.dtype.kind == </span><span class="s3">&quot;f&quot;</span><span class="s1">:</span>
                <span class="s0">assert </span><span class="s1">arr.base </span><span class="s0">is </span><span class="s1">df._mgr.arrays[</span><span class="s4">0</span><span class="s1">].base</span>
            <span class="s0">elif </span><span class="s1">arr.dtype.kind </span><span class="s0">in </span><span class="s1">[</span><span class="s3">&quot;i&quot;</span><span class="s0">, </span><span class="s3">&quot;u&quot;</span><span class="s1">]:</span>
                <span class="s0">assert </span><span class="s1">arr.base </span><span class="s0">is </span><span class="s1">df2._mgr.arrays[</span><span class="s4">0</span><span class="s1">].base</span>
            <span class="s0">elif </span><span class="s1">arr.dtype == object:</span>
                <span class="s0">if </span><span class="s1">using_array_manager:</span>
                    <span class="s2"># we get the same array object, which has no base</span>
                    <span class="s0">assert </span><span class="s1">arr </span><span class="s0">is </span><span class="s1">df3._mgr.arrays[</span><span class="s4">0</span><span class="s1">]</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s0">assert </span><span class="s1">arr.base </span><span class="s0">is not None</span>

        <span class="s2"># Float block was consolidated.</span>
        <span class="s1">df4 = DataFrame(np.random.randn(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>
        <span class="s1">result = concat([df</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">df3</span><span class="s0">, </span><span class="s1">df4]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">copy=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">arr </span><span class="s0">in </span><span class="s1">result._mgr.arrays:</span>
            <span class="s0">if </span><span class="s1">arr.dtype.kind == </span><span class="s3">&quot;f&quot;</span><span class="s1">:</span>
                <span class="s0">if </span><span class="s1">using_array_manager:</span>
                    <span class="s2"># this is a view on some array in either df or df4</span>
                    <span class="s0">assert </span><span class="s1">any(</span>
                        <span class="s1">np.shares_memory(arr</span><span class="s0">, </span><span class="s1">other)</span>
                        <span class="s0">for </span><span class="s1">other </span><span class="s0">in </span><span class="s1">df._mgr.arrays + df4._mgr.arrays</span>
                    <span class="s1">)</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s2"># the block was consolidated, so we got a copy anyway</span>
                    <span class="s0">assert </span><span class="s1">arr.base </span><span class="s0">is None</span>
            <span class="s0">elif </span><span class="s1">arr.dtype.kind </span><span class="s0">in </span><span class="s1">[</span><span class="s3">&quot;i&quot;</span><span class="s0">, </span><span class="s3">&quot;u&quot;</span><span class="s1">]:</span>
                <span class="s0">assert </span><span class="s1">arr.base </span><span class="s0">is </span><span class="s1">df2._mgr.arrays[</span><span class="s4">0</span><span class="s1">].base</span>
            <span class="s0">elif </span><span class="s1">arr.dtype == object:</span>
                <span class="s2"># this is a view on df3</span>
                <span class="s0">assert </span><span class="s1">any(np.shares_memory(arr</span><span class="s0">, </span><span class="s1">other) </span><span class="s0">for </span><span class="s1">other </span><span class="s0">in </span><span class="s1">df3._mgr.arrays)</span>

    <span class="s0">def </span><span class="s1">test_concat_with_group_keys(self):</span>
        <span class="s2"># axis=0</span>
        <span class="s1">df = DataFrame(np.random.randn(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">))</span>
        <span class="s1">df2 = DataFrame(np.random.randn(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">4</span><span class="s1">))</span>

        <span class="s1">result = concat([df</span><span class="s0">, </span><span class="s1">df2]</span><span class="s0">, </span><span class="s1">keys=[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">exp_index = MultiIndex.from_arrays(</span>
            <span class="s1">[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]]</span>
        <span class="s1">)</span>
        <span class="s1">expected = DataFrame(np.r_[df.values</span><span class="s0">, </span><span class="s1">df2.values]</span><span class="s0">, </span><span class="s1">index=exp_index)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">result = concat([df</span><span class="s0">, </span><span class="s1">df]</span><span class="s0">, </span><span class="s1">keys=[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">exp_index2 = MultiIndex.from_arrays([[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]])</span>
        <span class="s1">expected = DataFrame(np.r_[df.values</span><span class="s0">, </span><span class="s1">df.values]</span><span class="s0">, </span><span class="s1">index=exp_index2)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># axis=1</span>
        <span class="s1">df = DataFrame(np.random.randn(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">3</span><span class="s1">))</span>
        <span class="s1">df2 = DataFrame(np.random.randn(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">4</span><span class="s1">))</span>

        <span class="s1">result = concat([df</span><span class="s0">, </span><span class="s1">df2]</span><span class="s0">, </span><span class="s1">keys=[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">expected = DataFrame(np.c_[df.values</span><span class="s0">, </span><span class="s1">df2.values]</span><span class="s0">, </span><span class="s1">columns=exp_index)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">result = concat([df</span><span class="s0">, </span><span class="s1">df]</span><span class="s0">, </span><span class="s1">keys=[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">expected = DataFrame(np.c_[df.values</span><span class="s0">, </span><span class="s1">df.values]</span><span class="s0">, </span><span class="s1">columns=exp_index2)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_concat_keys_specific_levels(self):</span>
        <span class="s1">df = DataFrame(np.random.randn(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">4</span><span class="s1">))</span>
        <span class="s1">pieces = [df.iloc[:</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">df.iloc[:</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">df.iloc[:</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s1">]]]</span>
        <span class="s1">level = [</span><span class="s3">&quot;three&quot;</span><span class="s0">, </span><span class="s3">&quot;two&quot;</span><span class="s0">, </span><span class="s3">&quot;one&quot;</span><span class="s0">, </span><span class="s3">&quot;zero&quot;</span><span class="s1">]</span>
        <span class="s1">result = concat(</span>
            <span class="s1">pieces</span><span class="s0">,</span>
            <span class="s1">axis=</span><span class="s4">1</span><span class="s0">,</span>
            <span class="s1">keys=[</span><span class="s3">&quot;one&quot;</span><span class="s0">, </span><span class="s3">&quot;two&quot;</span><span class="s0">, </span><span class="s3">&quot;three&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">levels=[level]</span><span class="s0">,</span>
            <span class="s1">names=[</span><span class="s3">&quot;group_key&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>

        <span class="s1">tm.assert_index_equal(result.columns.levels[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">Index(level</span><span class="s0">, </span><span class="s1">name=</span><span class="s3">&quot;group_key&quot;</span><span class="s1">))</span>
        <span class="s1">tm.assert_index_equal(result.columns.levels[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">Index([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]))</span>

        <span class="s0">assert </span><span class="s1">result.columns.names == [</span><span class="s3">&quot;group_key&quot;</span><span class="s0">, None</span><span class="s1">]</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;mapping&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;mapping&quot;</span><span class="s0">, </span><span class="s3">&quot;dict&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_concat_mapping(self</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">non_dict_mapping_subclass):</span>
        <span class="s1">constructor = dict </span><span class="s0">if </span><span class="s1">mapping == </span><span class="s3">&quot;dict&quot; </span><span class="s0">else </span><span class="s1">non_dict_mapping_subclass</span>
        <span class="s1">frames = constructor(</span>
            <span class="s1">{</span>
                <span class="s3">&quot;foo&quot;</span><span class="s1">: DataFrame(np.random.randn(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">3</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s3">&quot;bar&quot;</span><span class="s1">: DataFrame(np.random.randn(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">3</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s3">&quot;baz&quot;</span><span class="s1">: DataFrame(np.random.randn(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">3</span><span class="s1">))</span><span class="s0">,</span>
                <span class="s3">&quot;qux&quot;</span><span class="s1">: DataFrame(np.random.randn(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">3</span><span class="s1">))</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>

        <span class="s1">sorted_keys = list(frames.keys())</span>

        <span class="s1">result = concat(frames)</span>
        <span class="s1">expected = concat([frames[k] </span><span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">sorted_keys]</span><span class="s0">, </span><span class="s1">keys=sorted_keys)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">result = concat(frames</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">expected = concat([frames[k] </span><span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">sorted_keys]</span><span class="s0">, </span><span class="s1">keys=sorted_keys</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">keys = [</span><span class="s3">&quot;baz&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;bar&quot;</span><span class="s1">]</span>
        <span class="s1">result = concat(frames</span><span class="s0">, </span><span class="s1">keys=keys)</span>
        <span class="s1">expected = concat([frames[k] </span><span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">keys]</span><span class="s0">, </span><span class="s1">keys=keys)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_concat_keys_and_levels(self):</span>
        <span class="s1">df = DataFrame(np.random.randn(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">))</span>
        <span class="s1">df2 = DataFrame(np.random.randn(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s1">))</span>

        <span class="s1">levels = [[</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;baz&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;one&quot;</span><span class="s0">, </span><span class="s3">&quot;two&quot;</span><span class="s1">]]</span>
        <span class="s1">names = [</span><span class="s3">&quot;first&quot;</span><span class="s0">, </span><span class="s3">&quot;second&quot;</span><span class="s1">]</span>
        <span class="s1">result = concat(</span>
            <span class="s1">[df</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">df</span><span class="s0">, </span><span class="s1">df2]</span><span class="s0">,</span>
            <span class="s1">keys=[(</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;one&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;two&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;baz&quot;</span><span class="s0">, </span><span class="s3">&quot;one&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;baz&quot;</span><span class="s0">, </span><span class="s3">&quot;two&quot;</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">levels=levels</span><span class="s0">,</span>
            <span class="s1">names=names</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">expected = concat([df</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">df</span><span class="s0">, </span><span class="s1">df2])</span>
        <span class="s1">exp_index = MultiIndex(</span>
            <span class="s1">levels=levels + [[</span><span class="s4">0</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">codes=[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">names=names + [</span><span class="s0">None</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">expected.index = exp_index</span>

        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># no names</span>
        <span class="s1">result = concat(</span>
            <span class="s1">[df</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">df</span><span class="s0">, </span><span class="s1">df2]</span><span class="s0">,</span>
            <span class="s1">keys=[(</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;one&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;two&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;baz&quot;</span><span class="s0">, </span><span class="s3">&quot;one&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;baz&quot;</span><span class="s0">, </span><span class="s3">&quot;two&quot;</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">levels=levels</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result.index.names == (</span><span class="s0">None,</span><span class="s1">) * </span><span class="s4">3</span>

        <span class="s2"># no levels</span>
        <span class="s1">result = concat(</span>
            <span class="s1">[df</span><span class="s0">, </span><span class="s1">df2</span><span class="s0">, </span><span class="s1">df</span><span class="s0">, </span><span class="s1">df2]</span><span class="s0">,</span>
            <span class="s1">keys=[(</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;one&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;two&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;baz&quot;</span><span class="s0">, </span><span class="s3">&quot;one&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;baz&quot;</span><span class="s0">, </span><span class="s3">&quot;two&quot;</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">names=[</span><span class="s3">&quot;first&quot;</span><span class="s0">, </span><span class="s3">&quot;second&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result.index.names == (</span><span class="s3">&quot;first&quot;</span><span class="s0">, </span><span class="s3">&quot;second&quot;</span><span class="s0">, None</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(</span>
            <span class="s1">result.index.levels[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">Index([</span><span class="s3">&quot;baz&quot;</span><span class="s0">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">name=</span><span class="s3">&quot;first&quot;</span><span class="s1">)</span>
        <span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_concat_keys_levels_no_overlap(self):</span>
        <span class="s2"># GH #1406</span>
        <span class="s1">df = DataFrame(np.random.randn(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">&quot;a&quot;</span><span class="s1">])</span>
        <span class="s1">df2 = DataFrame(np.random.randn(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">&quot;b&quot;</span><span class="s1">])</span>

        <span class="s1">msg = </span><span class="s3">&quot;Values not found in passed level&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">concat([df</span><span class="s0">, </span><span class="s1">df]</span><span class="s0">, </span><span class="s1">keys=[</span><span class="s3">&quot;one&quot;</span><span class="s0">, </span><span class="s3">&quot;two&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">levels=[[</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;bar&quot;</span><span class="s0">, </span><span class="s3">&quot;baz&quot;</span><span class="s1">]])</span>

        <span class="s1">msg = </span><span class="s3">&quot;Key one not in level&quot;</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">concat([df</span><span class="s0">, </span><span class="s1">df2]</span><span class="s0">, </span><span class="s1">keys=[</span><span class="s3">&quot;one&quot;</span><span class="s0">, </span><span class="s3">&quot;two&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">levels=[[</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;bar&quot;</span><span class="s0">, </span><span class="s3">&quot;baz&quot;</span><span class="s1">]])</span>

    <span class="s0">def </span><span class="s1">test_crossed_dtypes_weird_corner(self):</span>
        <span class="s1">columns = [</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s3">&quot;C&quot;</span><span class="s0">, </span><span class="s3">&quot;D&quot;</span><span class="s1">]</span>
        <span class="s1">df1 = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s3">&quot;A&quot;</span><span class="s1">: np.array([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;f8&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s3">&quot;B&quot;</span><span class="s1">: np.array([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;i8&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s3">&quot;C&quot;</span><span class="s1">: np.array([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;f8&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s3">&quot;D&quot;</span><span class="s1">: np.array([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;i8&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">}</span><span class="s0">,</span>
            <span class="s1">columns=columns</span><span class="s0">,</span>
        <span class="s1">)</span>

        <span class="s1">df2 = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s3">&quot;A&quot;</span><span class="s1">: np.array([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;i8&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s3">&quot;B&quot;</span><span class="s1">: np.array([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;f8&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s3">&quot;C&quot;</span><span class="s1">: np.array([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;i8&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s3">&quot;D&quot;</span><span class="s1">: np.array([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;f8&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">}</span><span class="s0">,</span>
            <span class="s1">columns=columns</span><span class="s0">,</span>
        <span class="s1">)</span>

        <span class="s1">appended = concat([df1</span><span class="s0">, </span><span class="s1">df2]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">np.concatenate([df1.values</span><span class="s0">, </span><span class="s1">df2.values]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">columns=columns</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(appended</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">df = DataFrame(np.random.randn(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">&quot;a&quot;</span><span class="s1">])</span>
        <span class="s1">df2 = DataFrame(np.random.randn(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">&quot;b&quot;</span><span class="s1">])</span>
        <span class="s1">result = concat([df</span><span class="s0">, </span><span class="s1">df2]</span><span class="s0">, </span><span class="s1">keys=[</span><span class="s3">&quot;one&quot;</span><span class="s0">, </span><span class="s3">&quot;two&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">names=[</span><span class="s3">&quot;first&quot;</span><span class="s0">, </span><span class="s3">&quot;second&quot;</span><span class="s1">])</span>
        <span class="s0">assert </span><span class="s1">result.index.names == (</span><span class="s3">&quot;first&quot;</span><span class="s0">, </span><span class="s3">&quot;second&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_with_mixed_tuples(self</span><span class="s0">, </span><span class="s1">sort):</span>
        <span class="s2"># 10697</span>
        <span class="s2"># columns have mixed tuples, so handle properly</span>
        <span class="s1">df1 = DataFrame({</span><span class="s3">&quot;A&quot;</span><span class="s1">: </span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s1">): </span><span class="s3">&quot;bar&quot;</span><span class="s1">}</span><span class="s0">, </span><span class="s1">index=range(</span><span class="s4">2</span><span class="s1">))</span>
        <span class="s1">df2 = DataFrame({</span><span class="s3">&quot;B&quot;</span><span class="s1">: </span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s1">): </span><span class="s3">&quot;bar&quot;</span><span class="s1">}</span><span class="s0">, </span><span class="s1">index=range(</span><span class="s4">2</span><span class="s1">))</span>

        <span class="s2"># it works</span>
        <span class="s1">concat([df1</span><span class="s0">, </span><span class="s1">df2]</span><span class="s0">, </span><span class="s1">sort=sort)</span>

    <span class="s0">def </span><span class="s1">test_concat_mixed_objs(self):</span>

        <span class="s2"># concat mixed series/frames</span>
        <span class="s2"># G2385</span>

        <span class="s2"># axis 1</span>
        <span class="s1">index = date_range(</span><span class="s3">&quot;01-Jan-2013&quot;</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">10</span><span class="s0">, </span><span class="s1">freq=</span><span class="s3">&quot;H&quot;</span><span class="s1">)</span>
        <span class="s1">arr = np.arange(</span><span class="s4">10</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;int64&quot;</span><span class="s1">)</span>
        <span class="s1">s1 = Series(arr</span><span class="s0">, </span><span class="s1">index=index)</span>
        <span class="s1">s2 = Series(arr</span><span class="s0">, </span><span class="s1">index=index)</span>
        <span class="s1">df = DataFrame(arr.reshape(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=index)</span>

        <span class="s1">expected = DataFrame(</span>
            <span class="s1">np.repeat(arr</span><span class="s0">, </span><span class="s4">2</span><span class="s1">).reshape(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=index</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">result = concat([df</span><span class="s0">, </span><span class="s1">df]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">expected = DataFrame(</span>
            <span class="s1">np.repeat(arr</span><span class="s0">, </span><span class="s4">2</span><span class="s1">).reshape(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=index</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">result = concat([s1</span><span class="s0">, </span><span class="s1">s2]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">expected = DataFrame(</span>
            <span class="s1">np.repeat(arr</span><span class="s0">, </span><span class="s4">3</span><span class="s1">).reshape(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=index</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">result = concat([s1</span><span class="s0">, </span><span class="s1">s2</span><span class="s0">, </span><span class="s1">s1]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">expected = DataFrame(</span>
            <span class="s1">np.repeat(arr</span><span class="s0">, </span><span class="s4">5</span><span class="s1">).reshape(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=index</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">result = concat([s1</span><span class="s0">, </span><span class="s1">df</span><span class="s0">, </span><span class="s1">s2</span><span class="s0">, </span><span class="s1">s2</span><span class="s0">, </span><span class="s1">s1]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># with names</span>
        <span class="s1">s1.name = </span><span class="s3">&quot;foo&quot;</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">np.repeat(arr</span><span class="s0">, </span><span class="s4">3</span><span class="s1">).reshape(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=index</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">result = concat([s1</span><span class="s0">, </span><span class="s1">df</span><span class="s0">, </span><span class="s1">s2]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">s2.name = </span><span class="s3">&quot;bar&quot;</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">np.repeat(arr</span><span class="s0">, </span><span class="s4">3</span><span class="s1">).reshape(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=index</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s3">&quot;bar&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">result = concat([s1</span><span class="s0">, </span><span class="s1">df</span><span class="s0">, </span><span class="s1">s2]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># ignore index</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">np.repeat(arr</span><span class="s0">, </span><span class="s4">3</span><span class="s1">).reshape(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=index</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">result = concat([s1</span><span class="s0">, </span><span class="s1">df</span><span class="s0">, </span><span class="s1">s2]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># axis 0</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">np.tile(arr</span><span class="s0">, </span><span class="s4">3</span><span class="s1">).reshape(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=index.tolist() * </span><span class="s4">3</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">0</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">result = concat([s1</span><span class="s0">, </span><span class="s1">df</span><span class="s0">, </span><span class="s1">s2])</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">expected = DataFrame(np.tile(arr</span><span class="s0">, </span><span class="s4">3</span><span class="s1">).reshape(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s4">0</span><span class="s1">])</span>
        <span class="s1">result = concat([s1</span><span class="s0">, </span><span class="s1">df</span><span class="s0">, </span><span class="s1">s2]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_dtype_coerceion(self):</span>

        <span class="s2"># 12411</span>
        <span class="s1">df = DataFrame({</span><span class="s3">&quot;date&quot;</span><span class="s1">: [pd.Timestamp(</span><span class="s3">&quot;20130101&quot;</span><span class="s1">).tz_localize(</span><span class="s3">&quot;UTC&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">pd.NaT]})</span>

        <span class="s1">result = concat([df.iloc[[</span><span class="s4">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">df.iloc[[</span><span class="s4">1</span><span class="s1">]]])</span>
        <span class="s1">tm.assert_series_equal(result.dtypes</span><span class="s0">, </span><span class="s1">df.dtypes)</span>

        <span class="s2"># 12045</span>
        <span class="s0">import </span><span class="s1">datetime</span>

        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span><span class="s3">&quot;date&quot;</span><span class="s1">: [datetime.datetime(</span><span class="s4">2012</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">datetime.datetime(</span><span class="s4">1012</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)]}</span>
        <span class="s1">)</span>
        <span class="s1">result = concat([df.iloc[[</span><span class="s4">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">df.iloc[[</span><span class="s4">1</span><span class="s1">]]])</span>
        <span class="s1">tm.assert_series_equal(result.dtypes</span><span class="s0">, </span><span class="s1">df.dtypes)</span>

        <span class="s2"># 11594</span>
        <span class="s1">df = DataFrame({</span><span class="s3">&quot;text&quot;</span><span class="s1">: [</span><span class="s3">&quot;some words&quot;</span><span class="s1">] + [</span><span class="s0">None</span><span class="s1">] * </span><span class="s4">9</span><span class="s1">})</span>
        <span class="s1">result = concat([df.iloc[[</span><span class="s4">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">df.iloc[[</span><span class="s4">1</span><span class="s1">]]])</span>
        <span class="s1">tm.assert_series_equal(result.dtypes</span><span class="s0">, </span><span class="s1">df.dtypes)</span>

    <span class="s0">def </span><span class="s1">test_concat_single_with_key(self):</span>
        <span class="s1">df = DataFrame(np.random.randn(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">4</span><span class="s1">))</span>

        <span class="s1">result = concat([df]</span><span class="s0">, </span><span class="s1">keys=[</span><span class="s3">&quot;foo&quot;</span><span class="s1">])</span>
        <span class="s1">expected = concat([df</span><span class="s0">, </span><span class="s1">df]</span><span class="s0">, </span><span class="s1">keys=[</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;bar&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected[:</span><span class="s4">10</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_concat_no_items_raises(self):</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;No objects to concatenate&quot;</span><span class="s1">):</span>
            <span class="s1">concat([])</span>

    <span class="s0">def </span><span class="s1">test_concat_exclude_none(self):</span>
        <span class="s1">df = DataFrame(np.random.randn(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">4</span><span class="s1">))</span>

        <span class="s1">pieces = [df[:</span><span class="s4">5</span><span class="s1">]</span><span class="s0">, None, None, </span><span class="s1">df[</span><span class="s4">5</span><span class="s1">:]]</span>
        <span class="s1">result = concat(pieces)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">df)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;All objects passed were None&quot;</span><span class="s1">):</span>
            <span class="s1">concat([</span><span class="s0">None, None</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_concat_keys_with_none(self):</span>
        <span class="s2"># #1649</span>
        <span class="s1">df0 = DataFrame([[</span><span class="s4">10</span><span class="s0">, </span><span class="s4">20</span><span class="s0">, </span><span class="s4">30</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">10</span><span class="s0">, </span><span class="s4">20</span><span class="s0">, </span><span class="s4">30</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">10</span><span class="s0">, </span><span class="s4">20</span><span class="s0">, </span><span class="s4">30</span><span class="s1">]])</span>

        <span class="s1">result = concat({</span><span class="s3">&quot;a&quot;</span><span class="s1">: </span><span class="s0">None, </span><span class="s3">&quot;b&quot;</span><span class="s1">: df0</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">: df0[:</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;d&quot;</span><span class="s1">: df0[:</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;e&quot;</span><span class="s1">: df0})</span>
        <span class="s1">expected = concat({</span><span class="s3">&quot;b&quot;</span><span class="s1">: df0</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">: df0[:</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;d&quot;</span><span class="s1">: df0[:</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;e&quot;</span><span class="s1">: df0})</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">result = concat(</span>
            <span class="s1">[</span><span class="s0">None, </span><span class="s1">df0</span><span class="s0">, </span><span class="s1">df0[:</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">df0[:</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">df0]</span><span class="s0">, </span><span class="s1">keys=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;d&quot;</span><span class="s0">, </span><span class="s3">&quot;e&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">expected = concat([df0</span><span class="s0">, </span><span class="s1">df0[:</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">df0[:</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">df0]</span><span class="s0">, </span><span class="s1">keys=[</span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;d&quot;</span><span class="s0">, </span><span class="s3">&quot;e&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_concat_bug_1719(self):</span>
        <span class="s1">ts1 = tm.makeTimeSeries()</span>
        <span class="s1">ts2 = tm.makeTimeSeries()[::</span><span class="s4">2</span><span class="s1">]</span>

        <span class="s2"># to join with union</span>
        <span class="s2"># these two are of different length!</span>
        <span class="s1">left = concat([ts1</span><span class="s0">, </span><span class="s1">ts2]</span><span class="s0">, </span><span class="s1">join=</span><span class="s3">&quot;outer&quot;</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">right = concat([ts2</span><span class="s0">, </span><span class="s1">ts1]</span><span class="s0">, </span><span class="s1">join=</span><span class="s3">&quot;outer&quot;</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>

        <span class="s0">assert </span><span class="s1">len(left) == len(right)</span>

    <span class="s0">def </span><span class="s1">test_concat_bug_2972(self):</span>
        <span class="s1">ts0 = Series(np.zeros(</span><span class="s4">5</span><span class="s1">))</span>
        <span class="s1">ts1 = Series(np.ones(</span><span class="s4">5</span><span class="s1">))</span>
        <span class="s1">ts0.name = ts1.name = </span><span class="s3">&quot;same name&quot;</span>
        <span class="s1">result = concat([ts0</span><span class="s0">, </span><span class="s1">ts1]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>

        <span class="s1">expected = DataFrame({</span><span class="s4">0</span><span class="s1">: ts0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">: ts1})</span>
        <span class="s1">expected.columns = [</span><span class="s3">&quot;same name&quot;</span><span class="s0">, </span><span class="s3">&quot;same name&quot;</span><span class="s1">]</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_concat_bug_3602(self):</span>

        <span class="s2"># GH 3602, duplicate columns</span>
        <span class="s1">df1 = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s3">&quot;firmNo&quot;</span><span class="s1">: [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s3">&quot;prc&quot;</span><span class="s1">: [</span><span class="s4">6</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s3">&quot;stringvar&quot;</span><span class="s1">: [</span><span class="s3">&quot;rrr&quot;</span><span class="s0">, </span><span class="s3">&quot;rrr&quot;</span><span class="s0">, </span><span class="s3">&quot;rrr&quot;</span><span class="s0">, </span><span class="s3">&quot;rrr&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
        <span class="s1">df2 = DataFrame(</span>
            <span class="s1">{</span><span class="s3">&quot;C&quot;</span><span class="s1">: [</span><span class="s4">9</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">11</span><span class="s0">, </span><span class="s4">12</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;misc&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;prc&quot;</span><span class="s1">: [</span><span class="s4">6</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]}</span>
        <span class="s1">)</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">[</span>
                <span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s3">&quot;rrr&quot;</span><span class="s0">, </span><span class="s4">9</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s3">&quot;rrr&quot;</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s3">&quot;rrr&quot;</span><span class="s0">, </span><span class="s4">11</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s3">&quot;rrr&quot;</span><span class="s0">, </span><span class="s4">12</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">expected.columns = [</span><span class="s3">&quot;firmNo&quot;</span><span class="s0">, </span><span class="s3">&quot;prc&quot;</span><span class="s0">, </span><span class="s3">&quot;stringvar&quot;</span><span class="s0">, </span><span class="s3">&quot;C&quot;</span><span class="s0">, </span><span class="s3">&quot;misc&quot;</span><span class="s0">, </span><span class="s3">&quot;prc&quot;</span><span class="s1">]</span>

        <span class="s1">result = concat([df1</span><span class="s0">, </span><span class="s1">df2]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_concat_iterables(self):</span>
        <span class="s2"># GH8645 check concat works with tuples, list, generators, and weird</span>
        <span class="s2"># stuff like deque and custom iterables</span>
        <span class="s1">df1 = DataFrame([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span>
        <span class="s1">df2 = DataFrame([</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">])</span>
        <span class="s1">expected = DataFrame([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">])</span>
        <span class="s1">tm.assert_frame_equal(concat((df1</span><span class="s0">, </span><span class="s1">df2)</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">, </span><span class="s1">expected)</span>
        <span class="s1">tm.assert_frame_equal(concat([df1</span><span class="s0">, </span><span class="s1">df2]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">, </span><span class="s1">expected)</span>
        <span class="s1">tm.assert_frame_equal(</span>
            <span class="s1">concat((df </span><span class="s0">for </span><span class="s1">df </span><span class="s0">in </span><span class="s1">(df1</span><span class="s0">, </span><span class="s1">df2))</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">, </span><span class="s1">expected</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(concat(deque((df1</span><span class="s0">, </span><span class="s1">df2))</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s0">class </span><span class="s1">CustomIterator1:</span>
            <span class="s0">def </span><span class="s1">__len__(self) -&gt; int:</span>
                <span class="s0">return </span><span class="s4">2</span>

            <span class="s0">def </span><span class="s1">__getitem__(self</span><span class="s0">, </span><span class="s1">index):</span>
                <span class="s0">try</span><span class="s1">:</span>
                    <span class="s0">return </span><span class="s1">{</span><span class="s4">0</span><span class="s1">: df1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">: df2}[index]</span>
                <span class="s0">except </span><span class="s1">KeyError </span><span class="s0">as </span><span class="s1">err:</span>
                    <span class="s0">raise </span><span class="s1">IndexError </span><span class="s0">from </span><span class="s1">err</span>

        <span class="s1">tm.assert_frame_equal(concat(CustomIterator1()</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s0">class </span><span class="s1">CustomIterator2(abc.Iterable):</span>
            <span class="s0">def </span><span class="s1">__iter__(self):</span>
                <span class="s0">yield </span><span class="s1">df1</span>
                <span class="s0">yield </span><span class="s1">df2</span>

        <span class="s1">tm.assert_frame_equal(concat(CustomIterator2()</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_concat_order(self):</span>
        <span class="s2"># GH 17344</span>
        <span class="s1">dfs = [DataFrame(index=range(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, None</span><span class="s1">])]</span>
        <span class="s1">dfs += [DataFrame(index=range(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s0">None, </span><span class="s4">1</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s1">]) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">100</span><span class="s1">)]</span>

        <span class="s1">result = concat(dfs</span><span class="s0">, </span><span class="s1">sort=</span><span class="s0">True</span><span class="s1">).columns</span>
        <span class="s1">expected = dfs[</span><span class="s4">0</span><span class="s1">].columns</span>
        <span class="s1">tm.assert_index_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_concat_different_extension_dtypes_upcasts(self):</span>
        <span class="s1">a = Series(pd.array([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;Int64&quot;</span><span class="s1">))</span>
        <span class="s1">b = Series(to_decimal([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]))</span>

        <span class="s1">result = concat([a</span><span class="s0">, </span><span class="s1">b]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">expected = Series([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">Decimal(</span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">Decimal(</span><span class="s4">2</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">dtype=object)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_concat_ordered_dict(self):</span>
        <span class="s2"># GH 21510</span>
        <span class="s1">expected = concat(</span>
            <span class="s1">[Series(range(</span><span class="s4">3</span><span class="s1">))</span><span class="s0">, </span><span class="s1">Series(range(</span><span class="s4">4</span><span class="s1">))]</span><span class="s0">, </span><span class="s1">keys=[</span><span class="s3">&quot;First&quot;</span><span class="s0">, </span><span class="s3">&quot;Another&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">result = concat({</span><span class="s3">&quot;First&quot;</span><span class="s1">: Series(range(</span><span class="s4">3</span><span class="s1">))</span><span class="s0">, </span><span class="s3">&quot;Another&quot;</span><span class="s1">: Series(range(</span><span class="s4">4</span><span class="s1">))})</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;pdt&quot;</span><span class="s0">, </span><span class="s1">[Series</span><span class="s0">, </span><span class="s1">DataFrame])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;dt&quot;</span><span class="s0">, </span><span class="s1">np.sctypes[</span><span class="s3">&quot;float&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_concat_no_unnecessary_upcast(dt</span><span class="s0">, </span><span class="s1">pdt):</span>
    <span class="s2"># GH 13247</span>
    <span class="s1">dims = pdt(dtype=object).ndim</span>

    <span class="s1">dfs = [</span>
        <span class="s1">pdt(np.array([</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=dt</span><span class="s0">, </span><span class="s1">ndmin=dims))</span><span class="s0">,</span>
        <span class="s1">pdt(np.array([np.nan]</span><span class="s0">, </span><span class="s1">dtype=dt</span><span class="s0">, </span><span class="s1">ndmin=dims))</span><span class="s0">,</span>
        <span class="s1">pdt(np.array([</span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=dt</span><span class="s0">, </span><span class="s1">ndmin=dims))</span><span class="s0">,</span>
    <span class="s1">]</span>
    <span class="s1">x = concat(dfs)</span>
    <span class="s0">assert </span><span class="s1">x.values.dtype == dt</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;pdt&quot;</span><span class="s0">, </span><span class="s1">[create_series_with_explicit_dtype</span><span class="s0">, </span><span class="s1">DataFrame])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;dt&quot;</span><span class="s0">, </span><span class="s1">np.sctypes[</span><span class="s3">&quot;int&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_concat_will_upcast(dt</span><span class="s0">, </span><span class="s1">pdt):</span>
    <span class="s0">with </span><span class="s1">catch_warnings(record=</span><span class="s0">True</span><span class="s1">):</span>
        <span class="s1">dims = pdt().ndim</span>
        <span class="s1">dfs = [</span>
            <span class="s1">pdt(np.array([</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=dt</span><span class="s0">, </span><span class="s1">ndmin=dims))</span><span class="s0">,</span>
            <span class="s1">pdt(np.array([np.nan]</span><span class="s0">, </span><span class="s1">ndmin=dims))</span><span class="s0">,</span>
            <span class="s1">pdt(np.array([</span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=dt</span><span class="s0">, </span><span class="s1">ndmin=dims))</span><span class="s0">,</span>
        <span class="s1">]</span>
        <span class="s1">x = concat(dfs)</span>
        <span class="s0">assert </span><span class="s1">x.values.dtype == </span><span class="s3">&quot;float64&quot;</span>


<span class="s0">def </span><span class="s1">test_concat_empty_and_non_empty_frame_regression():</span>
    <span class="s2"># GH 18178 regression test</span>
    <span class="s1">df1 = DataFrame({</span><span class="s3">&quot;foo&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s1">]})</span>
    <span class="s1">df2 = DataFrame({</span><span class="s3">&quot;foo&quot;</span><span class="s1">: []})</span>
    <span class="s1">expected = DataFrame({</span><span class="s3">&quot;foo&quot;</span><span class="s1">: [</span><span class="s4">1.0</span><span class="s1">]})</span>
    <span class="s1">result = concat([df1</span><span class="s0">, </span><span class="s1">df2])</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_concat_sparse():</span>
    <span class="s2"># GH 23557</span>
    <span class="s1">a = Series(SparseArray([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]))</span>
    <span class="s1">expected = DataFrame(data=[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]]).astype(</span>
        <span class="s1">pd.SparseDtype(np.int64</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">)</span>
    <span class="s1">result = concat([a</span><span class="s0">, </span><span class="s1">a]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_concat_dense_sparse():</span>
    <span class="s2"># GH 30668</span>
    <span class="s1">a = Series(pd.arrays.SparseArray([</span><span class="s4">1</span><span class="s0">, None</span><span class="s1">])</span><span class="s0">, </span><span class="s1">dtype=float)</span>
    <span class="s1">b = Series([</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=float)</span>
    <span class="s1">expected = Series(data=[</span><span class="s4">1</span><span class="s0">, None, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]).astype(</span>
        <span class="s1">pd.SparseDtype(np.float64</span><span class="s0">, None</span><span class="s1">)</span>
    <span class="s1">)</span>
    <span class="s1">result = concat([a</span><span class="s0">, </span><span class="s1">b]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;keys&quot;</span><span class="s0">, </span><span class="s1">[[</span><span class="s3">&quot;e&quot;</span><span class="s0">, </span><span class="s3">&quot;f&quot;</span><span class="s0">, </span><span class="s3">&quot;f&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;f&quot;</span><span class="s0">, </span><span class="s3">&quot;e&quot;</span><span class="s0">, </span><span class="s3">&quot;f&quot;</span><span class="s1">]])</span>
<span class="s0">def </span><span class="s1">test_duplicate_keys(keys):</span>
    <span class="s2"># GH 33654</span>
    <span class="s1">df = DataFrame({</span><span class="s3">&quot;a&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">: [</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]})</span>
    <span class="s1">s1 = Series([</span><span class="s4">7</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">name=</span><span class="s3">&quot;c&quot;</span><span class="s1">)</span>
    <span class="s1">s2 = Series([</span><span class="s4">10</span><span class="s0">, </span><span class="s4">11</span><span class="s0">, </span><span class="s4">12</span><span class="s1">]</span><span class="s0">, </span><span class="s1">name=</span><span class="s3">&quot;d&quot;</span><span class="s1">)</span>
    <span class="s1">result = concat([df</span><span class="s0">, </span><span class="s1">s1</span><span class="s0">, </span><span class="s1">s2]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">keys=keys)</span>
    <span class="s1">expected_values = [[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">11</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">9</span><span class="s0">, </span><span class="s4">12</span><span class="s1">]]</span>
    <span class="s1">expected_columns = MultiIndex.from_tuples(</span>
        <span class="s1">[(keys[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(keys[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(keys[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(keys[</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;d&quot;</span><span class="s1">)]</span>
    <span class="s1">)</span>
    <span class="s1">expected = DataFrame(expected_values</span><span class="s0">, </span><span class="s1">columns=expected_columns)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_duplicate_keys_same_frame():</span>
    <span class="s2"># GH 43595</span>
    <span class="s1">keys = [</span><span class="s3">&quot;e&quot;</span><span class="s0">, </span><span class="s3">&quot;e&quot;</span><span class="s1">]</span>
    <span class="s1">df = DataFrame({</span><span class="s3">&quot;a&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">: [</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]})</span>
    <span class="s1">result = concat([df</span><span class="s0">, </span><span class="s1">df]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">keys=keys)</span>
    <span class="s1">expected_values = [[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]]</span>
    <span class="s1">expected_columns = MultiIndex.from_tuples(</span>
        <span class="s1">[(keys[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(keys[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(keys[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(keys[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">)]</span>
    <span class="s1">)</span>
    <span class="s1">expected = DataFrame(expected_values</span><span class="s0">, </span><span class="s1">columns=expected_columns)</span>
    <span class="s0">with </span><span class="s1">catch_warnings():</span>
        <span class="s2"># result.columns not sorted, resulting in performance warning</span>
        <span class="s1">simplefilter(</span><span class="s3">&quot;ignore&quot;</span><span class="s0">, </span><span class="s1">PerformanceWarning)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;obj&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">tm.SubclassedDataFrame({</span><span class="s3">&quot;A&quot;</span><span class="s1">: np.arange(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)})</span><span class="s0">,</span>
        <span class="s1">tm.SubclassedSeries(np.arange(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">name=</span><span class="s3">&quot;A&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_concat_preserves_subclass(obj):</span>
    <span class="s2"># GH28330 -- preserve subclass</span>

    <span class="s1">result = concat([obj</span><span class="s0">, </span><span class="s1">obj])</span>
    <span class="s0">assert </span><span class="s1">isinstance(result</span><span class="s0">, </span><span class="s1">type(obj))</span>


<span class="s0">def </span><span class="s1">test_concat_frame_axis0_extension_dtypes():</span>
    <span class="s2"># preserve extension dtype (through common_dtype mechanism)</span>
    <span class="s1">df1 = DataFrame({</span><span class="s3">&quot;a&quot;</span><span class="s1">: pd.array([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;Int64&quot;</span><span class="s1">)})</span>
    <span class="s1">df2 = DataFrame({</span><span class="s3">&quot;a&quot;</span><span class="s1">: np.array([</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">])})</span>

    <span class="s1">result = concat([df1</span><span class="s0">, </span><span class="s1">df2]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">expected = DataFrame({</span><span class="s3">&quot;a&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;Int64&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s1">result = concat([df2</span><span class="s0">, </span><span class="s1">df1]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">expected = DataFrame({</span><span class="s3">&quot;a&quot;</span><span class="s1">: [</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;Int64&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_concat_preserves_extension_int64_dtype():</span>
    <span class="s2"># GH 24768</span>
    <span class="s1">df_a = DataFrame({</span><span class="s3">&quot;a&quot;</span><span class="s1">: [-</span><span class="s4">1</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;Int64&quot;</span><span class="s1">)</span>
    <span class="s1">df_b = DataFrame({</span><span class="s3">&quot;b&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;Int64&quot;</span><span class="s1">)</span>
    <span class="s1">result = concat([df_a</span><span class="s0">, </span><span class="s1">df_b]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">expected = DataFrame({</span><span class="s3">&quot;a&quot;</span><span class="s1">: [-</span><span class="s4">1</span><span class="s0">, None</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">: [</span><span class="s0">None, </span><span class="s4">1</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;Int64&quot;</span><span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;dtype1,dtype2,expected_dtype&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s3">&quot;bool&quot;</span><span class="s0">, </span><span class="s3">&quot;bool&quot;</span><span class="s0">, </span><span class="s3">&quot;bool&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;boolean&quot;</span><span class="s0">, </span><span class="s3">&quot;bool&quot;</span><span class="s0">, </span><span class="s3">&quot;boolean&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;bool&quot;</span><span class="s0">, </span><span class="s3">&quot;boolean&quot;</span><span class="s0">, </span><span class="s3">&quot;boolean&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;boolean&quot;</span><span class="s0">, </span><span class="s3">&quot;boolean&quot;</span><span class="s0">, </span><span class="s3">&quot;boolean&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_concat_bool_types(dtype1</span><span class="s0">, </span><span class="s1">dtype2</span><span class="s0">, </span><span class="s1">expected_dtype):</span>
    <span class="s2"># GH 42800</span>
    <span class="s1">ser1 = Series([</span><span class="s0">True, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=dtype1)</span>
    <span class="s1">ser2 = Series([</span><span class="s0">False, True</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=dtype2)</span>
    <span class="s1">result = concat([ser1</span><span class="s0">, </span><span class="s1">ser2]</span><span class="s0">, </span><span class="s1">ignore_index=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">expected = Series([</span><span class="s0">True, False, False, True</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=expected_dtype)</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s1">(</span><span class="s3">&quot;keys&quot;</span><span class="s0">, </span><span class="s3">&quot;integrity&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">([</span><span class="s3">&quot;red&quot;</span><span class="s1">] * </span><span class="s4">3</span><span class="s0">, True</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([</span><span class="s3">&quot;red&quot;</span><span class="s1">] * </span><span class="s4">3</span><span class="s0">, False</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([</span><span class="s3">&quot;red&quot;</span><span class="s0">, </span><span class="s3">&quot;blue&quot;</span><span class="s0">, </span><span class="s3">&quot;red&quot;</span><span class="s1">]</span><span class="s0">, False</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([</span><span class="s3">&quot;red&quot;</span><span class="s0">, </span><span class="s3">&quot;blue&quot;</span><span class="s0">, </span><span class="s3">&quot;red&quot;</span><span class="s1">]</span><span class="s0">, True</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_concat_repeated_keys(keys</span><span class="s0">, </span><span class="s1">integrity):</span>
    <span class="s2"># GH: 20816</span>
    <span class="s1">series_list = [Series({</span><span class="s3">&quot;a&quot;</span><span class="s1">: </span><span class="s4">1</span><span class="s1">})</span><span class="s0">, </span><span class="s1">Series({</span><span class="s3">&quot;b&quot;</span><span class="s1">: </span><span class="s4">2</span><span class="s1">})</span><span class="s0">, </span><span class="s1">Series({</span><span class="s3">&quot;c&quot;</span><span class="s1">: </span><span class="s4">3</span><span class="s1">})]</span>
    <span class="s1">result = concat(series_list</span><span class="s0">, </span><span class="s1">keys=keys</span><span class="s0">, </span><span class="s1">verify_integrity=integrity)</span>
    <span class="s1">tuples = list(zip(keys</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]))</span>
    <span class="s1">expected = Series([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=MultiIndex.from_tuples(tuples))</span>
    <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_concat_null_object_with_dti():</span>
    <span class="s2"># GH#40841</span>
    <span class="s1">dti = pd.DatetimeIndex(</span>
        <span class="s1">[</span><span class="s3">&quot;2021-04-08 21:21:14+00:00&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;datetime64[ns, UTC]&quot;</span><span class="s0">, </span><span class="s1">name=</span><span class="s3">&quot;Time (UTC)&quot;</span>
    <span class="s1">)</span>
    <span class="s1">right = DataFrame(data={</span><span class="s3">&quot;C&quot;</span><span class="s1">: [</span><span class="s4">0.5274</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=dti)</span>

    <span class="s1">idx = Index([</span><span class="s0">None</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;object&quot;</span><span class="s0">, </span><span class="s1">name=</span><span class="s3">&quot;Maybe Time (UTC)&quot;</span><span class="s1">)</span>
    <span class="s1">left = DataFrame(data={</span><span class="s3">&quot;A&quot;</span><span class="s1">: [</span><span class="s0">None</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s1">: [np.nan]}</span><span class="s0">, </span><span class="s1">index=idx)</span>

    <span class="s1">result = concat([left</span><span class="s0">, </span><span class="s1">right]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">&quot;columns&quot;</span><span class="s1">)</span>

    <span class="s1">exp_index = Index([</span><span class="s0">None, </span><span class="s1">dti[</span><span class="s4">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">dtype=object)</span>
    <span class="s1">expected = DataFrame(</span>
        <span class="s1">{</span><span class="s3">&quot;A&quot;</span><span class="s1">: [</span><span class="s0">None, None</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s1">: [np.nan</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s3">&quot;C&quot;</span><span class="s1">: [np.nan</span><span class="s0">, </span><span class="s4">0.5274</span><span class="s1">]}</span><span class="s0">,</span>
        <span class="s1">index=exp_index</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_concat_multiindex_with_empty_rangeindex():</span>
    <span class="s2"># GH#41234</span>
    <span class="s1">mi = MultiIndex.from_tuples([(</span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;C&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)])</span>
    <span class="s1">df1 = DataFrame([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">columns=mi)</span>
    <span class="s1">df2 = DataFrame(index=[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">columns=pd.RangeIndex(</span><span class="s4">0</span><span class="s1">))</span>

    <span class="s1">result = concat([df1</span><span class="s0">, </span><span class="s1">df2])</span>
    <span class="s1">expected = DataFrame([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[np.nan</span><span class="s0">, </span><span class="s1">np.nan]]</span><span class="s0">, </span><span class="s1">columns=mi)</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s0">def </span><span class="s1">test_concat_posargs_deprecation():</span>
    <span class="s2"># https://github.com/pandas-dev/pandas/issues/41485</span>
    <span class="s1">df = DataFrame([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">&quot;a&quot;</span><span class="s1">])</span>
    <span class="s1">df2 = DataFrame([[</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">&quot;b&quot;</span><span class="s1">])</span>

    <span class="s1">msg = (</span>
        <span class="s3">&quot;In a future version of pandas all arguments of concat &quot;</span>
        <span class="s3">&quot;except for the argument 'objs' will be keyword-only&quot;</span>
    <span class="s1">)</span>
    <span class="s0">with </span><span class="s1">tm.assert_produces_warning(FutureWarning</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">result = concat([df</span><span class="s0">, </span><span class="s1">df2]</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">expected = DataFrame([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">])</span>
    <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;data&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">Series(data=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">DataFrame(</span>
            <span class="s1">data={</span>
                <span class="s3">&quot;col1&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">DataFrame(dtype=float)</span><span class="s0">,</span>
        <span class="s1">Series(dtype=float)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_concat_drop_attrs(data):</span>
    <span class="s2"># GH#41828</span>
    <span class="s1">df1 = data.copy()</span>
    <span class="s1">df1.attrs = {</span><span class="s4">1</span><span class="s1">: </span><span class="s4">1</span><span class="s1">}</span>
    <span class="s1">df2 = data.copy()</span>
    <span class="s1">df2.attrs = {</span><span class="s4">1</span><span class="s1">: </span><span class="s4">2</span><span class="s1">}</span>
    <span class="s1">df = concat([df1</span><span class="s0">, </span><span class="s1">df2])</span>
    <span class="s0">assert </span><span class="s1">len(df.attrs) == </span><span class="s4">0</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;data&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">Series(data=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">DataFrame(</span>
            <span class="s1">data={</span>
                <span class="s3">&quot;col1&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">DataFrame(dtype=float)</span><span class="s0">,</span>
        <span class="s1">Series(dtype=float)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_concat_retain_attrs(data):</span>
    <span class="s2"># GH#41828</span>
    <span class="s1">df1 = data.copy()</span>
    <span class="s1">df1.attrs = {</span><span class="s4">1</span><span class="s1">: </span><span class="s4">1</span><span class="s1">}</span>
    <span class="s1">df2 = data.copy()</span>
    <span class="s1">df2.attrs = {</span><span class="s4">1</span><span class="s1">: </span><span class="s4">1</span><span class="s1">}</span>
    <span class="s1">df = concat([df1</span><span class="s0">, </span><span class="s1">df2])</span>
    <span class="s0">assert </span><span class="s1">df.attrs[</span><span class="s4">1</span><span class="s1">] == </span><span class="s4">1</span>
</pre>
</body>
</html>