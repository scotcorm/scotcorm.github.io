<html>
<head>
<title>test_from_records.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_from_records.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">datetime</span>
<span class="s0">from </span><span class="s1">decimal </span><span class="s0">import </span><span class="s1">Decimal</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">import </span><span class="s1">pytz</span>

<span class="s0">from </span><span class="s1">pandas.compat </span><span class="s0">import </span><span class="s1">is_platform_little_endian</span>

<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">CategoricalIndex</span><span class="s0">,</span>
    <span class="s1">DataFrame</span><span class="s0">,</span>
    <span class="s1">Index</span><span class="s0">,</span>
    <span class="s1">Interval</span><span class="s0">,</span>
    <span class="s1">RangeIndex</span><span class="s0">,</span>
    <span class="s1">Series</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">import </span><span class="s1">pandas._testing </span><span class="s0">as </span><span class="s1">tm</span>


<span class="s0">class </span><span class="s1">TestFromRecords:</span>
    <span class="s0">def </span><span class="s1">test_from_records_with_datetimes(self):</span>

        <span class="s2"># this may fail on certain platforms because of a numpy issue</span>
        <span class="s2"># related GH#6140</span>
        <span class="s0">if not </span><span class="s1">is_platform_little_endian():</span>
            <span class="s1">pytest.skip(</span><span class="s3">&quot;known failure of test on non-little endian&quot;</span><span class="s1">)</span>

        <span class="s2"># construction with a null in a recarray</span>
        <span class="s2"># GH#6140</span>
        <span class="s1">expected = DataFrame({</span><span class="s3">&quot;EXPIRY&quot;</span><span class="s1">: [datetime(</span><span class="s4">2005</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, None</span><span class="s1">]})</span>

        <span class="s1">arrdata = [np.array([datetime(</span><span class="s4">2005</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, None</span><span class="s1">])]</span>
        <span class="s1">dtypes = [(</span><span class="s3">&quot;EXPIRY&quot;</span><span class="s0">, </span><span class="s3">&quot;&lt;M8[ns]&quot;</span><span class="s1">)]</span>

        <span class="s1">recarray = np.core.records.fromarrays(arrdata</span><span class="s0">, </span><span class="s1">dtype=dtypes)</span>

        <span class="s1">result = DataFrame.from_records(recarray)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s2"># coercion should work too</span>
        <span class="s1">arrdata = [np.array([datetime(</span><span class="s4">2005</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, None</span><span class="s1">])]</span>
        <span class="s1">dtypes = [(</span><span class="s3">&quot;EXPIRY&quot;</span><span class="s0">, </span><span class="s3">&quot;&lt;M8[m]&quot;</span><span class="s1">)]</span>
        <span class="s1">recarray = np.core.records.fromarrays(arrdata</span><span class="s0">, </span><span class="s1">dtype=dtypes)</span>
        <span class="s1">result = DataFrame.from_records(recarray)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_from_records_sequencelike(self):</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s3">&quot;A&quot;</span><span class="s1">: np.array(np.random.randn(</span><span class="s4">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=np.float64)</span><span class="s0">,</span>
                <span class="s3">&quot;A1&quot;</span><span class="s1">: np.array(np.random.randn(</span><span class="s4">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=np.float64)</span><span class="s0">,</span>
                <span class="s3">&quot;B&quot;</span><span class="s1">: np.array(np.arange(</span><span class="s4">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=np.int64)</span><span class="s0">,</span>
                <span class="s3">&quot;C&quot;</span><span class="s1">: [</span><span class="s3">&quot;foo&quot;</span><span class="s1">] * </span><span class="s4">6</span><span class="s0">,</span>
                <span class="s3">&quot;D&quot;</span><span class="s1">: np.array([</span><span class="s0">True, False</span><span class="s1">] * </span><span class="s4">3</span><span class="s0">, </span><span class="s1">dtype=bool)</span><span class="s0">,</span>
                <span class="s3">&quot;E&quot;</span><span class="s1">: np.array(np.random.randn(</span><span class="s4">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=np.float32)</span><span class="s0">,</span>
                <span class="s3">&quot;E1&quot;</span><span class="s1">: np.array(np.random.randn(</span><span class="s4">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=np.float32)</span><span class="s0">,</span>
                <span class="s3">&quot;F&quot;</span><span class="s1">: np.array(np.arange(</span><span class="s4">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=np.int32)</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>

        <span class="s2"># this is actually tricky to create the recordlike arrays and</span>
        <span class="s2"># have the dtypes be intact</span>
        <span class="s1">blocks = df._to_dict_of_blocks()</span>
        <span class="s1">tuples = []</span>
        <span class="s1">columns = []</span>
        <span class="s1">dtypes = []</span>
        <span class="s0">for </span><span class="s1">dtype</span><span class="s0">, </span><span class="s1">b </span><span class="s0">in </span><span class="s1">blocks.items():</span>
            <span class="s1">columns.extend(b.columns)</span>
            <span class="s1">dtypes.extend([(c</span><span class="s0">, </span><span class="s1">np.dtype(dtype).descr[</span><span class="s4">0</span><span class="s1">][</span><span class="s4">1</span><span class="s1">]) </span><span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">b.columns])</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(len(df.index)):</span>
            <span class="s1">tup = []</span>
            <span class="s0">for </span><span class="s1">_</span><span class="s0">, </span><span class="s1">b </span><span class="s0">in </span><span class="s1">blocks.items():</span>
                <span class="s1">tup.extend(b.iloc[i].values)</span>
            <span class="s1">tuples.append(tuple(tup))</span>

        <span class="s1">recarray = np.array(tuples</span><span class="s0">, </span><span class="s1">dtype=dtypes).view(np.recarray)</span>
        <span class="s1">recarray2 = df.to_records()</span>
        <span class="s1">lists = [list(x) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">tuples]</span>

        <span class="s2"># tuples (lose the dtype info)</span>
        <span class="s1">result = DataFrame.from_records(tuples</span><span class="s0">, </span><span class="s1">columns=columns).reindex(</span>
            <span class="s1">columns=df.columns</span>
        <span class="s1">)</span>

        <span class="s2"># created recarray and with to_records recarray (have dtype info)</span>
        <span class="s1">result2 = DataFrame.from_records(recarray</span><span class="s0">, </span><span class="s1">columns=columns).reindex(</span>
            <span class="s1">columns=df.columns</span>
        <span class="s1">)</span>
        <span class="s1">result3 = DataFrame.from_records(recarray2</span><span class="s0">, </span><span class="s1">columns=columns).reindex(</span>
            <span class="s1">columns=df.columns</span>
        <span class="s1">)</span>

        <span class="s2"># list of tupels (no dtype info)</span>
        <span class="s1">result4 = DataFrame.from_records(lists</span><span class="s0">, </span><span class="s1">columns=columns).reindex(</span>
            <span class="s1">columns=df.columns</span>
        <span class="s1">)</span>

        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">df</span><span class="s0">, </span><span class="s1">check_dtype=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(result2</span><span class="s0">, </span><span class="s1">df)</span>
        <span class="s1">tm.assert_frame_equal(result3</span><span class="s0">, </span><span class="s1">df)</span>
        <span class="s1">tm.assert_frame_equal(result4</span><span class="s0">, </span><span class="s1">df</span><span class="s0">, </span><span class="s1">check_dtype=</span><span class="s0">False</span><span class="s1">)</span>

        <span class="s2"># tuples is in the order of the columns</span>
        <span class="s1">result = DataFrame.from_records(tuples)</span>
        <span class="s1">tm.assert_index_equal(result.columns</span><span class="s0">, </span><span class="s1">RangeIndex(</span><span class="s4">8</span><span class="s1">))</span>

        <span class="s2"># test exclude parameter &amp; we are casting the results here (as we don't</span>
        <span class="s2"># have dtype info to recover)</span>
        <span class="s1">columns_to_test = [columns.index(</span><span class="s3">&quot;C&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">columns.index(</span><span class="s3">&quot;E1&quot;</span><span class="s1">)]</span>

        <span class="s1">exclude = list(set(range(</span><span class="s4">8</span><span class="s1">)) - set(columns_to_test))</span>
        <span class="s1">result = DataFrame.from_records(tuples</span><span class="s0">, </span><span class="s1">exclude=exclude)</span>
        <span class="s1">result.columns = [columns[i] </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">sorted(columns_to_test)]</span>
        <span class="s1">tm.assert_series_equal(result[</span><span class="s3">&quot;C&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">df[</span><span class="s3">&quot;C&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_series_equal(result[</span><span class="s3">&quot;E1&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">df[</span><span class="s3">&quot;E1&quot;</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_from_records_sequencelike_empty(self):</span>
        <span class="s2"># empty case</span>
        <span class="s1">result = DataFrame.from_records([]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;bar&quot;</span><span class="s0">, </span><span class="s3">&quot;baz&quot;</span><span class="s1">])</span>
        <span class="s0">assert </span><span class="s1">len(result) == </span><span class="s4">0</span>
        <span class="s1">tm.assert_index_equal(result.columns</span><span class="s0">, </span><span class="s1">Index([</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;bar&quot;</span><span class="s0">, </span><span class="s3">&quot;baz&quot;</span><span class="s1">]))</span>

        <span class="s1">result = DataFrame.from_records([])</span>
        <span class="s0">assert </span><span class="s1">len(result) == </span><span class="s4">0</span>
        <span class="s0">assert </span><span class="s1">len(result.columns) == </span><span class="s4">0</span>

    <span class="s0">def </span><span class="s1">test_from_records_dictlike(self):</span>

        <span class="s2"># test the dict methods</span>
        <span class="s1">df = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s3">&quot;A&quot;</span><span class="s1">: np.array(np.random.randn(</span><span class="s4">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=np.float64)</span><span class="s0">,</span>
                <span class="s3">&quot;A1&quot;</span><span class="s1">: np.array(np.random.randn(</span><span class="s4">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=np.float64)</span><span class="s0">,</span>
                <span class="s3">&quot;B&quot;</span><span class="s1">: np.array(np.arange(</span><span class="s4">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=np.int64)</span><span class="s0">,</span>
                <span class="s3">&quot;C&quot;</span><span class="s1">: [</span><span class="s3">&quot;foo&quot;</span><span class="s1">] * </span><span class="s4">6</span><span class="s0">,</span>
                <span class="s3">&quot;D&quot;</span><span class="s1">: np.array([</span><span class="s0">True, False</span><span class="s1">] * </span><span class="s4">3</span><span class="s0">, </span><span class="s1">dtype=bool)</span><span class="s0">,</span>
                <span class="s3">&quot;E&quot;</span><span class="s1">: np.array(np.random.randn(</span><span class="s4">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=np.float32)</span><span class="s0">,</span>
                <span class="s3">&quot;E1&quot;</span><span class="s1">: np.array(np.random.randn(</span><span class="s4">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=np.float32)</span><span class="s0">,</span>
                <span class="s3">&quot;F&quot;</span><span class="s1">: np.array(np.arange(</span><span class="s4">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=np.int32)</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>

        <span class="s2"># columns is in a different order here than the actual items iterated</span>
        <span class="s2"># from the dict</span>
        <span class="s1">blocks = df._to_dict_of_blocks()</span>
        <span class="s1">columns = []</span>
        <span class="s0">for </span><span class="s1">b </span><span class="s0">in </span><span class="s1">blocks.values():</span>
            <span class="s1">columns.extend(b.columns)</span>

        <span class="s1">asdict = {x: y </span><span class="s0">for </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">df.items()}</span>
        <span class="s1">asdict2 = {x: y.values </span><span class="s0">for </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">df.items()}</span>

        <span class="s2"># dict of series &amp; dict of ndarrays (have dtype info)</span>
        <span class="s1">results = []</span>
        <span class="s1">results.append(DataFrame.from_records(asdict).reindex(columns=df.columns))</span>
        <span class="s1">results.append(</span>
            <span class="s1">DataFrame.from_records(asdict</span><span class="s0">, </span><span class="s1">columns=columns).reindex(columns=df.columns)</span>
        <span class="s1">)</span>
        <span class="s1">results.append(</span>
            <span class="s1">DataFrame.from_records(asdict2</span><span class="s0">, </span><span class="s1">columns=columns).reindex(columns=df.columns)</span>
        <span class="s1">)</span>

        <span class="s0">for </span><span class="s1">r </span><span class="s0">in </span><span class="s1">results:</span>
            <span class="s1">tm.assert_frame_equal(r</span><span class="s0">, </span><span class="s1">df)</span>

    <span class="s0">def </span><span class="s1">test_from_records_with_index_data(self):</span>
        <span class="s1">df = DataFrame(np.random.randn(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s3">&quot;C&quot;</span><span class="s1">])</span>

        <span class="s1">data = np.random.randn(</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">df1 = DataFrame.from_records(df</span><span class="s0">, </span><span class="s1">index=data)</span>
        <span class="s1">tm.assert_index_equal(df1.index</span><span class="s0">, </span><span class="s1">Index(data))</span>

    <span class="s0">def </span><span class="s1">test_from_records_bad_index_column(self):</span>
        <span class="s1">df = DataFrame(np.random.randn(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s3">&quot;C&quot;</span><span class="s1">])</span>

        <span class="s2"># should pass</span>
        <span class="s1">df1 = DataFrame.from_records(df</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">&quot;C&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_index_equal(df1.index</span><span class="s0">, </span><span class="s1">Index(df.C))</span>

        <span class="s1">df1 = DataFrame.from_records(df</span><span class="s0">, </span><span class="s1">index=</span><span class="s3">&quot;C&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_index_equal(df1.index</span><span class="s0">, </span><span class="s1">Index(df.C))</span>

        <span class="s2"># should fail</span>
        <span class="s1">msg = </span><span class="s3">&quot;|&quot;</span><span class="s1">.join(</span>
            <span class="s1">[</span>
                <span class="s3">r&quot;Length of values \(10\) does not match length of index \(1\)&quot;</span><span class="s0">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">DataFrame.from_records(df</span><span class="s0">, </span><span class="s1">index=[</span><span class="s4">2</span><span class="s1">])</span>
        <span class="s0">with </span><span class="s1">pytest.raises(KeyError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">r&quot;^2$&quot;</span><span class="s1">):</span>
            <span class="s1">DataFrame.from_records(df</span><span class="s0">, </span><span class="s1">index=</span><span class="s4">2</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_from_records_non_tuple(self):</span>
        <span class="s0">class </span><span class="s1">Record:</span>
            <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">*args):</span>
                <span class="s1">self.args = args</span>

            <span class="s0">def </span><span class="s1">__getitem__(self</span><span class="s0">, </span><span class="s1">i):</span>
                <span class="s0">return </span><span class="s1">self.args[i]</span>

            <span class="s0">def </span><span class="s1">__iter__(self):</span>
                <span class="s0">return </span><span class="s1">iter(self.args)</span>

        <span class="s1">recs = [Record(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">Record(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">Record(</span><span class="s4">7</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">9</span><span class="s1">)]</span>
        <span class="s1">tups = [tuple(rec) </span><span class="s0">for </span><span class="s1">rec </span><span class="s0">in </span><span class="s1">recs]</span>

        <span class="s1">result = DataFrame.from_records(recs)</span>
        <span class="s1">expected = DataFrame.from_records(tups)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_from_records_len0_with_columns(self):</span>
        <span class="s2"># GH#2633</span>
        <span class="s1">result = DataFrame.from_records([]</span><span class="s0">, </span><span class="s1">index=</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s3">&quot;bar&quot;</span><span class="s1">])</span>
        <span class="s1">expected = Index([</span><span class="s3">&quot;bar&quot;</span><span class="s1">])</span>

        <span class="s0">assert </span><span class="s1">len(result) == </span><span class="s4">0</span>
        <span class="s0">assert </span><span class="s1">result.index.name == </span><span class="s3">&quot;foo&quot;</span>
        <span class="s1">tm.assert_index_equal(result.columns</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_from_records_series_list_dict(self):</span>
        <span class="s2"># GH#27358</span>
        <span class="s1">expected = DataFrame([[{</span><span class="s3">&quot;a&quot;</span><span class="s1">: </span><span class="s4">1</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">: </span><span class="s4">2</span><span class="s1">}</span><span class="s0">, </span><span class="s1">{</span><span class="s3">&quot;a&quot;</span><span class="s1">: </span><span class="s4">3</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">: </span><span class="s4">4</span><span class="s1">}]]).T</span>
        <span class="s1">data = Series([[{</span><span class="s3">&quot;a&quot;</span><span class="s1">: </span><span class="s4">1</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">: </span><span class="s4">2</span><span class="s1">}]</span><span class="s0">, </span><span class="s1">[{</span><span class="s3">&quot;a&quot;</span><span class="s1">: </span><span class="s4">3</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">: </span><span class="s4">4</span><span class="s1">}]])</span>
        <span class="s1">result = DataFrame.from_records(data)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_from_records_series_categorical_index(self):</span>
        <span class="s2"># GH#32805</span>
        <span class="s1">index = CategoricalIndex(</span>
            <span class="s1">[Interval(-</span><span class="s4">20</span><span class="s0">, </span><span class="s1">-</span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">Interval(-</span><span class="s4">10</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">Interval(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)]</span>
        <span class="s1">)</span>
        <span class="s1">series_of_dicts = Series([{</span><span class="s3">&quot;a&quot;</span><span class="s1">: </span><span class="s4">1</span><span class="s1">}</span><span class="s0">, </span><span class="s1">{</span><span class="s3">&quot;a&quot;</span><span class="s1">: </span><span class="s4">2</span><span class="s1">}</span><span class="s0">, </span><span class="s1">{</span><span class="s3">&quot;b&quot;</span><span class="s1">: </span><span class="s4">3</span><span class="s1">}]</span><span class="s0">, </span><span class="s1">index=index)</span>
        <span class="s1">frame = DataFrame.from_records(series_of_dicts</span><span class="s0">, </span><span class="s1">index=index)</span>
        <span class="s1">expected = DataFrame(</span>
            <span class="s1">{</span><span class="s3">&quot;a&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">np.NaN]</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">: [np.NaN</span><span class="s0">, </span><span class="s1">np.NaN</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=index</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(frame</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_frame_from_records_utc(self):</span>
        <span class="s1">rec = {</span><span class="s3">&quot;datum&quot;</span><span class="s1">: </span><span class="s4">1.5</span><span class="s0">, </span><span class="s3">&quot;begin_time&quot;</span><span class="s1">: datetime(</span><span class="s4">2006</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">27</span><span class="s0">, </span><span class="s1">tzinfo=pytz.utc)}</span>

        <span class="s2"># it works</span>
        <span class="s1">DataFrame.from_records([rec]</span><span class="s0">, </span><span class="s1">index=</span><span class="s3">&quot;begin_time&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_from_records_to_records(self):</span>
        <span class="s2"># from numpy documentation</span>
        <span class="s1">arr = np.zeros((</span><span class="s4">2</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dtype=(</span><span class="s3">&quot;i4,f4,a10&quot;</span><span class="s1">))</span>
        <span class="s1">arr[:] = [(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2.0</span><span class="s0">, </span><span class="s3">&quot;Hello&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3.0</span><span class="s0">, </span><span class="s3">&quot;World&quot;</span><span class="s1">)]</span>

        <span class="s2"># TODO(wesm): unused</span>
        <span class="s1">frame = DataFrame.from_records(arr)  </span><span class="s2"># noqa</span>

        <span class="s1">index = Index(np.arange(len(arr))[::-</span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">indexed_frame = DataFrame.from_records(arr</span><span class="s0">, </span><span class="s1">index=index)</span>
        <span class="s1">tm.assert_index_equal(indexed_frame.index</span><span class="s0">, </span><span class="s1">index)</span>

        <span class="s2"># without names, it should go to last ditch</span>
        <span class="s1">arr2 = np.zeros((</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">))</span>
        <span class="s1">tm.assert_frame_equal(DataFrame.from_records(arr2)</span><span class="s0">, </span><span class="s1">DataFrame(arr2))</span>

        <span class="s2"># wrong length</span>
        <span class="s1">msg = </span><span class="s3">&quot;|&quot;</span><span class="s1">.join(</span>
            <span class="s1">[</span>
                <span class="s3">r&quot;Length of values \(2\) does not match length of index \(1\)&quot;</span><span class="s0">,</span>
            <span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
            <span class="s1">DataFrame.from_records(arr</span><span class="s0">, </span><span class="s1">index=index[:-</span><span class="s4">1</span><span class="s1">])</span>

        <span class="s1">indexed_frame = DataFrame.from_records(arr</span><span class="s0">, </span><span class="s1">index=</span><span class="s3">&quot;f1&quot;</span><span class="s1">)</span>

        <span class="s2"># what to do?</span>
        <span class="s1">records = indexed_frame.to_records()</span>
        <span class="s0">assert </span><span class="s1">len(records.dtype.names) == </span><span class="s4">3</span>

        <span class="s1">records = indexed_frame.to_records(index=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">len(records.dtype.names) == </span><span class="s4">2</span>
        <span class="s0">assert </span><span class="s3">&quot;index&quot; </span><span class="s0">not in </span><span class="s1">records.dtype.names</span>

    <span class="s0">def </span><span class="s1">test_from_records_nones(self):</span>
        <span class="s1">tuples = [(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, None, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, None, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s0">None, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)]</span>

        <span class="s1">df = DataFrame.from_records(tuples</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;d&quot;</span><span class="s1">])</span>
        <span class="s0">assert </span><span class="s1">np.isnan(df[</span><span class="s3">&quot;c&quot;</span><span class="s1">][</span><span class="s4">0</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_from_records_iterator(self):</span>
        <span class="s1">arr = np.array(</span>
            <span class="s1">[(</span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3.0</span><span class="s0">, </span><span class="s4">3.0</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">5.0</span><span class="s0">, </span><span class="s4">5.0</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">7.0</span><span class="s0">, </span><span class="s4">7.0</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">8</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">dtype=[</span>
                <span class="s1">(</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s1">np.float64)</span><span class="s0">,</span>
                <span class="s1">(</span><span class="s3">&quot;u&quot;</span><span class="s0">, </span><span class="s1">np.float32)</span><span class="s0">,</span>
                <span class="s1">(</span><span class="s3">&quot;y&quot;</span><span class="s0">, </span><span class="s1">np.int64)</span><span class="s0">,</span>
                <span class="s1">(</span><span class="s3">&quot;z&quot;</span><span class="s0">, </span><span class="s1">np.int32)</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span>
        <span class="s1">df = DataFrame.from_records(iter(arr)</span><span class="s0">, </span><span class="s1">nrows=</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">xp = DataFrame(</span>
            <span class="s1">{</span>
                <span class="s3">&quot;x&quot;</span><span class="s1">: np.array([</span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">3.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.float64)</span><span class="s0">,</span>
                <span class="s3">&quot;u&quot;</span><span class="s1">: np.array([</span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">3.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.float32)</span><span class="s0">,</span>
                <span class="s3">&quot;y&quot;</span><span class="s1">: np.array([</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.int64)</span><span class="s0">,</span>
                <span class="s3">&quot;z&quot;</span><span class="s1">: np.array([</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=np.int32)</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(df.reindex_like(xp)</span><span class="s0">, </span><span class="s1">xp)</span>

        <span class="s2"># no dtypes specified here, so just compare with the default</span>
        <span class="s1">arr = [(</span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">3.0</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">5.0</span><span class="s0">, </span><span class="s4">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">7.0</span><span class="s0">, </span><span class="s4">8</span><span class="s1">)]</span>
        <span class="s1">df = DataFrame.from_records(iter(arr)</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">nrows=</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">xp.reindex(columns=[</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s1">])</span><span class="s0">, </span><span class="s1">check_dtype=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_from_records_tuples_generator(self):</span>
        <span class="s0">def </span><span class="s1">tuple_generator(length):</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(length):</span>
                <span class="s1">letters = </span><span class="s3">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>
                <span class="s0">yield </span><span class="s1">(i</span><span class="s0">, </span><span class="s1">letters[i % len(letters)]</span><span class="s0">, </span><span class="s1">i / length)</span>

        <span class="s1">columns_names = [</span><span class="s3">&quot;Integer&quot;</span><span class="s0">, </span><span class="s3">&quot;String&quot;</span><span class="s0">, </span><span class="s3">&quot;Float&quot;</span><span class="s1">]</span>
        <span class="s1">columns = [</span>
            <span class="s1">[i[j] </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">tuple_generator(</span><span class="s4">10</span><span class="s1">)] </span><span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(len(columns_names))</span>
        <span class="s1">]</span>
        <span class="s1">data = {</span><span class="s3">&quot;Integer&quot;</span><span class="s1">: columns[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;String&quot;</span><span class="s1">: columns[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;Float&quot;</span><span class="s1">: columns[</span><span class="s4">2</span><span class="s1">]}</span>
        <span class="s1">expected = DataFrame(data</span><span class="s0">, </span><span class="s1">columns=columns_names)</span>

        <span class="s1">generator = tuple_generator(</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">result = DataFrame.from_records(generator</span><span class="s0">, </span><span class="s1">columns=columns_names)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_from_records_lists_generator(self):</span>
        <span class="s0">def </span><span class="s1">list_generator(length):</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(length):</span>
                <span class="s1">letters = </span><span class="s3">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>
                <span class="s0">yield </span><span class="s1">[i</span><span class="s0">, </span><span class="s1">letters[i % len(letters)]</span><span class="s0">, </span><span class="s1">i / length]</span>

        <span class="s1">columns_names = [</span><span class="s3">&quot;Integer&quot;</span><span class="s0">, </span><span class="s3">&quot;String&quot;</span><span class="s0">, </span><span class="s3">&quot;Float&quot;</span><span class="s1">]</span>
        <span class="s1">columns = [</span>
            <span class="s1">[i[j] </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">list_generator(</span><span class="s4">10</span><span class="s1">)] </span><span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(len(columns_names))</span>
        <span class="s1">]</span>
        <span class="s1">data = {</span><span class="s3">&quot;Integer&quot;</span><span class="s1">: columns[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;String&quot;</span><span class="s1">: columns[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;Float&quot;</span><span class="s1">: columns[</span><span class="s4">2</span><span class="s1">]}</span>
        <span class="s1">expected = DataFrame(data</span><span class="s0">, </span><span class="s1">columns=columns_names)</span>

        <span class="s1">generator = list_generator(</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">result = DataFrame.from_records(generator</span><span class="s0">, </span><span class="s1">columns=columns_names)</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_from_records_columns_not_modified(self):</span>
        <span class="s1">tuples = [(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)]</span>

        <span class="s1">columns = [</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span>
        <span class="s1">original_columns = list(columns)</span>

        <span class="s1">df = DataFrame.from_records(tuples</span><span class="s0">, </span><span class="s1">columns=columns</span><span class="s0">, </span><span class="s1">index=</span><span class="s3">&quot;a&quot;</span><span class="s1">)  </span><span class="s2"># noqa</span>

        <span class="s0">assert </span><span class="s1">columns == original_columns</span>

    <span class="s0">def </span><span class="s1">test_from_records_decimal(self):</span>

        <span class="s1">tuples = [(Decimal(</span><span class="s3">&quot;1.5&quot;</span><span class="s1">)</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(Decimal(</span><span class="s3">&quot;2.5&quot;</span><span class="s1">)</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s0">None,</span><span class="s1">)]</span>

        <span class="s1">df = DataFrame.from_records(tuples</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;a&quot;</span><span class="s1">])</span>
        <span class="s0">assert </span><span class="s1">df[</span><span class="s3">&quot;a&quot;</span><span class="s1">].dtype == object</span>

        <span class="s1">df = DataFrame.from_records(tuples</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;a&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">coerce_float=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">df[</span><span class="s3">&quot;a&quot;</span><span class="s1">].dtype == np.float64</span>
        <span class="s0">assert </span><span class="s1">np.isnan(df[</span><span class="s3">&quot;a&quot;</span><span class="s1">].values[-</span><span class="s4">1</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_from_records_duplicates(self):</span>
        <span class="s1">result = DataFrame.from_records([(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s1">])</span>

        <span class="s1">expected = DataFrame([(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;a&quot;</span><span class="s1">])</span>

        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_from_records_set_index_name(self):</span>
        <span class="s0">def </span><span class="s1">create_dict(order_id):</span>
            <span class="s0">return </span><span class="s1">{</span>
                <span class="s3">&quot;order_id&quot;</span><span class="s1">: order_id</span><span class="s0">,</span>
                <span class="s3">&quot;quantity&quot;</span><span class="s1">: np.random.randint(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s3">&quot;price&quot;</span><span class="s1">: np.random.randint(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">}</span>

        <span class="s1">documents = [create_dict(i) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">10</span><span class="s1">)]</span>
        <span class="s2"># demo missing data</span>
        <span class="s1">documents.append({</span><span class="s3">&quot;order_id&quot;</span><span class="s1">: </span><span class="s4">10</span><span class="s0">, </span><span class="s3">&quot;quantity&quot;</span><span class="s1">: </span><span class="s4">5</span><span class="s1">})</span>

        <span class="s1">result = DataFrame.from_records(documents</span><span class="s0">, </span><span class="s1">index=</span><span class="s3">&quot;order_id&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">result.index.name == </span><span class="s3">&quot;order_id&quot;</span>

        <span class="s2"># MultiIndex</span>
        <span class="s1">result = DataFrame.from_records(documents</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">&quot;order_id&quot;</span><span class="s0">, </span><span class="s3">&quot;quantity&quot;</span><span class="s1">])</span>
        <span class="s0">assert </span><span class="s1">result.index.names == (</span><span class="s3">&quot;order_id&quot;</span><span class="s0">, </span><span class="s3">&quot;quantity&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_from_records_misc_brokenness(self):</span>
        <span class="s2"># GH#2179</span>

        <span class="s1">data = {</span><span class="s4">1</span><span class="s1">: [</span><span class="s3">&quot;foo&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s4">2</span><span class="s1">: [</span><span class="s3">&quot;bar&quot;</span><span class="s1">]}</span>

        <span class="s1">result = DataFrame.from_records(data</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">])</span>
        <span class="s1">exp = DataFrame(data</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s2"># overlap in index/index_names</span>

        <span class="s1">data = {</span><span class="s3">&quot;a&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">: [</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]}</span>

        <span class="s1">result = DataFrame.from_records(data</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">exp = DataFrame(data</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">exp)</span>

        <span class="s2"># GH#2623</span>
        <span class="s1">rows = []</span>
        <span class="s1">rows.append([datetime(</span><span class="s4">2010</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">rows.append([datetime(</span><span class="s4">2010</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s3">&quot;hi&quot;</span><span class="s1">])  </span><span class="s2"># test col upconverts to obj</span>
        <span class="s1">df2_obj = DataFrame.from_records(rows</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;date&quot;</span><span class="s0">, </span><span class="s3">&quot;test&quot;</span><span class="s1">])</span>
        <span class="s1">result = df2_obj.dtypes</span>
        <span class="s1">expected = Series(</span>
            <span class="s1">[np.dtype(</span><span class="s3">&quot;datetime64[ns]&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.dtype(</span><span class="s3">&quot;object&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">&quot;date&quot;</span><span class="s0">, </span><span class="s3">&quot;test&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">rows = []</span>
        <span class="s1">rows.append([datetime(</span><span class="s4">2010</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">rows.append([datetime(</span><span class="s4">2010</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">df2_obj = DataFrame.from_records(rows</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;date&quot;</span><span class="s0">, </span><span class="s3">&quot;test&quot;</span><span class="s1">])</span>
        <span class="s1">result = df2_obj.dtypes</span>
        <span class="s1">expected = Series(</span>
            <span class="s1">[np.dtype(</span><span class="s3">&quot;datetime64[ns]&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.dtype(</span><span class="s3">&quot;int64&quot;</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">index=[</span><span class="s3">&quot;date&quot;</span><span class="s0">, </span><span class="s3">&quot;test&quot;</span><span class="s1">]</span>
        <span class="s1">)</span>
        <span class="s1">tm.assert_series_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_from_records_empty(self):</span>
        <span class="s2"># GH#3562</span>
        <span class="s1">result = DataFrame.from_records([]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">expected = DataFrame(columns=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">result = DataFrame.from_records([]</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">])</span>
        <span class="s1">expected = DataFrame(columns=[</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

    <span class="s0">def </span><span class="s1">test_from_records_empty_with_nonempty_fields_gh3682(self):</span>
        <span class="s1">a = np.array([(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">dtype=[(</span><span class="s3">&quot;id&quot;</span><span class="s0">, </span><span class="s1">np.int64)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;value&quot;</span><span class="s0">, </span><span class="s1">np.int64)])</span>
        <span class="s1">df = DataFrame.from_records(a</span><span class="s0">, </span><span class="s1">index=</span><span class="s3">&quot;id&quot;</span><span class="s1">)</span>

        <span class="s1">ex_index = Index([</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">name=</span><span class="s3">&quot;id&quot;</span><span class="s1">)</span>
        <span class="s1">expected = DataFrame({</span><span class="s3">&quot;value&quot;</span><span class="s1">: [</span><span class="s4">2</span><span class="s1">]}</span><span class="s0">, </span><span class="s1">index=ex_index</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s3">&quot;value&quot;</span><span class="s1">])</span>
        <span class="s1">tm.assert_frame_equal(df</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">b = a[:</span><span class="s4">0</span><span class="s1">]</span>
        <span class="s1">df2 = DataFrame.from_records(b</span><span class="s0">, </span><span class="s1">index=</span><span class="s3">&quot;id&quot;</span><span class="s1">)</span>
        <span class="s1">tm.assert_frame_equal(df2</span><span class="s0">, </span><span class="s1">df.iloc[:</span><span class="s4">0</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_from_records_empty2(self):</span>
        <span class="s2"># GH#42456</span>
        <span class="s1">dtype = [(</span><span class="s3">&quot;prop&quot;</span><span class="s0">, </span><span class="s1">int)]</span>
        <span class="s1">shape = (</span><span class="s4">0</span><span class="s0">, </span><span class="s1">len(dtype))</span>
        <span class="s1">arr = np.empty(shape</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>

        <span class="s1">result = DataFrame.from_records(arr)</span>
        <span class="s1">expected = DataFrame({</span><span class="s3">&quot;prop&quot;</span><span class="s1">: np.array([]</span><span class="s0">, </span><span class="s1">dtype=int)})</span>
        <span class="s1">tm.assert_frame_equal(result</span><span class="s0">, </span><span class="s1">expected)</span>

        <span class="s1">alt = DataFrame(arr)</span>
        <span class="s1">tm.assert_frame_equal(alt</span><span class="s0">, </span><span class="s1">expected)</span>
</pre>
</body>
</html>