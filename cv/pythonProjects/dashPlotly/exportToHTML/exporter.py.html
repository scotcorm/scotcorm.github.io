<html>
<head>
<title>exporter.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #808080;}
.s4 { color: #6a8759;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
exporter.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Matplotlib Exporter 
=================== 
This submodule contains tools for crawling a matplotlib figure and exporting 
relevant pieces to a renderer. 
&quot;&quot;&quot;</span>
<span class="s2">import </span><span class="s1">warnings</span>
<span class="s2">import </span><span class="s1">io</span>
<span class="s2">from </span><span class="s1">. </span><span class="s2">import </span><span class="s1">utils</span>

<span class="s2">import </span><span class="s1">matplotlib</span>
<span class="s2">from </span><span class="s1">matplotlib </span><span class="s2">import </span><span class="s1">transforms</span><span class="s2">, </span><span class="s1">collections</span>
<span class="s2">from </span><span class="s1">matplotlib.backends.backend_agg </span><span class="s2">import </span><span class="s1">FigureCanvasAgg</span>


<span class="s2">class </span><span class="s1">Exporter(object):</span>
    <span class="s0">&quot;&quot;&quot;Matplotlib Exporter 
 
    Parameters 
    ---------- 
    renderer : Renderer object 
        The renderer object called by the exporter to create a figure 
        visualization.  See mplexporter.Renderer for information on the 
        methods which should be defined within the renderer. 
    close_mpl : bool 
        If True (default), close the matplotlib figure as it is rendered. This 
        is useful for when the exporter is used within the notebook, or with 
        an interactive matplotlib backend. 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__(self</span><span class="s2">, </span><span class="s1">renderer</span><span class="s2">, </span><span class="s1">close_mpl=</span><span class="s2">True</span><span class="s1">):</span>
        <span class="s1">self.close_mpl = close_mpl</span>
        <span class="s1">self.renderer = renderer</span>

    <span class="s2">def </span><span class="s1">run(self</span><span class="s2">, </span><span class="s1">fig):</span>
        <span class="s0">&quot;&quot;&quot; 
        Run the exporter on the given figure 
 
        Parmeters 
        --------- 
        fig : matplotlib.Figure instance 
            The figure to export 
        &quot;&quot;&quot;</span>
        <span class="s3"># Calling savefig executes the draw() command, putting elements</span>
        <span class="s3"># in the correct place.</span>
        <span class="s2">if </span><span class="s1">fig.canvas </span><span class="s2">is None</span><span class="s1">:</span>
            <span class="s1">canvas = FigureCanvasAgg(fig)</span>
        <span class="s1">fig.savefig(io.BytesIO()</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">&quot;png&quot;</span><span class="s2">, </span><span class="s1">dpi=fig.dpi)</span>
        <span class="s2">if </span><span class="s1">self.close_mpl:</span>
            <span class="s2">import </span><span class="s1">matplotlib.pyplot </span><span class="s2">as </span><span class="s1">plt</span>

            <span class="s1">plt.close(fig)</span>
        <span class="s1">self.crawl_fig(fig)</span>

    <span class="s1">@staticmethod</span>
    <span class="s2">def </span><span class="s1">process_transform(</span>
        <span class="s1">transform</span><span class="s2">, </span><span class="s1">ax=</span><span class="s2">None, </span><span class="s1">data=</span><span class="s2">None, </span><span class="s1">return_trans=</span><span class="s2">False, </span><span class="s1">force_trans=</span><span class="s2">None</span>
    <span class="s1">):</span>
        <span class="s0">&quot;&quot;&quot;Process the transform and convert data to figure or data coordinates 
 
        Parameters 
        ---------- 
        transform : matplotlib Transform object 
            The transform applied to the data 
        ax : matplotlib Axes object (optional) 
            The axes the data is associated with 
        data : ndarray (optional) 
            The array of data to be transformed. 
        return_trans : bool (optional) 
            If true, return the final transform of the data 
        force_trans : matplotlib.transform instance (optional) 
            If supplied, first force the data to this transform 
 
        Returns 
        ------- 
        code : string 
            Code is either &quot;data&quot;, &quot;axes&quot;, &quot;figure&quot;, or &quot;display&quot;, indicating 
            the type of coordinates output. 
        transform : matplotlib transform 
            the transform used to map input data to output data. 
            Returned only if return_trans is True 
        new_data : ndarray 
            Data transformed to match the given coordinate code. 
            Returned only if data is specified 
        &quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s1">isinstance(transform</span><span class="s2">, </span><span class="s1">transforms.BlendedGenericTransform):</span>
            <span class="s1">warnings.warn(</span>
                <span class="s4">&quot;Blended transforms not yet supported. &quot;</span>
                <span class="s4">&quot;Zoom behavior may not work as expected.&quot;</span>
            <span class="s1">)</span>

        <span class="s2">if </span><span class="s1">force_trans </span><span class="s2">is not None</span><span class="s1">:</span>
            <span class="s2">if </span><span class="s1">data </span><span class="s2">is not None</span><span class="s1">:</span>
                <span class="s1">data = (transform - force_trans).transform(data)</span>
            <span class="s1">transform = force_trans</span>

        <span class="s1">code = </span><span class="s4">&quot;display&quot;</span>
        <span class="s2">if </span><span class="s1">ax </span><span class="s2">is not None</span><span class="s1">:</span>
            <span class="s2">for </span><span class="s1">(c</span><span class="s2">, </span><span class="s1">trans) </span><span class="s2">in </span><span class="s1">[</span>
                <span class="s1">(</span><span class="s4">&quot;data&quot;</span><span class="s2">, </span><span class="s1">ax.transData)</span><span class="s2">,</span>
                <span class="s1">(</span><span class="s4">&quot;axes&quot;</span><span class="s2">, </span><span class="s1">ax.transAxes)</span><span class="s2">,</span>
                <span class="s1">(</span><span class="s4">&quot;figure&quot;</span><span class="s2">, </span><span class="s1">ax.figure.transFigure)</span><span class="s2">,</span>
                <span class="s1">(</span><span class="s4">&quot;display&quot;</span><span class="s2">, </span><span class="s1">transforms.IdentityTransform())</span><span class="s2">,</span>
            <span class="s1">]:</span>
                <span class="s2">if </span><span class="s1">transform.contains_branch(trans):</span>
                    <span class="s1">code</span><span class="s2">, </span><span class="s1">transform = (c</span><span class="s2">, </span><span class="s1">transform - trans)</span>
                    <span class="s2">break</span>

        <span class="s2">if </span><span class="s1">data </span><span class="s2">is not None</span><span class="s1">:</span>
            <span class="s2">if </span><span class="s1">return_trans:</span>
                <span class="s2">return </span><span class="s1">code</span><span class="s2">, </span><span class="s1">transform.transform(data)</span><span class="s2">, </span><span class="s1">transform</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s2">return </span><span class="s1">code</span><span class="s2">, </span><span class="s1">transform.transform(data)</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s2">if </span><span class="s1">return_trans:</span>
                <span class="s2">return </span><span class="s1">code</span><span class="s2">, </span><span class="s1">transform</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s2">return </span><span class="s1">code</span>

    <span class="s2">def </span><span class="s1">crawl_fig(self</span><span class="s2">, </span><span class="s1">fig):</span>
        <span class="s0">&quot;&quot;&quot;Crawl the figure and process all axes&quot;&quot;&quot;</span>
        <span class="s2">with </span><span class="s1">self.renderer.draw_figure(fig=fig</span><span class="s2">, </span><span class="s1">props=utils.get_figure_properties(fig)):</span>
            <span class="s2">for </span><span class="s1">ax </span><span class="s2">in </span><span class="s1">fig.axes:</span>
                <span class="s1">self.crawl_ax(ax)</span>

    <span class="s2">def </span><span class="s1">crawl_ax(self</span><span class="s2">, </span><span class="s1">ax):</span>
        <span class="s0">&quot;&quot;&quot;Crawl the axes and process all elements within&quot;&quot;&quot;</span>
        <span class="s2">with </span><span class="s1">self.renderer.draw_axes(ax=ax</span><span class="s2">, </span><span class="s1">props=utils.get_axes_properties(ax)):</span>
            <span class="s2">for </span><span class="s1">line </span><span class="s2">in </span><span class="s1">ax.lines:</span>
                <span class="s1">self.draw_line(ax</span><span class="s2">, </span><span class="s1">line)</span>
            <span class="s2">for </span><span class="s1">text </span><span class="s2">in </span><span class="s1">ax.texts:</span>
                <span class="s1">self.draw_text(ax</span><span class="s2">, </span><span class="s1">text)</span>
            <span class="s2">for </span><span class="s1">(text</span><span class="s2">, </span><span class="s1">ttp) </span><span class="s2">in </span><span class="s1">zip(</span>
                <span class="s1">[ax.xaxis.label</span><span class="s2">, </span><span class="s1">ax.yaxis.label</span><span class="s2">, </span><span class="s1">ax.title]</span><span class="s2">,</span>
                <span class="s1">[</span><span class="s4">&quot;xlabel&quot;</span><span class="s2">, </span><span class="s4">&quot;ylabel&quot;</span><span class="s2">, </span><span class="s4">&quot;title&quot;</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">):</span>
                <span class="s2">if </span><span class="s1">hasattr(text</span><span class="s2">, </span><span class="s4">&quot;get_text&quot;</span><span class="s1">) </span><span class="s2">and </span><span class="s1">text.get_text():</span>
                    <span class="s1">self.draw_text(ax</span><span class="s2">, </span><span class="s1">text</span><span class="s2">, </span><span class="s1">force_trans=ax.transAxes</span><span class="s2">, </span><span class="s1">text_type=ttp)</span>
            <span class="s2">for </span><span class="s1">artist </span><span class="s2">in </span><span class="s1">ax.artists:</span>
                <span class="s3"># TODO: process other artists</span>
                <span class="s2">if </span><span class="s1">isinstance(artist</span><span class="s2">, </span><span class="s1">matplotlib.text.Text):</span>
                    <span class="s1">self.draw_text(ax</span><span class="s2">, </span><span class="s1">artist)</span>
            <span class="s2">for </span><span class="s1">patch </span><span class="s2">in </span><span class="s1">ax.patches:</span>
                <span class="s1">self.draw_patch(ax</span><span class="s2">, </span><span class="s1">patch)</span>
            <span class="s2">for </span><span class="s1">collection </span><span class="s2">in </span><span class="s1">ax.collections:</span>
                <span class="s1">self.draw_collection(ax</span><span class="s2">, </span><span class="s1">collection)</span>
            <span class="s2">for </span><span class="s1">image </span><span class="s2">in </span><span class="s1">ax.images:</span>
                <span class="s1">self.draw_image(ax</span><span class="s2">, </span><span class="s1">image)</span>

            <span class="s1">legend = ax.get_legend()</span>
            <span class="s2">if </span><span class="s1">legend </span><span class="s2">is not None</span><span class="s1">:</span>
                <span class="s1">props = utils.get_legend_properties(ax</span><span class="s2">, </span><span class="s1">legend)</span>
                <span class="s2">with </span><span class="s1">self.renderer.draw_legend(legend=legend</span><span class="s2">, </span><span class="s1">props=props):</span>
                    <span class="s2">if </span><span class="s1">props[</span><span class="s4">&quot;visible&quot;</span><span class="s1">]:</span>
                        <span class="s1">self.crawl_legend(ax</span><span class="s2">, </span><span class="s1">legend)</span>

    <span class="s2">def </span><span class="s1">crawl_legend(self</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">legend):</span>
        <span class="s0">&quot;&quot;&quot; 
        Recursively look through objects in legend children 
        &quot;&quot;&quot;</span>
        <span class="s1">legendElements = list(</span>
            <span class="s1">utils.iter_all_children(legend._legend_box</span><span class="s2">, </span><span class="s1">skipContainers=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">)</span>
        <span class="s1">legendElements.append(legend.legendPatch)</span>
        <span class="s2">for </span><span class="s1">child </span><span class="s2">in </span><span class="s1">legendElements:</span>
            <span class="s3"># force a large zorder so it appears on top</span>
            <span class="s1">child.set_zorder(</span><span class="s5">1e6 </span><span class="s1">+ child.get_zorder())</span>

            <span class="s3"># reorder border box to make sure marks are visible</span>
            <span class="s2">if </span><span class="s1">isinstance(child</span><span class="s2">, </span><span class="s1">matplotlib.patches.FancyBboxPatch):</span>
                <span class="s1">child.set_zorder(child.get_zorder() - </span><span class="s5">1</span><span class="s1">)</span>

            <span class="s2">try</span><span class="s1">:</span>
                <span class="s3"># What kind of object...</span>
                <span class="s2">if </span><span class="s1">isinstance(child</span><span class="s2">, </span><span class="s1">matplotlib.patches.Patch):</span>
                    <span class="s1">self.draw_patch(ax</span><span class="s2">, </span><span class="s1">child</span><span class="s2">, </span><span class="s1">force_trans=ax.transAxes)</span>
                <span class="s2">elif </span><span class="s1">isinstance(child</span><span class="s2">, </span><span class="s1">matplotlib.text.Text):</span>
                    <span class="s2">if </span><span class="s1">child.get_text() != </span><span class="s4">&quot;None&quot;</span><span class="s1">:</span>
                        <span class="s1">self.draw_text(ax</span><span class="s2">, </span><span class="s1">child</span><span class="s2">, </span><span class="s1">force_trans=ax.transAxes)</span>
                <span class="s2">elif </span><span class="s1">isinstance(child</span><span class="s2">, </span><span class="s1">matplotlib.lines.Line2D):</span>
                    <span class="s1">self.draw_line(ax</span><span class="s2">, </span><span class="s1">child</span><span class="s2">, </span><span class="s1">force_trans=ax.transAxes)</span>
                <span class="s2">elif </span><span class="s1">isinstance(child</span><span class="s2">, </span><span class="s1">matplotlib.collections.Collection):</span>
                    <span class="s1">self.draw_collection(ax</span><span class="s2">, </span><span class="s1">child</span><span class="s2">, </span><span class="s1">force_pathtrans=ax.transAxes)</span>
                <span class="s2">else</span><span class="s1">:</span>
                    <span class="s1">warnings.warn(</span><span class="s4">&quot;Legend element %s not impemented&quot; </span><span class="s1">% child)</span>
            <span class="s2">except </span><span class="s1">NotImplementedError:</span>
                <span class="s1">warnings.warn(</span><span class="s4">&quot;Legend element %s not impemented&quot; </span><span class="s1">% child)</span>

    <span class="s2">def </span><span class="s1">draw_line(self</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">line</span><span class="s2">, </span><span class="s1">force_trans=</span><span class="s2">None</span><span class="s1">):</span>
        <span class="s0">&quot;&quot;&quot;Process a matplotlib line and call renderer.draw_line&quot;&quot;&quot;</span>
        <span class="s1">coordinates</span><span class="s2">, </span><span class="s1">data = self.process_transform(</span>
            <span class="s1">line.get_transform()</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">line.get_xydata()</span><span class="s2">, </span><span class="s1">force_trans=force_trans</span>
        <span class="s1">)</span>
        <span class="s1">linestyle = utils.get_line_style(line)</span>
        <span class="s2">if </span><span class="s1">linestyle[</span><span class="s4">&quot;dasharray&quot;</span><span class="s1">] </span><span class="s2">is None and </span><span class="s1">linestyle[</span><span class="s4">&quot;drawstyle&quot;</span><span class="s1">] == </span><span class="s4">&quot;default&quot;</span><span class="s1">:</span>
            <span class="s1">linestyle = </span><span class="s2">None</span>
        <span class="s1">markerstyle = utils.get_marker_style(line)</span>
        <span class="s2">if </span><span class="s1">(</span>
            <span class="s1">markerstyle[</span><span class="s4">&quot;marker&quot;</span><span class="s1">] </span><span class="s2">in </span><span class="s1">[</span><span class="s4">&quot;None&quot;</span><span class="s2">, </span><span class="s4">&quot;none&quot;</span><span class="s2">, None</span><span class="s1">]</span>
            <span class="s2">or </span><span class="s1">markerstyle[</span><span class="s4">&quot;markerpath&quot;</span><span class="s1">][</span><span class="s5">0</span><span class="s1">].size == </span><span class="s5">0</span>
        <span class="s1">):</span>
            <span class="s1">markerstyle = </span><span class="s2">None</span>
        <span class="s1">label = line.get_label()</span>
        <span class="s2">if </span><span class="s1">markerstyle </span><span class="s2">or </span><span class="s1">linestyle:</span>
            <span class="s1">self.renderer.draw_marked_line(</span>
                <span class="s1">data=data</span><span class="s2">,</span>
                <span class="s1">coordinates=coordinates</span><span class="s2">,</span>
                <span class="s1">linestyle=linestyle</span><span class="s2">,</span>
                <span class="s1">markerstyle=markerstyle</span><span class="s2">,</span>
                <span class="s1">label=label</span><span class="s2">,</span>
                <span class="s1">mplobj=line</span><span class="s2">,</span>
            <span class="s1">)</span>

    <span class="s2">def </span><span class="s1">draw_text(self</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">text</span><span class="s2">, </span><span class="s1">force_trans=</span><span class="s2">None, </span><span class="s1">text_type=</span><span class="s2">None</span><span class="s1">):</span>
        <span class="s0">&quot;&quot;&quot;Process a matplotlib text object and call renderer.draw_text&quot;&quot;&quot;</span>
        <span class="s1">content = text.get_text()</span>
        <span class="s2">if </span><span class="s1">content:</span>
            <span class="s1">transform = text.get_transform()</span>
            <span class="s1">position = text.get_position()</span>
            <span class="s1">coords</span><span class="s2">, </span><span class="s1">position = self.process_transform(</span>
                <span class="s1">transform</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">position</span><span class="s2">, </span><span class="s1">force_trans=force_trans</span>
            <span class="s1">)</span>
            <span class="s1">style = utils.get_text_style(text)</span>
            <span class="s1">self.renderer.draw_text(</span>
                <span class="s1">text=content</span><span class="s2">,</span>
                <span class="s1">position=position</span><span class="s2">,</span>
                <span class="s1">coordinates=coords</span><span class="s2">,</span>
                <span class="s1">text_type=text_type</span><span class="s2">,</span>
                <span class="s1">style=style</span><span class="s2">,</span>
                <span class="s1">mplobj=text</span><span class="s2">,</span>
            <span class="s1">)</span>

    <span class="s2">def </span><span class="s1">draw_patch(self</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">patch</span><span class="s2">, </span><span class="s1">force_trans=</span><span class="s2">None</span><span class="s1">):</span>
        <span class="s0">&quot;&quot;&quot;Process a matplotlib patch object and call renderer.draw_path&quot;&quot;&quot;</span>
        <span class="s1">vertices</span><span class="s2">, </span><span class="s1">pathcodes = utils.SVG_path(patch.get_path())</span>
        <span class="s1">transform = patch.get_transform()</span>
        <span class="s1">coordinates</span><span class="s2">, </span><span class="s1">vertices = self.process_transform(</span>
            <span class="s1">transform</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">vertices</span><span class="s2">, </span><span class="s1">force_trans=force_trans</span>
        <span class="s1">)</span>
        <span class="s1">linestyle = utils.get_path_style(patch</span><span class="s2">, </span><span class="s1">fill=patch.get_fill())</span>
        <span class="s1">self.renderer.draw_path(</span>
            <span class="s1">data=vertices</span><span class="s2">,</span>
            <span class="s1">coordinates=coordinates</span><span class="s2">,</span>
            <span class="s1">pathcodes=pathcodes</span><span class="s2">,</span>
            <span class="s1">style=linestyle</span><span class="s2">,</span>
            <span class="s1">mplobj=patch</span><span class="s2">,</span>
        <span class="s1">)</span>

    <span class="s2">def </span><span class="s1">draw_collection(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">collection</span><span class="s2">, </span><span class="s1">force_pathtrans=</span><span class="s2">None, </span><span class="s1">force_offsettrans=</span><span class="s2">None</span>
    <span class="s1">):</span>
        <span class="s0">&quot;&quot;&quot;Process a matplotlib collection and call renderer.draw_collection&quot;&quot;&quot;</span>
        <span class="s1">(transform</span><span class="s2">, </span><span class="s1">transOffset</span><span class="s2">, </span><span class="s1">offsets</span><span class="s2">, </span><span class="s1">paths) = collection._prepare_points()</span>

        <span class="s1">offset_coords</span><span class="s2">, </span><span class="s1">offsets = self.process_transform(</span>
            <span class="s1">transOffset</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">offsets</span><span class="s2">, </span><span class="s1">force_trans=force_offsettrans</span>
        <span class="s1">)</span>
        <span class="s1">path_coords = self.process_transform(transform</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">force_trans=force_pathtrans)</span>

        <span class="s1">processed_paths = [utils.SVG_path(path) </span><span class="s2">for </span><span class="s1">path </span><span class="s2">in </span><span class="s1">paths]</span>
        <span class="s1">processed_paths = [</span>
            <span class="s1">(</span>
                <span class="s1">self.process_transform(</span>
                    <span class="s1">transform</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">path[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">force_trans=force_pathtrans</span>
                <span class="s1">)[</span><span class="s5">1</span><span class="s1">]</span><span class="s2">,</span>
                <span class="s1">path[</span><span class="s5">1</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">)</span>
            <span class="s2">for </span><span class="s1">path </span><span class="s2">in </span><span class="s1">processed_paths</span>
        <span class="s1">]</span>

        <span class="s1">path_transforms = collection.get_transforms()</span>
        <span class="s2">try</span><span class="s1">:</span>
            <span class="s3"># matplotlib 1.3: path_transforms are transform objects.</span>
            <span class="s3"># Convert them to numpy arrays.</span>
            <span class="s1">path_transforms = [t.get_matrix() </span><span class="s2">for </span><span class="s1">t </span><span class="s2">in </span><span class="s1">path_transforms]</span>
        <span class="s2">except </span><span class="s1">AttributeError:</span>
            <span class="s3"># matplotlib 1.4: path transforms are already numpy arrays.</span>
            <span class="s2">pass</span>

        <span class="s1">styles = {</span>
            <span class="s4">&quot;linewidth&quot;</span><span class="s1">: collection.get_linewidths()</span><span class="s2">,</span>
            <span class="s4">&quot;facecolor&quot;</span><span class="s1">: collection.get_facecolors()</span><span class="s2">,</span>
            <span class="s4">&quot;edgecolor&quot;</span><span class="s1">: collection.get_edgecolors()</span><span class="s2">,</span>
            <span class="s4">&quot;alpha&quot;</span><span class="s1">: collection._alpha</span><span class="s2">,</span>
            <span class="s4">&quot;zorder&quot;</span><span class="s1">: collection.get_zorder()</span><span class="s2">,</span>
        <span class="s1">}</span>

        <span class="s1">offset_dict = {</span><span class="s4">&quot;data&quot;</span><span class="s1">: </span><span class="s4">&quot;before&quot;</span><span class="s2">, </span><span class="s4">&quot;screen&quot;</span><span class="s1">: </span><span class="s4">&quot;after&quot;</span><span class="s1">}</span>
        <span class="s1">offset_order = offset_dict[collection.get_offset_position()]</span>

        <span class="s1">self.renderer.draw_path_collection(</span>
            <span class="s1">paths=processed_paths</span><span class="s2">,</span>
            <span class="s1">path_coordinates=path_coords</span><span class="s2">,</span>
            <span class="s1">path_transforms=path_transforms</span><span class="s2">,</span>
            <span class="s1">offsets=offsets</span><span class="s2">,</span>
            <span class="s1">offset_coordinates=offset_coords</span><span class="s2">,</span>
            <span class="s1">offset_order=offset_order</span><span class="s2">,</span>
            <span class="s1">styles=styles</span><span class="s2">,</span>
            <span class="s1">mplobj=collection</span><span class="s2">,</span>
        <span class="s1">)</span>

    <span class="s2">def </span><span class="s1">draw_image(self</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">image):</span>
        <span class="s0">&quot;&quot;&quot;Process a matplotlib image object and call renderer.draw_image&quot;&quot;&quot;</span>
        <span class="s1">self.renderer.draw_image(</span>
            <span class="s1">imdata=utils.image_to_base64(image)</span><span class="s2">,</span>
            <span class="s1">extent=image.get_extent()</span><span class="s2">,</span>
            <span class="s1">coordinates=</span><span class="s4">&quot;data&quot;</span><span class="s2">,</span>
            <span class="s1">style={</span><span class="s4">&quot;alpha&quot;</span><span class="s1">: image.get_alpha()</span><span class="s2">, </span><span class="s4">&quot;zorder&quot;</span><span class="s1">: image.get_zorder()}</span><span class="s2">,</span>
            <span class="s1">mplobj=image</span><span class="s2">,</span>
        <span class="s1">)</span>
</pre>
</body>
</html>