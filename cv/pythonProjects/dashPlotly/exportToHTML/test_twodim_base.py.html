<html>
<head>
<title>test_twodim_base.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
.s5 { color: #a5c261;}
.s6 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_twodim_base.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;Test functions for matrix module 
 
&quot;&quot;&quot;</span>
<span class="s2">from </span><span class="s1">numpy.testing </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">assert_equal</span><span class="s2">, </span><span class="s1">assert_array_equal</span><span class="s2">, </span><span class="s1">assert_array_max_ulp</span><span class="s2">,</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">, </span><span class="s1">assert_raises</span><span class="s2">, </span><span class="s1">assert_</span>
    <span class="s1">)</span>

<span class="s2">from </span><span class="s1">numpy </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">arange</span><span class="s2">, </span><span class="s1">add</span><span class="s2">, </span><span class="s1">fliplr</span><span class="s2">, </span><span class="s1">flipud</span><span class="s2">, </span><span class="s1">zeros</span><span class="s2">, </span><span class="s1">ones</span><span class="s2">, </span><span class="s1">eye</span><span class="s2">, </span><span class="s1">array</span><span class="s2">, </span><span class="s1">diag</span><span class="s2">, </span><span class="s1">histogram2d</span><span class="s2">,</span>
    <span class="s1">tri</span><span class="s2">, </span><span class="s1">mask_indices</span><span class="s2">, </span><span class="s1">triu_indices</span><span class="s2">, </span><span class="s1">triu_indices_from</span><span class="s2">, </span><span class="s1">tril_indices</span><span class="s2">,</span>
    <span class="s1">tril_indices_from</span><span class="s2">, </span><span class="s1">vander</span><span class="s2">,</span>
    <span class="s1">)</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>


<span class="s2">from </span><span class="s1">numpy.core.tests.test_overrides </span><span class="s2">import </span><span class="s1">requires_array_function</span>


<span class="s2">import </span><span class="s1">pytest</span>


<span class="s2">def </span><span class="s1">get_mat(n):</span>
    <span class="s1">data = arange(n)</span>
    <span class="s1">data = add.outer(data</span><span class="s2">, </span><span class="s1">data)</span>
    <span class="s2">return </span><span class="s1">data</span>


<span class="s2">class </span><span class="s1">TestEye:</span>
    <span class="s2">def </span><span class="s1">test_basic(self):</span>
        <span class="s1">assert_equal(eye(</span><span class="s3">4</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s1">array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]]))</span>

        <span class="s1">assert_equal(eye(</span><span class="s3">4</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s4">'f'</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s1">array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]]</span><span class="s2">, </span><span class="s4">'f'</span><span class="s1">))</span>

        <span class="s1">assert_equal(eye(</span><span class="s3">3</span><span class="s1">) == </span><span class="s3">1</span><span class="s2">,</span>
                     <span class="s1">eye(</span><span class="s3">3</span><span class="s2">, </span><span class="s1">dtype=bool))</span>

    <span class="s2">def </span><span class="s1">test_diag(self):</span>
        <span class="s1">assert_equal(eye(</span><span class="s3">4</span><span class="s2">, </span><span class="s1">k=</span><span class="s3">1</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s1">array([[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]]))</span>

        <span class="s1">assert_equal(eye(</span><span class="s3">4</span><span class="s2">, </span><span class="s1">k=-</span><span class="s3">1</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s1">array([[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]]))</span>

    <span class="s2">def </span><span class="s1">test_2d(self):</span>
        <span class="s1">assert_equal(eye(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">3</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s1">array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]]))</span>

        <span class="s1">assert_equal(eye(</span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s1">array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]]))</span>

    <span class="s2">def </span><span class="s1">test_diag2d(self):</span>
        <span class="s1">assert_equal(eye(</span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s1">k=</span><span class="s3">2</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s1">array([[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]]))</span>

        <span class="s1">assert_equal(eye(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s1">k=-</span><span class="s3">2</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s1">array([[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]]))</span>

    <span class="s2">def </span><span class="s1">test_eye_bounds(self):</span>
        <span class="s1">assert_equal(eye(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(eye(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(eye(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(eye(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s1">-</span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(eye(</span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(eye(</span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(eye(</span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]])</span>
        <span class="s1">assert_equal(eye(</span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s1">-</span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]])</span>
        <span class="s1">assert_equal(eye(</span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s1">-</span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]])</span>

    <span class="s2">def </span><span class="s1">test_strings(self):</span>
        <span class="s1">assert_equal(eye(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s4">'S3'</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s1">[[</span><span class="s5">b'1'</span><span class="s2">, </span><span class="s5">b''</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s5">b''</span><span class="s2">, </span><span class="s5">b'1'</span><span class="s1">]])</span>

    <span class="s2">def </span><span class="s1">test_bool(self):</span>
        <span class="s1">assert_equal(eye(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s1">dtype=bool)</span><span class="s2">, </span><span class="s1">[[</span><span class="s2">True, False</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s2">False, True</span><span class="s1">]])</span>

    <span class="s2">def </span><span class="s1">test_order(self):</span>
        <span class="s1">mat_c = eye(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s1">k=-</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">mat_f = eye(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s1">k=-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">order=</span><span class="s4">'F'</span><span class="s1">)</span>
        <span class="s1">assert_equal(mat_c</span><span class="s2">, </span><span class="s1">mat_f)</span>
        <span class="s2">assert </span><span class="s1">mat_c.flags.c_contiguous</span>
        <span class="s2">assert not </span><span class="s1">mat_c.flags.f_contiguous</span>
        <span class="s2">assert not </span><span class="s1">mat_f.flags.c_contiguous</span>
        <span class="s2">assert </span><span class="s1">mat_f.flags.f_contiguous</span>


<span class="s2">class </span><span class="s1">TestDiag:</span>
    <span class="s2">def </span><span class="s1">test_vector(self):</span>
        <span class="s1">vals = (</span><span class="s3">100 </span><span class="s1">* arange(</span><span class="s3">5</span><span class="s1">)).astype(</span><span class="s4">'l'</span><span class="s1">)</span>
        <span class="s1">b = zeros((</span><span class="s3">5</span><span class="s2">, </span><span class="s3">5</span><span class="s1">))</span>
        <span class="s2">for </span><span class="s1">k </span><span class="s2">in </span><span class="s1">range(</span><span class="s3">5</span><span class="s1">):</span>
            <span class="s1">b[k</span><span class="s2">, </span><span class="s1">k] = vals[k]</span>
        <span class="s1">assert_equal(diag(vals)</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s1">b = zeros((</span><span class="s3">7</span><span class="s2">, </span><span class="s3">7</span><span class="s1">))</span>
        <span class="s1">c = b.copy()</span>
        <span class="s2">for </span><span class="s1">k </span><span class="s2">in </span><span class="s1">range(</span><span class="s3">5</span><span class="s1">):</span>
            <span class="s1">b[k</span><span class="s2">, </span><span class="s1">k + </span><span class="s3">2</span><span class="s1">] = vals[k]</span>
            <span class="s1">c[k + </span><span class="s3">2</span><span class="s2">, </span><span class="s1">k] = vals[k]</span>
        <span class="s1">assert_equal(diag(vals</span><span class="s2">, </span><span class="s1">k=</span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s1">assert_equal(diag(vals</span><span class="s2">, </span><span class="s1">k=-</span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">c)</span>

    <span class="s2">def </span><span class="s1">test_matrix(self</span><span class="s2">, </span><span class="s1">vals=</span><span class="s2">None</span><span class="s1">):</span>
        <span class="s2">if </span><span class="s1">vals </span><span class="s2">is None</span><span class="s1">:</span>
            <span class="s1">vals = (</span><span class="s3">100 </span><span class="s1">* get_mat(</span><span class="s3">5</span><span class="s1">) + </span><span class="s3">1</span><span class="s1">).astype(</span><span class="s4">'l'</span><span class="s1">)</span>
        <span class="s1">b = zeros((</span><span class="s3">5</span><span class="s2">,</span><span class="s1">))</span>
        <span class="s2">for </span><span class="s1">k </span><span class="s2">in </span><span class="s1">range(</span><span class="s3">5</span><span class="s1">):</span>
            <span class="s1">b[k] = vals[k</span><span class="s2">, </span><span class="s1">k]</span>
        <span class="s1">assert_equal(diag(vals)</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s1">b = b * </span><span class="s3">0</span>
        <span class="s2">for </span><span class="s1">k </span><span class="s2">in </span><span class="s1">range(</span><span class="s3">3</span><span class="s1">):</span>
            <span class="s1">b[k] = vals[k</span><span class="s2">, </span><span class="s1">k + </span><span class="s3">2</span><span class="s1">]</span>
        <span class="s1">assert_equal(diag(vals</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">b[:</span><span class="s3">3</span><span class="s1">])</span>
        <span class="s2">for </span><span class="s1">k </span><span class="s2">in </span><span class="s1">range(</span><span class="s3">3</span><span class="s1">):</span>
            <span class="s1">b[k] = vals[k + </span><span class="s3">2</span><span class="s2">, </span><span class="s1">k]</span>
        <span class="s1">assert_equal(diag(vals</span><span class="s2">, </span><span class="s1">-</span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">b[:</span><span class="s3">3</span><span class="s1">])</span>

    <span class="s2">def </span><span class="s1">test_fortran_order(self):</span>
        <span class="s1">vals = array((</span><span class="s3">100 </span><span class="s1">* get_mat(</span><span class="s3">5</span><span class="s1">) + </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">order=</span><span class="s4">'F'</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s4">'l'</span><span class="s1">)</span>
        <span class="s1">self.test_matrix(vals)</span>

    <span class="s2">def </span><span class="s1">test_diag_bounds(self):</span>
        <span class="s1">A = [[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">5</span><span class="s2">, </span><span class="s3">6</span><span class="s1">]]</span>
        <span class="s1">assert_equal(diag(A</span><span class="s2">, </span><span class="s1">k=</span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[])</span>
        <span class="s1">assert_equal(diag(A</span><span class="s2">, </span><span class="s1">k=</span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[</span><span class="s3">2</span><span class="s1">])</span>
        <span class="s1">assert_equal(diag(A</span><span class="s2">, </span><span class="s1">k=</span><span class="s3">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">4</span><span class="s1">])</span>
        <span class="s1">assert_equal(diag(A</span><span class="s2">, </span><span class="s1">k=-</span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[</span><span class="s3">3</span><span class="s2">, </span><span class="s3">6</span><span class="s1">])</span>
        <span class="s1">assert_equal(diag(A</span><span class="s2">, </span><span class="s1">k=-</span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[</span><span class="s3">5</span><span class="s1">])</span>
        <span class="s1">assert_equal(diag(A</span><span class="s2">, </span><span class="s1">k=-</span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[])</span>

    <span class="s2">def </span><span class="s1">test_failure(self):</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">diag</span><span class="s2">, </span><span class="s1">[[[</span><span class="s3">1</span><span class="s1">]]])</span>


<span class="s2">class </span><span class="s1">TestFliplr:</span>
    <span class="s2">def </span><span class="s1">test_basic(self):</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">fliplr</span><span class="s2">, </span><span class="s1">ones(</span><span class="s3">4</span><span class="s1">))</span>
        <span class="s1">a = get_mat(</span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">b = a[:</span><span class="s2">, </span><span class="s1">::-</span><span class="s3">1</span><span class="s1">]</span>
        <span class="s1">assert_equal(fliplr(a)</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s1">a = [[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">]]</span>
        <span class="s1">b = [[</span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">5</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">3</span><span class="s1">]]</span>
        <span class="s1">assert_equal(fliplr(a)</span><span class="s2">, </span><span class="s1">b)</span>


<span class="s2">class </span><span class="s1">TestFlipud:</span>
    <span class="s2">def </span><span class="s1">test_basic(self):</span>
        <span class="s1">a = get_mat(</span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">b = a[::-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">:]</span>
        <span class="s1">assert_equal(flipud(a)</span><span class="s2">, </span><span class="s1">b)</span>
        <span class="s1">a = [[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">]]</span>
        <span class="s1">b = [[</span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]]</span>
        <span class="s1">assert_equal(flipud(a)</span><span class="s2">, </span><span class="s1">b)</span>


<span class="s2">class </span><span class="s1">TestHistogram2d:</span>
    <span class="s2">def </span><span class="s1">test_simple(self):</span>
        <span class="s1">x = array(</span>
            <span class="s1">[</span><span class="s3">0.41702200</span><span class="s2">, </span><span class="s3">0.72032449</span><span class="s2">, </span><span class="s3">1.1437481e-4</span><span class="s2">, </span><span class="s3">0.302332573</span><span class="s2">, </span><span class="s3">0.146755891</span><span class="s1">])</span>
        <span class="s1">y = array(</span>
            <span class="s1">[</span><span class="s3">0.09233859</span><span class="s2">, </span><span class="s3">0.18626021</span><span class="s2">, </span><span class="s3">0.34556073</span><span class="s2">, </span><span class="s3">0.39676747</span><span class="s2">, </span><span class="s3">0.53881673</span><span class="s1">])</span>
        <span class="s1">xedges = np.linspace(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">10</span><span class="s1">)</span>
        <span class="s1">yedges = np.linspace(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">10</span><span class="s1">)</span>
        <span class="s1">H = histogram2d(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">(xedges</span><span class="s2">, </span><span class="s1">yedges))[</span><span class="s3">0</span><span class="s1">]</span>
        <span class="s1">answer = array(</span>
            <span class="s1">[[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]])</span>
        <span class="s1">assert_array_equal(H.T</span><span class="s2">, </span><span class="s1">answer)</span>
        <span class="s1">H = histogram2d(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xedges)[</span><span class="s3">0</span><span class="s1">]</span>
        <span class="s1">assert_array_equal(H.T</span><span class="s2">, </span><span class="s1">answer)</span>
        <span class="s1">H</span><span class="s2">, </span><span class="s1">xedges</span><span class="s2">, </span><span class="s1">yedges = histogram2d(list(range(</span><span class="s3">10</span><span class="s1">))</span><span class="s2">, </span><span class="s1">list(range(</span><span class="s3">10</span><span class="s1">)))</span>
        <span class="s1">assert_array_equal(H</span><span class="s2">, </span><span class="s1">eye(</span><span class="s3">10</span><span class="s2">, </span><span class="s3">10</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(xedges</span><span class="s2">, </span><span class="s1">np.linspace(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">9</span><span class="s2">, </span><span class="s3">11</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(yedges</span><span class="s2">, </span><span class="s1">np.linspace(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">9</span><span class="s2">, </span><span class="s3">11</span><span class="s1">))</span>

    <span class="s2">def </span><span class="s1">test_asym(self):</span>
        <span class="s1">x = array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">])</span>
        <span class="s1">y = array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s1">])</span>
        <span class="s1">H</span><span class="s2">, </span><span class="s1">xed</span><span class="s2">, </span><span class="s1">yed = histogram2d(</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">(</span><span class="s3">6</span><span class="s2">, </span><span class="s3">5</span><span class="s1">)</span><span class="s2">, </span><span class="s1">range=[[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">6</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">5</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">density=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">answer = array(</span>
            <span class="s1">[[</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]])</span>
        <span class="s1">assert_array_almost_equal(H</span><span class="s2">, </span><span class="s1">answer/</span><span class="s3">8.</span><span class="s2">, </span><span class="s3">3</span><span class="s1">)</span>
        <span class="s1">assert_array_equal(xed</span><span class="s2">, </span><span class="s1">np.linspace(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s3">7</span><span class="s1">))</span>
        <span class="s1">assert_array_equal(yed</span><span class="s2">, </span><span class="s1">np.linspace(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">6</span><span class="s1">))</span>

    <span class="s2">def </span><span class="s1">test_density(self):</span>
        <span class="s1">x = array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">y = array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">H</span><span class="s2">, </span><span class="s1">xed</span><span class="s2">, </span><span class="s1">yed = histogram2d(</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">[[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">5</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">5</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">density=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">answer = array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">.5</span><span class="s1">]</span><span class="s2">,</span>
                        <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">.5</span><span class="s1">]</span><span class="s2">,</span>
                        <span class="s1">[</span><span class="s3">.5</span><span class="s2">, </span><span class="s3">.5</span><span class="s2">, </span><span class="s3">.25</span><span class="s1">]])/</span><span class="s3">9.</span>
        <span class="s1">assert_array_almost_equal(H</span><span class="s2">, </span><span class="s1">answer</span><span class="s2">, </span><span class="s3">3</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_all_outliers(self):</span>
        <span class="s1">r = np.random.rand(</span><span class="s3">100</span><span class="s1">) + </span><span class="s3">1. </span><span class="s1">+ </span><span class="s3">1e6  </span><span class="s6"># histogramdd rounds by decimal=6</span>
        <span class="s1">H</span><span class="s2">, </span><span class="s1">xed</span><span class="s2">, </span><span class="s1">yed = histogram2d(r</span><span class="s2">, </span><span class="s1">r</span><span class="s2">, </span><span class="s1">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">)</span><span class="s2">, </span><span class="s1">range=([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]))</span>
        <span class="s1">assert_array_equal(H</span><span class="s2">, </span><span class="s3">0</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">test_empty(self):</span>
        <span class="s1">a</span><span class="s2">, </span><span class="s1">edge1</span><span class="s2">, </span><span class="s1">edge2 = histogram2d([]</span><span class="s2">, </span><span class="s1">[]</span><span class="s2">, </span><span class="s1">bins=([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]))</span>
        <span class="s1">assert_array_max_ulp(a</span><span class="s2">, </span><span class="s1">array([[</span><span class="s3">0.</span><span class="s1">]]))</span>

        <span class="s1">a</span><span class="s2">, </span><span class="s1">edge1</span><span class="s2">, </span><span class="s1">edge2 = histogram2d([]</span><span class="s2">, </span><span class="s1">[]</span><span class="s2">, </span><span class="s1">bins=</span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">assert_array_max_ulp(a</span><span class="s2">, </span><span class="s1">np.zeros((</span><span class="s3">4</span><span class="s2">, </span><span class="s3">4</span><span class="s1">)))</span>

    <span class="s2">def </span><span class="s1">test_binparameter_combination(self):</span>
        <span class="s1">x = array(</span>
            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0.09207008</span><span class="s2">, </span><span class="s3">0.64575234</span><span class="s2">, </span><span class="s3">0.12875982</span><span class="s2">, </span><span class="s3">0.47390599</span><span class="s2">,</span>
             <span class="s3">0.59944483</span><span class="s2">, </span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">y = array(</span>
            <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0.14344267</span><span class="s2">, </span><span class="s3">0.48988575</span><span class="s2">, </span><span class="s3">0.30558665</span><span class="s2">, </span><span class="s3">0.44700682</span><span class="s2">,</span>
             <span class="s3">0.15886423</span><span class="s2">, </span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">edges = (</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0.1</span><span class="s2">, </span><span class="s3">0.2</span><span class="s2">, </span><span class="s3">0.3</span><span class="s2">, </span><span class="s3">0.4</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.6</span><span class="s2">, </span><span class="s3">0.7</span><span class="s2">, </span><span class="s3">0.8</span><span class="s2">, </span><span class="s3">0.9</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">H</span><span class="s2">, </span><span class="s1">xe</span><span class="s2">, </span><span class="s1">ye = histogram2d(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">(edges</span><span class="s2">, </span><span class="s3">4</span><span class="s1">))</span>
        <span class="s1">answer = array(</span>
            <span class="s1">[[</span><span class="s3">2.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">1.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">1.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">1.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">1.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">1.</span><span class="s1">]])</span>
        <span class="s1">assert_array_equal(H</span><span class="s2">, </span><span class="s1">answer)</span>
        <span class="s1">assert_array_equal(ye</span><span class="s2">, </span><span class="s1">array([</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.25</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.75</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]))</span>
        <span class="s1">H</span><span class="s2">, </span><span class="s1">xe</span><span class="s2">, </span><span class="s1">ye = histogram2d(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">(</span><span class="s3">4</span><span class="s2">, </span><span class="s1">edges))</span>
        <span class="s1">answer = array(</span>
            <span class="s1">[[</span><span class="s3">1.</span><span class="s2">, </span><span class="s3">1.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">1.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">1.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">1.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">1.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">[</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">, </span><span class="s3">1.</span><span class="s1">]])</span>
        <span class="s1">assert_array_equal(H</span><span class="s2">, </span><span class="s1">answer)</span>
        <span class="s1">assert_array_equal(xe</span><span class="s2">, </span><span class="s1">array([</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">0.25</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.75</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]))</span>

    <span class="s1">@requires_array_function</span>
    <span class="s2">def </span><span class="s1">test_dispatch(self):</span>
        <span class="s2">class </span><span class="s1">ShouldDispatch:</span>
            <span class="s2">def </span><span class="s1">__array_function__(self</span><span class="s2">, </span><span class="s1">function</span><span class="s2">, </span><span class="s1">types</span><span class="s2">, </span><span class="s1">args</span><span class="s2">, </span><span class="s1">kwargs):</span>
                <span class="s2">return </span><span class="s1">types</span><span class="s2">, </span><span class="s1">args</span><span class="s2">, </span><span class="s1">kwargs</span>

        <span class="s1">xy = [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]</span>
        <span class="s1">s_d = ShouldDispatch()</span>
        <span class="s1">r = histogram2d(s_d</span><span class="s2">, </span><span class="s1">xy)</span>
        <span class="s6"># Cannot use assert_equal since that dispatches...</span>
        <span class="s1">assert_(r == ((ShouldDispatch</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(s_d</span><span class="s2">, </span><span class="s1">xy)</span><span class="s2">, </span><span class="s1">{}))</span>
        <span class="s1">r = histogram2d(xy</span><span class="s2">, </span><span class="s1">s_d)</span>
        <span class="s1">assert_(r == ((ShouldDispatch</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(xy</span><span class="s2">, </span><span class="s1">s_d)</span><span class="s2">, </span><span class="s1">{}))</span>
        <span class="s1">r = histogram2d(xy</span><span class="s2">, </span><span class="s1">xy</span><span class="s2">, </span><span class="s1">bins=s_d)</span>
        <span class="s1">assert_(r</span><span class="s2">, </span><span class="s1">((ShouldDispatch</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(xy</span><span class="s2">, </span><span class="s1">xy)</span><span class="s2">, </span><span class="s1">dict(bins=s_d)))</span>
        <span class="s1">r = histogram2d(xy</span><span class="s2">, </span><span class="s1">xy</span><span class="s2">, </span><span class="s1">bins=[s_d</span><span class="s2">, </span><span class="s3">5</span><span class="s1">])</span>
        <span class="s1">assert_(r</span><span class="s2">, </span><span class="s1">((ShouldDispatch</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(xy</span><span class="s2">, </span><span class="s1">xy)</span><span class="s2">, </span><span class="s1">dict(bins=[s_d</span><span class="s2">, </span><span class="s3">5</span><span class="s1">])))</span>
        <span class="s1">assert_raises(Exception</span><span class="s2">, </span><span class="s1">histogram2d</span><span class="s2">, </span><span class="s1">xy</span><span class="s2">, </span><span class="s1">xy</span><span class="s2">, </span><span class="s1">bins=[s_d])</span>
        <span class="s1">r = histogram2d(xy</span><span class="s2">, </span><span class="s1">xy</span><span class="s2">, </span><span class="s1">weights=s_d)</span>
        <span class="s1">assert_(r</span><span class="s2">, </span><span class="s1">((ShouldDispatch</span><span class="s2">,</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(xy</span><span class="s2">, </span><span class="s1">xy)</span><span class="s2">, </span><span class="s1">dict(weights=s_d)))</span>

    <span class="s1">@pytest.mark.parametrize((</span><span class="s4">&quot;x_len&quot;</span><span class="s2">, </span><span class="s4">&quot;y_len&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[(</span><span class="s3">10</span><span class="s2">, </span><span class="s3">11</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">20</span><span class="s2">, </span><span class="s3">19</span><span class="s1">)])</span>
    <span class="s2">def </span><span class="s1">test_bad_length(self</span><span class="s2">, </span><span class="s1">x_len</span><span class="s2">, </span><span class="s1">y_len):</span>
        <span class="s1">x</span><span class="s2">, </span><span class="s1">y = np.ones(x_len)</span><span class="s2">, </span><span class="s1">np.ones(y_len)</span>
        <span class="s2">with </span><span class="s1">pytest.raises(ValueError</span><span class="s2">,</span>
                           <span class="s1">match=</span><span class="s4">'x and y must have the same length.'</span><span class="s1">):</span>
            <span class="s1">histogram2d(x</span><span class="s2">, </span><span class="s1">y)</span>


<span class="s2">class </span><span class="s1">TestTri:</span>
    <span class="s2">def </span><span class="s1">test_dtype(self):</span>
        <span class="s1">out = array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                     <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                     <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]])</span>
        <span class="s1">assert_array_equal(tri(</span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">out)</span>
        <span class="s1">assert_array_equal(tri(</span><span class="s3">3</span><span class="s2">, </span><span class="s1">dtype=bool)</span><span class="s2">, </span><span class="s1">out.astype(bool))</span>


<span class="s2">def </span><span class="s1">test_tril_triu_ndim2():</span>
    <span class="s2">for </span><span class="s1">dtype </span><span class="s2">in </span><span class="s1">np.typecodes[</span><span class="s4">'AllFloat'</span><span class="s1">] + np.typecodes[</span><span class="s4">'AllInteger'</span><span class="s1">]:</span>
        <span class="s1">a = np.ones((</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">dtype=dtype)</span>
        <span class="s1">b = np.tril(a)</span>
        <span class="s1">c = np.triu(a)</span>
        <span class="s1">assert_array_equal(b</span><span class="s2">, </span><span class="s1">[[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]])</span>
        <span class="s1">assert_array_equal(c</span><span class="s2">, </span><span class="s1">b.T)</span>
        <span class="s6"># should return the same dtype as the original array</span>
        <span class="s1">assert_equal(b.dtype</span><span class="s2">, </span><span class="s1">a.dtype)</span>
        <span class="s1">assert_equal(c.dtype</span><span class="s2">, </span><span class="s1">a.dtype)</span>


<span class="s2">def </span><span class="s1">test_tril_triu_ndim3():</span>
    <span class="s2">for </span><span class="s1">dtype </span><span class="s2">in </span><span class="s1">np.typecodes[</span><span class="s4">'AllFloat'</span><span class="s1">] + np.typecodes[</span><span class="s4">'AllInteger'</span><span class="s1">]:</span>
        <span class="s1">a = np.array([</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]]</span><span class="s2">,</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]]</span><span class="s2">,</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]]</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=dtype)</span>
        <span class="s1">a_tril_desired = np.array([</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]]</span><span class="s2">,</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]]</span><span class="s2">,</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]]</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=dtype)</span>
        <span class="s1">a_triu_desired = np.array([</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]]</span><span class="s2">,</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]]</span><span class="s2">,</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]]</span><span class="s2">,</span>
            <span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=dtype)</span>
        <span class="s1">a_triu_observed = np.triu(a)</span>
        <span class="s1">a_tril_observed = np.tril(a)</span>
        <span class="s1">assert_array_equal(a_triu_observed</span><span class="s2">, </span><span class="s1">a_triu_desired)</span>
        <span class="s1">assert_array_equal(a_tril_observed</span><span class="s2">, </span><span class="s1">a_tril_desired)</span>
        <span class="s1">assert_equal(a_triu_observed.dtype</span><span class="s2">, </span><span class="s1">a.dtype)</span>
        <span class="s1">assert_equal(a_tril_observed.dtype</span><span class="s2">, </span><span class="s1">a.dtype)</span>


<span class="s2">def </span><span class="s1">test_tril_triu_with_inf():</span>
    <span class="s6"># Issue 4859</span>
    <span class="s1">arr = np.array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">np.inf]</span><span class="s2">,</span>
                    <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                    <span class="s1">[np.inf</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]])</span>
    <span class="s1">out_tril = np.array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                         <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">,</span>
                         <span class="s1">[np.inf</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]])</span>
    <span class="s1">out_triu = out_tril.T</span>
    <span class="s1">assert_array_equal(np.triu(arr)</span><span class="s2">, </span><span class="s1">out_triu)</span>
    <span class="s1">assert_array_equal(np.tril(arr)</span><span class="s2">, </span><span class="s1">out_tril)</span>


<span class="s2">def </span><span class="s1">test_tril_triu_dtype():</span>
    <span class="s6"># Issue 4916</span>
    <span class="s6"># tril and triu should return the same dtype as input</span>
    <span class="s2">for </span><span class="s1">c </span><span class="s2">in </span><span class="s1">np.typecodes[</span><span class="s4">'All'</span><span class="s1">]:</span>
        <span class="s2">if </span><span class="s1">c == </span><span class="s4">'V'</span><span class="s1">:</span>
            <span class="s2">continue</span>
        <span class="s1">arr = np.zeros((</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">dtype=c)</span>
        <span class="s1">assert_equal(np.triu(arr).dtype</span><span class="s2">, </span><span class="s1">arr.dtype)</span>
        <span class="s1">assert_equal(np.tril(arr).dtype</span><span class="s2">, </span><span class="s1">arr.dtype)</span>

    <span class="s6"># check special cases</span>
    <span class="s1">arr = np.array([[</span><span class="s4">'2001-01-01T12:00'</span><span class="s2">, </span><span class="s4">'2002-02-03T13:56'</span><span class="s1">]</span><span class="s2">,</span>
                    <span class="s1">[</span><span class="s4">'2004-01-01T12:00'</span><span class="s2">, </span><span class="s4">'2003-01-03T13:45'</span><span class="s1">]]</span><span class="s2">,</span>
                   <span class="s1">dtype=</span><span class="s4">'datetime64'</span><span class="s1">)</span>
    <span class="s1">assert_equal(np.triu(arr).dtype</span><span class="s2">, </span><span class="s1">arr.dtype)</span>
    <span class="s1">assert_equal(np.tril(arr).dtype</span><span class="s2">, </span><span class="s1">arr.dtype)</span>

    <span class="s1">arr = np.zeros((</span><span class="s3">3</span><span class="s2">,</span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">dtype=</span><span class="s4">'f4,f4'</span><span class="s1">)</span>
    <span class="s1">assert_equal(np.triu(arr).dtype</span><span class="s2">, </span><span class="s1">arr.dtype)</span>
    <span class="s1">assert_equal(np.tril(arr).dtype</span><span class="s2">, </span><span class="s1">arr.dtype)</span>


<span class="s2">def </span><span class="s1">test_mask_indices():</span>
    <span class="s6"># simple test without offset</span>
    <span class="s1">iu = mask_indices(</span><span class="s3">3</span><span class="s2">, </span><span class="s1">np.triu)</span>
    <span class="s1">a = np.arange(</span><span class="s3">9</span><span class="s1">).reshape(</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">assert_array_equal(a[iu]</span><span class="s2">, </span><span class="s1">array([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">8</span><span class="s1">]))</span>
    <span class="s6"># Now with an offset</span>
    <span class="s1">iu1 = mask_indices(</span><span class="s3">3</span><span class="s2">, </span><span class="s1">np.triu</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">assert_array_equal(a[iu1]</span><span class="s2">, </span><span class="s1">array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">5</span><span class="s1">]))</span>


<span class="s2">def </span><span class="s1">test_tril_indices():</span>
    <span class="s6"># indices without and with offset</span>
    <span class="s1">il1 = tril_indices(</span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">il2 = tril_indices(</span><span class="s3">4</span><span class="s2">, </span><span class="s1">k=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">il3 = tril_indices(</span><span class="s3">4</span><span class="s2">, </span><span class="s1">m=</span><span class="s3">5</span><span class="s1">)</span>
    <span class="s1">il4 = tril_indices(</span><span class="s3">4</span><span class="s2">, </span><span class="s1">k=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">m=</span><span class="s3">5</span><span class="s1">)</span>

    <span class="s1">a = np.array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s1">]</span><span class="s2">,</span>
                  <span class="s1">[</span><span class="s3">5</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s3">7</span><span class="s2">, </span><span class="s3">8</span><span class="s1">]</span><span class="s2">,</span>
                  <span class="s1">[</span><span class="s3">9</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s3">11</span><span class="s2">, </span><span class="s3">12</span><span class="s1">]</span><span class="s2">,</span>
                  <span class="s1">[</span><span class="s3">13</span><span class="s2">, </span><span class="s3">14</span><span class="s2">, </span><span class="s3">15</span><span class="s2">, </span><span class="s3">16</span><span class="s1">]])</span>
    <span class="s1">b = np.arange(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">21</span><span class="s1">).reshape(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">)</span>

    <span class="s6"># indexing:</span>
    <span class="s1">assert_array_equal(a[il1]</span><span class="s2">,</span>
                       <span class="s1">array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s3">9</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s3">11</span><span class="s2">, </span><span class="s3">13</span><span class="s2">, </span><span class="s3">14</span><span class="s2">, </span><span class="s3">15</span><span class="s2">, </span><span class="s3">16</span><span class="s1">]))</span>
    <span class="s1">assert_array_equal(b[il3]</span><span class="s2">,</span>
                       <span class="s1">array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s3">7</span><span class="s2">, </span><span class="s3">11</span><span class="s2">, </span><span class="s3">12</span><span class="s2">, </span><span class="s3">13</span><span class="s2">, </span><span class="s3">16</span><span class="s2">, </span><span class="s3">17</span><span class="s2">, </span><span class="s3">18</span><span class="s2">, </span><span class="s3">19</span><span class="s1">]))</span>

    <span class="s6"># And for assigning values:</span>
    <span class="s1">a[il1] = -</span><span class="s3">1</span>
    <span class="s1">assert_array_equal(a</span><span class="s2">,</span>
                       <span class="s1">array([[-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s1">]</span><span class="s2">,</span>
                              <span class="s1">[-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">7</span><span class="s2">, </span><span class="s3">8</span><span class="s1">]</span><span class="s2">,</span>
                              <span class="s1">[-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">12</span><span class="s1">]</span><span class="s2">,</span>
                              <span class="s1">[-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">]]))</span>
    <span class="s1">b[il3] = -</span><span class="s3">1</span>
    <span class="s1">assert_array_equal(b</span><span class="s2">,</span>
                       <span class="s1">array([[-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">]</span><span class="s2">,</span>
                              <span class="s1">[-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">8</span><span class="s2">, </span><span class="s3">9</span><span class="s2">, </span><span class="s3">10</span><span class="s1">]</span><span class="s2">,</span>
                              <span class="s1">[-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">14</span><span class="s2">, </span><span class="s3">15</span><span class="s1">]</span><span class="s2">,</span>
                              <span class="s1">[-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">20</span><span class="s1">]]))</span>
    <span class="s6"># These cover almost the whole array (two diagonals right of the main one):</span>
    <span class="s1">a[il2] = -</span><span class="s3">10</span>
    <span class="s1">assert_array_equal(a</span><span class="s2">,</span>
                       <span class="s1">array([[-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s3">4</span><span class="s1">]</span><span class="s2">,</span>
                              <span class="s1">[-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s1">]</span><span class="s2">,</span>
                              <span class="s1">[-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s1">]</span><span class="s2">,</span>
                              <span class="s1">[-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s1">]]))</span>
    <span class="s1">b[il4] = -</span><span class="s3">10</span>
    <span class="s1">assert_array_equal(b</span><span class="s2">,</span>
                       <span class="s1">array([[-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">]</span><span class="s2">,</span>
                              <span class="s1">[-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s3">10</span><span class="s1">]</span><span class="s2">,</span>
                              <span class="s1">[-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s1">]</span><span class="s2">,</span>
                              <span class="s1">[-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s1">]]))</span>


<span class="s2">class </span><span class="s1">TestTriuIndices:</span>
    <span class="s2">def </span><span class="s1">test_triu_indices(self):</span>
        <span class="s1">iu1 = triu_indices(</span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">iu2 = triu_indices(</span><span class="s3">4</span><span class="s2">, </span><span class="s1">k=</span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">iu3 = triu_indices(</span><span class="s3">4</span><span class="s2">, </span><span class="s1">m=</span><span class="s3">5</span><span class="s1">)</span>
        <span class="s1">iu4 = triu_indices(</span><span class="s3">4</span><span class="s2">, </span><span class="s1">k=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">m=</span><span class="s3">5</span><span class="s1">)</span>

        <span class="s1">a = np.array([[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s1">]</span><span class="s2">,</span>
                      <span class="s1">[</span><span class="s3">5</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s3">7</span><span class="s2">, </span><span class="s3">8</span><span class="s1">]</span><span class="s2">,</span>
                      <span class="s1">[</span><span class="s3">9</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s3">11</span><span class="s2">, </span><span class="s3">12</span><span class="s1">]</span><span class="s2">,</span>
                      <span class="s1">[</span><span class="s3">13</span><span class="s2">, </span><span class="s3">14</span><span class="s2">, </span><span class="s3">15</span><span class="s2">, </span><span class="s3">16</span><span class="s1">]])</span>
        <span class="s1">b = np.arange(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">21</span><span class="s1">).reshape(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s1">)</span>

        <span class="s6"># Both for indexing:</span>
        <span class="s1">assert_array_equal(a[iu1]</span><span class="s2">,</span>
                           <span class="s1">array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s3">7</span><span class="s2">, </span><span class="s3">8</span><span class="s2">, </span><span class="s3">11</span><span class="s2">, </span><span class="s3">12</span><span class="s2">, </span><span class="s3">16</span><span class="s1">]))</span>
        <span class="s1">assert_array_equal(b[iu3]</span><span class="s2">,</span>
                           <span class="s1">array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">7</span><span class="s2">, </span><span class="s3">8</span><span class="s2">, </span><span class="s3">9</span><span class="s2">,</span>
                                  <span class="s3">10</span><span class="s2">, </span><span class="s3">13</span><span class="s2">, </span><span class="s3">14</span><span class="s2">, </span><span class="s3">15</span><span class="s2">, </span><span class="s3">19</span><span class="s2">, </span><span class="s3">20</span><span class="s1">]))</span>

        <span class="s6"># And for assigning values:</span>
        <span class="s1">a[iu1] = -</span><span class="s3">1</span>
        <span class="s1">assert_array_equal(a</span><span class="s2">,</span>
                           <span class="s1">array([[-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                                  <span class="s1">[</span><span class="s3">5</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                                  <span class="s1">[</span><span class="s3">9</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                                  <span class="s1">[</span><span class="s3">13</span><span class="s2">, </span><span class="s3">14</span><span class="s2">, </span><span class="s3">15</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">]]))</span>
        <span class="s1">b[iu3] = -</span><span class="s3">1</span>
        <span class="s1">assert_array_equal(b</span><span class="s2">,</span>
                           <span class="s1">array([[-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                                  <span class="s1">[</span><span class="s3">6</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                                  <span class="s1">[</span><span class="s3">11</span><span class="s2">, </span><span class="s3">12</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                                  <span class="s1">[</span><span class="s3">16</span><span class="s2">, </span><span class="s3">17</span><span class="s2">, </span><span class="s3">18</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">]]))</span>

        <span class="s6"># These cover almost the whole array (two diagonals right of the</span>
        <span class="s6"># main one):</span>
        <span class="s1">a[iu2] = -</span><span class="s3">10</span>
        <span class="s1">assert_array_equal(a</span><span class="s2">,</span>
                           <span class="s1">array([[-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s1">]</span><span class="s2">,</span>
                                  <span class="s1">[</span><span class="s3">5</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s1">]</span><span class="s2">,</span>
                                  <span class="s1">[</span><span class="s3">9</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                                  <span class="s1">[</span><span class="s3">13</span><span class="s2">, </span><span class="s3">14</span><span class="s2">, </span><span class="s3">15</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">]]))</span>
        <span class="s1">b[iu4] = -</span><span class="s3">10</span>
        <span class="s1">assert_array_equal(b</span><span class="s2">,</span>
                           <span class="s1">array([[-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s1">]</span><span class="s2">,</span>
                                  <span class="s1">[</span><span class="s3">6</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s1">]</span><span class="s2">,</span>
                                  <span class="s1">[</span><span class="s3">11</span><span class="s2">, </span><span class="s3">12</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">10</span><span class="s1">]</span><span class="s2">,</span>
                                  <span class="s1">[</span><span class="s3">16</span><span class="s2">, </span><span class="s3">17</span><span class="s2">, </span><span class="s3">18</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">]]))</span>


<span class="s2">class </span><span class="s1">TestTrilIndicesFrom:</span>
    <span class="s2">def </span><span class="s1">test_exceptions(self):</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">tril_indices_from</span><span class="s2">, </span><span class="s1">np.ones((</span><span class="s3">2</span><span class="s2">,</span><span class="s1">)))</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">tril_indices_from</span><span class="s2">, </span><span class="s1">np.ones((</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)))</span>
        <span class="s6"># assert_raises(ValueError, tril_indices_from, np.ones((2, 3)))</span>


<span class="s2">class </span><span class="s1">TestTriuIndicesFrom:</span>
    <span class="s2">def </span><span class="s1">test_exceptions(self):</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">triu_indices_from</span><span class="s2">, </span><span class="s1">np.ones((</span><span class="s3">2</span><span class="s2">,</span><span class="s1">)))</span>
        <span class="s1">assert_raises(ValueError</span><span class="s2">, </span><span class="s1">triu_indices_from</span><span class="s2">, </span><span class="s1">np.ones((</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)))</span>
        <span class="s6"># assert_raises(ValueError, triu_indices_from, np.ones((2, 3)))</span>


<span class="s2">class </span><span class="s1">TestVander:</span>
    <span class="s2">def </span><span class="s1">test_basic(self):</span>
        <span class="s1">c = np.array([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s1">])</span>
        <span class="s1">v = vander(c)</span>
        <span class="s1">powers = np.array([[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                           <span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                           <span class="s1">[</span><span class="s3">16</span><span class="s2">, </span><span class="s1">-</span><span class="s3">8</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s1">-</span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                           <span class="s1">[</span><span class="s3">81</span><span class="s2">, </span><span class="s3">27</span><span class="s2">, </span><span class="s3">9</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]])</span>
        <span class="s6"># Check default value of N:</span>
        <span class="s1">assert_array_equal(v</span><span class="s2">, </span><span class="s1">powers[:</span><span class="s2">, </span><span class="s3">1</span><span class="s1">:])</span>
        <span class="s6"># Check a range of N values, including 0 and 5 (greater than default)</span>
        <span class="s1">m = powers.shape[</span><span class="s3">1</span><span class="s1">]</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">range(</span><span class="s3">6</span><span class="s1">):</span>
            <span class="s1">v = vander(c</span><span class="s2">, </span><span class="s1">N=n)</span>
            <span class="s1">assert_array_equal(v</span><span class="s2">, </span><span class="s1">powers[:</span><span class="s2">, </span><span class="s1">m-n:m])</span>

    <span class="s2">def </span><span class="s1">test_dtypes(self):</span>
        <span class="s1">c = array([</span><span class="s3">11</span><span class="s2">, </span><span class="s1">-</span><span class="s3">12</span><span class="s2">, </span><span class="s3">13</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dtype=np.int8)</span>
        <span class="s1">v = vander(c)</span>
        <span class="s1">expected = np.array([[</span><span class="s3">121</span><span class="s2">, </span><span class="s3">11</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                             <span class="s1">[</span><span class="s3">144</span><span class="s2">, </span><span class="s1">-</span><span class="s3">12</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                             <span class="s1">[</span><span class="s3">169</span><span class="s2">, </span><span class="s3">13</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]])</span>
        <span class="s1">assert_array_equal(v</span><span class="s2">, </span><span class="s1">expected)</span>

        <span class="s1">c = array([</span><span class="s3">1.0</span><span class="s1">+</span><span class="s3">1j</span><span class="s2">, </span><span class="s3">1.0</span><span class="s1">-</span><span class="s3">1j</span><span class="s1">])</span>
        <span class="s1">v = vander(c</span><span class="s2">, </span><span class="s1">N=</span><span class="s3">3</span><span class="s1">)</span>
        <span class="s1">expected = np.array([[</span><span class="s3">2j</span><span class="s2">, </span><span class="s3">1</span><span class="s1">+</span><span class="s3">1j</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
                             <span class="s1">[-</span><span class="s3">2j</span><span class="s2">, </span><span class="s3">1</span><span class="s1">-</span><span class="s3">1j</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]])</span>
        <span class="s6"># The data is floating point, but the values are small integers,</span>
        <span class="s6"># so assert_array_equal *should* be safe here (rather than, say,</span>
        <span class="s6"># assert_array_almost_equal).</span>
        <span class="s1">assert_array_equal(v</span><span class="s2">, </span><span class="s1">expected)</span>
</pre>
</body>
</html>